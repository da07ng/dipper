// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/geow/TooltipQueryReadStore",["dijit","dojo","dojox","dojo/require!dojox/data/QueryReadStore,arcgisonline/sharing/geow/Content,arcgisonline/sharing/util"],function(l,d,k){d.provide("arcgisonline.sharing.geow.TooltipQueryReadStore");d.require("dojox.data.QueryReadStore");d.require("arcgisonline.sharing.geow.Content");d.require("arcgisonline.sharing.util");d.declare("arcgisonline.sharing.geow.TooltipQueryReadStore",k.data.QueryReadStore,{allItemsByIdentity:null,gridId:"",
_fetchItems:function(f,k,b){var c=f.serverQuery||f.query||{};c.start=f.start||0;c.start++;f.count&&(c.num=f.count);b={q:c.q};c.start&&(b.start=c.start);c.num&&(b.num=c.num);c.sortField&&(b.sortField=c.sortField);c.sortOrder&&(b.sortOrder=c.sortOrder);c.bbox&&(b.bbox=c.bbox);arcgisonline.sharing.util.getJsonWithContent(this.url,b,d.hitch(this,function(e){var b=e.total||-1;d.publish("gridCount",[e.total,"ArcGIS.com"]);this._total=e.total;this._items=[];d.forEach(e.results,function(a,c){var b=a.tags||
a.keywords||[],d=void 0==a.imageUrl?arcgisonline.sharing.geow.Content._getItemImageUrl(a):a.imageUrl,f=a.uploaded||a.created,e=void 0==a.extent?arcgisonline.sharing.geow.Community._getGroupTitleLink(a):a.title,h=a.item||"",g="";a.snippet&&0<a.snippet.length&&"null"!=a.snippet?g=150<a.snippet.length?a.snippet.substring(0,150)+"...":a.snippet:a.description&&(0<a.description.length&&"null"!=a.description)&&(g=arcgisonline.sharing.util.removeHTMLTags(a.description),g=150<g.length?g.substring(0,150)+"...":
g);b={id:a.id||"",owner:a.owner,title:e,description:a.description,snippet:g,tags:b.join?b.join(","):b,imageUrl:d,thumbnail:a.thumbnail,isInvitationOnly:a.isInvitationOnly,created:f,modified:a.modified,itemType:a.itemType||"",typeKeywords:a.typeKeywords||"",type:a.type||"",extent:a.extent||"",item:h,gridId:this.gridId,status:"new"};this._items.push({i:b,r:this})},this);this._itemsByIdentity={};this.allItemsByIdentity||(this.allItemsByIdentity={});this._identifier="id";for(i=0;i<this._items.length;++i){e=
this._items[i].i;var h=e.id;this._itemsByIdentity[h]||(this._itemsByIdentity[h]=e);this.allItemsByIdentity[h]||(this.allItemsByIdentity[h]=e)}b=-1===b?this._items.length:b;k(this._items,f,b);this.lastRequestHash=(new Date).getTime()+"-"+String(Math.random()).substring(2);this._lastServerQuery=d.mixin({},c)}))},getAllItemsByIdentity:function(d){return this.allItemsByIdentity[d]},clearAllItemsByIdentity:function(){this.allItemsByIdentity={}}})});