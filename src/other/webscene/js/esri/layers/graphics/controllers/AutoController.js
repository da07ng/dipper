// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("require ../../../core/declare dojo/Deferred ../../../request ../../../core/Accessor ../../../core/Promise".split(" "),function(e,f,g,h,k,l){return f([k,l],{initialize:function(){var b=this,a=this.layer.then(function(){return b._getFeatureCount().then(function(a){a=b._canUseSnapshot(a&&a.count)?0:1;return b._createController(a)})}).then(function(a){b.activeController=a});this.addResolvingPromise(a)},controllerModulePaths:{"0":"./SnapshotController",1:"./OnDemandController"},_getFeatureCount:function(){var b=
this.layer,a=b.timeDefinition;return h({url:b.graphicsSource.parsedUrl.path+"/query",content:{f:"json",where:b.definitionExpression||"1\x3d1",timeExtent:a&&a.toJSON(),returnCountOnly:!0},callbackParamName:"callback"})},_canUseSnapshot:function(b){var a=this.layer,c=a.geometryType;return("esriGeometryPolyline"===c||"esriGeometryPolygon"===c||"esriGeometryMultipoint"===c)&&b<=a.maxRecordCountForAuto||"esriGeometryPoint"===c&&b<=a.maxPointCountForAuto},_createController:function(b){var a=new g;(b=this.controllerModulePaths[b])?
e([b],function(b){var d=new b({layer:this.layer,layerView:this.layerView});d.then(function(){a.resolve(d)},function(b){a.reject(b)})}.bind(this)):a.reject(Error('Module path not found for controller type: "'+this.mode+'"'));return a.promise}})});