// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define(["./math/vec2","./Tile"],function(c,n){var m=function(a,b,e){this.z=b.level;this.scale=b.scale;this.origin=f;var g=a.spatialReference._getInfo(),d=this.resolution=b.resolution,f=this.origin=c.fromValues(a.origin.x,a.origin.y),d=this.norm=c.fromValues(a.cols*d,a.rows*d),h=this.start=c.fromValues(-Infinity,-Infinity),k=this.end=c.fromValues(Infinity,Infinity),l=this.size=c.fromValues(Infinity,Infinity);e&&(c.set(h,Math.max(0,Math.floor((e.xmin-f[0])/d[0])),Math.max(0,Math.floor((f[1]-e.ymax)/
d[1]))),c.set(k,Math.max(0,Math.floor((e.xmax-f[0])/d[0])),Math.max(0,Math.floor((f[1]-e.ymin)/d[1]))),c.set(l,k[0]-h[0]+1,k[1]-h[1]+1));g?(this.worldSize=c.set(c.create(),Math.ceil(Math.round(2*g.origin[1]/b.resolution)/a.cols),l[1]),this.worldStart=c.set(c.create(),Math.floor((g.origin[0]-f[0])/d[0]),h[1]),this.worldEnd=c.set(c.create(),this.worldSize[0]-this.worldStart[0]-1,k[1])):(this.worldStart=h,this.wldEnd=k,this.worldSize=l);this.norm=d;this.start=h;this.end=k;this.size=l};m.prototype={normalizeX:function(a){var b=
this.worldSize[0];return 0>a?b-1-Math.abs((a+1)%b):a%b},getXForWorld:function(a,b){return this.worldSize[0]*b+a},getWorldForX:function(a){return Math.floor(a/this.worldSize[0])},getWorldStartCol:function(a){return a*this.worldSize[0]+this.start[0]},getWorldEndCol:function(a){return a*this.worldSize[0]+this.start[0]+this.size[0]-1},toGridCol:function(a){return(a-this.origin[0])/this.norm[0]},toGridRow:function(a){return(this.origin[1]-a)/this.norm[1]},getTileOrigin:function(a,b){var e=this.origin,
g=this.norm;return c.set(a,e[0]+this.getXForWorld(b[0],b[3])*g[0],e[1]-b[1]*g[1])},getIntersectingTile:function(a){var b=this.resolution,c=a.lodInfo.resolution;if(a.coords[2]<this.z)return null;b=[Math.floor(a.coords[0]*c/b+0.01),Math.floor(a.row*c/b+0.01),this.z,0];b[3]=this.getXForWorld(b[0],a.world);return new n(b,this)}};return m});