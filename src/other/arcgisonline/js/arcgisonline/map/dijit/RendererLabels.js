// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/map/dijit/RendererLabels",["dijit","dojo","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/ColorPalette,esri/symbols/TextSymbol,esri/dijit/FontAlignment,arcgisonline/sharing/dijit/dialog/GeneralDlg"],function(f,b,n){b.provide("arcgisonline.map.dijit.RendererLabels");b.require("dijit._Widget");b.require("dijit._Templated");b.require("dijit.ColorPalette");b.require("esri.symbols.TextSymbol");b.require("esri.dijit.FontAlignment");b.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");
b.declare("arcgisonline.map.dijit.RendererLabels",[f._Widget,f._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv dojoType\x3d"dijit.layout.BorderContainer" region\x3d"top" style\x3d"height:100%;"\x3e\r\n  \x3cdiv id\x3d"rendererLabels-main" class\x3d"panel panel_left" dojoType\x3d"dijit.layout.ContentPane" region\x3d"center" style\x3d"padding:7px;margin-bottom:-5px;"\x3e\r\n    \x3cdiv id\x3d"rendererLabelsHeader" dojotype\x3d"dijit.layout.ContentPane" region\x3d"top"\x3e\r\n      \x3cdiv class\x3d"esriFloatTrailing" style\x3d"display:inline;"\x3e\r\n        \x3ca href\x3d"JavaScript:void(0);" dojoAttachPoint\x3d"_closeBtn" title\x3d"${i18n.close}" class\x3d"panel panel_close panel_collapse"\x3e\x3c/a\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"rendererLabelsTitle" class\x3d"esriFloatLeading panel_title"\x3e\r\n        ${i18n.rendererLabelsPanelTitle}\r\n      \x3c/div\x3e\r\n      \x3cdiv dojoAttachPoint\x3d"_rendererLabelsLayerName" class\x3d"esriFloatLeading panel_title" style\x3d"clear:both;"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"clear:both; border-bottom: #aeaeae thin solid; height:1px;"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv dojotype\x3d"dijit.layout.ContentPane" region\x3d"center" id\x3d"rendererLabelsPane" style\x3d"padding-top:10px;overflow-y:auto;"\x3e\r\n      \x3cdiv style\x3d"padding: 10px 0;"\x3e\r\n        \x3cinput dojoAttachPoint\x3d"_rendererLabelsCheck" dojotype\x3d"dijit.form.CheckBox"  dojoAttachEvent\x3d"onChange:_onChangeRendererLabelsCheck" value\x3d"on" type\x3d"checkbox" /\x3e\r\n        \x3clabel\x3e\r\n          ${i18n.labelFeatures}\r\n        \x3c/label\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv\x3e\r\n        \x3ctable style\x3d"width:100%"\x3e\r\n          \x3ctbody\x3e\r\n            \x3ctr style\x3d"width:100%"\x3e\r\n              \x3ctd nowrap\x3e\r\n                \x3cdiv class\x3d"firstColumnDiv"\x3e\r\n                  \x3clabel class\x3d"firstColumnLabel"\x3e\r\n                    ${i18n.textLabel}\r\n                  \x3c/label\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd style\x3d"width:100%"\x3e\r\n                \x3ctable style\x3d"width:100%"\x3e\r\n                  \x3ctr style\x3d"width:100%"\x3e\r\n                    \x3ctd style\x3d"width:100%"\x3e\r\n                      \x3cdiv dojoAttachPoint\x3d"_rendererLabelsTextInput" dojotype\x3d"dijit.form.Textarea" intermediateChanges\x3d"true" style\x3d"padding:2px;"\x3e\x3c/div\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                      \x3cbutton dojoAttachPoint\x3d"_rendererLabelsTextButton" class\x3d"calcite transparent tiny"\x3e\x3c/button\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                \x3c/table\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd nowrap\x3e\r\n                \x26nbsp;\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3ctable style\x3d"padding: 5px 0"\x3e\r\n                  \x3ctr\x3e\r\n                    \x3ctd\x3e\r\n                      \x3cselect class\x3d"rendererInput" class\x3d"calcite light" style\x3d"padding-right: 5px;" dojoAttachPoint\x3d"_rendererLabelsFontSizes" dojoAttachEvent\x3d"onChange:_onChangeRendererLabelsFontSize" dojoType\x3d"dijit.form.Select"\x3e\r\n                        \x3coption value\x3d"5" selected\x3d"selected"\x3e5\x3c/option\x3e\r\n                        \x3coption value\x3d"6" selected\x3d"selected"\x3e6\x3c/option\x3e\r\n                        \x3coption value\x3d"7" selected\x3d"selected"\x3e7\x3c/option\x3e\r\n                        \x3coption value\x3d"8" selected\x3d"selected"\x3e8\x3c/option\x3e\r\n                        \x3coption value\x3d"9" selected\x3d"selected"\x3e9\x3c/option\x3e\r\n                        \x3coption value\x3d"10" selected\x3d"selected"\x3e10\x3c/option\x3e\r\n                        \x3coption value\x3d"11" selected\x3d"selected"\x3e11\x3c/option\x3e\r\n                        \x3coption value\x3d"12" selected\x3d"selected"\x3e12\x3c/option\x3e\r\n                        \x3coption value\x3d"13" selected\x3d"selected"\x3e13\x3c/option\x3e\r\n                        \x3coption value\x3d"14" selected\x3d"selected"\x3e14\x3c/option\x3e\r\n                        \x3coption value\x3d"15" selected\x3d"selected"\x3e15\x3c/option\x3e\r\n                        \x3coption value\x3d"16" selected\x3d"selected"\x3e16\x3c/option\x3e\r\n                        \x3coption value\x3d"18" selected\x3d"selected"\x3e18\x3c/option\x3e\r\n                        \x3coption value\x3d"20" selected\x3d"selected"\x3e20\x3c/option\x3e\r\n                        \x3coption value\x3d"24" selected\x3d"selected"\x3e24\x3c/option\x3e\r\n                        \x3coption value\x3d"28" selected\x3d"selected"\x3e28\x3c/option\x3e\r\n                        \x3coption value\x3d"32" selected\x3d"selected"\x3e32\x3c/option\x3e\r\n                        \x3coption value\x3d"36" selected\x3d"selected"\x3e36\x3c/option\x3e\r\n                        \x3coption value\x3d"40" selected\x3d"selected"\x3e40\x3c/option\x3e\r\n                      \x3c/select\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                      \x3cdiv class\x3d"rendererLabelsFontButton"\x3e\r\n                        \x3cbutton dojoAttachPoint\x3d"_rendererLabelsFontBoldButton" dojotype\x3d"dijit.form.ToggleButton" type\x3d"button" dojoAttachEvent\x3d"onClick:_onClickRendererLabelsFontBold"\x3e\r\n                          \x3cspan style\x3d"font-weight: bold;"\x3e${i18n.boldAbbr}\x3c/span\x3e\r\n                        \x3c/button\x3e\r\n                      \x3c/div\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                      \x3cdiv class\x3d"rendererLabelsFontButton"\x3e\r\n                        \x3cbutton dojoAttachPoint\x3d"_rendererLabelsFontItalicButton"  dojotype\x3d"dijit.form.ToggleButton" type\x3d"button" dojoAttachEvent\x3d"onClick:_onClickRendererLabelsFontItalic"\x3e\r\n                          \x3cspan style\x3d"font-style: italic;"\x3e${i18n.italicAbbr}\x3c/span\x3e\r\n                        \x3c/button\x3e\r\n                      \x3c/div\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                      \x3cdiv class\x3d"rendererLabelsFontButton"\x3e\r\n                        \x3cbutton dojoAttachPoint\x3d"_rendererLabelsFontUnderlineButton" dojotype\x3d"dijit.form.ToggleButton" type\x3d"button" dojoAttachEvent\x3d"onClick:_onClickRendererLabelsFontUnderline"\x3e\r\n                          \x3cspan style\x3d"text-decoration: underline;"\x3e${i18n.underlineAbbr}\x3c/span\x3e\r\n                        \x3c/button\x3e\r\n                      \x3c/div\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                      \x3cdiv dojoAttachPoint\x3d"_rendererLabelsTextColor" dojoAttachEvent\x3d"onClick:_onClickRendererLabelsTextColor" class\x3d"RendererLabelsTextColorBox"\x3e\x3c/div\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                \x3c/table\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr id\x3d"rendererLabelsHaloSection"\x3e\r\n              \x3ctd\x3e\r\n                \x26nbsp;\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3ctable\x3e\r\n                  \x3ctr\x3e\r\n                    \x3ctd colspan\x3d"2"\x3e\r\n                      \x3cinput dojoAttachPoint\x3d"_rendererLabelsHaloCheck" dojotype\x3d"dijit.form.CheckBox"  dojoAttachEvent\x3d"onChange:_onChangeRendererLabelsHaloCheck" value\x3d"off" type\x3d"checkbox" /\x3e\r\n                      \x3clabel\x3e\r\n                        ${i18n.halo}\r\n                      \x3c/label\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                      \x26nbsp;\x26nbsp;\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                      \x3ctable style\x3d"padding: 5px 0"\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cselect class\x3d"rendererInput" class\x3d"calcite light" style\x3d"padding-right: 5px;" dojoAttachPoint\x3d"_rendererLabelsHaloSizes" dojoAttachEvent\x3d"onChange:_onChangeRendererLabelsHaloSize" dojoType\x3d"dijit.form.Select"\x3e\r\n                              \x3coption value\x3d"1" selected\x3d"selected"\x3e1\x3c/option\x3e\r\n                              \x3coption value\x3d"2"\x3e2\x3c/option\x3e\r\n                              \x3coption value\x3d"3"\x3e3\x3c/option\x3e\r\n                              \x3coption value\x3d"4"\x3e4\x3c/option\x3e\r\n                              \x3coption value\x3d"5"\x3e5\x3c/option\x3e\r\n                              \x3coption value\x3d"6"\x3e6\x3c/option\x3e\r\n                              \x3coption value\x3d"7"\x3e7\x3c/option\x3e\r\n                              \x3coption value\x3d"8"\x3e8\x3c/option\x3e\r\n                              \x3coption value\x3d"9"\x3e9\x3c/option\x3e\r\n                              \x3coption value\x3d"10"\x3e10\x3c/option\x3e\r\n                            \x3c/select\x3e\r\n                          \x3c/td\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cdiv dojoAttachPoint\x3d"_rendererLabelsHaloColor" dojoAttachEvent\x3d"onClick:_onClickRendererLabelsHaloColor" class\x3d"RendererLabelsTextColorBox"\x3e\x3c/div\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                      \x3c/table\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                \x3c/table\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr dojoAttachPoint\x3d"_rendererLabelsAlignmentSectionTitle" style\x3d"display:none;"\x3e\r\n              \x3ctd nowrap colspan\x3d"2"\x3e\r\n                \x3cdiv style\x3d"padding: 10px 0 5px 0;"\x3e\r\n                  \x3clabel\x3e\r\n                    ${i18n.alignmentLabel}\r\n                  \x3c/label\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr dojoAttachPoint\x3d"_rendererLabelsAlignmentSectionPoint" style\x3d"display:none;"\x3e\r\n              \x3ctd nowrap\x3e\r\n                \x26nbsp;\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cdiv dojoAttachPoint\x3d"_rendererLabelsAlignment" dojotype\x3d"esri.dijit.FontAlignment"\x3e\x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr dojoAttachPoint\x3d"_rendererLabelsAlignmentSectionLine" style\x3d"display:none;"\x3e\r\n              \x3ctd nowrap\x3e\r\n                \x26nbsp;\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cdiv\x3e\r\n                  \x3cdiv\x3e\r\n                    \x3cinput type\x3d"radio" name\x3d"linePlacement" dojotype\x3d"dijit.form.RadioButton" dojoAttachPoint\x3d"_rendererLabelsAlignmentLineAbove" checked\x3d"checked" dojoAttachEvent\x3d"onClick:_onRendererLabelsAlignmentLineChange"/\x3e\r\n                    \x3clabel for\x3d"linePlacement:above"\x3e\r\n                      ${i18n.aboveLine}\r\n                    \x3c/label\x3e\r\n                  \x3c/div\x3e\r\n                  \x3cdiv\x3e\r\n                    \x3cinput type\x3d"radio" name\x3d"linePlacement" dojotype\x3d"dijit.form.RadioButton" dojoAttachPoint\x3d"_rendererLabelsAlignmentLineOn" dojoAttachEvent\x3d"onClick:_onRendererLabelsAlignmentLineChange" /\x3e\r\n                    \x3clabel for\x3d"linePlacement:on"\x3e\r\n                      ${i18n.onLine}\r\n                    \x3c/label\x3e\r\n                  \x3c/div\x3e\r\n                  \x3cdiv\x3e\r\n                    \x3cinput type\x3d"radio" name\x3d"linePlacement" dojotype\x3d"dijit.form.RadioButton" dojoAttachPoint\x3d"_rendererLabelsAlignmentLineBelow" dojoAttachEvent\x3d"onClick:_onRendererLabelsAlignmentLineChange" /\x3e\r\n                    \x3clabel for\x3d"linePlacement:below"\x3e\r\n                      ${i18n.belowLine}\r\n                    \x3c/label\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"padding:10px 0 3px 0;"\x3e\r\n        \x3cdiv id\x3d"rendererSimpleApply" class\x3d"esriFloatTrailing"\x3e\r\n          \x3cbutton dojotype\x3d"dijit.form.Button" class\x3d"calcite blue" type\x3d"button" dojoAttachEvent\x3d"onClick:_onOK"\x3e\r\n            \x3cspan\x3e${i18n.ok}\x3c/span\x3e\r\n          \x3c/button\x3e\r\n          \x3cbutton dojotype\x3d"dijit.form.Button" class\x3d"calcite transparent" type\x3d"button" dojoAttachEvent\x3d"onClick:_onCancel"\x3e\r\n            \x3cspan\x3e${i18n.cancel}\x3c/span\x3e\r\n          \x3c/button\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"rendererLabelsContentFooter" dojoType\x3d"dijit.layout.ContentPane" region\x3d"bottom" style\x3d"height:40px; padding: 0 5px 0 5px; display:none;"\x3e\r\n    \x3cdiv class\x3d"footer" id\x3d"rendererLabelsFooter" dojotype\x3d"arcgisonline.sharing.dijit.SiteFooterMap" style\x3d"white-space:normal;"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv dojoAttachPoint\x3d"textColorTooltip" dojotype\x3d"dijit.TooltipDialog" title\x3d"" style\x3d"display:none; width:265px;"\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing"\x3e\x3cA class\x3d"textColorPaletteClose" dojoAttachPoint\x3d"textColorTooltipClose" href\x3d"JavaScript:void(0);" title\x3d"${i18n.close}"\x3e\x3c/A\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"textColorPalette" style\x3d"margin-top: 7px;" dojotype\x3d"dijit.ColorPalette" palette\x3d"7x10" dojoAttachEvent\x3d"onChange:_onColorSelection"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv dojoAttachPoint\x3d"haloColorTooltip" dojotype\x3d"dijit.TooltipDialog" title\x3d"" style\x3d"display:none; width:265px;"\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing"\x3e\x3cA class\x3d"textColorPaletteClose" dojoAttachPoint\x3d"haloColorTooltipClose" href\x3d"JavaScript:void(0);" title\x3d"${i18n.close}"\x3e\x3c/A\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"haloColorPalette" style\x3d"margin-top: 7px;" dojotype\x3d"dijit.ColorPalette" palette\x3d"7x10" dojoAttachEvent\x3d"onChange:_onHaloColorSelection"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e\r\n',
_rConnects:null,i18n:null,disableAllEvents:!0,container:null,subLayerId:null,mapLayer:null,layer:null,originalLabelingInfo:null,originalShowLabels:null,labelingInfo:null,textSymbol:null,defaultTextSymbol:{type:"esriTS",color:[51,51,51,255],backgroundColor:null,borderLineColor:null,rightToLeft:!1,angle:0,xoffset:0,yoffset:0,kerning:!0,font:{family:"Arial",size:9.75,style:"normal",weight:"bold",decoration:"none"}},_dateFormats:[{value:'{"dateFormat":"shortDate", "timezone":"utc"}',label:"12/21/1997"},
{value:'{"dateFormat":"longMonthDayYear", "timezone":"utc"}',label:"December 21, 1997"},{value:'{"dateFormat":"dayShortMonthYear", "timezone":"utc"}',label:"21 Dec 1997"},{value:'{"dateFormat":"longDate", "timezone":"utc"}',label:"Sunday, December 21, 1997"},{value:'{"dateFormat":"shortDateShortTime", "timezone":"utc"}',label:"12/21/1997 6:00 PM"},{value:'{"dateFormat":"shortDateShortTime24", "timezone":"utc"}',label:"12/21/1997 18:00"},{value:'{"dateFormat":"longMonthYear", "timezone\':"utc"}',label:"December 1997"},
{value:'{"dateFormat":"shortMonthYear", "timezone":"utc"}',label:"Dec 1997"},{value:'{"dateFormat":"year", "timezone":"utc"}',label:"1997"},{value:'{"dateFormat":"shortDateLE", "timezone":"utc"}',label:"21/12/1997"},{value:'{"dateFormat":"shortDateLEShortTime", "timezone":"utc"}',label:"21/12/1997 6:00 PM"},{value:'{"dateFormat":"shortDateLEShortTime24", "timezone":"utc"}',label:"21/12/1997 18:00"}],_numberFormats:[{value:'{"places":0, "digitSeparator":true}',label:"0 decimal places"},{value:'{"places":1, "digitSeparator":true}',
label:"1 decimal place"},{value:'{"places":2, "digitSeparator":true}',label:"2 decimal places"},{value:'{"places":3, "digitSeparator":true}',label:"3 decimal places"},{value:'{"places":4, "digitSeparator":true}',label:"4 decimal places"},{value:'{"places":5, "digitSeparator":true}',label:"5 decimal places"},{value:'{"places":6, "digitSeparator":true}',label:"6 decimal places"}],_labelPlacementLookupPoint:{"top,center":"esriServerPointLabelPlacementBelowCenter","top,left":"esriServerPointLabelPlacementBelowRight",
"top,right":"esriServerPointLabelPlacementBelowLeft","baseline,center":"esriServerPointLabelPlacementAboveCenter","baseline,left":"esriServerPointLabelPlacementAboveRight","baseline,right":"esriServerPointLabelPlacementAboveLeft","middle,center":"esriServerPointLabelPlacementCenterCenter","middle,left":"esriServerPointLabelPlacementCenterRight","middle,right":"esriServerPointLabelPlacementCenterLeft"},_labelPlacementLookupLine:{"top,center":"esriServerLinePlacementAboveAlong","baseline,center":"esriServerLinePlacementBelowAlong",
"middle,center":"esriServerLinePlacementCenterAlong"},constructor:function(a,b){a&&(a.containerNode&&(this.container=a.containerNode),this.subLayerId=a.subLayerId,this.mapLayer=a.mapLayer,this.isFeatCol=arcgisonline.map.featColl.isFeatureCollection(this.mapLayer),this.isCSV=this.mapLayer.layer instanceof esri.layers.CSVLayer,this.hasDynamic=arcgisonline.map.main.hasDynamicLayers(this.mapLayer),this._rConnects=[])},destroy:function(){f.popup.close(this.textColorTooltip);b.forEach(this._rConnects,b.disconnect);
delete this._rConnects;this.inherited(arguments)},postMixInProperties:function(){this.inherited(arguments);this.i18n=b.clone(b.i18n.getLocalization("arcgisonline","arcgisonline").common);b.mixin(this.i18n,b.i18n.getLocalization("arcgisonline","arcgisonline").generalDlg);b.mixin(this.i18n,b.i18n.getLocalization("arcgisonline","arcgisonline").rendererPanel);b.mixin(this.i18n,b.i18n.getLocalization("arcgisonline","arcgisonline").rendererLabelsPanel)},postCreate:function(){this.container.addChild(f.byId("rendererLabelsPanel"));
this.loadConnections()},loadConnections:function(){this._rConnects.push(b.connect(f.byId("leftContentPanel"),"resize",this,"adjustHeight"));this._rConnects.push(b.connect(this.textColorTooltipClose,"onclick",b.hitch(this,function(a){a.preventDefault();f.popup.close(this.textColorTooltip)})));this._rConnects.push(b.connect(this.haloColorTooltipClose,"onclick",b.hitch(this,function(a){a.preventDefault();f.popup.close(this.haloColorTooltip)})));this._rConnects.push(b.connect(this._rendererLabelsAlignment,
"onchange",b.hitch(this,"_onChangeRendererLabelsAlignment")));this._rConnects.push(b.connect(this._rendererLabelsTextInput,"onChange",b.hitch(this,"_onChangeRendererLabelsText")));this._rConnects.push(b.connect(this._closeBtn,"onclick",this,"_onCancel"))},startup:function(){this.inherited(arguments);isEmbedded||b.style(b.byId("rendererLabelsContentFooter"),"display","");this._init()},_init:function(){10>b.isIE&&b.style(b.byId("rendererLabelsHaloSection"),"display","none");this._rendererLabelsLayerName.innerHTML=
arcgisonline.map.main.getLayerTitle(this.mapLayer,this.subLayerId);this.isHosted=!1;this.mapLayer.layer instanceof esri.layers.GeoRSSLayer?(-1==this.subLayerId&&(this.subLayerId=0),this.layer=this.mapLayer.layer.getFeatureLayers()[this.subLayerId]):this.mapLayer.layer?(this.layer=this.mapLayer.layer,this.isHosted=arcgisonline.sharing.util.isHostedService(this.layer.url)):this.layer=this.mapLayer.layers[this.subLayerId];this.geometryType=this.layer.geometryType;this.hasDynamic&&(this.geometryType=
this.serviceLayerInfo.geometryType);"esriGeometryPolygon"===this.geometryType?(b.style(this._rendererLabelsAlignmentSectionTitle,"display","none"),b.style(this._rendererLabelsAlignmentSectionPoint,"display","none"),b.style(this._rendererLabelsAlignmentSectionLine,"display","none")):"esriGeometryPoint"===this.geometryType?(b.style(this._rendererLabelsAlignmentSectionTitle,"display",""),b.style(this._rendererLabelsAlignmentSectionPoint,"display",""),b.style(this._rendererLabelsAlignmentSectionLine,
"display","none")):(b.style(this._rendererLabelsAlignmentSectionTitle,"display",""),b.style(this._rendererLabelsAlignmentSectionPoint,"display","none"),b.style(this._rendererLabelsAlignmentSectionLine,"display",""));this.labelingInfo=this.layer.labelingInfo;this.originalLabelingInfo=null;this.labelingInfo&&(this.originalLabelingInfo=b.map(this.labelingInfo,function(a){return new esri.layers.LabelClass(b.clone(a.toJson()))}));this.originalShowLabels=this.mapLayer.showLabels;this.isFeatCol&&this.mapLayer.itemId&&
(this.originalShowLabels=arcgisonline.map.labels.hasLayer(this.layer));this._rendererLabelsTextInput.set("value",this._formatToken(this._displayField));this.createFieldInfosStore();this._fieldsSelect=new f.form.MultiSelect({style:"width:200px;"});this._loadSelect(null,!0);b.connect(this._fieldsSelect,"onChange",b.hitch(this,"_onFieldsSelectChange"));new arcgisonline.map.dijit.DropDownButton({showLabel:!1,dropDown:this._fieldsSelect,"class":"calcite transparent tiny noArrow"},this._rendererLabelsTextButton);
if(this.labelingInfo){this.labelingClass=this.labelingInfo[0];if(!this.labelingClass.labelExpressionInfo||!this.labelingClass.labelExpressionInfo.value){var a=/^(\s*\[[^\]]+\]\s*)+$/i;this.labelingClass.labelExpression&&!a.test(this.labelingClass.labelExpression)&&(a=this.getDisplayField(),this.labelingClass.labelExpression="["+a+"]",this.labelingClass.labelExpressionInfo={value:"{"+a+"}"})}this.textSymbol=this.labelingClass.symbol;this._rendererLabelsTextInput.set("value",this.labelingClass.labelExpressionInfo?
this.labelingClass.labelExpressionInfo.value:this.labelingClass.labelExpression.replace(/\[/g,"{").replace(/\]/g,"}"));"esriGeometryPoint"===this.geometryType?this._rendererLabelsAlignment.setValue(esri.valueOf(this._labelPlacementLookupPoint,this.labelingClass.toJson().labelPlacement)):"esriGeometryPolyline"===this.geometryType&&(a=esri.valueOf(this._labelPlacementLookupLine,this.labelingClass.toJson().labelPlacement),"top,center"===a?(this._rendererLabelsAlignmentLineOn.set("checked",!1),this._rendererLabelsAlignmentLineBelow.set("checked",
!1),this._rendererLabelsAlignmentLineAbove.set("checked",!0)):"middle,center"===a?(this._rendererLabelsAlignmentLineAbove.set("checked",!1),this._rendererLabelsAlignmentLineBelow.set("checked",!1),this._rendererLabelsAlignmentLineOn.set("checked",!0)):(this._rendererLabelsAlignmentLineAbove.set("checked",!1),this._rendererLabelsAlignmentLineOn.set("checked",!1),this._rendererLabelsAlignmentLineBelow.set("checked",!0)));this.textSymbol.haloSize&&this.textSymbol.haloColor?(this._rendererLabelsHaloCheck.set("checked",
!0),this._rendererLabelsHaloSizes.set("value",this.textSymbol.haloSize),a=this.textSymbol.haloColor.toHex(),b.style(this._rendererLabelsHaloColor,"background",a)):(this._rendererLabelsHaloCheck.set("checked",!1),this._rendererLabelsHaloSizes.set("value",1),b.style(this._rendererLabelsHaloColor,"background","#FFFFFF"))}else this.textSymbol=new esri.symbols.TextSymbol(this.defaultTextSymbol),this._rendererLabelsTextInput.set("value","{"+this.getDisplayField()+"}"),"esriGeometryPoint"===this.geometryType?
this._rendererLabelsAlignment.setValue("baseline,left"):"esriGeometryPolyline"===this.geometryType&&this._rendererLabelsAlignmentLineAbove.set("checked",!0),this._rendererLabelsHaloCheck.set("checked",!1),this._rendererLabelsHaloSizes.set("value",1),b.style(this._rendererLabelsHaloColor,"background","#FFFFFF");this._rendererLabelsCheck.set("checked",!0);this._rendererLabelsFontSizes.set("value",""+Math.round(this.textSymbol.font.size));this._rendererLabelsFontBoldButton.set("checked",this.textSymbol.font.weight===
esri.symbol.Font.WEIGHT_BOLD);this._rendererLabelsFontItalicButton.set("checked",this.textSymbol.font.style===esri.symbol.Font.STYLE_ITALIC);this._rendererLabelsFontUnderlineButton.set("checked","underline"===this.textSymbol.font.decoration);b.style(this._rendererLabelsTextColor,"background",this.textSymbol.color.toHex());setTimeout(b.hitch(this,function(){this.disableAllEvents=!1;this._onSaveLabelingInfo()}),500)},getDisplayField:function(){if(this.layer.displayField)return this.layer.displayField;
for(var a=null,b=null,c=null,e=0;e<this.layer.fields.length;e++){var g=this.layer.fields[e];if("name"===g.name.toLowerCase())return g.name;if(!a&&-1<g.name.toLowerCase().indexOf("name"))a=g.name;else if(!b&&"esriFieldTypeString"===g.type)b=g.name;else if(!c&&("esriFieldTypeDouble"===g.type||"esriFieldTypeInteger"===g.type))c=g.name}return a?a:b?b:c?c:this.layer.fields[0].name},getPopupInfo:function(){this.popupInfo={};if(arcgisonline.map.featColl.isFeatureCollection(this.mapLayer)||this.layer instanceof
esri.layers.CSVLayer){if(this.mapLayer.layers)for(var a=0;a<this.mapLayer.layers.length;a++){if(a===this.subLayerId){this.popupInfo=this.mapLayer.layers[a].__popupInfo?this.mapLayer.layers[a].__popupInfo:this.mapLayer.layers[a].toJson().popupInfo;break}}else this.popupInfo=this.mapLayer.popupInfo?this.mapLayer.popupInfo:this.mapLayer.layer.toJson().popupInfo;this.popupInfo||(this.popupInfo={})}else-1==this.subLayerId&&(this.popupInfo=this.mapLayer.popupInfo?this.mapLayer.popupInfo:{})},createFieldInfosStore:function(){var a=
this.layer.fields;this.getPopupInfo();var d=this.popupInfo.fieldInfos;this.mapLayer.thematicGroup&&(this.mapLayer.thematicGroup.fieldNames&&this.mapLayer.thematicGroup.fieldNames.length)&&(a=b.filter(a,function(a){return b.some(this.mapLayer.thematicGroup.fieldNames,function(b){return b===a.name},this)},this));var c=[],e=0,g,p={esriFieldTypeDouble:1,esriFieldTypeSingle:1},f={esriFieldTypeInteger:1,esriFieldTypeSmallInteger:1},r={esriFieldTypeDate:1};d&&d.length?b.forEach(a,b.hitch(this,function(a,
s){if(b.some(d,b.hitch(this,function(b,c){e=c;return a.name===b.fieldName}))){g=d[e];var h=b.mixin({},g),h=b.mixin(h,{isEditable:!1===a.editable?!1:esri._isDefined(g.isEditable)?g.isEditable:a.editable});esri.isDefined(g.format)&&(h=b.mixin(h,{format:b.json.stringify(g.format)}));h.label=arcgisonline.sharing.util.htmlEncode(h.label||a.alias)+" {"+a.name+"}";var k=esri.isDefined(a.domain)?a.domain&&"codedvalue"==a.domain.type.toLowerCase():!1;c.push(b.mixin({_fieldType:a.type,_hasDomain:k,_pos:e,_inChart:!1},
h))}else{k=esri.isDefined(a.domain)?a.domain&&"codedvalue"==a.domain.type.toLowerCase():!1;h=null;k||(a.type in f?h=this._numberFormats[0].value:a.type in p?h=this._numberFormats[2].value:a.type in r&&10<=this.mapLayer.layer.version&&(h=this._dateFormats[4].value));var l="esriFieldTypeString"===a.type||k?"textbox":null;c.push({fieldName:a.name,label:arcgisonline.sharing.util.htmlEncode(a.alias)+" {"+a.name+"}",isEditable:a.editable||!1,tooltip:null,visible:!1,format:h,stringFieldOption:l,_fieldType:a.type,
_hasDomain:k,_pos:9999,_inChart:!1})}})):(c=[],b.forEach(a,b.hitch(this,function(a,d){var e=a.name.toLowerCase(),g=esri.isDefined(a.domain)?a.domain&&"codedvalue"==a.domain.type.toLowerCase():!1,l={subclass:0,rings_ok:0,rings_nok:0},m="esriFieldTypeOID"!==a.type&&"esriFieldTypeGlobalID"!==a.type&&"esriFieldTypeGeometry"!==a.type,m=(m=m&&!(e in l)&&!(-1<e.indexOf("area")||-1<e.indexOf("length")||-1<e.indexOf("perimeter")))&&e.lastIndexOf("_i",e.length-2)!==e.length-2,e=null;g||(a.type in f?e=this._numberFormats[0].value:
a.type in p?e=this._numberFormats[2].value:a.type in r&&10<=this.mapLayer.layer.version&&(e=this._dateFormats[4].value));l="esriFieldTypeString"===a.type||g?"textbox":null;c.push(b.mixin({},{fieldName:a.name,label:arcgisonline.sharing.util.htmlEncode(a.alias)+" {"+a.name+"}",isEditable:a.editable||!1,tooltip:null,visible:m,format:e,stringFieldOption:l,_pos:d,_inChart:!1,_hasDomain:g,_fieldType:a.type,_editable:a.editable}))})));this._fieldInfosStore=new n.data.AndOrWriteStore({data:{label:"label",
identifier:"fieldName",items:c}})},_loadSelect:function(a,d){this._fieldInfosStore.fetch({sort:[{attribute:"_pos",descending:!1}],onItem:b.hitch(this,function(a){var e=this._fieldInfosStore.getValue(a,"visible")||this._fieldInfosStore.getValue(a,"_visible");if("esriFieldTypeGeometry"!==this._fieldInfosStore.getValue(a,"_fieldType")&&(d||!0===e))e=b.create("option"),e.innerHTML=this._fieldInfosStore.getLabel(a),e.value=this._fieldInfosStore.getIdentity(a),this._fieldsSelect.containerNode.appendChild(e)}),
onComplete:b.hitch(this,function(b){esri.isDefined(a)&&this._fieldsSelect.set("value",[a])})})},_onFieldsSelectChange:function(a,d){this._getItemFromStore(this._fieldsSelect.get("value"),b.hitch(this,function(a){esriGeowConfig.isRightToLeft?this._rendererLabelsTextInput.set("value",this._formatToken(this._fieldInfosStore.getValue(a,"fieldName"))+this._rendererLabelsTextInput.get("value")):this._rendererLabelsTextInput.set("value",this._rendererLabelsTextInput.get("value")+this._formatToken(this._fieldInfosStore.getValue(a,
"fieldName")));this._fieldsSelect.set("value",-1,!1)}))},_getItemFromStore:function(a,b){this._fieldInfosStore.fetchItemByIdentity({identity:a,onItem:b})},_onSaveLabelingInfo:function(a){if("rendererLabelsStack"===arcgisonline.map.leftPanel.getLeftContentPanelStack())if(this._rendererLabelsCheck.get("checked")){a=this._rendererLabelsTextInput.get("value");a.split("{").length!==a.split("}").length&&(a="");var d="";0===a.indexOf("{")&&0===a.lastIndexOf("{")&&(d=a.replace(/\{/g,"[").replace(/\}/g,"]"));
a={labelExpression:d,labelExpressionInfo:{value:a},useCodedValues:!1,maxScale:0,minScale:0};for(var d=[],c=a.labelExpressionInfo.value.indexOf("{",c);-1<c;){var e=a.labelExpressionInfo.value.indexOf("}",c);d.push(a.labelExpressionInfo.value.substring(c+1,e));c=a.labelExpressionInfo.value.indexOf("{",e)}var g=arcgisonline.map.popup.getPopupInfo(this.mapLayer);g||(g=this.isFeatCol?arcgisonline.map.featColl.generateDefaultPopupInfo(this.layer.toJson()):arcgisonline.map.popup.getDefaultPopupInfo(this.mapLayer.serviceInfo,
!1,this.layer));var f=[],q=!1;b.forEach(d,function(a){var c=b.filter(g.fieldInfos,function(b){return b.fieldName===a});c.length&&(c=c[0],c.format&&(c.format.dateFormat||esri.isDefined(c.format.places)||esri.isDefined(c.format.digitSeparator))?(q=!0,f.push({fieldName:a,format:c.format})):f.push({fieldName:a}))});q&&(a.fieldInfos=f);c=new esri.layers.LabelClass(a);this.textSymbol.font.size=parseInt(this._rendererLabelsFontSizes.get("value"));this.textSymbol.font.weight=this._rendererLabelsFontBoldButton.get("checked")?
esri.symbol.Font.WEIGHT_BOLD:esri.symbol.Font.WEIGHT_NORMAL;this.textSymbol.font.style=this._rendererLabelsFontItalicButton.get("checked")?esri.symbol.Font.STYLE_ITALIC:esri.symbol.Font.STYLE_NORMAL;this.textSymbol.font.decoration=this._rendererLabelsFontUnderlineButton.get("checked")?"underline":"none";this._rendererLabelsHaloCheck.get("checked")?(a=b.style(this._rendererLabelsHaloColor,"backgroundColor"),this.textSymbol.setHaloColor(new b.Color(a)),this.textSymbol.setHaloSize(this._rendererLabelsHaloSizes.get("value"))):
(this.textSymbol.setHaloSize(0),this.textSymbol.setHaloColor(null));"esriGeometryPoint"===this.geometryType||"esriGeometryPolyline"===this.geometryType?"esriGeometryPoint"===this.geometryType?c.labelPlacement=this._labelPlacementLookupPoint[this._rendererLabelsAlignment.getValue()]:this._rendererLabelsAlignmentLineAbove.get("checked")?c.labelPlacement=this._labelPlacementLookupLine["top,center"]:this._rendererLabelsAlignmentLineOn.get("checked")?c.labelPlacement=this._labelPlacementLookupLine["middle,center"]:
c.labelPlacement=this._labelPlacementLookupLine["baseline,center"]:"esriGeometryPolygon"===this.geometryType&&(c.labelPlacement="esriServerPolygonPlacementAlwaysHorizontal");c.symbol=this.textSymbol;this.labelingInfo=[c];!this.isFeatCol&&!this.isCSV&&(this.mapLayer.showLabels=!0);this.layer.setLabelingInfo(this.labelingInfo);arcgisonline.map.labels.updateLabelsForLayer(this.layer)}else delete this.mapLayer.showLabels,arcgisonline.map.labels.removeLabelsForLayer(this.layer)},_onCancel:function(a){a.preventDefault();
this.originalLabelingInfo?this.layer.setLabelingInfo(this.originalLabelingInfo):this.layer.setLabelingInfo(null);this.originalShowLabels?this.mapLayer.showLabels=!0:delete this.mapLayer.showLabels;this.mapLayer.showLabels||(this.isFeatCol||this.isCSV)&&arcgisonline.map.labels.hasLayer(this.layer)?arcgisonline.map.labels.updateLabelsForLayer(this.layer):arcgisonline.map.labels.removeLabelsForLayer(this.layer);arcgisonline.map.leftPanel.openLeftTOCPanel()},_onOK:function(a){a.preventDefault();a=(this.originalLabelingInfo&&
this.originalLabelingInfo.length?b.toJson(this.originalLabelingInfo[0].toJson()):"")===(this.labelingInfo&&this.labelingInfo.length?b.toJson(this.labelingInfo[0].toJson()):"");if(!this.isFeatCol&&(!a||this.mapLayer.showLabels!==this.originalShowLabels)||this.isFeatCol&&this.mapLayer.itemId&&(!a||this.originalShowLabels!==arcgisonline.map.labels.hasLayer(this.layer)))this.mapLayer.rendererChanged=!0;arcgisonline.map.leftPanel.openLeftTOCPanel()},_onChangeRendererLabelsCheck:function(){this.disableAllEvents||
this._onSaveLabelingInfo()},_onChangeRendererLabelsText:function(){this.disableAllEvents||(this._rendererLabelsCheck.set("checked",!0),this._onSaveLabelingInfo())},_onChangeRendererLabelsFontSize:function(){this.disableAllEvents||(this._rendererLabelsCheck.set("checked",!0),this._onSaveLabelingInfo())},_onClickRendererLabelsFontBold:function(){this.disableAllEvents||(this._rendererLabelsCheck.set("checked",!0),this._onSaveLabelingInfo())},_onClickRendererLabelsFontItalic:function(){this.disableAllEvents||
(this._rendererLabelsCheck.set("checked",!0),this._onSaveLabelingInfo())},_onClickRendererLabelsFontUnderline:function(){this.disableAllEvents||(this._rendererLabelsCheck.set("checked",!0),this._onSaveLabelingInfo())},_onClickRendererLabelsTextColor:function(a){f.popup.open({popup:this.textColorTooltip,around:a.target})},_onColorSelection:function(a){f.popup.close(this.textColorTooltip);var d=new b.Color(a);b.style(this._rendererLabelsTextColor,"background",a);this.textSymbol.color.setColor(d.toRgba());
this._rendererLabelsCheck.set("checked",!0);this._onSaveLabelingInfo()},_onChangeRendererLabelsAlignment:function(){this.disableAllEvents||(this._rendererLabelsCheck.set("checked",!0),this._onSaveLabelingInfo())},_onRendererLabelsAlignmentLineChange:function(){this.disableAllEvents||(this._rendererLabelsCheck.set("checked",!0),setTimeout(b.hitch(this,function(){this._onSaveLabelingInfo()}),100))},_onChangeRendererLabelsHaloCheck:function(){this.disableAllEvents||(this._rendererLabelsCheck.set("checked",
!0),this._onSaveLabelingInfo())},_onChangeRendererLabelsHaloSize:function(){this.disableAllEvents||(this._rendererLabelsHaloCheck.set("checked",!0),this._rendererLabelsCheck.set("checked",!0),this._onSaveLabelingInfo())},_onClickRendererLabelsHaloColor:function(a){f.popup.open({popup:this.haloColorTooltip,around:a.target})},_onHaloColorSelection:function(a){f.popup.close(this.haloColorTooltip);b.style(this._rendererLabelsHaloColor,"background",new b.Color(a));this._rendererLabelsHaloCheck.set("checked",
!0);this._rendererLabelsCheck.set("checked",!0);this._onSaveLabelingInfo()},getAttributeStore:function(){var a=arcgisonline.map.table.getPopupInfo(this.mapLayer,this.mapLayer.layer instanceof esri.layers.FeatureLayer?null:this.subLayerId),d=function(b){if(a&&a.fieldInfos)for(var c=0;c<a.fieldInfos.length;c++){var d=a.fieldInfos[c];if(d.fieldName==b)return d.label}return null},c=this._getLayerFields(),c=b.filter(c,function(a){return"esriFieldTypeOID"!==a.type}),c=b.map(c,b.hitch(this,function(a,c){var f=
{name:a.name,alias:d(a.name)||a.alias||a.name,type:a.type};a.domain&&a.domain.codedValues&&(f.codedValues=b.json.stringify(a.domain.codedValues));return f})),c=c.sort(function(a,b){var c=(d(a.name)||a.alias||a.name).toLowerCase(),f=(d(b.name)||b.alias||b.name).toLowerCase();return c==f?0:c<f?-1:1});c.splice(0,0,{name:"percent-of-total",alias:"\x26lt;"+this.i18n.normalizedByPercent+"\x26gt;",type:"percent"});c.splice(0,0,{name:"none",alias:"\x26lt;"+this.i18n.normalizedByNone+"\x26gt;",type:"none"});
c.splice(0,0,{name:this.i18n.selectAField,alias:this.i18n.selectAField,type:"selectAField"});this.attributesStore=new n.data.AndOrWriteStore({data:{label:"alias",identifier:"name",items:c}})},_getLayerFields:function(){if(this.hasDynamic){var a=this.serviceLayerInfo.fields;return this.mapLayer.thematicGroup&&this.mapLayer.thematicGroup.fieldNames&&this.mapLayer.thematicGroup.fieldNames.length?b.filter(a,function(a){return b.some(this.mapLayer.thematicGroup.fieldNames,function(b){return b===a.name},
this)},this):a}return this.layer.fields},_formatToken:function(a){return a&&a.length?"{"+a+"}":""},adjustHeight:function(a){if(!("undefined"==typeof leftPanel||"rendererLabelsStack"!=leftPanel.visibleStack)){a=b.coords(b.byId("leftContentStackContainer")).h;var d=b.coords(b.byId("rendererLabelsHeader")).h,c=b.coords(b.byId("rendererLabelsFooter_links")).h+10;b.style(b.byId("rendererLabelsFooter"),"height",c+"px");a=a-d-c-23;0<a&&b.style(b.byId("rendererLabelsPane"),"height",a+"px")}},getMarkerJson:function(){var a=
this.markerJson;a.url=arcgisonline.sharing.util.getRedSphereUrl();return a},_checkSymbol:function(a,d){if("simplemarkersymbol"!==a.type&&"simplelinesymbol"!==a.type&&"simplefillsymbol"!==a.type||!a.color)return a;var c=a.color.toRgba();if(0===c[3]&&(!a.outline||a.outline&&(0===a.outline.width||a.outline.color&&0===a.outline.color.toRgba()[3])))d?0===d.color.toRgba()[3]&&(!d.outline||d.outline&&(0===d.outline.width||d.outline.color&&0===d.outline.color.toRgba()[3]))?a.setColor(new b.Color([c[0],c[1],
c[2],1])):a=d:a.setColor(new b.Color([c[0],c[1],c[2],1]));return a}})});