// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("../../core/declare dojo/_base/lang dojo/_base/array dojo/promise/all dojo/has ../../kernel".split(" "),function(f,d,g,h,k,l){var e=f(null,{constructor:function(a){d.mixin(this,a)},fetchData:function(){this._portal=this.parent._portal;this._user=this._portal.getPortalUser();var a;return this._fetchGroups().then(d.hitch(this,function(b){a=g.map(b||[],function(a){if(a)return'group:"'+a.id+'"'}).join(" OR ");return this._fetchGroupItems(a)}))},_fetchGroup:function(a,b){this._groups=this._groups||
[];return this._groups[a]||this._portal.queryGroups(b,!0).then(d.hitch(this,function(b){0<b.total&&b.results&&(this._groups[a]=b.results);return this._groups[a]||[]}))},_fetchGroupItems:function(a,b){var c='(type:"Map Service" OR type:"Feature Service") typekeywords:"Analysis Ready" ('+a+")"+(b?" "+b:"");this._portal.user.demographics||(c+=' -typekeywords:"Requires Credits"');return this.parent._fetchItems(c)},_fetchGroups:function(){return this._fetchEsriAnalysisLayers()},_fetchEsriAnalysisLayers:function(){var a;
a=this._portal&&this._portal.region||this._portal.user&&this._portal.user.region||this._portal.ipCntryCode||"US";return this._fetchGroup("esriAnalysisLayers",{q:"WO"===a?'title:"Featured Maps And Apps" AND owner:esri':'(title:"Featured Maps And Apps" AND owner:esri) OR (tags:"gallery" AND owner:"Esri_cy_'+a+'")',num:100,start:0}).then(d.hitch(this,function(a){return a}))}});d.mixin(e,{add:function(a,b){if(!a.plugIn){var c=b||{};c.parent=a;a.plugIn=new e(c)}},remove:function(a){a.plugIn&&(a.plugIn.destroy(),
delete a.plugIn)}});return e});