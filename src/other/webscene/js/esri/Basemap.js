// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("./core/declare dojo/_base/lang dojo/_base/array dojo/Deferred ./core/Collection ./core/Accessor ./core/Evented ./core/Promise ./core/urlUtils ./layers/ArcGISTiledLayer ./layers/ArcGISElevationLayer ./layers/OpenStreetMapLayer ./layers/WebTiledLayer ./layers/VectorTiledLayer".split(" "),function(n,f,l,p,g,q,r,s,c,h,t,u,v,w){var x=0,k=n([q,r,s],{declaredClass:"esri.Basemap",constructor:function(){this.id=Date.now().toString(16)+"-basemap-"+x++;this._lyrLoadHandler=this._lyrLoadHandler.bind(this);
this._dfd=new p;this.addResolvingPromise(this._dfd.promise)},getDefaults:function(){return f.mixin(this.inherited(arguments),{baseLayers:[],referenceLayers:[],elevationLayers:[]})},_baseLayersSetter:function(a){this._baseLayers?(this._baseLayers.clear(),this._baseLayers.addItems(a)):this._baseLayers=new g(a);return this._baseLayers},_elevationLayers:null,_elevationLayersSetter:function(a){this._elevationLayers?(this._elevationLayers.clear(),this._elevationLayers.addItems(a)):this._elevationLayers=
new g(a);return this._elevationLayers},initialExtent:null,_referenceLayersSetter:function(a){this._referenceLayers?(this._referenceLayers.clear(),this._referenceLayers.addItems(a)):this._referenceLayers=new g(a);return this._referenceLayers},spatialReference:null,title:null,visible:!0,load:function(){var a=function(a){a.then(this._lyrLoadHandler)};this.elevationLayers.forEach(a,this);this.baseLayers.forEach(a,this);this.referenceLayers.forEach(a,this);return this._dfd.promise},_lyrLoadHandler:function(a){var b=
this.baseLayers.length,c=this.baseLayers.indexOf(a),d=this.elevationLayers.indexOf(a),e=null;0===c?e=a:0===b&&0===d&&(e=a);e&&(this.initialExtent=e.initialExtent.clone(),this.spatialReference=e.initialExtent.spatialReference.clone(),this.tileInfo=e.tileInfo?e.tileInfo.clone():null,this.emit("load",{target:this}),this._dfd.resolve(this))}}),m=function(a){var b={};null!=a.id&&(b.id=a.id);null!=a.opacity&&(b.opacity=a.opacity);null!=a.visibility&&(b.visible=a.visibility);null!=a.minScale&&(b.minScale=
a.minScale);null!=a.maxScale&&(b.maxScale=a.maxScale);null!=a.exclusionAreas&&(b.exclusionAreas=f.clone(a.exclusionAreas));null!=a.showLegend&&(b.showLegend=a.showLegend);null!=a.copyright&&(b.copyright=a.copyright);if(a.layerType)switch(a.layerType){case "OpenStreetMap":a=new u(b);break;case "ArcGISTiledElevationServiceLayer":b.url=c.normalize(a.url);a=new t(b);break;case "WebTiledLayer":b.urlTemplate=c.normalize(a.templateUrl||a.urlTemplate);b.subDomains=a.subDomains;a=new v(b);break;case "ArcGISTiledMapServiceLayer":b.url=
c.normalize(a.url);a=new h(b);break;case "ArcGISTiledImageServiceLayer":b.url=c.normalize(a.url);a=new h(b);break;case "VectorTiledLayer":b.url=c.normalize(a.url);b.styleUrl=a.styleUrl;b.styles=a.styles;a=new w(b);break;default:throw Error(f.replace('Unknown basemap layer type: "{type}" found in basemap definition.',{type:a.layerType}));}else b.url=c.normalize(a.url),a=new h(b);return a};k.fromJSON=function(a){var b=[],c=[];l.forEach(a.baseMapLayers,function(a){var d=m(a);a.isReference?c.push(d):
b.push(d)});var d=l.map(a.elevationLayers,function(a){a.layerType||(a.layerType="ArcGISTiledElevationServiceLayer");return m(a)}),d={baseLayers:b,referenceLayers:c,elevationLayers:d};null!=a.title&&(d.title=a.title);null!=a.id&&(d.id=a.id);return new k(d)};return k});