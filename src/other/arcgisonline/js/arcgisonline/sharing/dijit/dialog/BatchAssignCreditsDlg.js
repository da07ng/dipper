// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
require({cache:{"url:arcgisonline/sharing/dijit/dialog/templates/BatchAssignCreditsDlg.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"${baseClass} batch-assign-group-dialog" data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"_dialog"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/layout/StackContainer" data-dojo-attach-point\x3d"_stackContainer"\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-attach-point\x3d"_stackSelectUsers" class\x3d"select-users-stack"\x3e\r\n        \x3cdiv class\x3d"stepHeader"\x3e\r\n          \x3cdiv class\x3d"esriFloatLeading stepSprite step1"\x3e\x26nbsp;\x3c/div\x3e\x26nbsp;\x26nbsp;\r\n          \x3cdiv class\x3d"stepMessageContainer"\x3e\r\n            \x3cdiv class\x3d"stepMessage" data-dojo-attach-point\x3d"_step1Message"\x3e\x3cstrong\x3e${i18n.step1}\x3c/strong\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv data-dojo-attach-point\x3d"_userSelectContainer"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_userSelector" data-dojo-type\x3d"arcgisonline/sharing/dijit/OrgUserSelector"\r\n            data-dojo-props\x3d"enableListActions:true"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cbr\x3e\r\n\r\n        \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n          \x3cbutton class\x3d"calcite blue small" type\x3d"button" data-dojo-type\x3d"dijit/form/Button"\r\n            data-dojo-attach-point\x3d"_selectUsersNext"\x3e${i18n.next}\x3c/button\x3e\r\n          \x3cbutton class\x3d"calcite transparent small" type\x3d"button" data-dojo-type\x3d"dijit/form/Button"\r\n            data-dojo-attach-point\x3d"_selectUsersClose"\x3e${i18n.cancel}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n        \x3cbr class\x3d"clearBreak"\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-attach-point\x3d"_stackSelectCredits" class\x3d"select-credits-stack"\x3e\r\n        \x3cdiv class\x3d"stepHeader"\x3e\r\n          \x3cdiv class\x3d"esriFloatLeading stepSprite step2"\x3e\x26nbsp;\x3c/div\x3e\x26nbsp;\x26nbsp;\r\n          \x3cdiv class\x3d"stepMessageContainer"\x3e\r\n            \x3cdiv class\x3d"stepMessage" data-dojo-attach-point\x3d"_step2Message"\x3e\x3cstrong\x3e${i18n.step2}\x3c/strong\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"marginTop1" data-dojo-attach-point\x3d"_summaryContainer"\x3e\r\n          \x3ctable class\x3d"marginTop1" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n            \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd class\x3d"column270"\x3e\r\n                \x3clabel data-dojo-attach-point\x3d"_currentCreditTotal"\x3e\x3c/label\x3e\x3cbr\x3e\x3cbr\x3e\r\n                \x3clabel\x3e${i18n.allocateCredits}\x3c/label\x3e\x3cbr\x3e\x3cbr\x3e\r\n                \x3cspan class\x3d"esriLeadingPadding05"\x3e\r\n                  \x3cinput type\x3d"radio" id\x3d"setAllocation-${baseClass}" name\x3d"allocation"\r\n                         data-dojo-attach-point\x3d"_setAllocationRadioBtn" data-dojo-type\x3d"dijit/form/RadioButton"\x3e\r\n                  \x3clabel for\x3d"setAllocation-${baseClass}"\x3e${i18n.allocateCreditsSet}\x3c/label\x3e\r\n                  \x3cinput type\x3d"text" data-dojo-attach-point\x3d"_credits" class\x3d"creditEntry" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"trim:true"\x3e\r\n                \x3c/span\x3e\r\n                \x3cbr\x3e\x3cbr\x3e\r\n                \x3cspan class\x3d"esriLeadingPadding05"\x3e\r\n                  \x3cinput type\x3d"radio" id\x3d"setUnlimited-${baseClass}" name\x3d"allocation"\r\n                         data-dojo-attach-point\x3d"_setUnlimitedRadioBtn" data-dojo-type\x3d"dijit/form/RadioButton"\x3e\r\n                  \x3clabel for\x3d"setUnlimited-${baseClass}" data-dojo-attach-point\x3d"_unlimitedCreditsLabel"\x3e\x3c/label\x3e\r\n                \x3c/span\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd class\x3d"column10"\x3e\x3c/td\x3e\r\n              \x3ctd class\x3d"column270"\x3e\r\n                \x3cdiv class\x3d"listLabel"\x3e\r\n                  \x3cdiv data-dojo-attach-point\x3d"_userListLabel"\x3e${i18n.selectedUsers}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"listContainer" data-dojo-type\x3d"dijit/layout/BorderContainer"\r\n                     data-dojo-props\x3d"gutters:false,splitters:false,design:\'headline\'"\x3e\r\n                  \x3cdiv class\x3d"listInnerContainer"\r\n                       data-dojo-type\x3d"dijit/layout/ContentPane"\r\n                       data-dojo-props\x3d"region:\'middle\',splitter:false"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_selectedUsersPane"\x3e\r\n                      \x3c!-- selected user list is populated here --\x3e\r\n                    \x3c/div\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n          \x3c/div\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n          \x3cbutton class\x3d"calcite default small hoverWhite" type\x3d"button" data-dojo-type\x3d"dijit/form/Button"\r\n                  data-dojo-attach-point\x3d"_summaryBack"\x3e${i18n.back}\x3c/button\x3e\r\n          \x3cbutton class\x3d"calcite green small" type\x3d"button" data-dojo-type\x3d"dijit/form/Button"\r\n                  data-dojo-attach-point\x3d"_summaryAssign"\x3e${i18n.assign}\x3c/button\x3e\r\n          \x3cbutton class\x3d"calcite transparent small" type\x3d"button" data-dojo-type\x3d"dijit/form/Button"\r\n                  data-dojo-attach-point\x3d"_summaryClose"\x3e${i18n.cancel}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n        \x3cbr style\x3d"clear:both;"\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-attach-point\x3d"_stackResultSummary" class\x3d"result-summary-stack"\x3e\r\n        \x3cdiv class\x3d"stepHeader"\x3e\r\n          \x3cdiv class\x3d"esriFloatLeading stepSprite step4"\x3e\x26nbsp;\x3c/div\x3e\x26nbsp;\x26nbsp;\r\n          \x3cdiv class\x3d"stepMessageContainer"\x3e\r\n            \x3cdiv class\x3d"stepMessage" data-dojo-attach-point\x3d"_step3Message"\x3e\x3cstrong\x3e${i18n.assignmentComplete}\x3c/strong\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"resultSummary"\x3e\r\n          \x3cdiv class\x3d"resultScroll" data-dojo-attach-point\x3d"_resultMessage"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"marginTop1"\x3e\x3clabel\x3e${i18n.continueAssignment}\x3c/label\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n          \x3cbutton class\x3d"calcite blue small" type\x3d"button" data-dojo-type\x3d"dijit/form/Button"\r\n                  data-dojo-attach-point\x3d"_resultAssign"\x3e${i18n.assignMore}\x3c/button\x3e\r\n          \x3cbutton class\x3d"calcite default small hoverWhite" type\x3d"button" data-dojo-type\x3d"dijit/form/Button"\r\n                  data-dojo-attach-point\x3d"_resultClose"\x3e${i18n.done}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n        \x3cbr style\x3d"clear:both;"\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n'}});
define("arcgisonline/sharing/dijit/dialog/BatchAssignCreditsDlg","require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/number dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/sniff dojo/on dijit/a11yclick dojo/mouse dojo/topic dojo/Deferred dojo/promise/all dojo/store/Memory dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/Dialog dijit/layout/BorderContainer dijit/layout/StackContainer dijit/layout/ContentPane dijit/form/Button dijit/form/RadioButton dijit/form/FilteringSelect dijit/form/TextBox dijit/form/NumberTextBox dijit/Tooltip esri/lang arcgisonline/sharing/util arcgisonline/sharing/dijit/OrgUserSelector arcgisonline/sharing/dijit/GroupSelector dojo/i18n!arcgisonline/nls/arcgisonline dojo/text!arcgisonline/sharing/dijit/dialog/templates/BatchAssignCreditsDlg.html".split(" "),
function(A,B,e,m,n,q,c,v,w,x,C,l,D,E,J,y,K,F,G,H,L,M,N,O,P,Q,R,S,T,r,s,p,U,V,t,I){var u=B("arcgisonline.sharing.dijit.dialog.BatchAssignCreditsDlg",[F,G,H],{declaredClass:"arcgisonline.sharing.dijit.dialog.BatchAssignCreditsDlg",baseClass:"esriBatchAssignToGroups",basePath:A.toUrl("arcgisonline/sharing/dijit/dialog"),templateString:I,widgetsInTemplate:!0,_tooltips:[],_maxUsers:500,constructor:function(a){a&&s.isDefined(a.initialUserSearch)&&this._set("initialUserSearch",a.initialUserSearch)},postMixInProperties:function(){this.inherited(arguments);
this.i18n=e.mixin({},t.common);e.mixin(this.i18n,t.batchAssignToGroupsDlg);e.mixin(this.i18n,t.batchAssignCreditsDlg)},postCreate:function(){this.inherited(arguments);this._setupConnections()},startup:function(){this.inherited(arguments)},_setupConnections:function(){var a=e.hitch(this,this.hide),b=e.hitch(this,this._handleRadioClick);this.own(l(this._selectUsersNext,e.hitch(this,this._selectCreditsClick)),l(this._selectUsersClose,a),l(this._summaryBack,e.hitch(this,this._backToSelectUsersClick)),
l(this._summaryAssign,e.hitch(this,this._assignClick)),l(this._summaryClose,a),l(this._resultAssign,e.hitch(this,this._assignMoreClick)),l(this._resultClose,e.hitch(this,this._resultCloseClick)),this._userSelector.on("selection-change",e.hitch(this,this._selectUsersChange)),this._setAllocationRadioBtn.on("click",b),this._setUnlimitedRadioBtn.on("click",b))},_handleRadioClick:function(a){this._credits.set("disabled",a&&a.target&&a.target.id&&a.target.id==="setUnlimited-"+this.baseClass)},_setupTooltips:function(){this._tooltips&&
0===this._tooltips.length&&this._tooltips.push(this._createTooltip("noLimitTooltip-"+this.baseClass,this.i18n.orgLimit,200,300))},_createTooltip:function(a,b,d,h){d=esri.isDefined(d)?d:200;h=esri.isDefined(h)?h:300;return new r({label:'\x3cdiv style\x3d"max-width:'+h+'px;"\x3e'+b+"\x3c/div\x3e",connectId:[a],id:"tooltip_"+a,showDelay:d})},_goToSelectUsers:function(){var a=this._get("initialUserSearch");this._stackContainer.selectChild(this._stackSelectUsers);this._userSelector.focusSearch();a&&(this._userSelector._searchBox.set("value",
a),this._userSelector._toggleClearSearchButton(),this._userSelector._searchClick())},_goToSelectCredits:function(){this._stackContainer.selectChild(this._stackSelectCredits)},_goToResultSummary:function(){this._assigningCredits(!1);this._stackContainer.selectChild(this._stackResultSummary)},_selectUsersChange:function(a){a&&a.selectedUsers&&(this._set("selectedUsers",a.selectedUsers),this._refreshSelectedUsers())},_selectCreditsClick:function(a){a&&a.preventDefault();0===(this._get("selectedUsers")||
[]).length?(a='\x3cspan style\x3d"color:red;"\x3e'+this.i18n.mustSelectUsers+"\x3c/span\x3e",this._createOneTimeTooltip(a,this._selectUsersNext.domNode)):this._goToSelectCredits()},_backToSelectUsersClick:function(a){a&&a.preventDefault();this._goToSelectUsers()},_assigningCredits:function(a){this._summaryAssign.set("disabled",a);this._summaryAssign.set("label",a?this.i18n.assigning:this.i18n.assign)},_assignClick:function(a){a&&a.preventDefault();var b=this;a=b._get("selectedUsers")||[];var d=this._setAllocationRadioBtn.get("checked"),
h=b._credits.get("value"),z=!1,f=[],k,g;b._validates()&&(b._assigningCredits(!0),d?(k=q.parse(h),k=isNaN(k)?parseFloat(h):k,b._assignCreditLimit(k,a).then(function(a){if(a instanceof Array){for(g=0;g<a.length;g++)a[g].notAssignedUsers&&0<a[g].notAssignedUsers.length&&(f=f.concat(a[g].notAssignedUsers));(z=m.every(a,function(a){return a&&a.code&&a.message}))?(console.log("Unable to set allocation to "+k+" credits.",a),c.set(b._resultMessage,"innerHTML",b.i18n.assignmentFailure)):0<f.length?c.set(b._resultMessage,
"innerHTML",b.i18n.assignmentSomeFailure+" "+f.join(", ")):c.set(b._resultMessage,"innerHTML",b.i18n.assignmentSuccessful)}else a&&a.code&&a.message?(console.log("Unable to set allocation to "+k+" credits.",a),c.set(b._resultMessage,"innerHTML",b.i18n.assignmentFailure)):a.notAssignedUsers&&0<a.notAssignedUsers.length?c.set(b._resultMessage,"innerHTML",b.i18n.assignmentSomeFailure+" "+a.notAssignedUsers.join(", ")):c.set(b._resultMessage,"innerHTML",b.i18n.assignmentSuccessful);b._assigningCredits(!1);
b._goToResultSummary();b._publishCreditsChanged()},function(a){console.log("Unable to set allocation to "+k+" credits.",a);c.set(b._resultMessage,"innerHTML",b.i18n.assignmentFailure);b._assigningCredits(!1);b._goToResultSummary()})):b._assignNoLimit(a).then(function(a){if(a instanceof Array){for(g=0;g<a.length;g++)a[g].notUnAssignedUsers&&0<a[g].notUnAssignedUsers.length&&(f=f.concat(a[g].notUnAssignedUsers));(z=m.every(a,function(a){return a&&a.code&&a.message}))?(console.log("Unable to set allocation to no limit.",
a),c.set(b._resultMessage,"innerHTML",b.i18n.noLimitAssignmentFailure)):0<f.length?c.set(b._resultMessage,"innerHTML",b.i18n.noLimitSomeAssignmentFailure+" "+f.join(", ")):c.set(b._resultMessage,"innerHTML",b.i18n.noLimitAssignmentSuccessful)}else a&&a.code&&a.message?(console.log("Unable to set allocation to no limit.",a),c.set(b._resultMessage,"innerHTML",b.i18n.noLimitAssignmentFailure)):a.notUnAssignedUsers&&0<a.notUnAssignedUsers.length?c.set(b._resultMessage,"innerHTML",b.i18n.noLimitSomeAssignmentFailure+
" "+a.notUnAssignedUsers.join(", ")):c.set(b._resultMessage,"innerHTML",b.i18n.noLimitAssignmentSuccessful);b._assigningCredits(!1);b._goToResultSummary();b._publishCreditsChanged()},function(a){console.log("Unable to set allocation to no limit.",a);c.set(b._resultMessage,"innerHTML",b.i18n.noLimitAssignmentFailure);b._assigningCredits(!1);b._goToResultSummary()}))},_publishCreditsChanged:function(){E.publish("credits-change")},_validates:function(){var a=esriGeowConfig.self.subscriptionInfo.availableCredits,
b=this._setAllocationRadioBtn.get("checked"),d=this._credits.get("value"),h=this._summaryAssign.domNode,c;if(b){if(!s.isDefined(d)||0===d.length)return this._createOneTimeTooltip(this.i18n.mustSetCredits,h),!1;try{c=q.parse(d);c=isNaN(c)?parseFloat(d):c;if(isNaN(c))return this._createOneTimeTooltip(this.i18n.creditsNumberRequired,h),!1;if(0>c)return this._createOneTimeTooltip(this.i18n.creditsZeroGreater,h),!1;if(c>a)return this._createOneTimeTooltip(this.i18n.creditLimitOrg,h),!1}catch(f){return this._createOneTimeTooltip(this.i18n.creditsNumberRequired,
h),!1}}return!0},_assignCreditLimit:function(a,b){var d=esriGeowConfig.restBaseUrl+"portals/self/assignUserCredits",c=[],e=[],f,k,g;m.forEach(b,function(b){c.push({username:b.username,credits:a})});if(b.length>this._maxUsers){f=Math.ceil(b.length/this._maxUsers);for(g=0;g<f;g++)k=c.splice(0,this._maxUsers),e.push(p.request({url:d,content:{userAssignments:n.stringify(k)}},{usePost:!0}));return y(e)}return p.request({url:d,content:{userAssignments:n.stringify(c)}},{usePost:!0}).promise},_assignNoLimit:function(a){var b=
esriGeowConfig.restBaseUrl+"portals/self/unassignUserCredits",d=[],c=[],e=0,f;m.forEach(a,function(a){d.push(a.username)});if(a.length>this._maxUsers){e=Math.ceil(a.length/this._maxUsers);for(f=0;f<e;f++)a=d.splice(0,this._maxUsers),c.push(p.request({url:b,content:{usernames:n.stringify(a)}},{usePost:!0}));return y(c)}return p.request({url:b,content:{usernames:n.stringify(d)}},{usePost:!0}).promise},_createOneTimeTooltip:function(a,b){r.show('\x3cspan style\x3d"color:red;"\x3e'+a+"\x3c/span\x3e",
b);C.once(b,D.leave,function(){r.hide(b)})},_assignMoreClick:function(a){a&&a.preventDefault();this.clear()},_resultCloseClick:function(a){a&&a.preventDefault();this.hide()},_getUsernameList:function(a){var b=[];m.forEach(a,function(a){a&&a.username&&b.push(a.username)});return b},_getGroupIDList:function(a){var b=[];m.forEach(a,function(a){a&&a.id&&b.push(a.id)});return b},_refreshSelectedUsers:function(){c.set(this._selectedUsersPane,"innerHTML","");var a=this._get("selectedUsers")||[],b,d;if(a)for(b=
0;b<a.length;b++)d=a[b],v.create("span",{id:"selected-user-"+b,innerHTML:d.altName||d.fullName,"data-fullName":d.fullName,"data-username":d.username},this._selectedUsersPane),v.create("br",null,this._selectedUsersPane)},clear:function(){var a=parseInt(esriGeowConfig.self.availableCredits,10);this._dialog.set("title",this.i18n.manageBudget);this._userSelector.reset();this._userSelector._initialize();this._set("selectedUsers",[]);this._refreshSelectedUsers();this._assigningCredits(!1);esriGeowConfig.self&&
esriGeowConfig.self.availableCredits?(c.set(this._currentCreditTotal,"innerHTML",s.substitute({num:q.format(a)},this.i18n.currentCredits)),w.set(this._currentCreditTotal,"display","")):w.set(this._currentCreditTotal,"display","none");this._setAllocationRadioBtn.set("checked",!0);this._credits.set("disabled",!1);this._credits.set("value","");this._credits.set("constraints",{pattern:"0.##"});c.set(this._unlimitedCreditsLabel,"innerHTML",'\x3cspan id\x3d"noLimitTooltip-'+this.baseClass+'" class\x3d"hasTooltip"\x3e'+
this.i18n.allocateCreditsUnlimited+"\x3c/span\x3e");c.set(this._resultMessage,"innerHTML","");this._setupTooltips();this._goToSelectUsers()},show:function(){this.clear();this._dialog.show()},hide:function(){this._dialog.hide();(9>x("ie")||5>x("trident"))&&this._goToSelectUsers()},onCancel:function(a){a&&a.preventDefault();this._resultCloseClick()}});u.prototype.statics={_instance:null,getInstance:function(){null==this._instance&&(this._instance=new u);return this._instance}};return u});