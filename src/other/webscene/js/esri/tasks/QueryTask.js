// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("dojo/_base/array ../core/declare dojo/_base/lang ../request ../geometry/Extent ../geometry/support/normalizeUtils ./Task ./support/FeatureSet".split(" "),function(l,h,d,g,m,n,p,k){h=h(p,{declaredClass:"esri.tasks.QueryTask",source:null,gdbVersion:null,__msigns:[{n:"execute",c:2,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:1,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:1,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:1,a:[{i:0,p:["geometry"]}],e:2}],execute:function(a,
c,b){b=b.assembly;a=this._encode(d.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON(b&&b[0])));this.source&&(b={source:this.source.toJSON()},a.layer=JSON.stringify(b));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return g({url:this.parsedUrl.path+"/query",content:a,callbackParamName:"callback",callbackSuffix:c},this.requestOptions).then(this._handleExecuteResponse)},executeRelationshipQuery:function(a){a=this._encode(d.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON()));this.gdbVersion&&(a.gdbVersion=
this.gdbVersion);return g({url:this.parsedUrl.path+"/queryRelatedRecords",content:a,callbackParamName:"callback"},this.requestOptions).then(this._handleExecuteRelationshipQueryResponse)},executeForIds:function(a,c){var b=c.assembly,b=this._encode(d.mixin({},this.parsedUrl.query,{f:"json",returnIdsOnly:!0},a.toJSON(b&&b[0])));if(this.source){var e={source:this.source.toJSON()};b.layer=JSON.stringify(e)}this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return g({url:this.parsedUrl.path+"/query",content:b,
callbackParamName:"callback"},this.requestOptions).then(this._handleExecuteForIdsResponse)},executeForCount:function(a,c){var b=c.assembly,b=this._encode(d.mixin({},this.parsedUrl.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},a.toJSON(b&&b[0])));if(this.source){var e={source:this.source.toJSON()};b.layer=JSON.stringify(e)}this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return g({url:this.parsedUrl.path+"/query",content:b,callbackParamName:"callback"},this.requestOptions).then(this._handleExecuteForCountResponse)},
executeForExtent:function(a,c){var b=c.assembly,b=this._encode(d.mixin({},this.parsedUrl.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},a.toJSON(b&&b[0])));if(this.source){var e={source:this.source.toJSON()};b.layer=JSON.stringify(e)}this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return g({url:this.parsedUrl.path+"/query",content:b,callbackParamName:"callback"},this.requestOptions).then(this._handleExecuteForExtentResponse)},_handleExecuteResponse:function(a){return k.fromJSON(a)},_handleExecuteRelationshipQueryResponse:function(a){var c=
a.geometryType,b=a.spatialReference,e={};l.forEach(a.relatedRecordGroups,function(a){var f={};f.geometryType=c;f.spatialReference=b;f.features=a.relatedRecords;f=k.fromJSON(f);if(null!=a.objectId)e[a.objectId]=f;else for(var d in a)a.hasOwnProperty(d)&&"relatedRecords"!==d&&(e[a[d]]=f)});return e},_handleExecuteForIdsResponse:function(a){return a.objectIds},_handleExecuteForCountResponse:function(a){var c=a.features,b=a.objectIds;if(b)a=b.length;else{if(c)throw Error("Unable to perform query. Please check your parameters.");
a=a.count}return a},_handleExecuteForExtentResponse:function(a){a.extent&&(a.extent=m.fromJSON(a.extent));return a}});n._createWrappers(h);return h});