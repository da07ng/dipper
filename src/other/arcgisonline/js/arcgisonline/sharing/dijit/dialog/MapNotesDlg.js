// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/dialog/MapNotesDlg",["dijit","dojo","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dojox/html/entities,dijit/Dialog"],function(e,a,h){a.provide("arcgisonline.sharing.dijit.dialog.MapNotesDlg");a.require("dijit._Widget");a.require("dijit._Templated");a.require("dojox.html.entities");a.require("dijit.Dialog");a.declare("arcgisonline.sharing.dijit.dialog.MapNotesDlg",[e._Widget,e._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContainer"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" id\x3d"mapnotes-title-dialog" dojoAttachPoint\x3d"_mapNotesDialog" dojoAttachEvent\x3d"onkeydown:_handleKeyDown"title\x3d"${i18n.addMapNotes}" execute\x3d""\x3e\r\n    \x3cdiv\x3e\r\n      \x3ctable\x3e\r\n        \x3ctbody\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd height\x3d"30"\x3e\r\n              \x3clabel class\x3d"long" for\x3d"mapnotes-title"\x3e${i18n.nameLabel}\x3c/label\x3e\r\n        \t\x3c/td\x3e\r\n\t\t\t\x3ctd\x3e\r\n\t\t\t  \x3cdiv id\x3d"mapnotes-title" dojoAttachPoint\x3d"_mapNotesTitle" name\x3d"mapnotes-title" dojotype\x3d"dijit.form.TextBox" maxLength\x3d"100" trim\x3d"true" required\x3d"true" style\x3d"padding:2px 0 2px 0;"\x3e\x3c/div\x3e\r\n\t\t\t \x3c/td\x3e\r\n           \x3c/tr\x3e\r\n           \x3ctr\x3e\r\n             \x3ctd height\x3d"30"\x3e\r\n               \x3clabel class\x3d"long" for\x3d"mapnotes-title"\x3e${i18n.templateLabel}\x3c/label\x3e\r\n             \x3c/td\x3e\r\n             \x3ctd\x3e\r\n\t\t\t   \x3cselect dojoType\x3d"arcgisonline.sharing.dijit.ComboBox" class\x3d"arrowSpaceMedium" dojoAttachEvent\x3d"onChange:newTemplate" dojoAttachPoint\x3d"_mapTemplatesCombo" id\x3d"mapnotes-templates" \x3e\x3c/select\x3e\r\n             \x3c/td\x3e\r\n           \x3c/tr\x3e\r\n           \x3ctr\x3e\r\n             \x3ctd\x3e\x26nbsp;\x3c/td\x3e\r\n             \x3ctd\x3e\r\n               \x3cdiv dojoAttachPoint\x3d"_mapNoteDescInput" id\x3d"mapnotes-template-description" style\x3d"width:290px;"\x3e\x3c/div\x3e\r\n             \x3c/td\x3e\r\n           \x3c/tr\x3e\r\n         \x3c/tbody\x3e\r\n       \x3c/table\x3e\r\n     \x3cdiv style\x3d"clear:both;margin-top:5px;"\x3e\r\n     \x3c/div\x3e\r\n     \x3cbutton type\x3d"cancel" dojotype\x3d"dijit.form.Button" class\x3d"cancel" dojoAttachEvent\x3d"onClick:_handleCancelBtnClick" style\x3d"float:right;"\x3e${i18n.cancel}\x3c/button\x3e\r\n     \x3cbutton id\x3d"mapnotes-create" dojotype\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:createMapNotesLayer" class\x3d"primary"  style\x3d"float:right;"\x3e${i18n.create}\x3c/button\x3e\r\n     \x3cdiv style\x3d"clear:both;"\x3e\r\n     \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
allTitles:"",template:null,i18n:null,_mapNotesDialog:null,_mapNoteDescInput:null,_mapNotesTitle:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.MapNotesDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.clone(a.i18n.getLocalization("arcgisonline","arcgisonline").common);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").viewer);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline",
"arcgisonline").generalDlg);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").mapNotesDlg)},postCreate:function(){this.getTemplates();9==a.isIE&&a.connect(this._mapNotesDialog,"hide",a.hitch(this,function(){this._mapTemplatesCombo.closeDropDown()}))},show:function(a){this.setTitle();this._mapNotesDialog.show()},setTitle:function(){this.allTitles="||";a.forEach(arcgisonline.map.main.mapLayers,function(a){this.allTitles+=a.title+"||"},this);this.allTitles=this.allTitles.toLowerCase();
if(-1==this.allTitles.indexOf("||"+this.i18n.mapNotes.toLowerCase()+"||"))this._mapNotesTitle.set("value",this.i18n.mapNotes);else{for(var b=1;-1<this.allTitles.indexOf("||"+this.i18n.mapNotes.toLowerCase()+" "+b+"||");)b++;this._mapNotesTitle.set("value",this.i18n.mapNotes+" "+b)}},_handleCancelBtnClick:function(a){a.preventDefault();this._mapNotesDialog.hide()},hide:function(){this._mapNotesDialog.hide()},createMapNotesLayer:function(b){b.preventDefault();if((b=a.trim(this._mapNotesTitle.get("value")))&&
0<b.length)-1<this.allTitles.indexOf("||"+b.toLowerCase()+"||")?arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.mapNotesLyrName,message:this.i18n.error.sameName}):(arcgisonline.map.mapNotes.getMapNotesConfig(this.template.id,b),this.hide())},getTemplates:function(){var b=function(a,b){console.log("Error retrieving symbol list items.")};arcgisonline.sharing.geow.Community.searchGroups(esriGeowConfig.layerTemplatesGroupQuery,a.hitch(this,function(a,
d){a&&a.results&&0<a.results.length?this.getTemplatesItems(a.results[0].id):b(a,d)}),a.hitch(this,b))},getTemplatesItems:function(b){var c=function(a,b){arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorDlgTitle,message:this.i18n.error.notAdded})};arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"search?num\x3d50\x26q\x3dgroup:"+b+' AND type:"Feature Collection Template"',a.hitch(this,function(b,e){if(b.results&&0<b.results.length){this._mapTemplatesCombo.set("fetchProperties",
{sort:[{attribute:"name",descending:!0}]});var f=[];a.forEach(b.results,function(a,b){f.push({name:a.title,sortName:a.name,id:a.id,description:a.description})},this);f.sort(function(a,b){return a.sortName==b.sortName?0:a.sortName<b.sortName?-1:1});var g=new a.data.ItemFileWriteStore({data:{identifier:"id",items:f}});this._mapTemplatesCombo.set("store",g);this._mapTemplatesCombo.set("value",f[0].name)}else c(b,e)}),a.hitch(this,c))},newTemplate:function(b){this._mapTemplatesCombo.store.fetch({query:{},
onComplete:a.hitch(this,function(c){for(var d=0;d<c.length;d++)if(c[d].name==b){this.template=c[d];a.attr(this._mapNoteDescInput,"innerHTML",this.template.description);break}})})},_handleKeyDown:function(a){var c;window.event?c=a.keyCode:a.which&&(c=a.which);13==c&&this.createMapNotesLayer(a)}})});