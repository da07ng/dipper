// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/dialog/FeatureTypeDlg",["dijit","dojo","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,dijit/form/DateTextBox,dijit/form/TextBox,dijit/form/NumberTextBox,esri/dijit/SymbolStyler"],function(f,b,l){b.provide("arcgisonline.sharing.dijit.dialog.FeatureTypeDlg");b.require("dijit.Dialog");b.require("dijit._Widget");b.require("dijit._Templated");b.require("dijit.form.DateTextBox");b.require("dijit.form.TextBox");b.require("dijit.form.NumberTextBox");b.require("esri.dijit.SymbolStyler");
b.declare("arcgisonline.sharing.dijit.dialog.FeatureTypeDlg",[f._Widget,f._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" id\x3d"featureType-dialog" title\x3d"${i18n.featureTypeDlgTitle}" execute\x3d""\x3e\r\n  \t\x3cdiv style\x3d"padding:10px 10px;"\x3e${i18n.titleMsg}\x3c/div\x3e\r\n    \x3ctable cellspacing\x3d"10" class\x3d"esriTrailingMargin2"\x3e\r\n    \t\x3ctbody\x3e\r\n\t\t    \x3ctr\x3e\r\n\t\t    \t\x3ctd\x3e\r\n\t\t        \x3clabel\x3e${i18n.labelLabel}\x3c/label\x3e\r\n\t\t      \x3c/td\x3e\r\n\t\t      \x3ctd width\x3d"270"\x3e\r\n\t\t        \x3cdiv dojoAttachPoint\x3d"featureTypeLabel" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" required\x3d"true" style\x3d"width:270px; padding:2px;"\x3e\x3c/div\x3e\r\n\t\t      \x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t    \x3ctr\x3e\r\n\t\t      \x3ctd\x3e\r\n\t\t        \x3clabel\x3e${i18n.attributeLabel}\x3c/label\x3e\r\n\t\t      \x3c/td\x3e\r\n\t\t      \x3ctd width\x3d"270"\x3e\r\n\t\t      \t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" width\x3d"270"\x3e\r\n\t\t      \t\t\x3ctr\x3e\r\n\t\t      \t\t\t\x3ctd nowrap\x3e\r\n                  \x3cdiv dojoAttachPoint\x3d"featureTypeAttributeField"\x3e\x3c/div\x3e\r\n\t\t      \t\t\t\x3c/td\x3e\r\n                \x3ctd width\x3d"5"\x3e\r\n                  \x26nbsp;\r\n                \x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd width\x3d"100%"\x3e\r\n                  \x3cdiv dojoAttachPoint\x3d"featureTypeAttributeNonEditable" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n                  \x3cdiv dojoAttachPoint\x3d"featureTypeAttributeText" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:100%; padding:2px; display:none;"\x3e\x3c/div\x3e\r\n                  \x3cdiv dojoAttachPoint\x3d"featureTypeAttributeNumber" dojotype\x3d"dijit.form.NumberTextBox" style\x3d"width:100%; padding:2px; display:none;"\x3e\x3c/div\x3e\r\n                  \x3cdiv dojoAttachPoint\x3d"featureTypeAttributeDate" dojotype\x3d"dijit.form.DateTextBox" style\x3d"width:100%; padding:2px; display:none;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t      \t\t\x3c/tr\x3e\r\n\t\t      \t\x3c/table\x3e\r\n\t\t      \x3c/td\x3e\r\n\t\t    \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd valign\x3d"top"\x3e\r\n            \x3clabel style\x3d"line-height:32px;"\x3e${i18n.symbolLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd\x3e\r\n            \x3cdiv id\x3d"featureTypeSymbolStylerDivContainer"\x3e\r\n              \x3cdiv id\x3d"featureTypeSymbolStylerDiv"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\r\n    \x3cbr /\x3e\r\n    \x3cbutton dojoAttachEvent\x3d"onClick:onCancelClick" class\x3d"jevent cancel" style\x3d"float:right;" dojoType\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n\t  \x3cbutton dojoAttachEvent\x3d"onClick:onDoneClick" class\x3d"jevent primary" style\x3d"float:right;" dojoType\x3d"dijit.form.Button"\x3e${i18n.done}\x3c/button\x3e\r\n    \x3cbr /\x3e\x26nbsp;  \r\n    \x3cbr /\x3e\x26nbsp;  \r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
i18n:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.FeatureTypeDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=b.clone(b.i18n.getLocalization("arcgisonline","arcgisonline").common);b.mixin(this.i18n,b.i18n.getLocalization("arcgisonline","arcgisonline").generalDlg);b.mixin(this.i18n,b.i18n.getLocalization("arcgisonline","arcgisonline").featureTypeDlg)},show:function(a){this.mapLayer=
a.mapLayer;this.layer=a.mapLayer.layer;this.okHandler=a.okHandler;esri.isDefined(a.featureTypePos)?this.featureType=this.mapLayer.layer.types[a.featureTypePos]:this.featureType=null;var d=esri.styles.basic.getSchemes({theme:"default",basemap:"topo",geometryType:this.layer.geometryType}),c=this._getDefaultSymbol(this.layer.geometryType);if(this.featureType)for(a=0;a<this.layer.renderer.infos.length;a++){var e=this.layer.renderer.infos[a];if(e.value==this.featureType.id){c=esri.symbol.fromJson(e.symbol.toJson());
break}}this.symbolOptions&&(this.symbolOptions.destroy(),this.symbolOptions=null,b.create("div",{id:"featureTypeSymbolStylerDiv"},b.byId("featureTypeSymbolStylerDivContainer")));this.symbolOptions||(this.symbolOptions=new esri.dijit.SymbolStyler({portalUrl:esriGeowConfig.restBaseUrl},"featureTypeSymbolStylerDiv"),this.symbolOptions.startup());this.symbolOptions.edit(c,{externalSizing:!1,schemes:d});this.featureTypeAttributeField.innerHTML=this.layer.renderer.attributeField;b.style(this.featureTypeAttributeNonEditable,
"display","none");b.style(this.featureTypeAttributeText.domNode,"display","none");b.style(this.featureTypeAttributeNumber.domNode,"display","none");b.style(this.featureTypeAttributeDate.domNode,"display","none");if(this.featureType)this.featureTypeLabel.set("value",this.featureType.name),this.featureTypeAttributeNonEditable.innerHTML=this.featureType.id,b.style(this.featureTypeAttributeNonEditable,"display","");else{this.featureTypeLabel.set("value","");this.featureTypeAttributeText.set("value","");
this.featureTypeAttributeNumber.set("value","");this.featureTypeAttributeDate.set("value","");for(a=0;a<this.layer.fields.length;a++)if(d=this.layer.fields[a],d.name===this.layer.renderer.attributeField){this.featureTypeAttribute="esriFieldTypeInteger"===d.type||"esriFieldTypeDouble"===d.type?this.featureTypeAttributeNumber:"esriFieldTypeDate"===d.type?this.featureTypeAttributeDate:this.featureTypeAttributeText;this.featureTypeAttributeFieldType=d.type;b.style(this.featureTypeAttribute.domNode,"display",
"");break}}f.byId("featureType-dialog").show()},hide:function(){f.byId("featureType-dialog").hide()},onDoneClick:function(a){var d=this.symbolOptions.getStyle().symbol;if(!("picturemarkersymbol"===d.type&&8>d.url.length)){if(this.featureType)this.featureType.name=this.featureTypeLabel.get("value")||this.featureType.name,this.layer.renderer._values&&this.layer.renderer._values[this.featureType.id]?(this.layer.renderer._values[this.featureType.id]=d,b.forEach(this.layer.renderer.infos,function(a){a.value===
this.featureType.id&&(a.symbol=d,a.label=this.featureType.name)},this)):(this.layer.renderer.removeValue(this.featureType.id),this.layer.renderer.addValue({value:this.featureType.id,label:this.featureType.name,symbol:d}));else{a=this.featureTypeAttribute.get("value");if(!a){var c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();c.show({title:this.i18n.errorDlgTitle,message:b.string.substitute(this.i18n.errors.badValue,{field:this.layer.renderer.attributeField})});return}a=
""+a;for(c=0;c<this.layer.renderer.infos.length;c++)if(this.layer.renderer.infos[c].value===a){c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();c.show({title:this.i18n.errorDlgTitle,message:b.string.substitute(this.i18n.errors.valueAlreadyExists,{attr:a})});return}var e=this.featureTypeLabel.get("value")||a;this.featureTypeLabel.set("value",e);var f=this.layer.renderer.attributeField,c=new esri.layers.FeatureType;c.id=a;c.name=e;var g=new esri.layers.FeatureTemplate;
g.description=e;g.name=e;var h={};h[f]=a;b.forEach(this.layer.fields,function(a){a.name!==f&&a.editable&&(h[a.name]=null,!1===a.nullable&&(h[a.name]="esriFieldTypeString"===a.type?" ":0))});var k=new esri.Graphic({attributes:h});g.prototype=k;c.templates=[g];this.layer.addType(c);this.layer.renderer.addValue({value:a,label:e,symbol:d})}this.layer.refresh();this.okHandler&&this.okHandler(c);this.hide()}},onCancelClick:function(a){b.publish("onSymbolChangeCancel",[]);this.hide()},_getDefaultSymbol:function(a){return"esriGeometryPoint"==
a?new esri.symbol.SimpleMarkerSymbol:"esriGeometryPolyline"==a?new esri.symbol.SimpleLineSymbol:"esriGeometryPolygon"==a?new esri.symbol.SimpleFillSymbol:null}})});