// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("../../../../core/declare ../../../../core/Evented ../../../../geometry/Point ../../webgl-engine/lib/Camera ../../support/earthUtils ../../support/mathUtils ../../lib/glMatrix dojo/on".split(" "),function(s,t,u,m,n,p,g,k){var b=g.vec3d;g=g.vec4d;var e=new u,q=b.create(),h=b.create(),r=b.create(),f=g.create();return s([t],{declaredClass:"esri.views.3d.navigation.mixins.CamerasMixin",classMetadata:{properties:{targetCamera:{getter:function(){return this.cameras.target}},currentCamera:{getter:function(){return this.cameras.current}},
windowSize:{setter:function(a){var c=a[0],d=a[1],l=!1,b=this.cameras.target.x-this.cameras.target.padding[3],e=this.cameras.target.y-this.cameras.target.padding[2];if(this.cameras.target.width+b!==c||this.cameras.target.height+e!==d)this.cameras.target.width=c-b,this.cameras.target.height=d-e,this.targetChanged(),l=!0;b=this.cameras.current.x-this.cameras.current.padding[3];e=this.cameras.current.y-this.cameras.current.padding[2];if(this.cameras.current.width+b!==c||this.cameras.current.height+e!==
d)this.cameras.current.width=c-b,this.cameras.current.height=d-e,this.currentChanged(),l=!0;l&&this.currentHasReachedTarget()&&this.currentReachedTarget();return a}},padding:{setter:function(a){var c=!1,d=!1;f[0]=a.top;f[1]=a.right;f[2]=a.bottom;f[3]=a.left;p.vectorEquals(this.cameras.current.padding,f)||(this.cameras.current.padding=f,d=!0);p.vectorEquals(this.cameras.target.padding,f)||(this.cameras.target.padding=f,c=!0);c&&this.targetChanged();d&&this.currentChanged();this.currentHasReachedTarget()&&
(c||d)&&this.currentReachedTarget()}}}},initialize:function(){var a=new m(b.createFrom(4*n.earthRadius,0,0),b.createFrom(n.earthRadius,0,0),b.createFrom(0,0,1));this.cameras={current:a,target:a.copy()}},currentHasReachedTarget:function(){return this.cameras.current.equals(this.cameras.target)},currentHasAlmostReachedTarget:function(){return this.cameras.current.almostEquals(this.cameras.target,5E-4/this.mapUnitInMeters)},setCamera:function(a,c){this.pan&&this.pan.continuous&&this.pan.continuous.stop();
this.cameras.target.copyFrom(a);var d=!(c&&c.internalUpdate)||!this._targetCameraChangedByElevationUpdate,b=this.constrainTargetEyeByElevation(d),b=this.applyConstraints(this.cameras.target,!0)||b;this.fixTargetUpVector();this.currentHasReachedTarget()?(this.targetChanged(),b&&d&&(this._targetCameraChangedByElevationUpdate=!0),this.currentReachedTarget()):(void 0!==c&&void 0!==c.animate&&!c.animate?this.targetAndCurrentChanged():this.targetAnimatedChanged(),b&&d&&(this._targetCameraChangedByElevationUpdate=
!0),this._autoUpdateTiltConstraint())},getTargetCamera:function(){console.warn("[Navigation.getTargetCamera()] deprecated; use .targetCamera instead");return this.targetCamera},getCurrentCamera:function(){console.warn("[Navigation.getCurrentCamera()] deprecated; use .currentCamera instead");return this.currentCamera},_cameraFromEyeCenterUp:function(a,c,d){var b=this.cameras.target.copy();b.eye=a;b.center=c;b.up=d;return b},setCameraFromEyeAndCenter:function(a,c,d){this.setCamera(this._cameraFromEyeCenterUp(a,
c,this.cameras.target.up),d)},setCameraFromEyeCenterAndUp:function(a,c,d,b){this.setCamera(this._cameraFromEyeCenterUp(a,c,d),b)},_frameAboveGround:function(a,c){var b=this.renderCoordsHelper;b.fromRenderCoords(a,e,this.mapCoordsHelper.spatialReference);e.z=Math.max(e.z,this.elevationProvider.getElevation(e)||0);b.toRenderCoords(e,q);return q},preserveHeadingTiltFrame:function(a){},frame:function(a,c){var d=!1;if(this.constraints.collision.enabled)a=this._frameAboveGround(a,c);else if(this.renderCoordsHelper.fromRenderCoords(a,
e,this.view.map.spatialReference)){var f=this.elevationProvider.getElevation(e)||0;e.z<f&&(d=!0)}this.pan&&this.pan.continuous&&this.pan.continuous.stop();c=Math.max(c,this.minPoiDist);c<1E5/this.mapUnitInMeters||d?(this.preserveHeadingTiltFrame(a),b.subtract(this.cameras.target.eye,this.cameras.target.center,h),b.normalize(h),b.scale(h,c),b.add(a,h,this.cameras.target.eye)):(this.renderCoordsHelper.worldUpAtPosition(a,r),b.scale(r,c,this.cameras.target.eye),b.add(this.cameras.target.eye,a));b.set(a,
this.cameras.target.center);this.fixTargetUpVector();this.targetAnimatedChanged()},frameStageObject:function(a){this.frame(a.getCenter(),this.cameras.target.computeDistanceFromRadius(a.getBSRadiusApprox(),1.1))},_cameraEvents:{},_prepareCameraEvent:function(a,c){var b=this._cameraEvents[a];b||(b={camera:new m},this._cameraEvents[a]=b);b.camera.copyFrom(c);return b},emitWithCamera:function(a,b){k.emit(this,a,this._prepareCameraEvent(a,b))},targetChanged:function(a){this.inherited(arguments);this.cameras.target.markViewDirty();
var b=this._prepareCameraEvent("targetViewChanged",this.cameras.target);b.interruptedAnimation=!!a;k.emit(this,"targetViewChanged",b)},targetAnimatedChanged:function(a){this.targetChanged(a);this.animationStarted()},targetAndCurrentChanged:function(a){this.targetChanged(a);this.setCurrentToTarget()},currentChanged:function(){this.inherited(arguments);this.cameras.current.markViewDirty();this.emitWithCamera("currentViewChanged",this.cameras.current)},currentReachedTarget:function(a){this.currentChanged();
if(!this.pan||!this.pan.continuous||!this.pan.continuous.active){var b=this._prepareCameraEvent("currentViewReachedTarget",this.cameras.current);b.finishedAnimation=!!a;k.emit(this,"currentViewReachedTarget",b)}},setCurrentToTarget:function(a){this.cameras.current.copyFrom(this.cameras.target);this.currentReachedTarget(a)}})});