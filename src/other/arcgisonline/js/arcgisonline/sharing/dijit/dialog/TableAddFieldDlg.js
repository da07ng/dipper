// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
require({cache:{"url:arcgisonline/sharing/dijit/dialog/templates/TableAddFieldDlg.html":'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"_dialog" data-dojo-props\x3d"title:\'${i18n.addFieldTitle}\'" style\x3d"width:30em;"\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"_addForm"\x3e\r\n       \x3ctable class\x3d"esriAddFormTable"  data-dojo-attach-point\x3d"_addTable"  style\x3d"border-collapse:collapse;border-spacing:5px;" cellpadding\x3d"5px" cellspacing\x3d"5px"\x3e \r\n         \x3ctbody\x3e\r\n          \x3ctr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd style\x3d"width:40%;"\x3e\r\n                \x3clabel\x3e${i18n.nameLabel}\x3c/label\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n              \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" class\x3d"esriLeadingMargin1" data-dojo-props\x3d"required:true" data-dojo-attach-point\x3d"_nameInput" value\x3d""\x3e\x3c/input\x3e              \r\n             \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd  style\x3d"width:40%;"\x3e\r\n                \x3clabel\x3e${i18n.aliasLabel}\x3c/label\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n              \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" class\x3d"esriLeadingMargin1" data-dojo-attach-point\x3d"_aliasInput" value\x3d""\x3e\x3c/input\x3e              \r\n             \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n           \x3ctr\x3e\r\n            \x3ctd  style\x3d"width:40%;"\x3e\r\n              \x3clabel class\x3d""\x3e${i18n.typeLabel}\x3c/label\x3e\r\n            \x3c/td\x3e\r\n            \x3ctd\x3e\r\n              \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel"  style\x3d"margin-top:1.0em;" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_typeSelect" data-dojo-attach-event\x3d"onChange:_handleTypeChange" data-dojo-props\x3d"value:\'esriFieldTypeString\'"\x3e\r\n                \x3coption value\x3d"esriFieldTypeDate"\x3e${i18n.dateLabel}\x3c/option\x3e\r\n                \x3coption value\x3d"esriFieldTypeDouble"\x3e${i18n.doubleLabel}\x3c/option\x3e\r\n                \x3coption value\x3d"esriFieldTypeInteger"\x3e${i18n.integerLabel}\x3c/option\x3e\r\n                \x3coption value\x3d"esriFieldTypeString"\x3e${i18n.stringLabel}\x3c/option\x3e\r\n              \x3c/select\x3e\r\n            \x3c/td\x3e\r\n          \x3c/tr\x3e\r\n            \x3ctr data-dojo-attach-point\x3d"_lengthRow"\x3e\r\n              \x3ctd  style\x3d"width:40%;"\x3e\r\n                \x3clabel data-dojo-attach-point\x3d"_lengthLabel"\x3e${i18n.lengthLabel}\x3c/label\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n              \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" class\x3d"esriLeadingMargin1" data-dojo-attach-point\x3d"_lengthInput" data-dojo-props\x3d"value:256"\x3e\x3c/input\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e  \r\n            \x3ctr\x3e\r\n              \x3ctd  style\x3d"width:40%;"\x3e\r\n                \x3cdiv style\x3d"width:95%;"\x3e\x3clabel data-dojo-attach-point\x3d"_defaultLabel""\x3e${i18n.defaultValueLabel}\x3c/label\x3e\x3c/div\x3e\r\n                \x3cdiv style\x3d"width:90%;"\x3e\x3clabel data-dojo-attach-point\x3d"_optionLabel" style\x3d"font:smaller;"\x3e${i18n.optional}\x3c/label\x3e\x3c/div\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n              \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" class\x3d"esriLeadingMargin1" data-dojo-attach-point\x3d"_defaultStrInput"\x3e\x3c/input\x3e\r\n              \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" class\x3d"esriLeadingMargin1" data-dojo-props\x3d"constraints:{places:0}" data-dojo-attach-point\x3d"_defaultNumInput"\x3e\x3c/input\x3e\r\n              \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" class\x3d"esriLeadingMargin1" data-dojo-attach-point\x3d"_defaultDblInput"\x3c/input\x3e\r\n              \x3cinput data-dojo-type\x3d"dijit/form/DateTextBox" class\x3d"esriLeadingMargin1" data-dojo-attach-point\x3d"_defaultDateInput"\x3e\x3c/input\x3e\r\n\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e \r\n          \x3c/tbody\x3e\r\n         \x3c/table\x3e\r\n        \x3cdiv  class\x3d"esriFloatTrailing" style\x3d"padding:2em 1em 2em 1em;clear:both;"\x3e\r\n            \x3cdiv data-dojo-type\x3d"dijit/form/Button"  class\x3d"btn calcite primary tiny" data-dojo-attach-point\x3d"_addBtn" data-dojo-attach-event\x3d"onClick:_handleAddButtonClick"\x3e\r\n              ${i18n.addNewField}\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("arcgisonline/sharing/dijit/dialog/TableAddFieldDlg","require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has dojo/json dojo/string dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/dom-class dojo/aspect dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/form/Button dijit/form/Form dijit/form/Select dijit/form/TextBox dijit/form/ValidationTextBox dijit/form/NumberTextBox dijit/form/DateTextBox dijit/Dialog esri/kernel esri/lang esri/request ../../util dojo/i18n!esri/nls/jsapi dojo/text!./templates/TableAddFieldDlg.html".split(" "),
function(e,h,d,k,n,p,x,y,b,z,A,B,C,q,r,s,t,u,D,E,F,G,H,I,J,K,L,M,l,v,g,w){e=h([q,r,s,t,u],{widgetsInTemplate:!0,declaredClass:"arcgisonline.sharing.dijit.dialog.TableAddFieldDlg",templateString:w,basePath:e.toUrl("."),statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.TableAddFieldDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n={};d.mixin(this.i18n,g.common);d.mixin(this.i18n,g.calculateFields)},
postCreate:function(){this.inherited(arguments);this._typeSelect.set("value","esriFieldTypeString");this._handleTypeChange("esriFieldTypeString");this._nameInput.set("validator",d.hitch(this,this._validateFieldName))},_handleTypeChange:function(a){this._lengthInput.set("required","esriFieldTypeString"===a);b.set(this._lengthRow,"display","esriFieldTypeString"!==a?"none":"table-row");var d={esriFieldTypeDouble:1,esriFieldTypeSingle:1},c={esriFieldTypeInteger:1,esriFieldTypeSmallInteger:1};a in{esriFieldTypeDate:1}?
(b.set(this._defaultStrInput.domNode,"display","none"),b.set(this._defaultNumInput.domNode,"display","none"),b.set(this._defaultDblInput.domNode,"display","none"),b.set(this._defaultDateInput.domNode,"display","block")):(a in c?(b.set(this._defaultStrInput.domNode,"display","none"),b.set(this._defaultNumInput.domNode,"display","block"),b.set(this._defaultDblInput.domNode,"display","none")):a in d?(b.set(this._defaultStrInput.domNode,"display","none"),b.set(this._defaultNumInput.domNode,"display",
"none"),b.set(this._defaultDblInput.domNode,"display","block")):(b.set(this._defaultStrInput.domNode,"display","block"),b.set(this._defaultNumInput.domNode,"display","none"),b.set(this._defaultDblInput.domNode,"display","none")),b.set(this._defaultDateInput.domNode,"display","none"))},_handleAddButtonClick:function(){if(this._addForm.validate()){var a={f:"json"},b=this.params.layer.url.replace("/rest/services","/rest/admin/services")+"/addToDefinition",c=v.getToken(),e=[],g={esriFieldTypeDouble:1,
esriFieldTypeSingle:1},h={esriFieldTypeDate:1},m={},f;c&&(a.token=c);f={name:this._nameInput.get("value"),type:this._typeSelect.get("value"),alias:this._aliasInput.get("value"),nullable:!0,editable:!0};"esriFieldTypeString"===f.type&&(f.length=this._lengthInput.get("value"));f.type in{esriFieldTypeInteger:1,esriFieldTypeSmallInteger:1}?c=this._defaultNumInput.get("value"):f.type in g?c=this._defaultDblInput.get("value"):f.type in h?(c=this._defaultDateInput.get("value"))&&(c=c.getTime()):c=this._defaultStrInput.get("value");
c&&(f.defaultValue=c);e.push(f);m.fields=e;a.addToDefinition=n.toJson(m);a=l({url:b,content:a},{usePost:!0});this._addBtn.set("disabled",!0);a.then(d.hitch(this,function(a){this._dialog.hide();this._addBtn.set("disabled",!1);l({url:this.params.layer.url,content:{f:"json"},callbackParamName:"callback"}).then(d.hitch(this,function(a){this.params.mapLayer.layer.fields=a.fields;var b=this.params.table.getPopupInfo(this.params.mapLayer,this.params.subLayerId),c,e,g,h;c=k.filter(a.fields,function(a){return a.name===
f.name},this)[0];this.params.mapLayer.serviceInfo=a;g={esriFieldTypeDouble:1,esriFieldTypeSingle:1};h={esriFieldTypeDate:1};if(c.type in{esriFieldTypeInteger:1,esriFieldTypeSmallInteger:1})e={places:0,digitSeparator:!0};else if(c.type in g)e={places:2,digitSeparator:!0};else if(c.type in h&&(10<=a.currentVersion||this.params.layer&&10<=this.params.layer.version))e={dateFormat:"shortDateLongTime"};a=d.mixin({},{fieldName:c.name,label:c.alias,isEditable:c.editable,tooltip:"",visible:!0,format:e,stringFieldOption:"textbox"});
b.fieldInfos.push(a);arcgisonline.map.popup.removePopup(this.params.mapLayer);this.params.mapLayer.popupInfo=b;this.params.mapLayer.popupChanged=!0;arcgisonline.map.popup.addPopupLayer(this.params.mapLayer,this.params.subLayerId);"Feature Layer"===this.params.mapLayer.layer.type?(arcgisonline.map.edit.removeTypesAndTemplatesOnLayer(this.params.mapLayer.layer),arcgisonline.map.edit.createTypesAndTemplatesOnMapLayer(this.params.mapLayer),this.params.mapLayer.featureTemplatesChanged=!0,arcgisonline.map.main.markMapAsChanged("addField"),
arcgisonline.map.itemData.updateFeatureService(this.params.mapLayer,d.hitch(this,function(a){this.params.table.refreshTable(this.params.mapLayer,this.params.subLayerId,"add",c.name)}))):(arcgisonline.map.main.markMapAsChanged("addField"),arcgisonline.map.itemData.uploadItemLayerInfos(this.params.mapLayer,d.hitch(this,function(a){this.params.table.refreshTable(this.params.mapLayer,this.params.subLayerId,"add",c.name)})))}),d.hitch(this,function(a){var c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();
this._addBtn.set("disabled",!1);c.show({title:this.i18n.errorTitle,message:a.details.join("\x3cbr/\x3e")})}))}),d.hitch(this,function(a){arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorTitle,message:a.details.join("\x3cbr/\x3e")});this._addBtn.set("disabled",!1)}))}},show:function(a){this._addForm.reset();this._addBtn.set("disabled",!1);this._dialog.show();this.params=a},_validateFieldName:function(a){var b="ABSOLUTE ACCESS ACTION ADD ALL ALLOCATE ALPHANUMERIC ALTER And ANY ARE AS ASC ASSERTION AT AUTHORIZATION AUTOINCREMENT AVG BEGIN Between BINARY BIT BIT_LENGTH BOOLEAN BOTH BY BYTE CASCADE CASCADED CASE CAST CATALOG CHAR CHAR_LENGTH CHARACTER CHARACTER_LENGTH CHECK CLOSE COALESCE COLLATE COLLATION COLUMN COMMENT COMMIT CONNECT CONNECTION CONSTRAINT CONSTRAINTS CONTINUE CONVERT CORRESPONDING COUNT COUNTER CREATE CROSS CURRENCY CURRENT CURRENT_DATE CURRENT_TIME CURRENT_TIMESTAMP CURRENT_USER CURSOR DATABASE DATE DATETIME DAY DEALLOCATE DEC DECIMAL DECLARE DEFAULT DEFERRABLE DEFERRED DELETE DESC DESCRIBE DESCRIPTOR DIAGNOSTICS DISCONNECT DISALLOW DISTINCT DISTINCTROW DOMAIN DOUBLE DROP EQV ELSE END END-EXEC ESCAPE EXCEPT EXCEPTION EXEC EXECUTE EXISTS EXTERNAL EXTRACT FALSE FETCH FIRST FLOAT FLOAT4 FLOAT8 FOR FOREIGN FOUND FROM FULL GENERAL GET GLOBAL GO GOTO GRANT GROUP GUID HAVING HOUR IDENTITY IEEEDOUBLE IEEESINGLE IGNORE IMMEDIATE IMAGE IN IMP INDEX INDICATOR INITIALLY INNER INPUT INSENSITIVE INSERT INT INTEGER INTEGER4 INTEGER1 INTEGER2 INTERSECT INTERVAL INTO IS ISOLATION JOIN KEY LANGUAGE LAST LEADING LEFT LEVEL LIKE LOCAL LOCK LOGICAL LOGICAL1 LONG LONGBINARY LONGTEXT LOWER MATCH MAX MEMO MIN MINUTE MODULE MONTH MOD MONEY NAMES NATIONAL NATURAL NCHAR NEXT NO NOT NULL NULLIF NUMBER NUMERIC OCTET_LENGTH OF OFF OLEOBJECT ON ONLY OPEN OPTION OR ORDER OUTER OUTPUT OWNERACCESS OVERLAPS PAD PARTIAL PARAMETERS PERCENT PIVOT POSITION PRECISION PREPARE PRESERVE PRIMARY PRIOR PRIVILEGES PROCEDURE PUBLIC READ REAL REFERENCES RELATIVE RESTRICT REVOKE RIGHT ROLLBACK ROWID ROWS SCHEMA SCROLL SECOND SECTION SELECT SESSION SESSION_USER SET SHORT SINGLE SIZE SMALLINT SOME SPACE SQL SQLCODE SQLERROR SQLSTATE STDev STDEVP STRING SUBTYPE SUBSTRING SUM SYSTEM_USER TABLE TABLEID TEMPORARY TEXT THEN TIME TIMESTAMP TIMEZONE_HOUR TIMEZONE_MINUTE TO TOP TRAILING TRANSACTION TRANSFORM TRANSLATE TRANSLATION TRIM TRUE TYPE UNION UNIQUE UNKNOWN UPDATE UPPER USAGE USER USING VALUE VALUES VAR VARCHAR VARBINARY VARP VARYING VIEW WHEN WHENEVER WHERE WITH WORK WRITE XOR YEAR YESNO ZONE".split(" ");
if(a){if(128<a.length)return this._nameInput.set("invalidMessage",this.i18n.invalidFieldLengthMsg),!1;if(/[\`\~\@\#\$\%\^\&\*\(\)\\\-\+\=\|\,<>\?\/\{\}\.\!\'\[\]\:\;\n\r\s]/.test(a))return this._nameInput.set("invalidMessage",this.i18n.inValidFielNameCharMsg),!1;if(/[\`\~\@\#\$\%\^\&\*\(\)\\\-\+\=\|\,<>\?\/\{\}\.\!\'\[\]\:\;\n\r\d\_]/.test(a.charAt(0)))return this._nameInput.set("invalidMessage",this.i18n.inValidFieldStartCharMsg),!1;if(-1!==k.indexOf(b,a.toUpperCase()))return this._nameInput.set("invalidMessage",
this.i18n.invalidSqlkeywordsMsg),!1;if(this.params.layer.fields&&0<this.params.layer.fields.length&&(b=k.map(this.params.layer.fields,function(a){return a.name.toLowerCase()}),-1!==k.indexOf(b,a.toLowerCase())))return this._nameInput.set("invalidMessage",this.i18n.sameFielNameMsg),!1}else return!1;return!0}});p("extend-esri")&&d.setObject("arcgisonline.sharing.dijit.dialog.TableAddFieldDlg",e);return e});