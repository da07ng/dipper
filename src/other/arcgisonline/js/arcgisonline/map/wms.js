// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/map/wms",["dijit","dojo","dojox","dojo/require!dojo/io/script,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/map/main,esri/WKIDUnitConversion"],function(r,e,s){e.provide("arcgisonline.map.wms");e.require("dojo.io.script");e.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");e.require("arcgisonline.map.main");e.require("esri.WKIDUnitConversion");arcgisonline.map.wms={_WEB_MERCATOR:[3857,102113,102100,900913],_GCS:[4001,4002,4003,4004,4005,4006,4007,4008,4009,4010,
4011,4012,4013,4014,4015,4016,4018,4019,4020,4021,4022,4023,4024,4025,4027,4028,4029,4031,4032,4033,4034,4035,4036,4042,4044,4045,4046,4047,4052,4053,4054,4075,4081,4120,4121,4122,4123,4124,4125,4126,4127,4128,4129,4130,4131,4132,4133,4134,4135,4136,4137,4138,4139,4140,4141,4142,4143,4144,4145,4146,4147,4148,4149,4150,4151,4152,4153,4154,4155,4156,4157,4158,4159,4160,4161,4162,4163,4164,4165,4166,4167,4168,4169,4170,4171,4172,4173,4174,4175,4176,4178,4179,4180,4181,4182,4183,4184,4185,4188,4189,4190,
4191,4192,4193,4194,4195,4196,4198,4199,4200,4201,4202,4203,4204,4205,4206,4207,4208,4209,4210,4211,4212,4213,4214,4215,4216,4217,4218,4219,4220,4221,4222,4223,4224,4225,4226,4227,4228,4229,4230,4231,4232,4233,4234,4235,4236,4237,4238,4239,4240,4241,4242,4243,4244,4245,4246,4247,4248,4249,4250,4251,4252,4253,4254,4255,4256,4257,4258,4259,4260,4261,4262,4263,4264,4265,4266,4267,4268,4269,4270,4271,4272,4273,4274,4275,4276,4277,4278,4279,4280,4281,4282,4283,4284,4285,4286,4287,4288,4289,4291,4292,4293,
4294,4295,4296,4297,4298,4299,4300,4301,4302,4303,4304,4305,4306,4307,4308,4309,4310,4311,4312,4313,4314,4315,4316,4317,4318,4319,4322,4324,4326,4404,4466,4469,4475,4483,4490,4555,4600,4601,4602,4603,4604,4605,4606,4607,4608,4609,4610,4611,4612,4613,4614,4615,4616,4617,4618,4619,4620,4621,4622,4623,4624,4625,4626,4627,4628,4629,4630,4631,4632,4633,4636,4637,4638,4639,4640,4641,4642,4643,4644,4645,4646,4657,4658,4659,4660,4661,4662,4663,4664,4665,4666,4667,4668,4669,4670,4671,4672,4673,4674,4675,4676,
4677,4678,4679,4680,4682,4683,4684,4686,4687,4688,4689,4690,4691,4692,4693,4694,4695,4696,4697,4698,4699,4700,4701,4702,4703,4704,4705,4706,4707,4708,4709,4710,4711,4712,4713,4714,4715,4716,4717,4718,4719,4720,4721,4722,4723,4724,4725,4726,4727,4728,4729,4730,4731,4732,4733,4734,4735,4736,4737,4738,4739,4740,4741,4742,4743,4744,4745,4746,4747,4748,4749,4750,4751,4752,4753,4754,4755,4756,4757,4758,4759,4760,4761,4762,4763,4764,4765,4801,4802,4803,4804,4805,4806,4807,4808,4809,4810,4811,4812,4813,4814,
4815,4816,4817,4818,4819,4820,4821,4823,4824,4901,4902,4903,4904,37001,37002,37003,37004,37005,37006,37007,37008,37201,37202,37203,37204,37205,37206,37207,37208,37211,37212,37213,37214,37215,37216,37217,37218,37219,37220,37221,37222,37223,37224,37225,37226,37227,37228,37229,37230,37231,37232,37233,37234,37235,37237,37238,37239,37240,37241,37242,37243,37245,37246,37247,37249,37250,37251,37252,37253,37254,37255,37257,37259,37260,104E3,104023,104100,104101,104102,104103,104104,104105,104106,104107,104108,
104109,104110,104111,104112,104113,104114,104115,104116,104117,104118,104119,104120,104121,104122,104123,104124,104125,104126,104127,104128,104129,104130,104131,104132,104133,104134,104135,104136,104137,104138,104139,104140,104141,104142,104143,104144,104199,104223,104256,104258,104259,104260,104261,104304,104305,104700,104701,104702,104703,104704,104705,104706,104707,104708,104709,104710,104711,104712,104713,104714,104715,104716,104717,104718,104719,104720,104721,104722,104723,104724,104725,104726,
104727,104728,104729,104730,104731,104732,104733,104734,104735,104736,104737,104738,104739,104740,104741,104742,104743,104744,104745,104746,104747,104748,104749,104750,104751,104752,104753,104754,104755,104756,104757,104758,104759,104760,104761,104762,104763,104764,104765,104766,104767,104768,104769,104770,104771,104772,104773,104774,104775,104776,104777,104778,104779,104780,104781,104782,104783,104784,104785,104786,104800,104801,104802,104803,104804,104805,104806,104807,104808,104809,104810,104811,
104812,104813,104814,104815,104816,104817,104818,104819,104820,104821,104822,104823,104824,104825,104826,104827,104828,104829,104830,104831,104832,104833,104834,104835,104836,104837,104838,104839,104840,104841,104842,104843,104844,104845,104846,104847,104848,104849,104850,104851,104852,104853,104854,104855,104856,104857,104858,104859,104860,104861,104862,104863,104864,104865,104866,104867,104868,104869,104870,104871,104896,104900,104901,104902,104903,104904,104905,104906,104907,104908,104909,104910,
104911,104912,104913,104914,104915,104916,104917,104918,104919,104920,104921,104922,104923,104924,104925,104926,104927,104928,104929,104930,104931,104932,104933,104934,104935,104936,104937,104938,104939,104940,104941,104942,104943,104944,104945,104946,104947,104948,104949,104950,104951,104952,104953,104954,104955,104956,104957,104958,104959,104960,104961,104962,104963,104964,104965,104966,104967,104968,104969,104970,104990,104991,104992],addWMSService:function(a,b,c,d){d=Math.floor(10001*Math.random());
d={layer:null,id:a.id||"wms_"+d,itemId:a.itemId,url:a.url,type:"user",title:a.title||"",defaultVisibility:esri.isDefined(a.visibility)?a.visibility:!0,defaultOpacity:esri.isDefined(a.opacity)?a.opacity:1,snippet:"",identify:!1,visibleLayers:a.visibleLayers?a.visibleLayers.toString():null,refreshInterval:a.refreshInterval,hadError:!1};var e=arcgisonline.map.layer.getLayerPosition(d);arcgisonline.map.main.mapLayers.splice(e.list,0,d);arcgisonline.map.wms.createWMSLayer(d,e.map,a.visibleLayers,a.resourceInfo,
b,c)},createWMSLayer:function(a,b,c,d,f,g,l){var h={id:a.id,visible:a.defaultVisibility,refreshInterval:a.refreshInterval};d&&(h.resourceInfo=d);c&&(h.visibleLayers=c);null!==a.defaultOpacity&&(h.opacity=a.defaultOpacity);a.refreshInterval&&(h.refreshInterval=a.refreshInterval,delete a.refreshInterval);a.layer=new esri.layers.WMSLayer(a.url,h);c=function(a,b){console.error(b);l&&l();if(!a.layer||!a.layer.loaded){var c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();d?
c.show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:e.string.substitute(esri.i18nBundle.viewer.wms.serviceNotAvailable,{title:d.title})}):c.showWide({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:e.string.substitute(esri.i18nBundle.viewer.wms.invalidUrl,{url:a.url})});arcgisonline.map.layer.removeLayer(a);e.publish("layerAddFailed",[a.id]);arcgisonline.map.main.mapInitialized||arcgisonline.map.main.initMap()}};a.onError=e.connect(a.layer,"onError",e.hitch(this,c,a));if(!a.layer.loaded&&
a.layer.loadError)c(a,a.layer.loadError);else if(a.layer.loaded)arcgisonline.map.wms.onWMSLayerLoadHandler(a,d,b,f,g);else e.connect(a.layer,"onLoad",e.hitch(arcgisonline.map.wms,"onWMSLayerLoadHandler",a,d,b,f,g))},onWMSLayerLoadHandler:function(a,b,c,d,f){b||arcgisonline.map.wms.organizeLayerStructure(a.layer);if(a.minScale||a.maxScale)a.layer.setScaleRange(a.minScale,a.maxScale),a.scaleChanged=!0,delete a.minScale,delete a.maxScale;a.title=a.title||a.layer.title;!a.layer.copyright||"none"===a.layer.copyright.toLowerCase()?
a.layer.copyright="":180<a.layer.copyright.length&&(a.layer.copyright=a.layer.copyright.substring(0,180)+esri.i18nBundle.viewer.shortenedTextEnding);a.layer.transparent=!0;if(!b||"item"===d){if(null===a.visibleLayers){d=[];if(a.layer.layerInfos&&0<a.layer.layerInfos.length)for(b=0;b<a.layer.layerInfos.length;b++){var g=a.layer.layerInfos[b].name;if(g&&0<g.length){d.push(g);break}}else d.push(a.layer.name);a.visibleLayers=d.toString();a.layer.visibleLayers=d}b=arcgisonline.map.main.checkMapSpatialReference();
-1<a.url.toLowerCase().indexOf("/arcgis/")&&a.layer.spatialReferences.unshift(b.mapSR.wkid);var l=!1,h=!1;e.forEach(a.layer.spatialReferences,function(a){4326===a?h=!0:arcgisonline.map.wms.contains(a,arcgisonline.map.wms._WEB_MERCATOR)&&(l=!0)},this);if(b.mapIsWebMercator&&l||b.mapSR.wkid&&arcgisonline.map.wms.contains(b.mapSR.wkid,a.layer.spatialReferences)||b.mapSR.latestWkid&&arcgisonline.map.wms.contains(b.mapSR.latestWkid,a.layer.spatialReferences)){d=e.filter(a.layer.spatialReferences,function(b){return e.some(a.layer._WEB_MERCATOR,
function(a){return a==b})},this);g=!1;for(b=0;b<d.length;b++)if(a.layer.allExtents[d[b]]){a.layer.fullExtent=a.layer.allExtents[d[b]];g=!0;break}g||(a.layer.fullExtent=a.layer.allExtents[0]);a.layer.extent=a.layer.fullExtent;arcgisonline.map.main.projectToMapAndZoom(a.layer.extent.getExtent(),0,0,e.hitch(this,function(){arcgisonline.map.main.map.addLayer(a.layer,c);e.publish("layerAdded",[a.id]);f&&f(a)},this))}else if(1===arcgisonline.map.main.numOperationalLayers()&&"defaultBasemap"===arcgisonline.map.main.mapLayers[0].id)if(h){a.layer.fullExtent=
a.layer.allExtents[0];a.layer.extent=a.layer.fullExtent;b=esriGeowConfig.gcsBasemapService.lastIndexOf("/");d=esriGeowConfig.gcsBasemapService.substring(0,b);b=d.lastIndexOf("/");d=d.substring(b+1);b={baseMap:{baseMapLayers:[{id:"gcsDefaultBasemap",opacity:1,visibility:!0,url:esriGeowConfig.gcsBasemapService}],title:d}};var k=e.subscribe("onMapLoad",e.hitch(this,function(b,d){e.unsubscribe(k);4326!==d.spatialReference.wkid?arcgisonline.map.main.sameSpatialReference(arcgisonline.map.main.map.spatialReference,
d.spatialReference)?(setTimeout(function(){arcgisonline.map.main.map.setExtent(d,!0)},500),e.publish("layerAdded",[b]),f&&f(a)):arcgisonline.map.main.projectToMapSpatialReference(d,e.hitch(this,function(c,g){c&&(0<c.length&&c[0]&&"extent"===c[0].type)&&(d=c[0],arcgisonline.map.main.map.setExtent(d,!0),e.publish("layerAdded",[b]),f&&f(a))})):(e.publish("layerAdded",[b]),f&&f(a))},a.id,a.layer.fullExtent.getExtent()));d=null;4326===a.layer.fullExtent.spatialReference.wkid&&(d=[[a.layer.fullExtent.xmin,
a.layer.fullExtent.ymin],[a.layer.fullExtent.xmax,a.layer.fullExtent.ymax]]);arcgisonline.map.save_open.switchOrRecreateBasemap(b,d)}else{d=[];for(b=0;b<a.layer.layerInfos.length&&!(g=a.layer.layerInfos[b],g.name&&0<g.name.length&&d.push(g.name),9<d.length);b++);a.visibleLayers=d.toString();a.layer.setVisibleLayers(d);b=a.layer.spatialReferences[0];900913===b&&(b=a.layer.spatialReferences[1]);a.layer.fullExtent=a.layer.allExtents[b]?a.layer.allExtents[b]:a.layer.allExtents[0];a.layer.extent=a.layer.fullExtent;
arcgisonline.map.main.mapInitialized=!1;arcgisonline.map.wms.addWMSAsBaseLayer(null,d,a,f)}else arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:e.string.substitute(esri.i18nBundle.viewer.wms.itemDoesntAlign,{title:a.title})}),arcgisonline.map.layer.removeLayer(a),e.publish("layerAddedNoRemove",[a.id])}else arcgisonline.map.main.map.addLayer(a.layer,c),e.publish("layerAdded",[a.id]),f&&f(a)},addWMSAsBaseLayer:function(a,
b,c,d,f){arcgisonline.map.main.isUserBaseService=!0;var g=function(){e.unsubscribe(n);e.unsubscribe(p);e.unsubscribe(q);arcgisonline.map.main.currentBaseService=c.id;arcgisonline.map.main.defaultService=c;arcgisonline.map.main.initMap(arcgisonline.map.main.defaultExtent);d&&d()},l="",h="",k="wms_"+Math.floor(10001*Math.random()),m=null;a?(l=a.title,h=a.url,k=a.id?a.id:k,m=a.refreshInterval):c&&(l=c.title,h=c.url,k=c.id);c?(c.type="base",arcgisonline.map.main.mapLayers=[],arcgisonline.map.main.mapLayers.push(c)):
(c={layer:null,id:k,url:h,type:"base",subType:"wms",title:l,defaultVisibility:!0,defaultOpacity:1,snippet:"",identify:!1,visibleLayers:b?b.toString():null,refreshInterval:m,hadError:!1,successfulDraw:!1,resourceInfo:a},arcgisonline.map.main.mapLayers.splice(0,1,c),arcgisonline.map.layer.removeLabelsLayers());var n=e.subscribe("layerAdded",e.hitch(this,g)),p=e.subscribe("layerAddedNoRemove",e.hitch(this,g)),q=e.subscribe("layerAddFailed",e.hitch(this,function(a,b){e.unsubscribe(n);e.unsubscribe(p);
e.unsubscribe(q);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:e.string.substitute(esri.i18nBundle.viewer.wms.itemCannotAdd,{title:l})});arcgisonline.map.layer.loadDefaultMap()})),g=function(d,c,g,h){f?(arcgisonline.map.main.defaultExtent=g[0],arcgisonline.map.main.mapLods=null,arcgisonline.map.main.baseTilingSchemeScales="",arcgisonline.map.save_open.prepRecreateMap(d,arcgisonline.map.main.defaultExtent.spatialReference,
arcgisonline.map.main.map.extent)):(arcgisonline.map.main.destroyMapObject(),arcgisonline.map.main.defaultExtent=g[0],arcgisonline.map.main.mapLods=null,arcgisonline.map.main.baseTilingSchemeScales="",arcgisonline.map.main.createMapObject(e.hitch(this,function(){arcgisonline.map.save_open.onRecreateMapLoad(c)}),arcgisonline.map.main.defaultExtent),a?arcgisonline.map.wms.createWMSLayer(d,0,b,a):arcgisonline.map.main.map.addLayer(d.layer,0),e.publish("layerAddedNoRemove",[d.id]),e.publish("onLayerUpdate",
[""]))},h=function(a,b){arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:esri.i18nBundle.viewer.wms.wmsCannotAdd})};a?(k=a.extent,m=a.spatialReferences):(k=c.layer.extent,m=c.layer.spatialReferences);m=arcgisonline.map.wms.getWkidOfService(m);k.spatialReference?arcgisonline.map.main.projectExtent(k,new esri.SpatialReference({wkid:m}),e.hitch(this,g,c,k.spatialReference),e.hitch(this,h)):(k.spatialReference=new esri.SpatialReference({wkid:m}),
arcgisonline.map.main.defaultExtent=k,arcgisonline.map.main.mapLods=null,arcgisonline.map.main.baseTilingSchemeScales="",arcgisonline.map.main.createMapObject(e.hitch(this,function(){arcgisonline.map.save_open.onRecreateMapLoad(null)}),arcgisonline.map.main.defaultExtent),arcgisonline.map.wms.createWMSLayer(c,0,b,a))},addWMSItem:function(a){arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"content/items/"+a.id+"/data",e.hitch(this,function(b,c){b&&b.url?arcgisonline.map.wms.loadWMSFromItemConfig(b||
{},a,e.hitch(this,function(b,c){e.publish("ServiceAnswerReceived",[]);null!=arcgisonline.map.save_open.itemCard&&null!=a&&arcgisonline.map.save_open.itemCard.id===a.id?(null===arcgisonline.map.save_open.webMapInfo&&arcgisonline.map.main.setTitle(a.title),arcgisonline.map.leftPanel.recreateAboutStack(),arcgisonline.map.leftPanel.openLeftTOCPanel()):null===arcgisonline.map.save_open.webMapInfo&&null===arcgisonline.map.save_open.itemCard&&arcgisonline.map.main.setTitle(esri.i18nBundle.viewer.defaultMapTitle)})):
arcgisonline.map.wms.addWMSService({itemCard:a,itemId:a.id,title:a.title,url:a.url},"item",e.hitch(this,function(){e.publish("ServiceAnswerReceived",[]);null!=arcgisonline.map.save_open.itemCard&&null!=a&&arcgisonline.map.save_open.itemCard.id===a.id?(null===arcgisonline.map.save_open.webMapInfo&&arcgisonline.map.main.setTitle(a.title),arcgisonline.map.leftPanel.recreateAboutStack(),arcgisonline.map.leftPanel.openLeftTOCPanel()):null===arcgisonline.map.save_open.webMapInfo&&null===arcgisonline.map.save_open.itemCard&&
arcgisonline.map.main.setTitle(esri.i18nBundle.viewer.defaultMapTitle)}),e.hitch(this,function(){}))}),e.hitch(this,function(a,c){console.log(a);e.publish("ServiceAnswerReceived",[]);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:esri.i18nBundle.viewer.wms.downloadFailed})}))},addWMSUrlAsBasemap:function(a,b,c){var d="wms_"+Math.floor(10001*Math.random()),d=new esri.layers.WMSLayer(a,{id:d}),f=function(d){var c=
arcgisonline.map.wms.getResourceInfoFromLayer(d);c.title=d.title;c.url=a;c.id=d.id;for(var e=[],f=0;f<d.layerInfos.length;f++){var m=d.layerInfos[f];m.name&&0<m.name.length&&e.push(m.name);if(9<e.length)break}d=arcgisonline.map.wms.getWkidOfService(d.spatialReferences);arcgisonline.map.save_open.checkIfOpLayersFitToNewBasemap(new esri.SpatialReference({wkid:d}))&&arcgisonline.map.wms.addWMSAsBaseLayer(c,e,null,null,!0);b&&b()};e.connect(d,"onError",e.hitch(this,function(b){console.error(e.json.stringify(b));
c&&c();arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().showWide({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:e.string.substitute(esri.i18nBundle.viewer.wms.invalidUrl,{url:a})})}));d.loaded?f(d):e.connect(d,"onLoad",e.hitch(this,f))},addWMSItemAsBasemap:function(a){arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"content/items/"+a.id+"/data",e.hitch(this,function(b,c){b||(b={});var d=arcgisonline.map.wms.buildResourceInfo(b,a.extent),e=arcgisonline.map.wms.getWkidOfService(b.spatialReferences);
arcgisonline.map.save_open.checkIfOpLayersFitToNewBasemap(new esri.SpatialReference({wkid:e}))&&arcgisonline.map.wms.addWMSAsBaseLayer(d.resourceInfo,d.visibleLayers,null,null,!0)}),e.hitch(this,function(a,c){console.log(a);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:esri.i18nBundle.viewer.wms.downloadFailed});e.publish("layerAddFailed",[parameterList.id])}))},loadWMSFromWebmapConfig:function(a,b,c,d){var f=
{layer:null,id:b.id,itemId:b.itemId,url:a,type:c||"user",title:b.title,defaultVisibility:b.visibility,defaultOpacity:b.opacity,minScale:b.minScale,maxScale:b.maxScale,refreshInterval:b.refreshInterval,snippet:"",identify:!1,hadError:!1},g=arcgisonline.map.layer.getLayerPosition(f);arcgisonline.map.main.mapLayers.splice(g.list,0,f);c=b.wmsInfo;var l=e.map(c.layers,function(a){return new esri.layers.WMSLayerInfo({name:a.name,title:a.title,legendURL:a.legendURL})});c={url:a,extent:new esri.geometry.Extent(c.extent[0][0],
c.extent[0][1],c.extent[1][0],c.extent[1][1],new esri.SpatialReference({wkid:4326})),layerInfos:l,version:c.version,maxWidth:c.maxWidth,maxHeight:c.maxHeight,getMapURL:c.mapUrl,spatialReferences:c.spatialReferences,title:c.title,copyright:c.copyright,format:c.format};f.layer=new esri.layers.WMSLayer(a,{id:f.id,resourceInfo:c,refreshInterval:f.refreshInterval});f.onError=e.connect(f.layer,"onError",e.hitch(this,function(a){console.error(e.json.stringify(a))}));a=function(){e.publish("ServiceAnswerReceived",
[]);b.visibleLayers&&0<b.visibleLayers.length&&(f.visibleLayers=b.visibleLayers,f.layer.setVisibleLayers(b.visibleLayers.split(",")));f.layer.transparent=!0;f.layer.setOpacity(b.opacity);f.layer.setVisibility(b.visibility);if(f.minScale||f.maxScale)f.layer.setScaleRange(f.minScale,f.maxScale),f.scaleChanged=!0,delete f.minScale,delete f.maxScale;setTimeout(e.hitch(this,function(){arcgisonline.map.main.map.addLayer(f.layer,g.map)}),1);d&&d(f)};f.layer.loaded?a():e.connect(f.layer,"onLoad",e.hitch(this,
a))},loadWMSFromItemConfig:function(a,b,c){var d=arcgisonline.map.wms.buildResourceInfo(a,b.extent),e=d.resourceInfo;e.itemId=b.id;d=d.visibleLayers;10<d.length&&(d.length=10);arcgisonline.map.wms.addWMSService({url:a.url,itemId:b.id,visibleLayers:d,refreshInterval:a.refreshInterval,opacity:a.opacity,visibility:a.visibility,resourceInfo:e},"item",c)},buildResourceInfo:function(a,b){var c=b;if(!c||0===c.length)c=new esri.geometry.Extent(-180,-90,180,90,new esri.SpatialReference({wkid:4326}));c instanceof
esri.geometry.Extent||(c=new esri.geometry.Extent(b[0][0],b[0][1],b[1][0],b[1][1],new esri.SpatialReference({wkid:4326})));var d=[],f=[];e.forEach(a.layers,function(a){f.push(new esri.layers.WMSLayerInfo({name:a.name,title:a.title,legendURL:a.legendURL}));d.push(a.name)},this);a.visibleLayers&&(d=a.visibleLayers);return{resourceInfo:{url:a.url,extent:c,layerInfos:f,version:a.version,maxWidth:a.maxWidth,maxHeight:a.maxHeight,minScale:a.minScale,maxScale:a.maxScale,getMapURL:a.mapUrl,spatialReferences:a.spatialReferences,
title:a.title,copyright:a.copyright,format:a.format},visibleLayers:d}},getResourceInfoFromLayer:function(a){var b=e.map(a.layerInfos,function(a){return e.clone(a)});return{extent:a.extent,layerInfos:b,version:a.version,maxWidth:a.maxWidth,maxHeight:a.maxHeight,minScale:a.minScale,maxScale:a.maxScale,getMapURL:a.getMapURL,spatialReferences:a.spatialReferences,title:a.title,copyright:a.copyright,format:a.getImageFormat()}},buildConfig:function(a){var b={};if(a instanceof esri.layers.WMSLayer){b.type=
"WMS";b.layerType="WMS";b.version=a.version;a.getMapURL&&(b.mapUrl=a.getMapURL);b.layers=[];e.forEach(a.layerInfos,function(a){var c={name:a.name,title:a.title};a.legendURL&&(c.legendURL=a.legendURL);b.layers.push(c)});b.spatialReferences=e.map(a.spatialReferences,function(a){return a});var c=a.extent;b.extent=[[c.xmin,c.ymin],[c.xmax,c.ymax]];a.copyright&&(b.copyright=a.copyright);0<a.maxWidth&&(0<a.maxHeight&&5E3!=a.maxWidth&&5E3!=a.maxHeight)&&(b.maxWidth=a.maxWidth,b.maxHeight=a.maxHeight);a.refreshInterval&&
(b.refreshInterval=a.refreshInterval);a=a.getImageFormat();"png"!=a&&(b.format=a)}return b},checkIfFitsToNewBasemap:function(a,b){if(b.wkid){if(-1<a.url.toLowerCase().indexOf("/arcgis/"))return!0;var c=!1;arcgisonline.map.wms.contains(b.wkid,arcgisonline.map.wms._WEB_MERCATOR)&&(c=!0);var d=!1;e.forEach(a.spatialReferences,function(a){arcgisonline.map.wms.contains(a,arcgisonline.map.wms._WEB_MERCATOR)&&(d=!0)},this);if(c&&d||arcgisonline.map.wms.contains(b.wkid,a.spatialReferences)||b.latestWkid&&
arcgisonline.map.wms.contains(b.latestWkid,a.spatialReferences))return!0}else return!1},organizeLayerStructure:function(a){var b=function(a,c){e.forEach(a,function(a){a.subLayers&&0<a.subLayers.length?b(a.subLayers,c):c.push(a)},this)};if(a.layerInfos){var c=[];b(a.layerInfos,c);a.layerInfos=c}},getWkidOfService:function(a){for(var b=-1,c=-1,d=0;d<a.length;d++){var e=esri.isDefined(esri.WKIDUnitConversion[a[d]]),g=arcgisonline.map.wms.contains(a[d],arcgisonline.map.wms._GCS);if((e||g)&&4326!==a[d]){b=
d;break}else 4326===a[d]&&(c=d)}-1<b?(wkid=a[b],0<b&&(a[b]=a[0],a[0]=wkid)):-1<c?(wkid=a[c],0<c&&(a[c]=a[0],a[0]=wkid)):wkid=a[0];return wkid},contains:function(a,b){for(var c=0;c<b.length;c++)if(b[c]===a)return!0;return!1}}});