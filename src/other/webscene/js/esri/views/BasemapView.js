// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define(["../core/declare","../core/Accessor","../core/Collection"],function(g,h,k){return g([h],{declaredClass:"esri.views.BasemapView",classMetadata:{properties:{view:{},suspended:{readOnly:!0,dependsOn:["view.suspended"]}},computed:{baseLayerViews:["view.map.basemap.baseLayers"],referenceLayerViews:["view.map.basemap.referenceLayers"],elevationLayerViews:["view.map.basemap.elevationLayers"]}},constructor:function(){this._handles={};this._lyrColHandler=this._lyrColHandler.bind(this)},destroy:function(){this.view=
null},_suspendedGetter:function(){return this.view?this.view.suspended:!0},_baseLayerViewsGetter:function(a){return this._lyrsToLyrViews("baseLayers",a)},_referenceLayerViewsGetter:function(a){return this._lyrsToLyrViews("referenceLayers",a)},_elevationLayerViewsGetter:function(a){return this._lyrsToLyrViews("elevationLayers",a)},_lyrsToLyrViews:function(a,b){var c=this.get("view.map.basemap."+a);this._handles[a]&&(this._handles[a].remove(),this._handles[a]=null,this._clearViews(b));b||(b=new k);
c&&(this._addAll(c),this._handles[a]=c.on("change",this._lyrColHandler));return b},_clearViews:function(a){a.drain(function(a){a.view.factory.dispose(a);a.set("parent",null)},this)},_addAll:function(a){a.forEach(function(b){this._createLyrView(a,b)},this)},_createLyrView:function(a,b){this.view.factory.create(b).then(function(c){if(this.view&&-1<a.indexOf(b)&&-1===this._getViewsCol(a).indexOf(c)){var d=this._getLyrViewIdxCandidate(a,b);c.set({parent:this,layer:b});this._getViewsCol(a).addItem(c,d)}}.bind(this),
function(a){a=!a?{}:a.message?a:a.error;a.message&&-1===a.message.indexOf("No LayerView module")&&console.error(a)}.bind(this))},_removeLyrView:function(a,b){var c=this.view,d=this._getViewsCol(a),e=d.findIndex(function(a){return a.layer===b});if(-1<e){var f=d.getItemAt(e);d.removeItemAt(e);c.factory.dispose(f);f.set("parent",null)}},_reorderLyrView:function(a,b,c){a=this._getViewsCol(a);var d=a.find(function(a){return a.layer===b});d&&a.moveItem(d,c)},_getLyrViewIdxCandidate:function(a,b){var c=
this._getViewsCol(a),d=a.indexOf(b),d=c.findIndex(function(b){return a.indexOf(b.layer)>d});return-1<d?d:c.length},_lyrColHandler:function(a){var b=a.target;a.added.forEach(function(a){this._createLyrView(b,a)},this);a.removed.forEach(function(a){this._removeLyrView(b,a)},this);a.moved.forEach(function(a){this._reorderLyrView(b,a,b.indexOf(a))},this)},_getViewsCol:function(a){var b=this.get("view.map.basemap");if(a===b.baseLayers)return this.baseLayerViews;if(a===b.referenceLayers)return this.referenceLayerViews;
if(a===b.elevationLayers)return this.elevationLayerViews}})});