// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
require({cache:{"url:arcgisonline/sharing/dijit/templates/ConfigureAGOLUtilServices.html":'\x3cdiv\x3e\r\n  \x3cdiv\x3e\r\n    ${i18n.description}\r\n    \x3col\x3e\r\n      \x3cli\x3e${i18n.descriptionPoint1}\x3c/li\x3e\r\n      \x3cli\x3e${i18n.descriptionPoint2}\x3c/li\x3e\r\n      \x3cli\x3e${i18n.descriptionPoint3}\x3c/li\x3e\r\n    \x3c/ol\x3e\r\n    ${i18n.descriptionNote}\r\n    \x3cbr\x3e\x3cbr\x3e\r\n    ${i18n.deselectNote}\r\n  \x3c/div\x3e\r\n  \x3cbr\x3e\x3cbr\x3e\r\n\r\n  \x3cdiv class\x3d"serviceContainer"\x3e\r\n    \x3cdiv\x3e\r\n      \x3cdiv class\x3d"inlineBlock"\x3e\r\n        \x3cinput type\x3d"checkbox" id\x3d"elevationChkBox" data-dojo-attach-point\x3d"_elevationChkBox"\r\n               data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n        \x3clabel for\x3d"elevationChkBox"\x3e${i18n.services.elevation}\x3c/label\x3e\r\n      \x3c/div\x3e\x3c!--col1--\x3e\r\n      \x3cdiv class\x3d"inlineBlock"\x3e\r\n        \x3cinput type\x3d"checkbox" id\x3d"geocodeChkBox" data-dojo-attach-point\x3d"_geocodeChkBox"\r\n               data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n        \x3clabel for\x3d"geocodeChkBox"\x3e${i18n.services.geocode}\x3c/label\x3e\r\n      \x3c/div\x3e\x3c!--col2--\x3e\r\n    \x3c/div\x3e\x3c!--row1--\x3e\r\n    \x3cdiv\x3e\x26nbsp;\x3c/div\x3e\r\n    \x3cdiv\x3e\r\n      \x3cdiv class\x3d"inlineBlock"\x3e\r\n        \x3cinput type\x3d"checkbox" id\x3d"geoenrichChkBox" data-dojo-attach-point\x3d"_geoenrichChkBox"\r\n               data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n        \x3clabel for\x3d"geoenrichChkBox"\x3e${i18n.services.geoenrichment}\x3c/label\x3e\r\n      \x3c/div\x3e\x3c!--col1--\x3e\r\n      \x3cdiv class\x3d"inlineBlock"\x3e\r\n        \x3cinput type\x3d"checkbox" id\x3d"hydrologyChkBox" data-dojo-attach-point\x3d"_hydrologyChkBox"\r\n               data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n        \x3clabel for\x3d"hydrologyChkBox"\x3e${i18n.services.hydrology}\x3c/label\x3e\r\n      \x3c/div\x3e\x3c!--col2--\x3e\r\n    \x3c/div\x3e\x3c!--row2--\x3e\r\n    \x3cdiv\x3e\x26nbsp;\x3c/div\x3e\r\n    \x3cdiv\x3e\r\n      \x3cdiv class\x3d"inlineBlock"\x3e\r\n        \x3cinput type\x3d"checkbox" id\x3d"networkChkBox" data-dojo-attach-point\x3d"_networkChkBox"\r\n               data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n        \x3clabel for\x3d"networkChkBox"\x3e${i18n.services.network}\x3c/label\x3e\r\n      \x3c/div\x3e\x3c!--col2--\x3e\r\n      \x3cdiv class\x3d"inlineBlock"\x3e\r\n        \x3cinput type\x3d"checkbox" id\x3d"routeChkBox" data-dojo-attach-point\x3d"_routeChkBox"\r\n               data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n        \x3clabel for\x3d"routeChkBox"\x3e${i18n.services.route}\x3c/label\x3e\r\n      \x3c/div\x3e\x3c!--col3--\x3e\r\n    \x3c/div\x3e\x3c!--row3--\x3e\r\n  \x3c/div\x3e\r\n  \x3cbr class\x3d"clearBoth"\x3e\x3cbr\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"_credentialContainer"\x3e\r\n    \x3cdiv\x3e\r\n      ${i18n.enterCredentials}\r\n      \x3cbr\x3e\x3cbr\x3e\r\n      \x3clabel data-dojo-attach-point\x3d"_servicesSelected"\x3e\x3c/label\x3e\r\n      \x3cbr\x3e\x3cbr\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_credentials" class\x3d"${baseClass} credentials esriAlignLeading valignTop" style\x3d"clear:both;"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"folderLabel"\x3e${i18n.folderLabel}\x3c/div\x3e\r\n    \x3cdiv class\x3d"arrowSpaceMedium" data-dojo-attach-point\x3d"_folderSelect"\r\n         data-dojo-type\x3d"arcgisonline/sharing/dijit/ComboBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cbr class\x3d"clearBoth"\x3e\r\n  \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n    \x3cbutton type\x3d"button" class\x3d"calcite btn tertiary small"\r\n            data-dojo-type\x3d"dijit/form/Button" data-dojo-attach-point\x3d"_okBtn"\x3e${i18n.configure}\x3c/button\x3e\r\n  \x3c/div\x3e\r\n  \x3cbr class\x3d"clearBoth"\x3e\r\n\x3c/div\x3e\r\n'}});
define("arcgisonline/sharing/dijit/ConfigureAGOLUtilServices","require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/on dojo/json dojo/promise/all dojo/topic dojo/date/locale dojo/cookie dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/Deferred dojo/store/Memory dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin arcgisonline/sharing/dijit/dialog/_AddItemDlgMixin dijit/Dialog dijit/form/Button dijit/form/CheckBox dijit/form/TextBox arcgisonline/sharing/dijit/ComboBox esri/lang esri/request arcgisonline/sharing/util arcgisonline/sharing/geow/Folder arcgisonline/sharing/dijit/ServiceInfo arcgisonline/sharing/dijit/dialog/GeneralDlg arcgisonline/sharing/geow/Account dojo/i18n!arcgisonline/nls/arcgisonline dojo/text!arcgisonline/sharing/dijit/templates/ConfigureAGOLUtilServices.html".split(" "),
function(E,F,p,x,G,f,v,H,I,J,y,U,z,w,B,K,L,M,N,V,W,X,Y,Z,g,O,h,P,Q,R,S,C,T){var A=F("arcgisonline.sharing.dijit.ConfigureAGOLUtilServices",[K,L,M,N],{declaredClass:"arcgisonline.sharing.dijit.ConfigureAGOLUtilServices",baseClass:"esriCfgAGOLUtilSvcs",basePath:E.toUrl("arcgisonline/sharing/dijit"),templateString:T,widgetsInTemplate:!0,_okBtn:null,_clearBtn:null,_elevationChkBox:null,_geocodeChkBox:null,_geoenrichChkBox:null,_hydrologyChkBox:null,_networkChkBox:null,_routeChkBox:null,_credentials:null,
_credentialContainer:null,_servicesSelected:null,_geocoderSingleLineFieldName:"SingleLine",postMixInProperties:function(){this.inherited(arguments);this.i18n=p.mixin({},C.common);p.mixin(this.i18n,C.configAGOLUtilServices)},postCreate:function(){this.inherited(arguments);this._setupGeoenrichmentServerSupport();this._setupDialogs();this._setupConnections()},startup:function(){this.inherited(arguments);this._initialize()},_setupGeoenrichmentServerSupport:function(){this.itemInfo.geoenrichmentserver=
{type:"Geoenrichment Service",typeKeywords:"Tool, Service, Geoenrichment Service, ArcGIS Server"}},_setupDialogs:function(){this._generalDlg=R.prototype.statics.getInstance()},_setupConnections:function(){var a=p.hitch(this,this._checkServiceState);this.own(this._okBtn.on("click",p.hitch(this,this._configureClicked)),this._elevationChkBox.on("click",a),this._geocodeChkBox.on("click",a),this._geoenrichChkBox.on("click",a),this._hydrologyChkBox.on("click",a),this._networkChkBox.on("click",a),this._routeChkBox.on("click",
a))},_checkServiceState:function(){var a=[];this._newlyEnabledServices=p.clone(this._currentlyEnabledServices);this._newlyEnabledServices.elevation=this._elevationChkBox.get("checked");this._newlyEnabledServices.geocode=this._geocodeChkBox.get("checked");this._newlyEnabledServices.geoenrichment=this._geoenrichChkBox.get("checked");this._newlyEnabledServices.hydrology=this._hydrologyChkBox.get("checked");this._newlyEnabledServices.network=this._networkChkBox.get("checked");this._newlyEnabledServices.route=
this._routeChkBox.get("checked");!this._currentlyEnabledServices.elevation&&this._newlyEnabledServices.elevation&&a.push(this.i18n.services.elevation);!this._currentlyEnabledServices.geocode&&this._newlyEnabledServices.geocode&&a.push(this.i18n.services.geocode);!this._currentlyEnabledServices.geoenrichment&&this._newlyEnabledServices.geoenrichment&&a.push(this.i18n.services.geoenrichment);!this._currentlyEnabledServices.hydrology&&this._newlyEnabledServices.hydrology&&a.push(this.i18n.services.hydrology);
!this._currentlyEnabledServices.network&&this._newlyEnabledServices.network&&a.push(this.i18n.services.network);!this._currentlyEnabledServices.route&&this._newlyEnabledServices.route&&a.push(this.i18n.services.route);0<a.length?(y.set(this._servicesSelected,"innerHTML",g.substitute({serviceList:a.join(", ")},this.i18n.selectedForConfig)),z.set(this._credentialContainer,"display","")):(y.set(this._servicesSelected,"innerHTML",""),this._serviceInfoPane&&(this._serviceInfoPane._username.set("value",
""),this._serviceInfoPane._password.set("value","")),z.set(this._credentialContainer,"display","none"))},_publishHelperServicesChange:function(a){H.publish("configure-helperServices",a)},_configureClicked:function(a){a&&a.preventDefault();var b=this,d=!b._currentlyEnabledServices.elevation&&b._newlyEnabledServices.elevation,c=!b._currentlyEnabledServices.geocode&&b._newlyEnabledServices.geocode,e=!b._currentlyEnabledServices.geoenrichment&&b._newlyEnabledServices.geoenrichment,n=!b._currentlyEnabledServices.hydrology&&
b._newlyEnabledServices.hydrology,q=!b._currentlyEnabledServices.network&&b._newlyEnabledServices.network,D=!b._currentlyEnabledServices.route&&b._newlyEnabledServices.route,l=b._serviceInfoPane._username.get("value"),g=b._serviceInfoPane._password.get("value"),f=b._folderSelect.get("value");a=d||c||e||n||q||D;var k=b._isStringSet(l),r=b._isStringSet(g),k=k&&r,h={elevation:d,geocode:c,geoenrichment:e,hydrology:n,route:D,network:q,serviceUsername:l,servicePassword:g,folder:b._getFolderId(f)},d=b._currentlyEnabledServices.geocode&&
!b._newlyEnabledServices.geocode,c=b._currentlyEnabledServices.geoenrichment&&!b._newlyEnabledServices.geoenrichment,e=b._currentlyEnabledServices.hydrology&&!b._newlyEnabledServices.hydrology,n=b._currentlyEnabledServices.network&&!b._newlyEnabledServices.network,q=b._currentlyEnabledServices.route&&!b._newlyEnabledServices.route,d=b._currentlyEnabledServices.elevation&&!b._newlyEnabledServices.elevation||d||c||e||n||q;a&&k?(b._setConfiguring(!0),b._retrieveSelfNoAuth().then(function(a){b._selfNoAuth=
a;b._createServiceProxies(h).then(function(a){b._deleteUncheckedItems(a).then(function(a){b._updateAccount(a).then(function(){b._publishHelperServicesChange(a);esriGeowConfig.self=null;b.reset()})})},function(a){console.log("Error creating service proxy items.",a);-1<a.message.indexOf("Error generating token")?b._generalDlg.show({title:b.i18n.errorTitle,message:b.i18n.errors.badCredentials}):b._generalDlg.show({title:b.i18n.errorTitle,message:b.i18n.errors.general});b._setConfiguring(!1)})},function(a){console.log("Unable to retrieve helper services configuration information from ArcGIS Online.",
a);b._generalDlg.show({title:b.i18n.notice,message:b.i18n.cannotReachAGO});b._setConfiguring(!1)})):a&&!k?b._generalDlg.show({title:b.i18n.notice,message:b.i18n.needCredentials}):k&&!a?b._generalDlg.show({title:b.i18n.notice,message:b.i18n.needService}):d?(b._setConfiguring(!0),b._deleteUncheckedItems({}).then(function(a){b._updateAccount(a).then(function(){b._publishHelperServicesChange(a);esriGeowConfig.self=null;b.reset()})})):b._generalDlg.show({title:b.i18n.notice,message:b.i18n.noChange})},
_deleteUncheckedItems:function(a){var b=new w,d=this._currentlyEnabledServices.elevation&&!this._newlyEnabledServices.elevation,c=this._currentlyEnabledServices.geocode&&!this._newlyEnabledServices.geocode,e=this._currentlyEnabledServices.geoenrichment&&!this._newlyEnabledServices.geoenrichment,n=this._currentlyEnabledServices.hydrology&&!this._newlyEnabledServices.hydrology,q=this._currentlyEnabledServices.network&&!this._newlyEnabledServices.network,g=this._currentlyEnabledServices.route&&!this._newlyEnabledServices.route,
l=[],f=esriGeowConfig.restBaseUrl+"content/users/",m=[],k=[];if(d||c||e||n||q||g){d&&(l.push(this._currentlyEnabledServices.elevationItemId),a.elevation={url:""},a.elevationSync={url:""},d=f+this._currentlyEnabledServices.elevationItemOwner+"/"+(this._currentlyEnabledServices.elevationItemFolder?this._currentlyEnabledServices.elevationItemFolder+"/":"")+"items/",k.push(d+this._currentlyEnabledServices.elevationItemId+"/delete"),m.push(this._unprotectItem(this._currentlyEnabledServices.elevationItemId,
this._currentlyEnabledServices.elevationItemOwner,this._currentlyEnabledServices.elevationItemFolder)));c&&(l.push(this._currentlyEnabledServices.geocodeItemId),a.geocode=p.clone(this._portalSettings.helperServices.geocode),a.geocode.splice(this._currentlyEnabledServices.geocodeItemIdx,1),d=f+this._currentlyEnabledServices.geocodeItemOwner+"/"+(this._currentlyEnabledServices.geocodeItemFolder?this._currentlyEnabledServices.geocodeItemFolder+"/":"")+"items/",k.push(d+this._currentlyEnabledServices.geocodeItemId+
"/delete"),m.push(this._unprotectItem(this._currentlyEnabledServices.geocodeItemId,this._currentlyEnabledServices.geocodeItemOwner,this._currentlyEnabledServices.geocodeItemFolder)));e&&(l.push(this._currentlyEnabledServices.geoenrichmentItemId),a.geoenrichment={url:""},d=f+this._currentlyEnabledServices.geoenrichmentItemOwner+"/"+(this._currentlyEnabledServices.geoenrichmentItemFolder?this._currentlyEnabledServices.geoenrichmentItemFolder+"/":"")+"items/",k.push(d+this._currentlyEnabledServices.geoenrichmentItemId+
"/delete"),m.push(this._unprotectItem(this._currentlyEnabledServices.geoenrichmentItemId,this._currentlyEnabledServices.geoenrichmentItemOwner,this._currentlyEnabledServices.geoenrichmentItemFolder)));n&&(l.push(this._currentlyEnabledServices.hydrologyItemId),a.hydrology={url:""},d=f+this._currentlyEnabledServices.hydrologyItemOwner+"/"+(this._currentlyEnabledServices.hydrologyItemFolder?this._currentlyEnabledServices.hydrologyItemFolder+"/":"")+"items/",k.push(d+this._currentlyEnabledServices.hydrologyItemId+
"/delete"),m.push(this._unprotectItem(this._currentlyEnabledServices.hydrologyItemId,this._currentlyEnabledServices.hydrologyItemOwner,this._currentlyEnabledServices.hydrologyItemFolder)));if(q){l=l.concat(this._currentlyEnabledServices.networkItemIds);a.asyncClosestFacility={url:""};a.asyncLocationAllocation={url:""};a.asyncRoute={url:""};a.asyncServiceArea={url:""};a.asyncVRP={url:""};a.closestFacility={url:""};a.serviceArea={url:""};a.syncVRP={url:""};a.traffic={url:""};a.routingUtilities={url:""};
a.asyncRoute={url:""};for(q=0;q<this._currentlyEnabledServices.networkItemIds.length;q++)c=this._currentlyEnabledServices.networkItemIds[q],e=this._currentlyEnabledServices.networkItemOwners[c],n=this._currentlyEnabledServices.networkItemFolders[c],d=f+e+"/"+(n?n+"/":"")+"items/",k.push(d+c+"/delete"),m.push(this._unprotectItem(c,e,n))}g&&(l.push(this._currentlyEnabledServices.routeItemId),a.route={url:""},d=f+this._currentlyEnabledServices.routeItemOwner+"/"+(this._currentlyEnabledServices.routeItemFolder?
this._currentlyEnabledServices.routeItemFolder+"/":"")+"items/",k.push(d+this._currentlyEnabledServices.routeItemId+"/delete"),m.push(this._unprotectItem(this._currentlyEnabledServices.routeItemId,this._currentlyEnabledServices.routeItemOwner,this._currentlyEnabledServices.routeItemFolder)));0<m.length?v(m).then(function(){var c=[];x.forEach(k,function(a){c.push(h.request({url:a},{usePost:!0}))});v(c).then(function(){b.resolve(a)},function(c){console.log("Error deleting old secure proxy items.",c);
b.resolve(a)})},function(c){console.log("Error unprotecting old secure proxy items.",c);b.resolve(a)}):b.resolve(a)}else b.resolve(a);return b.promise},_updateAccount:function(a){var b=new w,d=h.getSecureUrl(esriGeowConfig.restBaseUrl)+"portals/self/update",c=f.stringify(""),e={clearEmptyFields:!0};a.elevation&&(e.elevationService=""===a.elevation.url?c:f.stringify(a.elevation));a.elevationSync&&(e.elevationSyncService=""===a.elevationSync.url?c:f.stringify(a.elevationSync));a.geocode&&(e.geocodeService=
""===a.geocode.url?c:f.stringify(a.geocode));a.geoenrichment&&(e.geoenrichmentService=""===a.geoenrichment.url?c:f.stringify(a.geoenrichment));a.hydrology&&(e.hydrologyService=""===a.hydrology.url?c:f.stringify(a.hydrology));a.asyncClosestFacility&&(e.asyncClosestFacilityService=""===a.asyncClosestFacility.url?c:f.stringify(a.asyncClosestFacility));a.asyncLocationAllocation&&(e.asyncLocationAllocationService=""===a.asyncLocationAllocation.url?c:f.stringify(a.asyncLocationAllocation));a.asyncRoute&&
(e.asyncRouteService=""===a.asyncRoute.url?c:f.stringify(a.asyncRoute));a.asyncServiceArea&&(e.asyncServiceAreaService=""===a.asyncServiceArea.url?c:f.stringify(a.asyncServiceArea));a.asyncVRP&&(e.asyncVRPService=""===a.asyncVRP.url?c:f.stringify(a.asyncVRP));a.closestFacility&&(e.closestFacilityService=""===a.closestFacility.url?c:f.stringify(a.closestFacility));a.serviceArea&&(e.serviceAreaService=""===a.serviceArea.url?c:f.stringify(a.serviceArea));a.syncVRP&&(e.syncVRPService=""===a.syncVRP.url?
c:f.stringify(a.syncVRP));a.traffic&&(e.trafficService=""===a.traffic.url?c:f.stringify(a.traffic));a.routingUtilities&&(e.routingUtilitiesService=""===a.routingUtilities.url?c:f.stringify(a.routingUtilities));a.asyncRoute&&(e.asyncRouteService=""===a.asyncRoute.url?c:f.stringify(a.asyncRoute));a.route&&(e.routeServiceLayer=""===a.route.url?c:f.stringify(a.route));h.request({url:d,content:e},{usePost:!0}).then(function(){b.resolve()},function(a){console.log("Error updating the organization.",a);b.resolve()});
return b.promise},_isStringSet:function(a){return g.isDefined(a)&&0<a.length},_credentialChanged:function(a){},_setConfiguring:function(a){this._okBtn.set("disabled",a);this._okBtn.set("label",a?this.i18n.configuring:this.i18n.configure)},_retrieveSelfNoAuth:function(){return O({url:location.protocol+"//www.arcgis.com/sharing/rest/portals/self",content:{f:"json",culture:this._portalSettings&&this._portalSettings.culture||"en"}})},_createServiceProxies:function(a){var b=this,d=new w,c,e,n;c=this._createServiceProxyItems(a);
0<c.promises.length?v(c.promises).then(function(f){e=b._collectItemIds(a,c.serviceIndex,f);var g=function(){b._getItemsById(e.itemIds).then(function(f){n=b._generateHelperServiceResult(a,c.serviceIndex,e,f);d.resolve(n)},function(a){console.log("Error retrieving service proxy items.",a);d.reject({})})};b._shareItemsToOrg(e.itemIds).then(function(){b._protectItems(e.itemIds,a.folder).then(function(){g()})},function(c){console.log("Error sharing service proxy items.",c);b._protectItems(e.itemIds,a.folder).then(function(){g()})})},
function(a){d.reject(a)}):d.resolve({});return d.promise},_protectItems:function(a,b){var d=this,c=new w,e=[];x.forEach(a,function(a){e.push(d._protectItem(a,b))});e&&0<e.length?v(e).then(function(){c.resolve()},function(){c.resolve()}):c.resolve();return c.promise},_protectItem:function(a,b){return h.request({url:esriGeowConfig.restBaseUrl+"content/users/"+this._user.username+"/"+(b?b+"/":"")+"items/"+a+"/protect"},{usePost:!0}).promise},_unprotectItem:function(a,b,d){return h.request({url:esriGeowConfig.restBaseUrl+
"content/users/"+b+"/"+(d?d+"/":"")+"items/"+a+"/unprotect"},{usePost:!0}).promise},_generateHelperServiceResult:function(a,b,d,c){b={};a.elevation&&(b.elevation={url:this._getItemFromResultsById(d.elevation,c).url},b.elevationSync={url:this._selfNoAuth.helperServices.elevationSync.url});a.geocode&&(b.geocode=p.clone(this._portalSettings.helperServices.geocode),b.geocode.push({url:this._getItemFromResultsById(d.geocode,c).url,name:this.i18n.serviceTitles.geocodeBatch,placeholder:this.i18n.geocoderPlaceholderLabel,
singleLineFieldName:this._geocoderSingleLineFieldName,batch:!0,placefinding:!0,suggest:!0,zoomScale:1E4}));a.geoenrichment&&(b.geoenrichment={url:this._getItemFromResultsById(d.geoenrichment,c).url});a.hydrology&&(b.hydrology={url:this._getItemFromResultsById(d.hydrology,c).url});a.network&&(b.asyncClosestFacility={url:this._getItemFromResultsById(d.asyncClosestFacility,c).url},b.asyncLocationAllocation={url:this._getItemFromResultsById(d.asyncLocationAllocation,c).url},b.asyncServiceArea={url:this._getItemFromResultsById(d.asyncServiceArea,
c).url},b.asyncVRP={url:this._getItemFromResultsById(d.asyncVRP,c).url},b.closestFacility={url:this._getItemFromResultsById(d.closestFacility,c).url},b.serviceArea={url:this._getItemFromResultsById(d.serviceArea,c).url},b.syncVRP={url:this._getItemFromResultsById(d.syncVRP,c).url},b.traffic={url:this._getItemFromResultsById(d.traffic,c).url},b.routingUtilities={url:this._getItemFromResultsById(d.routingUtilities,c).url},b.asyncRoute={url:this._getItemFromResultsById(d.asyncRoute,c).url});a.route&&
(b.route={url:this._getItemFromResultsById(d.route,c).url});return b},_getItemFromResultsById:function(a,b){var d,c;for(c=0;c<b.length;c++)if(b[c].id===a){d=b[c];break}return d},_getItemsById:function(a){var b=[],d;for(d=0;d<a.length;d++)b.push(h.request({url:esriGeowConfig.restBaseUrl+"content/items/"+a[d]}));return v(b)},_shareItemsToOrg:function(a){var b=esriGeowConfig.restBaseUrl+"content/users/"+this._user.username+"/shareItems";a={items:a.join(","),everyone:!1,org:!0};return h.request({url:b,
content:a},{usePost:!0}).promise},_createServiceProxyItems:function(a){var b={promises:[],serviceIndex:{}};a.elevation&&(b.serviceIndex.elevation=b.promises.length,b.promises.push(this._createElevationServiceProxy(a.serviceUsername,a.servicePassword,a.folder)));a.geocode&&(b.serviceIndex.geocode=b.promises.length,b.promises.push(this._createGeocodeServiceProxy(a.serviceUsername,a.servicePassword,a.folder)));a.geoenrichment&&(b.serviceIndex.geoenrichment=b.promises.length,b.promises.push(this._createGeoEnrichmentServiceProxy(a.serviceUsername,
a.servicePassword,a.folder)));a.hydrology&&(b.serviceIndex.hydrology=b.promises.length,b.promises.push(this._createHydrologyServiceProxy(a.serviceUsername,a.servicePassword,a.folder)));a.network&&(b.serviceIndex.asyncClosestFacility=b.promises.length,b.promises.push(this._createAsyncClosestFacilityServiceProxy(a.serviceUsername,a.servicePassword,a.folder)),b.serviceIndex.asyncLocationAllocation=b.promises.length,b.promises.push(this._createAsyncLocationAllocationServiceProxy(a.serviceUsername,a.servicePassword,
a.folder)),b.serviceIndex.asyncServiceArea=b.promises.length,b.promises.push(this._createAsyncServiceAreaServiceProxy(a.serviceUsername,a.servicePassword,a.folder)),b.serviceIndex.asyncVRP=b.promises.length,b.promises.push(this._createAsyncVRPServiceProxy(a.serviceUsername,a.servicePassword,a.folder)),b.serviceIndex.closestFacility=b.promises.length,b.promises.push(this._createClosestFacilityServiceProxy(a.serviceUsername,a.servicePassword,a.folder)),b.serviceIndex.serviceArea=b.promises.length,b.promises.push(this._createServiceAreaServiceProxy(a.serviceUsername,
a.servicePassword,a.folder)),b.serviceIndex.syncVRP=b.promises.length,b.promises.push(this._createSyncVRPServiceProxy(a.serviceUsername,a.servicePassword,a.folder)),b.serviceIndex.traffic=b.promises.length,b.promises.push(this._createTrafficServiceProxy(a.serviceUsername,a.servicePassword,a.folder)),b.serviceIndex.routingUtilities=b.promises.length,b.promises.push(this._createRoutingUtilityServiceProxy(a.serviceUsername,a.servicePassword,a.folder)),b.serviceIndex.asyncRoute=b.promises.length,b.promises.push(this._createAsyncRouteServiceProxy(a.serviceUsername,
a.servicePassword,a.folder)));a.route&&(b.serviceIndex.route=b.promises.length,b.promises.push(this._createRouteServiceProxy(a.serviceUsername,a.servicePassword,a.folder)));return b},_collectItemIds:function(a,b,d){var c={itemIds:[]};a.elevation&&(c.elevation=d[b.elevation].id,c.itemIds.push(d[b.elevation].id));a.geocode&&(c.geocode=d[b.geocode].id,c.itemIds.push(d[b.geocode].id));a.geoenrichment&&(c.geoenrichment=d[b.geoenrichment].id,c.itemIds.push(d[b.geoenrichment].id));a.hydrology&&(c.hydrology=
d[b.hydrology].id,c.itemIds.push(d[b.hydrology].id));a.network&&(c.asyncClosestFacility=d[b.asyncClosestFacility].id,c.itemIds.push(d[b.asyncClosestFacility].id),c.asyncLocationAllocation=d[b.asyncLocationAllocation].id,c.itemIds.push(d[b.asyncLocationAllocation].id),c.asyncServiceArea=d[b.asyncServiceArea].id,c.itemIds.push(d[b.asyncServiceArea].id),c.asyncVRP=d[b.asyncVRP].id,c.itemIds.push(d[b.asyncVRP].id),c.closestFacility=d[b.closestFacility].id,c.itemIds.push(d[b.closestFacility].id),c.serviceArea=
d[b.serviceArea].id,c.itemIds.push(d[b.serviceArea].id),c.syncVRP=d[b.syncVRP].id,c.itemIds.push(d[b.syncVRP].id),c.traffic=d[b.traffic].id,c.itemIds.push(d[b.traffic].id),c.routingUtilities=d[b.routingUtilities].id,c.itemIds.push(d[b.routingUtilities].id),c.asyncRoute=d[b.asyncRoute].id,c.itemIds.push(d[b.asyncRoute].id));a.route&&(c.route=d[b.route].id,c.itemIds.push(d[b.route].id));return c},_addItem:function(a,b){var d=esriGeowConfig.restBaseUrl+"content/users/"+this._user.username+"/";return h.request({url:d+
(b?b+"/":"")+"addItem",content:a},{usePost:!0})},_createElevationServiceProxy:function(a,b,d){return this._addItem({type:this.itemInfo.gpserver.type,url:this._selfNoAuth.helperServices.elevation.url,title:this.i18n.serviceTitles.elevation+this._getUsername(a),tags:this.itemInfo.gpserver.typeKeywords,serviceUsername:a,servicePassword:b},d)},_createGeocodeServiceProxy:function(a,b,d){return this._addItem({type:this.itemInfo.geocodeserver.type,url:this._selfNoAuth.helperServices.geocode[0].url,title:this.i18n.serviceTitles.geocode+
this._getUsername(a),tags:this.itemInfo.geocodeserver.typeKeywords,serviceUsername:a,servicePassword:b},d)},_createGeoEnrichmentServiceProxy:function(a,b,d){return this._addItem({type:this.itemInfo.geoenrichmentserver.type,url:this._selfNoAuth.helperServices.geoenrichment.url,title:this.i18n.serviceTitles.geoenrichment+this._getUsername(a),tags:this.itemInfo.geoenrichmentserver.typeKeywords,serviceUsername:a,servicePassword:b},d)},_createHydrologyServiceProxy:function(a,b,d){return this._addItem({type:this.itemInfo.gpserver.type,
url:this._selfNoAuth.helperServices.hydrology.url,title:this.i18n.serviceTitles.hydrology+this._getUsername(a),tags:this.itemInfo.gpserver.typeKeywords,serviceUsername:a,servicePassword:b},d)},_createRouteServiceProxy:function(a,b,d){return this._addItem({type:this.itemInfo.naserver.type,url:this._selfNoAuth.helperServices.route.url,title:this.i18n.serviceTitles.route+this._getUsername(a),tags:this.itemInfo.naserver.typeKeywords,serviceUsername:a,servicePassword:b},d)},_createAsyncClosestFacilityServiceProxy:function(a,
b,d){return this._addItem({type:this.itemInfo.gpserver.type,url:this._selfNoAuth.helperServices.asyncClosestFacility.url,title:this.i18n.serviceTitles.asyncClosestFacility+this._getUsername(a),tags:this.itemInfo.gpserver.typeKeywords,serviceUsername:a,servicePassword:b},d)},_createAsyncLocationAllocationServiceProxy:function(a,b,d){return this._addItem({type:this.itemInfo.gpserver.type,url:this._selfNoAuth.helperServices.asyncLocationAllocation.url,title:this.i18n.serviceTitles.asyncLocationAllocation+
this._getUsername(a),tags:this.itemInfo.gpserver.typeKeywords,serviceUsername:a,servicePassword:b},d)},_createAsyncServiceAreaServiceProxy:function(a,b,d){return this._addItem({type:this.itemInfo.gpserver.type,url:this._selfNoAuth.helperServices.asyncServiceArea.url,title:this.i18n.serviceTitles.asyncServiceArea+this._getUsername(a),tags:this.itemInfo.gpserver.typeKeywords,serviceUsername:a,servicePassword:b},d)},_createAsyncVRPServiceProxy:function(a,b,d){return this._addItem({type:this.itemInfo.gpserver.type,
url:this._selfNoAuth.helperServices.asyncVRP.url,title:this.i18n.serviceTitles.asyncVRP+this._getUsername(a),tags:this.itemInfo.gpserver.typeKeywords,serviceUsername:a,servicePassword:b},d)},_createClosestFacilityServiceProxy:function(a,b,d){return this._addItem({type:this.itemInfo.naserver.type,url:this._selfNoAuth.helperServices.closestFacility.url,title:this.i18n.serviceTitles.closestFacility+this._getUsername(a),tags:this.itemInfo.naserver.typeKeywords,serviceUsername:a,servicePassword:b},d)},
_createServiceAreaServiceProxy:function(a,b,d){return this._addItem({type:this.itemInfo.naserver.type,url:this._selfNoAuth.helperServices.serviceArea.url,title:this.i18n.serviceTitles.serviceArea+this._getUsername(a),tags:this.itemInfo.naserver.typeKeywords,serviceUsername:a,servicePassword:b},d)},_createSyncVRPServiceProxy:function(a,b,d){return this._addItem({type:this.itemInfo.gpserver.type,url:this._selfNoAuth.helperServices.syncVRP.url,title:this.i18n.serviceTitles.syncVRP+this._getUsername(a),
tags:this.itemInfo.gpserver.typeKeywords,serviceUsername:a,servicePassword:b},d)},_createTrafficServiceProxy:function(a,b,d){return this._addItem({type:this.itemInfo.mapserver.type,url:this._selfNoAuth.helperServices.traffic.url,title:this.i18n.serviceTitles.traffic+this._getUsername(a),tags:this.itemInfo.mapserver.typeKeywords,serviceUsername:a,servicePassword:b},d)},_createRoutingUtilityServiceProxy:function(a,b,d){return this._addItem({type:this.itemInfo.gpserver.type,url:this._selfNoAuth.helperServices.routingUtilities.url,
title:this.i18n.serviceTitles.routingUtilities+this._getUsername(a),tags:this.itemInfo.gpserver.typeKeywords,serviceUsername:a,servicePassword:b},d)},_createAsyncRouteServiceProxy:function(a,b,d){return this._addItem({type:this.itemInfo.gpserver.type,url:this._selfNoAuth.helperServices.asyncRoute.url,title:this.i18n.serviceTitles.asyncRoute+this._getUsername(a),tags:this.itemInfo.gpserver.typeKeywords,serviceUsername:a,servicePassword:b},d)},_getUsername:function(a){return g.substitute({name:a},this.i18n.usernameLabel)},
_getDateStamp:function(){return" "+I.format(new Date,this._getDateStampLocaleFormat())},_getDateStampLocaleFormat:function(){return{formatLength:"medium"}},_clear:function(){this._currentlyEnabledServices={elevation:!1,geocode:!1,geoenrichment:!1,hydrology:!1,network:!1,route:!1};this._newlyEnabledServices=p.clone(this._currentlyEnabledServices);y.set(this._okBtn,"label",this.i18n.configure);this._elevationChkBox.set("checked",!1);this._geocodeChkBox.set("checked",!1);this._geoenrichChkBox.set("checked",
!1);this._hydrologyChkBox.set("checked",!1);this._networkChkBox.set("checked",!1);this._routeChkBox.set("checked",!1);this._serviceInfoPane&&(this._serviceInfoPane._username.set("value",""),this._serviceInfoPane._password.set("value",""));z.set(this._credentialContainer,"display","none");this._setConfiguring(!1)},_initialize:function(){var a=this;S.getSelf(function(b){a._portalSettings=p.clone(b);a._user=h.getUser();a._serviceInfoPane||(a._serviceInfoPane=new Q({},a._credentials),a.own(G(a._serviceInfoPane,
"onCredentialChange",p.hitch(this,a._credentialChanged))));a._clear();a._synchronizeFolders();a._synchronizeServices()})},_synchronizeFolders:function(){var a=this,b=h.getUser().username,d="",c=b,e=[{id:"",name:c}],f,g;J("ESRI_Content")&&(g=h.getCookie("ESRI_Content"),g.folderId&&(d=g.folderId));P.getFolders(function(b){a._folders=b.folders;x.forEach(b.folders,function(a){d===a.id&&(c=a.title);e.push({id:a.id,name:a.title})});f=new B({data:e});a._folderSelect.set("store",f);a._folderSelect.set("value",
c)},function(c){console.log("unable to retrieve the user folders",c);f=new B({data:e});a._folderSelect.set("store",f);a._folderSelect.set("value",b)})},_getFolderId:function(a){if(a&&a!==h.getUser().username)for(var b=0;b<this._folders.length;b++)if(this._folders[b].title===a)return this._folders[b].id;return""},_synchronizeServices:function(){var a=this,b={elevation:{enabled:!1},geocode:{enabled:!1},geoenrichment:{enabled:!1},hydrology:{enabled:!1},network:{enabled:!1},route:{enabled:!1}},d=[],c;
a._enableCheckboxes(!1);a._parseHelperServices(b,d);a._getItemsById(d).then(function(d){b.elevation.enabled&&(c=a._retrieveItemResultById(d,b.elevation.itemId),a._currentlyEnabledServices.elevation=a._isAGOLEnabled(c),a._currentlyEnabledServices.elevation&&(a._currentlyEnabledServices.elevationItemId=c.id,a._currentlyEnabledServices.elevationItemOwner=c.owner,c.ownerFolder&&(a._currentlyEnabledServices.elevationItemFolder=c.ownerFolder)));b.geocode.enabled&&(c=a._retrieveItemResultById(d,b.geocode.itemId),
a._currentlyEnabledServices.geocode=a._isAGOLEnabled(c),a._currentlyEnabledServices.geocode&&(a._currentlyEnabledServices.geocodeItemId=c.id,a._currentlyEnabledServices.geocodeItemOwner=c.owner,a._currentlyEnabledServices.geocodeItemIdx=b.geocode.itemIdx,c.ownerFolder&&(a._currentlyEnabledServices.geocodeItemFolder=c.ownerFolder)));b.geoenrichment.enabled&&(c=a._retrieveItemResultById(d,b.geoenrichment.itemId),a._currentlyEnabledServices.geoenrichment=a._isAGOLEnabled(c),a._currentlyEnabledServices.geoenrichment&&
(a._currentlyEnabledServices.geoenrichmentItemId=c.id,a._currentlyEnabledServices.geoenrichmentItemOwner=c.owner,c.ownerFolder&&(a._currentlyEnabledServices.geoenrichmentItemFolder=c.ownerFolder)));b.hydrology.enabled&&(c=a._retrieveItemResultById(d,b.hydrology.itemId),a._currentlyEnabledServices.hydrology=a._isAGOLEnabled(c),a._currentlyEnabledServices.hydrology&&(a._currentlyEnabledServices.hydrologyItemId=c.id,a._currentlyEnabledServices.hydrologyItemOwner=c.owner,c.ownerFolder&&(a._currentlyEnabledServices.hydrologyItemFolder=
c.ownerFolder)));if(b.network.enabled){var f=a._retrieveItemResultById(d,b.network.asyncClosestFacilityItemId),g=a._retrieveItemResultById(d,b.network.asyncLocationAllocationItemId),h=a._retrieveItemResultById(d,b.network.asyncServiceAreaItemId),l=a._retrieveItemResultById(d,b.network.asyncVRPItemId),s=a._retrieveItemResultById(d,b.network.closestFacilityItemId),m=a._retrieveItemResultById(d,b.network.serviceAreaItemId),k=a._retrieveItemResultById(d,b.network.syncVRPItemId),r=a._retrieveItemResultById(d,
b.network.trafficItemId),t=a._retrieveItemResultById(d,b.network.routingUtilitiesItemId),u=a._retrieveItemResultById(d,b.network.asyncRouteItemId);a._isAGOLEnabled(f)&&(a._isAGOLEnabled(g)&&a._isAGOLEnabled(h)&&a._isAGOLEnabled(l)&&a._isAGOLEnabled(s)&&a._isAGOLEnabled(m)&&a._isAGOLEnabled(k)&&a._isAGOLEnabled(r)&&a._isAGOLEnabled(t)&&a._isAGOLEnabled(u))&&(a._currentlyEnabledServices.network=!0,a._currentlyEnabledServices.networkItemIds=[f.id,g.id,h.id,l.id,s.id,m.id,k.id,r.id,t.id,u.id],a._currentlyEnabledServices.networkItemOwners=
{},a._currentlyEnabledServices.networkItemOwners[f.id]=f.owner,a._currentlyEnabledServices.networkItemOwners[g.id]=g.owner,a._currentlyEnabledServices.networkItemOwners[h.id]=h.owner,a._currentlyEnabledServices.networkItemOwners[l.id]=l.owner,a._currentlyEnabledServices.networkItemOwners[s.id]=s.owner,a._currentlyEnabledServices.networkItemOwners[m.id]=m.owner,a._currentlyEnabledServices.networkItemOwners[k.id]=k.owner,a._currentlyEnabledServices.networkItemOwners[r.id]=r.owner,a._currentlyEnabledServices.networkItemOwners[t.id]=
t.owner,a._currentlyEnabledServices.networkItemOwners[u.id]=u.owner,a._currentlyEnabledServices.networkItemFolders={},a._currentlyEnabledServices.networkItemFolders[f.id]=f.ownerFolder,a._currentlyEnabledServices.networkItemFolders[g.id]=g.ownerFolder,a._currentlyEnabledServices.networkItemFolders[h.id]=h.ownerFolder,a._currentlyEnabledServices.networkItemFolders[l.id]=l.ownerFolder,a._currentlyEnabledServices.networkItemFolders[s.id]=s.ownerFolder,a._currentlyEnabledServices.networkItemFolders[m.id]=
m.ownerFolder,a._currentlyEnabledServices.networkItemFolders[k.id]=k.ownerFolder,a._currentlyEnabledServices.networkItemFolders[r.id]=r.ownerFolder,a._currentlyEnabledServices.networkItemFolders[t.id]=t.ownerFolder,a._currentlyEnabledServices.networkItemFolders[u.id]=u.ownerFolder)}b.route.enabled&&(c=a._retrieveItemResultById(d,b.route.itemId),a._currentlyEnabledServices.route=a._isAGOLEnabled(c),a._currentlyEnabledServices.route&&(a._currentlyEnabledServices.routeItemId=c.id,a._currentlyEnabledServices.routeItemOwner=
c.owner,c.ownerFolder&&(a._currentlyEnabledServices.routeItemFolder=c.ownerFolder)));a._newlyEnabledServices=p.clone(a._currentlyEnabledServices);a._elevationChkBox.set("checked",a._currentlyEnabledServices.elevation);a._geocodeChkBox.set("checked",a._currentlyEnabledServices.geocode);a._geoenrichChkBox.set("checked",a._currentlyEnabledServices.geoenrichment);a._hydrologyChkBox.set("checked",a._currentlyEnabledServices.hydrology);a._networkChkBox.set("checked",a._currentlyEnabledServices.network);
a._routeChkBox.set("checked",a._currentlyEnabledServices.route);a._enableCheckboxes(!0)},function(b){console.log("Error retrieving secure proxy items",b);a._enableCheckboxes(!0)})},_isAGOLEnabled:function(a){return a&&this._isStringSet(a.sourceUrl)&&-1<a.sourceUrl.indexOf(".arcgis.com")},_retrieveItemResultById:function(a,b){var d=null;if(a&&0<a.length)for(var c=0;c<a.length&&!((d=a[c])&&d.id===b);c++);return d},_parseHelperServices:function(a,b){var d=this._portalSettings.helperServices,c;this._serviceIsSet(d.elevation)&&
this._serviceIsSet(d.elevationSync)&&(c=this._findItemId(d.elevation.url),g.isDefined(c)&&(a.elevation.enabled=!0,a.elevation.itemId=c,b.push(c)));if(d.geocode&&0<d.geocode.length)for(var e,f=0;f<d.geocode.length;f++)if(e=d.geocode[f],c=this._findItemId(e.url),g.isDefined(c)&&e.name===this.i18n.serviceTitles.geocodeBatch){a.geocode.enabled=!0;a.geocode.itemId=c;a.geocode.itemIdx=f;b.push(c);break}this._serviceIsSet(d.geoenrichment)&&(c=this._findItemId(d.geoenrichment.url),g.isDefined(c)&&(a.geoenrichment.enabled=
!0,a.geoenrichment.itemId=c,b.push(c)));this._serviceIsSet(d.hydrology)&&(c=this._findItemId(d.hydrology.url),g.isDefined(c)&&(a.hydrology.enabled=!0,a.hydrology.itemId=c,b.push(c)));this._serviceIsSet(d.asyncClosestFacility)&&(c=this._findItemId(d.asyncClosestFacility.url),g.isDefined(c)&&(a.network.asyncClosestFacilityItemId=c,b.push(c)));this._serviceIsSet(d.asyncLocationAllocation)&&(c=this._findItemId(d.asyncLocationAllocation.url),g.isDefined(c)&&(a.network.asyncLocationAllocationItemId=c,b.push(c)));
this._serviceIsSet(d.asyncServiceArea)&&(c=this._findItemId(d.asyncServiceArea.url),g.isDefined(c)&&(a.network.asyncServiceAreaItemId=c,b.push(c)));this._serviceIsSet(d.asyncVRP)&&(c=this._findItemId(d.asyncVRP.url),g.isDefined(c)&&(a.network.asyncVRPItemId=c,b.push(c)));this._serviceIsSet(d.closestFacility)&&(c=this._findItemId(d.closestFacility.url),g.isDefined(c)&&(a.network.closestFacilityItemId=c,b.push(c)));this._serviceIsSet(d.serviceArea)&&(c=this._findItemId(d.serviceArea.url),g.isDefined(c)&&
(a.network.serviceAreaItemId=c,b.push(c)));this._serviceIsSet(d.syncVRP)&&(c=this._findItemId(d.syncVRP.url),g.isDefined(c)&&(a.network.syncVRPItemId=c,b.push(c)));this._serviceIsSet(d.traffic)&&(c=this._findItemId(d.traffic.url),g.isDefined(c)&&(a.network.trafficItemId=c,b.push(c)));this._serviceIsSet(d.routingUtilities)&&(c=this._findItemId(d.routingUtilities.url),g.isDefined(c)&&(a.network.routingUtilitiesItemId=c,b.push(c)));this._serviceIsSet(d.asyncRoute)&&(c=this._findItemId(d.asyncRoute.url),
g.isDefined(c)&&(a.network.asyncRouteItemId=c,b.push(c)));a.network.asyncClosestFacilityItemId&&(a.network.asyncLocationAllocationItemId&&a.network.asyncServiceAreaItemId&&a.network.asyncVRPItemId&&a.network.closestFacilityItemId&&a.network.serviceAreaItemId&&a.network.syncVRPItemId&&a.network.trafficItemId&&a.network.routingUtilitiesItemId&&a.network.asyncRouteItemId)&&(a.network.enabled=!0);this._serviceIsSet(d.route)&&(c=this._findItemId(d.route.url),g.isDefined(c)&&(a.route.enabled=!0,a.route.itemId=
c,b.push(c)))},_enableCheckboxes:function(a){this._elevationChkBox.set("disabled",!a);this._geocodeChkBox.set("disabled",!a);this._geoenrichChkBox.set("disabled",!a);this._hydrologyChkBox.set("disabled",!a);this._networkChkBox.set("disabled",!a);this._routeChkBox.set("disabled",!a)},_findItemId:function(a){var b=null,d;this._isStringSet(a)&&(d=a.indexOf("/sharing/servers/"),-1<d&&(d+=17,b=a.indexOf("/rest/services/"),b=a.substring(d,b)));return b},_serviceIsSet:function(a){return g.isDefined(a)&&
this._isStringSet(a.url)},reset:function(){this._initialize()}});A.prototype.statics={_instance:null,getInstance:function(){null==this._instance&&(this._instance=new A);return this._instance}};return A});