// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/map/dijit/renderer/_ColorMixin","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/dom dojo/Deferred dojo/dom-construct dojo/dom-style esri/lang esri/symbols/jsonUtils esri/renderers/smartMapping esri/styles/choropleth esri/plugins/FeatureLayerStatistics esri/dijit/ColorInfoSlider esri/dijit/ClassedColorSlider esri/renderers/SimpleRenderer esri/renderers/ClassBreaksRenderer arcgisonline/map/dijit/renderer/ColorGrid".split(" "),function(x,e,y,m,t,n,u,
z,A,q,r,s,B,p,v,C,D,w){return{buildColorRenderer:function(a){var b=new n;setTimeout(function(){b.progress(b)},1);a=a||{};if(this.isFeatColl||this.isCSV||this.hasDynamic)this.buildColorRendererGo(null,a,b);else if("esri.renderer.UniqueValueRenderer"===this.renderer.declaredClass)if(this.isOwnerOfHostedFS){var c=this.layer.getEditCapabilities();!this.layer.isEditable()||!c.canCreate&&(c.canUpdate||c.canDelete)||this.mapLayer.featureTemplatesChanged?this.buildColorRendererGo(!0,a,b):arcgisonline.map.edit.hasDefaultTypesAndTemplates(this.layer)?
this.buildColorRendererGo(!0,a,b):arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance().show({title:this.i18n.warning,message:this.i18n.featureTypesAndTemplatesWarning,choiceOneTitle:this.i18n.yesLabel,choiceOneHandler:e.hitch(this,function(){this.buildColorRendererGo(!0,a,b)}),choiceTwoTitle:this.i18n.noLabel,choiceTwoHandler:e.hitch(this,function(){!b.isRejected()&&b.reject()})})}else this.buildColorRendererGo(null,a,b);else this.buildColorRendererGo(null,a,b);return b},buildColorRendererGo:function(a,
b,c){arcgisonline.map.dynLayer.checkDynamicLayers(this.mapLayer);if(!this.scheme){var d,f=this.getVisualVariableByType("colorInfo",null,this.renderer.visualVariables);if(f){var k=m.map(f.stops,function(a){return a.color});d=s.getMatchingSchemes({theme:b.theme||"high-to-low",colors:k,geometryType:this.geometryType})}else if(k=m.map(this.renderer.infos,function(a){return a.symbol.color}),d=s.getMatchingSchemes({theme:"high-to-low",colors:k,geometryType:this.geometryType}),!d||!d.length)d=s.getMatchingSchemes({theme:"above-and-below",
colors:k,geometryType:this.geometryType});d&&d.length&&(this.scheme=d[0])}var l=null;this.renderer.visualVariables&&"color"===this.getRendererType(this.renderer)&&(l=this.getVisualVariablesExceptTypes([{type:"colorInfo"},{type:"sizeInfo",target:"outline"}],this.renderer.visualVariables));d=b.attributeItem||this.attributeItem;if(b.classified||this.hasDynamic){var g,h;b.classificationMethod||(g=b.minValue,h=b.maxValue);r.createClassedColorRenderer({layer:this.fLayer||this.layer,field:d.name,minValue:g,
maxValue:h,basemap:this.getBasemapType(),showOthers:!0,numClasses:"standard-deviation"!==b.classificationMethod?b.numClasses:void 0,scheme:this.scheme,classificationMethod:b.classificationMethod||"equal-interval",standardDeviationInterval:b.standardDeviationInterval,normalizationType:b.normalizationType,normalizationField:b.normalizationField,optimizeOutline:esri.isDefined(b.optimizeOutline)?b.optimizeOutline:!0}).then(e.hitch(this,function(f){c.isRejected()||(this.scheme=f.scheme,a&&(arcgisonline.map.edit.removeTypesAndTemplatesOnLayer(this.mapLayer.layer),
this.mapLayer.featureTemplatesChanged=!0),this.authoringInfo={type:"classedColor"},b.classificationMethod&&(this.authoringInfo.classificationMethod=this.getClassificationMethodConstant(b.classificationMethod)),"standard-deviation"===b.classificationMethod&&(this.authoringInfo.standardDeviationInterval=b.standardDeviationInterval),l&&(f.renderer.visualVariables?f.renderer.setVisualVariables(f.renderer.visualVariables.concat(l)):f.renderer.setVisualVariables(l)),f.renderer=this.updateRendererProperties(b,
f.renderer),c.resolve({renderer:f.renderer,statistics:f.statistics}))}),e.hitch(this,function(a){c.isRejected()||(this.handleError(a,"createClassedColorRenderer",!0),c.reject())}))}else r.createColorRenderer({layer:this.fLayer||this.layer,field:d.name,normalizationType:b.normalizationType,normalizationField:b.normalizationField,theme:b.theme||"high-to-low",basemap:this.getBasemapType(),scheme:this.scheme,optimizeOutline:esri.isDefined(b.optimizeOutline)?b.optimizeOutline:!0,showOthers:!0}).then(e.hitch(this,
function(d){if(!c.isRejected()){this.scheme=d.scheme;this.onCalculationsSource&&d.statistics&&this.onCalculationsSource(d.statistics.source);a&&(arcgisonline.map.edit.removeTypesAndTemplatesOnLayer(this.mapLayer.layer),this.mapLayer.featureTemplatesChanged=!0);var e={type:"colorInfo",minSliderValue:esri.isDefined(b.minValue)?b.minValue:d.statistics.min,maxSliderValue:esri.isDefined(b.maxValue)?b.maxValue:d.statistics.max,theme:b.theme||"high-to-low"};if(this.isMultiAttributesRenderer){this.authoringInfo=
this.authoringInfo||{};this.authoringInfo.visualVariables=this.authoringInfo.visualVariables||[];this.replaceVisualVariable("colorInfo",null,e,this.authoringInfo);f=this.getVisualVariableByType("colorInfo",null,d.renderer.visualVariables)||null;this.replaceVisualVariable("colorInfo",null,f,this.renderer);this.renderer.attributeField=f.field;(this.renderer.normalizationField=f.normalizationField)?this.renderer.normalizationType="field":(delete this.renderer.normalizationField,delete this.renderer.normalizationType);
if("esriGeometryPolygon"===this.geometryType){var e=this.renderer.infos[0],k=q.fromJson(e.symbol.toJson());e.symbol=this.convertFillToMarkerSymbol(k,k.style,k.outline);this.renderer.clearBreaks();this.renderer.addBreak(e)}d.renderer=this.renderer}else this.authoringInfo={visualVariables:[e]},l&&(d.renderer.visualVariables?d.renderer.setVisualVariables(d.renderer.visualVariables.concat(l)):d.renderer.setVisualVariables(l));d.renderer=this.updateRendererProperties(b,d.renderer);c.resolve({renderer:d.renderer,
statistics:d.statistics})}}),e.hitch(this,function(a){c.isRejected()||(this.handleError(a,"createColorRenderer",!0),c.reject())}))},buildColorInfo:function(a,b){b=new n;r.createColorInfo({layer:this.fLayer||this.layer,field:(a.attributeItem||this.attributeItem).name,normalizationType:a.normalizationType,normalizationField:a.normalizationField,theme:a.theme||"high-to-low",basemap:this.getBasemapType(),scheme:a.scheme,statistics:a.statistics}).then(e.hitch(this,function(c){if(!b.isRejected()){var d=
{visualVariables:[{type:"colorInfo",minSliderValue:esri.isDefined(a.minValue)?a.minValue:c.statistics.min,maxSliderValue:esri.isDefined(a.maxValue)?a.maxValue:c.statistics.max,theme:a.theme||"high-to-low"}]};b.resolve({colorInfo:c.colorInfo,statistics:c.statistics,authoringInfo:d,scheme:c.scheme})}}),e.hitch(this,function(a){b.isRejected()||(this.handleError(a,"createColorInfo",!0),b.reject())}));return b},applyColorRenderer:function(a,b,c){a.authoringInfo&&(a.authoringInfo.classificationMethod?a.classificationMethod=
a.authoringInfo.classificationMethod:delete a.classificationMethod);b=this.getRendererStyle((this.fLayer||this.layer).renderer);this.setRenderer(a);this.updateColorRendererGrid();if(!this.hasDynamic&&(b!==this.getRendererStyle(a)||c)&&this.scheme&&esri.isDefined(this.scheme.opacity))this.layer.setOpacity(this.scheme.opacity),this.transparencySlider&&this.transparencySlider.set("value",1-this.scheme.opacity);(arcgisonline.map.featColl.isFeatureCollection(this.mapLayer)||this.isCSV)&&arcgisonline.map.main.markMapAsChanged("onRendererChange");
this.isOwnerOfHostedFS&&!this.layer.templates.length&&arcgisonline.map.edit.createTypesAndTemplatesOnLayer(this.layer);this.updateLegendPopup()},updateSymbolOnColorRenderer:function(a,b){a=a||{};b=b||this.renderer;if(!a.colors&&!a.symbol)return b;this.disableSliderChangeEvent();var c=this.getVisualVariableByType("colorInfo",null,b.visualVariables);if(c){if(a.symbol){var d=b.infos[0];b.clearBreaks();var f=q.fromJson(a.symbol.toJson()),f=this.switchSymbolKeepColor(f,d.symbol);b.addBreak({minValue:d.minValue,
maxValue:d.maxValue,symbol:f,label:d.label})}a.colors&&(m.forEach(c.stops,function(b,f){b.color=a.colors[f]}),this.replaceVisualVariable("colorInfo",null,c,b),this.updateColorSlider(b))}else a.symbol&&(c=b.infos,b.clearBreaks(),m.forEach(c,function(f,d){var c=q.fromJson(a.symbol.toJson()),c=this.switchSymbolKeepColor(c,f.symbol);b.addBreak({minValue:f.minValue,maxValue:f.maxValue,symbol:c,label:f.label})},this)),a.colors&&(c=b.infos,b.clearBreaks(),m.forEach(c,function(f,d){b.addBreak({minValue:f.minValue,
maxValue:f.maxValue,symbol:f.symbol.setColor(a.colors[Math.min(d,a.colors.length-1)]),label:f.label})}),this.updateColorSlider(b));setTimeout(e.hitch(this,function(){this.enableColorSliderChangeEvent(a)}),1E3);return b},updateOutlineWidthOnColorRenderer:function(a){var b=this.renderer.infos;this.renderer.clearBreaks();m.forEach(b,function(b,d){this.renderer.addBreak({minValue:b.minValue,maxValue:b.maxValue,symbol:this.setOutlineWidthOfSymbol(b.symbol,a),label:b.label})},this);this.renderer.defaultSymbol&&
(this.renderer.defaultSymbol=this.setOutlineWidthOfSymbol(this.renderer.defaultSymbol,a));this.defaultInfo&&this.defaultInfo.defaultSymbol&&(this.defaultInfo.defaultSymbol=this.setOutlineWidthOfSymbol(this.defaultInfo.defaultSymbol,a))},updateColorRenderer:function(a,b){b=b||this._rendererColorOtherSymbol;if(esri.isDefined(a)&&"esriGeometryPolygon"===this.geometryType)if(a)this.updateOutlineWidthOnColorRenderer(1),this.getSuggestedOutline().then(e.hitch(this,function(a){this.replaceVisualVariable("sizeInfo",
"outline",a.widthInfo,this.renderer);this.applyColorRenderer(this.renderer)}),e.hitch(this,function(a){a=this.getVisualVariablesExceptTypes([{type:"sizeInfo",target:"outline"}],this.renderer.visualVariables);this.renderer.setVisualVariables(a);this.applyColorRenderer(this.renderer)}));else{var c=this.getVisualVariablesExceptTypes([{type:"sizeInfo",target:"outline"}],this.renderer.visualVariables);this.renderer.setVisualVariables(c);this.applyColorRenderer(this.renderer)}else this.applyColorRenderer(this.renderer);
this.isSymbolTransparent(this.defaultInfo.defaultSymbol)?this.drawTransparentSymbol(b):(this.drawSymbol(b,this.defaultInfo.defaultSymbol,null,null,null,1),this.updateBackgroundForAlmostWhite(this.defaultInfo.defaultSymbol,b))},updateSchemeOnColorRenderer:function(a){a=a||{};if(!a.scheme)return b;var b=a.renderer||this.renderer,c=this.getVisualVariableByType("colorInfo",null,b.visualVariables);if(c){var d=a.scheme.colors;m.forEach(c.stops,function(a,b){a.color=d[b]});this.replaceVisualVariable("colorInfo",
null,c,b)}else c=b.infos,d=a.scheme.colorsForClassBreaks[c.length-1].colors,b.clearBreaks(),m.forEach(c,function(a,c){b.addBreak({minValue:a.minValue,maxValue:a.maxValue,symbol:a.symbol.setColor(d[c]),label:a.label})},this);this.updateColorSlider(b);return b},updateThemeOnColorRenderer:function(a){var b=new n;setTimeout(function(){b.progress(b)},1);a=a||{};this.scheme=null;var c=this.getRendererDataRange("colorInfo");this.buildColorRenderer({classified:a.classified,theme:a.theme,normalizationType:a.normalizationType,
normalizationField:a.normalizationField,minValue:c.min,maxValue:c.max,showOthers:a.showOthers}).then(e.hitch(this,function(d){b.isRejected()||(this.renderer=d.renderer,this.disableSliderChangeEvent(),d=this.getHandleInfo(a.theme),this.updateColorSlider(),this.colorSlider&&this.colorSlider.set("handles",d.handles),this.colorSlider&&this.colorSlider.set("primaryHandle",d.primaryHandle),setTimeout(e.hitch(this,function(){this.enableColorSliderChangeEvent(a)}),1E3),b.resolve(this.renderer))}),e.hitch(this,
function(a){b.isRejected()||b.reject()}));return b},updateRendererProperties:function(a,b){b=b||this.renderer;a=a||{};b=this.updateSymbolOnColorRenderer(a,b);a.showOthers?(b.defaultSymbol=a.defaultSymbol,b.defaultLabel=a.defaultLabel):a.showOthers||(delete b.defaultSymbol,delete b.defaultLabel);a.rotationInfo&&b.setRotationInfo(a.rotationInfo);return b},createColorInfoSlider:function(a){var b=a.attributeItem||this.attributeItem,c=function(a,d){var c=this.getVisualVariableByType("colorInfo",null,this.renderer.visualVariables),
g=this.getRendererDataRange("colorInfo");if(0===a.statistics.count||("esriFieldTypeInteger"==b.type||"esriFieldTypeSmallInteger"==b.type)&&"percent-of-total"===a.normalizationType){var h=this.getHandleInfo(a.theme);this.colorSlider=new p({colorInfo:c,statistics:a.statistics,minValue:esri.isDefined(g.min)?Math.min(g.min,c.stops[0].value):null,maxValue:esri.isDefined(g.max)?Math.max(g.max,c.stops[c.stops.length-1].value):null,showHistogram:!1,handles:h.handles,primaryHandle:h.primaryHandle,showLabel:!0,
showTick:!0,showRatioLabels:a.showRatioLabels,histogramWidth:70},"rendererColorSlider");this.colorSlider.startup();this.enableColorSliderChangeEvent(a);d.resolve()}else h=this.getHandleInfo(a.theme),this.getHistogram({field:b.name,numBins:10,classificationMethod:"equal-interval",minValue:g.min,maxValue:g.max,normalizationType:a.normalizationType,normalizationField:a.normalizationField}).then(e.hitch(this,function(b){d.isRejected()||(this.onCalculationsSource(b.source),this.colorSlider=new p({colorInfo:c,
statistics:a.statistics,histogram:b,minValue:esri.isDefined(g.min)?Math.min(g.min,c.stops[0].value):null,maxValue:esri.isDefined(g.max)?Math.max(g.max,c.stops[c.stops.length-1].value):null,histogram:b,handles:h.handles,primaryHandle:h.primaryHandle,showLabel:!0,showTick:!0,showRatioLabels:a.showRatioLabels,histogramWidth:70},a.colorSliderDivId||"rendererColorSlider"),this.colorSlider.startup(),this.enableColorSliderChangeEvent(a),d.resolve())}),e.hitch(this,function(b){d.isRejected()||(this.colorSlider=
new p({colorInfo:c,statistics:a.statistics,histogram:null,minValue:g.min,maxValue:g.max,handles:h.handles,primaryHandle:h.primaryHandle,showLabel:!0,showTick:!0,showRatioLabels:a.showRatioLabels,histogramWidth:70},"rendererColorSlider"),this.colorSlider.startup(),this.enableColorSliderChangeEvent(a),d.resolve())}))},d=new n;setTimeout(function(){d.progress(d)},1);a=a||{};this.destroyColorSlider();(this.fLayer||this.layer).addPlugin("esri/plugins/FeatureLayerStatistics").then(e.hitch(this,function(){d.isRejected()||
(a.statistics?(this.displayZeroFeaturesMsg(a.statistics.count),this.onCalculationsSource(a.statistics.source,a.statistics.count),e.hitch(this,c,a,d)()):(this.fLayer||this.layer).statisticsPlugin.getFieldStatistics({field:b.name,normalizationType:a.normalizationType,normalizationField:a.normalizationField}).then(e.hitch(this,function(b){d.isRejected()||(a.statistics=b,this.displayZeroFeaturesMsg(b.count),this.onCalculationsSource(b.source,b.count),e.hitch(this,c,a,d)())}),e.hitch(this,function(b){d.isRejected()||
(this.handleError(b,"getFieldStatistics",!1),e.hitch(this,c,a,d)())})))}),e.hitch(this,function(a){d.isRejected()||(this.handleError(a,"addPlugin",!1),d.reject())}));return d},createClassedColorInfoSlider:function(a,b){var c=a.attributeItem||this.attributeItem,d=function(a,b){var d=this.getRendererDataRange("colorInfo");this.getHistogram({field:c.name,minValue:d.min,maxValue:d.max,normalizationType:a.normalizationType,normalizationField:a.normalizationField}).then(e.hitch(this,function(c){b.isRejected()||
(this.onCalculationsSource(c.source),this.colorSlider=new v({breakInfos:e.clone(this.renderer.infos),classificationMethod:a.classificationMethod,normalizationType:a.normalizationType,statistics:a.statistics,histogram:c,minValue:d.min,maxValue:d.max,showLabel:!0,showTick:!0,showHandles:10<this.renderer.infos.length?!1:!0,histogramWidth:70},"rendererColorSlider"),this.colorSlider.startup(),this.enableColorSliderChangeEvent(a),this.precisionsStore=this.buildPrecisionsStore(this.renderer),this._rendererColorPrecision.setStore(this.precisionsStore,
"",{}),b.resolve())}),e.hitch(this,function(c){b.isRejected()||(this.colorSlider=new v({breakInfos:e.clone(this.renderer.infos),classificationMethod:a.classificationMethod,normalizationType:a.normalizationType,statistics:a.statistics,histogram:null,minValue:d.min,maxValue:d.max,showLabel:!0,showTick:!0,showHandles:10<this.renderer.infos.length?!1:!0,histogramWidth:70},"rendererColorSlider"),this.colorSlider.startup(),this.enableColorSliderChangeEvent(a),this.precisionsStore=this.buildPrecisionsStore(this.renderer),
this._rendererColorPrecision.setStore(this.precisionsStore,"",{}),b.resolve())}))};b=new n;setTimeout(function(){b.progress(b)},1);a=a||{};this.destroyColorSlider();(this.fLayer||this.layer).addPlugin("esri/plugins/FeatureLayerStatistics").then(e.hitch(this,function(){b.isRejected()||(a.statistics?(this.displayZeroFeaturesMsg(a.statistics.count),this.onCalculationsSource(a.statistics.source,a.statistics.count),e.hitch(this,d,a,b)()):(this.fLayer||this.layer).statisticsPlugin.getFieldStatistics({field:c.name,
normalizationType:a.normalizationType,normalizationField:a.normalizationField}).then(e.hitch(this,function(c){b.isRejected()||(a.statistics=c,this.displayZeroFeaturesMsg(c.count),this.onCalculationsSource(c.source,c.count),e.hitch(this,d,a,b)())}),e.hitch(this,function(c){b.isRejected()||(this.handleError(c,"getFieldStatistics",!1),e.hitch(this,d,a,b)())})))}),e.hitch(this,function(a){b.isRejected()||(this.handleError(a,"addPlugin",!1),b.reject())}));return b},updateColorSlider:function(a){a=a||this.renderer;
var b=this.getVisualVariableByType("colorInfo",null,a.visualVariables);b?this.colorSlider&&this.colorSlider.set("colorInfo",b):(this.colorSlider&&this.colorSlider.set("breakInfos",e.clone(a.infos)),a=this.getRendererDataRange("colorInfo"),esri.isDefined(a.min)&&esri.isDefined(a.max)&&(this.colorSlider&&this.colorSlider.set("minValue",a.min),this.colorSlider&&this.colorSlider.set("maxValue",a.max)))},enableColorSliderChangeEvent:function(a){if(this.colorSlider){a=a||{};var b=a.attributeItem||this.attributeItem;
this.sliderZoomedHandler=this.colorSlider.on("zoomed",e.hitch(this,function(a){!1===a&&this.clearZoom()}));this.colorSlider instanceof p?(this.sliderChangeHandler=this.colorSlider.on("handle-value-change",e.hitch(this,function(b){this.replaceVisualVariable("colorInfo",null,b,this.renderer);this.updateStopLabels&&this.updateStopLabels();this.applyColorRenderer(this.renderer,a);this.onColorSliderChange()})),this.sliderChangeHandler2=this.colorSlider.on("data-value-change",e.hitch(this,function(c){var d=
this.getVisualVariableByType("colorInfo",null,this.authoringInfo.visualVariables);d.minSliderValue=c.minValue;d.maxSliderValue=c.maxValue;this.replaceVisualVariable("colorInfo",null,d,this.authoringInfo);this.updateStopLabels&&this.updateStopLabels();this.applyColorRenderer(this.renderer,a);this.onColorSliderChange();this.getParams().then(e.hitch(this,function(a){this.getHistogram({field:b.name,minValue:c.minValue,maxValue:c.maxValue,normalizationType:a.normalizationType,normalizationField:a.normalizationField}).then(e.hitch(this,
function(b){this.onCalculationsSource(b.source);this.disableSliderChangeEvent();this.colorSlider.set("histogram",b);setTimeout(e.hitch(this,function(){this.enableColorSliderChangeEvent(a)}),1E3)}),e.hitch(this,function(b){this.handleError(b,"getHistogram",!1);this.disableSliderChangeEvent();this.colorSlider.set("histogram",null);setTimeout(e.hitch(this,function(){this.enableColorSliderChangeEvent(a)}),1E3)}))}))}))):(this.sliderChangeHandler=this.colorSlider.on("handle-value-change",e.hitch(this,
function(b){this.updateBreakInfos(b,a)})),this.sliderChangeHandler2=this.colorSlider.on("data-value-change",e.hitch(this,function(c){this.updateBreakInfos(c.breakInfos,a);this.precisionsStore=this.buildPrecisionsStore(this.renderer);this._rendererColorPrecision.setStore(this.precisionsStore,"",{});this.getParams().then(e.hitch(this,function(a){this.getHistogram({field:b.name,minValue:c.minValue,maxValue:c.maxValue,normalizationType:a.normalizationType,normalizationField:a.normalizationField}).then(e.hitch(this,
function(b){this.onCalculationsSource(b.source);this.disableSliderChangeEvent();this.colorSlider.set("histogram",b);setTimeout(e.hitch(this,function(){this.enableColorSliderChangeEvent(a)}),1E3)}),e.hitch(this,function(b){this.handleError(b,"getHistogram",!1);this.disableSliderChangeEvent();this.colorSlider.set("histogram",null);setTimeout(e.hitch(this,function(){this.enableColorSliderChangeEvent(a)}),1E3)}))}))})))}},updateBreakInfos:function(a,b){this.renderer.clearBreaks();m.forEach(a,function(a,
b){this.renderer.addBreak({minValue:a.minValue,maxValue:a.maxValue,symbol:a.symbol,label:a.label})},this);this.applyColorRenderer(this.renderer,b);this.onColorSliderChange()},disableSliderChangeEvent:function(){this.sliderZoomedHandler&&this.sliderZoomedHandler.remove();this.sliderZoomedHandler=null;this.sliderChangeHandler&&this.sliderChangeHandler.remove();this.sliderChangeHandler=null;this.sliderChangeHandler2&&this.sliderChangeHandler2.remove();this.sliderChangeHandler2=null},zoomInSlider:function(a){if(this.colorSlider){var b=
new n;setTimeout(function(){b.progress(b)},1);a=a||{};var c=a.attributeItem||this.attributeItem,d=this.colorSlider.get("statistics"),f=this.colorSlider.get("handles"),k=this.colorSlider.get("colorInfo").stops[f[0]].value,f=this.colorSlider.get("colorInfo").stops[f[f.length-1]].value,l=f-k,g,h;d.min===d.max?(g=k-l/3,h=f+l/3,k=g,d=h):(g=Math.max(k-l/3,d.min),h=Math.min(f+l/3,d.max),k=esri.isDefined(a.minValue)?a.minValue:d.min,d=esri.isDefined(a.maxValue)?a.maxValue:d.max);g===k&&h===d?(console.log("Can't zoom in slider"),
b.reject()):(this.fLayer||this.layer).addPlugin("esri/plugins/FeatureLayerStatistics").then(e.hitch(this,function(){b.isRejected()||this.getHistogram({field:c.name,normalizationType:a.normalizationType,normalizationField:a.normalizationField,minValue:g,maxValue:h}).then(e.hitch(this,function(c){b.isRejected()||(this.onCalculationsSource(c.source),c={histogram:c,minSliderValue:g,maxSliderValue:h},this.disableSliderChangeEvent(),this.colorSlider.set("zoomOptions",c),setTimeout(e.hitch(this,function(){this.enableColorSliderChangeEvent(a)}),
1E3),b.resolve())}),e.hitch(this,function(c){b.isRejected()||(c={histogram:null,minSliderValue:g,maxSliderValue:h},this.disableSliderChangeEvent(),this.colorSlider.set("zoomOptions",c),setTimeout(e.hitch(this,function(){this.enableColorSliderChangeEvent(a)}),1E3),b.resolve())}))}),e.hitch(this,function(a){b.isRejected()||(this.handleError(a,"addPlugin",!1),b.reject())}));return b}},zoomOutSlider:function(){this.disableSliderChangeEvent();this.colorSlider&&null!==this.colorSlider.get("zoomOptions")&&
this.colorSlider.set("zoomOptions",null);setTimeout(e.hitch(this,function(){this.enableColorSliderChangeEvent()}),1E3)},getHistogram:function(a){var b=new n;setTimeout(function(){b.progress(b)},1);this.histogramInfo&&this.histogramInfo.field===a.field&&this.histogramInfo.normalizationType===a.normalizationType&&this.histogramInfo.normalizationField===a.normalizationField&&this.histogramInfo.minValue===a.minValue&&this.histogramInfo.maxValue===a.maxValue?b.resolve(this.histogramInfo.histogram):(this.fLayer||
this.layer).addPlugin("esri/plugins/FeatureLayerStatistics").then(e.hitch(this,function(){b.isRejected()||(this.fLayer||this.layer).statisticsPlugin.getHistogram({field:a.field,numBins:10,classificationMethod:"equal-interval",normalizationType:a.normalizationType,normalizationField:a.normalizationField,minValue:a.minValue,maxValue:a.maxValue}).then(e.hitch(this,function(c){b.isRejected()||(this.histogramInfo={histogram:c,field:a.field,normalizationType:a.normalizationType,normalizationField:a.normalizationField,
minValue:a.minValue,maxValue:a.maxValue},b.resolve(c))}),e.hitch(this,function(a){b.isRejected()||(this.handleError(a,"getHistogram",!1),b.reject())}))}),e.hitch(this,function(a){b.isRejected()||(this.handleError(a,"addPlugin",!1),b.reject())}));return b},getHandleInfo:function(a){switch(a){case "high-to-low":return{handles:[0,4],primaryHandle:null};case "above-and-below":return{handles:[0,2,4],primaryHandle:2};case "centered-on":return{handles:[0,2,4],primaryHandle:2};case "extremes":return{handles:[0,
2,4],primaryHandle:null};case "group-similar":return{handles:[0,1,2,3,4],primaryHandle:null}}},destroyColorSlider:function(){this.disableSliderChangeEvent();this.colorSlider&&this.colorSlider.destroy();t.byId("rendererColorSlider")||u.create("div",{id:"rendererColorSlider"},this._rendererColorSliderDiv)},updateColorRendererGrid:function(a){"rendererColorStack"===arcgisonline.map.leftPanel.getLeftContentPanelStack()&&!(this._rendererColorLegendClassesIcon&&-1===this._rendererColorLegendClassesIcon.className.indexOf("active"))&&
(a=a||this.renderer,"classedColor"===this.getRendererStyle(a)&&(this.colorRendererGrid?this.colorRendererGrid.updateGrid(a):(w=this.portalPanel._ColorGrid,this.colorRendererGrid=new w({id:"rendererColorGrid",renderer:a,style:"position: relative; width: 100%; height:100%; overflow-y:hidden; overflow-x:hidden; padding:0;",params:this.params},"rendererColorGrid")),this.adjustHeight()))},destroyColorRendererGrid:function(){this.colorRendererGrid&&(this.colorRendererGrid.destroy(),this.colorRendererGrid=
null,t.byId("rendererColorGrid")||u.create("div",{id:"rendererColorGrid"},this._rendererColorGridContainer))}}});