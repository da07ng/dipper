// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("require ../core/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred ../core/sniff ../geometry/SpatialReference ../core/Collection ./FeatureLayer".split(" "),function(f,k,d,e,g,h,l,m,n){return k([n],{declaredClass:"esri.layers.StreamLayer",classMetadata:{reader:{add:["objectIdField"]}},constructor:function(a,b){"WebSocket"in window||(this.loadError=Error("WebSocket is not supported in this browser"),console.log("WebSocket is not supported in this browser. StreamLayer will not have real-time connection with the stream service."))},
normalizeCtorArgs:function(a,b){return"string"===typeof a?d.mixin({},{url:a},b):a&&a.layerDefinition?d.mixin({},{collectionLayer:a},b):a},getDefaults:function(a){var b=this.inherited(arguments);return d.mixin(b||{},{maximumTrackPoints:1,purgeOptions:{displayCount:2E3},maxReconnectAttempts:10,socketDirection:"subscribe",outFields:["*"],hasMemorySource:!!a.collectionLayer})},createGraphicsSource:function(){var a=new g;f(["./graphics/sources/StreamLayerSource"],d.hitch(this,function(b){var c=new b({layer:this});
c.then(d.hitch(this,function(){this.emit("graphics-source-create",{graphicsSource:c});a.resolve(c)}),function(b){a.reject(b)})}));return a.promise},createGraphicsController:function(a){var b=new g,c=a.layerView,p=c.view.map.view===c.view?this.graphicsCollection:new m,q=d.mixin(a.options||{},{layer:this,layerView:c,graphicsCollection:p});f(["./graphics/controllers/StreamController"],d.hitch(this,function(a){var c=new a(q);c.then(d.hitch(this,function(){this.emit("graphics-controller-create",{graphicsController:c});
b.resolve(c)}),function(a){b.reject(a)})}));return b.promise},maximumTrackPoints:1,_maximumTrackPointsSetter:function(a,b){return"number"!==typeof a||!a&&0!==a||0>a?(this.emit("error",Error("Invalid value for maximumTrackPoints: "+a+". It must be a number \x3e\x3d 0")),b):a},purgeOptions:null,_purgeOptionsSetter:function(a){var b=this.purgeOptions;if(a&&b!==a&&(b=a.displayCount&&0<a.displayCount))return a},definitionExpression:null,_definitionExpressionSetter:function(a){if(this.graphicsSource)this.requestedDefinitionExpression=
a;else return a},geometryDefinition:null,_geometryDefinitionSetter:function(a){if(a&&"extent"!==a.type)this.emit("error",new TypeError("Invalid geometry. It must have an extent"));else if(this.graphicsSource)this.requestedGeometryDefinition=a;else return a},_spatialReferenceReader:function(a,b){return(a=b.spatialReference)&&new l(a)},_objectIdFieldReader:function(a,b){a||e.some(b.fields,function(b){"esriFieldTypeOID"===b.type&&(a=b.name);return!!a});var c=1,d=[];if(!a){d=e.filter(b.fields,function(a){return"objectid"===
a.name.split("_")[0]});if(d.length)for(d=e.map(d,function(a){return a.name});-1!==e.indexOf(d,"objectid_"+c);)c+=1;a="objectid_"+c}return a},_initLayerProperties:function(a){this.graphicsSource=a;a=a.layerDefinition;this.read(a);a._ssl&&(this.url=this.url.replace(this.reHttp,"https:"));this._verifyFields();this._fixSymbolUrls();this.useQueryTimestamp=h("ie")||h("safari")},_verifyFields:function(){var a=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("StreamLayer: 'objectIdField' property is not defined (url: "+
a+")")}})});