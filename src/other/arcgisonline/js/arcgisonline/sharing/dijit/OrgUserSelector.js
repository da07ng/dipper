// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
require({cache:{"url:arcgisonline/sharing/dijit/templates/OrgUserSelector.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"marginTop1" data-dojo-attach-point\x3d"_searchControls"\x3e\r\n    \x3clabel data-dojo-attach-point\x3d"_searchLabel"\x3e${i18n.searchByName}\x3c/label\x3e\x3cbr\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_searchBySelect" data-dojo-type\x3d"arcgisonline/sharing/dijit/ComboBox"\r\n         class\x3d"searchBySelect searchSelect display_inline"\x3e\x3c/div\x3e\r\n    \x3cspan data-dojo-attach-point\x3d"_searchContainer" class\x3d"searchControls"\x3e\r\n      \x3cinput type\x3d"text" class\x3d"userSearch"\r\n             data-dojo-attach-point\x3d"_searchBox"\r\n             data-dojo-type\x3d"dijit/form/TextBox"\x3e\r\n      \x3cbutton class\x3d"clearSearchBtn" data-dojo-attach-point\x3d"_clearSearchBtn"\r\n              style\x3d"display:none;"\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3c/button\x3e\r\n      \x3cbutton class\x3d"searchBtn" data-dojo-attach-point\x3d"_searchBtn" title\x3d"${i18n.search}"\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3c/button\x3e\r\n    \x3c/span\x3e\r\n    \x3cspan data-dojo-attach-point\x3d"_filterContainer" style\x3d"display:none;"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_filteringSelect" class\x3d"searchSelect searchFilter display_inline"\r\n           data-dojo-props\x3d"searchAttr:\'name\'" data-dojo-type\x3d"dijit/form/FilteringSelect"\x3e\x3c/div\x3e\r\n    \x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"marginTop1"\x3e\r\n    \x3ctable class\x3d"marginTop1" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"column270"\x3e\x3clabel\x3e${i18n.clickToAdd}\x3c/label\x3e\x3c/td\x3e\r\n          \x3ctd class\x3d"column10"\x3e\x3c/td\x3e\r\n          \x3ctd class\x3d"column270"\x3e\x3clabel\x3e${i18n.clickToRemove}\x3c/label\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"column270"\x3e\r\n            \x3cdiv class\x3d"userListLabel"\x3e\r\n              \x3cdiv data-dojo-attach-point\x3d"_userListLabel"\x3e${i18n.users}\x3c/div\x3e\r\n              \x3cdiv class\x3d"esriFloatTrailing actionLink" data-dojo-attach-point\x3d"_addAllContainer"\x3e\r\n                \x3cspan class\x3d"esriItemLinks"\x3e\x3ca data-dojo-attach-point\x3d"_addAll" class\x3d"pointer"\x3e${i18n.addAll}\x3c/a\x3e\x3c/span\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"userListContainer" data-dojo-type\x3d"dijit/layout/BorderContainer"\r\n                data-dojo-props\x3d"gutters:false,splitters:false,design:\'headline\'"\x3e\r\n              \x3cdiv class\x3d"userListInnerContainer"\r\n                   data-dojo-type\x3d"dijit/layout/ContentPane"\r\n                   data-dojo-props\x3d"region:\'middle\',splitter:false"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_usersPane"\x3e\r\n                  \x3c!-- user list is populated here --\x3e\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"column10"\x3e\x3c/td\x3e\r\n          \x3ctd class\x3d"column270"\x3e\r\n            \x3cdiv class\x3d"userListLabel selectedUserListLabel"\x3e\r\n              \x3cdiv data-dojo-attach-point\x3d"_selectedUserListLabel"\x3e${i18n.selectedUsers}\x3c/div\x3e\r\n              \x3cdiv class\x3d"esriFloatTrailing actionLink" data-dojo-attach-point\x3d"_clearAllContainer"\x3e\r\n                \x3cspan class\x3d"esriItemLinks"\x3e\x3ca data-dojo-attach-point\x3d"_clearAll" class\x3d"pointer"\x3e${i18n.clear}\x3c/a\x3e\x3c/span\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"selectedUserListContainer" data-dojo-type\x3d"dijit/layout/BorderContainer"\r\n                 data-dojo-props\x3d"gutters:false,splitters:false,design:\'headline\'"\x3e\r\n              \x3cdiv class\x3d"userListInnerContainer"\r\n                   data-dojo-type\x3d"dijit/layout/ContentPane"\r\n                   data-dojo-props\x3d"region:\'middle\',splitter:false"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_selectedUsersPane"\x3e\r\n                  \x3c!-- selected user list is populated here --\x3e\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n'}});
define("arcgisonline/sharing/dijit/OrgUserSelector","require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/keys dojo/on dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dijit/a11yclick dojo/sniff dojo/Deferred dojo/promise/all dojo/store/Memory dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/Button arcgisonline/sharing/dijit/ComboBox dijit/form/FilteringSelect dijit/form/TextBox dijit/layout/BorderContainer dijit/layout/ContentPane esri/lang arcgisonline/sharing/util arcgisonline/sharing/geow/Account arcgisonline/sharing/geow/Roles dojo/i18n!arcgisonline/nls/arcgisonline dojo/text!arcgisonline/sharing/dijit/templates/OrgUserSelector.html".split(" "),
function(D,E,g,h,F,l,t,M,u,d,w,A,s,x,y,G,H,I,N,O,P,Q,R,S,k,q,J,K,B,L){return E("arcgisonline.sharing.dijit.OrgUserSelector",[G,H,I],{declaredClass:"arcgisonline.sharing.dijit.OrgUserSelector",baseClass:"esriOrgUserSelector",basePath:D.toUrl("arcgisonline/sharing/dijit"),templateString:L,widgetsInTemplate:!0,constructor:function(a){this.inherited(arguments);this._setConstructorProperties(a)},postMixInProperties:function(){this.inherited(arguments);this._mixinI18N();this._setConstants()},postCreate:function(){this.inherited(arguments);
this._createConnections();this._setIntializationProperties()},startup:function(){this.inherited(arguments);this._initialize()},_mixinI18N:function(){var a={};g.mixin(a,B.common);g.mixin(a,B.orgUserSelector);this._set("i18n",a)},_setConstants:function(){this.SEARCH_BY_NAME_ID="name";this.SEARCH_BY_GROUP_ID="group";this.SEARCH_BY_ROLE_ID="role"},_setConstructorProperties:function(a){a.users&&this._set("users",a.users);a.selectedUsers&&this._set("selectedUsers",a.selectedUsers);k.isDefined(a.autoLoad)?
this._set("autoLoad",a.autoLoad):this._set("autoLoad",!0);k.isDefined(a.enableSearch)?this._set("enableSearch",a.enableSearch):this._set("enableSearch",!0);k.isDefined(a.enableSelectBy)?this._set("enableSelectBy",a.enableSelectBy):this._set("enableSelectBy",!0);k.isDefined(a.enableListActions)&&this._set("enableListActions",a.enableListActions);k.isDefined(a.excludeCurrentUser)&&this._set("excludeCurrentUser",a.excludeCurrentUser)},_createConnections:function(){this.own(w(this._searchBtn,g.hitch(this,
this._searchClick)),w(this._clearSearchBtn,g.hitch(this,this._clearSearch)),l(this._searchBox,"blur",g.hitch(this,function(a){a&&a.preventDefault()})),l(this._usersPane,"click",g.hitch(this,this._selectUser)),l(this._selectedUsersPane,"click",g.hitch(this,this._removeUser)),l(this._searchBySelect,"change",g.hitch(this,this._searchByChange)),l(this._filteringSelect,"change",g.hitch(this,this._filterChange)),w(this._addAll,g.hitch(this,this._addAllClick)),w(this._clearAll,g.hitch(this,this._clearAllClick)));
10>=A("ie")||7>A("trident")?this.own(l(this._searchBox,"keydown",g.hitch(this,this._searchKeyup))):this.own(l(this._searchBox,"keyup",g.hitch(this,this._searchKeyup)))},_setIntializationProperties:function(){this._rolesAPI=new K;this._set("user",q.getUser());this._searchBox.set("value","");this._filteringSelect.validate=function(){};this._initSearchBy()},_initSearchBy:function(){var a=new y({data:[{id:this.SEARCH_BY_NAME_ID,name:this.i18n.searchByOpts.name},{id:this.SEARCH_BY_GROUP_ID,name:this.i18n.searchByOpts.group},
{id:this.SEARCH_BY_ROLE_ID,name:this.i18n.searchByOpts.role}]});this._searchBySelect.set("store",a);this._searchBySelect.set("displayedValue",this.i18n.searchByOpts.name)},_initializeUI:function(){this._toggleClearSearchButton();this._toggleEnableSearch();this._toggleEnableSelectBy();this._toggleEnableListActions()},_setSelfDependentProperties:function(a){},_loadGroups:function(){var a=this;a._retrieveAllGroups().then(function(){a._createGroupStore()})},_loadRoles:function(){var a=this;a._retrieveAllRoles().then(function(){a._createRoleStore()})},
_initialize:function(){var a=this;a._initializeUI();J.getSelf(function(b){a._setSelfDependentProperties(b);a._loadGroups();a._loadRoles();b=a._get("autoLoad");var c=a._get("users");b&&(!c||0===c.length)?a._doSearch(null).then(function(){a._refreshUsers()}):a._refreshUsers();a._refreshSelectedUsers()})},_searchKeyup:function(a){a.keyCode===F.ENTER&&this._searchClick(a);this._toggleClearSearchButton()},_toggleClearSearchButton:function(){var a=g.trim(this._searchBox.get("value"));a&&0<a.length?d.set(this._clearSearchBtn,
"display",""):d.set(this._clearSearchBtn,"display","none")},_toggleEnableSelectBy:function(){this._get("enableSelectBy")?d.set(this._searchBySelect.domNode,"display",""):d.set(this._searchBySelect.domNode,"display","none")},_toggleEnableSearch:function(){this._get("enableSearch")?d.set(this._searchControls,"display",""):d.set(this._searchControls,"display","none")},_toggleEnableListActions:function(){this._get("enableListActions")?(d.set(this._addAllContainer,"display",""),d.set(this._clearAllContainer,
"display","")):(d.set(this._addAllContainer,"display","none"),d.set(this._clearAllContainer,"display","none"))},_searchClick:function(a){a&&a.preventDefault();var b=this;a=g.trim(b._searchBox.get("value"));k.isDefined(a)&&0<a.length?b._searchName(a).then(function(){b._refreshUsers()}):(b._set("userResults",null),b._refreshUsers())},_searchName:function(a){var b=new s,c=this._get("users"),e=[];a=a&&0<a.length?a.toLowerCase():a;k.isDefined(a)&&0<a.length?(h.forEach(c,function(b){(b.fullName&&-1<b.fullName.toLowerCase().indexOf(a)||
b.firstName&&-1<b.firstName.toLowerCase().indexOf(a)||b.lastName&&-1<b.lastName.toLowerCase().indexOf(a)||b.username&&-1<b.username.toLowerCase().indexOf(a))&&e.push(g.clone(b))}),this._set("userResults",e)):this._set("userResults",null);b.resolve();return b},_searchUsers:function(a){q.isPortal()&&(a.excludeSystemUsers=!0);return q.request({url:esriGeowConfig.restBaseUrl+"portals/self/users",content:a})},_doSearch:function(a){var b=this,c=new s,e=[],f=0,g=-1,r=0,d=0,m=[],C=k.isDefined(a)&&0<a.length,
p=q.getUser(),n=b._get("excludeCurrentUser"),z={start:1,num:100},v;b._searchUsers(z).then(function(a){if(a.code&&a.message)console.log("Error searching for users.",a),c.reject(a);else if(n&&p&&p.username?h.forEach(a.users,function(a){a.username!==p.username&&m.push(a)}):m=m.concat(a.users),0<a.nextStart){r=a.total-a.users.length;d=Math.ceil(r/100);for(g=a.nextStart;f<d;f++)z.start=g+100*f,e.push(b._searchUsers(z));x(e).then(function(a){for(f=0;f<a.length;f++)v=a[f],!v.code&&!v.message&&(n&&p&&p.username?
h.forEach(v.users,function(a){a.username!==p.username&&m.push(a)}):m=m.concat(v.users));b._processUsers(C,m);c.resolve()},function(a){console.log("Error retrieving the remaining users.",a);c.resolve()})}else b._processUsers(C,m),c.resolve()},function(a){console.log("Error searching for users.",a);c.reject(a)});return c},_clearSearch:function(){var a=this;a._searchBox.set("value","");a._toggleClearSearchButton();a._searchName(null).then(function(){a._refreshUsers()})},_clearFilter:function(){var a=
this;a._filteringSelect.set("value","");a.SEARCH_BY_GROUP_ID===a._searchBy?(a._filteringSelect.set("store",a._groupStore),a._searchGroups(null).then(function(){a._refreshUsers()})):a.SEARCH_BY_ROLE_ID===a._searchBy&&(a._filteringSelect.set("store",a._roleStore),a._searchRoles(null).then(function(){a._refreshUsers()}))},_processUsers:function(a,b){this._distinguishUserTitles(b);a?this._set("userResults",b):(this._set("users",b),this._set("userResults",null));this.emit("result",{users:b})},_distinguishUserTitles:function(a){if(k.isDefined(a)){var b,
c,e=esriGeowConfig.isRightToLeft?" \x26#8207;":" ";for(b=0;b<a.length;b++)c=a[b],c.altName=c.fullName+e+"("+c.username+")"}},_createGroupStore:function(){this._groupStore=new y({data:g.clone(this._get("allGroups"))})},_createRoleStore:function(){this._roleStore=new y({data:g.clone(this._get("allRoles"))})},_retrieveAllRoles:function(){var a=this,b=new s,c=[],e=[{id:"org_admin",name:this.i18n.defaultRoles.admin},{id:"org_publisher",name:this.i18n.defaultRoles.publisher},{id:"org_user",name:this.i18n.defaultRoles.user}],
f,g,r;a._set("allRoles",e);a._rolesAPI.getRoles(1,100).then(function(d){if(d&&d.roles)if(e=e.concat(d.roles),f=d.total=d.roles.length,g=Math.ceil(f/100),0<d.nextStart){for(r=0;r<g;r++)c.push(a._rolesAPI.getRoles(d.nextStart+100*r,100));x(c).then(function(c){h.forEach(c,function(a){a&&a.roles&&(e=e.concat(a.roles))});a._set("allRoles",e);b.resolve()},function(a){b.resolve()})}else a._set("allRoles",e),b.resolve()},function(a){b.resolve()});return b},_retrieveAllGroups:function(){var a=this,b=new s,
c=[],e=[],f,g,d,k=esriGeowConfig.restBaseUrl+"community/groups",m={q:"orgid:"+a._get("user").accountId,start:1,num:100},l=[],p=esriGeowConfig.isRightToLeft?" \x26#8207;":" ";a._set("allGroups",[]);q.request({url:k,content:m}).then(function(n){if(n&&n.results)if(h.forEach(n.results,function(a){l.push({id:a.id,name:-1<h.indexOf(c,a.title)?a.title+p+"("+a.owner+")":a.title})}),f=n.total-n.results.length,g=Math.ceil(f/100),0<n.nextStart){for(d=0;d<g;d++)m.start=n.nextStart+100*d,e.push(q.request({url:k,
content:m}));x(e).then(function(f){h.forEach(f,function(b){b&&b.results&&(h.forEach(b.results,function(a){l.push({id:a.id,name:-1<h.indexOf(c,a.title)?a.title+" ("+a.owner+")":a.title})}),a._set("allGroups",l))});b.resolve()},function(a){console.log("Error retrieving the subsequent set or sets of groups.",a);b.resolve()})}else a._set("allGroups",l),b.resolve()},function(a){console.log("Error retrieving the initial set of groups.",a);b.resolve()});return b},_retrieveCurrentUsers:function(){var a=this._get("userResults");
return k.isDefined(a)?a:this._get("users")},_retrieveSelectedUsers:function(){return this._get("selectedUsers")||[]},_emitSelectionChange:function(){this.emit("selection-change",{selectedUsers:this._retrieveSelectedUsers()})},_addAllClick:function(a){a=this._retrieveCurrentUsers();var b=this._retrieveSelectedUsers(),b=b?b.length:0;this._set("selectedUsers",g.clone(a));this._refreshSelectedUsers();a.length!==b&&this._emitSelectionChange()},_clearAllClick:function(a){a=this._retrieveSelectedUsers();
this._set("selectedUsers",[]);this._refreshSelectedUsers();0<a.length&&this._emitSelectionChange()},_selectUser:function(a){if(a&&a.target&&a.target.id){var b=a.target.id.indexOf("user-"),c=!1,e,f;if(-1<b&&(a=parseInt(a.target.id.substring(b+5),10),b=this._retrieveCurrentUsers()))if(e=b[a]){a=this._retrieveSelectedUsers();for(b=0;b<a.length;b++)if(f=a[b],f.fullName===e.fullName&&f.username===e.username){c=!0;break}c||(c=g.clone(e),a.push(c),this._set("selectedUsers",a),this.emit("select",{selectedUser:c}),
this._emitSelectionChange(),this._refreshSelectedUsers())}}},_searchByChange:function(a){a=this._searchBySelect.get("value");a=(a=this._searchBySelect.get("store").query({name:a}))&&0<a.length?a[0]:a;this._searchBy=a.id;if(this.SEARCH_BY_NAME_ID===this._searchBy)d.set(this._filterContainer,"display","none"),d.set(this._searchContainer,"display",""),this._clearSearch(),this._searchBox.focus();else if(this.SEARCH_BY_GROUP_ID===this._searchBy||this.SEARCH_BY_ROLE_ID===this._searchBy)d.set(this._searchContainer,
"display","none"),d.set(this._filterContainer,"display",""),this._clearFilter(),this._filteringSelect.focus()},_filterChange:function(a){var b=this;a=b._filteringSelect.get("value");b.SEARCH_BY_GROUP_ID===this._searchBy?b._searchGroups(a).then(function(){b._refreshUsers()}):b.SEARCH_BY_ROLE_ID===this._searchBy&&b._searchRoles(a).then(function(){b._refreshUsers()})},_searchRoles:function(a){var b=new s,c=this._get("users"),e=[];k.isDefined(a)&&0<a.length?(h.forEach(c,function(b){(b.roleId===a||b.role===
a)&&e.push(g.clone(b))}),this._set("userResults",e)):this._set("userResults",null);b.resolve();return b},_searchGroups:function(a){var b=this,c=new s,e=esriGeowConfig.restBaseUrl+"community/groups",f=[];k.isDefined(a)&&0<a.length?q.request({url:e+"/"+a+"/users"}).then(function(a){a&&(h.forEach(a.admins,function(a){-1===h.indexOf(f,a)&&f.push(a)}),h.forEach(a.users,function(a){-1===h.indexOf(f,a)&&f.push(a)}));f=b._populateUserList(f);b._set("userResults",f);c.resolve()},function(b){console.log("Error retrieving users from group.",
a,b);c.reject(b)}):(b._set("userResults",null),c.resolve());return c},_populateUserList:function(a){var b=[],c=this._get("users"),e,f,d,h;if(k.isDefined(a)){for(e=0;e<a.length;e++){d=a[e];for(f=0;f<c.length;f++)if(h=c[f],h.username===d){b.push(g.clone(h));break}}return b}return a},_removeUser:function(a){if(a&&a.target&&a.target.id){var b;-1<a.target.id.indexOf("selected-user-")&&(b=parseInt(a.target.id.substring(14),10),a=this._retrieveSelectedUsers(),a.length>b&&(b=a.splice(b,1)[0],this._set("selectedUsers",
a),this.emit("remove",{removedUser:b}),this._emitSelectionChange(),this._refreshSelectedUsers()))}},_refreshSelectedUsers:function(){t.set(this._selectedUsersPane,"innerHTML","");var a=this._retrieveSelectedUsers(),b,c;if(a)for(b=0;b<a.length;b++)c=a[b],u.create("a",{id:"selected-user-"+b,innerHTML:c.altName||c.fullName,className:"linkNoHref","data-fullName":c.fullName,"data-username":c.username},this._selectedUsersPane),u.create("br",null,this._selectedUsersPane)},_refreshUsers:function(){t.set(this._usersPane,
"innerHTML","");var a=this._retrieveCurrentUsers(),b,c;if(a&&0<a.length)for(c=0;c<a.length;c++)b=a[c],u.create("a",{id:"user-"+c,innerHTML:b.altName||b.fullName,className:"linkNoHref","data-fullName":b.fullName,"data-username":b.username},this._usersPane),u.create("br",null,this._usersPane);else a&&0===a.length&&u.create("span",{innerHTML:this._get("i18n").noSearchResults},this._usersPane)},enableSelectByUI:function(a){this._set("enableSelectBy",a);this._toggleEnableSelectBy()},enableSearchUI:function(a){this._set("enableSearch",
a);this._toggleEnableSearch()},enableListActionsUI:function(a){this._set("enableListActions",a);this._toggleEnableListActions()},reset:function(){this._searchBySelect.set("value",this.i18n.searchByOpts.name);this._clearSearch();this._clearAllClick()},focusSearch:function(){this._searchBy&&(this.SEARCH_BY_GROUP_ID===this._searchBy||this.SEARCH_BY_ROLE_ID===this._searchBy)?this._filteringSelect.focus():this._searchBox.focus()},_setSearchLabelAttr:function(a){this._searchLabel&&t.set(this._searchLabel,
"innerHTML",a)},_setUsersLabelAttr:function(a){this._userListLabel&&t.set(this._userListLabel,"innerHTML",a)},_setSelectedUsersLabelAttr:function(a){this._selectedUserListLabel&&t.set(this._selectedUserListLabel,"innerHTML",a)},_setUsersAttr:function(a){this._set("users",a);this._set("userResults",null);this._refreshUsers()},_getUsersAttr:function(){return this._retrieveCurrentUsers()},_setSelectedUsersAttr:function(a){this._set("selectedUsers",a);this._emitSelectionChange();this._refreshSelectedUsers()},
_getSelectedUsersAttr:function(){return this._retrieveSelectedUsers()},_setValueAttr:function(a){this._set("selectedUsers",a);this._emitSelectionChange();this._refreshSelectedUsers()},_getValueAttr:function(){return this._retrieveSelectedUsers()}})});