// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define(["./IdGen","./Util","./GLUtil","./DDSUtil"],function(c,n,l,p){var m=new c,r=function(c,h,b,q,k,g,e,f){e=!1!==e;var d=new Image;d.src=c;d.onerror=function(){g();d.onerror=void 0;d.onload=void 0};d.onload=function(){b.isTexture(h)&&l.texImage2D(d,h,b,q,k,e,!0,f);g();d.onerror=void 0;d.onload=void 0}};c=function h(b,c,k){var g=m.gen(c),e;this.getId=function(){return g};this.params=k||{};this.params.wrapClamp=this.params.wrapClamp||!1;this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=
this.params.noUnpackFlip||!1;this.estimatedTexMemRequiredMB=null==b?0:b.byteLength?b.byteLength/1E6:4*1.3*this.params.width*this.params.height/1E6;this.getEstimatedTexMemRequiredMB=function(){return this.estimatedTexMemRequiredMB};this.dispose=function(){b=void 0};this.deferredLoading=function(){return"string"===typeof b};this.getWidth=function(){return this.params.width};this.getHeight=function(){return this.params.height};this.loadGl=function(f,d,a,c,e){"string"===typeof b?r(b,d,a,c,e,f,this.params.mipmap,
this.params.noUnpackFlip):b instanceof Image||b instanceof ImageData||b instanceof HTMLCanvasElement?(this.params.width=b.width,this.params.height=b.height,l.texImage2D(b,d,a,c,e,this.params.mipmap,this.params.mipmap||!this.params.wrapClamp,this.params.noUnpackFlip)):b&&(this.params.encoding===h.DDS_ENCODING?(f=p.uploadDDSLevels(a,b,!0),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<f.mipmapCount?a.LINEAR_MIPMAP_LINEAR:a.LINEAR),this.params.width=
f.width,this.params.height=f.height):(!0===this.params.noUnpackFlip&&a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),n.assert(this.params.width&&this.params.height),f=a.RGBA,1===this.params.components&&(f=a.LUMINANCE),a.texImage2D(a.TEXTURE_2D,0,f,this.params.width,this.params.height,0,f,a.UNSIGNED_BYTE,b),this.params.mipmap?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.generateMipmap(a.TEXTURE_2D)):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),!0===this.params.noUnpackFlip&&
a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0)));a._isTracingEnabled&&(d._debugTracingType="Texture");b=void 0};this.setUnloadFunc=function(b){e=b};this.unload=function(){void 0!==e&&(e(g),e=void 0)}};c.__idGen=m;c.DDS_ENCODING="image/vnd-ms.dds";return c});