// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("esri/core/declare dojo/dom-class dojo/dom-construct dojo/on dojo/Deferred webSceneViewer/mapUtils webSceneViewer/widgets/SlideDeck/SlideDeck dijit/InlineEditBox webSceneViewer/webScene/Presentation dojo/topic dojox/mdnd/AreaManager dojox/mdnd/DropIndicator dojox/mdnd/dropMode/OverDropMode ../OptionsMenu/OptionsMenu ../../basemapUtils ../../environmentUtils dojo/fx dojo/_base/fx dojox/fx/style dojo/fx/easing dojo/dom-geometry dojo/i18n!../nls/widgets".split(" "),function(s,p,f,k,t,u,v,w,x,
y,z,A,B,C,D,E,q,l,n,m,r,g){function F(a,b){null==b.presentation&&(b.presentation=new x);b.presentation.addSlide(a)}function G(a){a=a.childNodes[0].childNodes[2];var b=document.getElementById("slideThumbnailAnimation"),c=document.getElementById("webscene-map"),e=r.position(a),d=r.position(c),c=[];c.push(n.addClass(a,"hidden",{duration:1}));b.style.left=d.x+"px";b.style.top=d.y-61+"px";b.style.height=d.h+"px";b.style.width=d.w+"px";b.style.opacity=0.2;b.style.backgroundColor="transparent";b.style.border=
"12px solid white";b.style.zIndex=101;b.style.backgroundSize="cover";b.style.backgroundRepeat="no-repeat";p.remove(b,"hide");d=l.animateProperty({node:"slideThumbnailAnimation",properties:{opacity:0.9},duration:100,easing:m.quadIn});c.push(d);d=l.animateProperty({node:"slideThumbnailAnimation",properties:{opacity:0.2},duration:100,easing:m.quadOut,onEnd:function(){b.style.backgroundImage="url("+a.src+")";b.style.opacity=0;b.style.border="0px solid white"}});c.push(d);e=l.animateProperty({node:"slideThumbnailAnimation",
properties:{height:e.h,width:e.w,top:e.y-61,left:e.x},duration:350,unit:"px",easing:m.quadOut});d=l.animateProperty({node:"slideThumbnailAnimation",properties:{opacity:0.95},duration:350,unit:"px",delay:50,easing:m.linear});c.push(q.combine([e,d]));c.push(n.removeClass(a,"hidden",{duration:1}));c.push(n.addClass(b,"hide",{duration:1}));q.chain(c).play()}return s(v,{name:"SlideDeckEditable",baseClass:"SlideDeckEditable",editor:void 0,editedSlideIndex:-1,slideEdited:!1,constructor:function(a,b){this.editor=
a.editor;this._createSlideEditables();this._createAddSlide(b);p.add(b,"slideDeckEditable")},_init:function(){this._initDragAndDrop();this.inherited(arguments)},_initDragAndDrop:function(){this._dragManager=new z;this._dragManager._dropIndicator=new A;this._dragManager._dropMode=new B;y.subscribe("/dojox/mdnd/drop",function(a,b,c){b.node===this.innerContainer&&(this.webScene.presentation.moveSlide(a.attributes.bmid.value,c),a.attributes.nr.value!=c&&this.editor.setWebSceneChanged(),setTimeout(function(){this.webScene.presentation=
this.webScene.presentation.toJSON()}.bind(this),0))}.bind(this))},_newSlideFromCamera:function(){for(var a=new t,b=[],c=u.getVisibleLayersList(this.view.map),e=0;e<c.length;e++)b.push({id:c[e].get("id")});var c=this.view.viewpoint,e=this.view.environment,d={thumbnail:{url:void 0},description:{text:""},baseMap:D.toJSON(this.view,this.view.map.basemap),viewpoint:c.toJSON(),visibleLayers:b,environment:E.clone(e)};this.view.takeScreenshot({format:"jpeg",quality:80,width:112,height:61}).then(function(b){d.thumbnail.url=
b.dataURL;a.resolve(d)},a.reject);return a.promise},_createAddSlide:function(a){var b=f.create("div",{"class":"slide addSlide"});f.place(b,a,"last");a=f.create("button",{"class":"slideButton"},b);f.create("p",{"class":"addChar",innerHTML:"+ "+g.slideDeckEditable.addSlide},a);k(a,"click",function(){this._newSlideFromCamera().then(function(a){var b=this.webScene.presentation.getNewSlideId(),d=1;if(this.webScene.presentation)for(var f=this.webScene.presentation.slides,d=f.length+1;f.find(function(a){return a.title.text===
g.slideDeckEditable.slide+" "+d});)d++;a.id=b;a.title={text:g.slideDeckEditable.slide+" "+d};F(a,this.webScene);this.startEditing=a.id;this._slideEdited(f.length-1);this.webScene.presentation=this.webScene.presentation.toJSON();this.editor.setWebSceneChanged()}.bind(this))}.bind(this))},_createSlideEditables:function(){for(var a=0;a<this.slideNodes.length;a++){var b=this.slideNodes[a],c=f.create("div",{"class":"slideDetails"},b),e=this.webScene.presentation.slides.getItemAt(a),d=f.create("div",{"class":"editTitle",
title:e.title.text},c),d=new w({autoSave:!0,value:e.title.text,editor:"dijit/form/ValidationTextBox",editorParams:{regExp:"[^\x3c\x3e]+"}},d);d.editorParams.invalidMessage=g.invalidTitle;this.startEditing===e.id&&(d.edit(),this.startEditing=null);k(d,"change",function(a,b){a.title.text=b;this.webScene.presentation=this.webScene.presentation.toJSON();this.editor.setWebSceneChanged()}.bind(this,e));var h=f.create("div",{"class":"iconButtonContainer2",title:g.slideDeckEditable.updateSlide},c);f.create("div",
{"class":"updateSlide"},h);k(h,"click",function(a,b){b.stopPropagation();this._updateSlide(a)}.bind(this,a));if(!navigator||!navigator.userAgent||!navigator.userAgent.match("((?:E|e)dge)/([0-9]+.?[0-9]*)$"))h=f.create("div",{"class":"iconButtonContainer",title:g.slideDeckEditable.deleteSlide},c),f.create("div",{"class":"deleteSlide"},h),k(h,"click",function(a,b){b.stopPropagation();this._deleteSlide(a)}.bind(this,a));c=f.create("div",{"class":"editSlide"},c);(new C({entries:[{id:"update",title:g.slideDeckEditable.updateSlide,
func:function(a){this._updateSlide(a)}.bind(this,a)},{id:"moveUp",title:g.moveUp,func:function(a,b){0<a&&(this.webScene.presentation.moveSlide(b,a-1),this.webScene.presentation=this.webScene.presentation.toJSON(),this.editor.setWebSceneChanged())}.bind(this,a,e.id),className:0===a?"disabled":""},{id:"moveDown",title:g.moveDown,func:function(a,b){a<this.slideNodes.length-1&&(this.webScene.presentation.moveSlide(b,a+1),this.webScene.presentation=this.webScene.presentation.toJSON(),this.editor.setWebSceneChanged())}.bind(this,
a,e.id),className:a===this.slideNodes.length-1?"disabled":""},{id:"rename",title:g.rename,func:function(a,b){a.edit()}.bind(this,d)},{id:"delete",title:g.layerItemEditable.deleteLayer,func:function(a){this._deleteSlide(a)}.bind(this,a)}]})).placeAt(c);this.slideEdited&&a===this.editedSlideIndex&&G(b)}this.slideEdited=!1},_deleteSlide:function(a){this.webScene.presentation.removeSlide(a);this.webScene.presentation=this.webScene.presentation.toJSON();this.editor.setWebSceneChanged()},_updateSlide:function(a){this._newSlideFromCamera().then(function(a,
c){this._slideEdited(a);this.webScene.presentation.updateSlideDetails(a,c,this.webScene);this.webScene.presentation=this.webScene.presentation.toJSON();this.editor.setWebSceneChanged()}.bind(this,a))},_update:function(){this.inherited(arguments);this._createSlideEditables()},_ui:function(){this.innerContainer&&this._dragManager.unregister(this.innerContainer);this.inherited(arguments);this._dragManager.registerByNode(this.innerContainer)},_slideEdited:function(a){this.editedSlideIndex=a;this.slideEdited=
!0}})});