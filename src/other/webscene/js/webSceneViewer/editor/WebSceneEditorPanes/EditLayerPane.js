// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("esri/core/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/keys dojo/touch dijit/form/Select dijit/form/HorizontalSlider dijit/form/NumberTextBox esri/layers/SceneLayer esri/layers/FeatureLayer esri/widgets/PopupLegacy/PopupTemplate ./WebSceneEditorPaneBase ../../widgets/SymbologyEditor/SymbologyEditor ../../widgets/Switch/Switch ../../webScene/LayerTemplates ../../webScene/WebSceneLayers dojo/i18n!../nls/editor".split(" "),function(r,w,b,g,k,z,x,A,B,C,n,p,D,s,E,t,F,
G,e){function H(a){return a.isInstanceOf(p)||a.isInstanceOf(n)&&"esriGeometryMesh"!==a.geometryType?(a=a.labelingInfo,Array.isArray(a)&&0<a.length):!1}function q(a){if(a.hasZ)return"absoluteHeight";switch(a.geometryType){case "esriGeometryPoint":return"relativeToGround";case "esriGeometryPolyline":case "esriGeometryPolygon":return"onTheGround";default:return null}}return r(s,{layer:void 0,_layer:void 0,layerTemplates:void 0,_layerSetter:function(a){this.customDestroy();this._layer=a;this._updateContent()},
_layerGetter:function(){return this._layer},parentGroup:void 0,constructor:function(a){w.mixin(this,{id:"editLayer",title:e.panes.configureLayer,actionButton:{title:e.buttons.done,action:"_navBackBtnNodeClickHandler"}});this._onHandles=[];this._updateContent()},customDestroy:function(){this._elevationDropdown&&this._elevationDropdown.destroy();this._elevationOffsetTextBox&&this._elevationOffsetTextBox.destroy();this._symbologyEditorWidget&&this._symbologyEditorWidget.destroy();this._transparencySlider&&
this._transparencySlider.destroy();this._labelsSwitch&&this._labelsSwitch.destroy();this._legendSwitch&&this._legendSwitch.destroy();this._popupSwitch&&this._popupSwitch.destroy();this._onHandles.forEach(function(a){a.remove()});this._onHandles.length=0},destroy:function(){this.customDestroy()},_updateContent:function(){var a=this,c=b.create("div",{className:"editLayerPane"});if(null==this._layer)b.place("\x3cp\x3eno layer\x3c/p\x3e",c);else{var h=b.create("div",{className:"layerTitle"},c),f=b.create("div",
{className:"paneLayerTitle"},h);b.create("div",{className:"paneLayerName"},f).textContent=this._layer.title;if(this._layer._websceneEditorProperties.portalLayerItem){f=b.create("div",{},f);b.create("div",{className:"layerTypeIcon"},f).style.backgroundImage="url("+this._layer._websceneEditorProperties.portalLayerItem.item.iconUrl+")";var f=b.create("div",{className:"layerTypeTitle"},f),u=b.create("div",{innerHTML:this._layer._websceneEditorProperties.portalLayerItem.item.displayName,"class":"layerLink"},
f);this._onHandles.push(k(u,"click",function(a){window.open(this._layer._websceneEditorProperties.portalLayerItem.item.portal.getBaseUrl()+"item.html?id\x3d"+this._layer._websceneEditorProperties.portalLayerItem.item.id,"_blank")}.bind(this)));b.create("div",{innerHTML:"\x26nbsp;"+e.addLayerPane.by+"\x26nbsp;","class":"inlineContainer"},f);b.create("div",{innerHTML:this._layer._websceneEditorProperties.portalLayerItem.item.owner,"class":"inlineContainer"},f)}h=b.create("div",{className:"icon_frame",
title:e.editLayerPane.zoomTo},h);this._onHandles.push(k(h,"click",function(){this.editor.view.animateTo(this._layer.fullExtent)}.bind(this)));b.create("div",{className:"lineBreak"},c);if(this._layer.isInstanceOf(p)||this._layer.isInstanceOf(n)&&"esriGeometryMesh"!==this._layer.geometryType){var d=a._layer.elevationInfo||{};b.create("div",{className:"paneSectionTitle"},c).textContent=e.editLayerPane.elevationMode;this._elevationDropdown=new A({className:"elevationDropDown",options:[{label:e.editLayerPane.onTheGround,
value:"onTheGround",selected:"onTheGround"===d.mode||null==d.mode&&"onTheGround"===q(a._layer)},{label:e.editLayerPane.relativeToGround,value:"relativeToGround",selected:"relativeToGround"===d.mode||null==d.mode&&"relativeToGround"===q(a._layer)},{label:e.editLayerPane.absoluteHeight,value:"absoluteHeight",selected:"absoluteHeight"===d.mode||null==d.mode&&"absoluteHeight"===q(a._layer)}]});this._onHandles.push(k(this._elevationDropdown,"change",function(b){"onTheGround"===b?g.add(l,"disable"):g.remove(l,
"disable");var c="onTheGround"===b?void 0:a._elevationOffsetTextBox.get("value");a._layer.set("elevationInfo",{offset:c,mode:b,featureExpression:d.featureExpression});a._layer._websceneEditorProperties.editedFlags.elevationInfo=!0;d=a._layer.elevationInfo;a.editor.setWebSceneChanged()}));this._elevationDropdown.startup();this._elevationDropdown.placeAt(c);var y=function(){d=a._layer.get("elevationInfo")||{};d.offset!==a._elevationOffsetTextBox.get("value")&&(a._layer.set("elevationInfo",{offset:a._elevationOffsetTextBox.get("value"),
mode:d.mode||q(a._layer),featureExpression:d.featureExpression}),a._layer._websceneEditorProperties.editedFlags.elevationInfo=!0,d=a._layer.elevationInfo,a.editor.setWebSceneChanged())};this._elevationOffsetTextBox=new C({className:"elevationTextBox",value:d.offset||0,constraints:{min:-1E7,max:1E7,places:0},required:!0,intermediateChanges:!1,onChange:y});k(this._elevationOffsetTextBox,"keypress",function(a){(a.charOrCode||a.keyCode)==z.ENTER&&y()});b.create("div",{className:"lineBreak"},c);var l=
b.create("div",{},c);b.create("div",{"for":this._elevationOffsetTextBox.domNode.id,className:"subSection paneSectionTitle"},l).textContent=e.editLayerPane.offsetMeters;this._elevationOffsetTextBox.placeAt(l);this._elevationOffsetTextBox.startup();"onTheGround"===this._elevationDropdown.get("value")?g.add(l,"disable"):g.remove(l,"disable");b.create("div",{className:"lineBreak"},c)}b.create("div",{className:"paneSectionTitle"},c).textContent=e.editLayerPane.transparency;h=b.create("div",{className:"slideContainer"},
c);this._transparencySlider=new B({value:1-this._layer.opacity,minimum:0,maximum:1,discreteValues:100,intermediateChanges:!1,showButtons:!0});this._transparencySlider.sliderHandle.title=Math.round(100*this._transparencySlider.value)+"%";var m=b.create("div",{className:"sliderTooltip hide"},this._transparencySlider.sliderHandle.parentNode),v=b.create("div",{className:"sliderTooltipArrow hide"},this._transparencySlider.sliderHandle.parentNode);m.innerHTML=this._transparencySlider.sliderHandle.title;
this._transparencySlider.placeAt(h);this._transparencySlider.startup();var h=this._transparencySlider.on("change",function(a){this._layer.set("opacity",1-a);this._layer._websceneEditorProperties.editedFlags.opacity=!0;this.editor.setWebSceneChanged();this._transparencySlider.sliderHandle.title=Math.round(100*a)+"%";g.add(m,"hide");g.add(v,"hide")}.bind(this)),f=this._transparencySlider.watch("value",function(a,b,c){m.innerHTML=Math.round(100*c)+"%"}),u=k(this._transparencySlider.sliderHandle,x.release,
function(){g.add(m,"hide");g.add(v,"hide")}.bind(this)),r=k(this._transparencySlider.sliderHandle,x.press,function(){g.remove(m,"hide");g.remove(v,"hide")});this._onHandles.push(h);this._onHandles.push(u);this._onHandles.push(r);this._onHandles.push(f);b.create("div",{className:"lineBreak"},c);H(this._layer)&&(h=this._layer.get("showLabels"),b.create("div",{className:"paneSectionTitle"},c).textContent=e.editLayerPane.labels,this._labelsSwitch=new t({switchOn:h}),this._onHandles.push(k(this._labelsSwitch.domNode,
"toggle",function(a){this._layer.set("showLabels",a.on);this._layer._websceneEditorProperties.editedFlags.showLabels=!0;this.editor.setWebSceneChanged()}.bind(this))),this._labelsSwitch.placeAt(c),this._labelsSwitch.startup());if(this._layer.isInstanceOf(p)||this._layer.isInstanceOf(n)&&(null!=this._layer.popupTemplate||null!=this._layer._companionFeatureLayer&&this._layer._companionFeatureLayer.isResolved())){var s=!this._layer.popupTemplate,I=this._layer.popupTemplate||new D({title:this._layer.title,
fieldInfos:this._layer.fields&&this._layer.fields.map(function(a){return{fieldName:a.name,label:a.alias,visible:!0}})});b.create("div",{className:"paneSectionTitle"},c).textContent=e.editLayerPane.popups;this._popupSwitch=new t({switchOn:(!1===this._layer.disablePopup||void 0===this._layer.disablePopup)&&!!this._layer.popupTemplate});this._onHandles.push(k(this._popupSwitch,"toggle",function(a){a.on?(this._layer.set("popupTemplate",I),this._layer.set("disablePopup",!1)):(this._layer.set("popupTemplate",
null),this._layer.set("disablePopup",!0));this._layer._websceneEditorProperties.editedFlags.popupInfo=s;this._layer._websceneEditorProperties.editedFlags.popupDisable=!0;this.editor.setWebSceneChanged()}.bind(this)));this._popupSwitch.placeAt(c);this._popupSwitch.startup()}if(w.exists("_websceneEditorProperties.originalOperationalLayer.layerDefinition.drawingInfo.renderer",this._layer)?!F.hasContentByReference(this._layer._websceneEditorProperties.originalOperationalLayer.layerDefinition.drawingInfo.renderer):
"ArcGISTiledImageServiceLayer"!==G.extrapolateTypeFromLayerInstance(this._layer))b.create("div",{className:"paneSectionTitle"},c).textContent=e.editLayerPane.legend,this._legendSwitch=new t({switchOn:this._layer.showLegend&&void 0!==this._layer.showLegend}),this._onHandles.push(k(this._legendSwitch.domNode,"toggle",function(b){a._layer.set("showLegend",b.on);a._layer._websceneEditorProperties.editedFlags.showLegend=!0;a.editor.setWebSceneChanged()}.bind(this))),this._legendSwitch.placeAt(c),this._legendSwitch.startup();
if(this._layer.isInstanceOf(p)||this._layer.isInstanceOf(n))this._symbologyEditorWidget=new E({layer:this._layer,view:a.editor.view,editor:a.editor}),this._symbologyEditorWidget.placeAt(c),this._symbologyEditorWidget.startup(),b.create("div",{className:"lineBreak"},c)}this._addToContentNode(c)}})});