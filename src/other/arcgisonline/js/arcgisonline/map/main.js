// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/map/main",["dijit","dojo","dojox","dojo/i18n!arcgisonline/nls/arcgisonline","dojo/require!esri/utils,esri/dijit/AttributeInspector,esri/dijit/Measurement,esri/dijit/Bookmarks,esri/dijit/Legend,esri/tasks/PrintTask,esri/arcgis/utils,arcgisonline/map/geocode,arcgisonline/map/save_open,arcgisonline/map/storage,arcgisonline/map/embedded,arcgisonline/map/copy,arcgisonline/map/dynLayer,arcgisonline/map/edit,arcgisonline/map/editTracking,arcgisonline/map/featColl,arcgisonline/map/fileImport,arcgisonline/map/geoRSS,arcgisonline/map/geocodeReview,arcgisonline/map/itemData,arcgisonline/map/labels,arcgisonline/map/stream,arcgisonline/map/thumbnail,arcgisonline/map/table,arcgisonline/map/time,arcgisonline/map/multiDimensions,arcgisonline/map/kml,arcgisonline/map/layer,arcgisonline/map/leftPanel,arcgisonline/map/print,arcgisonline/map/mapNotes,arcgisonline/map/classBreaks,arcgisonline/map/popup,arcgisonline/map/role,arcgisonline/map/symbol,arcgisonline/map/vectorTile,arcgisonline/map/webTile,arcgisonline/map/wms,arcgisonline/map/dijit/LeftPanel,arcgisonline/sharing/util,arcgisonline/sharing/utilShare,arcgisonline/sharing/geow/Account,arcgisonline/sharing/geow/Geow,arcgisonline/sharing/geow/Folder,arcgisonline/sharing/geow/Search,arcgisonline/sharing/dijit/Error,arcgisonline/sharing/dijit/DropDownButton,arcgisonline/sharing/dijit/BasemapGalleryGrid,arcgisonline/sharing/dijit/ClassificationBanner,arcgisonline/sharing/dijit/HelpManager,arcgisonline/sharing/dijit/ProfilePopup,arcgisonline/sharing/dijit/SiteHeader,arcgisonline/sharing/dijit/SiteFooterMap,arcgisonline/sharing/dijit/dialog/AddLayerFromFileDlg,arcgisonline/sharing/dijit/dialog/AddLayerFromUrlDlg,arcgisonline/sharing/dijit/dialog/BrowseLayersDlg,arcgisonline/sharing/dijit/dialog/ChoiceDlg,arcgisonline/sharing/dijit/dialog/FeatureLimitReachedDlg,arcgisonline/sharing/dijit/dialog/FilterDlg,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/dialog/MapNotesDlg,arcgisonline/sharing/dijit/dialog/OpenMapDlg,arcgisonline/sharing/dijit/dialog/OpenPresentationDlg,arcgisonline/sharing/dijit/dialog/QueryLayerDlg,arcgisonline/sharing/dijit/dialog/ShareMapDlg,arcgisonline/sharing/dijit/dialog/TimeSettingsDlg,arcgisonline/sharing/dijit/dialog/MdSliderSettingsDlg,arcgisonline/sharing/dijit/dialog/CsvLocationDlg,arcgisonline/sharing/dijit/dialog/WaitingDlg,arcgisonline/sharing/dijit/views,dojo/cookie,dgrid/OnDemandGrid,dgrid/Selection,dojox/html/entities,arcgisonline/map/dijit/toc/analysis"],
function(n,b,x){function t(a,b,c){if(a.addEventListener)return a.addEventListener(b,c,!1);if(a.attachEvent)return a.attachEvent("on"+b,c)}function u(a,b,c){if(a.removeEventListener)return a.removeEventListener(b,c,!1);if(a.detachEvent)return a.detachEvent("on"+b,c)}b.provide("arcgisonline.map.main");b.require("esri.utils");b.require("esri.dijit.AttributeInspector");b.require("esri.dijit.Measurement");b.require("esri.dijit.Bookmarks");b.require("esri.dijit.Legend");b.require("esri.tasks.PrintTask");
b.require("esri.arcgis.utils");b.require("arcgisonline.map.geocode");b.require("arcgisonline.map.save_open");b.require("arcgisonline.map.storage");b.require("arcgisonline.map.embedded");b.require("arcgisonline.map.copy");b.require("arcgisonline.map.dynLayer");b.require("arcgisonline.map.edit");b.require("arcgisonline.map.editTracking");b.require("arcgisonline.map.featColl");b.require("arcgisonline.map.fileImport");b.require("arcgisonline.map.geoRSS");b.require("arcgisonline.map.geocodeReview");b.require("arcgisonline.map.itemData");
b.require("arcgisonline.map.labels");b.require("arcgisonline.map.stream");b.require("arcgisonline.map.thumbnail");b.require("arcgisonline.map.table");b.require("arcgisonline.map.time");b.require("arcgisonline.map.multiDimensions");b.require("arcgisonline.map.kml");b.require("arcgisonline.map.layer");b.require("arcgisonline.map.leftPanel");b.require("arcgisonline.map.print");b.require("arcgisonline.map.mapNotes");b.require("arcgisonline.map.classBreaks");b.require("arcgisonline.map.popup");b.require("arcgisonline.map.role");
b.require("arcgisonline.map.symbol");b.require("arcgisonline.map.vectorTile");b.require("arcgisonline.map.webTile");b.require("arcgisonline.map.wms");b.require("arcgisonline.map.dijit.LeftPanel");b.require("arcgisonline.sharing.util");b.require("arcgisonline.sharing.utilShare");b.require("arcgisonline.sharing.geow.Account");b.require("arcgisonline.sharing.geow.Geow");b.require("arcgisonline.sharing.geow.Folder");b.require("arcgisonline.sharing.geow.Search");b.require("arcgisonline.sharing.dijit.Error");
b.require("arcgisonline.sharing.dijit.DropDownButton");b.require("arcgisonline.sharing.dijit.BasemapGalleryGrid");b.require("arcgisonline.sharing.dijit.ClassificationBanner");b.require("arcgisonline.sharing.dijit.HelpManager");b.require("arcgisonline.sharing.dijit.ProfilePopup");b.require("arcgisonline.sharing.dijit.SiteHeader");b.require("arcgisonline.sharing.dijit.SiteFooterMap");b.require("arcgisonline.sharing.dijit.dialog.AddLayerFromFileDlg");b.require("arcgisonline.sharing.dijit.dialog.AddLayerFromUrlDlg");
b.require("arcgisonline.sharing.dijit.dialog.BrowseLayersDlg");b.require("arcgisonline.sharing.dijit.dialog.ChoiceDlg");b.require("arcgisonline.sharing.dijit.dialog.FeatureLimitReachedDlg");b.require("arcgisonline.sharing.dijit.dialog.FilterDlg");b.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");b.require("arcgisonline.sharing.dijit.dialog.MapNotesDlg");b.require("arcgisonline.sharing.dijit.dialog.OpenMapDlg");b.require("arcgisonline.sharing.dijit.dialog.OpenPresentationDlg");b.require("arcgisonline.sharing.dijit.dialog.QueryLayerDlg");
b.require("arcgisonline.sharing.dijit.dialog.ShareMapDlg");b.require("arcgisonline.sharing.dijit.dialog.TimeSettingsDlg");b.require("arcgisonline.sharing.dijit.dialog.MdSliderSettingsDlg");b.require("arcgisonline.sharing.dijit.dialog.CsvLocationDlg");b.require("arcgisonline.sharing.dijit.dialog.WaitingDlg");b.require("arcgisonline.sharing.dijit.views");b.require("dojo.cookie");b.require("dgrid.OnDemandGrid");b.require("dgrid.Selection");b.require("dojox.html.entities");b.require("arcgisonline.map.dijit.toc.analysis");
b.requireLocalization("arcgisonline","arcgisonline");String.prototype.startsWith=function(a){return 0==this.indexOf(a)};String.prototype.endsWith=function(a){return this.substring(this.length-a.length)===a};String.prototype.count=function(a){return this.split(a).length-1};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")});esri.isEmpty=function(a){return!a?!1:b.json.stringify(a)===b.json.stringify({})};var v=function(a){a.preventDefault();
var e=b.hasClass(this,"is-active");b.query(".dropdown").removeClass("is-active");e||(b.addClass(this,"is-active"),b.stopEvent(a),a={btn:a.target||a.srcElement,dropdown:this},t(document.body,"click",b.hitch(a,q)),(e=b.query(".esriSimpleSliderIncrementButton"))&&e.length&&t(e[0],"click",b.hitch(a,q)),(e=b.query(".esriSimpleSliderDecrementButton"))&&e.length&&t(e[0],"click",b.hitch(a,q)))},q=function(a){var e=b.query(".dropdown-menu",this.dropdown)[0];a:{for(a=(a.target||a.srcElement).parentNode;null!=
a;){if(a==e){e=!0;break a}a=a.parentNode}e=!1}e||(b.removeClass(this.dropdown,"is-active"),u(document.body,"click",q),(e=b.query(".esriSimpleSliderIncrementButton"))&&e.length&&u(e[0],"click",q),(e=b.query(".esriSimpleSliderDecrementButton"))&&e.length&&u(e[0],"click",q))};arcgisonline.map.main={defaultBaseLayer:null,defaultBaseLayerMapLods:null,scaleBarUnits:"metric",mapLods:null,baseTilingSchemeScales:"",selfCallResult:null,map:null,overviewMap:null,scalebar:null,measureTool:null,measureActivated:!1,
bookmarksTool:null,homeButton:null,locateButton:null,defaultExtent:null,initialExtent:null,lastExtent:null,defaultService:null,currentBaseService:"",isUserBaseService:!1,allLegendInfos:[],mapLayers:[],mapTables:[],geometryService:null,mapInitialized:!1,startup:!0,isMapFullyLoaded:!1,mapHasChanged:!1,mapFullyLoadedTimer:null,noDataDisplayTimer:null,analysisProps:{},init:function(a){arcgisonline.map.embedded.doEmbeddedCheck(a).then(function(a){if(a){arcgisonline.sharing.geow.Geow.checkSharedCookie();
if((a=arcgisonline.sharing.util.getUser())&&a.accountId&&(void 0===esriGeowConfig.isMultiTenant||!0===esriGeowConfig.isMultiTenant)&&!esriGeowConfig.portalName){a=b.query(".esriLogoIcon");for(var c=0;c<a.length;c++)b.replaceClass(a[c],"esriLogoIcon esriOrgIcon")}esri.arcgis.utils.arcgisUrl=esriGeowConfig.restBaseUrl+"content/items";arcgisonline.sharing.geow.Account.loadMapSettings(b.hitch(this,arcgisonline.map.main.initMapProperties));b.query("#home-navigation-dropdown-link").onclick(b.hitch(b.byId("home-navigation-dropdown"),
v));b.query("#webmap-recentMaps").onclick(b.hitch(b.byId("recentMaps-navigation"),v));b.query("#logged-in-navigation-link").onclick(b.hitch(b.byId("logged-in-navigation"),v));9>b.isIE&&b.style(b.byId("locationDiv"),"right","8px");a=b.coords(b.byId("headerBanner"));0<a.h&&b.style(b.query(".header-map-home")[0],"marginTop",a.h+"px");arcgisonline.map.table.hideAttributeTable();b.connect(n.byId("leftContentPanel"),"resize",arcgisonline.map.leftPanel,"checkLeftPanelButtonLabels");arcgisonline.map.main.dojoPatch();
9>b.isIE&&b.style(b.byId("locationDiv"),"right","8px");if(navigator.userAgent.match(/iPad;.*CPU.*OS 7_\d/i)&&window.innerHeight!=document.documentElement.clientHeight){var d=function(){b.style(document.getElementById("page-border"),"height",window.innerHeight+"px");n.byId("page-border").resize();(0!==document.body.scrollTop||0!==document.body.scrollLeft)&&window.scrollTo(0,0)};setTimeout(function(){d()},1);window.addEventListener("orientationchange",d,!1)}}})},initMapProperties:function(a){arcgisonline.map.main.selfCallResult=
a;arcgisonline.map.vectorTile.checkFallBackVectorTileLayers({baseMap:esriGeowConfig.defaultBasemap}).then(function(a){a=a.baseMap;var c=a.baseMapLayers[0];if((esriGeowConfig.allSSL||"https:"==location.protocol)&&c.url&&(arcgisonline.sharing.util.isHostedService(c.url)||arcgisonline.sharing.util.supportsHttps(c.url)))c.url=c.url.replace("http:","https:"),c.resourceInfo&&(c.resourceInfo.tileServers&&c.resourceInfo.tileServers.length)&&b.forEach(c.resourceInfo.tileServers,function(a,b){if(arcgisonline.sharing.util.isHostedService(a)||
arcgisonline.sharing.util.supportsHttps(a))c.resourceInfo.tileServers[b]=a.replace("http:","https:")});arcgisonline.map.main.defaultBaseLayer={layer:null,id:"defaultBasemap",type:"base",title:a.title,itemId:c.itemId,url:c.url?c.url:null,templateUrl:c.templateUrl?c.templateUrl:null,identify:!1,serviceInfo:c.resourceInfo,copyright:c.copyright,fullExtent:c.fullExtent instanceof esri.geometry.Extent?c.fullExtent:c.fullExtent?esri.geometry.Extent(c.fullExtent):null,subDomains:c.subDomains,tileInfo:c.tileInfo?
esri.layers.TileInfo(c.tileInfo):null,tileServers:c.tileServers,refreshInterval:c.refreshInterval};arcgisonline.map.main.defaultBaseLayer.url||(arcgisonline.map.main.defaultBaseLayer._layerType=a.baseMapLayers[0].type);if(c.resourceInfo&&c.resourceInfo.tileInfo)arcgisonline.map.main.defaultBaseLayerMapLods=c.resourceInfo.tileInfo.lods;else if("WMS"==c.type)arcgisonline.map.main.defaultBaseLayer=b.mixin(arcgisonline.map.main.defaultBaseLayer,{_layerType:"WMS",extent:esri.geometry.Extent(c.extent),
layers:c.layers,mapUrl:c.mapUrl,maxHeight:c.maxHeight,maxWidth:c.maxWidth,opacity:c.opacity,spatialReferences:c.spatialReferences,version:c.version,visibility:c.visibility,visibleLayers:c.visibleLayers.toString()});else if("OpenStreetMap"==c.type)a=new esri.layers.OpenStreetMapLayer,arcgisonline.map.main.defaultBaseLayerMapLods=a.tileInfo.lods;else if(c.type&&-1<c.type.indexOf("BingMaps")){if(!esriGeowConfig.self.bingKey){arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.generalDlg.errorDlgTitle,
message:b.string.substitute(esri.i18nBundle.viewer.error.basemapTitleNotAvailable2,{title:a.title})});return}arcgisonline.map.main.defaultBaseLayer.bingKey=esriGeowConfig.self.bingKey;a=new esri.virtualearth.VETiledLayer({bingMapsKey:esriGeowConfig.self.bingKey,mapStyle:esri.virtualearth.VETiledLayer.MAP_STYLE_AERIAL});arcgisonline.map.main.defaultBaseLayerMapLods=a.tileInfo.lods}b.connect(document,"onkeypress",b.hitch(arcgisonline.map.main,"onKeyPress"));b.connect(b.byId("webmap-newMap"),"onclick",
b.hitch(arcgisonline.map.main,"openNewMap"));b.connect(b.byId("webmap-modifyMap"),"onclick",b.hitch(arcgisonline.map.role,"updateUserActionAfterModify"));b.connect(b.byId("tableCloseButton"),"onclick",b.hitch(arcgisonline.map.table,"hideAttributeTable",null,null));b.connect(b.byId("webmap-details"),"onclick",b.hitch(arcgisonline.map.leftPanel,"openLeftDetailsPanel"));b.connect(b.byId("webmap-basemap"),"onclick",b.hitch(arcgisonline.map.main,"showBasemapGallery"));b.connect(b.byId("webmap-edit"),"onclick",
b.hitch(arcgisonline.map.leftPanel,"openLeftEditPanel"));b.connect(b.byId("webmap-analysis"),"onclick",b.hitch(this,function(a){"analysisStack"==arcgisonline.map.leftPanel.getLeftContentPanelStack()||"toolStack"==arcgisonline.map.leftPanel.getLeftContentPanelStack()?arcgisonline.map.leftPanel.openLeftTOCPanel():arcgisonline.map.dijit.toc.analysis.configureAnalysis(a,{isMenu:!0})}));b.connect(b.byId("webmap-share"),"onclick",b.hitch(arcgisonline.map.main,"linkToMap",!1));b.connect(b.byId("webmap-directions"),
"onclick",b.hitch(arcgisonline.map.leftPanel,"openLeftDirectionsPanel"));b.connect(b.byId("webmap-measure"),"onclick",b.hitch(arcgisonline.map.main,"showMeasureTool"));b.connect(b.byId("webmap-bookmarks"),"onclick",b.hitch(arcgisonline.map.main,"showBookmarksTool"));if(esriGeowConfig.self.helperServices.printTask.templates&&1<esriGeowConfig.self.helperServices.printTask.templates.length){var d=n.byId("webmap-print-templates-menu");b.forEach(esriGeowConfig.self.helperServices.printTask.templates,function(a){a=
new n.MenuItem({label:a.label,onClick:b.hitch(arcgisonline.map.print,"printMap",a)});d.addChild(a)});b.style(n.byId("webmap-print-templates").domNode,"display","");b.style(n.byId("webmap-print").domNode,"display","none")}else b.connect(b.byId("webmap-print"),"onclick",b.hitch(arcgisonline.map.print,"printMap",esriGeowConfig.self.helperServices.printTask.templates&&esriGeowConfig.self.helperServices.printTask.templates[0]||null)),b.style(n.byId("webmap-print").domNode,"display",""),b.style(n.byId("webmap-print-templates").domNode,
"display","none");arcgisonline.map.embedded.adjustUIForEmbedded();b.subscribe("onLayerVisibilityChange",b.hitch(arcgisonline.map.main,"onLayerVisibilityChange"));arcgisonline.map.role.setupUserActions();arcgisonline.map.main.updateHeaderLinks();!esriGeowConfig.self.helperServices||!esriGeowConfig.self.helperServices.geometry||!esriGeowConfig.self.helperServices.geometry.url?console.err("No Geometry Service defined.",esriGeowConfig.self):esri.config.defaults.geometryService=new esri.tasks.GeometryService(esriGeowConfig.self.helperServices.geometry.url);
esri.config.defaults.kmlService=esriGeowConfig.kmlService;esri.config.defaults.geoRSSService=esriGeowConfig.geoRSSService;esri.config.defaults.io.proxyUrl=esriGeowConfig.proxyServer;esri.isDefined(esriGeowConfig.isMultiTenant)&&!1===esriGeowConfig.isMultiTenant?(esri.config.defaults.io.corsEnabledServers.push(arcgisonline.sharing.util.getHttpUrl(location.host).replace(/\:80$/,"")),esri.config.defaults.io.corsEnabledServers.push(arcgisonline.sharing.util.getSecureUrl(location.host).replace(/\:443$/,
""))):(esri.config.defaults.io.corsEnabledServers.push(arcgisonline.sharing.util.getHttpUrl(location.host)),esri.config.defaults.io.corsEnabledServers.push(arcgisonline.sharing.util.getSecureUrl(location.host)));esriGeowConfig.self.authorizedCrossOriginDomains&&esriGeowConfig.self.authorizedCrossOriginDomains.length&&b.forEach(esriGeowConfig.self.authorizedCrossOriginDomains,function(a){esri.config.defaults.io.corsEnabledServers.push({host:a,withCredentials:!0})});a=arcgisonline.sharing.util.getUser();
arcgisonline.map.main.scaleBarUnits="metric";if(esriGeowConfig.self.user&&esriGeowConfig.self.user.units)arcgisonline.map.main.scaleBarUnits=esriGeowConfig.self.user.units;else if(esriGeowConfig.self.units)arcgisonline.map.main.scaleBarUnits=esriGeowConfig.self.units;else if(a&&a.region&&"US"===a.region||a&&!a.region&&"US"===esriGeowConfig.self.region||a&&!a.region&&!esriGeowConfig.self.region||!a&&"US"===esriGeowConfig.self.ipCntryCode||!a&&!esriGeowConfig.self.ipCntryCode&&"en-us"===b.locale)arcgisonline.map.main.scaleBarUnits=
"english";b.config.deferredOnError=function(a,b){console.log("dojo.config.deferredOnError ",a)};b.mixin(esri.symbol.defaultSimpleMarkerSymbol,{style:"circle",color:[0,0,0,1],outline:null,size:4,angle:0,xoffset:0,yoffset:0});var f=esri.dijit.Popup.prototype._zoomToFeature;esri.dijit.Popup.prototype._zoomToFeature=function(){var a=this.getSelectedFeature(),b=a.getLayer();if(b&&b.__isFootprintLayer&&a.attributes.xmin&&a.attributes.ymin&&a.attributes.xmax&&a.attributes.ymax)a=new esri.geometry.Extent(a.attributes.xmin,
a.attributes.ymin,a.attributes.xmax,a.attributes.ymax,b.fullExtent.spatialReference),arcgisonline.map.main.map.setExtent(a,!0);else return f.apply(this,arguments)};a=arcgisonline.map.main.goToPage;b.partial(a,esriGeowConfig.baseUrl+"content.html");b.partial(a,esriGeowConfig.baseUrl+"groups.html");b.partial(a,esriGeowConfig.baseUrl+"gallery.html");esri.substitute({appTitle:esriGeowConfig.portalName||esri.i18nBundle.common.arcgisCom},esri.i18nBundle.siteHeader.home);b.partial(a,esriGeowConfig.baseUrl);
(a=arcgisonline.sharing.util.getUser())&&a.accountId&&(esriGeowConfig.self.isPortal||b.style(b.byId("webmap-add-esri-maplayers"),"display","block"));arcgisonline.map.main.loggedIn();arcgisonline.map.leftPanel.initSettings();a=arcgisonline.sharing.util.urlToObject(document.URL);a.query=a.query||{};a.query.folder&&(arcgisonline.map.save_open.folderId=a.query.folder,arcgisonline.map.save_open.folderTitle="dummy");a.query.useExisting||arcgisonline.map.storage.deleteMapCookie();a.query.useExisting?arcgisonline.map.storage.openWebMapFromCookie():
a.query.webmap?arcgisonline.map.save_open.openWebMapItemCard(a.query.webmap):a.query.basemapUrl?arcgisonline.map.layer.addUserBaseLayer({url:arcgisonline.map.main.decodeUrl(a.query.basemapUrl)}):arcgisonline.map.layer.addDefaultBaseLayers();window.onresize=9>b.isIE?function(){n.byId("page-border").resize();arcgisonline.map.main.checkTitleDiv();arcgisonline.map.main.checkMinWidthOfPage()}:function(){arcgisonline.map.main.checkTitleDiv();arcgisonline.map.main.checkMinWidthOfPage()}})},updateHeaderLinks:function(){var a=
esriGeowConfig.baseUrl,e=esriGeowConfig.self;arcgisonline.sharing.util.isPortal()&&"7443"===location.port&&(a=arcgisonline.sharing.util.getSecureUrl(a));if(!arcgisonline.sharing.util.isPortal()&&(b.attr(b.byId("training-link"),"innerHTML",'\x3cspan class\x3d"icon-ui-link-external dropdown-link-external-icon"\x3e\x3c/span\x3e'+esri.i18nBundle.siteHeader.training),b.query("#training-link").removeClass("hide"),b.connect(b.byId("training-link"),"onclick",b.hitch(this,function(a){a.preventDefault();a=
{administrator:"//www.esri.com/training/main/arcgis-online-administrators",publisher:"//www.esri.com/training/main/arcgis-online-publishers",user:"//www.esri.com/training/main/arcgis-online-users","public":"//www.esri.com/training/main/arcgis-online-training",custom:"//www.esri.com/training/main/arcgis-online-training"};var b=esriGeowConfig.userRole,e;b?b.isAdmin()||b.isBasedOnAdmin()?e=a.administrator:b.isPublisher()||b.isBasedOnPublisher()?e=a.publisher:b.isUser()||b.isBasedOnUser()?e=a.user:b.isCustom()&&
(e=a.custom):e=a["public"];window.open(e)})),esriGeowConfig.self&&esriGeowConfig.self.subscriptionInfo&&("Trial"===esriGeowConfig.self.subscriptionInfo.type||"Trial Press"===esriGeowConfig.self.subscriptionInfo.type)))b.attr(b.byId("trial-download-link"),"innerHTML",esri.i18nBundle.siteHeader.trialDownload+"\x26nbsp;\x26nbsp;"),b.query("#trial-download-link").removeClass("hide"),b.connect(b.byId("trial-download-link"),"onclick",b.hitch(this,function(a){a.preventDefault();a=(esriGeowConfig.self&&esriGeowConfig.self.user&&
esriGeowConfig.self.user.culture||esriGeowConfig.self&&esriGeowConfig.self.culture||dojoConfig.locale||"en").toLowerCase();a=esriGeowConfig.learnArcGIS+"/"+(a in{"pt-br":1,"pt-pt":1,"zh-cn":1}?a:a.split("-")[0].toLowerCase())+"/trial";window.open(a)}));b.attr(b.byId("home-navigation-dropdown-link"),"innerHTML",'\x3cdiv id\x3d"site_logo"\x3eArc\x3cspan\x3eGIS\x3c/span\x3e\x3c/div\x3e');b.addClass(b.byId("home-navigation-dropdown-link"),"site_logo");b.query(".homeGallery",this.domNode).connect("onclick",
b.hitch(this,function(b){b.preventDefault();arcgisonline.map.main.goToPage(a+"gallery.html")}));b.query(".homeHelp").attr("href",e.helpBase);b.query(".homeHelp",this.domNode).connect("onclick",b.hitch(this,function(a){a.preventDefault();window.open(e.helpBase,"_blank")}));b.query(".homeScene",this.domNode).connect("onclick",b.hitch(this,function(a){a.preventDefault();window.location="../webscene/viewer.html"}));var c=arcgisonline.sharing.util.getUser();c?(b.query("#profileLink",this.domNode).connect("onclick",
b.hitch(this,function(b){b.preventDefault();arcgisonline.map.main.goToPage(a+"user.html")})),b.query(".loggedInSignout",this.domNode).connect("onclick",b.hitch(this,function(a){a.preventDefault();arcgisonline.map.main.logOut()})),b.query(".homeHome",this.domNode).connect("onclick",b.hitch(this,function(b){b.preventDefault();arcgisonline.map.main.goToPage(a+"index.html")})),arcgisonline.map.role.isAllowed("header_myContent")&&(b.query(".homeMyContent",this.domNode).connect("onclick",b.hitch(this,function(b){b.preventDefault();
arcgisonline.map.main.goToPage(a+"content.html")})),b.query(".homeMyContent",this.domNode).removeClass("hide")),b.query(".homeGroups",this.domNode).connect("onclick",b.hitch(this,function(b){b.preventDefault();arcgisonline.map.main.goToPage(a+"groups.html")})),b.query(".homeGroups",this.domNode).removeClass("hide"),arcgisonline.sharing.util.isPortal()?(b.query(".loggedInHelp",this.domNode).connect("onclick",b.hitch(this,function(a){a.preventDefault();arcgisonline.map.main.openHelp()})),b.query(".loggedInAdminHelp",
this.domNode).connect("onclick",b.hitch(this,function(a){a.preventDefault();arcgisonline.map.main.openAdminHelp()})),esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin()?b.query(".loggedInAdminHelp").removeClass("hide"):b.query(".loggedInAdminHelp").addClass("hide")):b.query(".loggedInHelp",this.domNode).connect("onclick",b.hitch(this,function(a){a.preventDefault();window.open(e.helpBase,"_blank")})),b.style(b.query(".homeHelp",this.domNode)[0],"display","none"),c.accountId?(b.attr(b.byId("home-navigation-dropdown-link"),
"innerHTML",esri.i18nBundle.siteHeader.simpleHome),b.query("#home-navigation-dropdown-link").removeClass("site_logo top-nav-title").addClass("top-nav-link"),b.query(".homeMyOrg",this.domNode).connect("onclick",b.hitch(this,function(b){b.preventDefault();arcgisonline.map.main.goToPage(a+"organization.html")})),arcgisonline.sharing.util.isPortal()&&esriGeowConfig.restrictOrganizationPageToAdmin&&(!esriGeowConfig.userRole||esriGeowConfig.userRole&&!esriGeowConfig.userRole.isAdmin())?b.query(".homeMyOrg",
this.domNode).addClass("hide"):b.query(".homeMyOrg",this.domNode).removeClass("hide")):(b.query("#home-navigation-dropdown-link").removeClass("top-nav-link").addClass("top-nav-title site_logo"),b.query(".homeFeatures",this.domNode).connect("onclick",b.hitch(this,function(b){b.preventDefault();arcgisonline.map.main.goToPage(a+"../features/features.html")})),b.query(".homePlans",this.domNode).connect("onclick",b.hitch(this,function(b){b.preventDefault();arcgisonline.map.main.goToPage(a+"../features/plans/pricing.html")})),
b.query(".homeFeatures").removeClass("hide"),b.query(".homePlans").removeClass("hide")),!arcgisonline.sharing.util.isPortal()&&(c&&"both"===c.userType)&&(b.query("#esri-community-link").removeClass("hide"),b.query("#my-esri-link").removeClass("hide"),b.attr(b.byId("esri-community-link"),"innerHTML",'\x3cspan class\x3d"icon-ui-link-external dropdown-link-external-icon"\x3e\x3c/span\x3e'+esri.i18nBundle.siteHeader.esriCommunity),b.connect(b.byId("esri-community-link"),"onclick",b.hitch(this,function(a){a.preventDefault();
window.open(esriGeowConfig.esriCommunityLink,"_blank")})),b.attr(b.byId("my-esri-link"),"innerHTML",'\x3cspan class\x3d"icon-ui-link-external dropdown-link-external-icon"\x3e\x3c/span\x3e'+esri.i18nBundle.siteHeader.myEsri),b.connect(b.byId("my-esri-link"),"onclick",b.hitch(this,function(a){a.preventDefault();window.open(esriGeowConfig.myEsriLink,"_blank")})))):(b.query(".signin",this.domNode).connect("onclick",b.hitch(this,function(a){a.preventDefault();arcgisonline.map.main.signIn()})),esriGeowConfig.self.urlKey||
arcgisonline.sharing.util.isPortal()?(b.attr(b.byId("home-navigation-dropdown-link"),"innerHTML",esri.i18nBundle.siteHeader.simpleHome),b.query(".homeHome",this.domNode).connect("onclick",b.hitch(this,function(b){b.preventDefault();arcgisonline.map.main.goToPage(a+"index.html")})),arcgisonline.sharing.util.isPortal()&&(b.query(".homeFeatures",this.domNode).addClass("hide"),b.query(".homePlans",this.domNode).addClass("hide"))):(b.query(".homeHome",this.domNode).connect("onclick",b.hitch(this,function(b){b.preventDefault();
arcgisonline.map.main.goToPage(a+"../features")})),b.query(".homeFeatures",this.domNode).connect("onclick",b.hitch(this,function(b){b.preventDefault();arcgisonline.map.main.goToPage(a+"../features/features.html")})),b.query(".homeFeatures",this.domNode).removeClass("hide"),b.query(".homePlans",this.domNode).connect("onclick",b.hitch(this,function(b){b.preventDefault();arcgisonline.map.main.goToPage(a+"../features/plans/pricing.html")})),b.query(".homePlans",this.domNode).removeClass("hide")));arcgisonline.map.main.updateRecentWebMaps()},
initMap:function(a){arcgisonline.map.main.mapInitialized=!0;b.connect(arcgisonline.map.main.map,"onDblClick",b.hitch(arcgisonline.map.main,"onDblClick"));b.connect(arcgisonline.map.main.map,"onExtentChange",b.hitch(arcgisonline.map.main,"onExtentChange"));b.connect(arcgisonline.map.main.map,"onPanStart",b.hitch(arcgisonline.map.main,"onPanStart"));b.connect(arcgisonline.map.main.map,"onPanEnd",b.hitch(arcgisonline.map.main,"onPanEnd"));b.connect(arcgisonline.map.main.map,"onZoomEnd",b.hitch(arcgisonline.map.main,
"onZoomEnd"));b.subscribe("_onRendererUpdate",b.hitch(arcgisonline.map.main,"onRendererUpdate"));arcgisonline.map.main.setHandCursor();arcgisonline.map.main.initialExtent=a;arcgisonline.map.main.setMapExtent(a);if(arcgisonline.map.main.defaultService.layer.loaded)arcgisonline.map.main.onDefaultServiceLoad(arcgisonline.map.main.defaultService.layer);else b.connect(arcgisonline.map.main.defaultService.layer,"onLoad",b.hitch(arcgisonline.map.main,"onDefaultServiceLoad"));arcgisonline.map.main.map.disableClickRecenter()},
createOverviewMap:function(){var a=arcgisonline.map.main.map.getLayer(arcgisonline.map.main.currentBaseService);if(!a||!arcgisonline.map.main.mapInitialized)setTimeout(b.hitch(arcgisonline.map.main,"createOverviewMap"),1E3);else if(!arcgisonline.map.main.overviewMap)if("esri.layers.VectorTileLayer"===a.declaredClass){var e="http://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer";if(esriGeowConfig.allSSL||"https:"==location.protocol)e=e.replace("http:","https:");a=new esri.layers.ArcGISTiledMapServiceLayer(e,
{});b.connect(a,"onLoad",function(){arcgisonline.map.main.overviewMap=new esri.dijit.OverviewMap({id:"overviewMap",baseLayer:a,map:arcgisonline.map.main.map,opacity:0.45,width:200,height:200});arcgisonline.map.main.overviewMap.startup()})}else!arcgisonline.map.main.overviewMap&&"esri.layers.WMSLayer"!==a.declaredClass&&(arcgisonline.map.main.overviewMap=new esri.dijit.OverviewMap({id:"overviewMap",map:arcgisonline.map.main.map,opacity:0.45,width:200,height:200}),arcgisonline.map.main.overviewMap.startup())},
destroyOverviewMap:function(){arcgisonline.map.main.overviewMap&&(arcgisonline.map.main.overviewMap.destroy(),arcgisonline.map.main.overviewMap=null)},recreateOverviewMap:function(){arcgisonline.map.main.destroyOverviewMap();arcgisonline.map.main.createOverviewMap()},createHomeButton:function(){arcgisonline.map.main.destroyHomeButton();var a=b.byId("map_zoom_slider"),e=b.create("div",{id:"homeButtonDiv"});b.place(e,a,1);arcgisonline.map.main.homeButton=new esri.dijit.HomeButton({map:arcgisonline.map.main.map,
theme:"homeButton",extent:arcgisonline.map.main.map.extent},"homeButtonDiv");arcgisonline.map.main.homeButton.startup()},destroyHomeButton:function(){arcgisonline.map.main.homeButton&&(arcgisonline.map.main.homeButton.destroy(),arcgisonline.map.main.homeButton=null,b.byId("homeButtonDiv")&&document.body.removeChild(b.byId("homeButtonDiv")))},recreateHomeButton:function(){arcgisonline.map.main.destroyHomeButton();arcgisonline.map.main.createHomeButton()},createLocateButton:function(){arcgisonline.map.main.destroyLocateButton();
var a=b.byId("map_zoom_slider"),e=b.create("div",{id:"locateButtonDiv"});b.place(e,a,"after");arcgisonline.map.main.locateButton=new esri.dijit.LocateButton({map:arcgisonline.map.main.map,theme:"locateButton"},"locateButtonDiv");arcgisonline.map.main.locateButton.startup();arcgisonline.map.main.locateButton.on("locate",function(a){a.error?arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:esri.i18nBundle.viewer.error.unableToLocate}):
setTimeout(function(){arcgisonline.map.main.locateButton.clear()},5E3)})},destroyLocateButton:function(){arcgisonline.map.main.locateButton&&(arcgisonline.map.main.locateButton.destroy(),arcgisonline.map.main.locateButton=null,b.byId("locateButtonDiv")&&document.body.removeChild(b.byId("locateButtonDiv")))},recreateLocateButton:function(){arcgisonline.map.main.destroyLocateButton();arcgisonline.map.main.createLocateButton()},onMapLoad:function(){arcgisonline.map.main.map&&(b.publish("onMapLoad"),
b.connect(n.byId("map"),"resize",b.hitch(arcgisonline.map.main,"resizeMap")),setTimeout("arcgisonline.map.main.map.reposition()",1E3),arcgisonline.map.main.createOverviewMap(),arcgisonline.map.main.resizeNoDataDiv(),arcgisonline.map.fileImport.setupDragDrop(),esri.id.setProtocolErrorHandler(function(a){arcgisonline.map.main.reloadViewerSecureIdMgr(a);return!1}),arcgisonline.map.geocode.createWidget())},onDefaultServiceLoad:function(a){a=1E3;arcgisonline.map.save_open.openedWebMap&&(a=3E3);arcgisonline.map.main.mapFullyLoadedTimer=
setTimeout("arcgisonline.map.main.mapFullyLoaded()",a)},mapFullyLoaded:function(){for(var a=!0,e=0;e<arcgisonline.map.main.mapLayers.length;e++){var c=arcgisonline.map.main.mapLayers[e];c&&c.layer&&"esri.layers.KMLLayer"==c.layer.declaredClass?c.layer.loaded||(a=!1):c&&!c.layers&&null==arcgisonline.map.main.map.getLayer(c.id)?a=!1:c&&(c.layers&&"mapNotes"==!c.type&&null==arcgisonline.map.main.map.getLayer(c.id+"_0"))&&(a=!1)}if(a){clearTimeout(arcgisonline.map.main.mapFullyLoadedTimer);arcgisonline.map.main.cleanUpFailedServices();
arcgisonline.map.main.onLayerAddHandler=b.connect(arcgisonline.map.main.map,"onLayerAdd",b.hitch(arcgisonline.map.main,"onLayerAddedOrRemoved"));setTimeout(function(){arcgisonline.map.main.onLayerRemoveHandler=b.connect(arcgisonline.map.main.map,"onLayerRemove",b.hitch(arcgisonline.map.main,"onLayerAddedOrRemoved"));arcgisonline.map.main.onLayerReorderHandler=b.connect(arcgisonline.map.main.map,"onLayerReorder",b.hitch(arcgisonline.map.main,"onLayerReordered"))},5E3);b.connect(arcgisonline.map.main.map,
"onBeforeUnload",function(){b.disconnect(arcgisonline.map.main.onLayerAddHandler);b.disconnect(arcgisonline.map.main.onLayerRemoveHandler);b.disconnect(arcgisonline.map.main.onLayerReorderHandler)});b.publish("onLayerUpdate",[""]);arcgisonline.map.main.scalebar||(arcgisonline.map.main.scalebar=new esri.dijit.Scalebar({map:arcgisonline.map.main.map,scalebarUnit:arcgisonline.map.main.scaleBarUnits}));var d=arcgisonline.sharing.util.getUser();d&&arcgisonline.map.save_open.webMapInfo&&arcgisonline.map.save_open.webMapInfo.owner!==
d.email&&"admin"!==arcgisonline.map.save_open.webMapInfo.itemControl&&"update"!==arcgisonline.map.save_open.webMapInfo.itemControl?n.byId("webmap-save-save").set("disabled",!0):n.byId("webmap-save-save").set("disabled",!1);arcgisonline.map.main.createHomeButton();arcgisonline.map.main.createLocateButton();arcgisonline.map.time.checkTimeSliderProperties(!0);arcgisonline.map.main.isMapFullyLoaded=!0;arcgisonline.map.role.updateUserActionWithWebmap();arcgisonline.map.popup.addPopupLayers();a=(a=arcgisonline.sharing.util.urlToObject(document.URL).query)?
a.timeExtent:null;!a&&arcgisonline.map.save_open.openedWebMap&&(a=arcgisonline.map.save_open.openedWebMap.timeExtent);a?(a=a.split(","),2==a.length&&(c=new esri.TimeExtent,c.startTime=new Date(parseInt(a[0])),c.endTime=new Date(parseInt(a[1])),arcgisonline.map.main.map.setTimeExtent(c))):arcgisonline.map.time.checkOnTimeButton();arcgisonline.map.multiDimensions.checkOnMdSliderButton();arcgisonline.map.popup.setupPopupHandler();arcgisonline.map.main.initBookmarks();arcgisonline.map.main.updateHeaderPresentationLink();
for(var e=0;e<arcgisonline.map.main.mapLayers.length;e++)"base"==arcgisonline.map.main.mapLayers[e].type&&(arcgisonline.map.main.mapLayers[e].successfulDraw=!0);arcgisonline.map.leftPanel.mapLoadedSettings();var f=arcgisonline.sharing.util.urlToObject(document.URL);f.query=f.query||{};f.query.mapNotes&&arcgisonline.map.mapNotes.addMapNotesLayer();arcgisonline.map.main.checkLayerOrder();arcgisonline.map.main.checkMinWidthOfPage();arcgisonline.map.main.checkTitleDiv();arcgisonline.map.main.createUrlMarker();
f.query.showPublish&&arcgisonline.map.main.linkToMap(!0);f.query.defExt&&arcgisonline.map.main.displayDefaultExtent();if(f.query.panel&&"gallery"===f.query.panel&&(f.query.layers||f.query.url)&&!f.query.webmap)var g=f.query.layers&&f.query.layers.split(",")[0],h=f.query.url,l=null,m=setInterval(function(){for(var a=1;a<arcgisonline.map.main.mapLayers.length;a++){var b=arcgisonline.map.main.mapLayers[a];if((g&&b.itemId===g||h&&b.layer.url===h)&&b.layer instanceof esri.layers.FeatureLayer)if(f.query.id&&
b.layer.url&&-1<b.layer.url.indexOf("/"+f.query.id)){l=b;break}else if(!f.query.id){l=b;break}}l&&(clearInterval(m),arcgisonline.map.leftPanel.openLeftRendererPanel(l.id,-1,!0,!0,"true"===f.query.suggestField?!0:!1,f.query.showField,f.query.style))},200);if((d=arcgisonline.sharing.util.getUser())&&f.query.review&&(f.query.layers||f.query.services))var g=(f.query.layers||f.query.services).split(",")[0],p=0,m=setInterval(function(){b.forEach(arcgisonline.map.main.mapLayers,function(a){if(a.itemId===
g&&"base"!=a.type&&a.itemCard&&a.url&&(a.itemCard.owner===d.email||"update"===a.itemCard.itemControl||"admin"===a.itemCard.itemControl)&&-1<b.indexOf(a.itemCard.typeKeywords,"Involved Lookup"))clearInterval(m),arcgisonline.map.leftPanel.openLeftGeocodePanel(null,{parameterList:a})});20<p&&clearInterval(m);p++},1E3);b.publish("onMapFullyLoaded");f.query.find&&arcgisonline.map.geocode.doSearch(decodeURIComponent(f.query.find))}else arcgisonline.map.main.mapFullyLoadedTimer=setTimeout("arcgisonline.map.main.mapFullyLoaded()",
1E3)},checkLayerOrder:function(){if(arcgisonline.map.save_open.openedWebMap){var a=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,"LabelLayer");-1<a&&arcgisonline.map.main.map.reorderLayer("LabelLayer",arcgisonline.map.main.map.graphicsLayerIds.length);var e=[];b.forEach(arcgisonline.map.save_open.openedWebMap.operationalLayers,function(a){e.push(a.id)});var c=[];b.forEach(arcgisonline.map.main.mapLayers,function(a){c.push(a.id)});for(var d=!1,f=1;f<arcgisonline.map.main.mapLayers.length-1;){var g=
arcgisonline.map.main.mapLayers[f],h=arcgisonline.map.main.mapLayers[f+1];if(("user"==g.type||"mapNotes"==g.type)&&("user"==h.type||"mapNotes"==h.type)&&(g.layers||g.layer instanceof esri.layers.FeatureLayer||g.layer instanceof esri.layers.GeoRSSLayer)&&(h.layers||h.layer instanceof esri.layers.FeatureLayer||h.layer instanceof esri.layers.GeoRSSLayer)){var l=b.indexOf(e,g.id),m=b.indexOf(e,h.id);if(l>m){var p=1;h.layers?p=h.layers.length:h.layer instanceof esri.layers.GeoRSSLayer&&(p=h.layer.getFeatureLayers().length);
arcgisonline.map.main.mapLayers[f+1]=g;arcgisonline.map.main.mapLayers[f]=h;g.layers?(a=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,g.layers[g.layers.length-1].id),-1<a&&b.forEach(g.layers,function(b,e){arcgisonline.map.main.map.reorderLayer(b.id,a+p)},this)):g.layer instanceof esri.layers.GeoRSSLayer?(d=g.layer.getFeatureLayers(),a=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,d[d.length-1].id),-1<a&&b.forEach(d,function(b,e){arcgisonline.map.main.map.reorderLayer(b.id,a+p)},this)):
(a=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,g.id),d=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,h.id),-1<a&&(-1<d&&a<d)&&arcgisonline.map.main.map.reorderLayer(g.id,a+p));c=[];b.forEach(arcgisonline.map.main.mapLayers,function(a){c.push(a.id)});f=0;d=!0}}else"user"==g.type&&"user"==h.type&&-1<b.indexOf(arcgisonline.map.main.map.layerIds,g.id)&&-1<b.indexOf(arcgisonline.map.main.map.layerIds,h.id)?(l=b.indexOf(arcgisonline.map.main.map.layerIds,g.id),m=b.indexOf(arcgisonline.map.main.map.layerIds,
h.id),l>m&&arcgisonline.map.main.map.reorderLayer(h.id,l+1)):"user"==g.type&&"user"==h.type&&-1<b.indexOf(arcgisonline.map.main.map.layerIds,g.id)&&(h.layers||h.layer instanceof esri.layers.FeatureLayer||h.layer instanceof esri.layers.GeoRSSLayer)||("user"==g.type&&"user"==h.type&&(g.layers||g.layer instanceof esri.layers.FeatureLayer||g.layer instanceof esri.layers.GeoRSSLayer)&&-1<b.indexOf(arcgisonline.map.main.map.layerIds,h.id)?(p=1,arcgisonline.map.main.mapLayers[f+1]=g,arcgisonline.map.main.mapLayers[f]=
h,g.layers?(a=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,g.layers[g.layers.length-1].id),-1<a&&b.forEach(g.layers,function(b,e){arcgisonline.map.main.map.reorderLayer(b.id,a+p)},this)):g.layer instanceof esri.layers.GeoRSSLayer?(d=g.layer.getFeatureLayers(),a=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,d[d.length-1].id),-1<a&&b.forEach(d,function(b,e){arcgisonline.map.main.map.reorderLayer(b.id,a+p)},this)):(a=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,g.id),d=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,
h.id),-1<a&&(-1<d&&a<d)&&arcgisonline.map.main.map.reorderLayer(g.id,a+p)),c=[],b.forEach(arcgisonline.map.main.mapLayers,function(a){c.push(a.id)}),f=0,d=!0):"labels"==h.type&&b.indexOf(arcgisonline.map.main.map.layerIds,h.id)<arcgisonline.map.main.map.layerIds.length-1&&arcgisonline.map.main.map.reorderLayer(h.id,arcgisonline.map.main.map.layerIds.length-1));f++}for(f=g=0;f<arcgisonline.map.main.mapLayers.length;f++)if(h=arcgisonline.map.main.mapLayers[f],("user"==h.type||"mapNotes"==h.type)&&(h.layers||
h.layer instanceof esri.layers.FeatureLayer||h.layer instanceof esri.layers.GeoRSSLayer))if(h.layers||h.layer instanceof esri.layers.GeoRSSLayer){h=h.layers?h.layers:h.layer.getFeatureLayers();for(l=0;l<h.length;l++)m=h[l].id,-1<b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,m)&&arcgisonline.map.main.map.reorderLayer(m,g++)}else m=h.id,-1<b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,m)&&arcgisonline.map.main.map.reorderLayer(m,g++);d&&leftPanel&&leftPanel.reloadVisibleTOC();arcgisonline.map.labels.orderLayers()}},
onDblClick:function(a){if(!arcgisonline.map.edit.editActivated&&!arcgisonline.map.main.measureActivated&&!arcgisonline.map.edit.analysisDrawActivated){var b=0.5;null!=arcgisonline.map.main.mapLods&&(b=arcgisonline.map.main.map.getLevel()+1);arcgisonline.map.main.map.centerAndZoom(new esri.geometry.Point(a.mapPoint.x,a.mapPoint.y,arcgisonline.map.main.map.extent.spatialReference),b)}},onExtentChange:function(a,e,c,d){if(arcgisonline.map.main.startup){if(arcgisonline.map.main.map.getLayer(arcgisonline.map.main.currentBaseService)){null!=
arcgisonline.map.main.defaultService.layer&&!0==arcgisonline.map.main.defaultService.defaultVisibility&&arcgisonline.map.main.map.getLayer(arcgisonline.map.main.currentBaseService).show();for(e=0;e<arcgisonline.map.main.mapLayers.length;e++)(c=arcgisonline.map.main.mapLayers[e])&&(("user"==c.type||"labels"==c.type)&&c.defaultVisibility)&&arcgisonline.map.main.showLayerOnceLoaded(c.id,0);arcgisonline.map.main.startup=!1}}else!arcgisonline.map.main.isUserBaseService&&d&&(arcgisonline.map.main.hideNoDataDisplay(),
arcgisonline.map.main.displayNoData(d.level)),arcgisonline.map.main.lastExtent&&(e=arcgisonline.map.main.lastExtent.getWidth()*arcgisonline.map.main.lastExtent.getHeight(),c=a.getWidth()*a.getHeight(),1.3<Math.max(e,c)/Math.min(e,c)&&arcgisonline.map.main.markMapAsChangedIfOwner("onExtentChange")),isEmbedded&&arcgisonline.map.main.markMapAsChangedIfOwner("onExtentChange"),e=Math.round(arcgisonline.map.main.map.getScale()),e=b.number.format(e,{pattern:"#,###,###,##0"}),b.byId("layerMenu.scaleCurrent")&&
(b.byId("layerMenu.scaleCurrent").innerHTML=b.string.substitute(esri.i18nBundle.tocPanel.mapScale,{scale:e})),b.byId("subLayerMenu.scaleCurrent")&&(b.byId("subLayerMenu.scaleCurrent").innerHTML=b.string.substitute(esri.i18nBundle.tocPanel.mapScale,{scale:e}));arcgisonline.map.dijit.toc.scale.checkLayersInMapScale();arcgisonline.map.main.lastExtent=b.clone(a)},showLayerOnceLoaded:function(a,b){for(var c=0;c<arcgisonline.map.main.mapLayers.length;c++){var d=arcgisonline.map.main.mapLayers[c];if(d.id==
a){null==d.layer&&50>b?setTimeout(function(){arcgisonline.map.main.showLayerOnceLoaded(a,b+1)},100):null!=d.layer&&!0==d.defaultVisibility&&d.layer.show();break}}},onLayerAddedOrRemoved:function(a){"esri.layers.GraphicsLayer"===a.declaredClass||a.__tempTableLayer||null==arcgisonline.map.main.mapLayers[0]||(null==arcgisonline.map.main.mapLayers[0].layer||"base"!=arcgisonline.map.main.mapLayers[0].type)||(arcgisonline.map.edit.checkOnEditButton(),arcgisonline.map.time.checkOnTimeButton(),arcgisonline.map.dijit.toc.analysis.checkOnAnalysisButton(),
arcgisonline.map.multiDimensions.checkOnMdSliderButton(),null!=arcgisonline.map.save_open.webMapInfo&&(arcgisonline.map.save_open.webMapInfo.deleteExplorerSlides=!0),b.publish("onLayerUpdate",["reopen"]),leftPanel&&leftPanel.checkLegendStack(),arcgisonline.map.main.isMapFullyLoaded&&"editStack"===arcgisonline.map.leftPanel.getLeftContentPanelStack()&&(a instanceof esri.layers.FeatureLayer&&a.isEditable())&&setTimeout(function(){n.byId("editPanel").recreateEditor()},0))},onLayerReordered:function(a){"esri.layers.GraphicsLayer"===
a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass&&a.mode===esri.layers.FeatureLayer.MODE_SELECTION||(null!=arcgisonline.map.save_open.webMapInfo&&(arcgisonline.map.save_open.webMapInfo.deleteExplorerSlides=!0),leftPanel&&leftPanel.checkLegendStack())},resizeMap:function(){if(arcgisonline.map.main.map&&arcgisonline.map.main.map.extent&&arcgisonline.map.main.map.extent.xmin){try{arcgisonline.map.main.map.resize()}catch(a){}arcgisonline.map.main.map.reposition();arcgisonline.map.main.resizeNoDataDiv()}arcgisonline.map.table.grid&&
b.isIE&&arcgisonline.map.table.grid.resize()},onLayerVisibilityChange:function(){arcgisonline.map.edit.checkOnEditButton();arcgisonline.map.time.checkOnTimeButton();arcgisonline.map.multiDimensions.checkOnMdSliderButton();arcgisonline.map.main.markMapAsChangedIfOwner("onLayerVisibilityChange");leftPanel&&leftPanel.checkLegendStack()},onPanStart:function(){arcgisonline.map.edit.editActivated||(9>b.isIE?arcgisonline.map.main.map.setMapCursor("url(images/close_hand_cursor.cur),auto"):arcgisonline.map.main.map.setMapCursor("url(images/close_hand_cursor.png),auto"))},
onPanEnd:function(){arcgisonline.map.edit.editActivated||arcgisonline.map.main.setHandCursor()},onZoomEnd:function(){},onRendererUpdate:function(){leftPanel&&(leftPanel.deleteLegendStack(),"contentStack"==arcgisonline.map.leftPanel.getLeftContentPanelStack()?b.publish("onLayerUpdate",["reopen"]):leftPanel.deleteContentStack());arcgisonline.map.main.markMapAsChanged("onRendererUpdate")},setHandCursor:function(){null!=arcgisonline.map.main.map&&arcgisonline.map.main.map.setMapCursor("default")},displayNoData:function(a){arcgisonline.map.main.noDataDisplayTimer=
setTimeout("arcgisonline.map.main.displayNoDataDelay("+a+")",2500)},displayNoDataDelay:function(a){clearTimeout(arcgisonline.map.main.noDataDisplayTimer);if(null!=arcgisonline.map.main.mapLods){a=arcgisonline.map.main.mapLods[a].resolution;var e=arcgisonline.map.main.map.getLayer(arcgisonline.map.main.currentBaseService);if(e.tileInfo){var e=e.tileInfo.lods,c=e[0].resolution;if(a<e[e.length-1].resolution||a>c)b.style(b.byId("noData1"),"display","block"),b.style(b.byId("noData2"),"display","block"),
b.style(b.byId("noData3"),"display","block"),b.style(b.byId("noData4"),"display","block")}}},hideNoDataDisplay:function(){b.style(b.byId("noData1"),"display","none");b.style(b.byId("noData2"),"display","none");b.style(b.byId("noData3"),"display","none");b.style(b.byId("noData4"),"display","none")},resizeNoDataDiv:function(){arcgisonline.map.main.hideNoDataDisplay();b.style(b.byId("noDataDiv"),"width",""+b.style(b.byId("mapDiv"),"width")+"px");b.style(b.byId("noDataDiv"),"height",""+b.style(b.byId("mapDiv"),
"height")+"px");b.style(b.byId("noDataDiv"),"left",""+b.style(b.byId("mapDiv"),"left")+"px");b.style(b.byId("noDataDiv"),"top",""+b.style(b.byId("mapDiv"),"top")+"px");var a=arcgisonline.map.main.map.height/4-25;b.style(b.byId("noData1"),"margin",""+a+"px 0 "+a+"px 0");b.style(b.byId("noData2"),"margin",""+a+"px 0 "+a+"px 0");b.style(b.byId("noData3"),"margin",""+a+"px 0 "+a+"px 0");b.style(b.byId("noData4"),"margin",""+a+"px 0 "+a+"px 0")},setDefaultTitle:function(){arcgisonline.map.main.setTitle(esri.i18nBundle.viewer.defaultMapTitle)},
setTitle:function(a){b.byId("webmap-title-text").innerHTML=a;arcgisonline.map.main.checkTitleDiv();b.doc.title=esriGeowConfig.urlKey?a:(esriGeowConfig.portalName?esriGeowConfig.portalName:"ArcGIS")+" - "+a},checkTitleDiv:function(){if(arcgisonline.map.main.isMapFullyLoaded){var a=b.coords(b.byId("webmap-header")).w,e=b.coords(b.byId("home-navigation-dropdown")).w,c=b.coords(b.byId("header-controls")).w,c=a-e-c-45;0>c&&(b.style(b.byId("header-controls"),"width","300px"),c=a-e-300-30);b.style(b.byId("webmap-title"),
"width",c+"px");-1===b.byId("webmap-title").className.indexOf("text-ellipsis")&&b.addClass(b.byId("webmap-title"),"text-ellipsis");b.style(b.byId("webmap-title-text"),"visibility","visible");esriGeowConfig.isRightToLeft?b.style(b.byId("webmap-title"),"paddingRight",e+18+"px"):b.style(b.byId("webmap-title"),"paddingLeft",e+18+"px")}},setMapExtent:function(a){null==a&&(a=arcgisonline.map.main.defaultExtent);arcgisonline.map.main.initialExtent=new esri.geometry.Extent(a.xmin,a.ymin,a.xmax,a.ymax,a.spatialReference);
var e=arcgisonline.map.main.map.spatialReference;null==e&&(e=arcgisonline.map.main.defaultExtent.spatialReference);var c=arcgisonline.sharing.util.urlToObject(document.URL);c.query=c.query||{};if(c.query.extent){var d=decodeURIComponent(c.query.extent).split(";");1===d.length&&(d=decodeURIComponent(c.query.extent).split(","));if(4==d.length||5==d.length){var f=b.number.parse(d[0]),g=b.number.parse(d[1]),h=b.number.parse(d[2]),l=b.number.parse(d[3]);if(isNaN(f)||isNaN(f)||isNaN(f)||isNaN(f))f=parseFloat(d[0]),
g=parseFloat(d[1]),h=parseFloat(d[2]),l=parseFloat(d[3]);!isNaN(f)&&!isNaN(g)&&!isNaN(h)&&!isNaN(l)?(a=4326,5==d.length&&!isNaN(d[4])&&(a=parseInt(d[4])),g=new esri.geometry.Extent(f,g,h,l,new esri.SpatialReference({wkid:a})),arcgisonline.map.main.sameSpatialReference(e,new esri.SpatialReference({wkid:a}))?(arcgisonline.map.main.initialExtent=g,arcgisonline.map.main.map.setExtent(g,!1)):(d=function(a,b){arcgisonline.map.main.initialExtent=a[0];arcgisonline.map.main.map.setExtent(a[0],!1)},f=function(a,
b){arcgisonline.map.main.map.setExtent(arcgisonline.map.main.defaultExtent,!1)},arcgisonline.map.main.projectToMapSpatialReference(g,b.hitch(this,d),b.hitch(this,f)))):arcgisonline.map.main.map.setExtent(arcgisonline.map.main.defaultExtent,!1)}else arcgisonline.map.main.map.setExtent(arcgisonline.map.main.defaultExtent,!1)}else if(c.query.center){if(d=decodeURIComponent(c.query.center).split(";"),1===d.length&&(d=decodeURIComponent(c.query.center).split(",")),2==d.length||3==d.length){g=b.number.parse(d[0]);
h=b.number.parse(d[1]);if(isNaN(g)||isNaN(h))g=parseFloat(d[0]),h=parseFloat(d[1]);if(!isNaN(g)&&!isNaN(h)){a=4326;3==d.length&&!isNaN(d[2])&&(a=parseInt(d[2]));var m=function(a,b){var d=0,f=0;null!=arcgisonline.map.main.mapLods&&c.query.level?(f=parseInt(c.query.level),d=arcgisonline.map.main.mapLods[f].resolution*arcgisonline.map.main.map.width/2,f=arcgisonline.map.main.mapLods[f].resolution*arcgisonline.map.main.map.height/2):c.query.resolution?(f=parseFloat(c.query.resolution),d=f*arcgisonline.map.main.map.width/
2,f=f*arcgisonline.map.main.map.height/2):(d=arcgisonline.map.main.defaultExtent.getWidth()/2,f=arcgisonline.map.main.defaultExtent.getHeight()/2);d=new esri.geometry.Extent(a-d,b-f,a+d,b+f,e);arcgisonline.map.main.initialExtent=d;arcgisonline.map.main.map.setExtent(d)};arcgisonline.map.main.sameSpatialReference(e,new esri.SpatialReference({wkid:a}))?m(g,h):(d=function(a,b){m(a[0].x,a[0].y)},f=function(a,b){arcgisonline.map.main.map.setExtent(arcgisonline.map.main.defaultExtent,!1)},arcgisonline.map.main.projectPointToMapSpatialReference(g,
h,new esri.SpatialReference({wkid:a}),b.hitch(this,d),b.hitch(this,f)))}}}else arcgisonline.map.main.map.spatialReference||(d=new esri.SpatialReference(a.spatialReference.toJson()),arcgisonline.map.main.map.spatialReference=d),arcgisonline.map.main.map.setExtent(a,!1)},createUrlMarker:function(){var a=arcgisonline.sharing.util.urlToObject(document.URL);a.query=a.query||{};if(a.query.marker){var e=decodeURIComponent(a.query.marker).split(";");1===e.length&&(e=decodeURIComponent(a.query.marker).split(","));
var c={TITLE:"",DESCRIPTION:"",IMAGE_URL:null,IMAGE_LINK_URL:null},d={VISIBLE:1,TYPEID:0,OBJECTID:0};if(2<=e.length&&6>=e.length&&!isNaN(e[0])&&!isNaN(e[1])){var f=parseFloat(e[0]),g=parseFloat(e[1]),h=4326;3<=e.length&&(e[2].length&&!isNaN(e[2]))&&(h=parseInt(e[2]));var l="";4<=e.length&&(l=e[3],c.TITLE=l);var m=null;5<=e.length&&0===e[4].indexOf("http")&&(m=e[4]);l=null;6===e.length&&(l=e[5]);var p=function(b,e){var c=0,d=0;null!=arcgisonline.map.main.mapLods&&a.query.level?(d=parseInt(a.query.level),
c=arcgisonline.map.main.mapLods[d].resolution*arcgisonline.map.main.map.width/2,d=arcgisonline.map.main.mapLods[d].resolution*arcgisonline.map.main.map.height/2):a.query.resolution?(d=parseFloat(a.query.resolution),c=d*arcgisonline.map.main.map.width/2,d=d*arcgisonline.map.main.map.height/2):(c=arcgisonline.map.main.defaultExtent.getWidth()/2,d=arcgisonline.map.main.defaultExtent.getHeight()/2);c=new esri.geometry.Extent(b-c,e-d,b+c,e+d,arcgisonline.map.main.map.spatialReference);arcgisonline.map.main.initialExtent=
c;arcgisonline.map.main.map.setExtent(c)},e=new esri.geometry.Point(f,g,new esri.SpatialReference({wkid:h})),m=esri.symbol.fromJson({type:"esriPMS",url:m,contentType:"image/png"}),s=null;l&&(s=esri.symbol.fromJson({color:[0,0,0,255],type:"esriTS",verticalAlignment:"baseline",horizontalAlignment:"left",angle:0,xoffset:0,yoffset:0,rotated:!1,kerning:!0,font:{size:12,style:"normal",weight:"bold",family:"Arial"},text:l}));arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"community/groups?q\x3d"+
esriGeowConfig.layerTemplatesGroupQuery).then(b.hitch(this,function(a,e,c,d,f,g){arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"search?num\x3d50\x26q\x3dgroup:"+g.results[0].id+' AND type:"Feature Collection Template"').then(b.hitch(this,function(a,e,c,d,f,g){if(g.results&&0!==g.results.length){g.results.sort(function(a,b){return a.name==b.name?0:a.name<b.name?-1:1});arcgisonline.map.mapNotes.getMapNotesConfig(g.results[0].id,esri.i18nBundle.mapNotesDlg.mapNotes,!0);var m=b.connect(arcgisonline.map.main.map,
"onLayersAddResult",b.hitch(this,function(a,e,c,d,f,g){for(var h=0;h<g.length;h++){var l=arcgisonline.map.main.getParameterList(g[h].layer);if(l.title===esri.i18nBundle.mapNotesDlg.mapNotes){b.disconnect(m);arcgisonline.map.main.projectPointToMapSpatialReference(a.x,a.y,new esri.SpatialReference({wkid:a.spatialReference.wkid}),b.hitch(this,function(b,e,c,d,f){a=new esri.geometry.Point(f[0].x,f[0].y,f[0].spatialReference);b.url?arcgisonline.map.main.getPictureMarkerSize(b.url).then(function(f){b.width=
f[0];b.height=f[1];l.layers[3].applyEdits([new esri.Graphic(a,b,c)]);e&&(e.xoffset=b.width/2,e.yoffset=b.height/2,l.layers[2].applyEdits([new esri.Graphic(new esri.geometry.Point(a.toJson()),e,d)]))},function(){var f=window.location.href.substring(0,window.location.href.indexOf(window.location.pathname)+window.location.pathname.lastIndexOf("/"))+"/images/EsriBluePinCircle26.png";b.url=f;b.width=26;b.height=26;b.yoffset=13;l.layers[3].applyEdits([new esri.Graphic(a,b,c)]);e&&(e.xoffset=13,e.yoffset=
13,l.layers[2].applyEdits([new esri.Graphic(new esri.geometry.Point(a.toJson()),e,d)]))}):(f=window.location.href.substring(0,window.location.href.indexOf(window.location.pathname)+window.location.pathname.lastIndexOf("/"))+"/images/EsriBluePinCircle26.png",b.url=f,b.width=26,b.height=26,b.yoffset=13,l.layers[3].applyEdits([new esri.Graphic(a,b,c)]),e&&(e.xoffset=13,e.yoffset=13,l.layers[2].applyEdits([new esri.Graphic(new esri.geometry.Point(a.toJson()),e,d)])))},e,c,d,f));break}}},a,e,c,d,f))}},
a,e,c,d,f))},e,m,s,c,d));arcgisonline.map.main.sameSpatialReference(arcgisonline.map.main.map.spatialReference,new esri.SpatialReference({wkid:h}))?p(f,g):arcgisonline.map.main.projectPointToMapSpatialReference(f,g,new esri.SpatialReference({wkid:h}),b.hitch(this,function(a,b){p(a[0].x,a[0].y)}),b.hitch(this,function(a,b){arcgisonline.map.main.map.setExtent(arcgisonline.map.main.defaultExtent,fitExtentCompletely)}))}}},cleanUpFailedServices:function(){for(var a=0;0<arcgisonline.map.main.mapLayers.length;){if(null==
arcgisonline.map.main.mapLayers[a]){for(k=a;k<arcgisonline.map.main.mapLayers.length-1;k++)arcgisonline.map.main.mapLayers[k]=arcgisonline.map.main.mapLayers[k+1];arcgisonline.map.main.mapLayers.length-=1}if(a>=arcgisonline.map.main.mapLayers.length-1)break;a++}},getNewMapExtent:function(a){var b=arcgisonline.map.main.map.getLayer(arcgisonline.map.main.currentBaseService),c=b?new esri.geometry.Extent(arcgisonline.map.main.map.extent.toJson()):arcgisonline.map.main.defaultExtent,d=a.intersects(c);
if(d){var f=d.getWidth()*d.getHeight(),g=c.getWidth()*c.getHeight();f<g/200?d=!1:a.getWidth()*a.getHeight()<g/1E3&&(d=!1)}if(d&&arcgisonline.map.main.mapInitialized)a=arcgisonline.map.main.map.extent&&isNaN(arcgisonline.map.main.map.extent.xmin)?{extent:a,zoomMap:!0}:{extent:c,zoomMap:!1};else if(b?b=b.fullExtent:(d=arcgisonline.map.main.mapLayers[0],b=d.serviceInfo?arcgisonline.map.layer.parseServiceInfo(d.serviceInfo,d.url).extent:d.fullExtent),d=a.intersects(b)){if(!arcgisonline.map.main.map||
!arcgisonline.map.main.map.wrapAround180)a.xmin<b.xmin&&(a=a.update(b.xmin,a.ymin,a.xmax,a.ymax,a.spatialReference)),a.xmax>b.xmax&&(a=a.update(a.xmin,a.ymin,b.xmax,a.ymax,a.spatialReference));a.ymin<b.ymin&&(a=a.update(a.xmin,b.ymin,a.xmax,a.ymax,a.spatialReference));a.ymax>b.ymax&&(a=a.update(a.xmin,a.ymin,a.xmax,b.ymax,a.spatialReference));a={extent:a,zoomMap:!0}}else a={extent:c,zoomMap:!1};a.extent=arcgisonline.map.main.fitNewMapExtent(a.extent);return a},fitNewMapExtent:function(a){var e=[102113,
102100,3857],c=a.spatialReference.wkid;if(4326!=c&&!b.indexOf(e,c))return a;var d=a;-1<b.indexOf(e,c)&&(d=arcgisonline.map.main.projectGeometries([a],a.spatialReference,new esri.SpatialReference({wkid:4326}))[0]);return-170>d.xmin&&170<d.xmax&&-80>d.ymin&&80<d.ymax?(a=arcgisonline.map.main.adjustHeightToAspectRatio(a),arcgisonline.map.main.getExtentForNextTileLevel(a,arcgisonline.map.main.map.width,!0)):a},zoomMap:function(a,e,c,d){e=e?e:0;c=c?c:0;var f=b.connect(arcgisonline.map.main.map,"onExtentChange",
b.hitch(this,function(){b.disconnect(f);d()})),g=arcgisonline.map.main.getScaleForExtent(a,arcgisonline.map.main.map.width);0<e&&g>e?(a=arcgisonline.map.main.adjustHeightToAspectRatio(a),e=arcgisonline.map.main.getExtentForScale(a,arcgisonline.map.main.map.width,e),e.getWidth()<a.getWidth()&&(a=e),a=arcgisonline.map.main.getExtentForNextTileLevel(a,arcgisonline.map.main.map.width,!0)):0<c&&g<c&&(a=arcgisonline.map.main.adjustHeightToAspectRatio(a),e=arcgisonline.map.main.getExtentForScale(a,arcgisonline.map.main.map.width,
c),e.getWidth()>a.getWidth()&&(a=e),a=arcgisonline.map.main.getExtentForNextTileLevel(a,arcgisonline.map.main.map.width,!1));e=arcgisonline.sharing.util.urlToObject(document.URL);e.query=e.query||{};if(arcgisonline.map.main.mapInitialized)if(arcgisonline.map.main.isMapFullyLoaded)arcgisonline.map.main.map.setExtent(a);else{if(arcgisonline.map.main.isMapFullyLoaded||!e.query.center&&!e.query.extent)var h=0,l=setInterval(function(){arcgisonline.map.main.isMapFullyLoaded&&(clearInterval(l),arcgisonline.map.main.map.setExtent(a));
h++;100<h&&clearInterval(l)},100)}else arcgisonline.map.main.initMap(a)},projectToMapAndZoom:function(a,e,c,d){if(!a||isNaN(a.xmin)||isNaN(a.ymin)||isNaN(a.xmax)||isNaN(a.ymax))arcgisonline.map.main.zoomMap(arcgisonline.map.main.defaultExtent,e,c,d);else{var f=arcgisonline.map.main.map.spatialReference;null==f&&(f=arcgisonline.map.main.defaultExtent.spatialReference);arcgisonline.map.main.sameSpatialReference(f,a.spatialReference)?(a=arcgisonline.map.main.getNewMapExtent(a),a.zoomMap?arcgisonline.map.main.zoomMap(a.extent,
e,c,d):d()):arcgisonline.map.main.projectToMapSpatialReference(a,b.hitch(this,function(a,b){var f=arcgisonline.map.main.getNewMapExtent(a[0]);f.zoomMap?arcgisonline.map.main.zoomMap(f.extent,e,c,d):(arcgisonline.map.main.mapInitialized||arcgisonline.map.main.initMap(),d())}),b.hitch(this,function(a,b){arcgisonline.map.main.zoomMap(arcgisonline.map.main.defaultExtent,e,c,d)}))}},adjustHeightToAspectRatio:function(a){var e=a.getWidth()*(arcgisonline.map.main.map.height/arcgisonline.map.main.map.width)/
5;b.mixin(a,{ymin:a.getCenter().y-e,ymax:a.getCenter().y+e});return a},getExtentForScale:function(a,b,c){var d=20015077/180,f=esri.config.defaults,g=esri.WKIDUnitConversion,h,l,m=a.spatialReference;m&&(h=m.wkid,l=m.wkt);m=null;h?m=g.values[g[h]]:l&&-1!==l.search(/^PROJCS/i)&&(g=/UNIT\[([^\]]+)\]\]$/i.exec(l))&&g[1]&&(m=parseFloat(g[1].split(",")[1]));return a.expand(c*b/(39.37*(m||d)*f.screenDPI)/a.getWidth())},getExtentFromCenter:function(a,b,c){a=new esri.geometry.Extent(a.x-1,a.y-0.5,a.x+1,a.y+
0.5,a.spatialReference);return arcgisonline.map.main.getExtentForScale(a,b,c)},getScaleForExtent:function(a,b){var c=20015077/180,d=esri.config.defaults,f=esri.WKIDUnitConversion,g,h,l=a.spatialReference;l&&(g=l.wkid,h=l.wkt);l=null;g?l=f.values[f[g]]:h&&-1!==h.search(/^PROJCS/i)&&(f=/UNIT\[([^\]]+)\]\]$/i.exec(h))&&f[1]&&(l=parseFloat(f[1].split(",")[1]));return 39.37*(a.getWidth()/b*(l||c))*d.screenDPI},getExtentForNextTileLevel:function(a,b,c){if(null!=arcgisonline.map.main.mapLods){b=a.getWidth()/
b;for(var d=arcgisonline.map.main.mapLods,f=d[d.length-1].resolution,g=0;g<d.length;g++)if(d[g].resolution<b){f=c?d[g].resolution:0==g?d[0].resolution:d[g-1].resolution;break}return a.expand(0.9*(f/b))}return a},getExtentForCloseTileLevel:function(a,b){if(null!=arcgisonline.map.main.mapLods)for(var c=a.getWidth()/b,d=arcgisonline.map.main.mapLods,f=0;f<d.length-1;f++)if(d[f].resolution>c&&d[f+1].resolution<c){var g=(d[f].resolution-d[f+1].resolution)/10;if(d[f].resolution<c+g)return a.expand(0.9*
(d[f].resolution/c));if(d[f+1].resolution>c-g)return a.expand(0.9*(d[f+1].resolution/c));break}return a},getIntersectionPercent:function(a,e){var c=new b.Deferred;if(!e)return c.callback(0),c;if(e.spatialReference._isWrappable())esri.geometry.normalizeCentralMeridian([e],null,b.hitch(this,function(b){if(b[0].rings){var d=(new esri.geometry.Polygon(e.spatialReference)).addRing(b[0].rings[0]).getExtent();b=(new esri.geometry.Polygon(e.spatialReference)).addRing(b[0].rings[1]).getExtent();e=d.getWidth()>
b.getWidth()?d:b}else e=b[0];(d=e.intersects(a))?(d=d.getWidth()*d.getHeight(),b=e.getWidth()*e.getHeight(),c.callback(100*(d/b))):c.callback(0)}),function(){c.callback(0)});else{var d=e.intersects(a);if(d){var d=d.getWidth()*d.getHeight(),f=e.getWidth()*e.getHeight();c.callback(100*(d/f))}else c.callback(0)}return c},zoomToLayerScale:function(a){if(a.layers){var e=-1*Number.MAX_VALUE,c=Number.MAX_VALUE;b.forEach(a.layers,b.hitch(this,function(a){var b=a.minScale||0;a=a.maxScale||0;e=0===e||0===b?
0:Math.max(e,b);c=Math.min(c,a)}));arcgisonline.map.main.zoomToScale(e,c)}else a.layer&&arcgisonline.map.main.zoomToScale(a.layer.minScale,a.layer.maxScale)},zoomToScale:function(a,b){var c=arcgisonline.map.main.map.getScale();0<a&&c>a?arcgisonline.map.main.map.setScale(arcgisonline.map.main.getScaleForNextTileLevel(a,!0)):c<b&&arcgisonline.map.main.map.setScale(arcgisonline.map.main.getScaleForNextTileLevel(b,!1))},zoomMapConsiderScale:function(a,e,c){var d,f;a.layers?(d=-1*Number.MAX_VALUE,f=Number.MAX_VALUE,
b.forEach(a.layers,b.hitch(this,function(a){var b=a.minScale||0;a=a.maxScale||0;d=0===d||0===b?0:Math.max(d,b);f=Math.min(f,a)}))):a.layer&&(d=a.layer.minScale||0,f=a.layer.maxScale||0,a.layer.dynamicLayerInfos&&arcgisonline.map.main.hasDynamicLayers(a)?(a=arcgisonline.map.dijit.toc.scale.mergeSubLayerScales(a.layer.dynamicLayerInfos,a.layer.layerInfos,a),a=arcgisonline.map.dijit.toc.scale.mergeScale(a.minScale,a.maxScale,d,f),d=a.minScale,f=a.maxScale):a.layer.layerInfos&&a.layer.layerInfos.length&&
(a.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer||a.layer instanceof esri.layers.ArcGISTiledMapServiceLayer)?(a=arcgisonline.map.dijit.toc.scale.mergeSubLayerScales(a.layer.layerInfos,null,a),a=arcgisonline.map.dijit.toc.scale.mergeScale(a.minScale,a.maxScale,d,f),d=a.minScale,f=a.maxScale):a.layer.folders&&(a=arcgisonline.map.dijit.toc.scale.mergeSubLayerScales(a.layer.folders,null,a),a=arcgisonline.map.dijit.toc.scale.mergeScale(a.minScale,a.maxScale,d,f),d=a.minScale,f=a.maxScale));
a=arcgisonline.map.main.map.getScale();0<d&&a>d?(d=arcgisonline.map.main.getScaleForNextTileLevel(d,!0),c=arcgisonline.map.main.adjustHeightToAspectRatio(e),c=arcgisonline.map.main.getExtentForScale(c,arcgisonline.map.main.map.width,d),arcgisonline.map.main.map.setExtent(c)):a<f?(f=arcgisonline.map.main.getScaleForNextTileLevel(f,!1),c=arcgisonline.map.main.adjustHeightToAspectRatio(e),c=arcgisonline.map.main.getExtentForScale(e,arcgisonline.map.main.map.width,f),arcgisonline.map.main.map.setExtent(c)):
c?arcgisonline.map.main.zoomMap(e,d,f,function(){}):(a=arcgisonline.map.main.getNewMapExtent(e),a.zoomMap&&arcgisonline.map.main.zoomMap(e,d,f,function(){}))},getScaleForNextTileLevel:function(a,b){if(null!=arcgisonline.map.main.mapLods){var c=arcgisonline.map.main.mapLods;if(b){for(var d=0;d<c.length;d++)if(c[d].scale<a)return c[d].scale-1;return c[c.length-1].scale-1}for(d=c.length-1;0<=d;d--)if(c[d].scale>a)return c[d].scale+1;return c[0].scale+1}return a},checkSuggestedScaleRangeAndZoom:function(a){return arcgisonline.map.main.checkSuggestedScaleRange(a,
!0)},checkSuggestedScaleRange:function(a,e){var c=new b.Deferred;if(a.layer)arcgisonline.map.main.checkSuggestedScaleRangePerLayer(a.layer,e).then(function(d){a.scaleChanged=!0;if(e){var g;g=arcgisonline.map.featColl.isFeatureCollection(a)?arcgisonline.map.featColl.getLayerFullExtent(a.layer):new esri.geometry.Extent(a.layer.fullExtent.toJson());arcgisonline.map.main.sameSpatialReference(arcgisonline.map.main.map.spatialReference,g.spatialReference)?(d.scaleAtFullExtent&&(g=arcgisonline.map.main.getExtentFromCenter(g.getCenter(),
arcgisonline.map.main.map.width,d.scaleAtFullExtent)),arcgisonline.map.main.map.setExtent(g)):arcgisonline.map.main.projectToMapSpatialReference(g,b.hitch(this,function(a,b){a&&(0<a.length&&a[0]&&"extent"==a[0].type)&&(g=a[0],d.scaleAtFullExtent&&(g=arcgisonline.map.main.getExtentFromCenter(g.getCenter(),arcgisonline.map.main.map.width,d.scaleAtFullExtent)),arcgisonline.map.main.map.setExtent(g))}))}c.resolve(d)},function(){if(e){var b;b=arcgisonline.map.featColl.isFeatureCollection(a)?arcgisonline.map.featColl.getLayerFullExtent(a.layer):
new esri.geometry.Extent(a.layer.fullExtent.toJson());arcgisonline.map.main.zoomMapConsiderScale(a,b)}c.resolve()});else if(a.layers){var d;b.forEach(a.layers,function(b,g){arcgisonline.map.main.checkSuggestedScaleRangePerLayer(b,e).then(function(b){a.scaleChanged=!0;if(b.scaleAtFullExtent&&(!esri.isDefined(d)||d<b.scaleAtFullExtent))d=b.scaleAtFullExtent;if(g===a.layers.length-1){if(b&&b.center){var e=arcgisonline.map.featColl.getFullExtent(a);esri.isDefined(d)&&(e=arcgisonline.map.main.getExtentFromCenter(e.getCenter(),
arcgisonline.map.main.map.width,d));arcgisonline.map.main.map.setExtent(e)}else a.layer&&(e=arcgisonline.map.featColl.getLayerFullExtent(a.layer),arcgisonline.map.main.zoomMapConsiderScale(a,e));b.scaleAtFullExtent=d;c.resolve(b)}},function(){if(e&&0===g){var b=arcgisonline.map.featColl.getLayerFullExtent(a.layers[0]);arcgisonline.map.main.zoomMapConsiderScale(a,b)}g===a.layers.length-1&&c.resolve(info)})})}return c},checkSuggestedScaleRangePerLayer:function(a,e){var c=new b.Deferred;if(!(a instanceof
esri.layers.FeatureLayer)||a instanceof esri.layers.StreamLayer)c.reject();else return 0===a.minScale&&0===a.maxScale&&a.addPlugin("esri/plugins/FeatureLayerStatistics").then(b.hitch(this,function(){a.statisticsPlugin.getSuggestedScaleRange({map:arcgisonline.map.main.map}).then(function(b){console.log("getSuggestedScaleRange returns for:",a.name," relaxedMinScale:",b.relaxedMinScale,"scaleAtFullExtent:",b.scaleAtFullExtent,"minScale:",b.minScale,b.maxScale);a.setScaleRange(b.relaxedMinScale,b.maxScale);
c.resolve(b)},function(a){console.log("getSuggestedScaleRange error",a);c.reject()})})),c},addLayerFromFile:function(){arcgisonline.sharing.dijit.dialog.AddLayerFromFileDlg.prototype.statics.getInstance().show()},addLayerFromUrl:function(){arcgisonline.sharing.dijit.dialog.AddLayerFromUrlDlg.prototype.statics.getInstance().show()},browseLayers:function(){arcgisonline.sharing.dijit.dialog.BrowseLayersDlg.prototype.statics.getInstance().show()},requireAuthentication:function(a){if(!0==arcgisonline.sharing.util.isLoggedIn())return!0;
arcgisonline.map.storage.saveMapInCookie(a,!0,null,null,b.hitch(this,function(){var a="";-1==esriGeowConfig.signin.indexOf("http")&&(a=esriGeowConfig.baseUrl,!1!==esriGeowConfig.useSSL&&(a=arcgisonline.sharing.util.getSecureUrl(a)));a+=esriGeowConfig.signin;a+="?error\x3d403\x26returnUrl\x3d"+esriGeowConfig.baseUrl+esriGeowConfig.webmapViewerPath+"?useExisting\x3d1";window.location=a}));return!1},signInWithPopup:function(){arcgisonline.map.main.signInWithOAuth().then(function(a){a&&arcgisonline.map.main.mapHasChanged&&
arcgisonline.map.role.isAllowed("tool_save")?(arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.viewer.webMap,message:esri.i18nBundle.viewer.main.unsavedChangesDoSave,choiceOneTitle:esri.i18nBundle.viewer.main.unsavedChangesYesBtn,choiceOneHandler:b.hitch(this,function(){var a=arcgisonline.sharing.util.getUser();null==arcgisonline.map.save_open.webMapInfo||arcgisonline.map.save_open.webMapInfo.owner!==a.email&&"admin"!==arcgisonline.map.save_open.webMapInfo.itemControl&&
"update"!==arcgisonline.map.save_open.webMapInfo.itemControl?arcgisonline.map.storage.canSaveWithBing()&&(a=arcgisonline.sharing.dijit.dialog.SaveWebMapDlg.prototype.statics.getInstance(),b.subscribe("onWebMapSave",null,b.hitch(arcgisonline.map.storage,"onWebMapSave")),a.addWebMapItem(arcgisonline.map.main.mapLayers,arcgisonline.map.main.map.extent,arcgisonline.map.save_open.folderId,arcgisonline.map.save_open.webMapInfo,function(a){arcgisonline.map.main.redirectToCustomURL(a,!1)},function(){arcgisonline.map.main.redirectToCustomURL(null,
!1)})):arcgisonline.map.storage.saveExistingWebMap(null,function(a){arcgisonline.map.main.redirectToCustomURL(a,!1)},function(){arcgisonline.map.main.redirectToCustomURL(null,!1)})}),choiceTwoTitle:esri.i18nBundle.viewer.main.unsavedChangesNoBtn,choiceTwoHandler:b.hitch(this,function(){arcgisonline.map.main.redirectToCustomURL(null,!1)})}),a=esri.i18nBundle.viewer.main.unsavedChangesYesBtn.length+esri.i18nBundle.viewer.main.unsavedChangesNoBtn.length,b.style(b.byId("choice-dialog"),"width",Math.min(10*
a+150,650)+"px")):a&&arcgisonline.map.main.redirectToCustomURL(null,!1)});return!1},signInWithPopupAndSave:function(a){if(arcgisonline.sharing.util.isLoggedIn())return arcgisonline.map.storage.saveWebMapClick(a),!0;arcgisonline.map.main.signInWithOAuth().then(b.hitch(this,function(a,c){if(arcgisonline.map.role.isAllowed("tool_save"))arcgisonline.map.storage.saveWebMapClick(a,function(a){arcgisonline.map.main.redirectToCustomURL(a,!0)},function(){arcgisonline.map.main.redirectToCustomURL(null,!1)});
else{var d=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();d.show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:esri.i18nBundle.viewer.error.cannotSaveMap});var f=b.connect(d,"onHide",function(){b.disconnect(f);arcgisonline.map.main.redirectToCustomURL(null,!1)})}},a));return!1},signInWithOAuth:function(a){var e=new b.Deferred;window.checkOAuthResponse=b.hitch(arcgisonline.map.main,"checkOAuthResponse");var c=esriGeowConfig.restBaseUrl.substring(0,esriGeowConfig.restBaseUrl.indexOf("/",
8)).replace("http://","https://");esriGeowConfig.self.portalHostname&&(c="https://"+esriGeowConfig.self.portalHostname);a=new esri.arcgis.OAuthInfo({appId:"arcgisonline",portalUrl:c,minTimeUntilExpiration:525949,forceLogin:!0,locale:b.locale,popup:!0,popupCallbackUrl:"viewer_oauth-callback.html",popupWindowFeatures:"height\x3d480,width\x3d800,resizable,scrollbars",msg:esri.i18nBundle.viewer.main.oAuthSignInMsg});esri.id.registerOAuthInfos([a]);esri.id.useSignInPage=!1;esri.id.getCredential(c,{oAuthPopupConfirmation:!1}).then(function(a){var f=
new esri.arcgis.Portal(c);f.signIn().then(function(a){arcgisonline.sharing.geow.Account.setupAfterSelf(f);if(arcgisonline.sharing.util.parseUrl(c).host!==arcgisonline.sharing.util.parseUrl(esriGeowConfig.restBaseUrl).host&&(!esriGeowConfig.self.urlKey||!esriGeowConfig.self.customBaseUrl||arcgisonline.sharing.util.parseUrl(esriGeowConfig.restBaseUrl).host!==esriGeowConfig.self.urlKey+"."+esriGeowConfig.self.customBaseUrl))esriGeowConfig.restBaseUrl=esriGeowConfig.restBaseUrl.replace(arcgisonline.sharing.util.parseUrl(esriGeowConfig.restBaseUrl).host,
arcgisonline.sharing.util.parseUrl(c).host);arcgisonline.sharing.geow.Geow.signInHandler2(arcgisonline.map.main.oAuthInfo).then(function(){var a=!1,c=arcgisonline.sharing.util.parseUrl(document.location.href).host,d=esriGeowConfig.self;if(!d.isPortal&&(c===d.portalHostname||d.urlKey&&d.customBaseUrl&&c!==d.urlKey+"."+d.customBaseUrl||!d.urlKey&&c!==d.portalHostname))d.urlKey&&d.customBaseUrl?-1===c.indexOf(d.urlKey+"."+d.customBaseUrl)&&(a=!0):d.urlKey||(a=!0);!esriGeowConfig.userInfo.token&&esriGeowConfig.userInfo.credential&&
(esriGeowConfig.userInfo.token=esriGeowConfig.userInfo.credential.token);arcgisonline.map.role.clearUserActions();arcgisonline.map.role.setupUserActions();arcgisonline.map.main.loggedIn();arcgisonline.map.main.updateHeaderLinks();!arcgisonline.map.save_open.webMapInfo&&!arcgisonline.map.save_open.itemCard&&arcgisonline.map.leftPanel.recreateAboutStack();b.forEach(arcgisonline.map.main.mapLayers,function(a){a.layer&&(a.serviceInfo&&a.serviceInfo.ownershipBasedAccessControlForFeatures&&!1===a.serviceInfo.ownershipBasedAccessControlForFeatures.allowOthersToQuery)&&
arcgisonline.map.main.reloadFeatureLayer(a)});c=arcgisonline.sharing.util.getUser();arcgisonline.map.save_open.webMapInfo&&arcgisonline.map.save_open.webMapInfo.owner!==c.email?arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"content/items/"+arcgisonline.map.save_open.webMapInfo.id,b.hitch(this,function(b,c){arcgisonline.map.save_open.webMapItemCard=b;arcgisonline.map.save_open.webMapInfo.itemControl=b.itemControl;arcgisonline.map.role.updateUserActionAfterOAuth();e.callback(a)}),b.hitch(this,
function(b,c){e.callback(a)})):e.callback(a)})}).otherwise(function(a){console.log("Error occurred while signing in: ",a);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.generalDlg.errorDlgTitle,message:esri.i18nBundle.viewer.error.cannotSignInOAuth});e.errback()})}).otherwise(function(a){console.log("Error occurred while getting credentials: ",a);"ABORTED"!==a.message&&(arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:esri.i18nBundle.generalDlg.errorDlgTitle,
message:esri.i18nBundle.viewer.error.cannotSignInOAuth}),e.errback())});return e},checkOAuthResponse:function(a){a=new b._Url(a);a=a.fragment?b.queryToObject(a.fragment):null;a.error?console.log("checkOAuthResponse: Error occurred while signing in: ",a.error):arcgisonline.map.main.oAuthInfo=b.mixin(a,{token:a.access_token})},redirectToCustomURL:function(a,b){var c=esriGeowConfig.self,d=document.location.href;a?d=esriGeowConfig.baseUrl+esriGeowConfig.webmapViewerPath+"?webmap\x3d"+a:-1<d.indexOf("useExisting\x3d1")&&
(a=arcgisonline.map.save_open.webMapInfo?arcgisonline.map.save_open.webMapInfo.id:null)&&(d=esriGeowConfig.baseUrl+esriGeowConfig.webmapViewerPath+"?webmap\x3d"+a);var f=arcgisonline.sharing.util.parseUrl(d).host;if(!c.isPortal&&(f===c.portalHostname||c.urlKey&&c.customBaseUrl&&f!==c.urlKey+"."+c.customBaseUrl||!c.urlKey&&f!==c.portalHostname))c.urlKey&&c.customBaseUrl?-1===f.indexOf(c.urlKey+"."+c.customBaseUrl)&&(arcgisonline.map.storage.deleteMapStorageNoFeedback(),d=d.replace(f,c.urlKey+"."+c.customBaseUrl)):
c.urlKey||(arcgisonline.map.storage.deleteMapStorageNoFeedback(),d=d.replace(f,c.portalHostname));d=c.allSSL?d.replace("http:","https:"):d;d!==document.location.href&&(arcgisonline.sharing.util.parseUrl(d).host!==arcgisonline.sharing.util.parseUrl(document.location.href).host?window.location=arcgisonline.sharing.util.getBridgeUrl(d,arcgisonline.sharing.util.getCookie("esri_auth")):"undefined"!==typeof history.pushState?window.history.pushState(null,null,d):window.location.href!==d&&(window.location=
arcgisonline.sharing.util.getBridgeUrl(d,arcgisonline.sharing.util.getCookie("esri_auth"))))},linkToMap:function(a){if(null==arcgisonline.map.save_open.webMapInfo){var e=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();e.show({title:esri.i18nBundle.sharingDlg.sharingDlgTitle,message:esri.i18nBundle.viewer.error.cantShare})}else{var c=!1;arcgisonline.map.main.mapLayers[0].layer instanceof esri.virtualearth.VETiledLayer&&(c=!0);var d=!1;arcgisonline.map.save_open.openedWebMap&&
(arcgisonline.map.save_open.openedWebMap.presentation&&arcgisonline.map.save_open.openedWebMap.presentation.slides&&0<arcgisonline.map.save_open.openedWebMap.presentation.slides.length)&&(d=!0);var f=!1;b.forEach(arcgisonline.map.main.mapLayers,function(a){if(a.itemCard&&(-1<b.indexOf(a.itemCard.typeKeywords,"Requires Credits")||-1<b.indexOf(a.itemCard.typeKeywords,"Requires Subscription")))f=!0});e=arcgisonline.sharing.util.getUser();!e||arcgisonline.map.save_open.webMapInfo.owner!==e.email&&"admin"!==
arcgisonline.map.save_open.webMapInfo.itemControl&&"update"!==arcgisonline.map.save_open.webMapInfo.itemControl?(e=arcgisonline.sharing.dijit.dialog.ShareMapDlg.prototype.statics.getInstance(),e.show(arcgisonline.map.save_open.webMapInfo.id,arcgisonline.map.save_open.webMapInfo.owner,arcgisonline.map.save_open.folderId,arcgisonline.map.save_open.webMapInfo.title,c,d,a,f)):null==arcgisonline.map.save_open.folderTitle?arcgisonline.map.storage.getItemFolder(b.hitch(this,function(b,e){arcgisonline.sharing.dijit.dialog.ShareMapDlg.prototype.statics.getInstance().show(arcgisonline.map.save_open.webMapInfo.id,
arcgisonline.map.save_open.webMapInfo.owner,arcgisonline.map.save_open.folderId,arcgisonline.map.save_open.webMapInfo.title,c,d,a,f)})):(e=arcgisonline.sharing.dijit.dialog.ShareMapDlg.prototype.statics.getInstance(),e.show(arcgisonline.map.save_open.webMapInfo.id,arcgisonline.map.save_open.webMapInfo.owner,arcgisonline.map.save_open.folderId,arcgisonline.map.save_open.webMapInfo.title,c,d,a,f))}},projectToMapSpatialReference:function(a,b,c){var d=arcgisonline.map.main.map.spatialReference;null==
d&&(d=arcgisonline.map.main.defaultExtent.spatialReference);arcgisonline.map.main.projectExtent(a,d,b,c)},projectWrapAroundExtent:function(a,b,c,d){var f=a.spatialReference.wkid,g=b.wkid;(!f&&!g||f===g)&&arcgisonline.map.main.doProject(a,b,c,d);var h=f&&4326==f,l=g&&4326==g,m=[102113,102100,3857],f=f&&arcgisonline.map.main.contains(m,f),g=g&&arcgisonline.map.main.contains(m,g);!h&&!f&&(l||g)?arcgisonline.map.main.doProjectWrapAround(a,b,c,d):arcgisonline.map.main.doProject(a,b,c,d)},doProjectWrapAround:function(a,
b,c,d){arcgisonline.map.main.geometryService||(arcgisonline.map.main.geometryService=new esri.tasks.GeometryService(esriGeowConfig.self.helperServices.geometry.url));var f=new esri.geometry.Polygon(a.spatialReference.toJson());f.addRing([[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]);arcgisonline.map.main.geometryService.project([f],b,function(a,b){var e=a[0];if(e.rings&&2!==e.rings.length)c([e.getExtent()],b);else if(e.rings&&2==e.rings.length){var f=new esri.geometry.Polygon(e.toJson());
e.removeRing(1);f.removeRing(0);e=e.getExtent();f=f.getExtent();e.getWidth()>f.getWidth()?(e.xmin<f.xmin?e.xmin-=f.getWidth():e.xmax+=f.getWidth(),c([e],b)):(f.xmin<e.xmin?f.xmin-=e.getWidth():f.xmax+=e.getWidth(),c([f],b))}else d&&d()},d)},projectExtent:function(a,b,c,d){arcgisonline.map.main.doProject(a,b,c,d)},projectPointToMapSpatialReference:function(a,b,c,d,f){var g=arcgisonline.map.main.map.spatialReference;null==g&&(g=arcgisonline.map.main.defaultExtent.spatialReference);a=new esri.geometry.Point(a,
b,c);arcgisonline.map.main.doProject(a,g,d,f)},doProject:function(a,b,c,d){var f=[102113,102100,3857];if(a.spatialReference.wkid===b.wkid)c([a],null);else if(null!=a.spatialReference.wkid&&4326==a.spatialReference.wkid&&null!=b.wkid&&arcgisonline.map.main.contains(f,b.wkid)){a.ymin=Math.max(a.ymin,-89.99);a.ymax=Math.min(a.ymax,89.99);a=esri.geometry.geographicToWebMercator(a);if((f=a.spatialReference._getInfo())&&a.xmin>a.xmax){var g=f.valid[1]-a.xmin,h=a.xmax-f.valid[0];g>h?a.xmax=f.valid[1]+h:
a.xmin=f.valid[0]-g}a.spatialReference.wkid=b.wkid;c([a],null)}else if(null!=a.spatialReference.wkid&&arcgisonline.map.main.contains(f,a.spatialReference.wkid)&&null!=b.wkid&&4326==b.wkid){a=esri.geometry.webMercatorToGeographic(a);if((f=a.spatialReference._getInfo())&&a.xmin>a.xmax)g=f.valid[1]-a.xmin,h=a.xmax-f.valid[0],g>h?a.xmax=f.valid[1]+h:a.xmin=f.valid[0]-g;c([a],null)}else{arcgisonline.map.main.geometryService||(arcgisonline.map.main.geometryService=new esri.tasks.GeometryService(esriGeowConfig.self.helperServices.geometry.url));
var l;arcgisonline.map.main.map&&(arcgisonline.map.main.map.wrapAround180&&"extent"===a.type)&&(l=a,a=esri.geometry.Polygon.fromExtent(a));arcgisonline.map.main.geometryService.project([a],b,function(a,b){if(a&&0<a.length&&a[0]&&"extent"==a[0].type&&!isNaN(a[0].xmin)&&!isNaN(a[0].ymin)&&!isNaN(a[0].xmax)&&!isNaN(a[0].ymax))c(a,b);else if(a&&0<a.length&&a[0]&&"point"==a[0].type&&!isNaN(a[0].x)&&!isNaN(a[0].y))c(a,b);else if(l&&"polygon"===a[0].type){if(1===a[0].rings.length)a[0]=new esri.geometry.Extent(a[0].getExtent());
else{var e=(new esri.geometry.Polygon(a[0].spatialReference.toJson())).addRing(a[0].rings[0]).getExtent(),f=(new esri.geometry.Polygon(a[0].spatialReference.toJson())).addRing(a[0].rings[1]).getExtent();a[0]=f;a[0].xmin=f.xmin-e.getWidth();a[0].ymin=Math.min(f.ymin,e.ymin);a[0].ymax=Math.max(f.ymax,e.ymax)}c(a,b)}else d&&d()},d)}},projectJsonGeometries:function(a,e,c,d,f,g){0===a.length&&f(null);var h=esri.geometry.getGeometryType(e),l=[];b.forEach(a,function(a){a=new h(a);a.spatialReference=c;l.push(a)},
this);e=[102113,102100,3857];c.wkid&&4326==c.wkid&&d.wkid&&arcgisonline.map.main.contains(e,d.wkid)?(b.forEach(l,function(a){a.xmin?(a.xmin=Math.max(a.xmin,-180),a.xmax=Math.min(a.xmax,180),a.ymin=Math.max(a.ymin,-89.99),a.ymax=Math.min(a.ymax,89.99)):a.rings?b.forEach(a.rings,function(a){b.forEach(a,function(a){a[0]=Math.min(Math.max(a[0],-180),180);a[1]=Math.min(Math.max(a[1],-89.99),89.99)},this)},this):a.paths?b.forEach(a.paths,function(a){b.forEach(a,function(a){a[0]=Math.min(Math.max(a[0],-180),
180);a[1]=Math.min(Math.max(a[1],-89.99),89.99)},this)},this):a.x&&(a.x=Math.min(Math.max(a.x,-180),180),a.y=Math.min(Math.max(a.y,-89.99),89.99))},this),a=[],b.forEach(l,function(b){b=esri.geometry.geographicToWebMercator(b);102100!==d.wkid&&(b.spatialReference=d);a.push(b.toJson())},this),f(a)):null!=c.wkid&&arcgisonline.map.main.contains(e,c.wkid)&&null!=d.wkid&&4326==d.wkid?(a=[],b.forEach(l,function(b){a.push(esri.geometry.webMercatorToGeographic(b).toJson())},this),f(a)):(arcgisonline.map.main.geometryService||
(arcgisonline.map.main.geometryService=new esri.tasks.GeometryService(esriGeowConfig.self.helperServices.geometry.url)),arcgisonline.map.main.geometryService.project(l,d,b.hitch(this,function(e,c){e&&e.length===a.length?(a=[],b.forEach(e,function(b){b&&(b.rings&&0<b.rings.length&&0<b.rings[0].length&&0<b.rings[0][0].length&&!isNaN(b.rings[0][0][0])&&!isNaN(b.rings[0][0][1])||b.paths&&0<b.paths.length&&0<b.paths[0].length&&0<b.paths[0][0].length&&!isNaN(b.paths[0][0][0])&&!isNaN(b.paths[0][0][1])||
b.xmin&&!isNaN(b.xmin)&&b.ymin&&!isNaN(b.ymin)||b.x&&!isNaN(b.x)&&b.y&&!isNaN(b.y))?a.push(b.toJson()):a.push(null)},this),f(a)):g&&g(e,c)}),g))},projectGeometries:function(a,e,c,d,f){if(0===a.length)if(d)d(null);else return null;var g=[102113,102100,3857];if(e.wkid&&4326==e.wkid&&c.wkid&&arcgisonline.map.main.contains(g,c.wkid)){b.forEach(a,function(a){a.xmin?(a.xmin=Math.max(a.xmin,-180),a.xmax=Math.min(a.xmax,180),a.ymin=Math.max(a.ymin,-89.99),a.ymax=Math.min(a.ymax,89.99)):a.rings?b.forEach(a.rings,
function(a){b.forEach(a,function(a){a[0]=Math.min(Math.max(a[0],-180),180);a[1]=Math.min(Math.max(a[1],-89.99),89.99)},this)},this):a.paths?b.forEach(a.paths,function(a){b.forEach(a,function(a){a[0]=Math.min(Math.max(a[0],-180),180);a[1]=Math.min(Math.max(a[1],-89.99),89.99)},this)},this):a.x&&(a.x=Math.min(Math.max(a.x,-180),180),a.y=Math.min(Math.max(a.y,-89.99),89.99))},this);var h=[];b.forEach(a,function(a){a=esri.geometry.geographicToWebMercator(a);102100!==c.wkid&&(a.spatialReference=c);h.push(a)},
this);if(d)d(h);else return h}else if(null!=e.wkid&&arcgisonline.map.main.contains(g,e.wkid)&&null!=c.wkid&&4326==c.wkid)if(h=[],b.forEach(a,function(a){h.push(esri.geometry.webMercatorToGeographic(a))},this),d)d(h);else return h;else arcgisonline.map.main.geometryService||(arcgisonline.map.main.geometryService=new esri.tasks.GeometryService(esriGeowConfig.self.helperServices.geometry.url)),arcgisonline.map.main.geometryService.project(a,c,b.hitch(this,function(a,e,c){if(e&&e.length===a.length){var g=
[];b.forEach(e,function(a){a&&(a.rings&&0<a.rings.length&&0<a.rings[0].length&&0<a.rings[0][0].length&&!isNaN(a.rings[0][0][0])&&!isNaN(a.rings[0][0][1])||a.paths&&0<a.paths.length&&0<a.paths[0].length&&0<a.paths[0][0].length&&!isNaN(a.paths[0][0][0])&&!isNaN(a.paths[0][0][1])||a.xmin&&!isNaN(a.xmin)&&a.ymin&&!isNaN(a.ymin)||a.x&&!isNaN(a.x)&&a.y&&!isNaN(a.y))?g.push(a):g.push(null)},this);d&&d(g)}else f&&f&&f(e,c)},a),f)},clipOnHorizon:function(a){arcgisonline.map.main.contains([102113,102100,3857],
a.spatialReference.wkid)&&(a.xmin=Math.max(a.xmin,-20037507),a.xmax=Math.min(a.xmax,20037507),a.ymin=Math.max(a.ymin,-19971868),a.ymax=Math.min(a.ymax,19971868));return a},sameSpatialReference:function(a,b){var c=[102113,102100,3857];return a&&b&&a.wkt==b.wkt&&(a.wkid==b.wkid||esri.isDefined(a.latestWkid)&&a.latestWkid==b.wkid||esri.isDefined(b.latestWkid)&&a.wkid==b.latestWkid||esri.isDefined(a.latestWkid)&&a.latestWkid==b.latestWkid)||a&&b&&a.wkid&&b.wkid&&arcgisonline.map.main.contains(c,a.wkid)&&
arcgisonline.map.main.contains(c,b.wkid)?!0:!1},sameTilingScheme:function(a,b){for(var c=arcgisonline.map.main.map,c=c.width>c.height?c.width:c.height,d=!1,f=!1,g=0;g<a.lods.length;g++){var h=a.lods[g].scale;a.dpi!==b.dpi&&(h=a.lods[g].scale/a.dpi);for(var l=0;l<b.lods.length;l++){var m=b.lods[l].scale;a.dpi!==b.dpi&&(m=b.lods[l].scale/b.dpi);if(Math.abs(m-h)/m<1/c)if(d){f=!0;break}else d=!0}if(f)break}return f||d&&(1===a.lods.length||1===b.lods.length)?!0:!1},sameTilingSchemeUseResolution:function(a,
b){for(var c=arcgisonline.map.main.map,c=c.width>c.height?c.width:c.height,d=!1,f=!1,g=0;g<a.lods.length;g++){for(var h=a.lods[g].resolution,l=0;l<b.lods.length;l++){var m=b.lods[l].resolution;if(Math.abs(m-h)/m<1/c)if(d){f=!0;break}else d=!0}if(f)break}return f||d&&(1===a.lods.length||1===b.lods.length)?!0:!1},checkMapSpatialReference:function(){var a=!1,e=!1,c;arcgisonline.map.main.map?c=arcgisonline.map.main.map.spatialReference:(c=new esri.SpatialReference({wkid:102100}),(a=esriGeowConfig.defaultBasemap.baseMapLayers)&&
(a.resourceInfo&&a.resourceInfo.spatialReference)&&(c=new esri.SpatialReference(a.resourceInfo.spatialReference)));a=b.some(arcgisonline.map.wms._WEB_MERCATOR,function(a){return a===c.wkid});e=4326===c.wkid;return{mapIsWebMercator:a,mapIsGCS:e,mapSR:c}},updateTilingScheme:function(a,b){if(a.dpi===b)return a;for(var c=0;c<a.lods.length;c++)a.lods[c].scale=a.lods[c].scale/a.dpi*b;a.dpi=b;return a},markMapAsChanged:function(a){arcgisonline.map.main.mapHasChanged=!0},markMapAsChangedIfOwner:function(a){a=
arcgisonline.sharing.util.getUser();var b=arcgisonline.map.save_open.webMapInfo;if(a&&b&&(b.owner===a.email||"admin"===b.itemControl||"update"===b.itemControl))arcgisonline.map.main.mapHasChanged=!0},unmarkMapAsChanged:function(){arcgisonline.map.main.mapHasChanged=!1},signIn:function(a){a&&a.preventDefault();arcgisonline.map.storage.saveMapInCookie(null,!0,null,null,function(){arcgisonline.map.main.signInWithPopup()})},loggedOut:function(){var a=arcgisonline.sharing.util.getUser();a&&esri.isDefined(a.auth_tier)&&
"web"===a.auth_tier||!a&&b.cookie("esri_auth_guest")&&"7443"!==location.port||(b.removeClass(b.byId("logged-out-navigation"),"hide"),b.addClass(b.byId("logged-in-navigation"),"hide"),b.attr(b.byId("login-link"),"href","JavaScript:arcgisonline.map.main.signIn();"),b.query(".menu-logged-in",this.domNode).style("display","none"))},loggedIn:function(){var a=arcgisonline.sharing.util.getUser();if(!a||!(esri.isDefined(a.auth_tier)&&"web"===a.auth_tier))arcgisonline.sharing.util.isLoggedIn()?((a=arcgisonline.sharing.util.getUser())?
(b.addClass(b.byId("logged-out-navigation"),"hide"),b.removeClass(b.byId("logged-in-navigation"),"hide"),b.attr(b.byId("username"),"innerHTML",arcgisonline.sharing.util.getUserDisplayName(a)),b.attr(b.byId("username"),"title",a.fullName),b.byId("logged-in-myProfile").innerHTML=esri.i18nBundle.siteHeader.myProfile+"\x3cbr/\x3e"+a.username,b.attr("logged-in-myProfile","title",a.fullName),a=this.allSSL||arcgisonline.sharing.util.usePortalSSL()?arcgisonline.sharing.util.getSecureUrl(esriGeowConfig.restBaseUrl):
esriGeowConfig.restBaseUrl,a=esriGeowConfig.userInfo.thumbnail?a+"community/users/"+esriGeowConfig.userInfo.username+"/info/"+esriGeowConfig.userInfo.thumbnail+"?token\x3d"+esriGeowConfig.userInfo.token:arcgisonline.sharing.util.relativeToExplicitUrl("js/arcgisonline/css/images/no-user-thumb.jpg"),b.attr("dropdown-image","src",a),b.attr("profileImgSmall","src",a),b.query(".menu-logged-in").style("visibility","visible")):arcgisonline.map.main.loggedOut(),arcgisonline.map.main.checkTitleDiv()):arcgisonline.map.main.loggedOut()},
logOut:function(){arcgisonline.sharing.geow.Geow.signout(esriGeowConfig.baseUrl+"index.html")},openHelp:function(){window.open(esriGeowConfig.help,"_blank")},openAdminHelp:function(){window.open(esriGeowConfig.help.replace("/website/","/admin/"),"_blank")},openNewMap:function(a){a&&a.preventDefault();a=esriGeowConfig.baseUrl+"webmap/viewer.html";!0==arcgisonline.map.main.mapHasChanged?arcgisonline.sharing.dijit.dialog.OpenMapDlg.prototype.statics.getInstance().show(a,null,arcgisonline.map.main.mapLayers,
arcgisonline.map.main.mapTables,arcgisonline.map.save_open.webMapInfo?arcgisonline.map.save_open.webMapInfo.title:null):window.location=a},openMap:function(a){a&&a.preventDefault();a=esriGeowConfig.baseUrl+"webmap/viewer.html";!0==arcgisonline.map.main.mapHasChanged?arcgisonline.sharing.dijit.dialog.OpenMapDlg.prototype.statics.getInstance().show(a,null,arcgisonline.map.main.mapLayers,arcgisonline.map.main.mapTables,arcgisonline.map.save_open.webMapInfo?arcgisonline.map.save_open.webMapInfo.title:
null):window.location=a},goToPage:function(a){arcgisonline.map.edit.editActivated&&arcgisonline.map.edit.stopEdit();arcgisonline.map.storage.saveMapInCookie(null,!0,null,null,b.hitch(this,function(){"undefined"!==typeof history.pushState&&window.history.pushState(null,null,"?useExisting\x3d1");window.location=a}))},updateHeaderPresentationLink:function(){b.style(b.byId("header_map_presentation"),"display","none");var a=arcgisonline.map.save_open.openedWebMap,e=arcgisonline.map.save_open.webMapInfo,
c=arcgisonline.sharing.util.getUser();if(a&&e&&c){var d=!1;a.presentation&&(a.presentation.slides&&0<a.presentation.slides.length)&&(d=!0);a=!1;e.owner===c.email&&(a=!0);d?(a?(b.byId("presentationLabel").innerHTML=esri.i18nBundle.siteHeader.editPresentation,e=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/apps/presentation/index.html?webmap\x3d"+e.id+"\x26builder",b.connect(b.byId("webmap-presentation"),"onclick",b.hitch(this,function(a,b){b&&b.preventDefault();
!0==arcgisonline.map.main.mapHasChanged?arcgisonline.sharing.dijit.dialog.OpenPresentationDlg.prototype.statics.getInstance().show(a):window.location=a},e))):(b.byId("presentationLabel").innerHTML=esri.i18nBundle.siteHeader.viewPresentation,e=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/apps/presentation/index.html?webmap\x3d"+e.id,b.byId("webmap-presentation").href="#",b.connect(b.byId("webmap-presentation"),"onclick",b.hitch(this,function(a,
b){b&&b.preventDefault();window.open(a)},e))),b.style(b.byId("header_map_presentation"),"display","")):arcgisonline.map.role.isAllowed("about_savePresentation")&&a&&(b.byId("presentationLabel").innerHTML=esri.i18nBundle.siteHeader.createPresentation,e=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/apps/presentation/index.html?webmap\x3d"+e.id+"\x26builder",b.connect(b.byId("webmap-presentation"),"onclick",b.hitch(this,function(a,b){b&&b.preventDefault();
!0==arcgisonline.map.main.mapHasChanged?arcgisonline.sharing.dijit.dialog.OpenPresentationDlg.prototype.statics.getInstance().show(a):window.location=a},e)),b.style(b.byId("header_map_presentation"),"display",""))}arcgisonline.map.main.updateRecentWebMaps()},checkMinWidthOfPage:function(){n.byId("webmap-save").set("label",esri.i18nBundle.viewer.saveBtn);n.byId("webmap-print").set("label",esri.i18nBundle.viewer.printBtn);n.byId("webmap-print-templates").set("label",esri.i18nBundle.viewer.printBtn);
n.byId("webmap-measure").set("label",esri.i18nBundle.viewer.measureBtn);n.byId("webmap-bookmarks").set("label",esri.i18nBundle.viewer.bookmarksBtn);n.byId("webmap-directions").set("label",esri.i18nBundle.viewer.directionsBtn);n.byId("webmap-share").set("label",esri.i18nBundle.viewer.shareBtn);n.byId("webmap-basemap").set("label",esri.i18nBundle.viewer.basemapBtn);n.byId("webmap-add").set("label",esri.i18nBundle.viewer.addBtn);n.byId("webmap-details").set("label",esri.i18nBundle.viewer.detailsBtn);
n.byId("webmap-edit").set("label",esri.i18nBundle.viewer.editBtn);n.byId("webmap-analysis").set("label",esri.i18nBundle.viewer.analysisBtn);if(!b.isIE||9<=b.isIE)b.byId("webmap-save_label").style.removeProperty("padding"),b.byId("webmap-add_label").style.removeProperty("padding"),b.byId("webmap-print-templates_label").style.removeProperty("padding");var a=function(){var a=b.coords(b.byId("webmap-toolbar-leftCorner")).w,c=b.coords(b.byId("webmap-toolbar-rightCorner")).w,e=b.coords(b.byId("webmap-toolbar-right")).w,
d=b.coords(b.byId("webmap-toolbar-left")).w,f=b.style(b.byId("webmap-save"),"width"),s=b.style(b.byId("webmap-share"),"width"),r;r="none"!==b.style(n.byId("webmap-print").domNode,"display")?b.style(b.byId("webmap-print"),"width"):b.style(b.byId("webmap-print-templates"),"width");var q=b.style(b.byId("webmap-directions"),"width"),t=b.style(b.byId("webmap-measure"),"width"),w=b.style(b.byId("webmap-bookmarks"),"width"),f=f+s+r+q+t+w+75,s=b.style(b.byId("toolbar"),"left");r=0;"auto"!==b.style(b.byId("toolbar"),
"right")&&(r=parseInt(b.style(b.byId("toolbar"),"right")));a=Math.max(400,s+a+d+f+e+c+r);return a+15},e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||600,c=56;arcgisonline.map.geocode.geocoder&&(arcgisonline.map.geocode.geocoder.sources&&1<arcgisonline.map.geocode.geocoder.sources.length)&&(c+=26);if(b.query(".searchGroup").length){var d=250,f=b.query(".searchGroup")[0];b.style(b.query(".searchGroup input")[0],"width",d-c+"px");b.style(f,"width",d+"px");b.style(b.query(".webmapToolbarRight")[0],
"width",d+10+"px");f.style.display="none";f.offsetHeight;f.style.display="block"}d=function(a){9>b.isIE&&(a=b.create("div",{innerHTML:"x",style:"visibility: hidden; height: 1px;"}),b.place(a,"webmap-toolbar-center","first"),setTimeout(b.hitch(this,function(a){b.byId("webmap-toolbar-center").removeChild(a)},a),1))};f=a();e<f&&("none"!==b.style(n.byId("webmap-print").domNode,"display")?(n.byId("webmap-print").set("label",""),d("webmap-print")):(n.byId("webmap-print-templates").set("label",""),b.style(b.byId("webmap-print-templates_label"),
"padding",0),d("webmap-print-templates")),f=a(),e<f&&(n.byId("webmap-save").set("label",""),b.style(b.byId("webmap-save_label"),"padding",0),d("webmap-save"),f=a(),e<f&&(n.byId("webmap-measure").set("label",""),d("webmap-measure"),f=a(),e<f&&(n.byId("webmap-bookmarks").set("label",""),d("webmap-bookmarks"),f=a(),e<f&&(n.byId("webmap-directions").set("label",""),d("webmap-directions"),f=a(),e<f&&(n.byId("webmap-share").set("label",""),d("webmap-share"),f=a(),e<f&&(n.byId("webmap-basemap").set("label",
""),d("webmap-basemap"),f=a(),e<f&&(n.byId("webmap-add").set("label",""),b.style(b.byId("webmap-add_label"),"padding",0),d("webmap-add"),f=a(),e<f&&(n.byId("webmap-details").set("label",""),d("webmap-details"),f=a(),e<f&&(n.byId("webmap-edit").set("label",""),d("webmap-edit"),f=a(),e<f&&(n.byId("webmap-analysis").set("label",""),d("webmap-analysis"),f=a())))))))))));b.query(".searchGroup").length&&(d=250,150<e-f?d=400:100<e-f?d=350:50<e-f&&(d=300),b.style(b.query(".searchGroup input")[0],"width",
d-c+"px"),b.style(b.query(".searchGroup")[0],"width",d+"px"),b.style(b.query(".webmapToolbarRight")[0],"width",d+10+"px"),f=a());b.style(b.byId("page-border"),"minWidth")!=f&&b.style(b.byId("page-border"),"minWidth",f+"px");b.style(b.byId("webmap-toolbar-center"),"visibility","visible");arcgisonline.map.leftPanel.calculateLeftPanelDefaultWidth();b.style(b.byId("main-content"),"width",e+"px");n.byId("page-border").resize();arcgisonline.map.main.checkTitleDiv()},checkUnsupportedRendererType:function(a){var e=
{type:"simple",symbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:0.75,type:"esriSLS",style:"esriSLSSolid"}}};if(9>b.isIE)if(a.layerDefinition&&a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&"heatmap"===a.layerDefinition.drawingInfo.renderer.type)console.log("IE8 does not support heatmap renderer"),a.layerDefinition.drawingInfo.renderer=e;else if((!a.layerDefinition||!a.layerDefinition.drawingInfo||
!a.layerDefinition.drawingInfo.renderer)&&a.serviceInfo&&a.serviceInfo.drawingInfo&&a.serviceInfo.drawingInfo.renderer&&"heatmap"===a.serviceInfo.drawingInfo.renderer.type)a.serviceInfo.drawingInfo.renderer=e,console.log("IE8 does not support heatmap renderer")},isNewRendererType_2_1:function(a){return a.layer&&a.layer.renderer&&(a=a.layer.renderer,"esri.renderer.HeatmapRenderer"==a.declaredClass||a.visualVariables)?"esri.renderer.HeatmapRenderer"!==a.declaredClass&&1===a.visualVariables.length&&
"sizeInfo"===a.visualVariables[0].type&&"outline"===a.visualVariables[0].target?!1:!0:!1},reloadViewerSecureIdMgr:function(a){arcgisonline.map.main.reloadViewerSecure(a.resourceUrl,esri.i18nBundle.viewer.main.reloadForSSLLogin)},reloadViewerSecureSSL:function(a){arcgisonline.map.main.reloadViewerSecure(a,esri.i18nBundle.viewer.main.reloadForSSL)},reloadViewerSecure:function(a,e){if(arcgisonline.map.main.mapHasChanged){var c=function(){window.location=esriGeowConfig.baseUrl.replace("http://","https://")+
esriGeowConfig.webmapViewerPath+"?useExisting\x3d1"},d=function(){arcgisonline.map.storage.saveMapInCookie(null,!0,null,null,b.hitch(this,c))},f=arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance();f.show({title:esri.i18nBundle.viewer.main.reload,message:e,choiceOneTitle:esri.i18nBundle.common.yesLabel,choiceOneHandler:b.hitch(this,d),choiceTwoTitle:esri.i18nBundle.common.noLabel,choiceTwoHandler:function(){}})}else d=arcgisonline.sharing.util.urlToObject(document.URL),d.query=
d.query||{},d.query.webmap||d.query.layers||d.query.services||d.query.featurecollection||d.query.url||d.query.urls||d.query.basemapUrl?window.location=window.location.href.replace("http://","https://"):(d=function(){window.location=document.URL.replace("http://","https://")},f=arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance(),f.show({title:esri.i18nBundle.viewer.main.reload,message:e,choiceOneTitle:esri.i18nBundle.common.yesLabel,choiceOneHandler:b.hitch(this,d),choiceTwoTitle:esri.i18nBundle.common.noLabel,
choiceTwoHandler:function(){}}))},showBasemapGallery:function(){arcgisonline.map.main.hideDropdowns("basemapGallery");n.byId("basemap-gallery").groupQuery=esriGeowConfig.basemapGalleryGroupQuery;n.byId("basemap-gallery").open()},showMeasureTool:function(){arcgisonline.map.popup.disablePopupHandler();b.byId("measureToolDiv")||b.place(b.create("div",{id:"measureToolDiv"}),"measureDiv","last");if("block"==b.style(b.byId("measureDiv"),"display"))arcgisonline.map.main.hideMeasureTool();else{arcgisonline.map.main.hideDropdowns();
arcgisonline.map.main.map.infoWindow.hide();var a=b.coords(b.byId("webmap-measure"));esriGeowConfig.isRightToLeft?b.style(b.byId("measureDiv"),"left",a.x+a.w-318+"px"):b.style(b.byId("measureDiv"),"left",a.x-4+"px");b.style(b.byId("measureDiv"),"display","block");b.style(b.byId("measureDiv"),"top",a.y+a.h+1+"px");arcgisonline.map.main.measureTool||(a=esri.symbol.fromJson({name:"Circle",type:"esriSMS",style:"esriSMSCircle",color:[255,255,255,204],size:6,outline:{color:[102,102,102,255],width:1}}),
arcgisonline.map.main.measureTool=new esri.dijit.Measurement({map:arcgisonline.map.main.map,id:"measureTool",pointSymbol:a,defaultAreaUnit:"english"===arcgisonline.map.main.scaleBarUnits?esri.Units.SQUARE_MILES:esri.Units.SQUARE_KILOMETERS,defaultLengthUnit:"english"===arcgisonline.map.main.scaleBarUnits?esri.Units.MILES:esri.Units.KILOMETERS},"measureToolDiv"),arcgisonline.map.main.measureTool.startup());arcgisonline.map.main.measureTool.setTool("area",!0);arcgisonline.map.main.measureActivated=
!0;arcgisonline.map.geocodeReview.geocodeMatchWidget&&arcgisonline.map.geocodeReview.geocodeMatchWidget.pauseMapEvents();arcgisonline.map.main.map.activeDirectionsWidget&&arcgisonline.map.main.map.activeDirectionsWidget.active?(arcgisonline.map.main.activeDirectionsWidgetIsActive=!0,arcgisonline.map.main.map.activeDirectionsWidget.deactivate()):arcgisonline.map.main.activeDirectionsWidgetIsActive=!1}},hideMeasureTool:function(a){arcgisonline.map.main.measureTool&&(arcgisonline.map.main.measureTool.clearResult(),
b.style(b.byId("measureDiv"),"display","none"),arcgisonline.map.main.measureTool.activeTool&&arcgisonline.map.main.measureTool.setTool(arcgisonline.map.main.measureTool.activeTool,!1),arcgisonline.map.main.measureActivated=!1,arcgisonline.map.popup.setupPopupHandler(),arcgisonline.map.geocodeReview.geocodeMatchWidget&&"geocodeStack"===arcgisonline.map.leftPanel.getLeftContentPanelStack()&&arcgisonline.map.geocodeReview.geocodeMatchWidget.resumeMapEvents(),arcgisonline.map.main.map.activeDirectionsWidget&&
("directionsStack"==arcgisonline.map.leftPanel.getLeftContentPanelStack()&&arcgisonline.map.main.activeDirectionsWidgetIsActive)&&arcgisonline.map.main.map.activeDirectionsWidget.activate(),("closeIcon"===a||"onOtherOpen"===a)&&n.byId("webmap-measure").set("checked",!1))},destroyMeasureTool:function(a){arcgisonline.map.main.measureTool&&(arcgisonline.map.main.measureTool.destroy(),arcgisonline.map.main.measureTool=null)},initBookmarks:function(){if(!arcgisonline.map.main.bookmarksTool){var a=[];arcgisonline.map.save_open.openedWebMap&&
arcgisonline.map.save_open.openedWebMap.bookmarks&&(a=arcgisonline.map.save_open.openedWebMap.bookmarks);arcgisonline.map.main.bookmarksTool=new esri.dijit.Bookmarks({map:arcgisonline.map.main.map,bookmarks:a,editable:!0,id:"bookmarksTool"},"bookmarksToolDiv");arcgisonline.map.role.checkBookmarksToolOptions();b.connect(arcgisonline.map.main.bookmarksTool,"onClick",b.hitch(this,arcgisonline.map.main.hideBookmarksTool,"onBookmarkClick"));b.connect(arcgisonline.map.main.bookmarksTool,"onEdit",function(){arcgisonline.map.main.markMapAsChanged("onBookmarkEdit")});
b.connect(arcgisonline.map.main.bookmarksTool,"onRemove",function(){arcgisonline.map.main.markMapAsChanged("onBookmarkRemove")})}},showBookmarksTool:function(){if("block"==b.style(b.byId("bookmarksDiv"),"display"))arcgisonline.map.main.hideBookmarksTool();else{arcgisonline.map.main.hideDropdowns();var a=b.coords(b.byId("webmap-bookmarks"));esriGeowConfig.isRightToLeft?b.style(b.byId("bookmarksDiv"),"left",a.x+a.w-242+"px"):b.style(b.byId("bookmarksDiv"),"left",a.x-4+"px");b.style(b.byId("bookmarksDiv"),
"display","block");b.style(b.byId("bookmarksDiv"),"top",a.y+a.h+1+"px")}},hideBookmarksTool:function(a){b.style(b.byId("bookmarksDiv"),"display","none");("closeIcon"===a||"onBookmarkClick"===a||"onOtherOpen"===a)&&n.byId("webmap-bookmarks").set("checked",!1)},projectBookmarks:function(){if(arcgisonline.map.main.bookmarksTool&&0<arcgisonline.map.main.bookmarksTool.bookmarks.length){var a=arcgisonline.map.main.map.extent.spatialReference,e=arcgisonline.map.main.bookmarksTool.bookmarks[0].extent.spatialReference;
if(!arcgisonline.map.main.sameSpatialReference(a,e)){var c=function(a){var c=[];b.forEach(arcgisonline.map.main.bookmarksTool.bookmarks,function(b,e){if(null!==a[e]){var d=new esri.dijit.BookmarkItem({name:b.name,extent:a[e]});c.push(d)}});for(var e=arcgisonline.map.main.bookmarksTool.bookmarks.length-1;0<=e;e--){var d=arcgisonline.map.main.bookmarksTool.bookmarks[e];d&&arcgisonline.map.main.bookmarksTool.removeBookmark(d.name)}b.forEach(c,function(a){arcgisonline.map.main.bookmarksTool.addBookmark(a)})},
d=function(a,b){console.log("error projecting bookmarks. Final try.")},f=[];b.forEach(arcgisonline.map.main.bookmarksTool.bookmarks,function(a){f.push(a.extent)});arcgisonline.map.main.projectGeometries(f,e,a,b.hitch(this,c),b.hitch(this,function(a,e,f,m,p){console.log("error projecting bookmarks. Try one more time.");arcgisonline.map.main.projectGeometries(a,e,f,b.hitch(this,c),b.hitch(this,d))},f,e,a))}}},hideDropdowns:function(a){"basemapGallery"!=a&&n.byId("basemap-gallery").hide();"block"==b.style(b.byId("bookmarksDiv"),
"display")&&arcgisonline.map.main.hideBookmarksTool("onOtherOpen");"block"==b.style(b.byId("measureDiv"),"display")&&arcgisonline.map.main.hideMeasureTool("onOtherOpen")},truncate:function(a){return Math.round(1E4*a)/1E4},getValue:function(a,b){var c=a.indexOf("\x26"+b+"\x3d",0);-1==c&&(c=a.indexOf("?"+b+"\x3d",0));if(-1==c)return-1;var d=a.indexOf("\x26",c+2);-1==d&&(d=a.length);return a.substring(c+b.length+2,d)},showObjectProperties:function(a){var b="",c;for(c in a)b+=c+":"+a[c]+"\n";alert(""+
b)},getGCSString:function(){var a=new b.Deferred,e=arcgisonline.map.main.map.extent;e.spatialReference._isWrappable()?esri.geometry.normalizeCentralMeridian([e],null,b.hitch(this,function(b){if(b[0].rings){var d=(new esri.geometry.Polygon(e.spatialReference)).addRing(b[0].rings[0]).getExtent();b=(new esri.geometry.Polygon(e.spatialReference)).addRing(b[0].rings[1]).getExtent();e=d.getWidth()>b.getWidth()?d:b}else e=b[0];arcgisonline.map.main.extentToGCSString(e,function(b){a.callback(b)})})):arcgisonline.map.main.mapExtentToGCSString(function(b){a.callback(b)});
return a},mapExtentToGCSString:function(a){arcgisonline.map.main.extentToGCSString(arcgisonline.map.main.map.extent,a)},extentToGCSString:function(a,e){arcgisonline.map.main.sameSpatialReference(a.spatialReference,new esri.SpatialReference({wkid:4326}))?e(arcgisonline.map.main.extentToString(a)):arcgisonline.map.main.projectExtent(a,new esri.SpatialReference({wkid:4326}),b.hitch(this,function(c,d){if(-180===c[0].xmin&&180===c[0].xmax){var f=arcgisonline.map.main.checkMapSpatialReference();if(!f.mapIsWebMercator&&
!f.mapIsGCS)if(a.spatialReference.wkid&&-1<b.indexOf([5936,3031],a.spatialReference.wkid))e(arcgisonline.map.main.extentToString(c[0]));else{var f=(c[0].ymin+c[0].ymax)/2,g=[];g.push(new esri.geometry.Point(-180,f,new esri.SpatialReference({wkid:4326})));g.push(new esri.geometry.Point(180,f,new esri.SpatialReference({wkid:4326})));var h=function(a,b){e(arcgisonline.map.main.extentToString(c[0]))};arcgisonline.map.main.projectJsonGeometries(g,"esriGeometryPoint",new esri.SpatialReference({wkid:4326}),
a.spatialReference,b.hitch(this,function(d,f){if(0.0010>Math.abs(d[0].x-d[1].x)){var p=d[0].x-arcgisonline.map.main.map.extent.xmin,n=arcgisonline.map.main.map.extent.xmax-d[0].x,r=(a.ymin+a.ymax)/2;g=[];g.push(new esri.geometry.Point(a.xmin,r,a.spatialReference));g.push(new esri.geometry.Point(a.xmax,r,a.spatialReference));arcgisonline.map.main.projectJsonGeometries(g,"esriGeometryPoint",a.spatialReference,new esri.SpatialReference({wkid:4326}),b.hitch(this,function(a,b){var d;d=p>n?new esri.geometry.Extent(a[0].x,
c[0].ymin,c[0].xmax,c[0].ymax,new esri.SpatialReference({wkid:4326})):new esri.geometry.Extent(c[0].xmin,c[0].ymin,a[1].x,c[0].ymax,new esri.SpatialReference({wkid:4326}));e(arcgisonline.map.main.extentToString(d))}),b.hitch(this,h))}else e(arcgisonline.map.main.extentToString(c[0]))}),b.hitch(this,h))}else e(arcgisonline.map.main.extentToString(c[0]))}else e(arcgisonline.map.main.extentToString(c[0]))}),b.hitch(this,function(a,b){e(null)}))},extentToString:function(a){return arcgisonline.map.main.extentToString2(a,
1E4)},extentToString2:function(a,b){return null!=a?arcgisonline.map.main.roundValue(a.xmin,b)+","+arcgisonline.map.main.roundValue(a.ymin,b)+","+arcgisonline.map.main.roundValue(a.xmax,b)+","+arcgisonline.map.main.roundValue(a.ymax,b):""},roundExtent:function(a,b){return new esri.geometry.Extent(arcgisonline.map.main.roundValue(a.xmin,b),arcgisonline.map.main.roundValue(a.ymin,b),arcgisonline.map.main.roundValue(a.xmax,b),arcgisonline.map.main.roundValue(a.ymax,b),new esri.SpatialReference(a.spatialReference.toJson()))},
buildExportCall:function(a,b,c,d,f,g,h,l,m){if(!l&&-1<a.indexOf("/MapServer/")){g=a.indexOf("/MapServer/");l=a.indexOf("?");if(-1<l){var p=a.substring(g+11,l);a=a.substring(0,g+10)+a.substring(l)}else p=a.substring(g+11),a=a.substring(0,g+10);l=p}p=-1<a.indexOf("/MapServer");!p&&m&&(p=m.capabilities?-1<m.capabilities.toLowerCase().indexOf("map"):m.supportedImageFormatTypes);g=a.indexOf("?");if(-1==g)if(p)a+="/export?";else{if("undefined"!==typeof m.currentVersion&&10.1<=m.currentVersion)return a+
"/info/thumbnail";a+="/exportImage?"}else if(p)a=a.substring(0,g)+"/export"+a.substring(g,a.length)+"\x26";else{if("undefined"!==typeof m.currentVersion&&10.1<=m.currentVersion)return a=a.substring(0,g)+"/info/thumbnail"+a.substring(g,a.length);a=a.substring(0,g)+"/exportImage"+a.substring(g,a.length)+"\x26"}a+="size\x3d"+f+"\x26bbox\x3d"+b;null!==c&&0<c.length&&(a+="\x26bboxSR\x3d"+c);null!==d&&0<d.length&&(a+="\x26imageSR\x3d"+d);a=p&&m&&m.supportedImageFormatTypes&&-1<m.supportedImageFormatTypes.indexOf("PNG32")?
a+("\x26format\x3dpng32\x26f\x3d"+h):p?a+("\x26format\x3dpng24\x26f\x3d"+h):a+("\x26format\x3djpgpng\x26f\x3d"+h);p?null!==l&&0<l.length&&(a+="\x26layers\x3dshow:"+l):a+="\x26interpolation\x3dRSP_NearestNeighbor\x26bandIds\x3dnull";return a},getPrintExtra:function(a,b,c,d){a=-1<a.indexOf("/MapServer");!a&&d&&(a=d.capabilities?-1<d.capabilities.toLowerCase().indexOf("map"):d.supportedImageFormatTypes);var f="";a?null!=c&&0<c.length&&(f+="\x26layers\x3dshow:"+c):(f+="\x26pixelType\x3dU8\x26interpolation\x3dRSP_NearestNeighbor",
null!=b?f+="\x26bandIds\x3d"+b.toString():d&&(d.bandCount&&3<parseInt(d.bandCount))&&(f+="\x26bandIds\x3d0,1,2"));return f},buildExportLayers:function(a){var b=a.layer.layerInfos;arcgisonline.map.main.hasDynamicLayers(a)&&(b=a.itemLayers);return arcgisonline.map.main.filterSubLayers(b,a.visibleLayers)},buildExportLayersByServiceInfo:function(a,b){return arcgisonline.map.main.filterSubLayers(a.layers,b)},filterSubLayers:function(a,b){if(null==a||null==b||0==b.length)return[];for(var c=","+b+",",d=
[],f=",",g=0;g<a.length;g++)if(null!=a[g].subLayerIds){if(-1==c.indexOf(","+a[g].id+",")||-1<f.indexOf(","+a[g].id+","))f+=a[g].subLayerIds.toString()+","}else-1<c.indexOf(","+a[g].id+",")&&-1==f.indexOf(","+a[g].id+",")&&d.push(a[g].id);return d},addGroupLayers:function(a,e){if(null==a||null==e||0==e.length)return[];var c=function(a,b){for(var c=0;c<a.length;c++)if(a[c].id===b)return{parentLayerId:a[c].parentLayerId,subLayerIds:a[c].subLayerIds};return{parentLayerId:-1,subLayerIds:null}},d=[];""!==
e&&(d=e.split(","));for(var d=b.map(d,function(a){return parseInt(a)}),f=[],g=0;g<d.length;g++){var h=d[g];-1==b.indexOf(f,h)&&f.push(h);for(var h=c(a,h),l=h.parentLayerId;-1<l;)-1==b.indexOf(f,l)&&f.push(l),l=c(a,l).parentLayerId;(h=h.subLayerIds)&&h.length&&b.forEach(h,function(a){-1==b.indexOf(d,a)&&d.push(a)})}f=f.sort(function(a,b){return a==b?0:a<b?-1:1});return f.toString()},getParameterList:function(a){for(var b=0;b<arcgisonline.map.main.mapLayers.length;b++){var c=arcgisonline.map.main.mapLayers[b];
if(c.layers)for(var d=0;d<c.layers.length;d++){if(a.id==c.layers[d].id)return c}else{if(a.id==c.id)return c;if(c.layer instanceof esri.layers.GeoRSSLayer)for(var f=c.layer.getFeatureLayers(),d=0;d<f.length;d++)if(a.id==f[d].id)return c}}return null},getParameterListById:function(a){for(var b=0;b<arcgisonline.map.main.mapLayers.length;b++){var c=arcgisonline.map.main.mapLayers[b];if(a==c.id)return c}for(b=0;b<arcgisonline.map.main.mapTables.length;b++)if(c=arcgisonline.map.main.mapTables[b],a==c.id)return c;
return null},isWebMapLayer:function(a){var e=!1,c=arcgisonline.map.save_open.openedWebMap;c&&(b.forEach(c.operationalLayers,function(b){b.id===a.id&&(e=!0)}),b.forEach(c.baseMap.baseMapLayers,function(b){b.id===a.id&&(e=!0)}));return e},hasMSForFS:function(a){if(!a.url)return!1;var b=a.url,c=b.indexOf("/FeatureServer");if(-1<c&&a.serviceInfo.capabilities&&-1<a.serviceInfo.capabilities.toLowerCase().indexOf("editing")){b=b.substring(0,c);for(c=0;c<arcgisonline.map.main.mapLayers.length;c++){var d=
arcgisonline.map.main.mapLayers[c];if(d.url&&-1<d.url.indexOf(b)&&-1<d.url.indexOf("/MapServer")&&d.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer)return a.showLegend=!1,!0}}return!1},getMSForFS:function(a){if(a.url){var b=a.url,c=b.indexOf("/FeatureServer");if(-1<c&&a.serviceInfo.capabilities&&-1<a.serviceInfo.capabilities.toLowerCase().indexOf("editing")){a=b.substring(0,c);for(b=0;b<arcgisonline.map.main.mapLayers.length;b++)if(c=arcgisonline.map.main.mapLayers[b],c.url&&-1<c.url.indexOf(a)&&
-1<c.url.indexOf("/MapServer")&&c.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer)return c}}},recreateFLsForMS:function(a,b){if(a.url){var c=a.url,d=c.indexOf("/MapServer");if(-1<d){c=c.substring(0,d);for(d=0;d<arcgisonline.map.main.mapLayers.length;d++){var f=arcgisonline.map.main.mapLayers[d];f.url&&(-1<f.url.indexOf(c)&&-1<f.url.indexOf("/FeatureServer/")&&f.layer&&f.layer.isEditable())&&f.layer.mode!==b&&(arcgisonline.map.layer.recreateFL(f,b),b===esri.layers.FeatureLayer.MODE_SELECTION?
f.showLegend=!1:delete f.showLegend)}}}},switchFlsForMS:function(a){if(a.url){var e=a.url,c=e.indexOf("/MapServer");if(-1<c&&a.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer)for(var e=e.substring(0,c),d=0;d<arcgisonline.map.main.mapLayers.length;d++){var f=arcgisonline.map.main.mapLayers[d];if(f.url&&-1<f.url.indexOf(e)&&-1<f.url.indexOf("/FeatureServer/")&&f.layer&&f.layer instanceof esri.layers.FeatureLayer&&f.layer.mode===esri.layers.FeatureLayer.MODE_SELECTION)if(a.layer.visible){var c=
f.url.indexOf("/FeatureServer/"),g=f.url.indexOf("?");-1==g&&(g=f.url.lengthl);c=f.url.substring(c+15,g);-1<b.indexOf(a.layer.visibleLayers,c)?f.layer.show():f.layer.hide()}else f.layer.hide()}}},getFlForMSL:function(a,b){if(a.url){var c=a.url,d=c.indexOf("/MapServer");if(-1<d&&a.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer){c=c.substring(0,d);for(d=0;d<arcgisonline.map.main.mapLayers.length;d++){var f=arcgisonline.map.main.mapLayers[d];if(f.url&&-1<f.url.indexOf(c+"/FeatureServer/"+
b)&&f.layer&&f.layer.mode===esri.layers.FeatureLayer.MODE_SELECTION)return f}}return null}},containsLayerInfo:function(a,b){for(var c=0;c<a.layers.length;c++)if(a.layers[c].id===b)return a.layers[c];return null},getLayerInfoForQuery:function(a,e,c){var d=new b.Deferred;if(arcgisonline.map.featColl.isFeatureCollection(a))return d.errback(),d;var f=!1;if(a.queryServiceUrl)if(a.queryLayersInfo)b.forEach(a.queryLayersInfo.layers,function(b){b.id===e&&(b.url=a.queryServiceUrl,d.callback(b))});else{var g=
function(c,f){b.forEach(a.queryLayersInfo.layers,function(b){b.id===e&&(b.url=a.queryServiceUrl,d.callback(b))})};arcgisonline.map.main.getQueryLayersInfo(a,b.hitch(this,g))}else!a.identify&&(a.layer instanceof esri.layers.ArcGISTiledMapServiceLayer&&a.itemLayers)&&b.forEach(a.itemLayers,function(c){if(c.id===e)if(c._layerInfo)f=!0,a.layersInfo=a.layersInfo||{},a.layersInfo.layers=a.layersInfo.layers||[],a.layersInfo.layers[e]||(a.layersInfo.layers[e]=c._layerInfo),c._layerInfo.url=c.layerUrl,d.callback(c._layerInfo);
else if(c.layerUrl){f=!0;var g=!1,h;a.layersInfo&&a.layersInfo.layers&&(g=b.some(a.layersInfo.layers,function(a){h=a;return a.id===c.id}));g?(h.url=c.layerUrl,d.callback(h)):arcgisonline.map.main.getJson(c.layerUrl,b.hitch(this,function(b,e){a.layersInfo=a.layersInfo||{};a.layersInfo.layers=a.layersInfo.layers||[];c._layerInfo=b;b.tileSvcLayerId=c.id;a.layersInfo.layers.push(b);b.url=c.layerUrl;d.callback(b)}),b.hitch(this,function(a,b){d.errback()}))}},this);if(!a.queryServiceUrl&&!f)if(a.layer){g=
!1;if(a.layersInfo&&(a.layersInfo.layers||a.layersInfo.tables)){var h=arcgisonline.map.main.containsLayerInfo(a.layersInfo,e);h&&(g=!0,h.url=a.layer.ur,d.callback(h))}if(!g)if(10.01<=a.layer.version&&a.itemId&&a.layer instanceof esri.layers.ArcGISTiledMapServiceLayer&&arcgisonline.sharing.util.isHostedService(a.url))arcgisonline.map.main.getServiceToServiceFS(a,function(){var c=function(c,f){b.forEach(a.queryLayersInfo.layers,function(b){b.id===e&&(b.url=a.layer.url,d.callback(b))})};a.queryLayersInfo?
c():arcgisonline.map.main.getQueryLayersInfo(a,b.hitch(this,c),b.hitch(this,function(){d.errback()}))},function(){d.errback()});else if(10<=a.layer.version)if(!a.layersInfo&&!a.thematicGroup)-1===a.layer.capabilities.toLowerCase().indexOf("query")?(a.layersInfo={},a.layersInfo.layers=[],d.errback()):(g=function(c,f){b.forEach(a.layersInfo.layers,function(b){b.id===e&&(b.url=a.layer.url,d.callback(b))})},arcgisonline.map.main.getLayersInfo(a,b.hitch(this,g)));else{c=function(c,f,g){b.filter(a.layersInfo.layers,
function(a){return a.id===e}).length||a.layersInfo.layers.push(f);f.url=c;d.callback(f)};var g=function(a,b){d.errback()},h=a.url,l=h.indexOf("?"),h=-1==l?h+("/"+e):h.substring(0,l)+"/"+e+layersUrl.substring(l,layersUrl.length);arcgisonline.map.main.getJson(h,b.hitch(this,c,h),b.hitch(this,g))}else!a.identify||c?d.errback():(c=function(c,f,g){a.layersInfo=a.layersInfo||{};a.layersInfo.layers=a.layersInfo.layers||[];a.layersInfo.layers.push(f);b.forEach(a.layersInfo.layers,function(a){a.id===e&&(a.url=
c,d.callback(a))})},g=function(a,b){d.errback()},h=a.url,l=h.indexOf("?"),h=-1==l?h+("/"+e):h.substring(0,l)+"/"+e+layersUrl.substring(l,layersUrl.length),arcgisonline.map.main.getJson(h,b.hitch(this,c,h),b.hitch(this,g)))}else d.errback();return d},getLayerInfoForQueryFromUrl:function(a,e,c,d){if(e&&e.capabilities&&-1<e.capabilities.toLowerCase().indexOf("map"))if(-1===e.capabilities.toLowerCase().indexOf("query"))d({layers:[]});else{var f=a;a=f.indexOf("?");f=-1==a?f+"/layers":f.substring(0,a)+
"/layers"+f.substring(a,f.length);arcgisonline.map.main.getJson(f,b.hitch(this,function(a,b){d(a)}))}else e=a,a=e.indexOf("?"),e=-1==a?e+("/"+c):e.substring(0,a)+"/"+c+f.substring(a,f.length),arcgisonline.map.main.getJson(e,b.hitch(this,function(a,b){var c={layers:[]};c.layers.push(a);d&&d(c)}),b.hitch(this,function(a,b){d({layers:[]})}))},getLayersInfo:function(a,e){if(a.layersInfo)e(a.layersInfo);else if(!a.layer||10>a.layer.version||a.thematicGroup)a.layersInfo={layers:[]},e(a.layersInfo);else if(a.layersInfoInProgress)setTimeout(b.hitch(this,
function(a,b){arcgisonline.map.main.getLayersInfo(a,b)},a,e),500);else{a.layersInfoInProgress=!0;var c=a.url,d=c.indexOf("?"),c=-1==d?c+"/layers":c.substring(0,d)+"/layers"+c.substring(d,c.length);arcgisonline.map.main.getJson(c,b.hitch(this,function(b,c){delete a.layersInfoInProgress;a.layersInfo=b;e(b)}),b.hitch(this,function(){delete a.layersInfoInProgress;a.layersInfo={layers:[]};e(a.layersInfo)}))}},getQueryLayersInfo:function(a,e,c){c=function(a,b){c()};var d=a.queryServiceUrl,f=d.indexOf("?"),
d=-1==f?d+"/layers":d.substring(0,f)+"/layers"+d.substring(f,d.length);arcgisonline.map.main.getJson(d,b.hitch(this,function(b,c){a.queryLayersInfo=b;e(b,c)}),b.hitch(this,c))},getLayerInfo:function(a,e){var c=new b.Deferred,d=null;a.itemLayers&&b.forEach(a.itemLayers,function(a){a.id===e&&a.layerUrl&&(d=a)});if(d){var f=function(b,c,d){a.layersInfo=a.layersInfo||{};a.layersInfo.layers=a.layersInfo.layers||[];a.layersInfo.layers.push(d);b._layerInfo=d;c.callback(d)},g=function(a,b){a.errback(b)};
arcgisonline.map.layer.getServiceInfo(d.layerUrl,null,b.hitch(this,f,d,c),b.hitch(this,g,c))}else if(a.layersInfo&&a.layersInfo.layers&&!arcgisonline.sharing.util.isHostedService(a.url)){var h=!1;b.forEach(a.layersInfo.layers,function(a){a.id===e&&(c.callback(a),h=!0)});if(!h){var f=function(c,d){a.layersInfo=a.layersInfo||{layers:[]};b.filter(a.layersInfo.layers,function(a){return a.id===e}).length||a.layersInfo.layers.push(d);c.callback(d)},g=function(a,b){a.errback(b)},l=a.url,m=l.indexOf("?"),
l=-1==m?l+("/"+e):l.substring(0,m)+"/"+e+l.substring(m,l.length);arcgisonline.map.layer.getServiceInfo(l,null,b.hitch(this,f,c),b.hitch(this,g,c))}}else c.errback();return c},getServiceToServiceFS:function(a,e,c){a.noQueryServiceUrl?c&&c():a.queryServiceUrlProcessing?setTimeout(b.hitch(arcgisonline.map.main,"getServiceToServiceFS",a,e,c),500):a.queryServiceUrl?e():(a.queryServiceUrlProcessing=!0,arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"content/items/"+a.itemId+"/relatedItems?relationshipType\x3dService2Service\x26direction\x3dreverse",
b.hitch(this,function(d){d&&d.total&&b.forEach(d.relatedItems,function(b){if("Feature Service"===b.type){a.queryServiceUrl=b.url;if((esriGeowConfig.allSSL||"https:"==location.protocol)&&(arcgisonline.sharing.util.isHostedService(a.queryServiceUrl)||arcgisonline.sharing.util.supportsHttps(a.queryServiceUrl)))a.queryServiceUrl=a.queryServiceUrl.replace("http:","https:");a.queryServiceItemId=b.id;delete a.queryServiceUrlProcessing;e()}});a.queryServiceUrl||(a.noQueryServiceUrl=!0,delete a.queryServiceUrlProcessing,
c&&c())}),b.hitch(this,function(){a.noQueryServiceUrl=!0;delete a.queryServiceUrlProcessing;c&&c()})))},hasFullEditingControl:function(a){var e=!1,c=arcgisonline.sharing.util.getUser();if(c&&a.itemId){var d=arcgisonline.sharing.util.urlToObject(document.URL);d.query=d.query||{};var f=d.query.layers||d.query.services;if("true"===d.query.isAdmin&&f&&-1<f.indexOf(a.itemId)&&a.itemCard&&-1<b.indexOf(a.itemCard.typeKeywords,"Hosted Service"))if("update"===a.itemCard.itemControl||"admin"===a.itemCard.itemControl)e=
!0;else if(c&&esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin()&&-1<a.url.indexOf("/"+c.accountId+"/"))e=!0;else if(c&&a.itemCard.owner&&a.itemCard.owner===c.email)e=!0;else if(esriGeowConfig.userRole&&esriGeowConfig.userRole.canEditFeaturesFullControl()&&esriGeowConfig.userRole.canEditFeatures()&&-1<a.url.indexOf("/"+c.accountId+"/")&&a.serviceInfo&&a.serviceInfo.capabilities&&(-1<a.serviceInfo.capabilities.indexOf("Create")||-1<a.serviceInfo.capabilities.indexOf("Update")||-1<a.serviceInfo.capabilities.indexOf("Delete")))e=
!0}return e},hasDynamicLayers:function(a){return a.layer&&a.itemLayers&&a.itemLayers.length&&a.layer.supportsDynamicLayers&&a.itemLayers[0].layerDefinition&&a.itemLayers[0].layerDefinition.source?!0:!1},getMapLayerInfo:function(){for(var a={supportsOffline:!0},b=0;b<arcgisonline.map.main.mapLayers.length;b++){var c=arcgisonline.map.main.mapLayers[b],d=c.layer;if(d&&d.url&&d instanceof esri.layers.FeatureLayer&&d.isEditable()){var f=!1,g=c.serviceInfo&&c.serviceInfo._origCapabilities||d.capabilities,
g=g?g.toLowerCase():"";if(-1<g.indexOf("create")||-1<g.indexOf("edit")||-1<g.indexOf("delete")||-1<g.indexOf("update"))f=!0;f&&(a.hasEditableLayer=!0,c.isTrackingInfoLayer&&!a.trackingLayerId&&(a.trackingLayerId=c.id))}if(a.supportsOffline&&!(d&&d instanceof esri.layers.FeatureLayer&&d.url&&d.capabilities&&-1<d.capabilities.indexOf("Sync")||d&&d instanceof esri.layers.ArcGISTiledMapServiceLayer&&(c.serviceInfo&&!0===c.serviceInfo.exportTilesAllowed||arcgisonline.sharing.util.isAgolService(d.url)&&
arcgisonline.map.main.agolServiceWithExportTilesAllowed(d.url))))a.supportsOffline=!1}for(b=0;b<arcgisonline.map.main.mapTables.length;b++){c=arcgisonline.map.main.mapTables[b];if((d=c.layer)&&d.url&&d instanceof esri.layers.FeatureLayer&&d.isEditable())a.hasEditableLayer=!0;if(!d||!(d instanceof esri.layers.FeatureLayer&&d.url&&d.capabilities&&-1<d.capabilities.indexOf("Sync")))a.supportsOffline=!1}return a},agolServiceWithExportTilesAllowed:function(a){for(var b=0;b<esriGeowConfig.agolServicesWithExportTilesAllowed.length;b++)if(-1<
a.indexOf("/"+esriGeowConfig.agolServicesWithExportTilesAllowed[b]+"/"))return!0;return!1},adjustWebMapTypeKeywords:function(a){a=a.split(",");var e=arcgisonline.map.main.getMapLayerInfo();if(e.hasEditableLayer){-1==b.indexOf(a,"Data Editing")&&a.push("Data Editing");var c=arcgisonline.sharing.util.getUser();-1==b.indexOf(a,"Collector")&&c.accountId?a.push("Collector"):c.accountId||(c=b.indexOf(a,"Collector"),-1<c&&a.splice(c,1))}else c=b.indexOf(a,"Data Editing"),-1<c&&a.splice(c,1),c=b.indexOf(a,
"Collector"),-1<c&&a.splice(c,1);if((c=arcgisonline.sharing.util.getUser())&&c.accountId)e.supportsOffline?-1==b.indexOf(a,"Offline")&&a.push("Offline"):(c=b.indexOf(a,"Offline"),-1<c&&a.splice(c,1));return a.toString()},reloadFeatureLayer:function(a){arcgisonline.map.main.map.infoWindow.clearFeatures();arcgisonline.map.main.map.infoWindow.hide();delete a.__createDefaultPopup;var e=!1;b.forEach(arcgisonline.map.geocode.geocoder.sources,function(b){b.layerId===a.layer.id&&(e=!0)});a.scaleChanged&&
(a.serviceInfo.minScale=a.layer.minScale,a.serviceInfo.maxScale=a.layer.maxScale);a.rendererChanged&&(a.layerDefinition=a.layerDefinition||{},a.layerDefinition.drawingInfo=a.layerDefinition.drawingInfo||{},a.layerDefinition.drawingInfo.renderer=a.layer.renderer.toJson(),a.layer.labelingInfo&&(a.serviceInfo.drawingInfo.labelingInfo=b.map(a.layer.labelingInfo,function(a){return a.toJson()})));a.featureTemplatesChanged&&(a.serviceInfo.types=a.layer.types,a.serviceInfo.templates=a.layer.templates,a.serviceInfo.typeIdField=
a.layer.typeIdField);!1===a.layer.useMapTime?a.timeAnimation=!1:!0===a.layer.useMapTime&&(a.timeAnimation=!0);a.defaultOpacity=a.layer.opacity;var c=b.indexOf(arcgisonline.map.main.map.graphicsLayerIds,a.id),d=b.connect(arcgisonline.map.main.map,"onLayerRemove",function(){b.disconnect(d);arcgisonline.map.labels.removeLabelsForLayer(a.layer);delete a.layer;arcgisonline.map.layer.addLayer(a,c,function(){b.publish("onLayerUpdate",["reopen"]);e&&arcgisonline.map.geocode.recreateGeocoder()})});arcgisonline.map.main.map.removeLayer(a.layer);
arcgisonline.map.labels.removeLabelsForLayer(a.layer)},maxOffset:function(a){return Math.floor(arcgisonline.map.main.map.extent.getWidth()/arcgisonline.map.main.map.width)*a},updateLayerScaleInfo:function(a,b){if(10.1>=b.version&&a.serviceInfo&&a.serviceInfo.layers)for(var c=parseInt(b.url.substring(b.url.lastIndexOf("/")+1,b.url.length)),d=a.serviceInfo.layers.length-1;0<=d;d--)if(a.serviceInfo.layers[d].id==c)if(0<=a.serviceInfo.layers[d].minScale&&b.setMinScale(Math.min(b.minScale,a.serviceInfo.layers[d].minScale)||
a.serviceInfo.layers[d].minScale||b.minScale),0<=a.serviceInfo.layers[d].maxScale&&b.setMaxScale(Math.max(b.maxScale,a.serviceInfo.layers[d].maxScale)),-1<a.serviceInfo.layers[d].parentLayerId)c=a.serviceInfo.layers[d].parentLayerId;else break},removeUrlParameter:function(a,b){-1!=a.indexOf("\x26"+b+"\x3d")?(start=a.indexOf(b),end=a.indexOf("\x26",start+2),a=-1==end?a.substring(0,start):a.substring(0,start)+a.substring(end,a.length)):-1!=a.indexOf("?"+b+"\x3d")&&(start=a.indexOf(b),end=a.indexOf("\x26",
start+2),a=-1==end?a.substring(0,start):a.substring(0,start+1)+a.substring(end+1,a.length));return a},isTextLayer:function(a){return a.renderer&&"esri.renderer.UniqueValueRenderer"===a.renderer.declaredClass&&a.renderer.infos&&a.renderer.infos.length&&a.renderer.infos[0].symbol&&"textsymbol"===a.renderer.infos[0].symbol.type?!0:!1},switchBingToEsriBasemap:function(a){a.baseMap="BingMapsAerial"===a.baseMap.baseMapLayers[0].type?{title:"Imagery",baseMapLayers:[{id:"World_Imagery_2017",visibility:!0,
opacity:1,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"}]}:"BingMapsRoad"===a.baseMap.baseMapLayers[0].type?{title:"Streets",baseMapLayers:[{id:"World_Street_Map_8421",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]}:{title:"Imagery with Labels",baseMapLayers:[{id:"World_Imagery_6611",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"},{id:"World_Boundaries_and_Places_1145",
isReference:!0,opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer"}]};return a},getJson:function(a,b,c){a=0<=a.indexOf("?")?a+"\x26f\x3djson":a+"?f\x3djson";esri.request({url:a,callbackParamName:"callback",load:function(d,f){arcgisonline.sharing.util.handler(d,f,a,b,c)},error:function(b,e){arcgisonline.sharing.util.errorHandler(b,e,a,c)}})},roundVal:function(a){return arcgisonline.map.main.roundValue(a,1E4)},roundValue:function(a,
b){return Math.round(a*b)/b},onKeyPress:function(a){a.keyCode==b.keys.BACKSPACE&&("INPUT"!==a.currentTarget.activeElement.nodeName&&"TEXTAREA"!==a.currentTarget.activeElement.nodeName)&&(a.preventDefault(),a.stopPropagation())},doNothing:function(a){a.preventDefault()},contains:function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1},createMapObject:function(a,e,c){b.style("map","position","relative");var d=new esri.dijit.Popup({visibleWhenEmpty:!1},b.create("div",{"class":"blueTheme"},
b.byId("map")));e={nav:!1,lods:arcgisonline.map.main.mapLods,extent:e,wrapAround180:!0,infoWindow:d,showInfoWindowOnClick:!1,sliderStyle:"small"};c&&(esri.isDefined(c.minScale)&&esri.isDefined(c.maxScale))&&(e.minScale=c.minScale,e.maxScale=c.maxScale);arcgisonline.map.main.map=new esri.Map("map",e);null==a&&(a=b.hitch(arcgisonline.map.main,"onMapLoad"));b.connect(arcgisonline.map.main.map,"onLoad",a);b.connect(arcgisonline.map.main.map,"onClick",function(){arcgisonline.map.geocode.closeInfoWindow();
document.activeElement&&document.activeElement.blur&&document.activeElement.blur()})},destroyMapObject:function(a,e){arcgisonline.map.main.map&&(arcgisonline.map.main.scalebar=null,arcgisonline.map.time.removeTimeSlider(),arcgisonline.map.main.destroyOverviewMap(),arcgisonline.map.main.destroyMeasureTool(),arcgisonline.map.geocode.destroyGeocoder(),arcgisonline.map.table.destroyTable(),arcgisonline.map.main.map.destroy(),arcgisonline.map.labels.labelLayer=null,arcgisonline.map.main.map=null,b.byId("map").innerHTML=
"")},getDirectionsDisplayField:function(a){var b="";if(a.displayField)b=a.displayField;else{for(var c=null,d=null,f=null,g=null,h=null,l=0;l<a.fields.length;l++){var m=a.fields[l];if("name"==m.name.toLowerCase()){b=m.name;break}else"address"==m.name.toLowerCase()?d=m.name:"street"==m.name.toLowerCase()?f=m.name:"city"==m.name.toLowerCase()?g=m.name:!c&&-1<m.name.toLowerCase().indexOf("name")?c=m.name:!h&&"esriFieldTypeString"===m.type&&(h=m.name)}b||(c?b=c:d?b=d:f?b=f:g?b=g:h&&(b=h))}return b},numOperationalLayers:function(){for(var a=
0,b=0;b<arcgisonline.map.main.mapLayers.length;b++)"user"==arcgisonline.map.main.mapLayers[b].type&&a++;return a},numLabelsLayers:function(){for(var a=0,b=0;b<arcgisonline.map.main.mapLayers.length;b++)"labels"===arcgisonline.map.main.mapLayers[b].type&&a++;return a},numMapNotesLayers:function(){for(var a=0,b=0;b<arcgisonline.map.main.mapLayers.length;b++)"mapNotes"===arcgisonline.map.main.mapLayers[b].type&&a++;return a},countMapNotesSubLayers:function(){for(var a=0,b=0;b<arcgisonline.map.main.mapLayers.length;b++)"mapNotes"===
arcgisonline.map.main.mapLayers[b].type&&arcgisonline.map.main.mapLayers[b].layers&&(a+=arcgisonline.map.main.mapLayers[b].layers.length);return a},itemCardExtentValid:function(a){return a&&2==a.length&&2==a[0].length&&2==a[1].length&&!(-90>a[1][1]||90<a[1][1])&&!(-180>a[1][0]||180<a[1][0])&&!(-180>a[0][0]||180<a[0][0])&&!(-90>a[0][1]||90<a[0][1])&&!(a[1][0]<=a[0][0]||a[1][1]<=a[0][1])?!0:!1},getNameFromUrl:function(a){var b=a;-1<a.indexOf("/MapServer")?(b=a.substring(0,a.indexOf("/MapServer")),b=
b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.indexOf("/ImageServer")?(b=a.substring(0,a.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.indexOf("/FeatureServer")&&(b=a.substring(0,a.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length));-1<b.indexOf("%")&&(b=arcgisonline.map.main.decodeUrl(b));return b},addLayerId:function(a,b){var c=a,d=c.indexOf("?");return c=-1<d?c.substring(0,d)+"/"+b+c.substring(d,c.length):c+("/"+b)},decodeUrl:function(a){return decodeURIComponent(a)},
displayDefaultExtent:function(){var a=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new b.Color([255,0,0]),2);arcgisonline.map.main.map.graphics.add(new esri.Graphic(new esri.geometry.Extent(esriGeowConfig.defaultExtent),a))},calcFilterDlgWidth:function(){if(!arcgisonline.map.main.filterDlgWidth){var a=b.string.substitute(esri.i18nBundle.FilterDlg.expressionTemplate,{field_dropdown:"",operator_dropdown:"",values_input:esri.i18nBundle.FilterDlg.value+esri.i18nBundle.FilterDlg.field+
esri.i18nBundle.FilterDlg.uniqueValues}).replace(/\s/g,"\x26nbsp;"),e=b.create("div",{innerHTML:a,style:{top:-1E3,left:0,position:"absolute"}},document.body),a=b.string.substitute(esri.i18nBundle.FilterDlg.expressionTemplate,{field_dropdown:"",operator_dropdown:"",values_input:esri.i18nBundle.FilterDlg.andBetweenValues}).replace(/\s/g,"\x26nbsp;"),a=b.create("div",{innerHTML:a,style:{top:-1E3,left:0,position:"absolute"}},document.body),c=b.coords(e).w+465,d=b.coords(a).w+590;arcgisonline.map.main.filterDlgWidth=
Math.max(c,d);document.body.removeChild(e);document.body.removeChild(a)}return arcgisonline.map.main.filterDlgWidth},openFilterDlg:function(a,b){var c=arcgisonline.map.main.calcFilterDlgWidth(),d=(new n.Dialog({style:"width:"+(c+25)+"px;"})).placeAt(document.body),c=new arcgisonline.sharing.dijit.dialog.FilterDlg({id:"filterDlg",dialog:d,style:"width:"+c+"px;"}),f=esri.i18nBundle.FilterDlg.filter+": "+a.title;a.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&(f+=" - "+b.name);d.set({title:f,
content:c});d.show();c.start(a,b)},getWebmapId:function(){return arcgisonline.map.save_open.webMapInfo?arcgisonline.map.save_open.webMapInfo.id:null},getWebmapTitle:function(){return arcgisonline.map.save_open.webMapInfo?arcgisonline.map.save_open.webMapInfo.title:null},updateRecentWebMaps:function(a){arcgisonline.map.main.storeRecentMapsHandler||(arcgisonline.map.main.storeRecentMapsHandler=b.subscribe("onSaveExistingWebMap",function(a){arcgisonline.map.main.storeRecentWebMaps()}),b.subscribe("onWebMapSave",
function(a,b,c,d,e){arcgisonline.map.main.storeRecentWebMaps(a,b,e,"thumbnail/ago_downloaded.png")}),b.subscribe("onMapFullyLoaded",function(){arcgisonline.map.save_open.webMapInfo&&arcgisonline.map.main.storeRecentWebMaps()}));if(!("none"===b.style(b.byId("header_map_newMap"),"display")&&"none"===b.style(b.byId("header_map_recentMaps"),"display"))){arcgisonline.map.main.recentMapsHandlers=arcgisonline.map.main.recentMapsHandlers||[];var e;window.localStorage&&(e=window.localStorage.getItem("Esri_recent_webmaps"))&&
(e=b.json.parse(e));var c=arcgisonline.sharing.util.getUser();if((e=e&&e[c?c.email:window.location.host])&&e.length)if(arcgisonline.map.main.didCheckRecentMaps)arcgisonline.map.main.displayRecentMaps(e,a);else{var d=[];b.forEach(e,function(a,b){d.push(arcgisonline.sharing.util.request({url:esriGeowConfig.restBaseUrl+"content/items/"+a.id},{disableIdentityLookup:!0}))});d.length?(new b.DeferredList(d)).addCallback(function(d){var e=[];b.forEach(d,function(a){(a=a[1])&&a.id&&e.push({id:a.id,title:a.title,
owner:a.owner,thumbnail:a.thumbnail})});if(window.localStorage){var h;window.localStorage&&(h=window.localStorage.getItem("Esri_recent_webmaps"))&&(h=b.json.parse(h));h=h||{};e.length?h[c?c.email:window.location.host]=e:delete h[c?c.email:window.location.host];window.localStorage.setItem("Esri_recent_webmaps",b.json.stringify(h))}arcgisonline.map.main.displayRecentMaps(e,a)}):arcgisonline.map.main.displayRecentMaps([],a);arcgisonline.map.main.didCheckRecentMaps=!0}else arcgisonline.map.main.displayRecentMaps(e,
a);arcgisonline.map.main.checkTitleDiv()}},displayRecentMaps:function(a,e){a&&a.length&&(a=b.filter(a,function(a){return esri.isDefined(e)&&e===a.id||!esri.isDefined(e)&&arcgisonline.map.save_open.webMapInfo&&a.id===arcgisonline.map.save_open.webMapInfo.id?!1:!0}));if(a&&a.length){b.byId("webmap-recentMap-new-link").innerHTML='\x3cspan style\x3d"margin-right: 4px;vertical-align: -4px;" class\x3d"esriPublishIcon"\x3e\x3c/span\x3e'+esri.i18nBundle.siteHeader.createNewMap;b.disconnect(arcgisonline.map.main.recentMapsHandlers["new"]);
arcgisonline.map.main.recentMapsHandlers["new"]=b.connect(b.byId("webmap-recentMap-new-link"),"onclick",b.hitch(this,function(a){a.preventDefault();arcgisonline.map.main.openNewMap()}));for(var c=0;5>c;c++)b.style(b.byId("webmap-recentMap-title"),"display","none"),b.style(b.byId("webmap-recentMap-"+c+"-link"),"display","none"),b.disconnect(arcgisonline.map.main.recentMapsHandlers[c]);a.reverse();var d=0;b.forEach(a,function(a){if(!(4<d)){var c='\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" style\x3d"width:270px;"\x3e\x3ctbody\x3e\x3ctr\x3e\x3ctd style\x3d"width:77px;" valign\x3d"top"\x3e',
e=a.thumbnail||arcgisonline.sharing.util.getStaticImagesUrl()+"/desktopapp.png";-1<e.indexOf("thumbnail/")&&(e=esriGeowConfig.restBaseUrl+"content/items/"+a.id+"/info/"+e);var f=arcgisonline.sharing.util.getUser();f&&f.token&&(e+="?token\x3d"+f.token);f=a.title;75<f.length&&(f=f.substring(0,72)+"...");c=c+("\x3cimg src\x3d'"+e+"' border\x3d'0' style\x3d'width:67px; height:44px;'/\x3e")+"\x3c/td\x3e\x3ctd style\x3d'width:190px; white-space:normal;' valign\x3d'top'\x3e";c+="\x3cspan\x3e"+f+"\x3c/span\x3e";
c+="\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e";b.byId("webmap-recentMap-"+d+"-link").innerHTML=c;b.style(b.byId("webmap-recentMap-"+d+"-link"),"display","");b.style(b.byId("webmap-recentMap-title"),"display","");arcgisonline.map.main.recentMapsHandlers[d]=b.connect(b.byId("webmap-recentMap-"+d+"-link"),"onclick",b.hitch(this,function(b){b.preventDefault();b=esriGeowConfig.baseUrl+"webmap/viewer.html?webmap\x3d"+a.id;!0==arcgisonline.map.main.mapHasChanged?arcgisonline.sharing.dijit.dialog.OpenMapDlg.prototype.statics.getInstance().show(b,
null,arcgisonline.map.main.mapLayers,arcgisonline.map.main.mapTables,arcgisonline.map.save_open.webMapInfo?arcgisonline.map.save_open.webMapInfo.title:null):document.location=b}));d++}});b.style(b.byId("header_map_newMap"),"display","none");b.style(b.byId("header_map_recentMaps"),"display","");if(esriGeowConfig.isRightToLeft){var c=b.coords(b.byId("header_map_recentMaps")),c=c.x+c.w,f=b.query(".js-dropdown-menu",b.byId("header_map_recentMaps"))[0];310>c?b.style(f,"left","5px"):b.style(f,"left","auto")}else c=
window.innerWidth-b.coords(b.byId("header_map_recentMaps")).x,f=b.query(".js-dropdown-menu",b.byId("header_map_recentMaps"))[0]}else b.style(b.byId("header_map_recentMaps"),"display","none"),b.style(b.byId("header_map_newMap"),"display","")},storeRecentWebMaps:function(a,e,c,d){var f,g;window.localStorage&&(f=window.localStorage.getItem("Esri_recent_webmaps"))&&(f=b.json.parse(f));f=f||{};var h=arcgisonline.sharing.util.getUser();g=f[h?h.email:window.location.host]||[];g=b.filter(g,function(b){return b.id!==
(a||arcgisonline.map.save_open.webMapInfo.id)});g.push({id:a||arcgisonline.map.save_open.webMapInfo.id,title:c||arcgisonline.map.save_open.webMapInfo.title,owner:e||arcgisonline.map.save_open.webMapInfo.owner,thumbnail:d||arcgisonline.map.save_open.webMapInfo.thumbnail});10<g.length&&g.splice(0,1);window.localStorage&&(f[h?h.email:window.location.host]=g,window.localStorage.setItem("Esri_recent_webmaps",b.json.stringify(f)));arcgisonline.map.main.updateRecentWebMaps(a)},getPictureMarkerSize:function(a){var e=
new b.Deferred;if(!a||10>a.length||0!==a.indexOf("http"))e.errback();else{arcgisonline.map.main.testImageHandler&&b.disconnect(arcgisonline.map.main.testImageHandler);arcgisonline.map.main.testImageHandler=b.connect(b.byId("viewer_testImage"),"onload",function(){clearTimeout(c);c=null;var a=b.style(b.byId("viewer_testImage"),"width"),f=b.style(b.byId("viewer_testImage"),"height");1==a&&1==f||0===a||0===f?e.errback():e.callback([a,f])},{});var c=setTimeout(b.hitch(this,function(){clearTimeout(c);c=
null;e.errback()}),5E3);b.byId("viewer_testImage").src=a;return e}},getLayerTitle:function(a,e){var c=a.title;if(a.layer&&a.layer.layerInfos)if(arcgisonline.map.main.hasDynamicLayers(a))b.forEach(a.itemLayers,function(a){e===a.id&&a.name&&(c+=" - "+a.name)});else{var d=a.layer.layerInfos;d[e].name&&(c+=" - "+d[e].name)}else if(a.layers||a.tables)d=a.layers,a.tables&&(d=d.concat(a.tables)),d[e].name&&(c+=" - "+d[e].name);return c},isBlankViewer:function(){if(!arcgisonline.map.save_open.webMapItemCard&&
!arcgisonline.map.save_open.itemCard){var a=arcgisonline.sharing.util.urlToObject(document.URL);a.query=a.query||{};var e=a.query.useExisting?b.cookie("ESRI_Webmap"):!1;e||delete a.query.useExisting;return esri.isEmpty(a.query)&&!e?!0:0===arcgisonline.map.main.numOperationalLayers()&&0===arcgisonline.map.main.numMapNotesLayers()?!0:!1}return!1},hasMapOnly:function(){var a=arcgisonline.sharing.util.urlToObject(document.URL);a.query=a.query||{};return a.query.mapOnly&&"true"===a.query.mapOnly?!0:!1},
dojoPatch:function(){b.mixin(n.byId("dijitToolbar"),{_onContainerKeypress:function(a){if(!a.ctrlKey&&!a.altKey&&!(a.keyCode==b.keys.HOME||a.keyCode==b.keys.END||a.keyCode==b.keys.LEFT_ARROW||a.keyCode==b.keys.RIGHT_ARROW)){var e=this._keyNavCodes[a.charOrCode];e&&(e(),event.stop(a))}}})}}});