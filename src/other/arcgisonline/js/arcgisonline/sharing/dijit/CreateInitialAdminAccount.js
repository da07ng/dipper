// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/CreateInitialAdminAccount",["dijit","dojo","dojox","dojo/i18n!arcgisonline/nls/arcgisonline","dojo/require!dijit/_Widget,dijit/_Templated,dijit/form/Button,dijit/form/Form,dijit/form/TextBox,dojo/data/ItemFileReadStore,arcgisonline/sharing/util,arcgisonline/sharing/geow/Account,arcgisonline/sharing/dijit/ComboBox,arcgisonline/sharing/dijit/dialog/GeneralDlg"],function(f,a,p){a.provide("arcgisonline.sharing.dijit.CreateInitialAdminAccount");a.require("dijit._Widget");
a.require("dijit._Templated");a.require("dijit.form.Button");a.require("dijit.form.Form");a.require("dijit.form.TextBox");a.require("dojo.data.ItemFileReadStore");a.require("arcgisonline.sharing.util");a.require("arcgisonline.sharing.geow.Account");a.require("arcgisonline.sharing.dijit.ComboBox");a.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");a.requireLocalization("arcgisonline","arcgisonline");a.declare("arcgisonline.sharing.dijit.CreateInitialAdminAccount",[f._Widget,f._Templated],{widgetsInTemplate:!0,
templateString:'\x3cdiv class\x3d"${baseClass}" data-dojo-type\x3d"dijit.layout.ContentPane" data-dojo-attach-point\x3d"containerNode"\x3e\r\n  \x3cdiv class\x3d"createJoin" data-dojo-attach-point\x3d"_createJoinContainer"\x3e\r\n    \x3cp\x3e${i18n.createOrJoinDesc}\x3c/p\x3e\r\n    \x3cdiv style\x3d"text-align:center;margin-top:2em;margin-bottom:3em;"\x3e\r\n      \x3cbutton type\x3d"button" class\x3d"calcite secondary small"\r\n              data-dojo-attach-point\x3d"_createSiteBtn" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.createSite}\x3c/button\x3e\r\n      \x3cbutton type\x3d"button" class\x3d"calcite tertiary small"\r\n              data-dojo-attach-point\x3d"_joinSiteBtn" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.joinSite}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"_createSiteContainer"\x3e\r\n    \x3cdiv id\x3d"_createSiteDescription" data-dojo-attach-point\x3d"_description"\x3e\r\n      \x3cdiv\x3e${i18n.enterDetails}\x3c/div\x3e\x3cbr/\x3e\r\n      \x3cdiv\x3e${i18n.onceCreated}\x3c/div\x3e\r\n    \x3c/div\x3e\x3cbr/\x3e\x3cbr\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_form" class\x3d"newStyles grid-50" data-dojo-type\x3d"dijit.form.Form"\x3e\r\n      \x3cdiv class\x3d"formBlock" id\x3d"firstNameBlock"\x3e\r\n        \x3clabel for\x3d"firstNameInput"\x3e${i18n.firstNameLabel}\x3c/label\x3e\r\n        \x3cinput id\x3d"firstNameInput" type\x3d"text" data-dojo-attach-point\x3d"_firstnameInput" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"trim: true"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"formBlock" id\x3d"lastNameBlock"\x3e\r\n        \x3clabel for\x3d"lastNameInput"\x3e${i18n.lastNameLabel}\x3c/label\x3e\r\n        \x3cinput id\x3d"lastNameInput" type\x3d"text" data-dojo-attach-point\x3d"_lastnameInput" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"trim: true"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"formBlock"\x3e\r\n        \x3clabel for\x3d"emailInput"\x3e${i18n.currentEmailAdr}\x3c/label\x3e\r\n        \x3cinput id\x3d"emailInput" type\x3d"text" data-dojo-attach-point\x3d"_emailInput" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"trim: true"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"formBlock"\x3e\r\n        \x3clabel for\x3d"confirmEmailInput"\x3e${i18n.confirmEmailAdr}\x3c/label\x3e\r\n        \x3cinput id\x3d"confirmEmailInput" type\x3d"text" data-dojo-attach-point\x3d"_confirmEmailInput" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"trim: true"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"formBlock"\x3e\r\n        \x3clabel for\x3d"usernameInput"\x3e${i18n.usernameLabel}\x3c/label\x3e\r\n        \x3cinput id\x3d"usernameInput" type\x3d"text" data-dojo-attach-point\x3d"_usernameInput" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"placeHolder:\'${i18n.usernamePlaceholder}\'"/\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"formBlock"\x3e\r\n        \x3clabel for\x3d"passwordInput"\x3e${i18n.passwordLabel}\x3c/label\x3e\r\n        \x3cinput id\x3d"passwordInput" type\x3d"password" data-dojo-attach-point\x3d"_passwordInput" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"placeHolder:\'${i18n.passwordPlaceholder}\'"/\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"formBlock"\x3e\r\n        \x3clabel for\x3d"repeatPasswordInput"\x3e${i18n.repeatPasswordLabel}\x3c/label\x3e\r\n        \x3cinput id\x3d"repeatPasswordInput" type\x3d"password" data-dojo-attach-point\x3d"_repeatPasswordInput" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"placeHolder:\'${i18n.repeatPasswordPlaceholder}\'"/\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"formBlock"\x3e\r\n        \x3clabel for\x3d"identityQuestionInput"\x3e${i18n.identityQLabel}\x3c/label\x3e\r\n        \x3cdiv id\x3d"identityQuestionInput" data-dojo-attach-point\x3d"_identityQuestionInput" data-dojo-type\x3d"arcgisonline.sharing.dijit.ComboBox" data-dojo-attach-event\x3d"onChange:onIdentityQuestionChange" data-dojo-props\x3d"trim: true" style\x3d"margin-left:0;margin-right:0;width:350px !important;"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"formBlock"\x3e\r\n        \x3clabel for\x3d"identityAnswerInput"\x3e${i18n.identityALabel}\x3c/label\x3e\r\n        \x3cdiv id\x3d"identityAnswerInput" data-dojo-attach-point\x3d"_identityAnswerInput" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"trim: true"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cbr\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_description"\x3e\r\n        \x3cdiv\x3e${i18n.contentDirDetails}\x3c/div\x3e\x3cbr/\x3e\r\n        \x3cdiv\x3e${i18n.contentDirNote}\x3c/div\x3e\r\n      \x3c/div\x3e\x3cbr/\x3e\x3cbr\x3e\r\n      \x3cdiv class\x3d"formBlock" id\x3d"contentDirBlock"\x3e\r\n        \x3clabel for\x3d"contentDirInput"\x3e${i18n.contentDirLabel}\x3c/label\x3e\r\n        \x3cinput id\x3d"contentDirInput" type\x3d"text" class\x3d"longTextBox" data-dojo-attach-point\x3d"_contentDirInput" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"trim: true"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"bottom-buttons"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_createBackBtn" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"calcite default"\x3e${i18n.backButtonLabel}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_createAdminBtn" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"calcite blue"\x3e${i18n.createButtonLabel}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"_joinSiteContainer"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_joinDescription"\x3e\r\n      \x3cdiv\x3e${i18n.joinDetails}\x3c/div\x3e\r\n    \x3c/div\x3e\x3cbr/\x3e\x3cbr\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_joinForm" class\x3d"newStyles grid-50" data-dojo-type\x3d"dijit.form.Form"\x3e\r\n      \x3cdiv class\x3d"formBlock" id\x3d"portalUrlBlock"\x3e\r\n        \x3clabel for\x3d"portalUrlInput"\x3e${i18n.portalUrlLabel}\x3c/label\x3e\r\n        \x3cinput id\x3d"portalUrlInput" type\x3d"text" class\x3d"longTextBox" data-dojo-attach-point\x3d"_portalUrlInput" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"trim: true"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"formBlock"\x3e\r\n        \x3clabel\x3e\x3c/label\x3e\x3c!-- placeholder to align example text properly--\x3e\r\n        \x3cspan class\x3d"example"\x3e${i18n.examplePortalUrlLabel}\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"formBlock"\x3e\r\n        \x3clabel for\x3d"joinUsernameInput"\x3e${i18n.adminUsernameLabel}\x3c/label\x3e\r\n        \x3cinput id\x3d"joinUsernameInput" type\x3d"text" data-dojo-attach-point\x3d"_joinUsernameInput" data-dojo-type\x3d"dijit.form.TextBox"/\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"formBlock"\x3e\r\n        \x3clabel for\x3d"joinPasswordInput"\x3e${i18n.adminPasswordLabel}\x3c/label\x3e\r\n        \x3cinput id\x3d"joinPasswordInput" type\x3d"password" data-dojo-attach-point\x3d"_joinPasswordInput" data-dojo-type\x3d"dijit.form.TextBox"/\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"bottom-buttons"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_joinBackBtn" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"calcite default"\x3e${i18n.backButtonLabel}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_joinPortalBtn" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"calcite blue"\x3e${i18n.joinButtonLabel}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
baseClass:"esriCreateInitialAdminAccount",util:arcgisonline.sharing.util,account:arcgisonline.sharing.geow.Account,_baseUrl:null,_contentDirectory:null,_isUpgrade:!1,defaultContentDirectory:"C:\\arcgisportal\\content",defaultLogsDirectory:"C:\\arcgisportal\\logs",constructor:function(a,c){},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.mixin({},a.i18n.getLocalization("arcgisonline","arcgisonline").common);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").createInitialAdminAccount);
this.i18n.securityQuestions=a.i18n.getLocalization("arcgisonline","arcgisonline").securityQuestions},postCreate:function(){esri.config.defaults.io.proxyUrl=esriGeowConfig.proxyServer;this._baseUrl=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))},startup:function(){this.inherited(arguments);a.attr(a.byId("createIAATitle"),"innerHTML",this.i18n.createOrJoin);a.style(this._createJoinContainer,"display","none");a.style(this._createSiteContainer,"display","none");a.style(this._joinSiteContainer,
"display","none");this.setupQuestions();this.loadConnections();this.checkAdminAccount();this.adjustNameRows()},adjustNameRows:function(){"ja"===a.locale&&a.place(a.byId("firstNameBlock"),a.byId("lastNameBlock"),"after")},setupQuestions:function(){this.identityQuestions=[{id:1,name:this.i18n.securityQuestions[1]},{id:2,name:this.i18n.securityQuestions[2]},{id:3,name:this.i18n.securityQuestions[3]},{id:4,name:this.i18n.securityQuestions[4]},{id:5,name:this.i18n.securityQuestions[5]},{id:6,name:this.i18n.securityQuestions[6]},
{id:7,name:this.i18n.securityQuestions[7]},{id:8,name:this.i18n.securityQuestions[8]},{id:9,name:this.i18n.securityQuestions[9]},{id:10,name:this.i18n.securityQuestions[10]},{id:11,name:this.i18n.securityQuestions[11]},{id:12,name:this.i18n.securityQuestions[12]},{id:13,name:this.i18n.securityQuestions[13]},{id:14,name:this.i18n.securityQuestions[14]}];this._identityQuestionInput.set("store",new a.data.ItemFileReadStore({data:{identifier:"name",label:"id",items:this.identityQuestions}}));this._identityQuestionInput.set("value",
this.i18n.securityQLabel)},loadConnections:function(){this._errorDlg=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();this._creatingSpinner=a.create("span",{style:{visibility:"hidden"}},this._createAdminBtn.domNode,"after");a.create("img",{src:this.util.relativeToExplicitUrl("js/arcgisonline/css/images/spinner20.gif"),width:"14",height:"14",style:{verticalAlign:"middle",paddingTop:"23px"}},this._creatingSpinner,"only");this._joiningSpinner=a.create("span",{style:{visibility:"hidden"}},
this._joinPortalBtn.domNode,"after");a.create("img",{src:this.util.relativeToExplicitUrl("js/arcgisonline/css/images/spinner20.gif"),width:"14",height:"14",style:{verticalAlign:"middle",paddingTop:"23px"}},this._joiningSpinner,"only");a.connect(this._createAdminBtn,"onClick",a.hitch(this,this.onCreateAdmin));a.connect(this._joinPortalBtn,"onClick",a.hitch(this,this.onJoinPortal));a.connect(this._createSiteBtn,"onClick",a.hitch(this,this.onCreateSiteClick));a.connect(this._createBackBtn,"onClick",
a.hitch(this,this.onBackClick));a.connect(this._joinSiteBtn,"onClick",a.hitch(this,this.onJoinSiteClick));a.connect(this._joinBackBtn,"onClick",a.hitch(this,this.onBackClick))},checkAdminAccount:function(){this.account.getSelf(a.hitch(this,function(b){a.xhrGet({url:this._baseUrl+"/portaladmin",handleAs:"json",content:{f:"json",ts:(new Date).getTime()}}).then(a.hitch(this,function(b){var d=arcgisonline.sharing.util.getUser();b&&(!b.error&&d||b.error&&b.error.code&&(499===b.error.code||498===b.error.code))?
d&&b.error&&498===b.error.code?window.location=this.util.getSecureUrl(esriGeowConfig.baseUrl)+"error.html?c\x3dWebAdaptorRequired":this._showAdminAlreadyCreated():(this._retrieveContentDirectory().then(a.hitch(this,function(b){this._contentDir=b&&b.contentDirPath?b.contentDirPath:this.defaultContentDirectory;this._logsDir=b&&b.logsDirPath?b.logsDirPath:this.defaultLogsDirectory;this._isUpgrade=b&&b.isUpgrade?b.isUpgrade:!1;this._contentDirInput.set("value",this._contentDir);a.style(this._createJoinContainer,
"display","");this._contentDirInput.set("disabled",this._isUpgrade)}),a.hitch(this,function(b){console.log("Error retrieving content directory from Portal Admin API. Using default content directory.",b);this._contentDirInput.set("value",this.defaultContentDirectory);a.style(this._createJoinContainer,"display","")})),a.style(this._createJoinContainer,"display",""))}))}))},_retrieveContentDirectory:function(){return esri.request({url:this._baseUrl+"/portaladmin/createNewSite",content:{f:"json"},timeout:0}).promise},
_showAdminAlreadyCreated:function(){a.attr(a.byId("createIAATitle"),"innerHTML",this.i18n.initialAdminAccountSetup);var b=this.i18n.adminAlreadySetup+'\x3cbr/\x3e\x3cbr/\x3e\x3cspan class\x3d"esriItemLinks"\x3e\x3ca href\x3d"'+esriGeowConfig.baseUrl+esriGeowConfig.signin+'"\x3e'+this.i18n.signIn+"\x3c/a\x3e\x3c/span\x3e";a.attr(a.byId("_createSiteDescription"),"innerHTML",b);a.style(this._form.domNode,"display","none");a.style(this._createSiteContainer,"display","")},_validatesJoin:function(){var a=
this._portalUrlInput.get("value"),c=this._joinUsernameInput.get("value"),d=this._joinPasswordInput.get("value");return!esri.isDefined(a)||0===a.length?(this._portalUrlInput.focus(),!this._showError(this.i18n.errors.required.joinPortalUrl)):!esri.isDefined(c)||0===c.length?(this._joinUsernameInput.focus(),!this._showError(this.i18n.errors.required.joinUsername)):!esri.isDefined(d)||0===d.length?(this._joinPasswordInput.focus(),!this._showError(this.i18n.errors.required.joinPassword)):!0},_validates:function(){var a=
this._firstnameInput.get("value");if(!esri.isDefined(a)||0===a.length)return this._firstnameInput.focus(),!this._showError(this.i18n.errors.required.firstname);a=this._lastnameInput.get("value");if(!esri.isDefined(a)||0===a.length)return this._lastnameInput.focus(),!this._showError(this.i18n.errors.required.lastname);a=this._emailInput.get("value");if(!esri.isDefined(a)||0===a.length)return this._emailInput.focus(),!this._showError(this.i18n.errors.required.email);var c=this._confirmEmailInput.get("value");
if(!esri.isDefined(c)||0===c.length)return this._confirmEmailInput.focus(),!this._showError(this.i18n.errors.required.confirmEmail);if(a!==c)return this._emailInput.focus(),!this._showError(this.i18n.errors.emailAddressesNotMatch);a=this._usernameInput.get("value");if(!esri.isDefined(a)||0===a.length)return this._usernameInput.focus(),!this._showError(this.i18n.errors.required.username);if(a&&(4>a.length||24<a.length))return this._usernameInput.focus(),!this._showError(this.i18n.errors.invalidUsername);
a=this._passwordInput.get("value");if(!esri.isDefined(a)||0===a.length)return this._passwordInput.focus(),!this._showError(this.i18n.errors.required.password);if(a&&(8>a.length||28<a.length))return this._passwordInput.focus(),!this._showError(this.i18n.errors.invalidPassword);c=this._repeatPasswordInput.get("value");if(!esri.isDefined(c)||0===c.length)return this._repeatPasswordInput.focus(),!this._showError(this.i18n.errors.required.verify);if(a&&c&&a!==c)return this._repeatPasswordInput.focus(),
!this._showError(this.i18n.errors.passwordsNotMatch);if(!this._identityQuestionID||1>this._identityQuestionID)return!this._showError(this.i18n.errors.required.identityQuestion);a=this._identityAnswerInput.get("value");if(!esri.isDefined(a)||0===a.length)return this._identityAnswerInput.focus(),!this._showError(this.i18n.errors.required.identityAnswer);if(60<a.length)return this._identityAnswerInput.focus(),!this._showError(this.i18n.errors.identityAnswerTooLong);a=this._contentDirInput.get("value");
return!esri.isDefined(a)||0===a.length?(this._contentDirInput.focus(),!this._showError(this.i18n.errors.required.contentDir)):!0},_showError:function(a){this._errorDlg.show(a);return!0},_setCreating:function(b){this._createBackBtn.set("disabled",b);this._createAdminBtn.set("disabled",b);a.style(this._creatingSpinner,"visibility",b?"visible":"hidden")},_setJoining:function(b){this._joinBackBtn.set("disabled",b);this._joinPortalBtn.set("disabled",b);a.style(this._joiningSpinner,"visibility",b?"visible":
"hidden")},onIdentityQuestionChange:function(b){var c=this._identityQuestionInput.get("store"),d;c.fetch({onComplete:a.hitch(this,function(a){for(d=0;d<a.length;d++)if(b==c.getValue(a[d],"name")){this._identityQuestionID=c.getValue(a[d],"id");break}})})},waitAndCheck:function(a,c){var d=this;setTimeout(function(){d.checkIfUp().then(function(a){d._errorDlg.hide();esri.isDefined(c)?window.location=c:window.location=d.util.getSecureUrl(esriGeowConfig.baseUrl)+"error.html?c\x3dWebAdaptorRequired"},function(h){esri.isDefined(c)?
d.waitAndCheck(a,c):d.waitAndCheck(a)})},a)},checkIfUp:function(){var b=new a.Deferred;esri.request({url:esriGeowConfig.restBaseUrl,content:{f:"json"}}).then(a.hitch(this,function(a){b.resolve(a)}),a.hitch(this,function(a){b.reject(a)}));return b},onCreateSiteClick:function(b){a.attr(a.byId("createIAATitle"),"innerHTML",this.i18n.createPortalSite);a.style(this._createJoinContainer,"display","none");a.style(this._joinSiteContainer,"display","none");a.style(this._createSiteContainer,"display","")},
onJoinSiteClick:function(b){a.attr(a.byId("createIAATitle"),"innerHTML",this.i18n.joinPortalSite);a.style(this._createJoinContainer,"display","none");a.style(this._createSiteContainer,"display","none");a.style(this._joinSiteContainer,"display","")},onBackClick:function(b){a.attr(a.byId("createIAATitle"),"innerHTML",this.i18n.createOrJoin);a.style(this._createSiteContainer,"display","none");a.style(this._joinSiteContainer,"display","none");a.style(this._createJoinContainer,"display","")},onJoinPortal:function(){if(this._validatesJoin()){this._setJoining(!0);
var b=this._portalUrlInput.get("value"),c=this._joinUsernameInput.get("value"),d=this._joinPasswordInput.get("value");esri.request({url:this._baseUrl+"/portaladmin/joinSite",content:{f:"json",username:c,password:d,machineAdminUrl:b},timeout:0},{usePost:!0}).then(a.hitch(this,function(c){this._setJoining(!1);this._errorDlg.onOkClick=a.hitch(this,function(){var d=f.byId("button_general-close"),g=c.recheckAfterSeconds?1E3*c.recheckAfterSeconds:1E4;d.set("label",this.i18n.waiting);d.set("disabled",!0);
a.create("img",{src:this.util.relativeToExplicitUrl("js/arcgisonline/css/images/spinner20.gif"),width:"14",height:"14",style:{verticalAlign:"middle"}},d.domNode,"after");this.waitAndCheck(g,b)});this._errorDlg.show({title:this.i18n.portalJoined,message:"\x3cp\x3e"+this.i18n.portalJoinedSuccess+"\x3c/p\x3e\x3cp\x3e"+this.i18n.portalRestarting+"\x3c/p\x3e\x3cp\x3e"+this.i18n.afterJoinRestart+"\x3c/p\x3e"})}),a.hitch(this,function(b){console.log(this.i18n.errors.joining.message,b);this._setJoining(!1);
var c=a.clone(this.i18n.errors.joining);c.message+="\x3cp\x3e"+esri.substitute({contentDir:this._logsDir},this.i18n.forMoreInfo)+"\x3c/p\x3e";if(b&&b.code&&b.message)c.message=this.i18n.errors.joining.message+"\x3cp\x3e"+b.message+"\x3c/p\x3e",this._showError(c);else if(500===b.status&&b.responseText)try{var d=a.json.parse(b.responseText);d.error&&(errorObj.error.code&&d.error.message)&&(c.message=this.i18n.errors.joining.message+"\x3cp\x3e"+d.error.message+"\x3c/p\x3e",this._showError(c))}catch(f){this._showError(c)}else this._showError(c)}))}},
onCreateAdmin:function(){if(this._validates()){this._setCreating(!0);var b=this._firstnameInput.get("value"),c=this._lastnameInput.get("value"),d=this._emailInput.get("value"),h=this._usernameInput.get("value"),k=this._passwordInput.get("value"),g=this._identityAnswerInput.get("value"),l=this._baseUrl+"/portaladmin/createNewSite",m="ja"===a.locale?c+" "+b:b+" "+c,n=this._contentDirInput.get("value");esri.request({url:l,content:{f:"json",fullname:m,firstname:b,lastname:c,email:d,username:h,password:k,
securityQuestionIdx:this._identityQuestionID,securityAnswer:g,contentDir:n},timeout:0},{usePost:!0}).then(a.hitch(this,function(b){this._setCreating(!1);this._errorDlg.onOkClick=a.hitch(this,function(){var c=f.byId("button_general-close"),d=b.recheckAfterSeconds?1E3*b.recheckAfterSeconds:1E4;c.set("label",this.i18n.waiting);c.set("disabled",!0);a.create("img",{src:this.util.relativeToExplicitUrl("js/arcgisonline/css/images/spinner20.gif"),width:"14",height:"14",style:{verticalAlign:"middle"}},c.domNode,
"after");this.waitAndCheck(d)});this._errorDlg.show({title:this.i18n.accountCreated,message:"\x3cp\x3e"+this.i18n.accountCreatedSuccess+"\x3c/p\x3e\x3cp\x3e"+this.i18n.portalRestarting+"\x3c/p\x3e\x3cp\x3e"+this.i18n.installWebAdaptor+"\x3c/p\x3e\x3cp\x3e"+this.i18n.afterConfigWebAdaptor+"\x3c/p\x3e"})}),a.hitch(this,function(b){console.log(this.i18n.errors.error.message,b);this._setCreating(!1);var c="\x3cp\x3e"+esri.substitute({contentDir:this._logsDir},this.i18n.forMoreInfo)+"\x3c/p\x3e",d=a.clone(this.i18n.errors.error);
if(b.code&&b.message&&-1<b.message.indexOf("ASCII"))this._showError({title:this.i18n.errors.error.title,message:b.message});else if(b.code&&b.message)d.message+="\x3cp\x3e"+b.message+"\x3c/p\x3e",d.message+=c,this._showError(d);else if(500===b.status&&b.responseText)try{var e=a.json.parse(b.responseText);e.error.code&&e.error.message&&-1<e.error.message.indexOf("ASCII")?this._showError({title:this.i18n.errors.error.title,message:e.error.message}):(e.error.code&&e.error.message&&(d.message+="\x3cp\x3e"+
e.error.message+"\x3c/p\x3e"),d.message+=c,this._showError(d))}catch(f){d.message+=c,this._showError(d)}else d.message+=c,this._showError(d)}))}}})});