// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/dialog/MdSliderSettingsDlg",["dijit","dojo","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,dijit/form/Select,dijit/Tooltip,dojox/form/HorizontalRangeSlider,arcgisonline/sharing/dijit/HelpManager,arcgisonline/sharing/dijit/dialog/GeneralDlg"],function(g,a,l){a.provide("arcgisonline.sharing.dijit.dialog.MdSliderSettingsDlg");a.require("dijit.Dialog");a.require("dijit._Widget");a.require("dijit._Templated");a.require("dijit.form.Select");a.require("dijit.Tooltip");
a.require("dojox.form.HorizontalRangeSlider");a.require("arcgisonline.sharing.dijit.HelpManager");a.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");a.declare("arcgisonline.sharing.dijit.dialog.MdSliderSettingsDlg",[g._Widget,g._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" dojoAttachPoint\x3d"_mdSliderSettingsDialog" title\x3d"${i18n.mdSliderSettingsDlgTitle}" doLayout\x3d"false" execute\x3d"" style\x3d"width: 630px;"\x3e\r\n    \x3ctable style\x3d"width: 600px;"\x3e\r\n      \x3ccolgroup\x3e\r\n        \x3ccol style\x3d"width:25%"\x3e\r\n        \x3ccol style\x3d"width:25%"\x3e\r\n        \x3ccol style\x3d"width:25%"\x3e\r\n        \x3ccol style\x3d"width:25%"\x3e        \r\n      \x3c/colgroup\x3e\r\n      \x3ctbody style\x3d"width: 100%;"\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd\x3e\x3clabel\x3e${i18n.dimension}\x3c/label\x3e\x3c/td\x3e\r\n          \x3ctd\x3e\x3cdiv style\x3d"width: 100%;" dojoType\x3d"dijit.form.Select" dojoAttachPoint\x3d"_dimensionSelect" dojoAttachEvent\x3d"onChange: _handleDimensionChange"\x3e\x3c/div\x3e\x3c/td\x3e\r\n          \x3ctd\x3e\x3cdiv style\x3d"margin-left: 5px;" dojoType\x3d"dijit.form.CheckBox" checked\x3d"checked" dojoAttachPoint\x3d"_reverseAnimationCheckBox"\x3e\x3c/div\x3e\r\n            \x3clabel\x3e${i18n.reverseAnimation}\x3c/label\x3e\x3c/td\x3e\r\n          \x3ctd style\x3d"height: 16px;"\x3e\r\n            \x3cdiv dojoType\x3d"dijit.form.CheckBox" checked\x3d"checked" dojoAttachPoint\x3d"_useRangeCheckBox" dojoAttachEvent\x3d"onChange: _handleUseRangeChange"\x3e\x3c/div\x3e\r\n            \x3clabel\x3e${i18n.useDimensionRange}\x3c/label\x3e\r\n            \x3cdiv class\x3d"esriMdSliderHasRangesInfo" id\x3d"mdSliderDlgHasRangesInfo" dojoAttachPoint \x3d"_mdSliderDlgHasRangesInfo"\x3e\x3c/div\x3e\r\n            \x3cdiv data-dojo-type\x3d"dijit.Tooltip" data-dojo-props\x3d"connectId:\'mdSliderDlgHasRangesInfo\',position:[\'after\']"\x3e\r\n                 \x3cdiv\x3e\r\n                   ${i18n.hasRangesInfoText1}\x3cbr/\x3e\r\n                   ${i18n.hasRangesInfoText2}\r\n                 \x3c/div\x3e\r\n               \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"4" style\x3d"padding-top: 10px;"\x3e\r\n            \x3clabel style\x3d"font-weight: bold;"\x3e${i18n.playbackSpeed}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"4"\x3e\r\n            \x3cdiv dojoType\x3d"dijit.form.HorizontalSlider" dojoAttachEvent\x3d"onChange: _onPlaybackSpeedChange" dojoAttachPoint\x3d"_mdSpeedSlider" style\x3d"width: 600px; margin:3px; " showbuttons\x3d"false" value\x3d"1" minimum\x3d"0" maximum\x3d"4" discretevalues\x3d"1" intermediatechanges\x3d"true"\x3e\r\n              \x3cdiv dojoType\x3d"dijit.form.HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\x3c/div\x3e\r\n              \x3col data-dojo-type\x3d"dijit.form.HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"height:1em;font-size:75%;color:gray;"\x3e\r\n                \x3cli\x3e${i18n.slower}\x3c/li\x3e\r\n                \x3cli\x3e${i18n.faster}\x3c/li\x3e\r\n              \x3c/ol\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"4"\x3e\r\n            \x3cdiv dojoAttachPoint\x3d"_mdAdvancedLink" style\x3d"padding-top:15px;" class\x3d"esriItemLinks esriFloatLeading"\x3e\x3ca href\x3d"JavaScript:void(0);" dojoAttachEvent\x3d"onclick:_showAdvanced"\x3e${i18n.showAdvancedOptions}\x3c/a\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"advancedSettingsTable" style\x3d"width: 600px; display: none;"\x3e\r\n      \x3ctable\x3e\r\n      \x3ccolgroup\x3e\r\n        \x3ccol style\x3d"width:25%"\x3e\r\n        \x3ccol style\x3d"width:25%"\x3e\r\n        \x3ccol style\x3d"width:25%"\x3e\r\n        \x3ccol style\x3d"width:25%"\x3e        \r\n      \x3c/colgroup\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"4" style\x3d"padding-top: 10px;"\x3e\r\n            \x3clabel style\x3d"font-weight: bold;"\x3e${i18n.dimensionRange}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"4" style\x3d"padding-top: 7px;"\x3e\r\n            \x3cdiv dojoType\x3d"dijit.form.CheckBox" dojoAttachEvent\x3d"onChange: _disableDimRangeControls" dojoAttachPoint\x3d"_useDimSlices" checked\x3d"checked"\x3e\x3c/div\x3e\r\n            \x3clabel\x3e${i18n.useDimensionSlices}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3c/table\x3e\r\n      \x3ctable dojoAttachPoint \x3d "_dimensionRangeControls" style\x3d"width: 100%; display: table;"\x3e\r\n        \x3ccolgroup\x3e\r\n        \x3ccol style\x3d"width:25%"\x3e\r\n        \x3ccol style\x3d"width:25%"\x3e\r\n        \x3ccol style\x3d"width:25%"\x3e\r\n        \x3ccol style\x3d"width:25%"\x3e        \r\n      \x3c/colgroup\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"4" style\x3d"padding-bottom: 7px;"\x3e\r\n            \x3clabel \x3e${i18n.dimensionRangeDesc}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"1"\x3e\r\n            \x3clabel\x3e${i18n.layers}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3clabel\x3e${i18n.layerDimensionRanges}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr height\x3d"5"\x3e\r\n          \x3ctd height\x3d"5" colspan\x3d"4"\x3e\r\n            \x3cdiv style\x3d"height:1px;border-top:#444444 1px solid;"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd valign\x3d"top"\x3e\r\n            \x3cdiv dojoAttachPoint\x3d"_mdLayerNamesDiv" class\x3d"mdSliderSettingsLayerNames"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" colspan\x3d"3"\x3e\r\n            \x3cdiv style\x3d"position: relative;" valign\x3d"top"\x3e\r\n              \x3cdiv dojoAttachPoint\x3d"_mdSettingsBkgrndDiv" class\x3d"mdSettingsBackground" style\x3d"position:absolute; z-index:0;"\x3e\x3c/div\x3e\r\n              \x3cdiv dojoAttachPoint\x3d"_mdSettingsLyrRangeDiv" class\x3d"mdSettingsLayerRange" style\x3d"position:relative; z-index:10;" \x3e\x3c/div\x3e\r\n              \x3cdiv style\x3d"width:100%;"\x3e\r\n              \x3cdiv id\x3d"mdSettingsSliderDiv" style\x3d"margin-right:8px;"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr style\x3d"height: 10px"\x3e\r\n         \x3ctd colspan\x3d"4" style\x3d"height: 10px"\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd\x3e\x3c/td\x3e\r\n          \x3ctd colspan\x3d"1"\x3e\x3clabel\x3e${i18n.start}\x3c/label\x3e\x3c/td\x3e\r\n          \x3ctd colspan\x3d"1"\x3e\x3cdiv style\x3d"width: 100%; height: 22px; padding: 2px; box-sizing: border-box; margin-top: 7px;" dojoType\x3d"dijit.form.NumberTextBox" dojoAttachPoint\x3d"_dimRangeStart" constraints\x3d"{places: 10}"\x3e\x3c/div\x3e\x3c/td\x3e\r\n          \x3ctd\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd\x3e\x3c/td\x3e\r\n          \x3ctd colspan\x3d"1"\x3e\x3clabel\x3e${i18n.end}\x3c/label\x3e\x3c/td\x3e\r\n          \x3ctd colspan\x3d"1"\x3e\x3cdiv style\x3d"width: 100%; height: 22px; padding: 2px; box-sizing: border-box;" dojoType\x3d"dijit.form.NumberTextBox" dojoAttachPoint\x3d"_dimRangeEnd" constraints\x3d"{places: 10}"\x3e\x3c/div\x3e\x3c/td\x3e\r\n          \x3ctd\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"4" style\x3d"padding-top: 10px;"\x3e\r\n            \x3clabel style\x3d"font-weight: bold;"\x3e${i18n.interval}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"4"\x3e\r\n            \x3clabel\x3e${i18n.intervalDesc}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"4"\x3e\r\n            \x3clabel\x3e${i18n.displayData}\x3c/label\x3e \r\n            \x3cdiv style\x3d"height: 22px; width: 100px; padding: 2px; box-sizing: border-box;" dojoType\x3d"dijit.form.NumberTextBox" dojoAttachPoint\x3d"_dimInterval"\x3e\x3c/div\x3e\r\n            \x3clabel  dojoAttachPoint\x3d"_unitLabel" style\x3d"font-weight: 700"\x3e${i18n.unknownUnit}\x3c/label\x3e\r\n            \x3clabel\x3e${i18n.intervals}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/table\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_mdSettingsHelp" style\x3d"padding-top:15px; display:none;" class\x3d"esriItemLinks esriFloatLeading"\x3e\x3ca dojoAttachPoint\x3d"_helpLink" href\x3d"" target\x3d"_blank" title\x3d"${i18n.learnMore}"\x3e\x3cdiv class\x3d"questionMarkIcon"\x3e\x3c/div\x3e\x3c/A\x3e\x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n      \x3cbutton class\x3d"jevent primary" dojoType\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:_handleOkBtnClick"\x3e${i18n.ok}\x3c/button\x3e\r\n      \x3cbutton class\x3d"jevent cancel" dojoType\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:_handleCloseBtnClick"\x3e${i18n.cancel}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv style\x3d"clear:both;"\x3e\x3c/div\x3e  \r\n    \r\n    \x3cdiv dojotype\x3d"dijit.TooltipDialog" dojoAttachPoint\x3d"_tooltipDialog" title\x3d"" style\x3d"display:none;width:400px;"\x3e\r\n      \x3c!--\x3cdiv style\x3d"float:right;"\x3e\x3cA id\x3d"time-settings-tooltip-close" href\x3d"JavaScript:void(0);" title\x3d"Close"\x3e\x3cimg src\x3d"images/close.gif" border\x3d"0"/\x3e\x3c/A\x3e\x3c/div\x3e--\x3e\r\n      \x3cdiv class\x3d"esriItemLinks"\x3e\x3ca dojoAttachPoint\x3d"mdSettingsTipStart"  href\x3d"JavaScript:void(0);"\x3e\x3c/A\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"esriItemLinks"\x3e\x3ca  dojoAttachPoint\x3d"mdSettingsTipEnd" href\x3d"JavaScript:void(0);"\x3e\x3c/A\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.MdSliderSettingsDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.i18n.getLocalization("arcgisonline","arcgisonline").common;a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").generalDlg);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").MdSliderSettingsDlg)},show:function(a){this._loadConnectionsPart1();
this._showAdvanced(!1);this._disableShowAdvanced();this._mdSliderSettingsDialog.show()},_disableShowAdvanced:function(){arcgisonline.map.multiDimensions.mdSlider.hasUnitConflict()?a.style(this._mdAdvancedLink,"display","none"):a.style(this._mdAdvancedLink,"display","block")},_showAdvanced:function(c){"undefined"==typeof c||c?(a.style(this.advancedSettingsTable,"display","block"),a.style(this._mdAdvancedLink,"display","none"),this._loadConnectionsPart2(),this.adjustSliderBackground()):(a.style(this.advancedSettingsTable,
"display","none"),a.style(this._mdAdvancedLink,"display","block"));this._mdSliderSettingsDialog._position()},_onPlaybackSpeedChange:function(a){},_handleOkBtnClick:function(){this._saveSettings();this._mdSliderSettingsDialog.hide()},_handleCloseBtnClick:function(){this._mdSliderSettingsDialog.hide()},_loadConnectionsPart1:function(){this._loadDimensions();this._loadSliderSpeed();this._loadUseRanges();this._loadAnimationDirection()},_loadConnectionsPart2:function(){this._loadUseMapDimensionValues();
this._createDimensionRangeSlider();this._disableDimRangeControls(this._useDimSlices.checked);this._rebuildBars()},_loadDimensions:function(){this._dimensionStore=new a.data.ObjectStore({objectStore:new a.store.Memory({data:arcgisonline.map.multiDimensions.getNumericDimensions()})});this._dimensionSelect.set("store",this._dimensionStore);this._dimensionSelect.set("value",arcgisonline.map.multiDimensions.mdSlider.dimension)},_loadUseMapDimensionValues:function(){this._useDimSlices.set("checked",arcgisonline.map.multiDimensions.mdSlider.useLayersDimSlices);
this._disableDimRangeControls(this._useDimSlices.checked)},_loadUseRanges:function(){var c=arcgisonline.map.multiDimensions.mdSlider._snap?"inline-block":"none";this._useRangeCheckBox.set("checked",arcgisonline.map.multiDimensions.mdSlider.useRanges);a.setStyle(this._mdSliderDlgHasRangesInfo,"display",c)},_loadSliderSpeed:function(){this._mdSpeedSlider.set("value",5-arcgisonline.map.multiDimensions.mdSlider.thumbMovingRate/1E3)},_loadAnimationDirection:function(){this._reverseAnimationCheckBox.set("checked",
!arcgisonline.map.multiDimensions.mdSlider.playDirectionAscending)},_validateUserRange:function(a){if(!a)return!1;var b=arcgisonline.map.multiDimensions.mdSlider.getFullDimensionRange(this._dimensionSelect.value);return b&&(b.length&&1<b.length)&&!(a[0]>=b[0]&&a[0]<=b[1]&&a[1]>=b[0]&&a[1]<=b[1])?!1:!0},_saveSettings:function(){var c=this._mdSpeedSlider.getValue(),c=Math.round(1E3*(5-c)),b=!esri.isDefined(this._dimInterval.value)||isNaN(this._dimInterval.value)||0==this._dimInterval.value?null:this._dimInterval.value;
arcgisonline.map.multiDimensions.mdSlider.setThumbMovingRate(c);var d;arcgisonline.map.multiDimensions.mdSlider.getFullDimensionRange(this._dimensionSelect.value);if(!this._useDimSlices.checked&&b){d=[this._dimRangeStart.value,this._dimRangeEnd.value];this._validateUserRange(d)&&this._useDimSlices.set("checked",!1);b>d[1]-d[0]&&(b=d[1]-d[0]);var e=arcgisonline.map.multiDimensions.createDimensionValues(this._dimensionRangeSlider.value,b);(!e||!e.length)&&this._useDimSlices.set("checked",!0)}else b||
this._useDimSlices.set("checked",!0);arcgisonline.map.multiDimensions.mdSliderProperties={thumbMovingRate:c,dimension:this._dimensionSelect.value,dimensionRange:d,useRanges:this._useRangeCheckBox.checked,dimensionInterval:b,nLabels:10,playDirectionAscending:!this._reverseAnimationCheckBox.checked};arcgisonline.map.multiDimensions.mdSlider.useLayersDimSlices=this._useDimSlices.checked;this._dimensionSelect.value!=arcgisonline.map.multiDimensions.mdSlider.dimension&&a.forEach(arcgisonline.map.main.mapLayers,
function(a){a&&a.layer&&(arcgisonline.map.multiDimensions.addActiveDimension(a.layer,this._dimensionSelect.value),arcgisonline.map.multiDimensions.removeActiveDimension(a.layer))},this);arcgisonline.map.multiDimensions.mdSlider.useRanges=this._useRangeCheckBox.checked;arcgisonline.map.multiDimensions.mdSlider.playDirectionAscending=!this._reverseAnimationCheckBox.checked;arcgisonline.map.multiDimensions.deactivateSlider();arcgisonline.map.multiDimensions.mdSlider.set("dimension",{dimension:this._dimensionSelect.value,
dimensionValues:e});arcgisonline.map.multiDimensions.removeHandles();arcgisonline.map.multiDimensions.setupHandles()},_createDimensionRangeSlider:function(){var c=this,b;if(this._dimensionRangeSlider){this._dimensionRangeSlider.destroy(!0);this._dimensionRangeSlider=null;for(var d=a.byId("mdSettingsSliderDiv");d.firstChild;)d.removeChild(d.firstChild)}var d=this._getMapDimensionExtent(this._dimensionSelect.value),e=this._useDimSlices.checked;this._dimensionSelect.value==arcgisonline.map.multiDimensions.mdSlider.dimension?
(b=arcgisonline.map.multiDimensions.mdSlider.dimensionValues,b=[b[0],b[b.length-1]]):b=d;d&&2==d.length&&(this._dimensionRangeSlider=new l.form.HorizontalRangeSlider({minimum:d[0],maximum:d[1],value:b,style:"margin-right: 8px; width: 100%;",showButtons:!1,disabled:e,onChange:function(a){c._dimRangeStart.set("value",a[0]);c._dimRangeEnd.set("value",a[1]);c.adjustSliderBackground()}},"mdSettingsSliderDiv"),this._dimRangeStart.set("constraints",{min:d[0],max:d[1],places:[0,10],pattern:"#0.##########"}),
this._dimRangeEnd.set("constraints",{min:d[0],max:d[1],places:[0,10],pattern:"#0.##########"}),this._dimRangeStart.set("value",b[0]),this._dimRangeEnd.set("value",b[1]),arcgisonline.map.multiDimensions.mdSliderProperties.dimensionInterval?this._dimInterval.set("value",arcgisonline.map.multiDimensions.mdSliderProperties.dimensionInterval):this._dimInterval.set("value",1),this._unit=arcgisonline.map.multiDimensions.mdSlider.getUnit(),this._unitLabel.innerHTML=this._unit?this._unit:this.i18n.unknownUnit,
this.startValueChangeConnect=a.connect(this._dimRangeStart,"onChange",this,"setDimRangeValue"),this.startValueChangeConnect=a.connect(this._dimRangeEnd,"onChange",this,"setDimRangeValue"))},setDimRangeValue:function(){var a=[this._dimRangeStart.value,this._dimRangeEnd.value];this._dimensionRangeSlider&&(this._dimensionRangeSlider.valueNode&&this._validateUserRange(a))&&this._dimensionRangeSlider.set("value",[this._dimRangeStart.value,this._dimRangeEnd.value])},_disableDimRangeControls:function(c){var b=
arcgisonline.map.multiDimensions.mdSlider.getFullDimensionRange(this._dimensionSelect.value),d=(c="undefined"==typeof c?!0:c)?"#969696":"#464646";this._dimensionRangeSlider&&(this._dimensionRangeSlider.valueNode&&b)&&(c&&(this._dimensionRangeSlider.set("value",b),this._dimInterval.set("value",1)),this._dimensionRangeSlider.set("disabled",c),this._dimRangeStart.set("disabled",c),this._dimRangeEnd.set("disabled",c),this._dimInterval.set("disabled",c),a.style(this._dimensionRangeControls,"color",d))},
_rebuildBars:function(){var c=arcgisonline.map.multiDimensions.mdSlider.getFullDimensionRange(),b=parseInt(a.style(a.byId("mdSettingsSliderDiv"),"width"))-2-16,d=c/Math.abs(b),e=this._dimensionSelect.value;this._mdSettingsLyrRangeDiv.innerHTML="";this._mdLayerNamesDiv.innerHTML="";a.forEach(arcgisonline.map.main.mapLayers,function(b){if(null!=b&&null!=b.layer&&this._isImageServiceLayer(b.layer)&&this._hasDimension(b.layer,e)){var c=b.title;21<c.length&&(c=c.substring(0,18)+"...");a.create("span",
{innerHTML:c,"class":"timeSettingsLayerNames"},this._mdLayerNamesDiv);a.create("br",{},this._mdLayerNamesDiv);var f=this._getDimensionExtent(b.layer,e),c=Math.round((f[0]-this._dimensionRangeSlider.get("minimum"))/d),k=Math.round((f[1]-f[0])/d),h=a.create("div",{id:"mdBar_"+b.layer.id,"class":"multidimensions-settings-layer-bar"},this._mdSettingsLyrRangeDiv);0<=k&&isNaN(k)&&a.style(h,"width",k+"px");esriGeowConfig.isRightToLeft?a.style(h,"margin","0 "+c+"px 0 0"):a.style(h,"margin","0 0 0 "+c+"px");
a.create("br",{},this._mdSettingsLyrRangeDiv);a.connect(h,"onclick",this,function(b){b.preventDefault();this.mdSettingsTipStart.innerHTML=this.i18n.setStartValue+" "+f[0];this.mdSettingsTipEnd.innerHTML=this.i18n.setEndValue+" "+f[1];a.connect(this.mdSettingsTipStart,"onclick",this,function(a){this._dimRangeStart.set("value",f[0]);g.popup.close(this._tooltipDialog)});a.connect(this.mdSettingsTipEnd,"onclick",this,function(a){this._dimRangeEnd.set("value",f[1]);g.popup.close(this._tooltipDialog)});
g.popup.open({popup:this._tooltipDialog,around:h});b||(b=window.event);b.cancelBubble=!0;b.stopPropagation&&b.stopPropagation()})}},this)},_isImageServiceLayer:function(a){return a instanceof esri.layers.ArcGISImageServiceLayer||a instanceof esri.layers.ArcGISImageServiceVectorLayer},_hasDimension:function(c,b){if(!c||!b)return!1;var d=!1;c.multidimensionalInfo&&(c.visible&&c.useMapDimensionValue)&&a.forEach(c.multidimensionalInfo.variables,function(c){a.some(c.dimensions,function(a){return a.name===
b})&&(d=!0)});return d},_getDimensionExtent:function(c,b){var d=[];a.forEach(c.multidimensionalInfo.variables,function(c){a.some(c.dimensions,function(a){if(a.name===b){if("undefined"==typeof d[0]||d[0]>a.extent[0])d[0]=a.extent[0];if("undefined"==typeof d[1]||d[1]<a.extent[1])d[1]=a.extent[1];return!0}})});return d},_handleDimensionChange:function(a){this._handleUseRangeChange(this._useRangeCheckBox.checked);this._dimensionRangeSlider&&(a=arcgisonline.map.multiDimensions.getUnit(a),this._createDimensionRangeSlider(),
this._rebuildBars(),this._unitLabel.innerHTML=a?a:this.i18n.unknownUnit)},_getMapDimensionExtent:function(c){var b=[],d;a.forEach(arcgisonline.map.main.mapLayers,function(a){if(this._hasDimension(a.layer,c)){d=this._getDimensionExtent(a.layer,c);if("undefined"==typeof b[0]||b[0]>d[0])b[0]=d[0];if("undefined"==typeof b[1]||b[1]<d[1])b[1]=d[1]}},this);return b},adjustSliderBackground:function(c){if(this._dimensionRangeSlider){var b=a.coords(this._mdSettingsLyrRangeDiv),d=a.coords(this._dimensionRangeSlider.progressBar);
a.style(this._mdSettingsBkgrndDiv,"top","0px");0<d.x-b.x&&a.style(this._mdSettingsBkgrndDiv,"left",d.x-b.x+"px");0<d.w&&a.style(this._mdSettingsBkgrndDiv,"width",d.w+"px");0<d.y-b.y+5&&a.style(this._mdSettingsBkgrndDiv,"height",d.y-b.y+5+"px");c||setTimeout(a.hitch(this,function(){this.adjustSliderBackground(!0)}),500)}},_handleUseRangeChange:function(c){if(c)a.style(this._mdSliderDlgHasRangesInfo,"display","none");else{var b=!0,d=this._dimensionSelect.value;a.forEach(arcgisonline.map.main.mapLayers,
function(c){c.multidimensionalInfo&&a.forEach(c.multidimensionalInfo.variables,function(c){a.forEach(c.dimensions,function(a){a.name==d&&!a.hasRanges&&(b=!1)},this)},this)},this);b?a.style(this._mdSliderDlgHasRangesInfo,"display","inline-block"):a.style(this._mdSliderDlgHasRangesInfo,"display","none")}}})});