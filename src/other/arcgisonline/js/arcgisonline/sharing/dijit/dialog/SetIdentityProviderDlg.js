// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/dialog/SetIdentityProviderDlg",["dijit","dojo","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,dijit/form/TextBox,dijit/form/Button,dijit/form/CheckBox,dijit/form/SimpleTextarea,dijit/form/FilteringSelect,dojo/Deferred,dojo/DeferredList,dojo/store/Memory,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/util,arcgisonline/sharing/geow/Roles"],function(f,a,k){a.provide("arcgisonline.sharing.dijit.dialog.SetIdentityProviderDlg");a.require("dijit.Dialog");
a.require("dijit._Widget");a.require("dijit._Templated");a.require("dijit.form.TextBox");a.require("dijit.form.Button");a.require("dijit.form.CheckBox");a.require("dijit.form.SimpleTextarea");a.require("dijit.form.FilteringSelect");a.require("dojo.Deferred");a.require("dojo.DeferredList");a.require("dojo.store.Memory");a.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");a.require("arcgisonline.sharing.util");a.require("arcgisonline.sharing.geow.Roles");a.declare("arcgisonline.sharing.dijit.dialog.SetIdentityProviderDlg",
[f._Widget,f._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv class\x3d"${baseClass}" data-dojo-type\x3d"dijit.Dialog" id\x3d"set-identity-provider-dialog" title\x3d"${i18n.setIdentityProviderTitle}" execute\x3d""\x3e\r\n    \x3cform data-dojo-attach-point\x3d"_form" enctype\x3d"multipart/form-data" method\x3d"post" onsubmit\x3d"return false;"\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_signUpMode" name\x3d"signUpMode" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_bindingType" name\x3d"bindingType" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_roleSelection" name\x3d"roleId" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_supportEncryption" name\x3d"encryptionSupported" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_supportSignedRequest" name\x3d"supportSignedRequest" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_clearEmptyFields" name\x3d"clearEmptyFields" type\x3d"hidden" value\x3d"false"/\x3e\r\n\r\n      \x3cdiv data-dojo-attach-point\x3d"_description"\x3e\x3c/div\x3e\r\n      \x3cbr\x3e\r\n      \x3cspan\x3e${i18n.nameLabel}\x3c/span\x3e\x3cbr\x3e\r\n      \x3cdiv name\x3d"name" data-dojo-attach-point\x3d"_nameInput" type\x3d"text" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n      \x3cbr\x3e\x3cbr\x3e\r\n\r\n      \x3cspan\x3e${i18n.signUpLabel}\x3c/span\x3e\x3cbr\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_signUpModeOptions"\x3e\r\n        \x3cdiv id\x3d"automatic-option" name\x3d"signUpModeOption" type\x3d"radio"\r\n             data-dojo-attach-point\x3d"_automaticOption" data-dojo-type\x3d"dijit.form.RadioButton"\r\n             data-dojo-attach-event\x3d"onClick:onAutomaticClicked"\x3e\x3c/div\x3e \x3clabel data-dojo-attach-point\x3d"_automaticOptionLabel" for\x3d"automatic-option"\x3e${i18n.automaticOption}\x3c/label\x3e\r\n        \x3cdiv id\x3d"invite-option" name\x3d"signUpModeOption" type\x3d"radio"\r\n             data-dojo-attach-point\x3d"_inviteOption" data-dojo-type\x3d"dijit.form.RadioButton"\r\n             data-dojo-attach-event\x3d"onClick:onInvitationClicked" data-dojo-props\x3d"checked:true"\x3e\x3c/div\x3e \x3clabel data-dojo-attach-point\x3d"_inviteOptionLabel" for\x3d"invite-option"\x3e${i18n.onInviteOption}\x3c/label\x3e\r\n      \x3c/div\x3e\r\n      \x3cbr\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_roleOptions"\x3e\r\n        \x3cspan\x3e${i18n.roleAssigned}\x3c/span\x3e\x26nbsp;\r\n        \x3cselect id\x3d"role-option" data-dojo-attach-point\x3d"_roleSelect" data-dojo-type\x3d"dijit.form.FilteringSelect" data-dojo-props\x3d"fetchProperties:{sort:[{attribute:\'name\',descending:false}]}"\x3e\x3c/select\x3e\x3cbr\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cspan\x3e${i18n.sourceLabel}\x3c/span\x3e\x3cbr\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"_sourceOptions"\x3e\r\n        \x3cdiv id\x3d"metadata-url-option" name\x3d"providerOptions" type\x3d"radio" data-dojo-attach-point\x3d"_metadataUrlOption" data-dojo-type\x3d"dijit.form.RadioButton" checked\x3d"true"\x3e\x3c/div\x3e \x3clabel for\x3d"metadata-url-option"\x3e${i18n.metadataUrlOption}\x3c/label\x3e\r\n        \x3cdiv id\x3d"metadata-file-option" name\x3d"providerOptions" type\x3d"radio" data-dojo-attach-point\x3d"_metadataFileOption" data-dojo-type\x3d"dijit.form.RadioButton"\x3e\x3c/div\x3e \x3clabel for\x3d"metadata-file-option"\x3e${i18n.metadataFileOption}\x3c/label\x3e\r\n        \x3cdiv id\x3d"parameters-option" name\x3d"providerOptions" type\x3d"radio" data-dojo-attach-point\x3d"_parametersOption" data-dojo-type\x3d"dijit.form.RadioButton"\x3e\x3c/div\x3e \x3clabel for\x3d"parameters-option"\x3e${i18n.parametersOption}\x3c/label\x3e\r\n      \x3c/span\x3e\r\n      \x3cbr\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_sourceInputs"\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_metadataUrlInputs"\x3e\r\n          \x3cspan\x3e${i18n.metadataUrlLabel}\x3c/span\x3e\x3cbr\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_bindingUrlInput" name\x3d"idpMetadataUrl" type\x3d"text" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_metadataFileInputs"\x3e\r\n          \x3cspan\x3e${i18n.metadataFileLabel}\x3c/span\x3e\x3cbr\x3e\r\n          \x3cinput data-dojo-attach-point\x3d"_metadataFileInput" name\x3d"idpMetadataFile" type\x3d"file" title\x3d"${i18n.metadataFilePlaceHolder}"/\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_parametersInputs"\x3e\r\n          \x3cspan\x3e${i18n.parametersUrlLabel}\x3c/span\x3e\x3cbr\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_loginUrlInput" name\x3d"bindingUrl" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n          \x3cbr\x3e\x3cbr\x3e\r\n          \x3cspan\x3e${i18n.parametersPostUrlLabel}\x3c/span\x3e\x3cbr\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_loginUrlPostInput" name\x3d"postBindingUrl" type\x3d"text" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n          \x3cbr\x3e\x3cbr\x3e\r\n          \x3c!--\x3cspan"\x3e${i18n.parametersBindingTypeLabel}\x3c/span\x3e--\x3e\r\n          \x3c!--\x3cdiv id\x3d"binding-type-redirect-option" name\x3d"bindingTypeOptions" data-dojo-attach-point\x3d"_bindingTypeRedirect" type\x3d"radio" data-dojo-type\x3d"dijit.form.RadioButton" data-dojo-attach-point\x3d"_bindingTypeRedirectOption" checked\x3d"true"\x3e\x3c/div\x3e \x3clabel\x3e${i18n.parametersBindingTypeRedirect}\x3c/label\x3e--\x3e\r\n          \x3c!--\x3cdiv id\x3d"binding-type-post-option" name\x3d"bindingTypeOptions" data-dojo-attach-point\x3d"_bindingTypePost" type\x3d"radio" data-dojo-type\x3d"dijit.form.RadioButton" data-dojo-attach-point\x3d"_bindingTypePostOption"\x3e\x3c/div\x3e \x3clabel\x3e${i18n.parametersBindingTypePost}\x3c/label\x3e--\x3e\r\n          \x3c!--\x3cbr\x3e\x3cbr\x3e--\x3e\r\n          \x3cspan\x3e${i18n.parametersCertificateLabel}\x3c/span\x3e\x3cbr\x3e\r\n          \x3ctextarea data-dojo-attach-point\x3d"_certificateInput" name\x3d"certificate" data-dojo-type\x3d"dijit.form.SimpleTextarea" data-dojo-props\x3d"rows:3" title\x3d"${i18n.parametersCertificatePlaceHolder}"\x3e\x3c/textarea\x3e\r\n          \x3cdiv style\x3d"display:none;"\x3e\r\n            \x3cbr\x3e\x3cspan\x3e${i18n.orLabel}\x3c/span\x3e\x3cbr\x3e\x3cbr\x3e\r\n            \x3cspan\x3e${i18n.parametersCertificateFileLabel}\x3c/span\x3e\x3cbr\x3e\r\n            \x3cinput type\x3d"file" data-dojo-attach-point\x3d"_certificateFileInput" name\x3d"certificateFile" title\x3d"${i18n.parametersCertificateFilePlaceHolder}"/\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cbr\x3e\r\n\r\n      \x3c!--\x3cdiv\x3e--\x3e\r\n        \x3c!--\x3cbr\x3e--\x3e\r\n        \x3c!--\x3cspan\x3e--\x3e\r\n          \x3c!--\x3cinput type\x3d"checkbox" id\x3d"encryptionSupported" data-dojo-attach-point\x3d"_encryptionSupported" data-dojo-type\x3d"dijit.form.CheckBox"\x3e--\x3e\r\n          \x3c!--\x3clabel for\x3d"encryptionSupported"\x3e${i18n.encryptionSupported}\x3c/label\x3e--\x3e\r\n        \x3c!--\x3c/span\x3e--\x3e\r\n        \x3c!--\x3cbr\x3e--\x3e\r\n        \x3c!--\x3cspan\x3e--\x3e\r\n          \x3c!--\x3cinput type\x3d"checkbox" id\x3d"supportSignedRequest" data-dojo-attach-point\x3d"_signedRequestSupported" data-dojo-type\x3d"dijit.form.CheckBox"\x3e--\x3e\r\n          \x3c!--\x3clabel for\x3d"supportSignedRequest"\x3e${i18n.supportSignedRequest}\x3c/label\x3e--\x3e\r\n        \x3c!--\x3c/span\x3e--\x3e\r\n        \x3c!--\x3cbr\x3e--\x3e\r\n      \x3c!--\x3c/div\x3e\x3cbr\x3e--\x3e\r\n\r\n      \x3cspan class\x3d"esriItemLinks"\x3e\x3ca data-dojo-attach-point\x3d"_toggleAdvancedSettings" data-dojo-attach-event\x3d"onclick:onToggleAdvancedSettings"\x3e${i18n.showAdvancedSettings}\x3c/a\x3e\x3c/span\x3e\x3cbr\x3e\r\n      \x3cdiv id\x3d"advancedSettings" data-dojo-attach-point\x3d"_advancedSettings"\x3e\r\n        \x3cbr\x3e\r\n        \x3cspan\x3e\r\n          \x3cinput type\x3d"checkbox" id\x3d"encryptionSupported" data-dojo-attach-point\x3d"_encryptionSupported" data-dojo-type\x3d"dijit.form.CheckBox"\x3e\r\n          \x3clabel for\x3d"encryptionSupported"\x3e${i18n.encryptionSupported}\x3c/label\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cspan\x3e\r\n          \x3cinput type\x3d"checkbox" id\x3d"supportSignedRequest" data-dojo-attach-point\x3d"_signedRequestSupported" data-dojo-type\x3d"dijit.form.CheckBox"\x3e\r\n          \x3clabel for\x3d"supportSignedRequest"\x3e${i18n.supportSignedRequest}\x3c/label\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cspan\x3e${i18n.logoutUrlLabel}\x3c/span\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_logoutUrlInput" name\x3d"logoutUrl" type\x3d"text" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e \x3clabel\x3e${i18n.optionalLabel}\x3c/label\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cspan\x3e${i18n.entityIDLabel}\x3c/span\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_entityIDInput" name\x3d"entityId" type\x3d"text" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n        \x3c!--\x3cspan\x3e${i18n.userIdAttrLabel}\x3c/span\x3e\x3cbr\x3e--\x3e\r\n        \x3c!--\x3cdiv data-dojo-attach-point\x3d"_userIdAttrInput" name\x3d"userIdAttribute" type\x3d"text" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-props\x3d"trim:true" title\x3d"${i18n.userIdAttrTooltip}"\x3e\x3c/div\x3e \x3clabel\x3e${i18n.optionalLabel}\x3c/label\x3e--\x3e\r\n      \x3c/div\x3e\r\n      \x3cbr\x3e\x3cbr\x3e\r\n      \x3cdiv class\x3d"esriAlignTrailing" data-dojo-attach-point\x3d"_buttons"\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_setBtn" class\x3d"primary" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.setIdentityProviderLabel}\x3c/button\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_cancelBtn" class\x3d"cancel" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/form\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
baseClass:"esriAGOSetIdentityProviderDlg",util:arcgisonline.sharing.util,SIGN_UP_MODE_AUTOMATIC:"Automatic",SIGN_UP_MODE_INVITE:"Invitation",BINDING_TYPE_REDIRECT:"HTTP_REDIRECT",BINDING_TYPE_POST:"HTTP_POST",orgAdminRole:"org_admin",orgPublisherRole:"org_publisher",orgUserRole:"org_user",_currentIDP:null,_isEditing:!1,_roles:[],statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.SetIdentityProviderDlg);return this._instance}},
caseInsensitiveMemoryStore:a.declare(a.store.Memory,{query:function(a,d){var c=d.sort[0];"name"===c.attribute&&(d.sort=function(a,b){var d=a[c.attribute],g=b[c.attribute];return d!==g?!!c.descending===(null===d||d.toLowerCase()>(g&&g.toLowerCase()))?-1:1:0});return this.inherited(arguments)}}),postMixInProperties:function(){this.inherited(arguments);this.i18n={};a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").common);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline",
"arcgisonline").setIdentityProviderDlg);this.i18n.adminRoleName=a.i18n.getLocalization("arcgisonline","arcgisonline").organizationInvite.userRoles.admin},postCreate:function(){this.loadConnections();this._rolesAPI=new arcgisonline.sharing.geow.Roles},show:function(){this.clear();this._isPortal=this.util.isPortal();this.getRoles().then(a.hitch(this,function(){var a=RegExp(":\\d*/","g"),a=this._isPortal?esriGeowConfig.self.portalHostname.replace(a,".").replace("/","."):esriGeowConfig.self.urlKey+"."+
esriGeowConfig.self.customBaseUrl;esri.isDefined(this._currentIDP)||this._roleSelect.set("value",this.orgUserRole);this._entityIDInput&&this._entityIDInput.set("value",a);f.byId("set-identity-provider-dialog").show()}))},getRoles:function(){var b=new a.Deferred,d=0,c=0;this._rolesAPI.getRoles(1,100).then(a.hitch(this,function(e){if(e&&e.roles)if(a.forEach(e.roles,a.hitch(this,function(a){this._roles.push({id:a.id,name:a.name})})),0<e.nextStart){d=e.total-e.roles.length;c=Math.ceil(d/100);var h=[];
e=e.nextStart;for(var f=0;f<c;f++)h.push(this._rolesAPI.getRoles(e+100*f,100));(new a.DeferredList(h)).then(a.hitch(this,function(c){a.forEach(c,a.hitch(this,function(b){b[1]&&b[1].roles&&a.forEach(b[1].roles,a.hitch(this,function(a){this._roles.push({id:a.id,name:a.name})}))}));this.getAllRolePrivileges().then(a.hitch(this,function(){this.filterOutAdminRoles();b.resolve()}))}),a.hitch(this,function(){b.resolve()}))}else this.getAllRolePrivileges().then(a.hitch(this,function(){this.filterOutAdminRoles();
b.resolve()}))}),a.hitch(this,function(){b.resolve()}));return b},getAllRolePrivileges:function(){var b=new a.Deferred,d=[];a.forEach(this._roles,a.hitch(this,function(a){d.push(this._rolesAPI.getPrivileges(a.id))}));(new a.DeferredList(d)).then(a.hitch(this,function(c){a.forEach(c,a.hitch(this,function(a){for(var b=0;b<this._roles.length;b++)if(this._roles[b].id===a[1].id){this._roles[b].privileges=a[1].privileges;break}}));b.resolve()}),a.hitch(this,function(a){b.resolve()}));return b},filterOutAdminRoles:function(){var a=
[{id:this.orgUserRole,name:this.i18n.userRoleName},{id:this.orgPublisherRole,name:this.i18n.publisherRoleName}];this._isPortal&&a.push({role:this.orgAdminRole,name:this.i18n.adminRoleName});for(var d=0;d<this._roles.length;d++){var c=!1,e;if(this._roles[d]&&this._roles[d].privileges)for(var f=0;f<this._roles[d].privileges.length;f++)if(e=this._roles[d].privileges[f],-1<e.indexOf(":admin")){c=!0;break}(!c||this._isPortal)&&a.push({id:this._roles[d].id,name:this._roles[d].name})}this._roleSelect&&this._roleSelect.set("store",
new this.caseInsensitiveMemoryStore({idProperty:"id",data:a}))},edit:function(b){this.clear();this._currentIDP=b;this._isEditing=!0;this._isPortal=this.util.isPortal();var d=RegExp(":\\d*/","g"),c=this._isPortal?esriGeowConfig.self.portalHostname.replace(d,".").replace("/","."):esriGeowConfig.self.urlKey+"."+esriGeowConfig.self.customBaseUrl;this.getRoles().then(a.hitch(this,function(){esri.isDefined(b)?(f.byId("set-identity-provider-dialog").set("title",this.i18n.editIdentityProviderTitle),this._nameInput.set("value",
esri.isDefined(b.name)?b.name:""),this._encryptionSupported.set("value",esri.isDefined(b.encryptionSupported)?b.encryptionSupported:!1),this._signedRequestSupported.set("value",esri.isDefined(b.supportSignedRequest)?b.supportSignedRequest:!1),this._loginUrlInput.set("value",esri.isDefined(b.bindingUrl)?b.bindingUrl:""),this._loginUrlPostInput.set("value",esri.isDefined(b.bindingPostUrl)?b.bindingPostUrl:""),this._logoutUrlInput.set("value",esri.isDefined(b.logoutUrl)?b.logoutUrl:""),this._certificateInput.set("value",
esri.isDefined(b.certificate)?b.certificate:""),c=esri.isDefined(b.entityId)&&""!==b.entityId?b.entityId:c,this._entityIDInput.set("value",c),esri.isDefined(b.signUpMode)&&(b.signUpMode===this.SIGN_UP_MODE_AUTOMATIC?(this._automaticOption.set("checked",!0),a.style(this._roleOptions,"display",this._isPortal?"none":""),b.roleId?this._roleSelect.set("value",b.roleId):this._roleSelect.set("value",this.orgUserRole)):b.signUpMode===this.SIGN_UP_MODE_INVITE&&(this._inviteOption.set("checked",!0),a.style(this._roleOptions,
"display","none"),this._roleSelect.set("value",this.orgUserRole))),this._parametersOption.set("checked",!0),this.showParametersInputs(),esri.isDefined(b.logoutUrl)&&0<b.logoutUrl.length||esri.isDefined(b.userIdAttribute)&&0<b.userIdAttribute.length?this.showAdvancedSettings():this.hideAdvancedSettings()):(this._entityIDInput.set("value",c),this._encryptionSupported.set("value",!1),this._signedRequestSupported.set("value",!1));this._setBtn.set("label",this.i18n.updateIdentityProviderLabel);f.byId("set-identity-provider-dialog").show()}))},
clear:function(){f.byId("set-identity-provider-dialog").set("title",this.i18n.setIdentityProviderTitle);this.util.isPortal()||!1===esriGeowConfig.isMultiTenant?(a.attr(this._description,"innerHTML",this.i18n.setIdentityProviderDescPortal),this._logoutUrlInput.set("title",this.i18n.logoutUrlTooltipPortal),a.attr(this._inviteOptionLabel,"innerHTML",this.i18n.onAddOption)):(a.attr(this._description,"innerHTML",this.i18n.setIdentityProviderDesc),this._logoutUrlInput.set("title",this.i18n.logoutUrlTooltip),
a.attr(this._inviteOptionLabel,"innerHTML",this.i18n.onInviteOption));this._nameInput.set("placeHolder",this.i18n.namePlaceHolder);this._bindingUrlInput.set("placeHolder",this.i18n.metadataUrlPlaceHolder);this._loginUrlInput.set("placeHolder",this.i18n.parametersUrlPlaceHolder);this._loginUrlPostInput.set("placeHolder",this.i18n.parametersUrlPostPlaceHolder);this._logoutUrlInput.set("placeHolder",this.i18n.logoutUrlPlaceHolder);this._entityIDInput.set("placeHolder","");this._inviteOption.set("checked",
!0);a.style(this._roleOptions,"display","none");this._metadataUrlOption.set("checked",!0);this.showMetadataUrlInputs();this.hideAdvancedSettings();this._nameInput.set("value","");this._bindingUrlInput.set("value","");a.attr(this._metadataFileInput,"value","");this._encryptionSupported.set("value",!1);this._signedRequestSupported.set("value",!1);this._loginUrlInput.set("value","");this._loginUrlPostInput.set("value","");this._certificateInput.set("value","");a.attr(this._certificateFileInput,"value",
"");this._logoutUrlInput.set("value","");a.attr(this._signUpMode,"value","");a.attr(this._bindingType,"value","");this._setBtn.set("disabled",!1);this._currentIDP=null;this._isEditing=!1;this._roles=[]},loadConnections:function(){a.connect(this._metadataUrlOption,"onClick",a.hitch(this,this.onMetadataUrlOption));a.connect(this._metadataFileOption,"onClick",a.hitch(this,this.onMetadataFileOption));a.connect(this._parametersOption,"onClick",a.hitch(this,this.onParametersOption));a.connect(this._setBtn,
"onClick",a.hitch(this,this.onSetProvider));a.connect(this._cancelBtn,"onClick",a.hitch(this,this.onCancel))},hide:function(){f.byId("set-identity-provider-dialog").hide()},showMetadataUrlInputs:function(){a.style(this._metadataFileInputs,"display","none");a.style(this._parametersInputs,"display","none");a.style(this._metadataUrlInputs,"display","");a.attr(this._bindingType,"value","")},showMetadataFileInputs:function(){a.style(this._metadataUrlInputs,"display","none");a.style(this._parametersInputs,
"display","none");a.style(this._metadataFileInputs,"display","");a.attr(this._bindingType,"value","")},showParametersInputs:function(){a.style(this._metadataUrlInputs,"display","none");a.style(this._metadataFileInputs,"display","none");a.style(this._parametersInputs,"display","")},showAdvancedSettings:function(){a.attr(this._toggleAdvancedSettings,"innerHTML",this.i18n.hideAdvancedSettings);a.style(this._advancedSettings,"display","");this._showingAdvancedSettings=!0},hideAdvancedSettings:function(){a.attr(this._toggleAdvancedSettings,
"innerHTML",this.i18n.showAdvancedSettings);a.style(this._advancedSettings,"display","none");this._showingAdvancedSettings=!1},validParameters:function(){var b=this.i18n.noticeLabel,d=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),c=this._nameInput.get("value");if(!esri.isDefined(c)||0===c.length)return d.show({title:b,message:this.i18n.errors.nameRequired}),!1;var c=this._metadataUrlOption.get("checked"),e=this._bindingUrlInput.get("value");if(c&&(!esri.isDefined(e)||
0===e.length))return d.show({title:b,message:this.i18n.errors.metadataUrlMustBeSet}),!1;c=this._metadataFileOption.get("checked");e=a.attr(this._metadataFileInput,"value");if(c&&(!esri.isDefined(e)||0===e.length))return d.show({title:b,message:this.i18n.errors.metadataFileMustBeSet}),!1;if(this._parametersOption.get("checked")){c=this._loginUrlInput.get("value");if(!esri.isDefined(c)||0===c.length)return d.show({title:b,message:this.i18n.errors.loginUrlMustBeSet}),!1;c=this._loginUrlPostInput.get("value");
if(!esri.isDefined(c)||0===c.length)return d.show({title:b,message:this.i18n.errors.loginUrlPostMustBeSet}),!1;c=this._certificateInput.get("value");if(!esri.isDefined(c)||0===c.length)return d.show({title:b,message:this.i18n.errors.certificateMustBeSet}),!1}return!0},onAutomaticClicked:function(b){a.style(this._roleOptions,"display",this.util.isPortal()?"none":"")},onInvitationClicked:function(b){a.style(this._roleOptions,"display","none")},onMetadataUrlOption:function(a){this.showMetadataUrlInputs()},
onMetadataFileOption:function(a){this.showMetadataFileInputs()},onParametersOption:function(a){this.showParametersInputs()},onToggleAdvancedSettings:function(a){this._showingAdvancedSettings?this.hideAdvancedSettings():this.showAdvancedSettings()},onSetProvider:function(b){b.preventDefault();this._setBtn.set("disabled",!0);if(this.validParameters()){9>a.isIE&&(this._form.encoding="multipart/form-data");this._automaticOption.get("checked")?(a.attr(this._signUpMode,"value",this.SIGN_UP_MODE_AUTOMATIC),
b=this._roleSelect.get("value"),a.attr(this._roleSelection,"value",b)):(a.attr(this._signUpMode,"value",this.SIGN_UP_MODE_INVITE),a.attr(this._roleSelection,"value",""));a.attr(this._supportEncryption,"value",this._encryptionSupported.get("checked"));a.attr(this._supportSignedRequest,"value",this._signedRequestSupported.get("checked"));this._metadataUrlOption.get("checked")?(a.attr(this._metadataFileInput,"value",""),this._loginUrlInput.set("value",""),a.attr(this._bindingType,"value",""),this._certificateInput.set("value",
""),a.attr(this._certificateFileInput,"value","")):this._metadataFileOption.get("checked")?(this._bindingUrlInput.set("value",""),this._loginUrlInput.set("value",""),a.attr(this._bindingType,"value",""),this._certificateInput.set("value",""),a.attr(this._certificateFileInput,"value","")):(this._bindingUrlInput.set("value",""),a.attr(this._metadataFileInput,"value",""),a.attr(this._bindingType,"value",this.BINDING_TYPE_REDIRECT));var d=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();
this._isEditing?(b=esriGeowConfig.restBaseUrl+"portals/self/idp/"+this._currentIDP.id+"/update",a.attr(this._clearEmptyFields,"value",!0)):(b=esriGeowConfig.restBaseUrl+"portals/self/idp/register",a.attr(this._clearEmptyFields,"value",!1));this.util.request({url:b,form:this._form},{usePost:!0}).then(a.hitch(this,function(b){esri.isDefined(b)&&!esri.isDefined(b.error)&&(this._setBtn.set("disabled",!1),a.publish("setIdentityProvider",[]),this.hide())}),a.hitch(this,function(a){console.log(this.i18n.errors.unableToSetIdentityProvider,
a);var b;esri.isDefined(a.messageCode)?(b=this.i18n.errors[a.messageCode],esri.isDefined(a.details)&&esri.isDefined(a.details[0])&&(b=esri.substitute({details:a.details[0]},b))):b=this._isEditing?this.i18n.errors.unableToUpdateIdentityProvider:this.i18n.errors.unableToSetIdentityProvider;d.show({title:this.i18n.errorLabel,message:b});this._setBtn.set("disabled",!1)}))}else this._setBtn.set("disabled",!1)},onSubmit:function(){return!1},onCancel:function(a){a.preventDefault();this.hide()},onHide:function(){}})});