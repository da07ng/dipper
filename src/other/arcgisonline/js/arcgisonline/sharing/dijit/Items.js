// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/Items",["dijit","dojo","dojox","dojo/require!dijit/Toolbar,dijit/form/Button,dijit/form/DropDownButton,dijit/_Widget,dijit/_Templated,dojo/number,dojo/cookie,dijit/Menu,dijit/MenuItem,dijit/PopupMenuItem,dijit/Dialog,arcgisonline/sharing/dijit/dialog/ConfirmDialog,dojox/widget/Wizard,dojox/widget/WizardPane,arcgisonline/sharing/dijit/dialog/AccountMoveToDlg,arcgisonline/sharing/dijit/dialog/AddItemDlg,arcgisonline/sharing/dijit/dialog/DeleteWarningDlg,arcgisonline/sharing/dijit/dialog/SharingDlg,arcgisonline/sharing/dijit/dialog/ChoiceDlg,arcgisonline/sharing/util,arcgisonline/sharing/geow/Account,arcgisonline/sharing/geow/Community,arcgisonline/sharing/geow/Content,arcgisonline/sharing/geow/Folder,arcgisonline/sharing/geow/Group,arcgisonline/sharing/dijit/DataGrid,arcgisonline/sharing/dijit/Grid,dgrid/selector,dojo/topic,dojo/aspect,dojo/store/Memory,dojo/store/Observable,dojo/store/util/QueryResults,dojo/hash,dojo/io-query,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/dialog/ItemPropertiesDlg,arcgisonline/sharing/dijit/dialog/BrowseItemsDlg,arcgisonline/sharing/dijit/dialog/PluginConfigurableApps,arcgisonline/sharing/dijit/dialog/_CreateItemUtilMixin,arcgisonline/sharing/dijit/dialog/PublishWizard,arcgisonline/sharing/dijit/dialog/ShareOwnershipDlg"],
function(g,a,n){a.provide("arcgisonline.sharing.dijit.Items");a.require("dijit.Toolbar");a.require("dijit.form.Button");a.require("dijit.form.DropDownButton");a.require("dijit._Widget");a.require("dijit._Templated");a.require("dojo.number");a.require("dojo.cookie");a.require("dijit.Menu");a.require("dijit.MenuItem");a.require("dijit.PopupMenuItem");a.require("dijit.Dialog");a.require("arcgisonline.sharing.dijit.dialog.ConfirmDialog");a.require("dojox.widget.Wizard");a.require("dojox.widget.WizardPane");
a.require("arcgisonline.sharing.dijit.dialog.AccountMoveToDlg");a.require("arcgisonline.sharing.dijit.dialog.AddItemDlg");a.require("arcgisonline.sharing.dijit.dialog.DeleteWarningDlg");a.require("arcgisonline.sharing.dijit.dialog.SharingDlg");a.require("arcgisonline.sharing.dijit.dialog.ChoiceDlg");a.require("arcgisonline.sharing.util");a.require("arcgisonline.sharing.geow.Account");a.require("arcgisonline.sharing.geow.Community");a.require("arcgisonline.sharing.geow.Content");a.require("arcgisonline.sharing.geow.Folder");
a.require("arcgisonline.sharing.geow.Group");a.require("arcgisonline.sharing.dijit.DataGrid");a.require("arcgisonline.sharing.dijit.Grid");a.require("dgrid.selector");a.require("dojo.topic");a.require("dojo.aspect");a.require("dojo.store.Memory");a.require("dojo.store.Observable");a.require("dojo.store.util.QueryResults");a.require("dojo.hash");a.require("dojo.io-query");a.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");a.require("arcgisonline.sharing.dijit.dialog.ItemPropertiesDlg");a.require("arcgisonline.sharing.dijit.dialog.BrowseItemsDlg");
a.require("arcgisonline.sharing.dijit.dialog.PluginConfigurableApps");a.require("arcgisonline.sharing.dijit.dialog._CreateItemUtilMixin");a.require("arcgisonline.sharing.dijit.dialog.PublishWizard");a.require("arcgisonline.sharing.dijit.dialog.ShareOwnershipDlg");a.declare("arcgisonline.sharing.dijit.Items",[g._Widget,g._Templated],{util:arcgisonline.sharing.util,account:arcgisonline.sharing.geow.Account,community:arcgisonline.sharing.geow.Community,folder:arcgisonline.sharing.geow.Folder,content:arcgisonline.sharing.geow.Content,
addItemDlg:arcgisonline.sharing.dijit.dialog.AddItemDlg,createItemUtil:arcgisonline.sharing.dijit.dialog._CreateItemUtilMixin,group:arcgisonline.sharing.geow.Group,allItems:null,userGroups:null,adminGroups:null,user:null,contentUser:null,organization:null,isAdmin:!1,accountAdminRole:"account_admin",widgetsInTemplate:!0,templateString:'\x3cdiv dojoAttachPoint\x3d"_toolbarPane"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Toolbar" class\x3d"esriToolbar" id\x3d\'action-toolbar\'\x3e\r\n  \x3cspan\x3e\r\n      \x3c!--\x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" disabled\x3d"true" dojoAttachPoint\x3d"_addItemBtn"--\x3e\r\n              \x3c!--class\x3d"calcite transparent upload-item-button disable-on-loading" iconclass\x3d"esriUploadIcon"--\x3e\r\n              \x3c!--dojoAttachEvent\x3d"onClick: addItem"\x3e--\x3e\r\n        \x3c!--${i18n.addItem}--\x3e\r\n      \x3c!--\x3c/button\x3e--\x3e\r\n\r\n      \x3cspan dojoAttachPoint\x3d"_addContainer"\x3e\r\n          \x3cbutton dojotype\x3d"dijit.form.DropDownButton" dojoAttachPoint\x3d"_addItemBtn" iconclass\x3d"esriUploadIcon"\r\n                  class\x3d"calcite transparent disable-on-loading upload-item-button"\x3e\r\n              \x3cspan\x3e${i18n.addItem}\x3c/span\x3e\r\n              \x3cdiv class\x3d"createMenu" dojoType\x3d"dijit.Menu" dojoAttachPoint\x3d"_addMenu"\x3e\x3c/div\x3e\r\n          \x3c/button\x3e\r\n      \x3c/span\x3e\r\n\r\n      \x3cspan  dojoAttachPoint\x3d"_createContainer"\x3e\r\n          \x3cbutton  dojotype\x3d"dijit.form.DropDownButton" dojoAttachPoint\x3d"_createBtn" id\x3d"create-button"\r\n                iconclass\x3d"esriPublishIcon" class\x3d"calcite transparent disable-on-loading"\x3e\r\n          \x3cspan\x3e${i18n.create}\x3c/span\x3e\r\n          \x3cdiv class\x3d"createMenu" dojoType\x3d"dijit.Menu" dojoAttachPoint\x3d"_createMenu"\x3e\x3c/div\x3e\r\n          \x3c/button\x3e\r\n      \x3c/span\x3e\r\n\r\n      \x3c!--\x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" disabled\x3d"true" dojoAttachPoint\x3d"_createNewMapBtn"--\x3e\r\n              \x3c!--class\x3d"calcite transparent create-new-map-button disable-on-loading" iconclass\x3d"esriWebMapIcon"--\x3e\r\n              \x3c!--dojoAttachEvent\x3d"onClick: createWebMap"\x3e--\x3e\r\n        \x3c!--${i18n.createMap}--\x3e\r\n      \x3c!--\x3c/button\x3e--\x3e\r\n      \x3c!--\x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" dojoAttachPoint\x3d"_publishBtn" disabled\x3d"true"--\x3e\r\n              \x3c!--class\x3d"calcite transparent publish-item-button disable-on-loading" id\x3d"publish-button"--\x3e\r\n              \x3c!--iconclass\x3d"esriPublishIcon" style\x3d"display:none;" dojoAttachEvent\x3d"onClick: publishItem"\x3e--\x3e\r\n        \x3c!--\x3cspan\x3e${i18n.publish}\x3c/span\x3e--\x3e\r\n      \x3c!--\x3c/button\x3e--\x3e\r\n      \x3c!--\x3cbutton dojoType\x3d"dijit.form.Button" type\x3d"button" disabled\x3d"true" style\x3d"display:none;" class\x3d"calcite transparent disable-on-loading"--\x3e\r\n              \x3c!--dojoAttachPoint\x3d"_createAppBtn" iconClass\x3d"esriCreateAppIcon" dojoAttachEvent\x3d"onClick: createApp"\x3e--\x3e\r\n        \x3c!--\x3cspan\x3e${i18n.createApp}\x3c/span\x3e--\x3e\r\n      \x3c!--\x3c/button\x3e--\x3e\r\n    \x3c!--\x3cbutton dojoType\x3d"dijit.form.Button" type\x3d"button" disabled\x3d"true" style\x3d"display:none;" class\x3d"calcite transparent disable-on-loading"--\x3e\r\n            \x3c!--dojoAttachPoint\x3d"_createSceneBtn" iconClass\x3d"esriCreateSceneIcon" dojoAttachEvent\x3d"onClick: createScene"\x3e--\x3e\r\n      \x3c!--\x3cspan\x3e${i18n.createScene}\x3c/span\x3e--\x3e\r\n    \x3c!--\x3c/button\x3e--\x3e\r\n  \x3c/span\x3e\r\n\r\n    \x3c!-- just so that we get the line break if the button text is too long --\x3e\r\n    \x3cspan dojoAttachPoint\x3d"_shareContainer"\x3e\r\n    \x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" disabled\x3d"true" dojoAttachPoint\x3d"_shareBtn"\r\n            class\x3d"calcite transparent share-button" iconclass\x3d"esriShareIcon" dojoAttachEvent\x3d"onClick: shareItem"\x3e\r\n      ${i18n.share}\r\n    \x3c/button\x3e\r\n    \x3c/span\x3e\r\n\r\n    \x3cspan dojoAttachPoint\x3d"_sharedOwnershipContainer" class\x3d"hide"\x3e\r\n    \x3cbutton dojotype\x3d"dijit.form.DropDownButton" disabled\x3d"true" dojoAttachPoint\x3d"_shareOwnershipBtn"\r\n            class\x3d"calcite transparent share-button" iconclass\x3d"esriShareIcon"\x3e\r\n        \x3cspan\x3e${i18n.share}\x3c/span\x3e\r\n        \x3cdiv dojoType\x3d"dijit.Menu" dojoAttachPoint\x3d"_shareOwnershipMenu"\x3e\x3c/div\x3e\r\n    \x3c/button\x3e\r\n    \x3c/span\x3e\r\n\r\n    \x3c!-- just so that we get the line break if the button text is too long --\x3e\r\n    \x3cspan dojoAttachPoint\x3d"_deleteContainer"\x3e\r\n    \x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" disabled\x3d"true" dojoAttachPoint\x3d"_deleteBtn"\r\n            class\x3d"calcite transparent delete-item-button" iconclass\x3d"esriDeleteIcon"\r\n            dojoAttachEvent\x3d"onClick: deleteItem"\x3e\r\n      ${i18n.deleteLabel}\r\n    \x3c/button\x3e\r\n    \x3c/span\x3e\r\n\r\n    \x3c!-- just so that we get the line break if the button text is too long --\x3e\r\n    \x3cspan dojoAttachPoint\x3d"_moveContainer"\x3e\r\n    \x3cbutton dojotype\x3d"dijit.form.DropDownButton" dojoAttachPoint\x3d"_moveBtn" id\x3d"move-button" disabled\x3d"true"\r\n            iconclass\x3d"esriMoveToIcon" class\x3d"calcite transparent"\x3e\r\n      \x3cspan\x3e${i18n.moveTo}\x3c/span\x3e\r\n\r\n      \x3cdiv dojoType\x3d"dijit.Menu" dojoAttachPoint\x3d"_moveMenu"\x3e\x3c/div\x3e\r\n    \x3c/button\x3e\r\n    \x3c/span\x3e\r\n\r\n\r\n    \x3c!-- just so that we get the line break if the button text is too long --\x3e\r\n    \x3cspan dojoAttachPoint\x3d"_changeOwnerContainer" style\x3d"display:none;"\x3e\r\n      \x3cbutton dojoType\x3d"dijit.form.Button" type\x3d"button" disabled\x3d"true" class\x3d"calcite transparent"\r\n              dojoAttachPoint\x3d"_changeOwnerBtn" iconClass\x3d"esriReassignIcon" style\x3d"display:none;"\r\n              dojoAttachEvent\x3d"onClick: accountMoveTo"\x3e\r\n        \x3cspan\x3e${i18n.changeOwner}\x3c/span\x3e\r\n      \x3c/button\x3e\r\n    \x3c/span\x3e\r\n    \x3cspan dojoAttachPoint\x3d"_quotaDivHidden" style\x3d"line-height:16px;padding-top:6px;visibility:hidden;"\x3e\x26nbsp;\x3c/span\x3e\r\n    \x3cspan dojoAttachPoint\x3d"_quotaDiv" class\x3d"quotaPosition" style\x3d"position:absolute;bottom:3px;"\x3e\x26nbsp;\x3c/span\x3e\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e\r\n\r\n',
grid:null,currentFolder:"/",currentFolderName:null,foldersForm:null,helpBase:null,helpMap:null,i18n:null,customMemoryStore:a.declare(a.store.Memory,{query:function(a,c){var d=c.sort[0];"title"===d.attribute?c.sort=function(a,b){var c=a[d.attribute],l=b[d.attribute];return c!==l?!!d.descending===(null===c||c.toLowerCase()>(l&&l.toLowerCase()))?-1:1:0}:"access"===d.attribute&&(c.sort=function(a,b){var c=a[d.attribute],l=b[d.attribute];return c!==l?!!d.descending===(null===c||"public"===c||"private"===
l)?1:-1:0});return this.inherited(arguments)}}),filters:{all:{fieldName:"type"},layers:{fieldName:"type",types:"Feature Service;Map Service;Vector Tile Service;Image Service;Globe Service;Stream Service;Scene Service;WMS;KML;Shapefile;GeoJson;CSV;Service Definition;Layer;Layer Package;Explorer Layer;Tile Package;Vector Tile Package;Scene Package;File Geodatabase;Feature Collection;CAD Drawing".split(";")},features:{exclude:["Table"],fieldName:"type",types:["Feature Service","Feature Collection","Stream Service"]},
scenelayers:{fieldName:"type",types:["Scene Service"]},mapservice:{exclude:["Tiled"],isHosted:!1,fieldName:"type",types:["Map Service","WMS"]},imagery:{fieldName:"type",types:["Image Service"]},scenes:{fieldName:"type",types:["Web Scene"]},tables:{fieldName:"typeKeywords",types:["Table"]},tiles:{isHosted:!0,fieldName:"type",types:["Map Service","Vector Tile Service"]},maps:{fieldName:"typeKeywords",types:"CityEngine Web Scene;ArcGIS Windows Mobile Package;template;Published Map;Scene Document;Globe Document;Explorer Document;ArcPad Project;ArcPad Template;Map Package;Basemap Package;Mobile Map Package;Mobile Basemap Package;Map Document;Explorer Web Map;Explorer Map;mapx".split(";")},
webmaps:{fieldName:"type",types:["Web Map","CityEngine Web Scene"]},apps:{fieldName:"type",types:"Web Mapping Application;Mobile Application;Application;Code Sample;Desktop Application Template;Desktop Application;Operation View;Operations Dashboard Extension".split(";")},web:{fieldName:"type",types:["Web Mapping Application"]},mobile:{fieldName:"type",types:["Mobile Application"]},desktop:{fieldName:"type",types:["Desktop Application"]},tools:{fieldName:"type",types:"Geodata Service;Geometry Service;Geocoding Service;Workflow Manager Service;Network Analysis Service;Geoprocessing Service;Operations Dashboard Add In;Geoprocessing Package;Geoprocessing Sample;Locator Package;Explorer Add In;Desktop Add In;Rule Package;Raster function template".split(";")},
files:{fieldName:"typeKeywords",types:"Document;Image;PDF;Layout File;Style;Project Template".split(";")},weblayers:{fieldName:"type",types:"Feature Service;Map Service;Image Service;Globe Service;WMS;WMTS;KML;Feature Collection;Scene Service;Stream Service;Vector Tile Service".split(";")},layerFiles:{fieldName:"type",types:"Shapefile;GeoJson;CSV;Service Definition;Layer;Layer Package;Explorer Layer;Tile Package;Vector Tile Package;Scene Package;File Geodatabase;CAD Drawing".split(";")},mapFiles:{fieldName:"typeKeywords",
types:"ArcGIS Windows Mobile Package;template;Published Map;Scene Document;Globe Document;Explorer Document;ArcPad Project;ArcPad Template;Map Package;Map Document;Explorer Map;mapx".split(";")},shapefile:{fieldName:"type",types:["Shapefile"]},csv:{fieldName:"type",types:["CSV"]},document:{fieldName:"typeKeywords",types:["Document"]},pdf:{fieldName:"type",types:["PDF"]},image:{fieldName:"type",types:["Image"]}},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.mixin({},a.i18n.getLocalization("arcgisonline",
"arcgisonline").common);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").items);a.mixin(this.i18n,{openViewerFullEditingRole:a.i18n.getLocalization("arcgisonline","arcgisonline").itemProperties.openViewerFullEditingRole});a.mixin(this.i18n,{selectTemplate:a.i18n.getLocalization("arcgisonline","arcgisonline").itemProperties.selectTemplate});a.mixin(this.i18n,{createAppTitle:a.i18n.getLocalization("arcgisonline","arcgisonline").itemProperties.createAppTitle});a.mixin(this.i18n,
{choiceDlg:a.i18n.getLocalization("arcgisonline","arcgisonline").choiceDlg});a.mixin(this.i18n,{pleaseWait:a.i18n.getLocalization("arcgisonline","arcgisonline").addItemFrm.pleaseWait});a.mixin(this.i18n,{publishWizard:a.i18n.getLocalization("arcgisonline","arcgisonline").publishWizard});a.mixin(this.i18n,{sharingDlg:a.i18n.getLocalization("arcgisonline","arcgisonline").sharingDlg});this.i18n.browseItemsDlg=a.i18n.getLocalization("arcgisonline","arcgisonline").browseItemsDlg;this.i18n.errors=a.mixin(a.i18n.getLocalization("arcgisonline",
"arcgisonline").common.errors,a.i18n.getLocalization("arcgisonline","arcgisonline").items.errors);this.i18n.errors=a.mixin(this.i18n.errors,a.i18n.getLocalization("arcgisonline","arcgisonline").itemProperties.error);this._errorDlg=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();this._publishTypes={tilepackage:1,csv:1,shapefile:1,servicedefinition:1,filegeodatabase:1,geojson:1,scenepackage:1};this._createMenuItems={"default":{title:this.i18n.create,message:""},"web-map":{title:this.i18n.webMap2,
message:this.i18n.createMapMessage,typeInfo:"webmap"},"web-scene":{title:this.i18n.webScene2,message:this.i18n.createSceneMessage,typeInfo:esriGeowConfig.self&&esriGeowConfig.self.isPortal?"webscene_portal":"webscene"},"apps-template":{title:this.i18n.newWebMappingAppTitle,message:this.i18n.createTemplateAppMessage,typeInfo:"configapp"},"apps-wab":{title:this.i18n.newWebMappingAppTitle,message:this.i18n.createWABMessage,typeInfo:"wab",isWAB:!0},"features-data":{title:this.i18n.newFeatureLayerTitle,
message:this.i18n.createLayerMessage,showFile:!0,publish:!0,validTypes:["csv","zip","geojson"]},"tiles-data":{title:this.i18n.newTileLayerTitle,message:this.i18n.createTilesMessage,showFile:!0,publish:!0,validTypes:["tpk"]}}},postCreate:function(){this.user=this.util.getUser();null!==this.user&&(this.inherited(arguments),this.account.getSelf(a.hitch(this,this.handleGetAccount),a.hitch(this,this.handleGetAccount)),this.connect(this.foldersForm,"onFilterChange",a.hitch(this,"_filter")),this.connect(window,
"onresize",a.hitch(this,function(){this.grid&&this.grid._grid.resize()})))},_setRoleFlags:function(){this._roleCanViewUsers=(this._isCustomRole=esriGeowConfig.userRole&&esriGeowConfig.userRole.isCustom())&&esriGeowConfig.userRole.canViewUsers();this._roleCanViewItems=this._isCustomRole&&esriGeowConfig.userRole.canViewOrgItems();this._roleCanUpdateItems=this._isCustomRole&&esriGeowConfig.userRole.canUpdateOrgItems();this._roleCanDeleteItems=this._isCustomRole&&esriGeowConfig.userRole.canDeleteOrgItems();
this._roleCanReassignItems=this._isCustomRole&&esriGeowConfig.userRole.canReassignOrgItems();this._roleCanEditFeatures=this._isCustomRole&&esriGeowConfig.userRole.canEditFeatures();this._roleCanCreateItem=esriGeowConfig.userRole.canCreateItem();this._roleCanPublishFeatures=esriGeowConfig.userRole.canPublishFeatures();this._roleCanPublishTiles=esriGeowConfig.userRole.canPublishTiles();this._roleCanPublishScenes=esriGeowConfig.userRole.canPublishScenes();this._roleCanShareToGroup=this._isCustomRole&&
esriGeowConfig.userRole.canShareItemToGroup();this._roleCanShareGroupToOrg=this._isCustomRole&&esriGeowConfig.userRole.canShareItemToOrg();this._roleCanShareGroupToPublic=this._isCustomRole&&esriGeowConfig.userRole.canShareItemToPublic();this._roleCanShare=this._roleCanShareToGroup||this._roleCanShareGroupToOrg||this._roleCanShareGroupToPublic},handleGetAccount:function(b,c){if(b&&!b.code&&!b.message)if(this.helpBase=b.helpBase,this.helpMap=b.helpMap.m,b&&b.id&&b.id===this.user.accountId){this.organization=
b;this._setRoleFlags();this.user.role&&("account_admin"===this.user.role&&(this.isAdmin=!0),"account_publisher"===this.user.role&&(this.isPublisher=!0));this._isCustomRole&&(this.isAdmin=!1);a.style(this._quotaDivHidden,"display","none");a.style(this._quotaDiv,"display","none");a.style(this._changeOwnerContainer,"display","inline-block");setTimeout(a.hitch(this,function(){g.byId("container").resize()}),550);var d=a.queryToObject(window.location.search.slice(1)).user;d&&d!==this.user.username&&(this.isAdmin||
this._roleCanViewUsers&&this._roleCanViewItems)?(a.query(".upload-item-button, .publish-item-button",a.byId("action-toolbar")).map(g.byNode).forEach(function(a){a.set("class","upload-item-button");a.set("disabled",!0)}),this.community.getProfile(d,a.hitch(this,this.handleGetContentUser),a.hitch(this.handleGetContentUser))):(d="",this.organization.thumbnail&&0<this.organization.thumbnail.length&&(d+='\x3cimg src\x3d"'+this.getOrganizationThumbnailUrl(this.organization)+'" align\x3d"center" class\x3d"groupThumbnail"/\x3e '),
a.byId("myContent").innerHTML=d+this.i18n.myContent+"",this.isAdmin=!1,this.initialize())}else this.isAdmin=!1,this.initialize();else console.log(b)},handleGetContentUser:function(b,c){if(b&&b.username&&b.orgId&&this.user.accountId===b.orgId&&this.user.email!==b.username){this.contentUser=b;var d="";this.organization.thumbnail&&0<this.organization.thumbnail.length&&(d+='\x3cimg src\x3d"'+this.getOrganizationThumbnailUrl(this.organization)+'" align\x3d"center" class\x3d"groupThumbnail"/\x3e ');a.byId("myContent").innerHTML=
d+this.contentUser.fullName+" - Content"}else this.isAdmin=!1,a.query(".upload-item-button",a.byId("action-toolbar")).map(g.byNode).forEach(function(a){a.set("class","upload-item-button");a.set("disabled",!1)});this.initialize()},getOrganizationThumbnailUrl:function(a){var c=this.util.getToken();return esriGeowConfig.restBaseUrl+"portals/self/resources/"+a.thumbnail+(c?"?token\x3d"+c:"")},initialize:function(){this._getQuota();esri.i18nBundle=a.i18n.getLocalization("arcgisonline","arcgisonline")},
initialize2:function(){this.loadConnections();this.updateCreateMenu();this.updateAddMenu();this._fetchSharedOwnershipGroups().then(a.hitch(this,function(){this.updateSharedOwnershipMenu()}))},_getQuota:function(){var b=function(b){var d=b.storageQuota,e=d/1073741824;b=Math.round(100*(b.storageUsage/d));this._canPublish=esri.isDefined(esriGeowConfig.self)&&!1===esriGeowConfig.self.supportsHostedServices?!1:(this._roleCanPublishFeatures||this._roleCanPublishTiles)&&this._roleCanCreateItem;this._canPublishFeatures=
esri.isDefined(esriGeowConfig.self)&&!1===esriGeowConfig.self.supportsHostedServices?!1:this._roleCanPublishFeatures&&this._roleCanCreateItem;a.attr(this._quotaDiv,"innerHTML",a.string.substitute(this.i18n.usingSpace,[b,e]));a.attr(this._quotaDivHidden,"innerHTML",a.string.substitute(this.i18n.usingSpace,[b,e]));this.initialize2()};(this.isAdmin||this._roleCanViewUsers)&&this.contentUser?this.community.getProfile(this.contentUser.username,a.hitch(this,b)):this.community.getProfile(this.util.getUser().email,
a.hitch(this,b))},_getOpenMenu:function(b){function c(c){c=[{label:h.i18n.viewItemDetails,onClick:function(){window.location="item.html?id\x3d"+b.id}}].concat(c);var k=!h.isAdmin&&!h.contentUser&&(!h._isCustomRole||h._roleCanEditFeatures)||h.isAdmin&&h.contentUser;esriGeowConfig.self&&((!esriGeowConfig.self.isPortal||esriGeowConfig.self.isPortal&&0<a.indexOf(b.typeKeywords,"providerSDS"))&&-1<a.indexOf(b.typeKeywords,"Hosted Service")&&-1<a.indexOf(b.typeKeywords,"Feature Service")&&k)&&c.splice(2,
0,new g.MenuItem({label:h.i18n.openViewerFullEditingRole,onClick:a.hitch(h,"openServiceWithFullEditingControl",b.id)}));d=new g.DropDownMenu({autoFocus:!0,popupDelay:150,showTitle:!1,onMouseLeave:function(){11>=a.isIE||(esri.isTouchEnabled||7<=a.has("trident"))||e.closeDropDown()},onMouseEnter:function(){11>=a.isIE||esri.isTouchEnabled||7<=a.has("trident")||e._isOpen||e.openDropDown()}});a.forEach(c,a.hitch(this,function(a){f=new g.MenuItem({label:a.label,"class":a.label.replace(/\s+/g,""),onClick:function(){a.onClick()}});
d.addChild(f)}));return d}var d,e,f,h=this;e=new g.form.DropDownButton({label:" ","class":"calcite transparent",_item:b,_isOwner:(!this._isCustomRole||this._roleCanCreateItem)&&b&&b.owner===this.user.username,loadDropDown:function(a){this.dropDown||(this.dropDown=c(h.util.getItemOpenLinkObjects(this._item,this._isOwner)));a()},onMouseOver:function(){11>=a.isIE||esri.isTouchEnabled||7<=a.has("trident")||this._isOpen||this.loadAndOpenDropDown().then(a.hitch(this,function(){this.dropDown.focusFirstChild()}))},
onMouseLeave:function(){11>=a.isIE||(esri.isTouchEnabled||7<=a.has("trident"))||this.closeDropDown()}});a.connect(e.domNode,"click",function(b){a.stopEvent(b)});return e},openServiceWithFullEditingControl:function(a){var c=esriGeowConfig.baseUrl+"webmap/viewer.html?layers\x3d"+a+"\x26isAdmin\x3dtrue";arcgisonline.map.storage.getMapCookie(function(a){a&&!0===a.c?arcgisonline.sharing.dijit.dialog.OpenMapDlg.prototype.statics.getInstance().show(c,a):document.location=c})},createGrid:function(b){if(!esri.isDefined(this.grid)){var c=
{col1:dgrid.selector({label:" ",sortable:!1,selectorType:"checkbox"}),col2:{label:" ",field:"_item",sortable:!1,formatter:a.hitch(this,function(a){return arcgisonline.sharing.dijit.Items.formatters.type(a)})},title:{label:this.i18n.title,field:"title",sortable:!0,renderCell:function(b,c,d){b=arcgisonline.sharing.dijit.Items.formatters.title(b);a.place(b,d,"first");return b}},col4:{label:" ",field:"_item",sortable:!1,renderCell:a.hitch(this,function(b,c,d){b=this._getOpenMenu(b);b._destroyOnRemove=
!0;a.place(b.domNode,d);return b})},type:{label:this.i18n.type,field:"typeName",sortable:!0,renderCell:function(b,c,d){b=arcgisonline.sharing.dijit.Items.formatters.typeName(b);a.place(b,d,"first");return b}},modified:{label:this.i18n.modified,sortable:!0,formatter:function(a){return arcgisonline.sharing.dijit.Items.formatters.modified(a)}},access:{label:this.i18n.shared,sortable:!0,formatter:function(a){return arcgisonline.sharing.dijit.Items.formatters.sharedStatus(a)}}},d=this.helpBase+this.helpMap["120000454"],
e=this.helpBase+this.helpMap["120000455"],f='\x3cspan\x3e\x3cspan class\x3d"title"\x3e'+this.i18n.addAndShare+"\x3c/span\x3e\x3cbr/\x3e\x3cbr/\x3e",h=this.util.relativeToExplicitUrl("js/arcgisonline/css/images/addItem.png"),l=this.util.relativeToExplicitUrl("js/arcgisonline/css/images/userGroup.png"),f=f+("\x3cspan\x3e"+this.i18n.noDataMaps+"\x3cbr/\x3e"+this.i18n.noDataClick+"\x26nbsp;"),f=f+('\x3cspan style\x3d"width:16px;height:16px;margin:0 auto;vertical-align:bottom;background-image:url('+h+
");_background-image: none;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true',sizingMethod\x3d'crop',src\x3d'"+h+"');background-repeat:no-repeat;display:inline-block;\"\x3e\x3c/span\x3e")+("\x26nbsp;"+this.i18n.noDataAdd+"\x3c/span\x3e\x3cbr/\x3e\x3cbr/\x3e"),f=f+('\x3cul\x3e\x3cli\x3e\x3cA href\x3d"'+d+'" target\x3d"_blank"\x3e\x3cspan style\x3d"width:16px;height:16px;margin:0 auto;vertical-align:text-bottom;background-image:url('+h+");_background-image: none;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true',sizingMethod\x3d'crop',src\x3d'"+
h+"');background-repeat:no-repeat;display:inline-block;\"\x3e\x3c/span\x3e\x26nbsp;\x26nbsp;"+this.i18n.noDataAddMaps+"\x3c/A\x3e\x3c/li\x3e"),f=f+('\x3cli\x3e\x3cA href\x3d"'+e+'" target\x3d"_blank"\x3e\x3cspan style\x3d"width:16px;height:16px;margin:0 auto;vertical-align:text-bottom;background-image:url('+l+");_background-image: none;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true',sizingMethod\x3d'crop',src\x3d'"+l+"');background-repeat:no-repeat;display:inline-block;\"\x3e\x3c/span\x3e\x26nbsp;\x26nbsp;"+
this.i18n.noDataShare+"\x3c/A\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/span\x3e");this.grid=new arcgisonline.sharing.dijit.Grid({columns:c,rowsPerPage:20,region:"center",showHeader:!0,noDataMessage:f,showLoadingMessage:!0,id:"contentNode",selectionMode:"none",pagingLinks:5,useTouchScroll:!1,store:new a.store.Observable(new this.customMemoryStore({data:b,identifier:"id",label:"id"}))});this.grid._queryOptions={sort:[{attribute:"title",descending:!1}]};if((b=this.util.getCookie("ESRI_Content"))&&b.cell&&!1===
this.isAdmin)this.grid._queryOptions={sort:[{attribute:b.cell,descending:!b.asc}]};container.addChild(this.grid._grid);this.grid._grid.startup();this.grid.on("dgrid-select, dgrid-deselect",function(){a.publish("updateItemToolbar",[])});this.grid.on(".dgrid-header .dgrid-cell:click",a.hitch(this,"onHeaderCellClick"));a.aspect.before(this.grid._grid,"gotoPage",a.hitch(this,function(b){if(!this._loadingGrid){var c=this.util.getCookie("ESRI_Content"),c=a.mixin(c||{},{page:b});a.cookie("ESRI_Content",
a.json.stringify(c),{path:"/"});this._page=b;this.grid._grid.clearSelection()}this._loadingGrid=!1}))}},_updateURL:function(a){a=a&&1<this._page?{page:this._page}:{};this._page&&2>this._page&&delete this._queryStringParams.page;a=lang.mixin(this._queryStringParams,a,this._filterId);a.typekeywords&&(a.platform=a.typekeywords,delete a.typekeywords)},loadConnections:function(){a.subscribe("folderClicked",a.hitch(this,function(a,c){this._filterId="all";this.refreshItems2(a,c)}));a.subscribe("itemAdded",
this,"refreshItems2");a.subscribe("updateItemToolbar",this,"handleUpdateItems");a.subscribe("onShareUpdate",this,"onShareUpdate");a.subscribe("addItemInFolder",this,"addItemInFolder");(this.isAdmin||esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin()||this._roleCanReassignItems)&&a.style(this._changeOwnerBtn.domNode,"display","")},handleUpdateItems:function(a){var c=!0,d;for(d in a)a.hasOwnProperty(d)&&(c=!1);c||!a?this.updateToolbar():a.username?this.updateMoveToMenuByUser(a.username,a.folders,
a.folderId,a.folderName,a.onClickHandler):this.updateMoveToMenu(a.folders,a.folderId,a.folderName,a.onClickHandler)},updateCreateMenu:function(){if(!this._createMenu||!this._createMenu.getChildren().length){var b=this._createMenu,c,d=this,e=this.user&&this.user.accountId,f=function(b){return a.hitch(this,function(a){switch(a){case "web-map":case "apps-wab":case "features-data":case "tiles-data":case "scenes":case "web-scene":d._addItem(d._createMenuItems[a]||d._createMenuItems["default"]);break;case "apps-template":d.createApp();
break;case "features-template":case "features-layer":d.publishItem(a);break;case "tiles-features":d.publishItem(a);break;case "scenes-layer":d.publishTiles(a)}},b)};a.promise.all([this.createItemUtil.hasCreateLayer({isPortal:esriGeowConfig.self&&esriGeowConfig.self.isPortal,url:esriGeowConfig.restBaseUrl}),this._fetchGroupContent()]).then(a.hitch(this,function(a){var d=a&&a[0];a=a&&a[1];d&&(e&&this._roleCanPublishFeatures)&&b.addChild(new g.MenuItem({label:this.i18n.featureLayer,onClick:f("features-layer")}));
d&&(e&&this._roleCanPublishTiles)&&(b.addChild(new g.MenuItem({label:this.i18n.tiles,onClick:f("tiles-features")})),b.addChild(new g.MenuSeparator({})));a&&(c=new g.Menu,c.addChild(new g.MenuItem({label:this.i18n.useTemplate,onClick:f("apps-template")})));e&&(esriGeowConfig&&esriGeowConfig.webAppBuilderEnabled)&&(c||(c=new g.Menu),c.addChild(new g.MenuItem({label:this.i18n.useWAB2,onClick:f("apps-wab")})));c&&b.addChild(new g.PopupMenuItem({className:"esriPopupMenu",label:this.i18n.app,popup:c}));
b.addChild(new g.MenuSeparator({}));b.addChild(new g.MenuItem({label:this.i18n.webMap,onClick:f("web-map")}));esriGeowConfig&&esriGeowConfig.sceneViewerEnabled&&b.addChild(new g.MenuItem({label:this.i18n.webScene,onClick:f("web-scene")}));b.startup()}))}},updateAddMenu:function(){if(!this._addMenu||!this._addMenu.getChildren().length){var b=this._addMenu;b.addChild(new g.MenuItem({label:this.i18n.fromComputer,onClick:a.hitch(this,"addItem",{selected:"file",title:this.i18n.fromComputerTitle,message:this.i18n.fromComputerMessage})}));
b.addChild(new g.MenuItem({label:this.i18n.fromWeb,onClick:a.hitch(this,"addItem",{selected:"url",title:this.i18n.fromWebTitle,message:this.i18n.fromWebMessage})}));b.addChild(new g.MenuItem({label:this.i18n.anApp,onClick:a.hitch(this,"addItem",{selected:"app",title:this.i18n.anAppTitle,message:this.i18n.instructions})}));b.startup()}},updateSharedOwnershipMenu:function(){if(this._hasSharedOwnershipGroup){a.addClass(this._shareContainer,"hide");a.removeClass(this._sharedOwnershipContainer,"hide");
var b=this._shareOwnershipMenu;b.addChild(new g.MenuItem({label:this.i18n.sharingDlg.accessLbl,onClick:a.hitch(this,"shareItem")}));b.addChild(new g.MenuItem({label:this.i18n.sharingDlg.accessUpdateLbl,onClick:a.hitch(this,"shareOwnershipItem")}));b.startup()}},_fetchGroupContent:function(){var b=new a.Deferred,c=esriGeowConfig.restBaseUrl+"content/groups/",d,e=esriGeowConfig&&esriGeowConfig.self&&esriGeowConfig.self.templatesGroupQuery||null;(e=e&&e.split("id:")[1])?this.util.request({url:c+e}).then(a.hitch(this,
function(c){d=a.filter(c&&c.items||[],function(b){return-1<a.indexOf(b.typeKeywords,"Configurable")});b.resolve(d&&0<d.length)}),a.hitch(this,function(a){b.resolve(null)})):b.resolve(!0);return b},_addItem:function(b){var c=new arcgisonline.sharing.dijit.dialog.ConfirmDialog({title:b.title||this.i18n.create,buttonOk:this.i18n.ok,buttonCancel:this.i18n.cancel,style:{width:"475px",height:"auto"}}),d=new arcgisonline.sharing.dijit.dialog.ItemPropertiesDlg({typeInfo:b.typeInfo,existingItems:this.allItems,
validTypes:b.validTypes,message:b.message,showFolders:!0,showFile:b.showFile,showUrl:"scenes"===b,item:a.mixin(this.item,{tags:""})}),e,f,h=null;c.setContent(d.domNode);c.show();e=a.topic.subscribe("/dlg/onOk",a.hitch(this,function(){b.isWAB?d._validate().then(a.hitch(this,function(b){h=d.get("item");c.hide().then(a.hitch(this,function(){this.redirectToAppBuilder(h)}))}),a.hitch(this,function(a){this._showError(a)})):d.addItem().then(a.hitch(this,function(d){c.hide().then(a.hitch(this,function(){f.remove();
e.remove();"webmap"===b.typeInfo?arcgisonline.map.mapUtil.openMap(d.id):"webscene"===b.typeInfo||"webscene_portal"===b.typeInfo?this.createScene(d):window.location="item.html?id\x3d"+(d.serviceItemId||d.id)+(d.jobId?"\x26jobid\x3d"+d.jobId:"")}))}),a.hitch(this,function(a){this._showError(a)}))}));f=a.topic.subscribe("/dlg/onCancel",a.hitch(this,function(){f.remove();e.remove()}))},updateMoveToMenu:function(b,c,d,e){var f=this._moveMenu;d=f.getChildren();a.forEach(d,"item.destroyRecursive();",this);
if(b&&0<b.length){this._noFolders=!1;if(null!==c&&0<c.length&&"/"!==c){d=this.util.getUser();if(null===d)return;var h=new g.MenuItem;h.set("label",d.email);a.connect(h,"onClick",a.partial(e,{id:"/",title:"/"}));f.addChild(h)}a.forEach(b,function(b){if(c!==b.id){var d=new g.MenuItem;d.set("label",b.title);a.connect(d,"onClick",a.partial(e,b));f.addChild(d)}},this);this.updateToolbar()}else this._noFolders=!0,this._moveBtn.set("disabled",!0)},updateMoveToMenuByUser:function(b,c,d,e,f){var h=this._moveMenu;
a.forEach(h.getChildren(),"item.destroyRecursive();",this);if(c&&0<c.length){this._noFolders=!1;if(null!==d&&0<d.length&&"/"!==d){if(null===this.util.getUser())return;b=new g.MenuItem({label:b});a.connect(b,"onClick",a.hitch(null,f,{id:"/",title:"/"}));h.addChild(b)}a.forEach(c,function(b,c){if(d!==b.id){var e=new g.MenuItem({label:b.title});a.connect(e,"onClick",a.hitch(null,f,b));h.addChild(e)}},this);this.updateToolbar()}else this._noFolders=!0,this._moveBtn.set("disabled",!0)},updateToolbar:function(){var b=
this.selectedItems(),c=!b.length,d=a.every(b,function(a){return a["protected"]}),e=a.every(b,function(a){return a.type&&"Native Application Installer"!==a.type});if((this.isAdmin||this._isCustomRole)&&this.contentUser)a.addClass(this._addItemBtn.domNode,"calcite transparent"),a.addClass(this._createBtn.domNode,"calcite transparent"),this._createBtn.set("disabled",!0);this._shareBtn.set("disabled",c||!e);this._shareOwnershipBtn.set("disabled",c||!e);this._deleteBtn.set("disabled",c||d);this._noFolders?
this._moveBtn.set("disabled",!0):this._moveBtn.set("disabled",c);(this.isAdmin||esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin())&&this._changeOwnerBtn.set("disabled",c);!this.isAdmin&&this._isCustomRole&&this.contentUser?(this._moveBtn.set("disabled",!0),this._roleCanReassignItems||this._changeOwnerBtn.set("disabled",!0),this._roleCanDeleteItems||this._deleteBtn.set("disabled",!0),this._roleCanCreateItem||(this._addItemBtn.set("disabled",!0),this._createBtn.set("disabled",!0)),this._roleCanShare||
(this._shareBtn.set("disabled",!0),this._shareOwnershipBtn.set("disabled",!0)),this._roleCanReassignItems&&0<b.length?this._changeOwnerBtn.set("disabled",!1):this._changeOwnerBtn.set("disabled",!0)):!this.isAdmin&&(this._isCustomRole&&!this.contentUser)&&(this._roleCanCreateItem||(this._addItemBtn.set("disabled",!0),this._createBtn.set("disabled",!0),this._deleteBtn.set("disabled",!0)),this._roleCanShare||(this._shareBtn.set("disabled",!0),this._shareOwnershipBtn.set("disabled",!0)),this._roleCanReassignItems&&
0<b.length?this._changeOwnerBtn.set("disabled",!1):this._changeOwnerBtn.set("disabled",!0))},selectedItems:function(){var a=[],c=this.grid&&this.grid._grid,d=c&&c.store;if(c)for(var e in c.selection)c.selection[e]&&a.push(d.get(e));return a},deleteItem:function(){var b=this.selectedItems();if(null===b||0>=b.length)return this._errorMessage("Select an item to delete.");var c;1===b.length&&"Feature Service"===b[0].type&&this.util.isHostedService(b[0].url)?this.util.request({url:esriGeowConfig.restBaseUrl+
"content/items/"+b.id+"/relatedItems?relationshipType\x3dService2Service\x26direction\x3dforward"}).then(a.hitch(this,function(d){d&&0<d.total?(d=esri.substitute({fsName:b[0].title,msName:d.relatedItems[0].title},this.i18n.deleteFeatureServiceWarning),c=arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance(),d={title:this.i18n.deleteLabel,message:d,choiceOneTitle:this.i18n.deleteLabel,choiceTwoTitle:this.i18n.cancel,choiceOneHandler:a.hitch(this,"reallyDeleteItem")},c.show(d)):
(c=arcgisonline.sharing.dijit.dialog.DeleteWarningDlg.prototype.statics.getInstance(),c.show(b.length,this.i18n.item,a.hitch(this,"reallyDeleteItem"),!0))}),a.hitch(this,function(d){c=arcgisonline.sharing.dijit.dialog.DeleteWarningDlg.prototype.statics.getInstance();c.show(b.length,this.i18n.item,a.hitch(this,"reallyDeleteItem"),!0)})):(c=arcgisonline.sharing.dijit.dialog.DeleteWarningDlg.prototype.statics.getInstance(),c.show(b.length,this.i18n.item,a.hitch(this,"reallyDeleteItem"),!0))},_filter:function(b,
c){var d=b||this._filterId||"all",e=this.filters[d].fieldName,f=this.filters[d].types,h=this.filters[d].exclude||[],g=this.filters[d].isHosted,k=!1,m=!1;this._filterId=d;d="all"===d?this.allItems:a.filter(this.allItems,a.hitch(this,function(c){h&&h.length&&(m=a.some(h,function(b){return-1<a.indexOf(c.typeKeywords,b)}));if(m)return!1;if("typeKeywords"===e)return a.some(f,function(b){return-1<a.indexOf(c[e],b)});"tiles"===b?k=("Map Service"===c.type||"Vector Tile Service"===c.type)&&(-1<a.indexOf(c.typeKeywords,
"Hosted Service")||-1<a.indexOf(c.typeKeywords,"Tiled"))||-1<a.indexOf(c.typeKeywords,"Vector Tile Service"):(k=-1<a.indexOf(f,c[e]))&&g?k=-1<a.indexOf(c.typeKeywords,"Hosted Service"):k&&(esri._isDefined(g)&&!g)&&(k=-1===a.indexOf(c.typeKeywords,"Hosted Service"));return k}));this.grid.set("items",d);this._loadingGrid=c||!1;this.grid.refresh();d=Math.ceil(d.length/this.grid.rowsPerPage);this._page=this._page>d?d:this._page;1<this._page&&d>=this._page&&this.grid.gotoPage(this._page);this.updateToolbar()},
reallyDeleteItem:function(){var b=this.selectedItems(),c=arcgisonline.sharing.dijit.dialog.DeleteWarningDlg.prototype.statics.getInstance(),d=a.filter(b,function(a){return!a["protected"]}),e=a.filter(b,function(a){return a["protected"]}),b=a.hitch(this,function(b,d){this._getQuota();this.refreshItems2(this.currentFolder,null,!0);c.hide();e&&e.length&&this._showError(a.mixin(this.i18n.errors.genericError,{title:this.i18n.choiceDlg.choiceDlgTitle,message:this.i18n.errors.deleteProtectedItems}))});this.isAdmin||
this._roleCanDeleteItems&&this.contentUser?this.content.deleteItemsByUser(this.contentUser.username,d,a.hitch(this,b),a.hitch(this,function(b){c.hide();b&&b.messageCode&&"CONT_0048"===b.messageCode?this._showError(a.mixin(this.i18n.errors.genericError,{message:this.i18n.errors.deleteProtectedItems})):this._showError(b)})):this.content.deleteItems(d,a.hitch(this,b),a.hitch(this,function(b){c.hide();b&&b.messageCode&&"CONT_0048"===b.messageCode?this._showError(a.mixin(this.i18n.errors.genericError,
{message:this.i18n.errors.deleteProtectedItems})):this._showError(b)}))},publishItem:function(b){var c=esriGeowConfig.self&&esriGeowConfig.self.subscriptionInfo||{},d=b.split("-")[0],e;if("active"!==c.state&&!esriGeowConfig.self.isPortal)e=arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg.prototype.statics.getInstance(),e.show(c);else{var f=new arcgisonline.sharing.dijit.dialog.PublishWizard({"class":"esriPublishWizardNode",itemType:d,style:"width:655px;height:615px;overflow:auto;"});e=new g.Dialog({title:"features"===
d?this.i18n.newFeatureLayerTitle:this.i18n.newTileLayerTitle,content:f.domNode,"class":"esriPublishingWizardDlg"});a.connect(e,"onHide",a.hitch(this,function(){f.destroy();e.destroyRecursive()}));a.connect(f,"cancelFunction",a.hitch(this,function(){e.hide().then(a.hitch(this,function(){return!1}))}));a.connect(f,"onDone",a.hitch(this,function(b){e.hide().then(a.hitch(this,function(){var a=b&&b.id;a&&(window.location="item.html?id\x3d"+a+("tiles"===d?"\x26showManageTiles\x3dtrue":""))}))}));a.query(".dojoxWizardButtons",
e.domNode).addClass("esriFloatTrailing");e.show()}},_fetchGroups:function(){var b=[];if(this.userGroups)return b=new a.Deferred,b.resolve(!0),b;b.push(this.community.getUserGroups());(this.isAdmin||this.contentUser&&this._roleCanUpdateItems&&this._roleCanViewGroups)&&b.push(this.community.getUserGroupsByUser(this.contentUser.username));return a.promise.all(b).then(a.hitch(this,function(a){this.userGroups=this.contentUser&&a&&1<a.length?a[1].groups:a[0].groups;this.adminGroups=this.isAdmin?a[0].groups:
null;return!0}))},_fetchSharedOwnershipGroups:function(){var b,c,d=new a.Deferred;this._fetchGroups().then(a.hitch(this,function(e){c=this.isAdmin||this.contentUser&&this._roleCanUpdateItems&&this._roleCanViewGroups||!this.contentUser?this.userGroups:[];a.some(c,a.hitch(this,function(a){b=a.capabilities&&a.capabilities.join(",")||"";return!a.isViewOnly&&-1<b.toLowerCase().indexOf("updateitemcontrol")?this._hasSharedOwnershipGroup=!0:!1}));d.resolve(this._isSharedOwnership)}));return d},shareItem:function(b){var c=
this.selectedItems();null===c||0>=c.length||this._fetchGroups().then(a.hitch(this,function(a){a=arcgisonline.sharing.dijit.dialog.SharingDlg.prototype.statics.getInstance();this.isAdmin||this._roleCanUpdateItems&&this._roleCanShare?a.showAdmin(c,this.userGroups,this.contentUser,this.adminGroups):a.show(c,this.userGroups)}))},onShareUpdate:function(b){this.refreshItems2(this.currentFolder,null,!0);if(b&&a.isArray(b)&&!1===b[0].success&&b[0].error){if(b[0].error&&"item not provisioned"===b[0].error.message){this._showError({title:this.i18n.errors.error,
message:this.i18n.errors.noShareListedItem});return}return this._showError(b[0].error)}var c=this.selectedItems();if(1===c.length&&(c=c[0],"Web Map"===c.type||"Web Mapping Application"===c.type||"Web Scene"===c.type))b={id:c.id,type:c.type,access:b},"/"!==this.currentFolder&&(b.ownerFolder=this.currentFolder),"Web Map"===b.type||"Web Scene"===b.type?arcgisonline.sharing.utilShare.checkWebMapContent({webMapId:b.id,webMapItemCard:b,webMapConfig:null}):"Web Mapping Application"===b.type&&arcgisonline.sharing.utilShare.checkWebAppContent({webAppId:b.id,
webAppItemCard:b})},shareOwnershipItem:function(b){b=this.selectedItems();var c=this.adminGroups||this.userGroups||[],d,e,f=new arcgisonline.sharing.dijit.dialog.ConfirmDialog({title:this.i18n.sharingDlg.sharedOwnershipTitle,buttonOk:this.i18n.ok,buttonCancel:this.i18n.cancel,style:{width:"475px",height:"auto"}}),h=new arcgisonline.sharing.dijit.dialog.ShareOwnershipDlg({value:{items:b,groups:c}});f.setContent(h.domNode);f.show();d=a.topic.subscribe("/dlg/onOk",a.hitch(this,function(){h.validate().then(a.hitch(this,
function(){h.shareWithSelectedGroup().then(a.hitch(this,function(){f.hide().then(a.hitch(this,function(){e.remove();d.remove();this.refreshItems2(this.currentFolder,null,!0)}))}))}))}));e=a.topic.subscribe("/dlg/onCancel",a.hitch(this,function(){e.remove();d.remove()}))},onHeaderCellClick:function(b){b=this.grid._grid.cell(b);if(!1===this.isAdmin&&b.column.sortable){b=this.grid._grid.get("sort")||[{attribute:"title",descending:!0}];var c=this.util.getCookie("ESRI_Content"),c=a.mixin(c||{},{cell:b[0].attribute,
asc:!1===b[0].descending});a.cookie("ESRI_Content",a.json.stringify(c),{path:"/"});this.grid._queryOptions={sort:b}}},_getFolderItemCount:function(b){b=b.item&&b.item.id&&b.item.id.length?b.item.id[0]:b.item&&b.item.id;return b===this.currentFolder?(b=new a.Deferred,b.resolve(this.allItems.length||0),b):this.util.request({url:esriGeowConfig.restBaseUrl+"content/users/"+((this.isAdmin||this._roleCanViewUsers&&this._roleCanViewItems)&&this.contentUser&&this.contentUser.username?this.contentUser.username:
this.user.email)+(b&&"/"!==b?"/"+b:"")}).then(a.hitch(this,function(b){b=b.items;b=a.filter(b,function(b){return"Code Attachment"!==b.type&&-1===a.indexOf(esriGeowConfig.contentPageHiddenTypes||[],b.type)});return b.length||0}))},refreshItems2:function(b,c,d){c=b&&b.items?b:null;var e=a.queryToObject(window.location.search.slice(1)).num||100;b=esriGeowConfig.restBaseUrl+"content/users/"+((this.isAdmin||this._roleCanViewUsers&&this._roleCanViewItems)&&this.contentUser&&this.contentUser.username?this.contentUser.username:
this.user.email)+(!c&&b&&"/"!==b?"/"+b:"");c&&(!c.currentFolder&&1===c.num)&&(c=null);a.query(".disable-on-loading",a.byId("action-toolbar")).map(g.byNode).forEach(function(a){a.set("disabled",!0)});return a.when(c||this.folder._fetchAllItems(b,{num:-1<e?e:null}),a.hitch(this,function(b){this.currentFolder=b.currentFolder&&b.currentFolder.id||"/";this.currentFolderName=b.currentFolder&&b.currentFolder.title||this.contentUser&&this.contentUser.username||this.user.email;a.query(".disable-on-loading",
a.byId("action-toolbar")).map(g.byNode).forEach(function(a){a.set("disabled",!1)});b=b.items;b=a.filter(b,function(b){return"Code Attachment"!==b.type&&-1===a.indexOf(esriGeowConfig.contentPageHiddenTypes||[],b.type)});this.allItems=a.map(b,a.hitch(this,function(b){return a.mixin(b,{folderId:this.currentFolder,imageUrl:this.content._getItemIconUrl(b),typeName:arcgisonline.sharing.geow.Content.changeTypename({type:b.type,typeKeywords:b.typeKeywords})||b.type})}));if(this.grid)d||(c=this.util.getCookie("ESRI_Content"),
c=a.mixin(c||{},{page:this._page||1}),a.cookie("ESRI_Content",a.json.stringify(c),{path:"/"}),this._page=1),this._filter(null,d);else{this.createGrid(b);var c=this.util.getCookie("ESRI_Content");this._page=1;c&&c.page&&(this._page=parseInt(c.page,10));this._loadingGrid=!0;this.grid.refresh();b=Math.ceil(b.length/this.grid.rowsPerPage);this._page=this._page>b?b:this._page;1<this._page&&b>=this._page&&this.grid.gotoPage(this._page)}this.updateToolbar()}),a.hitch(this,"_showError"))},addItemInFolder:function(b,
c){a.hitch(a.mixin({},this,{currentFolder:b||"/",currentFolderName:c}),this.addItem)()},addItem:function(a){a=a||{};this._formDialog=(new g.Dialog({"class":"esriAddItemDlg"})).placeAt(document.body);this._formDialog.set({title:a.title||this.i18n.addItem,content:new this.addItemDlg({selected:a.selected,message:a.message,folder:this.currentFolder,existingItems:this.allItems,allowPublish:this._canPublish,dialog:this._formDialog})});this._formDialog.show()},createWebMap:function(){var b=[],c=this.selectedItems();
a.forEach(c,function(a){("Map Service"===a.type||"Image Service"===a.type||"Feature Service"===a.type||"Stream Service"===a.type||"WMS"===a.type||"Feature Collection"===a.type)&&b.push(a.id)});arcgisonline.map.mapUtil.openMapWithBase(null,b.join(","),this.currentFolder)},createApp:function(){var b=new g.Dialog({title:this.i18n.newWebMappingAppTitle,"class":"esriCreateAppDlg"}),c=[new arcgisonline.sharing.dijit.dialog.BrowseItemsDlg({plugin:"arcgisonline/sharing/dijit/dialog/PluginConfigurableApps",
messageLeft:this.i18n.browseItemsDlg.instructionsLeft,messageRight:this.i18n.browseItemsDlg.instructionsRight,item:a.mixin(this.item,{tags:""}),"class":"esriBrowseItemsDlg"}),new arcgisonline.sharing.dijit.dialog.ItemPropertiesDlg({message:this.i18n.createAppTitle,typeInfo:"configapp",existingItems:this.allItems,showFolders:!0,showFile:!1,showUrl:!1,item:a.mixin(this.item,{tags:""})})],d=a.hitch(this,function(b){a.query(".dijit, .dijitTextArea, .dojoxGrid",k.domNode).map(g.byNode).forEach(function(a){a.set("disabled",
b)});a.style(m,"display",b?"inline-block":"none")}),e=a.hitch(this,function(a){return a._validate()}),f=a.topic.subscribe("/esri/browseitems/close",a.hitch(this,function(a,b){if("create-app"===a)k.nextButton.onClick();else"on-view-item"===a?window.open("item.html?id\x3d"+b.id):"download-app"===a&&this.util.downloadWebMappingApp(b)})),h=a.hitch(this,function(e){e._validate().then(a.hitch(this,function(e){d(!0);e=c[0].get("selection");var f=this.util.getHomeAppContext(),g=c[1].get("item");this.util.isPortal()&&
(e.url&&0===e.url.indexOf("/")&&e.url&&-1===e.url.indexOf(f))&&(e.url=f+e.url);this.createItemUtil.createTemplatedApplication(g,e,c[1]._portal).then(a.hitch(this,function(c){b.hide().then(a.hitch(this,function(){window.location=c.configureUrl}))}),a.hitch(this,function(a){d(!1);this._showError(a)}))}),a.hitch(this,function(a){d(!1);this._showError(a)}))}),l=a.hitch(this,function(a){b.hide()}),k=new n.widget.Wizard({nextButtonLabel:this.i18n.publishWizard.nextButtonLabel,previousButtonLabel:this.i18n.publishWizard.previousButtonLabel,
doneButtonLabel:this.i18n.publishWizard.doneButtonLabel,cancelButtonLabel:this.i18n.publishWizard.cancelButtonLabel,"class":"esriCreateApp",hideDisabled:!0,doneFunction:h,cancelFunction:l}),m,p;p=a.connect(b,"onHide",a.hitch(this,function(d){p.remove();a.forEach(c,function(a){a.destroyRecursive()});f.remove();k.destroyRecursive();b.destroyRecursive()}));a.forEach(c,function(b,d){(new n.widget.WizardPane({content:b.domNode,passFunction:a.partial(e,b),doneFunction:d===c.length-1?a.partial(h,b):null})).placeAt(k)});
a.aspect.after(k,"_checkButtons",function(){k.selectedChildWidget.isFirstChild&&(k.nextButton.domNode.style.display="none")});a.query(".dojoxWizardButtons",k.domNode).addClass("esriFloatTrailing");a.addClass(k.nextButton.domNode,["calcite","primary"]);a.addClass(k.cancelButton.domNode,["calcite","cancel"]);a.addClass(k.previousButton.domNode,["calcite","default"]);a.addClass(k.doneButton.domNode,["calcite","primary"]);k.startup();m=a.create("span",{"class":"spinner hide",innerHTML:this.i18n.pleaseWait},
a.query(".dojoxWizardButtons",k.domNode)[0],"first");b.setContent(k.domNode);b.show()},createScene:function(a){window.location="webscene/viewer.html?webscene\x3d"+a.id},redirectToAppBuilder:function(b){b.folderId&&"/"!==b.folderId&&(b.folder=b.folderId);var c=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/apps/webappbuilder/index.html?",c=c+a.objectToQuery({title:b.title,tags:b.tags,summary:b.snippet,folder:b.folder});window.location="https:"===
window.location.protocol?arcgisonline.sharing.util.getSecureUrl(c):arcgisonline.sharing.util.getHttpUrl(c)},accountMoveTo:function(b){var c;b=this.selectedItems();var d=arcgisonline.sharing.dijit.dialog.AccountMoveToDlg.prototype.statics.getInstance();if(this.isAdmin||esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin()||this._roleCanReassignItems)c=this.contentUser?this.contentUser:this.user;c&&d.show(c,b,this.currentFolderName,a.hitch(this,this.onMoveToComplete),a.hitch(this,function(b){b=
b&&b.messageCode&&this.i18n.errors[b.messageCode]?{message:this.i18n.errors[b.messageCode]}:b;this._showError(a.mixin(this.i18n.errors.genericError,b.message?b:{}))}))},accountMoveToOtherUser:function(b){var c=this.selectedItems();arcgisonline.sharing.dijit.dialog.AccountMoveToDlg.prototype.statics.getInstance().show(b,c,this.currentFolderName,a.hitch(this,this.onMoveToComplete))},onMoveToComplete:function(){this.refreshItems2(this.currentFolder,null,!0)},_showError:function(b,c){if(!c||!c.canceled){b=
b.error||b||{};b.code=b.code||0;b=this.i18n.errors[b.code]||b||this.i18n.errors.contentNotLoaded;b.details=b.details&&a.isArray(b.details)&&b.details.length?a.filter(b.details,"return item !\x3d\x3d null"):null;b.details&&b.details.length&&(b.details=b.details.join("\x3cbr /\x3e"),b.message=b.message?b.message+"\x3cbr /\x3e"+b.details:b.details);var d=a.mixin(a.mixin({},this.i18n.errors.error),b);this._errorDlg.show(d)}return!1}});arcgisonline.sharing.dijit.Items.formatters={i18n:function(){if(this._i18n)return this._i18n;
this._i18n=a.i18n.getLocalization("arcgisonline","arcgisonline").common;a.mixin(this._i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").items);a.mixin(this._i18n,{source:a.i18n.getLocalization("arcgisonline","arcgisonline").itemProperties.source});return this._i18n},type:function(b){var c=b.imageUrl;b=(-1<a.indexOf(b.typeKeywords,"ArcGIS Server")||"Feature Collection"==b.type?this.i18n().source+" ":"")+("GeoJson"===b.type?"GeoJSON":b.type);c="\x3cdiv class\x3d'item-icon-thumb' alt\x3d'"+
b+"' title\x3d'"+b+"'\x3e"+('\x3cdiv style\x3d"width:16px;height:16px;margin:0 auto;background-image:url('+c+");_background-image: none;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true',sizingMethod\x3d'crop',src\x3d'"+c+"');background-repeat:no-repeat;display:inline-block;\"\x3e\x3c/div\x3e");return c+="\x3c/div\x3e"},typeName:function(b){var c="GeoJson"===b.type?"GeoJSON":b.type,c='\x3cspan class\x3d"esriContentTypeName" title\x3d"'+(-1<a.indexOf(b.typeKeywords,"ArcGIS Server")||
"Feature Collection"==b.type?arcgisonline.sharing.dijit.Items.formatters.i18n().source+" ":"")+c+'"\x3e',c=c+b.typeName;return c+"\x3c/span\x3e"},title:function(a){var c=a.title;return'\x3ca class \x3d "esriContentItemTitle" href\x3d\'item.html?id\x3d'+a.id+"' alt\x3d'"+arcgisonline.sharing.dijit.Items.formatters.i18n().viewItemDetails+"' title\x3d'"+arcgisonline.sharing.dijit.Items.formatters.i18n().viewItemDetails+"'\x3e"+c+"\x3c/a\x3e"},modified:function(b){b=new Date(parseInt(b,10));var c='\x3cspan class\x3d"esriContentTypeName" title\x3d"'+
a.date.locale.format(b,{timePattern:"HH:mm",selector:"time"})+'"\x3e',c=c+a.date.locale.format(b,{selector:"date",formatLength:"medium"});return c+"\x3c/span\x3e"},sharedStatus:function(a){var c='\x3cspan class\x3d"esriContentTypeName"\x3e',c="private"===a?c+arcgisonline.sharing.dijit.Items.formatters.i18n().notShared:"org"===a?c+arcgisonline.sharing.dijit.Items.formatters.i18n().organization:"public"===a?c+arcgisonline.sharing.dijit.Items.formatters.i18n().everyone:c+arcgisonline.sharing.dijit.Items.formatters.i18n().group;
return c+"\x3c/span\x3e"}}});