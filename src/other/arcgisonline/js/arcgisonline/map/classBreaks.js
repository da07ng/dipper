// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/map/classBreaks",["dijit","dojo","dojox","dojo/require!dojox/lang/functional,dojox/lang/functional/fold,dojox/lang/functional/curry"],function(s,q,r){q.provide("arcgisonline.map.classBreaks");q.require("dojox.lang.functional");q.require("dojox.lang.functional.fold");q.require("dojox.lang.functional.curry");arcgisonline.map.classBreaks={calculateStdDevInterval:function(d,c,a,g,k){d=Math.max(g-d,c-g)/k/a;return 1<=d?1:0.5<=d?0.5:0.25},getMean:function(d){for(var c=0,a=0;a<d.length;a++)c+=
d[a];return c/=d.length},getStddev:function(d,c){for(var a=0,g=0;g<d.length;g++)var k=d[g],a=a+(k-c)*(k-c);a/=d.length;return Math.sqrt(a)},computeStats:function(d){var c={},a=r.lang.functional;c.length=d.length;c.sum=a.reduce(d,a.lambda("+"));c.avg=c.sum/c.length;1<c.length?(sumSquresF=a.partial(a.lambda("ss,x,avg-\x3ess+Math.pow(x-avg,2)"),a.arg,a.arg,c.avg),c.sumSquares=a.reduce(d,sumSquaresF,0),c.stdDev=Math.sqrt(c.sumSquares/c.length)):(c.sumSquares=0,c.stdDev=0);return c},calculateBreakPositions:function(d,
c,a){var g=d.length;a>g&&(a=g);for(var k=[],l=0;l<a;l++)k.push(Math.round(l*g/a-1));k.push(g-1);g=arcgisonline.map.classBreaks.step1Optimization(k,d,c,a);arcgisonline.map.classBreaks.step2Optimization(g.mean,g.sdcm,k,d,c,a)&&arcgisonline.map.classBreaks.step1Optimization(k,d,c,a);return k},calcClassVariance:function(d,c,a,g){for(var k=0,l=0,h=c[d]+1;h<=c[d+1];h++)var f=g[h],k=k+a[h]*f,l=l+f;0>=l&&alert("Exception in Natural Breaks calculation");k/=l;l=0;for(h=c[d]+1;h<=c[d+1];h++)l+=g[h]*Math.pow(a[h]-
k,2);return{sbMean:k,sbSdcm:l}},step1Optimization:function(d,c,a,g){for(var k=[],l=[],h=[],f=0,m=[],n=[],b=0;b<g;b++){var p=arcgisonline.map.classBreaks.calcClassVariance(b,d,c,a);m.push(p.sbMean);n.push(p.sbSdcm);f+=n[b]}for(var e=f,q=!0;q||f<e;){q=!1;k=[];for(b=0;b<g;b++)k.push(d[b]);for(b=0;b<g;b++)for(h=d[b]+1;h<=d[b+1];h++)if(l=c[h],0<b&&h!=d[b+1]&&Math.abs(l-m[b])>Math.abs(l-m[b-1]))d[b]=h;else if(b<g-1&&d[b]!=h-1&&Math.abs(l-m[b])>Math.abs(l-m[b+1])){d[b+1]=h-1;break}e=f;f=0;l=[];h=[];for(b=
0;b<g;b++)l.push(m[b]),h.push(n[b]),p=arcgisonline.map.classBreaks.calcClassVariance(b,d,c,a),m[b]=p.sbMean,n[b]=p.sbSdcm,f+=n[b]}if(f>e)for(b=0;b<g;b++)d[b]=k[b],m[b]=l[b],n[b]=h[b];return{mean:m,sdcm:n}},step2Optimization:function(d,c,a,g,k,l){for(var h=0,f=0,m=0,n=0,b=!0,p=0;2>p&&b;p++){0==p&&(b=!1);for(var e=0;e<l-1;e++)for(;a[e+1]+1!=a[e+2];)if(a[e+1]+=1,f=arcgisonline.map.classBreaks.calcClassVariance(e,a,g,k),m=f.sbMean,h=f.sbSdcm,f=arcgisonline.map.classBreaks.calcClassVariance(e+1,a,g,k),
n=f.sbMean,f=f.sbSdcm,h+f<c[e]+c[e+1])c[e]=h,c[e+1]=f,d[e]=m,d[e+1]=n,b=!0;else{a[e+1]-=1;break}for(e=l-1;0<e;e--)for(;a[e]!=a[e-1]+1;)if(a[e]-=1,f=arcgisonline.map.classBreaks.calcClassVariance(e-1,a,g,k),m=f.sbMean,h=f.sbSdcm,f=arcgisonline.map.classBreaks.calcClassVariance(e,a,g,k),n=f.sbMean,f=f.sbSdcm,h+f<c[e-1]+c[e])c[e-1]=h,c[e]=f,d[e-1]=m,d[e]=n,b=!0;else{a[e]+=1;break}}return b}}});