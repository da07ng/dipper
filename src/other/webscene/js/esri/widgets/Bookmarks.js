// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("../core/declare dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/keys dojo/dom dojo/dom-construct dojo/dom-class dojo/dom-geometry dojo/on dojo/window dojo/i18n!../nls/jsapi ../core/domUtils ../geometry/Extent ./BookmarkItem ../core/Evented".split(" "),function(q,r,c,h,s,e,t,g,d,m,u,l,n,k,p,v){return q(v,{declaredClass:"esri.widgets.Bookmarks",constructor:function(a,b){this.map=a.map;this.editable=a.editable;this.initBookmarks=a.bookmarks;this._clickHandlers=this._mouseOverHandlers=
this._mouseOutHandlers=this._removeHandlers=this._editHandlers=[];this.bookmarkDomNode=g.create("div");d.add(this.bookmarkDomNode,"esriBookmarkList");this.bookmarkTable=g.create("table");d.add(this.bookmarkTable,"esriBookmarkTable");this.bookmarkDomNode.appendChild(this.bookmarkTable);b=t.byId(b);b.appendChild(this.bookmarkDomNode);this.scrNodeRef=b;d.add(this.scrNodeRef,"esriBookmarks");this._addInitialBookmarks()},emitRemove:function(){this.emit("remove")},addBookmark:function(a){var b;"esri.widgets.BookmarkItem"==
a.declaredClass?b=a:(b=new k(a.extent),b=new p({name:a.name,extent:b}));this.bookmarks.push(b);if(this.editable){b=l.widgets.bookmarks;b=g.create("div",{innerHTML:"\x3cdiv class\x3d'esriBookmarkLabel'\x3e"+a.name+"\x3c/div\x3e\x3cdiv title\x3d'"+b.NLS_bookmark_remove+"' class\x3d'esriBookmarkRemoveImage'\x3e\x3cbr/\x3e\x3c/div\x3e\x3cdiv title\x3d'"+b.NLS_bookmark_edit+"' class\x3d'esriBookmarkEditImage'\x3e\x3cbr/\x3e\x3c/div\x3e"});var f=h.query(".esriBookmarkEditImage",b)[0],c=h.query(".esriBookmarkRemoveImage",
b)[0];this._removeHandlers.push(e(c,"click",this._removeBookmark.bind(this)));this._editHandlers.push(e(f,"click",this._editBookmarkLabel.bind(this)))}else b=g.create("div",{innerHTML:"\x3cdiv class\x3d'esriBookmarkLabel' style\x3d'width: 210px;'\x3e"+a.name+"\x3c/div\x3e"});d.add(b,"esriBookmarkItem");"esri.geometry.Extent"!=a.extent.declaredClass&&new k(a.extent);f=h.query(".esriBookmarkLabel",b)[0];this._clickHandlers.push(e(f,"click",r.hitch(this,"_onClickHandler",a)));this._mouseOverHandlers.push(e(b,
"mouseover",function(){d.add(this,"esriBookmarkHighlight")}));this._mouseOutHandlers.push(e(b,"mouseout",function(){d.remove(this,"esriBookmarkHighlight")}));a=this.bookmarkTable;a.insertRow(a.rows.length).insertCell(0).appendChild(b);u.scrollIntoView(b)},removeBookmark:function(a){var b;b=h.query(".esriBookmarkLabel",this.bookmarkDomNode);b=c.filter(b,function(b){return b.innerHTML==a});c.forEach(b,function(a){a.parentNode.parentNode.parentNode.parentNode.removeChild(a.parentNode.parentNode.parentNode)});
for(b=this.bookmarks.length-1;0<=b;b--)this.bookmarks[b].name==a&&this.bookmarks.splice(b,1);this.emitRemove()},hide:function(){n.hide(this.bookmarkDomNode)},show:function(){n.show(this.bookmarkDomNode)},destroy:function(){this.map=null;c.forEach(this._clickHandlers,function(a){a.remove()});c.forEach(this._mouseOverHandlers,function(a){a.remove()});c.forEach(this._mouseOutHandlers,function(a){a.remove()});c.forEach(this._removeHandlers,function(a){a.remove()});c.forEach(this._editHandlers,function(a){a.remove()});
g.destroy(this.bookmarkDomNode)},toJson:function(){try{throw Error("toJson is deprecated, use toJSON instead");}catch(a){console.warn(a.stack)}return this.toJSON()},toJSON:function(){var a=[];c.forEach(this.bookmarks,function(b,f){a.push(b.toJSON())});return a},_addInitialBookmarks:function(){if(this.editable){var a=g.create("div",{innerHTML:"\x3cdiv\x3e"+l.widgets.bookmarks.NLS_add_bookmark+"\x3c/div\x3e"});d.add(a,"esriBookmarkItem");d.add(a,"esriAddBookmark");this._clickHandlers.push(e(a,"click",
this._newBookmark.bind(this)));this._mouseOverHandlers.push(e(a,"mouseover",function(){d.add(this,"esriBookmarkHighlight")}));this._mouseOutHandlers.push(e(a,"mouseout",function(){d.remove(this,"esriBookmarkHighlight")}));this.scrNodeRef.appendChild(a)}this.bookmarks=[];c.forEach(this.initBookmarks,function(a,f){this.addBookmark(a)},this)},_removeBookmark:function(a){this.bookmarks.splice(a.target.parentNode.parentNode.parentNode.rowIndex,1);a.target.parentNode.parentNode.parentNode.parentNode.removeChild(a.target.parentNode.parentNode.parentNode);
this.emitRemove()},_editBookmarkLabel:function(a){a=a.target.parentNode;var b=m.position(a,!0),b=g.create("div",{innerHTML:"\x3cinput type\x3d'text' class\x3d'esriBookmarkEditBox' style\x3d'left:"+b.x+"px; top:"+b.y+"px;'/\x3e"});this._inputBox=h.query("input",b)[0];this._label=h.query(".esriBookmarkLabel",a)[0];this._inputBox.value=this._label.innerHTML==l.widgets.bookmarks.NLS_new_bookmark?"":this._label.innerHTML;e(this._inputBox,"keyup",function(a){switch(a.keyCode){case s.ENTER:this._finishEdit()}}.bind(this));
e(this._inputBox,"blur",this._finishEdit.bind(this));a.appendChild(b);this._inputBox.focus();b=m.position(a,!0);this._inputBox.style.left=b.x+"px";this._inputBox.style.top=b.y+"px"},_finishEdit:function(){try{this._inputBox.parentNode.parentNode.removeChild(this._inputBox.parentNode)}catch(a){}var b=l.widgets.bookmarks.NLS_new_bookmark;this._label.innerHTML=""==this._inputBox.value?b:this._inputBox.value;var f=h.query(".esriBookmarkLabel",this.bookmarkDomNode);c.forEach(this.bookmarks,function(a,
b){a.name=f[b].innerHTML});this.emit("edit")},_newBookmark:function(){var a=this.map,b=l.widgets.bookmarks.NLS_new_bookmark,f=a.extent;if(a.spatialReference.isWrappable()){var c=k.prototype._normalizeX(f.xmin,a.spatialReference._getInfo()).x,e=k.prototype._normalizeX(f.xmax,a.spatialReference._getInfo()).x;if(c>e){var d=a.spatialReference.isWebMercator(),g=d?2.0037508342788905E7:180,d=d?-2.0037508342788905E7:-180;Math.abs(c-g)>Math.abs(e-d)?e=g:c=d}a=new k(c,f.ymin,e,f.ymax,a.spatialReference)}else a=
f;b=new p({name:b,extent:a});this.addBookmark(b);b=h.query(".esriBookmarkItem",this.bookmarkDomNode);a={target:{parentNode:null}};a.target.parentNode=b[b.length-1];this._editBookmarkLabel(a)},_onClickHandler:function(a){var b=a.extent;a.extent.declaredClass||(b=new k(a.extent));this.map.setExtent(b);this.emit("click")}})});