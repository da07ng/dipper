// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define(["../../core/declare","dojo/_base/array","dojo/_base/lang","esri/processors/Filter"],function(f,g,h,k){return f([k],{declaredClass:"esri.processors.filters.TrackFilter",normalizeCtorArgs:function(a){"string"===typeof a&&(a={trackIdField:a});return a},getDefaults:function(){return h.mixin(this.inherited(arguments),{idField:"id",parentField:"parent"})},trackIdField:null,idField:null,parentField:null,run:function(a){if(this.trackIdField&&a){var b=a.removed||[];a=a.added||[];var d,c,e;if(b.length){c=
0;for(e=b.length;c<e;c++)d=b[c],this._removeItemFromOutput(d,this.idField)}if(a.length){c=0;for(e=a.length;c<e;c++)d=a[c],d[this.parentField]=d.attributes[this.trackIdField];this.output.addItems(a)}}},_getIndexOfItem:function(a,b,d){var c=a[b];return d.findIndex(function(a){return a[b]===c},this)},_removeItemFromOutput:function(a,b){var d=a[b],c;c=this._getIndexOfItem(a,b,this.output);-1!==c&&this.output.removeItemAt(c);return{index:c,id:d,parent:a[this.parentField]}},_getItemsByParent:function(a,
b){return b.filter(function(b){return b[this.parentField]===a},this)},_getTracksAffectedByChanges:function(a){a=a||{};var b=a.added||[],d=[],b=b.concat(a.removed||[]);if(b.length)for(var c=0,e=b.length;c<e;c++)a=b[c],-1===g.indexOf(d,a[this.parentField])&&d.push(a[this.parentField]);return d}})});