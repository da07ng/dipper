// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define(["./core/declare","dojo/_base/lang","./core/Accessor","./core/Collection"],function(k,g,l,h){return k(l,{declaredClass:"esri.LayersMixin",classMetadata:{properties:{layers:{type:h}}},constructor:function(a){this._lyrChgHandler=this._lyrChgHandler.bind(this)},destroy:function(){this._layersHandle.remove();this._layersHandle=null;this.layers.drain(this._lyrRemove,this)},_layers:null,_layersGetter:function(a){a||(a=new h,this._layersHandle=a.on("change",this._lyrChgHandler));return a},_layersSetter:function(a,
c){c&&this.remove(c.getAll());this.add(a.getAll());return c},getLayer:function(a){var c,d=function(b){return b.id===a?(c=b,!0):b.layers?b.layers.some(d):!1};this.layers.some(d);return c},add:function(a,c){var d=this.layers,b,e,f;a=g.isArray(a)?a:[a];c=d.getNextIndex(c);b=0;for(e=a.length;b<e;b++)f=a[b],-1!==d.indexOf(f)?this.reorder(f,c):(f.parent&&(f.parent.remove(f),f.set("parent",this)),d.addItem(f,c),c+=1);return this},remove:function(a){a=g.isArray(a)?a:[a];a=this.layers.removeItems(a);a.forEach(function(a){a.parent=
null});return this},removeAll:function(){this.layers.clear();return this},reorder:function(a,c){this.layers.moveItem(a,c);return this},layerAdded:function(a){},layerRemoved:function(a){},layersChange:function(a,c,d){},_lyrChgHandler:function(a){var c=a.added,d=a.removed;a=a.moved;var b,e;this.layersChange(c,d,a);b=0;for(e=c.length;b<e;b++)this._lyrAdd(c[b]);b=0;for(e=d.length;b<e;b++)this._lyrRemove(d[b]);b=0;for(e=a.length;b<e;b++)this._lyrMoveHandler(a[b])},_lyrAdd:function(a){a.parent=this;this.layerAdded(a);
this.emit("layer-add",{target:this,layer:a})},_lyrRemove:function(a){a.parent===this&&(a.parent=null);this.layerRemoved(a);this.emit("layer-remove",{target:this,layer:a})},_lyrMoveHandler:function(a){this.emit("layer-reorder",{target:this,layer:a})}})});