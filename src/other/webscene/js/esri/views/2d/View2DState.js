// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("../../core/declare dojo/_base/lang ../../geometry/Point ../../geometry/ScreenPoint ../../geometry/Extent ../../geometry/support/scaleUtils".split(" "),function(v,n,k,p,q,w){function l(a){a._flags|=m}function h(a){a._flags|=r}var x=Math.PI/180,s=180/Math.PI,t=function(a,c){if(!a||!c)return a;var e=a.spatialReference;return c&&e&&!c.equals(e)&&c._canProject(e)?c.isWebMercator()?k.lngLatToXY(a.x,a.y):k.xyToLngLat(a.x,a.y,!0):[a.x,a.y]},m=4,r=27,y=new void 0,b={},u=v(void 0,{declaredClass:"esri.views.2d.View2DState",
normalizeCtorArgs:function(a){return!a?null:a.declaredClass===this.declaredClass?{screenDPI:a.screenDPI,spatialReference:a.spatialReference,x:a.x,y:a.y,scale:a.scale,rotation:a.rotation,width:a.width,height:a.height,viewPadding:a.viewPadding}:a.extent?{spatialReference:a.extent.spatialReference,screenDPI:a.screenDPI||96,width:a.width,height:a.height,rotation:a.rotation,viewPadding:a.viewPadding,extent:a.extent}:a},_flags:r,scaleToResolution:NaN,resolutionToScale:NaN,screenDPI:96,_screenDPISetter:function(a){this.screenDPI!==
a&&(this.screenDPI=a,this.scaleToResolution=this.unitToMeter/39.37/this.screenDPI,this.resolutionToScale=39.37*this.unitToMeter*this.screenDPI)},_spatialReferenceSetter:function(a){this.spatialReference!==a&&(this.spatialReference=a,this.unitToMeter=w.getUnitValue(a),this.scaleToResolution=this.unitToMeter/39.37/this.screenDPI,this.resolutionToScale=39.37*this.unitToMeter*this.screenDPI,this._flags=(void 0).set(this._flags,8,!0),this._flags=(void 0).set(this._flags,16,!0))},x:0,_xSetter:function(a){this.x!==
a&&(this.x=a,h(this))},y:0,_ySetter:function(a){this.y!==a&&(this.y=a,h(this))},_scaleSetter:function(a){this.scale!==a&&(this.scale=a,this.resolution=a*this.scaleToResolution,h(this))},_rotationSetter:function(a){a=this._clampRotation(a);this.rotation!==a&&(this.rotation=a,h(this),l(this))},_widthSetter:function(a){this.width!==a&&(this.width=a,h(this),l(this))},_heightSetter:function(a){this.height!==a&&(this.height=a,h(this),l(this))},_innerWidthGetter:function(){this._commitSize();return this.innerWidth},
_innerHeightGetter:function(){this._commitSize();return this.innerHeight},_innerExtentGetter:function(){if((void 0).isSet(this._flags,16)){var a=this.get("resolution");this._flags=(void 0).set(this._flags,16,!1);this._commitSize();var c=0.5*a*this.innerWidth,a=0.5*a*this.innerHeight,e=this.x,b=this.y;this.innerExtent=new q(e-c,b-a,e+c,b+a,this.spatialReference)}return this.innerExtent},_centerGetter:function(){return this.toMap(this.get("viewAnchor"))},_centerSetter:function(a){this.centerAt(a)},
_extentGetter:function(){if((void 0).isSet(this._flags,8)){var a=this.get("resolution");this._flags=(void 0).set(this._flags,8,!1);var c=this.toMap(this.get("viewAnchor")),b=0.5*a*this._fittingWidth,a=0.5*a*this._fittingHeight,d=c.x,c=c.y;this.extent=new q(d-b,c-a,d+b,c+a,this.spatialReference)}return this.extent},_extentSetter:function(a){if(a){this._commitSize();var c=this._fittingWidth,b=this._fittingHeight,d=a.get("width"),f=a.get("height"),g=a.get("center");if(0<d&&0<f&&!(0===c||0===b))this.set({x:g.x,
y:g.y,scale:Math.max(d/c,f/b)*this.resolutionToScale,spatialReference:a.spatialReference}),this.centerAt(g.x,g.y)}},_transformGetter:function(){(void 0).isSet(this._flags,1)&&(this._flags=(void 0).set(this._flags,1,!1),this.transform||(this.transform=new void 0),this.transform.identity().translate(-this.x,-this.y).rotateg(-this.rotation).scale(1/this.resolution,-1/this.resolution).translate(0.5*this.width,0.5*this.height));return this.transform},_inverseGetter:function(){if((void 0).isSet(this._flags,
2)){this._flags=(void 0).set(this._flags,2,!1);this.inverse||(this.inverse=new void 0);var a=this.get("transform");this.inverse.copy(a).invert()}return this.inverse},_viewAnchorGetter:function(){this._commitSize();return this.viewAnchor},_viewPaddingSetter:function(a){this.viewPadding=n.mixin({left:0,top:0,right:0,bottom:0},a||{});h(this);l(this)},_longitudeGetter:function(a){a=this.x/6378137*s;return a-360*Math.floor((a+180)/360)},_latitudeGetter:function(a){return(Math.PI/2-2*Math.atan(Math.exp(-1*
this.y/6378137)))*s},toMap:function(a,c,b){var d=a,f=c;a&&null!=a.x&&(d=a.x,f=a.y,b=c);b?b.spatialReference=this.spatialReference:b=new k(0,0,this.spatialReference);return this.get("inverse").transform(d,f,b)},toScreen:function(a,c,b){var d=a,f=c,g=this.spatialReference,h;a&&null!=a.x&&(d=a.x,f=a.y,h=a.spatialReference,b=c);g&&(h&&!g.equals(h)&&g._canProject(h))&&(a=g.isWebMercator()?k.lngLatToXY(d,f):k.xyToLngLat(d,f,!0),d=a[0],f=a[1]);b||(b=new p);return b=this.get("transform").transform(d,f,b)},
translate:function(a,c){b=y.identity().rotateg(this.rotation).scale(this.resolution).transform(a,c,b);this.x+=b.x;this.y+=b.y;h(this);return this},scaleBy:function(a,c){c=c||this.get("viewAnchor");0!==a&&(b=this.toMap(c,b),this.set("scale",this.scale/a),b=this.toScreen(b,b),this.translate(b.x-c.x,c.y-b.y));return this},scaleTo:function(a,c){if(this.scale===a||0===a)return this;c=c||this.get("viewAnchor");b=this.toMap(c,b);this.set("scale",a);b=this.toScreen(b,b);this.translate(b.x-c.x,c.y-b.y);return this},
rotateTo:function(a,c){c=c||this.get("viewAnchor");this.rotation!==a&&(b=this.toMap(c,b),this.set("rotation",a),b=this.toScreen(b,b),this.translate(b.x-c.x,c.y-b.y));return this},rotateBy:function(a,c){c=c||this.get("viewAnchor");a&&(b=this.toMap(c,b),this.set("rotation",this.rotation+a),b=this.toScreen(b,b),this.translate(b.x-c.x,c.y-b.y));return this},resize:function(a,c,e){if(!(this.width===a&&this.height===c)){e||(e="center");var d=this.get("viewAnchor");b=this.toMap(d,b);this.set({width:a,height:c});
b=this.toScreen(b,b);a=b.x-d.x;d=d.y-b.y;switch(e){case "left":this.translate(a,0);break;case "top":this.translate(0,d);break;case "right":this.translate(-a,0);break;case "bottom":this.translate(0,-d);break;case "top-left":this.translate(a,d);break;case "bottom-left":this.translate(a,-d);break;case "top-right":this.translate(-a,d);break;case "bottom-right":this.translate(-a,-d)}return this}},centerAt:function(a,c){var e=null;this._commitSize();a&&null!=a.x?(e=t(a,this.spatialReference),a=e[0],c=e[1]):
a&&n.isArray(a)&&(e=t(new k(a[0],a[1]),this.spatialReference),a=e[0],c=e[1]);b=this.toMap(this.get("viewAnchor"),b);this.set({x:this.x-(b.x-a),y:this.y-(b.y-c)})},copy:function(a){return this.set({x:a.x,y:a.y,spatialReference:a.spatialReference,scale:a.scale,rotation:a.rotation,width:a.width,height:a.height,viewPadding:a.viewPadding})},clone:function(){return new u(this)},_clampRotation:function(a){if(!a)return 0;if(180<a||-180>a)a%=360,180<a?a-=360:-180>a&&(a+=360);return a},_commitSize:function(){if((void 0).isSet(this._flags,
m)){this._flags=(void 0).set(this._flags,m,!1);var a=this.rotation*x,b=Math.abs(Math.cos(a)),a=Math.abs(Math.sin(a)),e=this.width,d=this.height,f=this.viewPadding,g=this.viewAnchor;g||(this.viewAnchor=g=new p);f?(this._paddedWidth=e-f.left-f.right,this._paddedHeight=d-f.top-f.bottom,g.x=f.left+0.5*this._paddedWidth,g.y=f.top+0.5*this._paddedHeight):(this._paddedWidth=e,this._paddedHeight=d,g.x=0.5*this.width,g.y=0.5*this.height);e=this._paddedWidth;d=this._paddedHeight;this._fittingHeight=Math.round(Math.min(d*
d/(e*a+d*b),d*e/(e*b+d*a)));this._fittingWidth=Math.round(this._fittingHeight*e/d);e=this.width;d=this.height;this.innerWidth=Math.round(d*a+e*b);this.innerHeight=Math.round(d*b+e*a)}}});return u});