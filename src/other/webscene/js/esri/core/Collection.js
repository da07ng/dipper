// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("./declare dojo/on dojo/aspect ./ArrayPool ./Accessor ./Evented ./Scheduler".split(" "),function(q,r,s,p,t,u,v){var w=function(){},x=s.after,y=0,g=q([t,u],{constructor:function(){this.id=(new Date).getTime().toString(16)+"-collection"+y++;this._chgListeners=[];this._timer=this._notification=null;this._items=[];this._dispatchColChange=this._dispatchColChange.bind(this)},normalizeCtorArgs:function(a){return!a?{}:Array.isArray(a)||a.isInstanceOf&&a.isInstanceOf(g)?{items:a}:a},onchange:null,length:0,
_itemsGetter:function(){return this._items.concat()},_itemsSetter:function(a){a&&(a=a.isInstanceOf&&a.isInstanceOf(g)?a.getAll():Array.isArray(a)?a.slice():[]);this._splice(0,this.length,a);return this._items},on:function(a,b){return r.parse(this,a,b,function(a,c){if("change"===c){var f={removed:!1,callback:b};a._chgListeners.push(f);return{remove:function(){this.remove=w;f.removed=!0;a._chgListeners.splice(a._chgListeners.indexOf(f),1)}}}return x(a,"on"+c,b,!0)})},hasEventListener:function(a){return"change"===
a?0<this._chgListeners.length:this.inherited(arguments)},addItem:function(a,b){b=this.getNextIndex(b);this._splice(b,0,[a])},addItems:function(a,b){a&&a.getAll&&(a=a.getAll());b=this.getNextIndex(b);this._splice(b,0,a)},clear:function(){return this._splice(0,this.length)},clone:function(){return new g({items:this._items})},drain:function(a,b){var e=this.clear(),c,f;c=0;for(f=e.length;c<f;c++)a.call(b,e[c])},filter:function(a,b){return new g({items:this._items.filter(a,b)})},find:function(a,b){if("function"!==
typeof a)throw new TypeError(a+" is not a function");var e=this._items,c=this.length,f,d;for(d=0;d<c;d++)if(f=e[d],a.call(b,f,d,e))return f},findIndex:function(a,b){if("function"!==typeof a)throw new TypeError(a+" is not a function");var e=this._items,c=this.length,f,d;for(d=0;d<c;d++)if(f=e[d],a.call(b,f,d,e))return d;return-1},forEach:function(a,b){return this._items.forEach(a,b)},getAll:function(){return this._items.slice()},getItemAt:function(a){return this._items[a]},getNextIndex:function(a){var b=
this.length;a=null==a?b:a;0>a?a=0:a>b&&(a=b);return a},indexOf:function(a,b){return this._items.indexOf(a,b)},map:function(a,b){return new g({items:this._items.map(a,b)})},moveItem:function(a,b){var e=this.indexOf(a),c=this._items.length-1;-1!==e&&(b=null==b?c:b,0>b?b=0:b>c&&(b=c),e!==b&&(this._splice(e,1),this._splice(b,0,[a])))},reduce:function(a,b){return this._items.reduce(a,b)},reduceRight:function(a,b){return this._items.reduceRight(a,b)},removeItem:function(a){a=this.indexOf(a);return this.removeItemAt(a)},
removeItemAt:function(a){if(0<=a&&a<this.length)return this._splice(a,1)[0]},removeItems:function(a){if(!a||!a.length)return a;a&&a.getAll&&(a=a.getAll());var b=this._items,e=[],c,f,d;c=0;for(f=a.length;c<f;c++)d=a[c],d=b.indexOf(d),-1<d&&e.push(this._splice(d,1)[0]);return e},some:function(a,b){return this._items.some(a,b)},_splice:function(a,b,e){var c;this.hasEventListener("change")&&!this._notification&&(this._notification={listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]},
this._timer||(this._timer=v.schedule(this._dispatchColChange)));b&&(c=this._items.splice(a,b),this._notifyColChange(null,c));e&&e.length&&(Array.prototype.splice.apply(this._items,[a,0].concat(e)),this._notifyColChange(e,null));this.length=this._items.length;return c||[]},_notifyColChange:function(a,b){this.hasEventListener("change")&&this._notification.changes.push({added:a,removed:b})},_dispatchColChange:function(){this._timer&&(this._timer.remove(),this._timer=null);if(this._notification){var a=
this._notification,b=a.items,e=a.changes,c=p.get(),f=p.get(),d=p.get(),m,g,h,n,k,l;this._notification=null;m=0;for(g=e.length;m<g;m++){n=e[m];if(n.added){k=n.added;if(0<f.length)for(h=k.length-1;0<=h;h--)l=f.indexOf(k[h]),-1!==l&&(k.splice(h,1),d.push(f.splice(l,1)[0]));c=c.concat(k)}if(n.removed){k=n.removed;if(0<c.length||0<d.length)for(h=k.length-1;0<=h;h--)l=c.indexOf(k[h]),-1!==l?(c.splice(l,1),k.splice(h,1)):(l=d.indexOf(k[h]),-1!==l&&d.splice(l,1));f=f.concat(k)}}d=d.filter(function(a){return b.indexOf(a)!==
this._items.indexOf(a)},this);if(a.listeners&&(c.length||f.length||d.length)){n={target:this,added:c,removed:f,moved:d};m=0;for(g=a.listeners.length;m<g;m++)e=a.listeners[m],e.removed||e.callback.call(this,n)}p.put(c);p.put(f);p.put(d)}}});return g});