// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define(["../core/declare","../core/Collection"],function(g,e){return g([e],{classMetadata:{properties:{view:{}}},constructor:function(){this._handles=new e;this._reset=this._reset.bind(this);this._watcher=this.watch(["view.factory.working","view.layerViews","view.basemapView.baseLayerViews","view.basemapView.referenceLayerViews","view.basemapView.elevationLayerViews"],this._reset)},initialize:function(){this._reset()},destroy:function(){this._handles.drain(function(a){a.remove()});this._handles=null;
this._watcher.remove();this._watcher=null},view:null,_reset:function(a){if(this._accessorProps.initialized&&!this.get("view.factory.working")){a=this.get("view.layerViews");var d=this.get("view.basemapView.baseLayerViews"),b=this.get("view.basemapView.referenceLayerViews"),f=this.get("view.basemapView.elevationLayerViews"),c;this._handles.drain(function(a){a.remove()});c=[];this._pushItem(c,f);this._pushItem(c,d);this._pushItem(c,a);this._pushItem(c,b);a=this.filter(function(a){return-1===c.indexOf(a)});
this.removeItems(a);a=0;for(d=c.length;a<d;a++)b=c[a],this.getItemAt(a)!==b&&(f=this.indexOf(b),-1<f?this.moveItem(b,a):this.addItem(b,a))}},_pushItem:function(a,d){var b=this._getChildren(d);b?(b.forEach(function(b){this._pushItem(a,b)},this),this._handles.addItem(b.on("change",this._reset))):d&&a.push(d)},_getChildren:function(a){return a?a.isInstanceOf(e)?a:a.layerViews:null}})});