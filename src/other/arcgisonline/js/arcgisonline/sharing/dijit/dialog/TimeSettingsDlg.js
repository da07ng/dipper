// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/dialog/TimeSettingsDlg",["dijit","dojo","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,dijit/form/DateTextBox,dijit/form/TimeTextBox,dijit/form/TextBox,dijit/form/CheckBox,dijit/form/RadioButton,dojox/form/RangeSlider,arcgisonline/sharing/dijit/HelpManager,arcgisonline/sharing/dijit/dialog/GeneralDlg"],function(h,c,l){c.provide("arcgisonline.sharing.dijit.dialog.TimeSettingsDlg");c.require("dijit.Dialog");c.require("dijit._Widget");c.require("dijit._Templated");
c.require("dijit.form.DateTextBox");c.require("dijit.form.TimeTextBox");c.require("dijit.form.TextBox");c.require("dijit.form.CheckBox");c.require("dijit.form.RadioButton");c.require("dojox.form.RangeSlider");c.require("arcgisonline.sharing.dijit.HelpManager");c.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");c.declare("arcgisonline.sharing.dijit.dialog.TimeSettingsDlg",[h._Widget,h._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" dojoAttachPoint\x3d"_timeSettingsDialog" dojoAttachEvent\x3d"onClick:_handleTimeSettingsDlgClick" title\x3d"${i18n.timeSettingsDlgTitle}" doLayout\x3d"false" execute\x3d""\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_timeSettingsMainDiv" class\x3d"timeSettingsForm"\x3e\r\n      \x3cdiv dojoAttachPoint\x3d"_timeSettingsSpeedDiv"\x3e\r\n        \x3cdiv style\x3d"padding-bottom:5px;"\x3e\x3clabel style\x3d"font-weight:bold;"\x3e${i18n.playbackSpeed}\x3c/label\x3e\x3c/div\x3e\r\n          \x3ctable style\x3d"padding-bottom:10px;"\x3e\x3ctbody\x3e\x3ctr\x3e\r\n          \x3ctd colspan\x3d"2" align\x3d"center"\x3e\r\n            \x3cdiv dojoType\x3d"dijit.form.HorizontalSlider" dojoAttachPoint\x3d"_tSpeedSlider" style\x3d"width: 600px; margin:3px; " showbuttons\x3d"false" value\x3d"1" minimum\x3d"0" maximum\x3d"4" discretevalues\x3d"1" intermediatechanges\x3d"true"\x3e\r\n              \x3cdiv dojoType\x3d"dijit.form.HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\x3ctr\x3e\r\n          \x3ctd valign\x3d"top" nowrap class\x3d"esriFloatLeading"\x3e\x3clabel\x3e${i18n.slower}\x3c/label\x3e\x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap class\x3d"esriFloatTrailing"\x3e\x3clabel\x3e${i18n.faster}\x3c/label\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"_tAdvancedLink" style\x3d"padding-top:15px;" class\x3d"esriItemLinks esriFloatLeading"\x3e\x3ca href\x3d"JavaScript:void(0);" dojoAttachEvent\x3d"onclick:_showAdvanced"\x3e${i18n.showAdvancedOptions}\x3c/A\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv dojoAttachPoint\x3d"_tSettingsAdvancedDiv" style\x3d"display:none;"\x3e\r\n\r\n        \x3cdiv style\x3d"padding-top:5px;padding-bottom:5px;"\x3e\x3clabel style\x3d"font-weight:bold;"\x3e${i18n.timeSpan}\x3c/label\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"width:620px; position:relative"\x3e\r\n          \x3cdiv style\x3d"padding-bottom:10px;"\x3e\x3clabel\x3e${i18n.dragSliderMessage}\x3c/label\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c!-- hard code to LTR --\x3e\r\n          \x3ctable style\x3d"width:620px;" class\x3d"timeSettingsForm"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd valign\x3d"top"\x3e\r\n                  \x3clabel class\x3d"esriFloatLeading"\x3e${i18n.layers}\x3c/label\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd valign\x3d"top"\x3e\r\n                  \x3clabel class\x3d"esriFloatLeading"\x3e${i18n.layerTimeLines}\x3c/label\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr height\x3d"5"\x3e\r\n                \x3ctd height\x3d"5" colspan\x3d"2"\x3e\r\n                  \x3cdiv style\x3d"height:1px;border-top:#444444 1px solid;"\x3e\x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd width\x3d"200" valign\x3d"top"\x3e\r\n                  \x3cdiv dojoAttachPoint\x3d"_tLayerNamesDiv" class\x3d"timeSettingsLayerNames"\x3e\x3c/div\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd width\x3d"420" valign\x3d"top"\x3e\r\n                \t\x3cdiv style\x3d"position:absolute"\x3e\r\n                  \x3cdiv dojoAttachPoint\x3d"_tSettingsBkgrndDiv" class\x3d"timeSettingsBackground" style\x3d"position:absolute; z-index:0;"\x3e\x3c/div\x3e\r\n                  \x3cdiv dojoAttachPoint\x3d"_tSettingsLyrRange" class\x3d"timeSettingslayerRange" style\x3d"position:relative; z-index:10;"\x3e\x3c/div\x3e\r\n                  \x3cdiv id\x3d"timeSettingsSliderDiv" dojoAttachPoint\x3d"_tSettingsSlider" dojoType\x3d"dojox.form.HorizontalRangeSlider" style\x3d"width: 420px;" showbuttons\x3d"false" intermediatechanges\x3d"true" minimum\x3d"-788889600000" maximum\x3d"1230796800000" value\x3d"-788889600000,1230796800000"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr height\x3d"10"\x3e\r\n                \x3ctd colspan\x3d"4" height\x3d"10"\x3e\x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n\t\t\t\t\t\x3cbr/\x3e\r\n\t\t\t\t\t\x3ctable style\x3d"width:620px;"\x3e\r\n\t\t\t\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd width\x3d"200"\x3e\x26nbsp;\x3c/td\x3e\r\n                \x3ctd nowrap\x3e${i18n.startTime}\x26nbsp;\x26nbsp;\x26nbsp;\x3c/td\x3e\r\n                \x3ctd width\x3d"105"\x3e\r\n                  \x3cinput dojoAttachPoint\x3d"_startDate" style\x3d"width:110px;" type\x3d"text" value\x3d"2005-12-30" dojoType\x3d"dijit.form.DateTextBox" /\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd width\x3d"325"\x3e\r\n                  \x3cinput dojoAttachPoint\x3d"_startTime" style\x3d"width:90px;" type\x3d"text" value\x3d"T15:00:00" id\x3d"time-settings-start-time" dojoType\x3d"dijit.form.TimeTextBox" /\x3e\r\n                \x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\x3ctr height\x3d"3"\x3e\r\n                \x3ctd colspan\x3d"4" height\x3d"3"\x3e\x3c/td\x3e\r\n              \x3c/tr\x3e\x3ctr\x3e\r\n                \x3ctd\x3e\x26nbsp;\x3c/td\x3e\r\n                \x3ctd\x3e${i18n.endTime}\x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cinput dojoAttachPoint\x3d"_endDate" style\x3d"width:110px;" type\x3d"text" value\x3d"2005-12-30" dojoType\x3d"dijit.form.DateTextBox" /\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cinput dojoAttachPoint\x3d"_endTime" style\x3d"width:90px;" type\x3d"text" value\x3d"T15:00:00" id\x3d"time-settings-end-time" dojoType\x3d"dijit.form.TimeTextBox" /\x3e\r\n                \x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/tbody\x3e\r\n\t\t\t\t\t\x3c/table\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv style\x3d"padding-top:10px;padding-bottom:5px;"\x3e\x3clabel style\x3d"font-weight:bold;"\x3e${i18n.timeDisplay}\x3c/label\x3e\x3c/div\x3e\r\n        \x3cdiv\x3e\x3clabel\x3e${i18n.specifyData}\x3c/label\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"padding-top:10px;padding-bottom:10px; line-height:18px;"\x3e\r\n          \x3cdiv\x3e\r\n          \t\x3ctable\x3e\x3ctbody\x3e\x3ctr\x3e\x3ctd\x3e\r\n              \x3cspan\x3e${i18n.displayData}\x3c/span\x3e\r\n          \t\x3c/td\x3e\x3ctd\x3e\t\r\n              \x3cspan dojotype\x3d"dijit.form.ValidationTextBox"  dojoAttachPoint\x3d"_tSettingsIntCount" regExp\x3d"[0-9]+" style\x3d"width:30px;height:18px;vertical-align:middle;" value\x3d"1"\x3e\x3c/span\x3e\r\n            \x3c/td\x3e\x3ctd\x3e \r\n              \x3cselect style\x3d"width:90px;vertical-align:middle;" dojoType\x3d"arcgisonline.sharing.dijit.ComboBox" dojoAttachPoint\x3d"_tSettingsIntUnitSelect" dojoAttachEvent\x3d"onChange:_timeSettingsStopsTimeSpan_onChange"\x3e\r\n            \x3c/select\x3e\r\n            \x3c/td\x3e\x3ctd\x3e \r\n              \x3cspan\x3e${i18n.intervals}\x3c/span\x3e\r\n          \t\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv style\x3d"padding-top:5px;"\x3e\r\n            \x3ctable\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd valign\x3d"top"\x3e\r\n                    \x3cspan\x3e${i18n.asTimePasses}\x3c/span\x3e\r\n                  \x3c/td\x3e\r\n                  \x3ctd\x3e\r\n                 \x3cdiv\x3e\r\n                   \x3cinput type\x3d"radio" name\x3d"stops" dojotype\x3d"dijit.form.RadioButton" id\x3d"stops:interval"  dojoAttachPoint\x3d"_stopsIntervalInput" checked\x3d"checked"/\x3e\r\n                   \x3clabel for\x3d"stops:interval"\x3e${i18n.onlyDisplay}\x3c/label\x3e\r\n                 \x3c/div\x3e\r\n                 \x3cdiv\x3e\r\n                   \x3cinput type\x3d"radio" name\x3d"stops" dojotype\x3d"dijit.form.RadioButton" dojoAttachPoint\x3d"_stopsCumalativeInput" id\x3d"stops:cumulative" /\x3e\r\n                   \x3clabel for\x3d"stops:cumulative"\x3e${i18n.progressivelyDisplay}\x3c/label\x3e\r\n                 \x3c/div\x3e\r\n                 \x3c/td\x3e\r\n               \x3c/tr\x3e\r\n             \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv dojoAttachPoint\x3d"_tSettingsHelp" style\x3d"padding-top:15px; display:none;" class\x3d"esriItemLinks esriFloatLeading"\x3e\x3ca dojoAttachPoint\x3d"_helpLink" href\x3d"" target\x3d"_blank" title\x3d"${i18n.learnMore}"\x3e\x3cdiv class\x3d"questionMarkIcon"\x3e\x3c/div\x3e\x3c/A\x3e\x3c/div\x3e\r\n\r\n      \x3c/div\x3e\r\n\r\n      \x3c/br/\x3e\r\n      \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n        \x3cbutton class\x3d"jevent primary" dojoType\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:_handleOkBtnClick"\x3e${i18n.ok}\x3c/button\x3e\r\n        \x3cbutton class\x3d"jevent cancel" dojoType\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:_handleCloseBtnClick"\x3e${i18n.cancel}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"clear:both;"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv dojotype\x3d"dijit.TooltipDialog" dojoAttachPoint\x3d"_toolTipDialog" title\x3d"" style\x3d"display:none;width:400px;"\x3e\r\n      \x3c!--\x3cdiv style\x3d"float:right;"\x3e\x3cA id\x3d"time-settings-tooltip-close" href\x3d"JavaScript:void(0);" title\x3d"Close"\x3e\x3cimg src\x3d"images/close.gif" border\x3d"0"/\x3e\x3c/A\x3e\x3c/div\x3e--\x3e\r\n      \x3cdiv class\x3d"esriItemLinks"\x3e\x3ca dojoAttachPoint\x3d"tSettingsTipStart"  href\x3d"JavaScript:void(0);"\x3e\x3c/A\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"esriItemLinks"\x3e\x3ca  dojoAttachPoint\x3d"tSettingsTipEnd" href\x3d"JavaScript:void(0);"\x3e\x3c/A\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
init:!1,mapLayers:null,i18n:null,sliderHandler:null,startDateHandler:null,startTimeHandler:null,endDateHandler:null,endTimeHandler:null,_timeSettingsDialog:null,_timeSettingsMainDiv:null,_timeSettingsSpeedDiv:null,_tSpeedSlider:null,_tAdvancedLink:null,_tSettingsAdvancedDiv:null,_tLayerNamesDiv:null,_tSettingsBkgrndDiv:null,_tSettingsLyrRange:null,_tSettingsSlider:null,_startDate:null,_startTime:null,_endDate:null,_endTime:null,_tSettingsIntCount:null,_tSettingsIntUnitSelect:null,_stopsIntervalInput:null,
_stopsCumalativeInput:null,_tSettingsHelp:null,_toolTipDialog:null,tSettingsTipStart:null,tSettingsTipEnd:null,_helpLink:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.TimeSettingsDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=c.i18n.getLocalization("arcgisonline","arcgisonline").common;c.mixin(this.i18n,c.i18n.getLocalization("arcgisonline","arcgisonline").generalDlg);
c.mixin(this.i18n,c.i18n.getLocalization("arcgisonline","arcgisonline").viewer.time);c.mixin(this.i18n,c.i18n.getLocalization("arcgisonline","arcgisonline").timeSettingsDlg)},postCreate:function(){this.init||(this.init=!0)},placeHelpIcon:function(){var b=c.create("a",{className:"esriHelpIcon esriFloatTrailing",title:this.i18n.learnMore,href:esriGeowConfig.self?esriGeowConfig.self.helpBase+esriGeowConfig.self.helpMap.m["120000473"]:"",target:"_blank",style:"margin: 0 10px;"});c.query(".dijitDialogTitle").forEach(c.hitch(this,
function(a){a.innerHTML===this.i18n.timeSettingsDlgTitle&&c.place(b,a,"last")}))},_handleCloseBtnClick:function(b){b.preventDefault();this.hide()},_handleOkBtnClick:function(b){b.preventDefault();this.saveSettings()},_handleTimeSettingsDlgClick:function(){h.popup.close(this._toolTipDialog)},hide:function(){h.popup.close(this._toolTipDialog);this._timeSettingsDialog.hide()},show:function(b){this.mapLayers=b;c.style(this._tSettingsAdvancedDiv,"display","none");c.style(this._tAdvancedLink,"display",
10>c.isIE?"inline":"");this._tSpeedSlider.set("value",5-arcgisonline.map.time.timeSlider.thumbMovingRate/1E3);this._timeSettingsDialog.show()},_showAdvanced:function(){c.style(this._tAdvancedLink,"display","none");c.style(this._tSettingsAdvancedDiv,"display",10>c.isIE?"inline":"");this._timeSettingsDialog._position();c.connect(this._tSettingsIntCount.domNode,"onfocus",this,"onFocusInterval");c.connect(this._tSettingsIntUnitSelect.domNode,"onfocus",this,"onFocusInterval");c.connect(this._tSettingsSlider,
"onChange",this,"adjustSliderBackground");this._startDate.rangeMessage=this.i18n.startDateRangeMsg;this._endDate.rangeMessage=this.i18n.endDateRangeMsg;this._tSettingsIntCount.invalidMessage=this.i18n.invalidNumber;this.setupSliderConnection();this.loadUnitsOption(this._tSettingsIntUnitSelect);this._tLayerNamesDiv.innerHTML="";c.forEach(this.mapLayers,function(a){null!=a&&(null!=a.layer&&a.layer.visible&&a.layer.timeInfo&&a.layer.useMapTime&&!a.layer.timeInfo.hasLiveData)&&(a=a.title,21<a.length&&
(a=a.substring(0,18)+"..."),c.create("span",{innerHTML:a,"class":"timeSettingsLayerNames"},this._tLayerNamesDiv),c.create("br",{},this._tLayerNamesDiv))},this);var b=arcgisonline.map.time.fullTimeExtent,a=arcgisonline.map.time.timeSliderProperties;a&&a.startTime&&a.endTime?(this._tSettingsSlider.set("minimum",Math.min(a.startTime,b.startTime.getTime())),this._tSettingsSlider.set("maximum",Math.max(a.endTime,b.endTime.getTime())),this._tSettingsSlider.set("value",[a.startTime,a.endTime])):a&&a.startTime?
(this._tSettingsSlider.set("minimum",Math.min(a.startTime,b.startTime.getTime())),this._tSettingsSlider.set("maximum",b.endTime.getTime()),this._tSettingsSlider.set("value",[a.startTime,this._tSettingsSlider.maximum])):a&&a.endTime?(this._tSettingsSlider.set("minimum",b.startTime.getTime()),this._tSettingsSlider.set("maximum",Math.max(a.endTime,b.endTime.getTime())),this._tSettingsSlider.set("value",[this._tSettingsSlider.minimum,a.endTime])):(this._tSettingsSlider.set("minimum",b.startTime.getTime()),
this._tSettingsSlider.set("maximum",b.endTime.getTime()),this._tSettingsSlider.set("value",[this._tSettingsSlider.minimum,this._tSettingsSlider.maximum]));this.rebuildBars();a&&1==a.thumbCount?this._stopsCumalativeInput.set("checked",!0):this._stopsIntervalInput.set("checked",!0);a&&a.numberOfStops?(this._tSettingsIntCount.set("value",a.numberOfStops),this._tSettingsIntUnitSelect.set("value",this.i18n.equal)):a&&a.timeStopInterval&&a.timeStopInterval.interval&&a.timeStopInterval.units?(this._tSettingsIntCount.set("value",
a.timeStopInterval.interval),this.setEsriUnits(this._tSettingsIntUnitSelect,a.timeStopInterval.units)):(this._tSettingsIntCount.set("value",arcgisonline.map.time.timeSliderDefaultInterval),this.setEsriUnits(this._tSettingsIntUnitSelect,arcgisonline.map.time.timeSliderDefaultUnits))},saveSettings:function(){var b=this._tSpeedSlider.getValue(),b=Math.round(1E3*(5-b));arcgisonline.map.time.timeSlider.setThumbMovingRate(b);if("none"===c.style(this._tSettingsAdvancedDiv,"display"))arcgisonline.map.time.timeSliderProperties||
(arcgisonline.map.time.timeSliderProperties={startTime:Math.round(arcgisonline.map.time.fullTimeExtent.startTime.getTime()),endTime:Math.round(arcgisonline.map.time.fullTimeExtent.endTime.getTime()),thumbCount:2,timeStopInterval:{interval:arcgisonline.map.time.timeSliderDefaultInterval,units:arcgisonline.map.time.timeSliderDefaultUnits}}),arcgisonline.map.time.timeSliderProperties.thumbMovingRate=b;else{var a=this._tSettingsSlider.get("value"),d=a[0],e=a[1];esriGeowConfig.isRightToLeft&&(d=a[1],e=
a[0]);if(6E4>e-d){b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();b.show({title:this.i18n.errorDlgTitle,message:this.i18n.error.timeSpanSmall});return}var g=a=null,k=2,f=this._tSettingsIntCount.get("value"),f=f.replace(/^\s+|\s+$/g,"");if(0===f.length||isNaN(f)||1>parseInt(f)){b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();b.show({title:this.i18n.errorDlgTitle,message:this.i18n.error.provideGreaterValue});return}if(this._stopsCumalativeInput.get("checked"))k=
1,this._tSettingsIntUnitSelect.get("value")===this.i18n.equal?a=parseInt(f):(g=this.getEsriUnits(this._tSettingsIntUnitSelect),g={interval:parseInt(f),units:g});else if(this._tSettingsIntUnitSelect.get("value")===this.i18n.equal)a=parseInt(f);else{g=this.getEsriUnits(this._tSettingsIntUnitSelect);f=this._tSettingsIntCount.get("value");if(0==f.length||isNaN(f)||1>parseInt(f)){b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();b.show({title:this.i18n.errorDlgTitle,message:this.i18n.error.provideGreaterValue});
return}g={interval:parseInt(f),units:g}}arcgisonline.map.time.timeSliderProperties={startTime:Math.round(d),endTime:Math.round(e),thumbCount:k,thumbMovingRate:b,numberOfStops:a,timeStopInterval:g}}arcgisonline.map.main.markMapAsChangedIfOwner("timeSlider_saveSettings");arcgisonline.map.time.recreateTimeSlider();h.popup.close(this._toolTipDialog);this._timeSettingsDialog.hide()},checkUpdateBars:function(b,a){var c=arcgisonline.map.time.fullTimeExtent,e=this._tSettingsSlider.get("value"),g=e[0],h=e[1];
esriGeowConfig.isRightToLeft&&(g=e[1],h=e[0]);if(b<c.startTime||a>c.endTime)this._tSettingsSlider.set("minimum",Math.min(c.startTime.getTime(),b.getTime())),this._tSettingsSlider.set("maximum",Math.max(c.endTime.getTime(),a.getTime())),this.rebuildBars();else if(g<c.startTime.getTime()||h>c.endTime.getTime())this._tSettingsSlider.set("minimum",c.startTime.getTime()),this._tSettingsSlider.set("maximum",c.endTime.getTime()),this.rebuildBars();this.loadUnitsOption(this._tSettingsIntUnitSelect,b,a)},
rebuildBars:function(){var b=this._tSettingsSlider.get("maximum")-this._tSettingsSlider.get("minimum"),a=parseInt(c.style(c.byId("timeSettingsSliderDiv"),"width"))-2-16,d=b/a;this._tSettingsLyrRange.innerHTML="";c.forEach(this.mapLayers,function(a){if(null!=a&&null!=a.layer&&a.layer.visible&&a.layer.timeInfo&&a.layer.useMapTime&&!a.layer.timeInfo.hasLiveData){var b=Math.round((a.layer.timeInfo.timeExtent.startTime.getTime()-this._tSettingsSlider.get("minimum"))/d),k=Math.round((a.layer.timeInfo.timeExtent.endTime-
a.layer.timeInfo.timeExtent.startTime)/d),f=c.create("div",{id:"bar_"+a.layer.id,"class":"time-settings-layer-bar"},this._tSettingsLyrRange);c.style(f,"width",k+"px");esriGeowConfig.isRightToLeft?c.style(f,"margin","0 "+b+"px 0 0"):c.style(f,"margin","0 0 0 "+b+"px");c.connect(f,"onclick",this,function(b){b.preventDefault();this.tSettingsTipStart.innerHTML=this.i18n.setStartTime+" "+c.date.locale.format(a.layer.timeInfo.timeExtent.startTime,{formatLength:"medium"});this.tSettingsTipEnd.innerHTML=
this.i18n.setEndTime+" "+c.date.locale.format(a.layer.timeInfo.timeExtent.endTime,{formatLength:"medium"});var d=this._tSettingsSlider.get("value"),g=d[0],k=d[1];esriGeowConfig.isRightToLeft&&(g=d[1],k=d[0]);c.connect(this.tSettingsTipStart,"onclick",this,function(b){this._tSettingsSlider.set("value",[a.layer.timeInfo.timeExtent.startTime.getTime(),k]);h.popup.close(this._toolTipDialog)});c.connect(this.tSettingsTipEnd,"onclick",this,function(b){this._tSettingsSlider.set("value",[g,a.layer.timeInfo.timeExtent.endTime.getTime()]);
h.popup.close(this._toolTipDialog)});h.popup.open({popup:this._toolTipDialog,around:f});b||(b=window.event);b.cancelBubble=!0;b.stopPropagation&&b.stopPropagation()});c.create("br",{},this._tSettingsLyrRange)}},this)},adjustSliderBackground:function(b){var a=c.coords(this._tSettingsLyrRange);c.coords(this._tLayerNamesDiv);var d=c.coords(this._tSettingsSlider.progressBar);c.style(this._tSettingsBkgrndDiv,"top","0px");0<d.x-a.x&&c.style(this._tSettingsBkgrndDiv,"left",d.x-a.x+"px");0<d.w&&c.style(this._tSettingsBkgrndDiv,
"width",d.w+"px");0<d.y-a.y+5&&c.style(this._tSettingsBkgrndDiv,"height",d.y-a.y+5+"px");b||setTimeout(c.hitch(this,function(){this.adjustSliderBackground(!0)}),500)},setupSliderConnection:function(){this._tSettingsSliderHandler||(this._tSettingsSliderHandler=c.connect(this._tSettingsSlider,"onChange",this,"onSliderChange"))},destroySliderConnection:function(){c.disconnect(this._tSettingsSliderHandler);this._tSettingsSliderHandler=null},setupInputConnection:function(){this.startDateHandler||(this.startDateHandler=
c.connect(this._startDate,"onChange",this,"onInputChange"));this.startTimeHandler||(this.startTimeHandler=c.connect(this._startTime,"onChange",this,"onInputChange"));this.endDateHandler||(this.endDateHandler=c.connect(this._endDate,"onChange",this,"onInputChange"));this.endTimeHandler||(this.endTimeHandler=c.connect(this._endTime,"onChange",this,"onInputChange"))},destroyInputConnection:function(){c.disconnect(this.startDateHandler);this.startDateHandler=null;c.disconnect(this.startTimeHandler);this.startTimeHandler=
null;c.disconnect(this.endDateHandler);this.endDateHandler=null;c.disconnect(this.endTimeHandler);this.endTimeHandler=null},onSliderChange:function(b){this.destroyInputConnection();var a=Math.min(b[0],b[1]);b=Math.max(b[0],b[1]);this.checkUpdateBars(new Date(a),new Date(b));this._startDate.set("value",new Date(a));this._startTime.set("value",new Date(a));this._endDate.set("value",new Date(b));this._endTime.set("value",new Date(b));this._startDate.constraints.max=new Date(b);this._endDate.constraints.min=
new Date(a);setTimeout(c.hitch(this,function(){this.setupInputConnection()}),1E3)},onInputChange:function(){this.destroySliderConnection();var b=null,a=null;if(this._startDate.isValid()){var d=new Date(this._startDate.get("value")),b=new Date(this._startTime.get("value")),b=new Date(d.getFullYear(),d.getMonth(),d.getDate(),b.getHours(),b.getMinutes(),0,0);this._endDate.constraints.min=d;this._endDate.validate(!1)}this._endDate.isValid()&&(d=new Date(this._endDate.get("value")),a=new Date(this._endTime.get("value")),
a=new Date(d.getFullYear(),d.getMonth(),d.getDate(),a.getHours(),a.getMinutes(),0,0),this._startDate.constraints.max=d,this._startDate.validate(!1));this._startDate.isValid()&&(d=new Date(this._startDate.get("value")),b=new Date(this._startTime.get("value")),b=new Date(d.getFullYear(),d.getMonth(),d.getDate(),b.getHours(),b.getMinutes(),0,0),this._endDate.constraints.min=d);b&&a&&(this.checkUpdateBars(b,a),this._tSettingsSlider.set("value",[b.getTime(),a.getTime()]));setTimeout(c.hitch(this,function(){this.setupSliderConnection()}),
1E3)},onFocusInterval:function(){this._stopsIntervalInput.set("checked",!0)},onFocusCumulative:function(){this._stopsCumalativeInput.set("checked",!0)},_timeSettingsStopsTimeSpan_onChange:function(){},getEsriUnits:function(b){var a;switch(b.get("value")){case this.i18n.century:a="esriTimeUnitsCenturies";break;case this.i18n.decade:a="esriTimeUnitsDecades";break;case this.i18n.year:a="esriTimeUnitsYears";break;case this.i18n.month:a="esriTimeUnitsMonths";break;case this.i18n.week:a="esriTimeUnitsWeeks";
break;case this.i18n.day:a="esriTimeUnitsDays";break;case this.i18n.hour:a="esriTimeUnitsHours";break;case this.i18n.minute:a="esriTimeUnitsMinutes";break;case this.i18n.second:a="esriTimeUnitsSeconds"}return a},setEsriUnits:function(b,a){switch(a){case "esriTimeUnitsCenturies":b.set("value",this.i18n.century);break;case "esriTimeUnitsDecades":b.set("value",this.i18n.decade);break;case "esriTimeUnitsYears":b.set("value",this.i18n.year);break;case "esriTimeUnitsMonths":b.set("value",this.i18n.month);
break;case "esriTimeUnitsWeeks":b.set("value",this.i18n.week);break;case "esriTimeUnitsDays":b.set("value",this.i18n.day);break;case "esriTimeUnitsHours":b.set("value",this.i18n.hour);break;case "esriTimeUnitsMinutes":b.set("value",this.i18n.minute);break;case "esriTimeUnitsSeconds":b.set("value",this.i18n.second);break;default:b.set("value",this.i18n.minute)}},loadUnitsOption:function(b,a,d){var e=new c.data.ItemFileWriteStore({data:{identifier:"name",items:[]}});e.newItem({name:this.i18n.equal});
if(!a||!d)d=arcgisonline.map.time.fullTimeExtent,a=d.startTime,d=d.endTime;100<d.getFullYear()-a.getFullYear()?(e.newItem({name:this.i18n.century}),e.newItem({name:this.i18n.decade}),e.newItem({name:this.i18n.year})):10<=d.getFullYear()-a.getFullYear()?(e.newItem({name:this.i18n.decade}),e.newItem({name:this.i18n.year}),e.newItem({name:this.i18n.month})):314496E5<d.getTime()-a.getTime()?(e.newItem({name:this.i18n.year}),e.newItem({name:this.i18n.month}),e.newItem({name:this.i18n.week})):24192E5<d.getTime()-
a.getTime()?(e.newItem({name:this.i18n.month}),e.newItem({name:this.i18n.week}),e.newItem({name:this.i18n.day})):6048E5<d.getTime()-a.getTime()?(e.newItem({name:this.i18n.week}),e.newItem({name:this.i18n.day}),e.newItem({name:this.i18n.hour})):864E5<d.getTime()-a.getTime()?(e.newItem({name:this.i18n.day}),e.newItem({name:this.i18n.hour}),e.newItem({name:this.i18n.minute})):36E5<d.getTime()-a.getTime()?(e.newItem({name:this.i18n.hour}),e.newItem({name:this.i18n.minute}),e.newItem({name:this.i18n.second})):
6E4<d.getTime()-a.getTime()?(e.newItem({name:this.i18n.minute}),e.newItem({name:this.i18n.second})):1E3<d.getTime()-a.getTime()&&e.newItem({name:this.i18n.second});b.set("store",e)},logDate:function(b,a){console.log(b+" "+c.date.locale.format(a,{formatLength:"medium"}))}})});