// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/Search",["dijit","dojo","dojox","dojo/require!arcgisonline/sharing/util,dijit/_Widget,dijit/_Templated,arcgisonline/sharing/_Search,dijit/form/Button,dijit/form/TextBox,dijit/Menu,arcgisonline/sharing/dijit/dialog/GeneralDlg"],function(d,a,e){a.provide("arcgisonline.sharing.dijit.Search");a.require("arcgisonline.sharing.util");a.require("dijit._Widget");a.require("dijit._Templated");a.require("arcgisonline.sharing._Search");a.require("dijit.form.Button");a.require("dijit.form.TextBox");
a.require("dijit.Menu");a.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");a.declare("arcgisonline.sharing.dijit.Search",[d._Widget,d._Templated,arcgisonline.sharing._Search],{util:arcgisonline.sharing.util,widgetsInTemplate:!0,templateString:'\x3cdiv dojoAttachPoint\x3d"containerNode" class\x3d"search leader-half" id\x3d"search-form-box" style\x3d"position: relative;"\x3e\r\n  \x3cform id\x3d"search-form" autocomplete\x3d"off" class\x3d"dropdown"\x3e\r\n\r\n    \x3cinput name\x3d"q" type\x3d"search" dojoType\x3d"dijit.form.TextBox" trim\x3d"true" id\x3d"search-box" dojoAttachPoint\x3d"searchText" dojoAttachEvent\x3d"onKeyPress:_onSearchKeyPress,onFocus:_onSearchTextFocus,onBlur:_onSearchBoxBlur" alt\x3d"${i18n.searchFor}" title\x3d"${i18n.searchFor}"/\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_domainsContainer" class\x3d"js-domains hide dropdown-menu dropdown-right"\x3e\r\n      \x3ca dojoAttachEvent\x3d"onclick:_onFilterClick" class\x3d"dropdown-link is-active" filter\x3d""\x3e${i18n.searchAllContent}\x3c/a\x3e\r\n      \x3ca dojoAttachEvent\x3d"onclick:_onFilterClick" class\x3d"dropdown-link" filter\x3d"maps"\x3e${i18n.searchForMaps}\x3c/a\x3e\r\n      \x3ca dojoAttachEvent\x3d"onclick:_onFilterClick" class\x3d"dropdown-link" filter\x3d"layers"\x3e${i18n.searchForLayers}\x3c/a\x3e\r\n      \x3ca dojoAttachEvent\x3d"onclick:_onFilterClick" class\x3d"dropdown-link" filter\x3d"applications"\x3e${i18n.searchForApps}\x3c/a\x3e\r\n      \x3ca dojoAttachEvent\x3d"onclick:_onFilterClick" class\x3d"dropdown-link" filter\x3d"scenes"\x3e${i18n.searchForScenes}\x3c/a\x3e\r\n      \x3ca dojoAttachEvent\x3d"onclick:_onFilterClick" class\x3d"dropdown-link" filter\x3d"tools"\x3e${i18n.searchForTools}\x3c/a\x3e\r\n      \x3ca dojoAttachEvent\x3d"onclick:_onFilterClick" class\x3d"dropdown-link" filter\x3d"files"\x3e${i18n.searchForFiles}\x3c/a\x3e\r\n      \x3ca dojoAttachPoint\x3d"_groupSearchAnchor" dojoAttachEvent\x3d"onclick:_onFilterClick" class\x3d"dropdown-link" filter\x3d"group" style\x3d"display:none;"\x3e${i18n.searchForThisGroup}\x3c/a\x3e\r\n      \x3ca dojoAttachEvent\x3d"onclick:_onFilterClick" class\x3d"dropdown-link" filter\x3d"groups"\x3e${i18n.searchForGroups}\x3c/a\x3e\r\n    \x3c/div\x3e\r\n\r\n  \x3c/form\x3e\r\n\x3c/div\x3e',
query:"",domain:null,focus:null,owner:"",group:"",searchButton:null,searchText:null,_domainsContainer:null,_groupSeachAnchor:null,showDomainsAnim:null,hidedomainsAnim:null,_currentSearchBoxTip:null,searchBoxTip:null,searchBoxTipGroup:null,searchBoxTipGroups:null,_firstLinkPos:0,i18n:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=a.i18n.getLocalization("arcgisonline","arcgisonline").common;a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").search);this.searchBoxTip=
this.i18n.searchBoxTip;this.searchBoxTipGroup=this.i18n.searchBoxTipGroup;this.searchBoxTipGroups=this.i18n.searchBoxTipGroups},postCreate:function(){this.restrict=(this._queryStringParams=a.queryToObject(window.location.search.slice(1)))&&this._queryStringParams.restrict;a.query("input",this.domNode).addClass("leader-0").addClass("calcite-web-input");-1!==window.location.pathname.toLowerCase().indexOf("group.html")&&(this.owner=this._queryStringParams.owner,this.title=this._queryStringParams.title,
a.style(this._groupSearchAnchor,"display",""));var b=a.query(".js-domains a",this.domNode);b.removeClass("is-active");this._queryStringParams.t&&"content"!==this._queryStringParams.t?a.query(".js-domains a[filter\x3d"+this._queryStringParams.t+"]",this.domNode).addClass("is-active"):this._queryStringParams.focus?(this.focus="all"===this._queryStringParams.focus?null:this._queryStringParams.focus,a.query(".js-domains a[filter\x3d"+(this.focus?this.focus.split("-")[0]:"")+"]",this.domNode).addClass("is-active")):
-1!==window.location.pathname.toLowerCase().indexOf("group.html")?a.query(".js-domains a[filter\x3d'group']",this.domNode).addClass("is-active"):-1!==window.location.pathname.toLowerCase().indexOf("groups.html")?a.query(".js-domains a[filter\x3d'groups']",this.domNode).addClass("is-active"):a.query(".js-domains a[filter\x3d'']",this.domNode).addClass("is-active");a.forEach(b,function(c,b){a.hasClass(c,"is-active")&&(this._firstLinkPos=b)},this);this._loadSearchBoxTip();a.connect(this.searchText,"onFocus",
this,this._onSearchTextFocus);a.subscribe("onRestrictSearchChange",a.hitch(this,function(a){this.restrict=a.restrictSearch}));this.showDomainsAnim=a.anim(this._domainsContainer,{opacity:1,beforeBegin:function(b){a.query("#search-form").addClass("is-active")}},300);this.hidedomainsAnim=a.anim(this._domainsContainer,{opacity:0,onEnd:function(b){a.query("#search-form").removeClass("is-active")}},300);this.hidedomainsAnim.play();a.query(".searchNode").removeClass("openSearch")},_loadSearchBoxTip:function(a){this.searchText.set("value",
this._queryStringParams.q||"")},doSearch:function(b){if(-1<b.indexOf("*"))arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorLabel,message:this.i18n.error.wildCardSearchError}),this.searchText.focus();else if(b===this._currentSearchBoxTip||""===b)this.searchText.focus();else{this.hidedomainsAnim.play();a.query(".searchNode").removeClass("openSearch");var c={};c.q=b;c.t="content";this.focus&&(c.focus=this.focus);esri.isDefined(this.restrict)&&(c.restrict=
this.restrict);b=a.query(".js-domains a.is-active")[0];void 0!=b&&a.hasAttr(b,"filter")&&(b=a.trim(a.attr(b,"filter")),"groups"==b?c.t="groups":"group"==b&&(c.t="group"));b=a.queryToObject(window.location.search.slice(1));c.sortField=b.sortField||null;c.sortOrder=b.sortOrder||null;this.goToSearch(c,{useCurrentPageLocation:"group"===c.t,clearParams:"group"!==c.t})}},_onFilterClick:function(b){this.focus=a.attr(b.currentTarget,"filter");null!=this.focus&&(a.query(".js-domains a",this.domNode).removeClass("is-active"),
a.addClass(b.currentTarget,"is-active"),this._onSearchClick(b))},_onSearchTextFocus:function(b){var c=a.connect(this.showDomainsAnim,"onEnd",a.hitch(this,function(){a.disconnect(c);this.searchText.focus()}));a.query(".searchNode").addClass("openSearch");this.showDomainsAnim.play()},_onBlur:function(b){this.hidedomainsAnim.play();a.query(".searchNode").removeClass("openSearch")},_onSearchBoxFocus:function(a){},_onSearchBoxBlur:function(a){""==this.searchText.getValue()&&(this._queryStringParams.q=
null,this._loadSearchBoxTip())},_onSearchClick:function(b){a.stopEvent(b);var c=this.searchText.getValue();null!=b&&b.prefentDefault&&b.preventDefault();0==a.trim(c).length?this.searchText.focus():this.doSearch(c)},_onSearchKeyPress:function(b){if(b.keyCode==a.keys.ENTER)a.stopEvent(b),this._onSearchClick(b);else if(b.keyCode===a.keys.DOWN_ARROW){this._firstLinkPos++;var c=a.query(".js-domains a",this.domNode);a.forEach(c,function(b){a.removeClass(b,"is-active")});0<c.length&&(this._firstLinkPos%=
c.length,"none"===a.style(c[this._firstLinkPos],"display")&&(this._firstLinkPos++,this._firstLinkPos%=c.length),c[this._firstLinkPos].focus(),a.addClass(c[this._firstLinkPos],"is-active"),this.focus=a.attr(c[this._firstLinkPos],"filter"))}else b.keyCode===a.keys.UP_ARROW&&(this._firstLinkPos--,c=a.query(".js-domains a",this.domNode),a.forEach(c,function(b){a.removeClass(b,"is-active")}),0<c.length&&(this._firstLinkPos=(this._firstLinkPos+c.length)%c.length,"none"===a.style(c[this._firstLinkPos],"display")&&
(this._firstLinkPos--,this._firstLinkPos=(this._firstLinkPos+c.length)%c.length),c[this._firstLinkPos].focus(),a.addClass(c[this._firstLinkPos],"is-active"),this.focus=a.attr(c[this._firstLinkPos],"filter")));this.onSearchFieldKeyPress(b)},onSearchFieldKeyPress:function(a){}})});