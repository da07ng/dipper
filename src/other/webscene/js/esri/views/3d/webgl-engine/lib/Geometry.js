// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define(["./IdGen","./Util","./gl-matrix"],function(B,q,C){var n=C.vec3d,D=new B,F=function E(c,g,l,u,b){q.assert(1<=c.length);q.assert(0===l.length%g);q.assert(l.length>=c.length*g);q.assert(3===u.size||4===u.size);var k=u.data,A=u.size,e=0,f=c.length;null!=b&&(e=b[0],f=b[1]+1);var d=A*l[g*c[e]],v=n.createFrom(k[d],k[d+1],k[d+2]),x=n.create(v),p;for(b=e;b<f;++b){var y=g*c[b];for(p=0;p<g;++p)for(var d=A*l[y+p],h=0;3>h;++h){var w=k[d+h];w<v[h]?v[h]=w:w>x[h]&&(x[h]=w)}}var s=n.create();n.lerp(v,x,0.5,
s);var t=0;for(b=e;b<f;++b){y=g*c[b];for(p=0;p<g;++p)d=A*l[y+p],e=k[d]-s[0],h=k[d+1]-s[1],d=k[d+2]-s[2],d=e*e+h*h+d*d,d>t&&(t=d)}var t=Math.sqrt(t),z;this.getCenter=function(){return s};this.getBSRadius=function(){return t};this.getBBMin=function(){return v};this.getBBMax=function(){return x};this.getPrimitiveIndices=function(){return c};this.getIndices=function(){return l};this.getPosition=function(){return u};this.getChildren=function(){if(void 0===z&&(z="no_children",1<n.dist2(v,x))){var b=n.lerp(v,
x,0.5,n.create()),d=c.length,f=new Uint8Array(d),e=Array(8),a;for(a=0;8>a;++a)e[a]=0;for(a=0;a<d;++a){for(var m=0,k=g*c[a],h=u.data,r=A*l[k],p=h[r],q=h[r+1],s=h[r+2],t=1;t<g;++t){var r=A*l[k+t],w=h[r],y=h[r+1],r=h[r+2];w<p&&(p=w);y<q&&(q=y);r<s&&(s=r)}p<b[0]&&(m|=1);q<b[1]&&(m|=2);s<b[2]&&(m|=4);f[a]=m;++e[m]}for(a=m=0;8>a;++a)0<e[a]&&++m;if(2>m)return;b=Array(8);for(a=0;8>a;++a)b[a]=0<e[a]?new Uint32Array(e[a]):void 0;for(a=0;8>a;++a)e[a]=0;for(a=0;a<d;++a)m=f[a],b[m][e[m]++]=c[a];z=Array(8);for(a=
0;8>a;++a)void 0!==b[a]&&(z[a]=new E(b[a],g,l,u))}return"no_children"===z?void 0:z}};return function(n,c,g){var l=D.gen(c);this.getId=function(){return l};this.metadata=void 0;this.singleUse=!1;q.assert(1<=n.getFaces().length);g=g||[];this.getData=function(){return n};this.getNumGroups=function(){return n.getFaces().length};this.calculateBoundingInfo=function(g,b){var k=n.getFaces()[g],c="triangle"===k.type?3:1,e=k.indices[k.positionKey],f;if(0===e.length){e=new Uint32Array(c);for(f=0;f<c;++f)e[f]=
f}f=e.length;q.assert(0===f%c);var d=f/c,l=new Uint32Array(d);for(f=0;f<d;++f)l[f]=f;return new F(l,c,e,n.getVertexAttr()[k.positionKey],b)};this.getBoundingInfo=function(c){var b=g[c];void 0===b&&(b=this.calculateBoundingInfo(c),g[c]=b);return b};this.invalidateBoundingInfo=function(){g=[]}}});