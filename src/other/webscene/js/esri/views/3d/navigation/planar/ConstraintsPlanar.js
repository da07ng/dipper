// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("../mixins/ConstraintsMixin ../../support/mathUtils ../../support/earthUtils ../../support/RenderCoordsHelper ../../constraints/SceneViewTiltConstraint ../../lib/glMatrix ../../webgl-engine/lib/Util".split(" "),function(p,g,q,v,r,s,w){var f=s.vec3d,t=s.vec4d,u=t.create(),k=f.create(),l=f.create();return p.createSubclass({declaredClass:"esri.views.3d.navigation.planar.ConstraintsPlanar",defaultConstraints:{tilt:new p.Tilt({min:function(){return g.deg2rad(r.MAX_DEFAULT)},max:g.makePiecewiseLinearFunction([[4E3,
g.deg2rad(r.MIN_DEFAULT)],[1E4,g.deg2rad(88)],[6E6,g.deg2rad(88)]])}),altitude:new p.Altitude({min:function(a){return a._autoAltitudeConstraints.min},max:function(a){return a._autoAltitudeConstraints.max}}),collision:new p.Collision},_updateAutoAltitudeConstraints:function(a){a=Math.max(a.xmax-a.xmin,a.ymax-a.ymin);var b=this.mapCoordsHelper?this.mapCoordsHelper.mapUnitInMeters:1;this._autoAltitudeConstraints.max=3*a/Math.atan(this._targetCameraBeforeElevationUpdate._fov/2);this._autoAltitudeConstraints.min=
-this._autoAltitudeConstraints.max;this._autoAltitudeConstraints.min*=b;this._autoAltitudeConstraints.max*=b},limitAltitude:function(a,b,c,e){return this.constraints.altitude.apply(this,a)},limitTiltByAltitudeConstraints:function(a,b,c,e){return a},distanceToSilhouette:function(a,b,c,e,d){d||(d={maxFarNearRatio:0,distance:0});d.maxFarNearRatio=this.maxFarNearRatio;var m=v.Planar.prototype.getAltitude(a.eye),h=m*=c;e=m-e;var n=this.elevationProvider?this.elevationProvider.getElevationBounds():null;
n&&(m=0<=e?h-c*n[0]:c*n[1]-h);f.subtract(a.center,a.eye,l);k[0]=0<l[0]?b.xmax:b.xmin;k[1]=0<l[1]?b.ymax:b.ymin;k[2]=0<l[2]?b.zmax:b.zmin;f.subtract(k,a.eye);f.normalize(l);a=f.dot(k,l);a=1.1*a*c;h=m+q.earthRadius;h=Math.sqrt(h*h-q.earthRadius*q.earthRadius);b=Math.max(b.xmax-b.xmin,b.ymax-b.ymin);n=1E-4*b*c;c=g.clamp((m-n)/(0.0010*b*c-n),0,1);d.distance=g.lerp(h,a,c*c*c);d.maxFarNearRatio=g.clamp(2E6-2E6*((Math.log(Math.abs(e))-9.55)/(11.27-9.55)),2E4,2E6);d.distance*=Math.max(100*Math.log(Math.abs(e)),
1);d.distance=Math.min(d.distance,34064E4);return d},intersectManifold:function(a,b,c,e){var d=this.renderCoordsHelper.worldUp;t.set4(d[0],d[1],d[2],c,u);return!w.rayPlane(a,b,u,e)||0>f.dot(f.subtract(e,a,k),b)?!1:!0},getCenterIntersectTerrainFallback:function(a,b,c){f.set(b,c)}})});