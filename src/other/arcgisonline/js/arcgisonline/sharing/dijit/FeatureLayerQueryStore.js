// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/FeatureLayerQueryStore",["dijit","dojo","dojox","dojo/require!arcgisonline/sharing/dijit/FeatureLayerQueryResult"],function(l,f,m){f.provide("arcgisonline.sharing.dijit.FeatureLayerQueryStore");f.require("arcgisonline.sharing.dijit.FeatureLayerQueryResult");f.declare("arcgisonline.sharing.dijit.FeatureLayerQueryStore",null,{queryUrl:"",idProperty:"id",data:[],constructor:function(a){f.mixin(this,a);this.layer=a.layer;this.objectIds=a.objectIds;this.where=a.where;
this.orderByFields=a.orderByFields;this.totalCount=a.totalCount;this.batchCount=a.batchCount||25;this.idProperty=this.layer.objectIdField},get:function(a,f){return this.data[a]},getIdentity:function(a){return a[this.idProperty]},query:function(a,h){var e=new esri.tasks.Query,d=h.start||0,g=this.batchCount;this.objectIds?e.objectIds=this.objectIds.length>=d+this.batchCount?this.objectIds.slice(d,d+g):this.objectIds.slice(d):(e.start=d,e.num=g,e.where=this.where,e.orderByFields=this.orderByFields);
e.returnGeometry=!1;e.outFields=["*"];var k=this.totalCount,d=this.layer.queryFeatures(e);d.total=d.then(f.hitch(this,function(c){if(this.objectIds){var a=c.objectIdFieldName;if(!a)for(var b=0;b<c.fields.length;b++)if("esriFieldTypeOID"==c.fields[b].type){a=c.fields[b].name;break}for(var d={},b=0;b<c.features.length;b++)d[c.features[b].attributes[a]]=c.features[b];c.features=f.map(e.objectIds,function(a){return d[a]})}for(b=0;b<c.features.length;b++)c.features[b]=c.features[b].attributes,this.data[c.features[b][a]]=
c.features[b];c=c.features;return k}),function(){console.log("FeatureLayerQueryStore queryFeatures failed.");return 0});return arcgisonline.sharing.dijit.FeatureLayerQueryResult(d)}})});