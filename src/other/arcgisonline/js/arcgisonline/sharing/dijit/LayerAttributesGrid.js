// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/LayerAttributesGrid",["dijit","dojo","dojox","dojo/require!dijit/_Widget,dojox/rpc/Service,dojo/rpc/JsonService,dijit/Dialog,dijit/TooltipDialog,dojox/grid/DataGrid"],function(e,c,g){c.provide("arcgisonline.sharing.dijit.LayerAttributesGrid");c.require("dijit._Widget");c.require("dojox.rpc.Service");c.require("dojo.rpc.JsonService");c.require("dijit.Dialog");c.require("dijit.TooltipDialog");c.require("dojox.grid.DataGrid");c.declare("arcgisonline.sharing.dijit.LayerAttributesGrid",
[e._Widget],{id:"",grid:null,ts:null,gridId:"layerAttributesNode",executeQueryOnStartup:!1,gridScrollBox:null,constructor:function(b,a){},postCreate:function(){this.createGrid()},fillGrid:function(b){this.getAttributes(b)},createGrid:function(){this.grid=new g.grid.DataGrid({structure:[[{get:arcgisonline.sharing.dijit.LayerAttributesGrid.formatters.selectItem,formatter:arcgisonline.sharing.util.fix,name:"\x3cinput type\x3d'checkbox' id\x3d'selected' name\x3d'selected' onclick\x3d'arcgisonline.sharing.dijit.LayerAttributesGrid.util.check(this);' style\x3d'border:none; padding:0px; margin:0px;' /\x3e",
width:"15px"},{field:"alias",get:arcgisonline.sharing.dijit.LayerAttributesGrid.formatters.name,formatter:arcgisonline.sharing.util.fix,name:"Field",width:"auto"},{get:arcgisonline.sharing.dijit.LayerAttributesGrid.formatters.value,formatter:arcgisonline.sharing.util.fix,name:"Display As",width:"auto"},{get:arcgisonline.sharing.dijit.LayerAttributesGrid.formatters.blank,formatter:arcgisonline.sharing.util.fix,width:"10px"}]],rowsPerPage:10,noDataMessage:"\x3cspan style\x3d'font-size:1em;color:#7a7979;'\x3eClick Go to start a search.\x3c/span\x3e",
loadingMessage:"\x3cspan style\x3d'font-size:1em;color:#7a7979;'\x3eSearching...Please wait...\x3c/span\x3e",region:"center",id:this.gridId,selectionMode:"none",style:"width:200px",clientSort:!1,canSort:arcgisonline.sharing.dijit.LayerAttributesGrid.util.noSort});container.addChild(this.grid);this.grid.startup()},buildStore:function(b){var a=[],d="objectid;shape;shape_length;shape_area;perimeter;stretched value;fnode_;tnode_;lpoly_;rpoly_;poly_;subclass;subclass;rings_ok;rings_nok".split(";");c.forEach(b,
function(b,c){arcgisonline.map.main.contains(d,b.name.toLowerCase())||a.push({name:b.name,alias:b.alias,type:b.type,selected:!1})},this);return new c.data.ItemFileReadStore({data:{identifier:"name",label:"alias",items:a}})},getAttributes:function(b){this.emptyStore();this.url=b;var a=this.grid,d=!1,f=!1;setTimeout(function(){f||(d=!0,a.showMessage("\x3cspan style\x3d'font-size:1em;color:#7a7979;'\x3eNo attributes found.\x3c/span\x3e"))},1E4);this.grid.showMessage("\x3cspan style\x3d'font-size:1em;color:#7a7979;'\x3eLoading...Please wait...\x3c/span\x3e");
this.getJson(b,c.hitch(this,function(b,a){f=!0;if(!d){var c=this.buildStore(b.fields);this.grid.setStore(c);this.grid.setSortIndex(1,!0)}}),c.hitch(this,function(b,a){f=!0;d||this.grid.showMessage("\x3cspan style\x3d'font-size:1em;color:#7a7979;'\x3eNo attributes found.\x3c/span\x3e")}))},emptyStore:function(){this.servicesItems=[];this.lastResultCount=-1;var b=new c.data.ItemFileReadStore({data:{identifier:"name",label:"item",items:this.servicesItems}});this.grid.setStore(b)},getJson:function(b,
a,d){b=0<=b.indexOf("?")?b+"\x26f\x3djson":b+"?f\x3djson";c.io.script.get({url:b,callbackParamName:"callback",load:function(c,e){arcgisonline.sharing.util.handler(c,e,b,a,d)},error:function(a,c){arcgisonline.sharing.util.errorHandler(a,c,b,d)}})}});arcgisonline.sharing.dijit.LayerAttributesGrid.formatters={selectItem:function(b,a){return!a?this.defaultValue:'\x3cinput type\x3d"checkbox" id\x3d"chk_'+a.name+'" onclick\x3d"arcgisonline.sharing.dijit.LayerAttributesGrid.util.checkItem(\''+a.name+"');\" "+
(!0===a.selected?"checked":"")+' style\x3d"width:auto;" class\x3d"dojoxGridInput" /\x3e'},name:function(b,a){return!a?this.defaultValue:a.alias},value:function(b,a){if(!a)return this.defaultValue;var d="";switch(a.type[0]){case "esriFieldTypeInteger":d="1234";break;case "esriFieldTypeString":d="abc";break;case "esriFieldTypeDouble":d="12.34";break;case "esriFieldTypeDate":d="12/01/10";break;default:d=""}return d},blank:function(b,a){return""}};arcgisonline.sharing.dijit.LayerAttributesGrid.util={check:function(b){var a=
e.byId("layerAttributesNode");c.forEach(a.store._arrayOfAllItems,function(a){a.selected=b.checked;c.byId("chk_"+a.name)&&(c.byId("chk_"+a.name).checked=b.checked)});a.store.save()},checkItem:function(b){var a=e.byId("layerAttributesNode");c.forEach(a.store._arrayOfAllItems,function(a){a.name==b&&(1==a.selected.length?a.selected[0]=a.selected[0]?!1:!0:a.selected=a.selected?!1:!0)});this.checkAllCheckbox()},checkAllCheckbox:function(){var b=!0,a=e.byId("layerAttributesNode");c.forEach(a.store._arrayOfAllItems,
function(a){1==a.selected.length?a.selected[0]||(b=!1):a.selected||(b=!1)});c.byId("selected").checked=b},noSort:function(b){return 2==b?!0:!1}}});