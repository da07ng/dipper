// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/ItemsGrid",["dijit","dojo","dojox","dojo/require!arcgisonline/sharing/geow/Content,arcgisonline/sharing/geow/Community,arcgisonline/sharing/dijit/Gallery,arcgisonline/sharing/dijit/views,arcgisonline/sharing/util,dojo/mouse"],function(f,a,l){a.provide("arcgisonline.sharing.dijit.ItemsGrid");a.require("arcgisonline.sharing.geow.Content");a.require("arcgisonline.sharing.geow.Community");a.require("arcgisonline.sharing.dijit.Gallery");a.require("arcgisonline.sharing.dijit.views");
a.require("arcgisonline.sharing.util");a.require("dojo.mouse");a.declare("arcgisonline.sharing.dijit.ItemsGrid",[f._Widget,f._Templated],{_gallery:null,itemsGroupId:null,groupQuery:null,galleryNodes:4,sortField:null,sortOrder:null,showThumbnail:!0,templateString:"\x3cdiv dojoAttachPoint\x3d'containerNode' class\x3d'itemsGallery'\x3e\x3c/div\x3e",textMenus:[],i18n:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=a.i18n.getLocalization("arcgisonline","arcgisonline").common;this.i18n=
a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").itemLinks);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").templatesGridWidget)},_getItems:function(){var e={q:"group:"+this.itemsGroupId+'(type:"Map Service" OR type:"Image Service" OR type:"Feature Service" OR type:"WMS" OR type:"KML") ',sortField:null,num:"50"};this.sortOrder&&(e.sortOrder=this.sortOrder);arcgisonline.sharing.geow.Content.search(esriGeowConfig.restBaseUrl+"search",e,a.hitch(this,this._handleItemsResponse),
a.hitch(this,this._handleItemsResponse))},refresh:function(){this._getItems()},postCreate:function(){this._gallery=new arcgisonline.sharing.dijit.Gallery({id:this.id+"_Gallery",nodesPerPage:this.galleryNodes,showNodeLabels:!0,showToolTip:!1,noResultsMessage:"\x3cp class\x3d'esriItemLinks'\x3e\x3cspan\x3e"+this.i18n.noItemsToDisplay+"\x3c/span\x3e\x3c/p\x3e"},a.create("div",null,this.domNode));this._user=arcgisonline.sharing.util.getUser();var e=this;a.mixin(this._gallery,{_buildNodeLayout:function(b,
k){var c=a.create("div",{id:"galleryNode_"+b.id,"class":this.nodeClass,style:"position:relative;"});a.addClass(c,k?"large":"small");if(this.showNodeLabels){var g=a.create("div",{"class":"galleryLabelContainer"},c),d=b.title||"";a.create("span",{innerHTML:d,alt:d,title:d},g)}arcgisonline.sharing.util.getGalleryMainLinkInfo(b);g=a.create("a",{href:"JavaScript:void(0);"},c);a.create("img",{"class":this.thumbClass,src:b.thumbnail?this._getThumbailUrl(b):arcgisonline.sharing.util.relativeToExplicitUrl("images/transparent.gif")},
g);a.create("br",null,c);d=a.create("div",{"class":"linksDiv"},c);d=a.create("a",{href:"JavaScript:void(0);"},d);a.create("span",{"class":"esriItemLinks",innerHTML:this.i18n.addToViewer},d);a.connect(d,"onclick",a.hitch(this,function(a){arcgisonline.map.save_open.openServiceItemCards(a,!1);"contentStack"!=arcgisonline.map.leftPanel.getLeftContentPanelStack()&&arcgisonline.map.leftPanel.openLeftTOCPanel()},b.id));d=b.snippet||"";145<d.length&&(d=d.substring(0,140)+"...");var d=a.create("div",{id:"tooltip"+
b.id,className:"itemsGridTooltip",innerHTML:'\x3cp class\x3d"title ellipsis"\x3e'+b.title+"\x3c/p\x3e\x3cp\x3e"+d+"\x3c/p\x3e"},c,"first"),h=function(e){(e=a.byId(e))&&a.style(e,{opacity:0,display:"none"})},f=function(b,d){var c=a.byId(b);esri.show(c);var g=a.coords(c),f=a.coords(a.byId(d).parentNode);esriGeowConfig.isRightToLeft&&g.x+g.l<f.x+f.l?(a.style(c,"right","auto"),a.style(c,"left",a.isIE?"10px":"0")):g.w+g.x>f.w+f.x&&(a.style(c,"left","auto"),a.style(c,"right",a.isIE?"10px":"0"));a.fadeIn({node:c}).play();
a.forEach(e.textMenus,function(a){a.hide()})};/ipad|android|android 3.0|xoom|sch-i800|playbook|tablet|kindle/i.test(navigator.userAgent.toLowerCase())?a.connect(g,"onclick",function(){var e=a.byId("tooltip"+b.id);e&&"block"===a.getStyle(e,"display")?h("tooltip"+b.id):f("tooltip"+b.id,"galleryNode_"+b.id);a.query(".itemsGridTooltip").forEach(function(a){a.id!=="tooltip"+b.id&&h(a.id)})}):(a.connect(g,a.mouse.enter,function(){a.query(".itemsGridTooltip").forEach(function(a){h(a.id)});f("tooltip"+b.id,
"galleryNode_"+b.id)}),a.connect(d,a.mouse.leave,function(){h("tooltip"+b.id)}));return c}});this._gallery.startup()},_setGroupQueryAttr:function(e){(this.groupQuery=e)&&0<this.groupQuery.length&&arcgisonline.sharing.geow.Community.searchGroups(this.groupQuery,a.hitch(this,this._handleGetGroup),a.hitch(this,this._handleGetGroup))},_setGroupIdAttr:function(a){null===a||0===a.length||(this.pageCount=0,this.itemsGroupId=a,this._getItems())},_handleItemsResponse:function(e,b){for(var f,c=[],g=0;g<e.results.length;g++)f=
e.results[g],f.url&&c.push(f);a.attr(this._gallery,"items",c)},_handleGetGroup:function(a,b){a&&1==a.total?(this.itemsGroupId=a.results[0].id,a.results[0].sortField&&(this.sortField=a.results[0].sortField),a.results[0].sortOrder&&(this.sortOrder=a.results[0].sortOrder),this._setGroupIdAttr(a.results[0].id)):a&&1<a.total?console.error("ItemsGrid: group query '"+this.groupQuery+"' returned more than 1 result."):console.error('ItemsGrid: group with title "'+this.groupQuery+'" does not exist.')},nextPage:function(){this._gallery.nextPage()},
prevPage:function(){this._gallery.prevPage()}})});