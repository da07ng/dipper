// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define(["../../request","./portalResult","dojo/_base/array","../../core/declare","dojo/_base/lang"],function(g,h,k,l,d){var f=l([],{portal:null,esriPortal:null,constructor:function(c){this.esriPortal=(this.portal=c)&&c.esriPortal||{}},useSSL:function(c,b){var a=this.esriPortal&&this.esriPortal.self||{};if(a&&!a.isPortal)return-1!==c.indexOf("https:")||a.allSSL?b.replace("http:","https:"):b;var e=f.getLocation(b);if(-1<a.portalHostname.toLowerCase().indexOf(e.hostname.toLowerCase())&&e.port&&"80"!==
e.port&&"443"!==e.port){var d=e.pathname,d=0===d.indexOf("/")?d:"/"+d;return a.allSSL||-1<c.indexOf("https:")?"https://"+e.hostname+(a.httpsPort&&"443"!==a.httpsPort?":"+a.httpsPort:"")+d+e.search:"http://"+e.hostname+(a.httpPort&&"80"!==a.httpPort?":"+a.httpPort:"")+d+e.search}return-1!==c.indexOf("https:")||a.allSSL?b.replace("http:","https:"):b},formatUrl:function(c){var b=this.esriPortal.currentToken;return-1!==c.indexOf("null")?null:this.useSSL(window.location.protocol,b?c+(-1!==c.indexOf("?")?
"\x26":"?")+("token\x3d"+b):c)},requestToTypedArray:function(c,b,a,e,g){return h(this.request(c,b,a).then(d.partial(f.resultsToTypedArray,e,g)))},request:function(c,b,a){var e;b&&b.portal&&delete b.portal;b&&b.form&&(e=b.form,delete b.form);b=d.mixin(d.mixin({},b||{}),this.esriPortal.requestParams);a=d.mixin(a||{},this.esriPortal.options);return g({url:this.useSSL(window.location.protocol,c.url||c),content:b,callbackParamName:"callback",timeout:a&&a.timeout||0,form:e},a)},formatQueryParams:function(c,
b,a){c=d.mixin(d.mixin({},c),d.isString(b)?{q:b}:b||{});c.q=!a&&this.esriPortal.extraQuery?"("+c.q+")"+this.esriPortal.extraQuery:c.q;return c}});f.getLocation=function(c){var b=document.createElement("a");b.href=c;return{protocol:b.protocol,hostname:b.hostname,port:b.port,pathname:b.pathname,search:b.search,hash:b.hash,host:b.host}};f.resultsToTypedArray=function(c,b,a){a=a?a.listings||a.notifications||a.userInvitations||a.tags||a.items||a.groups||a.comments||a.provisions||a.results||a:[];return k.map(a,
function(a){a=d.mixin(a,b||{});return c?new c(a):a})};f.clearFieldsFromObject=function(c,b){var a,e=c.length;if(d.isArray(c))for(a=0;a<e;a++)delete b[c[a]];else for(a in c)c.hasOwnProperty(a)&&delete b[a];return b};return f});