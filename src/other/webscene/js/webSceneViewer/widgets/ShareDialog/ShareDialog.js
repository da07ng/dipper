// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
require({cache:{"url:webSceneViewer/widgets/ShareDialog/templates/ShareDialog.html":'\x3cdiv class\x3d"shareDialog" \x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"Text"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"linkShare" data-dojo-attach-point\x3d"LinkShareContainer"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"LinkText" class\x3d"shareLinkText"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"shareLinkIcons"\x3e\r\n      \x3cdiv class\x3d"email" data-dojo-attach-event\x3d"click:_toEmail"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"facebook" data-dojo-attach-event\x3d"click:_toFacebook" data-dojo-attach-point\x3d"FacebookShare"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"twitter" data-dojo-attach-event\x3d"click:_toTwitter" data-dojo-attach-point\x3d"TwitterShare"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3clabel\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"ShortenLinkCheckbox"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"ShortenLinkText"\x3e\x3c/span\x3e\r\n    \x3c/label\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"embedShare"  data-dojo-attach-point\x3d"EmbedShareContainer"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"embedText" class\x3d"shareEmbedText"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"moreOptions" data-dojo-attach-event\x3d"click:_moreOptionsExpandCollapse"\x3e\r\n      \x3cdiv class\x3d"moreOptionsIcon" data-dojo-attach-point\x3d"MoreOptionsIcon"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"moreOptionsText" data-dojo-attach-point\x3d"MoreOptionsText"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"MoreOptionsContainer" class\x3d"moreOptionsContainer collapsed"\x3e\r\n      \x3cdiv class\x3d"sizeSelect" data-dojo-attach-point\x3d"SizeSelect"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"customSize disable" data-dojo-attach-point\x3d"CustomSizeContainer"\x3e\r\n      \x3cdiv class\x3d"timesConnector"\x3eX\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"shareMessage" data-dojo-attach-point\x3d"ShareMessage"\x3e\r\n    \x3cdiv class\x3d"infoIcon"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"ShareMessageText" class\x3d"shareMessageText"\x3e\x3c/div\x3e\r\n    \x3ca href\x3d""  target\x3d"_blank" data-dojo-attach-point\x3d"ChangeSettingsLink" class\x3d"changeSettingsLink"\x3e\x3c/a\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/core/declare dojo/_base/lang dojo/dom-class dojo/dom-attr dojo/string dojo/on dijit/form/TextBox dijit/form/SimpleTextarea dijit/form/Select dijit/form/NumberTextBox dijit/_WidgetBase dijit/_TemplatedMixin dijit/form/CheckBox dojo/text!./templates/ShareDialog.html ../../urlUtils dojo/i18n!../nls/widgets".split(" "),function(m,g,d,e,k,f,n,p,q,l,r,s,t,u,h,c){return m([r,s],{templateString:u,portal:void 0,webscene:void 0,view:void 0,_unsavedSceneChanges:!1,constructor:function(a,b){},destroy:function(){},
postCreate:function(){this.Text.innerHTML=c.share.text;this.LinkText.innerHTML=c.share.link;this.embedText.innerHTML=c.share.embed;this.MoreOptionsText.innerHTML=c.share.more;this.ChangeSettingsLink.innerHTML=c.share.changeShareSettings;this._ShortenLinkButton=new t({checked:!0,"class":"shortenLink"},this.ShortenLinkCheckbox);this.ShortenLinkText.innerHTML=c.share.shortenLink;this._linkUrlTextBox=new n({"class":"shareLinkUrl",onclick:"this.select();",onmouseup:"return false;",readOnly:!0});this.portal&&
!this.portal.userCanShareWithPublic()&&(d.add(this.FacebookShare,"hide"),d.add(this.TwitterShare,"hide"));this._linkUrlTextBox.placeAt(this.LinkShareContainer,3);this._embedCodeTextArea=new p({"class":"shareEmbedCode",onclick:"this.select();",onmouseup:"return false;",readOnly:!0});this._embedCodeTextArea.placeAt(this.EmbedShareContainer,2);this._sizeOptions=new q({options:[{label:c.share.smallSize,value:"small",selected:!0},{label:c.share.mediumSize,value:"medium",selected:!1},{label:c.share.largeSize,
value:"large",selected:!1},{label:c.share.customSize,value:"custom",selected:!1}],"class":"sizeOptionsSelect"});this._sizeOptions.placeAt(this.SizeSelect);this.own(f(this._sizeOptions,"change",function(a){switch(a){case "small":this._widthTextBox.set("value",300);this._heightTextBox.set("value",200);d.add(this.CustomSizeContainer,"disable");this._updateEmbedCodeFrameSize();break;case "medium":this._widthTextBox.set("value",800);this._heightTextBox.set("value",600);d.add(this.CustomSizeContainer,"disable");
this._updateEmbedCodeFrameSize();break;case "large":this._widthTextBox.set("value",1080);this._heightTextBox.set("value",720);d.add(this.CustomSizeContainer,"disable");this._updateEmbedCodeFrameSize();break;case "custom":d.remove(this.CustomSizeContainer,"disable")}}.bind(this)));this._widthTextBox=new l({"class":"sizeTextBox",value:300,constraints:{pattern:"#",places:0}});this._widthTextBox.placeAt(this.CustomSizeContainer,1);this.own(f(this._widthTextBox,"change",function(a){200>a?this._widthTextBox.set("value",
200>a?200:a):this._updateEmbedCodeFrameSize()}.bind(this)));this._heightTextBox=new l({"class":"sizeTextBox",value:200,constraints:{pattern:"#",places:0}});this._heightTextBox.placeAt(this.CustomSizeContainer,3);this.own(f(this._heightTextBox,"change",function(a){200>a?this._heightTextBox.set("value",200>a?200:a):this._updateEmbedCodeFrameSize()}.bind(this)));this.view.watch("stationary",function(){0<this.domNode.offsetHeight&&(this._ShortenLinkButton.get("checked")?this._ShortenLinkButton.set("checked",
!1):this.updateUrlViewpoint(!1))}.bind(this));this.own(f(this._ShortenLinkButton,"change",function(a){this._shortenCheckboxClicked(a)}.bind(this)));this.startup();this.updateUrlViewpoint(!1)},setWebScene:function(a){this.webscene=a;0<this.domNode.offsetHeight&&(e.set(this._linkUrlTextBox.domNode,"data-old",""),this._ShortenLinkButton.set("checked",!1));this.updateShareMessage()},_shortenCheckboxClicked:function(a){var b=e.get(this._linkUrlTextBox.domNode,"data-old"),c=this._linkUrlTextBox.get("value");
a?b?c===b?(a=e.get(this._linkUrlTextBox.domNode,"data-old-shortened"),b=e.get(this._embedCodeTextArea.domNode,"data-old-shortened"),this._linkUrlTextBox.set("value",a),this._setEmbedCode(b)):this.updateUrlViewpoint(!0):this.updateUrlViewpoint(!0):(e.set(this._linkUrlTextBox.domNode,"data-old-shortened",c),b?(this._linkUrlTextBox.set("value",b),this._setEmbedCode(b+"\x26ui\x3dmin")):this.updateUrlViewpoint(!1))},updateUrlViewpoint:function(a){var b=!1,b=!this.portal||this.portal._baseUrl.startsWith("../")?
!1:g.exists("webscene.portalItemProperties.id",this)?g.exists("webscene.portalItemProperties.access",this)?"public"===this.webscene.portalItemProperties.access:!1:!0,b=this.portal?this.portal.getSceneViewerUrl(b):"";if(g.exists("webscene.portalItemProperties.id",this)&&!b.startsWith("../"))b+="?webscene\x3d"+this.webscene.portalItemProperties.id;else{var b=window.location.href,c=b.indexOf("viewpoint\x3d")-1;if(-1<c)var d=b.indexOf("\x26",c+1),f="",f=-1<d?b.substr(c+1,d-c):b.substr(c,b.length-c),b=
b.replace(f,"")}this.view&&this.view.get("camera")&&(b=h.viewpointToUrlParameter(b,this.view.get("camera"),"planar"===this.view.globeMode));c=function(a){this._linkUrlTextBox.set("value",a)}.bind(this);d=function(a,b){this._linkUrlTextBox.set("value",a);e.set(this._linkUrlTextBox.domNode,"data-old",b)}.bind(this);a?e.get(this._linkUrlTextBox.domNode,"data-old")!==b&&h.shortenUrl(b,d,c):c(b);c=function(a){this._setEmbedCode(a);e.set(this._embedCodeTextArea.domNode,"data-old-shortened",a)}.bind(this);
d=function(a){this._setEmbedCode(a)}.bind(this);a?e.get(this._linkUrlTextBox.domNode,"data-old")!==b&&h.shortenUrl(b+"\x26ui\x3dmin",c,d):d(b+"\x26ui\x3dmin")},_setEmbedCode:function(a){var b='\x3ciframe width\x3d"'+this._widthTextBox.value+'" height\x3d"'+this._heightTextBox.value+'" frameborder\x3d"0" scrolling\x3d"no" allowfullscreen src\x3d"',b=b+a+'"\x3e\x3c/iframe\x3e';this._embedCodeTextArea.set("value",b)},_updateEmbedCodeFrameSize:function(a){a=this._embedCodeTextArea.get("value");a=a.replace(/width=\"[0-9]*\"/i,
'width\x3d"'+this._widthTextBox.value+'"');a=a.replace(/height=\"[0-9]*\"/i,'height\x3d"'+this._heightTextBox.value+'"');this._embedCodeTextArea.set("value",a)},_moreOptionsExpandCollapse:function(){d.toggle(this.MoreOptionsContainer,"collapsed");d.toggle(this.MoreOptionsIcon,"rotate")},_toFacebook:function(){var a;a="http://www.facebook.com/sharer/sharer.php?s\x3d100\x26p[url]\x3d"+this._linkUrlTextBox.value;window.open(a,"_blank")},_toTwitter:function(){var a=k.substitute(c.share.shareTwitterTxt,
{sceneName:this.webscene?this.webscene.portalItemProperties.title:""}),b=this._linkUrlTextBox.value,d=140-(b.length+1);a.length+14>d&&(a=a.substr(0,d-3)+"...");window.open("http://twitter.com/home?status\x3d"+encodeURIComponent(a+""+b+"\n@ArcGISOnline"),"_blank")},_toEmail:function(){var a="mailto:?subject\x3d"+k.substitute(c.share.shareEmailSubject,{sceneName:encodeURIComponent(this.webscene?this.webscene.portalItemProperties.title:"")}),b=this._linkUrlTextBox.value,a=a+("\x26body\x3d"+encodeURIComponent(c.share.shareEmailTxt1)+
"%0D%0A"+encodeURIComponent(b)),a=a+("%0D%0A%0D%0A"+encodeURIComponent(c.share.shareEmailTxt2));this.portal&&this.portal.isSignedIn()&&this.portal.userHasEditingPrivileges()?this.emit("share-email",{mailUrl:a}):window.location.href=a},updateShareMessage:function(){if(this.portal){var a="",a="undefined"!==typeof esriGeowConfig?esriGeowConfig.baseUrl+"item.html?id\x3d"+this.webscene.portalItemProperties.id:this.portal.url+"/home/item.html?id\x3d"+this.webscene.portalItemProperties.id;this.ChangeSettingsLink.href=
a}if(this._unsavedSceneChanges)d.add(this.ShareMessage,"show"),this.ShareMessageText.innerHTML=c.share.shareUnsaved,d.remove(this.ChangeSettingsLink,"show");else if(this.portal&&this.portal.userCanShareWithPublic())if(g.exists("webscene.portalItemProperties.access",this)&&"public"!==this.webscene.portalItemProperties.access)this.ShareMessageText.innerHTML=c.share.shareNotPublic,d.add(this.ShareMessage,"show"),d.add(this.ChangeSettingsLink,"show");else{for(a=0;a<this.view.map.layers.get("length");a++){var b=
this.view.map.layers.getItemAt(a);if(g.exists("_websceneEditorProperties.portalLayerItem.item",b)&&"public"!==b._websceneEditorProperties.portalLayerItem.item.access){this.ShareMessageText.innerHTML=c.share.shareNotPublicLayer;d.add(this.ShareMessage,"show");d.remove(this.ChangeSettingsLink,"show");return}}this.ShareMessageText.innerHTML="";d.remove(this.ShareMessage,"show")}else this.ShareMessageText.innerHTML="",d.remove(this.ShareMessage,"show")},setUnsavedSceneChanges:function(a){this._unsavedSceneChanges=
a;0<this.domNode.offsetHeight&&this.updateShareMessage()}})});