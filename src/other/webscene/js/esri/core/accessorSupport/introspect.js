// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define(["dojo/_base/lang","./Property","./PropertyNotifier","./merge"],function(w,m,x,r){var n=function(b){return Object.create(void 0===b?null:b)},y=/^_([a-zA-Z0-9]+)(Getter|Setter|Reader)$/,l=function(b){return b._meta?b:b.constructor},p=Object.prototype.hasOwnProperty,A=function(b){if(!(b&&null!=l(b)._meta))return null;var a=k(b),e=a.mixin;if(e)return e;var g=b.prototype,f=p.call(g,"classMetadata")?g.classMetadata:n(),e=a.mixin={declaredClass:g.declaredClass,properties:f.properties?r(n(),f.properties):
n(),reader:f.reader?r(n(),f.reader):n(),notifiers:[]},c=e.properties,d=function(a){a=a.split(".")[0];c[a]||(c[a]={});return c[a]};Object.getOwnPropertyNames(g).forEach(function(a){var c=g[a],b=y.exec(a);b&&(a=b[1],b=b[2],a=d(a),a[b.toLowerCase()]=c)});(a=f.computed)&&Object.getOwnPropertyNames(a).forEach(function(b){var c=d(b);r(c,{dependsOn:Array.isArray(a[b])?a[b]:[a[b]]});c.dependsOn.forEach(d)});z(b);Object.getOwnPropertyNames(c).forEach(function(a){t(g,a)&&(c[a].value=g[a])});e.properties=Object.getOwnPropertyNames(c).reduce(function(a,
b){a[b]=new m(b,c[b]);return a},{});return e},z=function(b){var a=k(b).mixin,e=a.properties,g=n(),f,c,d,h,l;if(e){for(c in e)if(f=e[c].dependsOn)for(h=0;d=f[h];h++)g[d]?-1===g[d].indexOf(c)&&g[d].push(c):g[d]=[c];h=[];for(c in g){f=[];l=n();for(h.push(c);h.length;)d=h.shift(),l[d]||(l[d]=!0,f.push(d),(d=g[d])&&Array.prototype.push.apply(h,d));f.shift();-1<c.indexOf(".")&&(a.notifiers||(a.notifiers=[]),a.notifiers.push(new x(c,f)),c=c.split(".")[0]);e[c]?e[c].chain=f:(d=q(b,c))?k(d).mixin.properties[c]||
(k(d).mixin.properties[c]=new m(c,{value:s(b,c),chain:f})):a.properties[c]=new m(c,{chain:f})}}},k=function(b){if(!(b&&null!=l(b)._meta))return null;var a=l(b),e=a._esriMeta;if(e)return e;var e=a._esriMeta={},g=l(b)._meta.bases;b=e.mixins=[];for(var f,c=g.length-1;0<=c;c--)(f=A(g[c]))&&b.unshift(f);var g=e.classMetadata={declaredClass:a.prototype.declaredClass,notifiers:[],properties:{},reader:{}},d=g.properties,h,c;for(c=b.length-1;0<=c;c--){f=b[c];for(h in f.properties)u(a,h),d[h]?d[h].mixIn(f.properties[h]):
(d[h]=new m(h,f.properties[h]),!d[h].hasOwnProperty("value")&&q(a,h)&&(d[h].value=s(a,h)),Object.defineProperty(a.prototype,h,d[h].getDescriptor()));g.notifiers=g.notifiers.concat(e.mixins[c].notifiers);g.reader=r(g.reader,e.mixins[c].reader)}return e},v=function(b,a){if(b){var e=Object.getOwnPropertyDescriptor(b.prototype,a);return e?e.value:b.prototype[a]}},s=function(b,a){if(p.call(b,a))return b[a];var e=q(b,a);return v(e,a)},t=function(b,a){var e;return p.call(b,a)&&(!(e=Object.getOwnPropertyDescriptor(b,
a))||p.call(e,"value"))},q=function(b,a){for(var e=l(b)._meta.bases,g,f,c=0,d=e.length;c<d;c++)if(g=e[c],f=(f=k(g))&&f.mixin.properties[a],t(g.prototype,a)||f&&p.call(f,"value"))return g;return null},u=function(b,a){var e=l(b),g=k(e).classMetadata.properties,f=q(e,a)||e,c=f?k(f).mixin.properties:{},d=c[a];f&&!d&&(d=c[a]=new m(a,{value:v(f,a)}),k(f).mixin.properties[a]=new m(a,d),c=k(f).classMetadata.properties,c[a]?c[a].value=d.value:(c[a]=d,Object.defineProperty(f.prototype,a,d.getDescriptor())));
e!==f&&(g[a]?g[a].value=d.value:(g[a]=new m(a,d),Object.defineProperty(e.prototype,a,d.getDescriptor())));return d};return w.mixin(function(b){return k(b)},{getProperties:function(b){return k(b).classMetadata.properties},isIntrospected:function(b){return null!=l(b)._esriMeta},getPropertyOwnerValue:s,getPropertyOwner:q,installPropertyNotifiers:function(b){var a=k(b).classMetadata.notifiers;return a?a.map(function(a){return a.install(this)},b):[]},defineProperty:u})});