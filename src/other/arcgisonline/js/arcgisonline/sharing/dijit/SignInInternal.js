// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/SignInInternal",["dijit","dojo","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/form/Form,dijit/form/Button,dijit/form/ValidationTextBox,arcgisonline/sharing/util,arcgisonline/sharing/geow/Account,arcgisonline/sharing/geow/Geow"],function(e,a,k){a.provide("arcgisonline.sharing.dijit.SignInInternal");a.require("dijit._Widget");a.require("dijit._Templated");a.require("dijit.form.Form");a.require("dijit.form.Button");a.require("dijit.form.ValidationTextBox");
a.require("arcgisonline.sharing.util");a.require("arcgisonline.sharing.geow.Account");a.require("arcgisonline.sharing.geow.Geow");a.declare("arcgisonline.sharing.dijit.SignInInternal",[e._Widget,e._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv id\x3d"login-form" class\x3d"grid_16 esriFloatLeading" style\x3d"display:block;clear:both;"\x3e\r\n    \x3cdiv dojotype\x3d"dijit.form.Form" id\x3d"sign-in-form" method\x3d"POST" action\x3d""\x3e\r\n      \x3cdiv id\x3d"organizationTitle" style\x3d"display:none; margin:10px 0 40px 0; text-align:center;"\x3e\x3c/div\x3e\r\n      \x3cdiv id\x3d"left" class\x3d"grid_7 esriFloatLeading"\x3e\r\n        \x3ch1 id\x3d"leftPanelTitle"\x3e${i18n.firstTimeSignIn}\x3c/h1\x3e\r\n        \x3cbr/\x3e\r\n        \x3cdiv id\x3d"not_a_member_msg"\x3e\r\n        \x3c/div\x3e\r\n        \x3cbr/\x3e\r\n        \x3cbr/\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"right" class\x3d"grid_7 esriFloatTrailing"\x3e\r\n        \x3ch1 id\x3d"rightPanelTitle"\x3e${i18n.signIn}\x3c/h1\x3e\r\n        \x3cbr/\x3e\r\n        \x3cdiv id\x3d"sign-in-error"\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"rightPanelDesc" style\x3d"font-weight:bold;"\x3e\x3c/div\x3e\x3cbr/\x3e\r\n        \x3ciframe dojoattachpoint\x3d"_iFrame" id\x3d"oAuthFrame" scrolling\x3d"no" style\x3d"display:none; border:0" marginheight\x3d"0" marginwidth\x3d"0" frameborder\x3d"0" width\x3d"400" height\x3d"400"\x3e\r\n           Your browser does not support iframes.\r\n        \x3c/iframe\x3e\r\n        \x3ctable id\x3d"authTable" style\x3d"width:100%;display:none"\x3e\r\n          \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd class\x3d"grid_2 alpha"\x3e\r\n                \x3clabel for\x3d"user_username" style\x3d"padding:0;margin:0;"\x3e\r\n                  ${i18n.userLabel}\r\n                \x3c/label\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cdiv id\x3d"user_username" name\x3d"user_username" class\x3d"grid_5 omega" style\x3d"padding:2px;margin:0;" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" dojoAttachEvent\x3d"keyDown: onKeyDown"\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr height\x3d"5"\x3e\r\n              \x3ctd colspan\x3d"2" height\x3d"5"\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd class\x3d"grid_2 alpha"\x3e\r\n                \x3clabel for\x3d"user_password" style\x3d"padding:0;margin:0;"\x3e\r\n                  ${i18n.passwordLabel}\r\n                \x3c/label\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cdiv id\x3d"user_password" name\x3d"user_password" class\x3d"grid_5 omega" style\x3d"padding:2px;margin:0;" type\x3d"password" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" dojoAttachEvent\x3d"keyDown: onKeyDown"\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cdiv id\x3d"signInHelp"\x3e\r\n                  \x3ca id\x3d"signInHelpLink"\x3e${i18n.needHelpSign}\x3c/a\x3e\r\n                  \x3cbr/\x3e\r\n                  \x3cbr/\x3e\r\n                \x3c/div\x3e\r\n                \x3cinput id\x3d"remember-me" style\x3d"height:24px;margin:auto;" value\x3d"off" dojotype\x3d"dijit.form.CheckBox" /\x3e\r\n                \x3clabel id\x3d"remember-me-label" for\x3d"remember-me"\x3e${i18n.rememberMe}\x3c/label\x3e\r\n                \x3cbr/\x3e\r\n                \x3cbr/\x3e\r\n                \x3cbutton id\x3d"button_sign_in" class\x3d"calcite small btn primary" style\x3d"margin:0;padding:0;" type\x3d"submit" dojotype\x3d"dijit.form.Button"\x3e\r\n                  ${i18n.signIn}\r\n                \x3c/button\x3e\r\n                \x3cbr/\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv style\x3d"width:100%; clear:both;"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
util:arcgisonline.sharing.util,geow:arcgisonline.sharing.geow.Geow,account:arcgisonline.sharing.geow.Account,redirectUrl:esriGeowConfig.baseUrl.replace("https:","http:")+"index.html",orgRedirectUrl:esriGeowConfig.baseUrl.replace("https:","http:")+"organization.html",defaultOrgTitleText:null,invitationId:null,orgName:null,usr:null,pwd:null,exp:null,i18n:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=a.i18n.getLocalization("arcgisonline","arcgisonline").common;a.mixin(this.i18n,
a.i18n.getLocalization("arcgisonline","arcgisonline").signInInternalWidget);this.i18n.error.signInSoftAuth=a.i18n.getLocalization("arcgisonline","arcgisonline").errorWidget.signInSoftAuth;this.defaultOrgTitleText=this.i18n.myAccount;this._oAuthInfo={url:esriGeowConfig.restBaseUrl+"oauth2/authorize",clientId:"arcgisonline",redirectUri:esriGeowConfig.baseUrl+"postsignin.html",parent:window.location.protocol+"//"+window.location.host,expiration:20160,locale:a.locale}},postCreate:function(){!1===esriGeowConfig.showSignUp&&
(a.style(a.byId("left"),"display","none"),a.style(a.byId("right"),"float","left"));this.account.getSelf(a.hitch(this,function(b){b&&b.isPortal&&(!esriGeowConfig.self||!esriGeowConfig.self.supportsOAuth?(esri.show(a.byId("authTable")),esri.hide(a.byId("oAuthFrame"))):(window.onOAuthSignIn=a.hitch(this,"onOAuthSignIn"),window.checkOAuthResponse=a.hitch(this,"checkOAuthResponse"),window.onOAuthSignInError=a.hitch(this,"onOAuthSignInError"),this._authorizeUrl=esri.substitute(this._oAuthInfo,"${url}?client_id\x3d${clientId}\x26redirect_uri\x3d${redirectUri}\x26response_type\x3dtoken\x26display\x3diframe\x26parent\x3d${parent}\x26expiration\x3d${expiration}\x26locale\x3d${locale}"),
a.attr(this._iFrame,"src",this._authorizeUrl),esri.hide(a.byId("authTable")),esri.show(a.byId("oAuthFrame"))),b=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))+"/portaladmin",a.xhrGet({url:b,handleAs:"json",content:{f:"json",ts:(new Date).getTime()}}).then(a.hitch(this,function(a){var b=arcgisonline.sharing.util.getUser();if(a.status&&"error"===a.status&&a.code&&503===a.code)arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorTitle,
message:this.i18n.error.siteUnavailable});else if(a&&(!a.error&&!b||a.error&&a.error.code&&(!b&&499!==a.error.code||b&&498!==a.error.code)))window.location=esriGeowConfig.baseUrl+"createadmin.html"})))}))},startup:function(){this.inherited(arguments);if(a.byId("not_a_member_msg")){var b="\x3cbutton id\x3d'registerButton' class\x3d'calcite blue' type\x3d'button' dojotype\x3d'dijit.form.Button'\x3e"+this.i18n.createAccount+"\x3c/button\x3e";a.byId("not_a_member_msg").innerHTML=b;a.parser.parse(a.byId("not_a_member_msg"));
a.connect(a.byId("registerButton"),"onclick",function(){var b=esriGeowConfig.signup,c=a.queryToObject(window.location.search.slice(1)).invitation;if(c)b+="?invitation\x3d"+c;else if(c=a.queryToObject(window.location.search.slice(1)).returnUrl,null!=c){var h=arcgisonline.sharing.util.parseUrl(window.location.href);if(-1<c.indexOf(h.host)||-1<c.indexOf("arcgis.com")||-1<c.indexOf("esri.com"))b+="?returnUrl\x3d"+c}document.location=b});esriGeowConfig.signInHelp?a.byId("signInHelpLink").href=esriGeowConfig.signInHelp:
a.byId("signInHelpLink").href="troubleshoot.html"}this.loadConnections();b=a.queryToObject(window.location.search.slice(1)).error;null!=b&&this.showError(this.getErrorMsg(b));b=a.queryToObject(window.location.search.slice(1)).returnUrl;if(null!=b){var f=arcgisonline.sharing.util.parseUrl(window.location.href);if(-1<b.indexOf(f.host)||-1<b.indexOf("arcgis.com")||-1<b.indexOf("esri.com"))this.redirectUrl=b}esriGeowConfig.esriGlobalAccount?(b=a.string.substitute(this.i18n.signInAccountDesc,{account:esriGeowConfig.esriGlobalAccount}),
a.attr(a.byId("rightPanelDesc"),"innerHTML",b)):a.style(a.byId("rightPanelDesc"),"display","none");(b=a.queryToObject(window.location.search.slice(1)).invitation)?(this.invitationId=b,this.util.getJson(esriGeowConfig.restBaseUrl+"community/invitations/"+this.invitationId,a.hitch(this,function(b){b.account&&b.account.name&&(this.orgName=b.account.name,esriGeowConfig.useDefaultIdentityStore?(a.byId("organizationTitle").innerHTML="\x3ch1\x3e"+a.string.substitute(this.i18n.joinOptions,{account:this.orgName})+
"\x3c/h1\x3e",a.style(a.byId("organizationTitle"),"display","block"),a.addClass(a.byId("left"),"invitation"),a.byId("leftPanelTitle").innerHTML=a.string.substitute(this.i18n.joinFirstTime,{account:this.orgName}),a.addClass(a.byId("leftPanelTitle"),"subtitle"),a.style(a.byId("left"),"width","47%"),a.addClass(a.byId("right"),"invitation"),a.byId("rightPanelTitle").innerHTML=a.string.substitute(this.i18n.joinAlreadyUsing,{account:this.orgName}),a.addClass(a.byId("rightPanelTitle"),"subtitle")):(a.style(a.byId("left"),
"display","none"),a.removeClass(a.byId("right"),"esriFloatTrailing"),esriGeowConfig.isRightToLeft?a.style(a.byId("right"),"padding-right","30%"):a.style(a.byId("right"),"padding-left","30%"),a.removeClass(a.byId("login-form"),"esriFloatLeading")))}))):esriGeowConfig.useDefaultIdentityStore?a.style(a.byId("left"),"width","300px"):(a.style(a.byId("left"),"display","none"),a.removeClass(a.byId("right"),"esriFloatTrailing"),esriGeowConfig.isRightToLeft?a.style(a.byId("right"),"padding-right","30%"):a.style(a.byId("right"),
"padding-left","30%"),a.removeClass(a.byId("login-form"),"esriFloatLeading"));this.account.getSelf(a.hitch(this,function(b){esriGeowConfig.self.disableSignup&&(a.style(a.byId("left"),"display","none"),a.removeClass(a.byId("right"),"esriFloatTrailing"),esriGeowConfig.isRightToLeft?a.style(a.byId("right"),"padding-right","30%"):a.style(a.byId("right"),"padding-left","30%"),a.removeClass(a.byId("login-form"),"esriFloatLeading"))}));this.checkCookieSupport();try{setTimeout("dojo.byId('user_username').focus()",
350)}catch(c){}},checkCookieSupport:function(){if(10>=a.isIE){a.cookie("test","enabled",{path:"/"});var b=a.cookie("test");a.cookie("test",null,{expires:-1});"enabled"!==b&&arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorTitle,message:this.i18n.error.cookiesRequired})}else a.cookie.isSupported()||arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorTitle,message:this.i18n.error.cookiesRequired})},
loadConnections:function(){a.connect(e.byId("sign-in-form"),"onSubmit",this,"signIn")},signIn:function(b){b.preventDefault();-1!=a.byId("sign-in-error").className.indexOf("error")&&(a.byId("sign-in-error").innerHTML="\x26nbsp;",a.removeClass("sign-in-error","error"));if(!1==this.validateForm())return!1;e.byId("button_sign_in").set("disabled",!0);e.byId("button_sign_in").set("label",this.i18n.signingIn);b=a.byId("user_username").value;var f=a.byId("user_password").value,c=esriGeowConfig.tokenExpiration;
a.byId("remember-me").checked&&(c=esriGeowConfig.longTokenExpiration);this.invitationId&&(this.usr=b,this.pwd=f,this.exp=c);this.geow.signin({username:b,password:f,expiration:c},a.hitch(this,this.onSignIn),a.hitch(this,"signInError"))},onOAuthSignIn:function(){-1!==a.byId("sign-in-error").className.indexOf("error")&&(a.byId("sign-in-error").innerHTML="\x26nbsp;",a.removeClass("sign-in-error","error"))},checkOAuthResponse:function(b){b=new a._Url(b);b=b.fragment?a.queryToObject(b.fragment):null;b.error?
(a.addClass("sign-in-error","error"),a.attr(a.byId("sign-in-error"),"innerHTML",(b.error_description||b.error)+"\x3cbr/\x3e\x3cbr/\x3e"),a.attr(this._iFrame,"src",this._authorizeUrl)):(this._user=a.mixin(this._user,a.mixin(b,{token:b.access_token})),this.geow.signInHandler2(this._user).then(a.hitch(this,"onSignIn")))},onOAuthSignInError:function(b){b&&b.length&&-1!==b[0].toLowerCase().indexOf("not a member")?(a.addClass("sign-in-error","error"),a.attr(a.byId("sign-in-error"),"innerHTML",this.i18n.error.notOrgMember+
"\x3cbr/\x3e\x3cbr/\x3e")):b&&b.length&&-1<b[0].toLowerCase().indexOf("software authorization error")?(a.addClass("sign-in-error","error"),a.attr(a.byId("sign-in-error"),"innerHTML",this.i18n.error.signInSoftAuth+"\x3cbr/\x3e\x3cbr/\x3e")):b&&b.length&&(-1<b[0].toLowerCase().indexOf("too many invalid logins")||-1!==b[0].toLowerCase().indexOf("too many invalid attempts"))?(a.addClass("sign-in-error","error"),a.attr(a.byId("sign-in-error"),"innerHTML",this.i18n.error.tooManyAttempts+"\x3cbr/\x3e\x3cbr/\x3e")):
this.signInError({code:400})},onKeyDown:function(b){b.keyCode===a.keys.ENTER&&this.signIn(b)},onSignIn:function(b,f){this.invitationId?arcgisonline.sharing.geow.Account.getInvitation(this.invitationId,a.hitch(this,this.onInvitationInfo),a.hitch(this,this.onInvitationInfo)):this.routeUser()},onInvitationInfo:function(b,f){var c;if(b&&b.code&&b.message&&403===b.code){var d="\x3cp\x3e"+this.i18n.emailInvitation+"\x3c/p\x3e";c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();
c.onOkClick=a.hitch(this,function(a,b){a.hide();this.routeUser()},c);c.show({title:this.i18n.noticeLabel,message:d})}else if(b&&b.code&&b.message&&400===b.code)d="\x3cp\x3e"+this.i18n.invitationUsedMsg+"\x3c/p\x3e",c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),c.onOkClick=a.hitch(this,function(a,b){a.hide();window.location=arcgisonline.sharing.util.getSecureUrl()+esriGeowConfig.signin},c),c.show({title:this.i18n.noticeLabel,message:d});else if(b&&b.id&&b.id===this.invitationId){var g=
"\x3cp\x3e"+a.string.substitute(this.i18n.membershipPending,{account:"\x3cstrong\x3e"+b.account.name+"\x3c/strong\x3e"})+"\x3c/p\x3e";c="\x3cp\x3e\x3cstrong\x3e"+a.string.substitute(this.i18n.byAcceptingInvite,{account:b.account.name})+"\x3c/strong\x3e\x3c/p\x3e\x3cp\x3e\x3cul\x3e\x3cli\x3e"+a.string.substitute(this.i18n.itemsMsg,{beginStrong:"\x3cstrong\x3e",endStrong:"\x3c/strong\x3e"})+"\x3c/li\x3e\x3cli\x3e"+this.i18n.leaveMsg+"\x3c/li\x3e\x3c/ul\x3e\x3c/p\x3e";d={title:this.i18n.noticeLabel,
message:c,choiceOneTitle:this.i18n.yesLabel,choiceTwoTitle:this.i18n.noLabel};d.choiceOneHandler=a.hitch(this,function(c){b.mustApprove&&!0===b.mustApprove?(c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),c.onOkClick=a.hitch(this,function(b){b.hide();arcgisonline.sharing.geow.Account.acceptInvitation(this.invitationId,a.hitch(this,this.onInvitationAccepted),a.hitch(this,this.onInvitationAccepted))},c),c.show({title:this.i18n.noticeLabel,message:g})):arcgisonline.sharing.geow.Account.acceptInvitation(this.invitationId,
a.hitch(this,this.onInvitationAccepted),a.hitch(this,this.onInvitationAccepted))});d.choiceTwoHandler=a.hitch(this,function(a){this.routeUser()});c=arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance();c.show(d)}else this.routeUser()},onInvitationAccepted:function(b,f){var c;if(b&&b.success&&!0===b.success)this.geow.signin({username:this.usr,password:this.pwd,expiration:this.exp},a.hitch(this,this.routeUser),a.hitch(this,"signInError"));else if(b&&b.code&&b.message&&500===b.code&&
"Invitation has already been accepted."===a.trim(b.message)){var d="\x3cp\x3e"+this.i18n.acceptedInvite+"\x3c/p\x3e\x3cp\x3e"+this.i18n.clickOk+"\x3c/p\x3e";c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();c.onOkClick=a.hitch(this,function(a,b){a.hide();window.location=arcgisonline.sharing.util.getSecureUrl()+esriGeowConfig.signin},c);c.show({title:this.i18n.noticeLabel,message:d})}else console.log(b),c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),
c.onOkClick=a.hitch(this,function(a,b){a.hide();window.location=arcgisonline.sharing.util.getSecureUrl()+esriGeowConfig.signin+"?invitation\x3d"+this.invitationId},c),b.code&&b.message?("User already member of an account."===b.message&&(b.message=this.i18n.userAnotherOrg),c.show({title:this.i18n.unableJoin,message:b.message})):c.show({title:this.i18n.unableJoin,message:this.i18n.problemJoining})},routeUser:function(){this.exp=this.pwd=this.usr=null;esriGeowConfig.self=null;arcgisonline.sharing.geow.Account.getSelf(a.hitch(this,
this.routeOrg))},routeOrg:function(b,f){var c=this.util.getUser(),d=a.queryToObject(window.location.search.slice(1)).returnUrl,g=esriGeowConfig.baseUrl+esriGeowConfig.signin;d&&-1<d.indexOf(g)&&(d=null);d&&(g=arcgisonline.sharing.util.parseUrl(window.location.href),-1===d.indexOf(g.host)&&(-1===d.indexOf("arcgis.com")&&-1===d.indexOf("esri.com"))&&(d=null));if(b&&!b.code&&!b.message){var g=b.allSSL,e=arcgisonline.sharing.util.usePortalSSL();this.redirectUrl=arcgisonline.sharing.util.getHttpUrl()+
"index.html";this.orgRedirectUrl=arcgisonline.sharing.util.getHttpUrl()+"organization.html";d?(e=!!(-1<d.indexOf("https:")),window.location=g||e?arcgisonline.sharing.util.getSecureUrl(d):d):window.location="account_admin"===c.role?g||e?arcgisonline.sharing.util.getSecureUrl()+"organization.html":this.orgRedirectUrl:g||e?arcgisonline.sharing.util.getSecureUrl()+"index.html":this.redirectUrl}else window.location=d?d:arcgisonline.sharing.util.getHttpUrl(this.redirectUrl)},getErrorMsg:function(b){if("498"==
b)return this.i18n.error.sessionExpired;if("403"==b||"400"==b)return(b=a.queryToObject(window.location.search.slice(1)).returnUrl)&&-1<b.indexOf("viewer.html")?"":this.i18n.error.requireSignIn},validateForm:function(){var a=e.byId("user_username").getValue(),f=e.byId("user_password").getValue(),c=null;if((null==a||""==a)&&(null==f||""==f))c=this.i18n.error.userNamePassRqd;else if(null==a||""==a)c=this.i18n.error.usernameRqd;else if(null==f||""==f)c=this.i18n.error.passReqd;if(null==c)return!0;this.showError(c);
return!1},signInError:function(b,f){e.byId("button_sign_in").set("disabled",!1);e.byId("button_sign_in").set("label",this.i18n.SignIn);if(null!=b&&""!=b)switch(a.addClass("sign-in-error","error"),b.code=500===b.code?400:b.code,b.code){case 400:var c="\x3cb style\x3d'font-size:1.2em;line-height:30px;'\x3e"+a.string.substitute(this.i18n.unableSignIn,{portalName:esriGeowConfig.portalName?esriGeowConfig.portalName:this.i18n.arcgisOnline})+"\x3c/b\x3e\x3cbr/\x3e",c=c+'\x3cspan style\x3d"color:#000000;"\x3e'+
this.i18n.usernamePassCorrect,c=c+"\x3c/span\x3e";if(!(!1===esriGeowConfig.isMultiTenant&&!1===esriGeowConfig.showSignUp)){var c=c+'\x3cdiv style\x3d"color:#000000; padding-top:15px;"\x3e',d=esriGeowConfig.signup;document.referrer&&-1<document.referrer.indexOf("https://")&&(d+="?returnUrl\x3d"+arcgisonline.sharing.util.getSecureUrl()+"user.html?newUser\x3dtrue");this.invitation&&(d+=(-1<d.indexOf("?")?"\x26":"?")+"invitation\x3d"+this.invitation);c+=this.i18n.ifFirstTime+"\x3cbr/\x3e\x3ca href\x3d'"+
d+"'\"\x3e"+this.i18n.createAccount+"\x3c/a\x3e.";c+="\x3c/div\x3e"}this.showError(c);try{a.byId("user_username").focus()}catch(g){}break;default:this.showError(this.i18n.error.signInError)}},showError:function(b){a.addClass("sign-in-error","error");a.byId("sign-in-error").innerHTML=b+"\x3cbr/\x3e\x3cbr/\x3e"}})});