// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/dialog/RateLimiting","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/dom-class dojo/dom-style dojo/dom-attr dojo/string dojo/on dojo/aspect dojo/dom dojo/dom-construct dojo/query dojo/parser dojo/ready dijit/registry dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/ValidationTextBox dojox/validate/regexp esri/Evented dojo/i18n!arcgisonline/nls/arcgisonline".split(" "),function(h,c,f,p,k,t,u,q,d,v,w,l,g,
x,y,m,n,r,s,z,A,B,e){return h("arcgisonline.sharing.dijit.dialog.RateLimiting",[n],{templateString:'\x3cdiv\x3e\x3cdiv  id\x3d"rateLimiting" class\x3d"rateLimiting"\x3e\x3cp\x3e${i18n.rateLimiting.instructions}\x3c/p\x3e\x3cinput data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-attach-point\x3d"_enableLimits" type\x3d"checkbox" value\x3d"true" name\x3d"enableRateLimiting"/\x3e\x3clabel class\x3d"esriLeadingMargin05 esriTrailingMargin1" for\x3d"referrerUri"\x3e${i18n.rateLimiting.hitRate}\x3c/label\x3e\x3cdiv class\x3d"rateLimitingDiv esriLeadingMargin108"\x3e\x3cinput class\x3d"hitRate" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-point\x3d"_hitRate" value\x3d"1000" data-dojo-props\x3d"disabled:true, rangeMessage:\'${i18n.rateLimiting.hitRateRangeMessage}\', invalidMessage:\'${i18n.rateLimiting.hitRateInvalidMessage}\',constraints:{min:1, max:1000000, places:0}"/\x3e\x3clabel class\x3d"canDisable esriLeadingMargin1 esriTrailingMargin1" for\x3d"referrerUri"\x3e${i18n.rateLimiting.per}\x3c/label\x3e\x3cinput class\x3d"hitRate" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-point\x3d"_hitCount" value\x3d"1" data-dojo-props\x3d"disabled:true, rangeMessage:\'${i18n.rateLimiting.hitRateRangeMessage}\', invalidMessage:\'${i18n.rateLimiting.hitRateInvalidMessage}\',constraints:{min:1, max:1000000, places:0}"/\x3e\x3cselect class\x3d"esriUnits" data-dojo-attach-point\x3d"_interval" data-dojo-type\x3d"dijit/form/Select" data-dojo-props\x3d"disabled:true" style\x3d"width:8.75em;"\x3e\x3coption value\x3d"1"\x3e${i18n.rateLimiting.second}\x3c/option\x3e\x3coption value\x3d"60"\x3e${i18n.rateLimiting.minute}\x3c/option\x3e\x3coption value\x3d"3600"\x3e${i18n.rateLimiting.hour}\x3c/option\x3e\x3coption value\x3d"86400"\x3e${i18n.rateLimiting.day}\x3c/option\x3e\x3coption value\x3d"604800"\x3e${i18n.rateLimiting.week}\x3c/option\x3e\x3coption value\x3d"2628000"\x3e${i18n.rateLimiting.month}\x3c/option\x3e\x3c/select\x3e\x3c/div\x3e\x3cbr /\x3e\x3clabel class\x3d"esriTrailingMargin05" for\x3d"referrerUri"\x3e${i18n.rateLimiting.referrerUri}\x3c/label\x3e\x3cinput data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-point\x3d"_referrerUrl" data-dojo-props\x3d"placeHolder:\'${i18n.registerApp.urlPlaceHolder}\'" type\x3d"text"/\x3e\x3cbutton class\x3d"calcite small" data-dojo-type\x3d"dijit/form/Button" data-dojo-attach-point\x3d"_addBtn" data-dojo-props\x3d"label:\'${i18n.registerApp.add}\'"\x3e\x3c/button\x3e\x3cbutton class\x3d"calcite small" data-dojo-type\x3d"dijit/form/Button" data-dojo-attach-point\x3d"_delBtn" data-dojo-props\x3d"disabled:true, label:\'${i18n.registerApp.del}\'"\x3e\x3c/button\x3e\x3cdiv class\x3d"esriLeadingMargin93" data-dojo-type\x3d"dijit/form/MultiSelect" data-dojo-attach-point\x3d"_referrers" data-dojo-props\x3d"size:4, name:\'referral_uris\'"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
baseClass:"esriRateLimiting",buildRendering:function(){this.inherited(arguments);var a=p.doc.createDocumentFragment();this._templateDijit=new (h([n,r,s],{templateString:q.substitute(this.templateString,{i18n:e},null,this)}));this._content=l.place(this._templateDijit.domNode,a,"first");this.inherited(arguments);this.domNode.appendChild(this._content)},postMixInProperties:function(){this.inherited(arguments);this._util=arcgisonline.sharing.util;this.i18n=c.mixin(c.mixin({},e.common),e.itemProperties);
this.serviceProxyParams=this.serviceProxyParams&&(this.serviceProxyParams.hitsPerInterval||this.serviceProxyParams.referrers)?this.serviceProxyParams:null},postCreate:function(){this.inherited(arguments);this._enableLimits=this._templateDijit._enableLimits;this._hitRate=this._templateDijit._hitRate;this._hitCount=this._templateDijit._hitCount;this._interval=this._templateDijit._interval;this._referrerUrl=this._templateDijit._referrerUrl;this._referrers=this._templateDijit._referrers;this._addBtn=
this._templateDijit._addBtn;this._delBtn=this._templateDijit._delBtn;this._loadConnections();this.set("value",this.serviceProxyParams)},destroy:function(){this._templateDijit.destroyRecursive();this._templateDijit=null;this.inherited(arguments)},_loadConnections:function(){this.own(d(this._enableLimits,"change",c.hitch(this,function(a){this._hitRate.set("disabled",!0!==a);this._hitCount.set("disabled",!0!==a);this._interval.set("disabled",!0!==a);g(".canDisable")[!0!==a?"addClass":"removeClass"]("disabled");
k[!0!==a?"add":"remove"](this._interval.domNode,"dijitTextBoxDisabled")})),d(this._addBtn,"click",c.hitch(this,function(){this._referrerUrl.isValid()&&(this._addReferralUrl(this._referrerUrl.get("value").split(/[ ,]+/)),this._referrerUrl.set("value",""))})),d(this._delBtn,"click",c.hitch(this,function(){this._referrers.getSelected().orphan();this._delBtn.set("disabled",!this._referrers.getSelected().length)})),d(this._referrers,"blur, click",c.hitch(this,function(){this._delBtn.set("disabled",!this._referrers.getSelected().length)})))},
_setDisabledAttr:function(a){var b=m.findWidgets(this.domNode).concat(m.findWidgets(this._content));f.forEach(b,function(b){b.set("disabled",a)});k[a?"add":"remove"](this._interval.domNode,"dijitTextBoxDisabled")},_addReferralUrl:function(a){var b;f.forEach(a,c.hitch(this,function(a){a&&((b=g("option",this._referrers.containerNode).some(function(b){return b.value.toLowerCase()===a.toLowerCase()}))||this._referrers.containerNode.appendChild(l.create("option",{value:a,innerHTML:a})))}))},isValid:function(){return this._enableLimits.get("checked")&&
!this._hitRate.isValid()?e.rateLimiting.errors.invalidHitRate:!0},_setValueAttr:function(a){this.serviceProxyParams=a;this._enableLimits.set("value",null);a&&(a.hitsPerInterval&&(this._hitRate.set("value",a.hitsPerInterval),this._interval.set("value",a.intervalSeconds),this._enableLimits.set("value","true"),this._extractUnits(a.intervalSeconds)),this._addReferralUrl(a.referrers))},_extractUnits:function(a){var b=this._interval.options,c=parseInt(a,10);a=1;if((b=f.filter(b,function(a){return 0===c%
parseInt(a.value,10)}))&&b.length)a=b[b.length-1].value,this._interval.set("value",a),this._hitCount.set("value",Math.floor(c/parseInt(a,10)))},_getValueAttr:function(){var a={},b=[];g("option",this._referrers.containerNode).forEach(function(a){b.push(a.value)});this._enableLimits.get("checked")&&(a.hitsPerInterval=parseInt(this._hitRate.get("value"),10),a.intervalSeconds=parseInt(this._hitCount.get("value"),10)*parseInt(this._interval.get("value"),10));b&&b.length&&(a.referrers=b);return a}})});