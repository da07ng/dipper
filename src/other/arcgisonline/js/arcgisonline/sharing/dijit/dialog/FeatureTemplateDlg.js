// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/dialog/FeatureTemplateDlg",["dijit","dojo","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,esri/dijit/AttributeInspector"],function(c,a,f){a.provide("arcgisonline.sharing.dijit.dialog.FeatureTemplateDlg");a.require("dijit.Dialog");a.require("dijit._Widget");a.require("dijit._Templated");a.require("esri.dijit.AttributeInspector");a.declare("arcgisonline.sharing.dijit.dialog.FeatureTemplateDlg",[c._Widget,c._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" id\x3d"template-dialog" title\x3d"${i18n.featureTemplateDlgTitle}" execute\x3d""\x3e\r\n    \x3cdiv style\x3d"padding:10px 10px;"\x3e\r\n      ${i18n.titleMsg}\r\n    \x3c/div\x3e\r\n    \x3ctable cellspacing\x3d"10" width\x3d"100%"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd\x3e\r\n            \x3clabel\x3e\r\n              ${i18n.nameLabel}\r\n            \x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd width\x3d"270"\x3e\r\n            \x3cdiv dojoAttachPoint\x3d"templateName" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" required\x3d"true" style\x3d"width:270px; padding:2px;"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd valign\x3d"top"\x3e\r\n            \x3clabel\x3e\r\n              ${i18n.descriptionLabel}\r\n            \x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd width\x3d"270"\x3e\r\n            \x3cdiv dojoAttachPoint\x3d"templateDescription" dojotype\x3d"dijit.form.Textarea" style\x3d"width:100%; padding:2px;"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd valign\x3d"top"\x3e\r\n            \x3clabel style\x3d"line-height:32px;"\x3e\r\n              ${i18n.drawingToolLabel}\r\n            \x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd\x3e\r\n            \x3ctable\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd\x3e\r\n                    \x3cdiv style\x3d"background-color: #FFF; border: 1px solid #BBB; padding:4px;"\x3e\r\n                      \x3cdiv dojoAttachPoint\x3d"templateDrawingTool"\x3e\r\n                      \x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                  \x3c/td\x3e\r\n                  \x3ctd\x3e\r\n                    \x3ca dojoAttachPoint\x3d"templateDrawingToolOptions" href\x3d"JavaScript:void(0);" style\x3d"text-decoration: none;"\x3e\r\n                      \x3cdiv dojoAttachPoint\x3d"templateDrawingToolArrow" class\x3d"dijitReset dijitInline esriArrows" style\x3d"cursor: pointer;"\x3e\r\n                      \x3c/div\x3e\r\n                    \x3c/a\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n    \x3cdiv style\x3d"padding:10px;"\x3e\r\n      ${i18n.valuesMsg}\r\n    \x3c/div\x3e\r\n    \x3c!-- we need padding right for the vertical scrollbars --\x3e\r\n    \x3cdiv dojotype\x3d"dijit.layout.BorderContainer" design\x3d"headline" gutters\x3d"false" style\x3d"height:160px; margin:10px 5px 10px 20px; padding-right:18px; overflow-y:auto;overflow-x:auto;"\x3e\r\n      \x3cdiv dojoType\x3d"dijit.layout.ContentPane" id\x3d"templateFieldsDiv" region\x3d"top"\x3e\r\n        \x3cdiv id\x3d"attributeInspectorDiv"\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cbutton dojoAttachEvent\x3d"onClick:onCancelClick" class\x3d"jevent cancel" style\x3d"float:right;" dojoType\x3d"dijit.form.Button"\x3e\r\n      ${i18n.cancel}\r\n    \x3c/button\x3e\r\n    \x3cbutton dojoAttachEvent\x3d"onClick:onDoneClick" class\x3d"jevent primary" style\x3d"float:right;" dojoType\x3d"dijit.form.Button"\x3e\r\n      ${i18n.done}\r\n    \x3c/button\x3e\r\n    \x3cbr/\x3e\r\n    \x26nbsp; \r\n    \x3cbr/\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
i18n:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.FeatureTemplateDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.clone(a.i18n.getLocalization("arcgisonline","arcgisonline").common);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").generalDlg);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").featureTemplateDlg)},show:function(b){this.attributeInspector&&
(this.attributeInspector.destroy(),this.attributeInspector=null);this.layer=b.layer;this.type=b.type;this.template=b.template;this.okHandler=b.okHandler;this.templateName.set("value",this.template.name);this.templateDescription.set("value",this.template.description);this.fillDrawingToolOptions();this.fillTemplateFields();this.setCurrentDrawingTool();a.style(a.byId("templateFieldsDiv"),"width","382px");c.byId("template-dialog").show();b=a.query(".atiAttributes",c.byId("template-dialog").domNode)[0];
a.forEach(b.childNodes,function(b){"TABLE"===b.tagName&&(b=a.coords(b).w,a.style(a.byId("templateFieldsDiv"),"width",b+18+"px"))})},hide:function(){this.attributeInspector.destroy();this.attributeInspector=null;c.byId("template-dialog").hide()},fillDrawingToolOptions:function(){var b;"esriGeometryPoint"===this.layer.geometryType?(this.templateDrawingTool.className="toolbarIcon pointIcon",this.drawingTool=esri.layers.FeatureTemplate.TOOL_POINT,b=[{label:this.i18n.pointLbl,iconClass:"toolbarIcon pointIcon",
onClick:a.hitch(this,"switchDrawingTool",esri.layers.FeatureTemplate.TOOL_POINT,"toolbarIcon pointIcon")}],a.style(this.templateDrawingToolArrow,"display","none")):("esriGeometryPolyline"===this.layer.geometryType?(this.templateDrawingTool.className="toolbarIcon polylineIcon",this.drawingTool=esri.layers.FeatureTemplate.TOOL_POLYLINE,b=[{label:this.i18n.freehandPolylineLbl,iconClass:"toolbarIcon freehandPolylineIcon",onClick:a.hitch(this,"switchDrawingTool",esri.layers.FeatureTemplate.TOOL_FREEHAND,
"toolbarIcon freehandPolylineIcon")},{label:this.i18n.polylineLbl,iconClass:"toolbarIcon polylineIcon",onClick:a.hitch(this,"switchDrawingTool",esri.layers.FeatureTemplate.TOOL_POLYLINE,"toolbarIcon polylineIcon")}]):(this.templateDrawingTool.className="toolbarIcon polygonIcon",this.drawingTool=esri.layers.FeatureTemplate.TOOL_POLYGON,b=[{label:this.i18n.freehandPolygonLbl,iconClass:"toolbarIcon freehandPolygonIcon",onClick:a.hitch(this,"switchDrawingTool",esri.layers.FeatureTemplate.TOOL_FREEHAND,
"toolbarIcon freehandPolygonIcon")},{label:this.i18n.circleLbl,iconClass:"toolbarIcon circleIcon",onClick:a.hitch(this,"switchDrawingTool",esri.layers.FeatureTemplate.TOOL_CIRCLE,"toolbarIcon circleIcon")},{label:this.i18n.rectangleLbl,iconClass:"toolbarIcon rectangleIcon",onClick:a.hitch(this,"switchDrawingTool",esri.layers.FeatureTemplate.TOOL_RECTANGLE,"toolbarIcon rectangleIcon")},{label:this.i18n.polygonLbl,iconClass:"toolbarIcon polygonIcon",onClick:a.hitch(this,"switchDrawingTool",esri.layers.FeatureTemplate.TOOL_POLYGON,
"toolbarIcon polygonIcon")}]),a.style(this.templateDrawingToolArrow,"display",""));b=new arcgisonline.sharing.dijit.TextMenu({triggerNode:this.templateDrawingToolOptions,labelNode:this.templateDrawingToolOptions,textMenuItems:b});a.addClass(b.menu.domNode,"templateDrawingToolPopup")},setCurrentDrawingTool:function(){this.template.drawingTool&&(this.templateDrawingTool.className="esriGeometryPoint"===this.layer.geometryType?"toolbarIcon pointIcon":"esriGeometryPolyline"===this.layer.geometryType?this.template.drawingTool===
esri.layers.FeatureTemplate.TOOL_FREEHAND?"toolbarIcon freehandPolylineIcon":"toolbarIcon polylineIcon":this.template.drawingTool===esri.layers.FeatureTemplate.TOOL_FREEHAND?"toolbarIcon freehandPolygonIcon":this.template.drawingTool===esri.layers.FeatureTemplate.TOOL_CIRCLE?"toolbarIcon circleIcon":this.template.drawingTool===esri.layers.FeatureTemplate.TOOL_RECTANGLE?"toolbarIcon rectangleIcon":"toolbarIcon polygonIcon")},fillTemplateFields:function(){a.byId("attributeInspectorDiv")||a.create("div",
{id:"attributeInspectorDiv"},a.byId("templateFieldsDiv"));this.attributeInspector=new esri.dijit.AttributeInspector({featureLayer:this.layer},"attributeInspectorDiv");a.style(this.attributeInspector.layerName,"display","none");this.attributeInspector.showFeature(this.template.prototype,this.layer);a.style(this.attributeInspector.editButtons,"display","none");this.attributeInspector._attachmentEditor&&a.style(this.attributeInspector._attachmentEditor.domNode,"display","none");if(this.type)for(var b=
a.query(".atiField",this.attributeInspector.domNode),d=0;d<b.length;d++){var e=b[d],c=e.parentElement;if(c.parentElement.childNodes[0].innerHTML===this.layer.typeIdField){a.style(e,"display","none");a.create("span",{innerHTML:this.type.id},c);break}}a.connect(this.attributeInspector,"onAttributeChange",a.hitch(this,function(a,b,d){a=!1;if(!esri.isDefined(d)||isNaN(d))for(var e=0;e<this.layer.fields.length;e++){var c=this.layer.fields[e];if(c.name===b){if(!c.nullable&&("esriFieldTypeDouble"===c.type||
"esriFieldTypeSingle"===c.type||"esriFieldTypeInteger"===c.type||"esriFieldTypeSmallInteger"===c.type))a=!0,this.attributeInspector.showFeature(this.template.prototype,this.layer);break}}a||(this.template.prototype.attributes[b]=d)}))},switchDrawingTool:function(a,d){this.drawingTool=a;this.templateDrawingTool.className=d},onDoneClick:function(b){if(b=this.templateName.get("value")){var d=0;if(this.type)for(var c=0;c<this.type.templates.length;c++)this.type.templates[c].name===b&&d++;else for(c=0;c<
this.layer.templates.length;c++)this.layer.templates[c].name===b&&d++;1<d?(d=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),d.show({title:this.i18n.errorDlgTitle,message:a.string.substitute(this.i18n.errors.nameAlreadyExists,{name:b})})):(this.template.description=this.templateDescription.get("value"),this.template.name=b,this.template.drawingTool=this.drawingTool,this.okHandler&&this.okHandler(this.template),this.hide())}else d=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),
d.show({title:this.i18n.errorDlgTitle,message:this.i18n.errors.badValue})},onCancelClick:function(a){this.hide()}})});