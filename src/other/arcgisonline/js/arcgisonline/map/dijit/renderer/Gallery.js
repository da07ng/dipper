// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
require({cache:{"url:arcgisonline/map/dijit/renderer/templates/Gallery.html":'\x3cdiv data-dojo-type\x3d"dijit.layout.BorderContainer" region\x3d"top" style\x3d"height:100%;"\x3e\r\n  \x3cdiv class\x3d"panel panel_left" data-dojo-type\x3d"dijit.layout.ContentPane" region\x3d"center" style\x3d"padding:7px;margin-bottom:-5px;"\x3e\r\n    \x3cdiv id\x3d"rendererHeader" data-dojo-type\x3d"dijit.layout.ContentPane" region\x3d"top"\x3e\r\n      \x3cdiv class\x3d"esriFloatTrailing" style\x3d"display:inline;"\x3e\r\n        \x3ca href\x3d"JavaScript:void(0);" data-dojo-attach-point\x3d"_closeBtn" data-dojo-attach-event\x3d"onClick:_onClose" title\x3d"${i18n.close}" class\x3d"panel panel_close panel_collapse"\x3e\x3c/a\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"rendererTitle" class\x3d"esriFloatLeading panel_title"\x3e\r\n        ${i18n.rendererPanelTitle}\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_rendererGalleryLayer" class\x3d"esriFloatLeading panel_title" style\x3d"clear:both;"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"clear:both; height:1px;"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit.layout.ContentPane" region\x3d"center" id\x3d"rendererGalleryPane" style\x3d"padding-top:10px;"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_rendererTitle1"\x3e\r\n        \x3cdiv class\x3d"esriFloatLeading firstIcon"\x3e\x3c/div\x3e    \r\n        \x3cdiv class\x3d"esriFloatLeading title"\x3e${i18n.chooseAttribute}\x3c/div\x3e \r\n        \x3ctable class\x3d"esriFloatLeading" cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n          \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd style\x3d"width: 3.5em;" align\x3d"right" valign\x3d"top"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_rendererSwitchAttribute12" class\x3d"switchAttributeIcon esriFloatTrailing rendererClickable" style\x3d"margin: 23px 10px 0 10px; display:none;"\x3e\x3c/div\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cdiv style\x3d"clear:both;"\x3e\r\n                  \x3cselect class\x3d"rendererInput" data-dojo-attach-point\x3d"_rendererAttribute" data-dojo-attach-event\x3d"onChange:_onChangeAttribute" data-dojo-type\x3d"dijit.form.Select" maxHeight\x3d"150" sortByLabel\x3d"false"\x3e\r\n                  \x3c/select\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_rendererAttributeDiv2" style\x3d"clear:both; padding-top:8px;display:none;"\x3e\r\n                  \x3ctable cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n                    \x3ctbody\x3e\r\n                      \x3ctr\x3e\r\n                        \x3ctd\x3e\r\n                          \x3cselect class\x3d"rendererInput esriFloatLeading" data-dojo-attach-point\x3d"_rendererAttribute2" data-dojo-attach-event\x3d"onChange:_onChangeAttribute2" data-dojo-type\x3d"dijit.form.Select" maxHeight\x3d"150" sortByLabel\x3d"false"\x3e\r\n                          \x3c/select\x3e\r\n                        \x3c/td\x3e\x3ctd\x3e\r\n                          \x3cdiv data-dojo-attach-point\x3d"_rendererRemoveAttribute2" class\x3d"removeAttributeIcon rendererClickable" style\x3d"margin: 4px 10px 0 10px;"\x3e\x3c/div\x3e\r\n                        \x3c/td\x3e\r\n                      \x3c/tr\x3e\r\n                    \x3c/tbody\x3e\r\n                  \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_rendererAttributeDiv3" style\x3d"clear:both; padding-top:8px;display:none;"\x3e\r\n                  \x3ctable cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n                    \x3ctbody\x3e\r\n                      \x3ctr\x3e\r\n                        \x3ctd\x3e\r\n                          \x3cselect class\x3d"rendererInput esriFloatLeading" data-dojo-attach-point\x3d"_rendererAttribute3" data-dojo-attach-event\x3d"onChange:_onChangeAttribute3" data-dojo-type\x3d"dijit.form.Select" maxHeight\x3d"150" sortByLabel\x3d"false"\x3e\r\n                          \x3c/select\x3e\r\n                        \x3c/td\x3e\x3ctd\x3e\r\n                          \x3cdiv data-dojo-attach-point\x3d"_rendererRemoveAttribute3" class\x3d"removeAttributeIcon rendererClickable" style\x3d"margin: 4px 10px 0 10px;"\x3e\x3c/div\x3e\r\n                        \x3c/td\x3e\r\n                      \x3c/tr\x3e\r\n                    \x3c/tbody\x3e\r\n                  \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_rendererAttributeDiv4" style\x3d"clear:both; padding-top:8px;display:none;"\x3e\r\n                  \x3ctable cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n                    \x3ctbody\x3e\r\n                      \x3ctr\x3e\r\n                        \x3ctd\x3e\r\n                          \x3cselect class\x3d"rendererInput esriFloatLeading" data-dojo-attach-point\x3d"_rendererAttribute4" data-dojo-attach-event\x3d"onChange:_onChangeAttribute4" data-dojo-type\x3d"dijit.form.Select" maxHeight\x3d"150" sortByLabel\x3d"false"\x3e\r\n                          \x3c/select\x3e\r\n                        \x3c/td\x3e\x3ctd\x3e\r\n                          \x3cdiv data-dojo-attach-point\x3d"_rendererRemoveAttribute4" class\x3d"removeAttributeIcon rendererClickable" style\x3d"margin: 4px 10px 0 10px;"\x3e\x3c/div\x3e\r\n                        \x3c/td\x3e\r\n                      \x3c/tr\x3e\r\n                    \x3c/tbody\x3e\r\n                  \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_rendererAttributeDiv5" style\x3d"clear:both; padding-top:8px;display:none;"\x3e\r\n                  \x3ctable cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n                    \x3ctbody\x3e\r\n                      \x3ctr\x3e\r\n                        \x3ctd\x3e\r\n                          \x3cselect class\x3d"rendererInput esriFloatLeading" data-dojo-attach-point\x3d"_rendererAttribute5" data-dojo-attach-event\x3d"onChange:_onChangeAttribute5" data-dojo-type\x3d"dijit.form.Select" maxHeight\x3d"150" sortByLabel\x3d"false"\x3e\r\n                          \x3c/select\x3e\r\n                        \x3c/td\x3e\x3ctd\x3e\r\n                          \x3cdiv data-dojo-attach-point\x3d"_rendererRemoveAttribute5" class\x3d"removeAttributeIcon rendererClickable" style\x3d"margin: 4px 10px 0 10px;"\x3e\x3c/div\x3e\r\n                        \x3c/td\x3e\r\n                      \x3c/tr\x3e\r\n                    \x3c/tbody\x3e\r\n                  \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_rendererAddAttribute" class\x3d"rendererClickable" style\x3d"clear:both; padding-top:10px; display:none;"\x3e\r\n                  \x3cdiv data-dojo-attach-point\x3d"_rendererAddAttributeIcon" class\x3d"addAttributeIcon esriFloatLeading"\x3e\x3c/div\x3e\r\n                  \x3cdiv data-dojo-attach-point\x3d"_rendererAddAttributeText" class\x3d"esriFloatLeading" style\x3d"margin: 0 10px;"\x3e${i18n.addAttribute}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e   \r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"padding-top:15px; clear:both;"\x3e    \r\n        \x3cdiv class\x3d"esriFloatLeading" data-dojo-attach-point\x3d"_rendererTitle2"\x3e    \r\n          \x3cdiv class\x3d"esriFloatLeading secondIcon"\x3e\x3c/div\x3e    \r\n          \x3cdiv class\x3d"esriFloatLeading title"\x3e${i18n.selectDrawingStyle}\x3c/div\x3e\r\n        \x3c/div\x3e    \r\n        \x3cdiv data-dojo-attach-point\x3d"_rendererTypes" class\x3d"esriFloatLeading rendererTypes" style\x3d"clear: both; overflow-y:auto;"\x3e  \r\n        \x3c/div\x3e    \r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"rendererGalleryContentClose"\x3e\r\n    \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"calcite blue" data-dojo-attach-point\x3d"_doneButton" data-dojo-attach-event\x3d"onClick:_onDone"\x3e\x3cspan\x3e${i18n.done}\x3c/span\x3e\x3c/button\x3e\r\n    \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"calcite transparent" id\x3d"rendererContent-close" data-dojo-attach-point\x3d"_cancelButton" data-dojo-attach-event\x3d"onClick:_onCancel"\x3e\x3cspan\x3e${i18n.cancel}\x3c/span\x3e\x3c/button\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"rendererContentFooter" data-dojo-type\x3d"dijit.layout.ContentPane" region\x3d"bottom" style\x3d"height:40px; padding: 0 5px 0 5px;"\x3e\r\n    \x3cdiv class\x3d"footer" id\x3d"rendererFooter" data-dojo-type\x3d"arcgisonline.sharing.dijit.SiteFooterMap" style\x3d"white-space:normal;"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n'}});
define("arcgisonline/map/dijit/renderer/Gallery","dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/connect dojo/_base/array dojo/_base/window dojo/_base/json dojo/string dojo/json dojo/dom dojo/has dojo/query dojo/on dojo/Deferred dojo/dom-style dojo/dom-class dojo/dom-construct dojox/data/AndOrWriteStore dojox/html/entities dijit/registry dijit/form/MultiSelect dijit/form/Button esri/symbols/jsonUtils esri/renderers/jsonUtils esri/layers/FeatureLayer esri/layers/CSVLayer esri/layers/StreamLayer esri/layers/GeoRSSLayer esri/layers/ArcGISDynamicMapServiceLayer esri/styles/choropleth esri/renderers/HeatmapRenderer dijit/layout/BorderContainer arcgisonline/map/dijit/renderer/MultiAttributes arcgisonline/map/dijit/renderer/Simple arcgisonline/map/dijit/renderer/HeatMap arcgisonline/map/dijit/renderer/Ratio arcgisonline/map/dijit/renderer/Predominance arcgisonline/map/dijit/renderer/_GalleryMixin arcgisonline/map/dijit/renderer/_SymbolsMixin arcgisonline/map/dijit/renderer/_SimpleMixin arcgisonline/map/dijit/renderer/_UniqueValuesMixin arcgisonline/map/dijit/renderer/_ColorMixin arcgisonline/map/dijit/renderer/_SizeMixin arcgisonline/map/dijit/renderer/_HeatMapMixin arcgisonline/map/dijit/renderer/_PredominanceMixin arcgisonline/map/dijit/renderer/_WatercolorMixin arcgisonline/map/dijit/renderer/_RatioMixin arcgisonline/map/dijit/renderer/_RendererMixin arcgisonline/map/dijit/renderer/ColorGrid arcgisonline/map/dijit/renderer/SizeGrid dojo/i18n!arcgisonline/nls/arcgisonline dijit/_Widget dijit/_Templated dojo/text!arcgisonline/map/dijit/renderer/templates/Gallery.html".split(" "),
function(x,c,p,h,g,da,A,E,F,t,m,r,ea,fa,b,f,ga,G,B,q,ha,ia,ja,l,H,I,J,ka,C,y,K,u,z,L,M,N,la,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,w,aa,ba,ca){x=x([aa,ba],{declaredClass:"arcgisonline.map.dijit.renderer.Gallery",basePath:require.toUrl("arcgisonline/map/dijit/renderer"),baseClass:"esriAGORendererGallery",widgetsInTemplate:!0,templateString:ca,_vars:[],_rConnects:null,tooltips:[],i18n:null,dontUseFields:"id;fips;fid;objectid;_objectid;__objectid;x;y;lat;long;latitude;longitude;shape;shape_length;shape_leng;shape_area;perimeter;stretched value;fnode_;tnode_;lpoly_;rpoly_;poly_;subclass;subclass;rings_ok;rings_nok".split(";"),
numberFieldOrder:"count percent sum elevation value valore valoare total gesamt score income age expected average median size cost expenditure revenue profit growth sale quantity population price unit length width difference distance".split(" "),stringFieldOrder:"type name status class category code value label zone symbol color owner district group species rating score party".split(" "),origRenderer:null,savedRenderers:{},rendererUniqueValuesStack:null,rendererUniqueValuesPanel:null,lastUniqueDefaultSymbol:null,
lastUniqueDefaultLabel:null,disableAllEvents:!0,container:null,subLayerId:null,mapLayer:null,layer:null,features:null,renderer:null,symbol:null,streamPreviousSymbol:null,streamConnectLineSymbol:null,colorSetUniqueResult:null,onSymbolCancelHandler:null,onSymbolChangeHandler:null,onRotationChangeHandler:null,applyRendererEditsHandler:null,saveRendererHandler:null,colorSetGroupId:null,colorSetItems:null,rendererUniqueColorStore:null,attributesStore:null,attributesCount:null,datePattern:null,currentColorOrderIsDefault:!0,
rendererHasUserColors:!1,hasNumericField:!1,pattern:"#,###,###,##0.##",constructor:function(a,b){this._ColorGrid=Z;this._SizeGrid=$;c.mixin(this,O);c.mixin(this,P);c.mixin(this,Y);c.mixin(this,Q);c.mixin(this,R);c.mixin(this,S);c.mixin(this,T);c.mixin(this,U);c.mixin(this,V);c.mixin(this,W);c.mixin(this,X);if(a){a.containerNode&&(this.container=a.containerNode);this.subLayerId=a.subLayerId;this.mapLayer=a.mapLayer;this.noSimple=a.noSimple;this.showField=a.showField;this.style=a.style;this.isFeatColl=
arcgisonline.map.featColl.isFeatureCollection(this.mapLayer);this.isCSV=this.mapLayer.layer instanceof I;this.isSL=this.mapLayer.layer instanceof J;this.isGeoRSS=this.mapLayer.layer instanceof esri.layers.GeoRSSLayer;if(this.isDMS=this.mapLayer.layer instanceof C)arcgisonline.map.main.hasDynamicLayers(this.mapLayer)?this.hasDynamic=!0:this.mapLayer.layer.supportsDynamicLayers&&(arcgisonline.map.dynLayer.checkDynamicLayers(this.mapLayer),arcgisonline.map.dynLayer.setupDynamicLayers(this.mapLayer),
this.hasDynamic=!0);this.isOwnerOfHostedFS=!1;arcgisonline.map.mapUtil.checkHostedFSAccess(this.mapLayer,c.hitch(this,function(a){this.isOwnerOfHostedFS=!0},this.mapLayer));this.showGallery=a.showGallery;this._rConnects=[]}},destroy:function(){this.properClose||(delete this.mapLayer._scaleChanged,delete this.mapLayer._opacityChanged,this.hideBusy(),this.hideLegendPopup(),this.dismissRendererChanges());this.destroyBusy();this.hideLegendPopup();this.basemapSwitchHandler&&h.unsubscribe(this.basemapSwitchHandler);
this.rendererSimplePanel&&this.rendererSimplePanel.destroy();this.rendererSimpleStack&&this.rendererSimpleStack.destroy();this.rendererUniqueValuesPanel&&this.rendererUniqueValuesPanel.destroy();this.rendererUniqueValuesStack&&this.rendererUniqueValuesStack.destroy();this.rendererColorPanel&&this.rendererColorPanel.destroy();this.rendererColorStack&&this.rendererColorStack.destroy();this.rendererSizePanel&&this.rendererSizePanel.destroy();this.rendererSizeStack&&this.rendererSizeStack.destroy();this.rendererHeatMapPanel&&
this.rendererHeatMapPanel.destroy();this.rendererHeatMapStack&&this.rendererHeatMapStack.destroy();this.rendererMultiAttributesPanel&&this.rendererMultiAttributesPanel.destroy();this.rendererMultiAttributesStack&&this.rendererMultiAttributesStack.destroy();this.destroyTooltips();g.forEach(this._rConnects,h.disconnect);delete this._rConnects;this.inherited(arguments)},postMixInProperties:function(){this.inherited(arguments);this.i18n=w.common;c.mixin(this.i18n,w.generalDlg);c.mixin(this.i18n,w.viewer.time);
c.mixin(this.i18n,w.rendererCommon);c.mixin(this.i18n,w.rendererGalleryPanel)},postCreate:function(){this.container.addChild(q.byId("rendererPanel"));this.loadConnections()},loadConnections:function(){h.connect(this._rendererAddAttributeIcon,"click",c.hitch(this,"_onAddAttributeClick"));h.connect(this._rendererAddAttributeText,"click",c.hitch(this,"_onAddAttributeClick"));h.connect(this._rendererRemoveAttribute2,"click",c.hitch(this,"_onRemoveAttribute2Click"));h.connect(this._rendererRemoveAttribute3,
"click",c.hitch(this,"_onRemoveAttribute3Click"));h.connect(this._rendererRemoveAttribute4,"click",c.hitch(this,"_onRemoveAttribute4Click"));h.connect(this._rendererRemoveAttribute5,"click",c.hitch(this,"_onRemoveAttribute5Click"));h.connect(this._rendererSwitchAttribute12,"click",c.hitch(this,"_onSwitchAttributeClick"));this._rConnects.push(h.connect(q.byId("leftContentPanel"),"resize",this,"adjustHeight"))},_onDone:function(a){a.preventDefault();this.hideBusy();this.mapLayer._scaleChanged&&(this.mapLayer.scaleChanged=
!0);delete this.mapLayer._scaleChanged;this.mapLayer._opacityChanged&&(this.mapLayer.opacityChanged=!0);delete this.mapLayer._opacityChanged;this.hideLegendPopup();A.toJson(this.origRenderer.renderer)!==A.toJson(this.renderer.toJson())&&(this.mapLayer.rendererChanged=!0);this.properClose=!0;arcgisonline.map.leftPanel.openLeftTOCPanel();h.publish("_onRendererUpdate",[])},_onCancel:function(a){a.preventDefault();delete this.mapLayer._scaleChanged;delete this.mapLayer._opacityChanged;this.hideBusy();
this.hideLegendPopup();this.dismissRendererChanges();this.properClose=!0;arcgisonline.map.leftPanel.openLeftTOCPanel()},_onClose:function(a){a.preventDefault();this.hideBusy();delete this.mapLayer._scaleChanged;delete this.mapLayer._opacityChanged;this.hideLegendPopup();this.dismissRendererChanges();this.properClose=!0;arcgisonline.map.leftPanel.openLeftTOCPanel()},externalCancel:function(){delete this.mapLayer._scaleChanged;delete this.mapLayer._opacityChanged;this.hideBusy();this.hideLegendPopup();
this.dismissRendererChanges();this.properClose=!0},startup:function(){this.inherited(arguments);this._init()},_init:function(){this.isHosted=!1;this.isGeoRSS?(-1===this.subLayerId&&(this.subLayerId=0),this.layer=this.mapLayer.layer.getFeatureLayers()[this.subLayerId]):this.hasDynamic?(this.layer=this.mapLayer.layer.dynamicLayerInfos[this.subLayerId],g.forEach(this.mapLayer.layersInfo.layers,function(a){a.id==this.layer.source.mapLayerId&&(this.serviceLayerInfo=a,a=null,this.mapLayer.layer.layerDefinitions&&
(a=this.mapLayer.layer.layerDefinitions[this.subLayerId]),this.fLayer=new esri.layers.FeatureLayer(this.mapLayer.url+"/dynamicLayer",{outFields:["*"],resourceInfo:null,source:this.layer.source,opacity:this.mapLayer.layer.opacity,definitionExpression:a}))},this)):this.mapLayer.layer instanceof C?this.layer=this.mapLayer.layersInfo.layers[this.subLayerId]:this.isSL?this.layer=this.mapLayer.layer:this.mapLayer.layer?(this.layer=this.mapLayer.layer,this.isHosted=arcgisonline.sharing.util.isHostedService(this.layer.url)):
this.layer=this.mapLayer.layers[this.subLayerId];var a=arcgisonline.sharing.util.urlToObject(document.URL);a.query=a.query||{};this.newStyles=a.query.newStyles;this.showPredominance=!1;this.newStyles&&(this.isOwnerOfHostedFS&&this.isHosted)&&(this.showPredominance=!0);this._rendererGalleryLayer.innerHTML=B.encode(this.mapLayer.title.replace(/\_/g," "));-1!==this.subLayerId&&(this.layer.name&&this.mapLayer.title!==this.layer.name)&&(this._rendererGalleryLayer.innerHTML+=" - "+B.encode(this.layer.name.replace(/\_/g,
" ")));this.savedRenderers={};this.geometryType=this.layer.geometryType;this.hasDynamic&&(this.geometryType=this.serviceLayerInfo.geometryType);this.renderer=this.layer.renderer;this.layer.drawingInfo?this.renderer=esri.renderer.fromJson(this.layer.drawingInfo.renderer):this.layer.layerDefinition&&this.layer.layerDefinition.drawingInfo?this.renderer=esri.renderer.fromJson(this.layer.layerDefinition.drawingInfo.renderer):this.serviceLayerInfo&&(this.renderer=esri.renderer.fromJson(this.serviceLayerInfo.drawingInfo.renderer));
if(9>m("ie")&&"heatMap"===this.getRendererStyle(this.renderer))this.buildSimpleRenderer().then(c.hitch(this,function(a){this.renderer=a;this.setRenderer(a);this._init()}));else{this.origRenderer=this.buildCurrentRendererInfo();this.hasNumericField=!1;var a=this._getLayerFields(),b;for(b=0;b<a.length;b++){var d=a[b];if(("esriFieldTypeSingle"==d.type||"esriFieldTypeDouble"==d.type||"esriFieldTypeInteger"==d.type||"esriFieldTypeSmallInteger"==d.type)&&this.layer.objectIdField!==d.name&&-1===g.indexOf(this.dontUseFields,
d.name.toLowerCase())){this.hasNumericField=!0;break}}this.fillRendererAttribute();this.showGallery&&!this.isGeoRSS&&!this.isSL?(this.updateUIWithRenderer(),this.showLegendPopup()):(!this.isGeoRSS&&!this.isSL&&this.buildList(),this._onOptions());setTimeout(c.hitch(this,function(){this.disableAllEvents=!1;(this.noSimple||this.showField)&&this._onChangeAttribute();h.publish("onRendererGalleryLoad",[])}),1E3);this.basemapSwitchHandler&&h.unsubscribe(this.basemapSwitchHandler);this.basemapSwitchHandler=
h.subscribe("basemapSwitch",c.hitch(this,function(){if("rendererStack"===arcgisonline.map.leftPanel.getLeftContentPanelStack()&&("color"===this.getRendererType(this.renderer)||"colorsize"===this.getRendererType(this.renderer))){var a=this.getVisualVariableByType("colorInfo",null,this.renderer.authoringInfo.visualVariables);this.scheme=y.getSchemes({theme:a&&a.theme?a.theme:"high-to-low",basemap:this.getBasemapType(),geometryType:this.geometryType}).primaryScheme;a=this.updateSchemeOnColorRenderer({scheme:this.scheme});
this.applyColorRenderer(a,null,!0)}}))}},updateUIWithRenderer:function(){var a=this.getVisualVariableByType("colorInfo",null,this.renderer.visualVariables),e=this.getVisualVariableByType("sizeInfo",null,this.renderer.visualVariables),d=this.renderer.attributeField||this.renderer.field||this.renderer.fields||a&&a.field||e&&e.field;if("function"!==typeof d&&!("object"===typeof d&&"watercolor"===this.getRendererStyle(this.renderer)))if("colorsize"===this.getRendererStyle(this.renderer)||"uniquesize"===
this.getRendererStyle(this.renderer)||"ratio"===this.getRendererStyle(this.renderer)){var d=a?a.field:d,k=e?e.field:a.normalizationField,a=this._getLayerFields(),e=g.some(a,c.hitch(this,function(a){return a.name===d})),a=g.some(a,c.hitch(this,function(a){return a.name===k}));if(!e||!a)d=null,this.buildSimpleRenderer().then(c.hitch(this,function(a){this.renderer=a;this.applySimpleRenderer(a)}),c.hitch(this,function(){}));this.getAttributeItem(d).then(c.hitch(this,function(a){this.attributeItem=a;this._rendererAttribute.set("value",
a.name);this.getAttributeItem(k).then(c.hitch(this,function(a){this.attributeItem2=a;this.isTypeString(this.attributeItem)?(this._rendererAttribute2.setStore(this.attributesStore,"",{query:"NOT type:'none' AND NOT type:'total' AND NOT type:'blank' AND NOT type:'percent' AND NOT type:'showLocationOnly' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeDate' AND NOT type:'esriFieldTypeString' AND hasCodedValues:'false' AND NOT name:'"+this.layer.objectIdField+
"'"}),!this.isTypeString(this.attributeItem2)&&!this.attributeItem2.codedValues&&this._rendererAttribute2.set("value",this.attributeItem2.name)):(this._rendererAttribute2.setStore(this.attributesStore,"",{query:"NOT type:'none' AND NOT type:'total' AND NOT type:'blank' AND NOT type:'percent' AND NOT type:'showLocationOnly' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeDate' AND NOT name:'"+this.layer.objectIdField+"'"}),this._rendererAttribute2.set("value",
this.attributeItem2.name));b.set(this._rendererAttributeDiv2,"display","");!this.isTypeString(this.attributeItem)&&(!this.isTypeString(this.attributeItem2)&&!this.attributeItem.codedValues&&!this.attributeItem2.codedValues&&this.attributeItem.name!==this.attributeItem2.name)&&b.set(this._rendererSwitchAttribute12,"display","");delete this.noSimple;this.buildList();this.setTypeOptions();this.selectTypeBox()}))}))}else if(a=this._getLayerFields(),a=g.some(a,c.hitch(this,function(a){return a.name===
d})),d&&!a&&(d=null,this.buildSimpleRenderer().then(c.hitch(this,function(a){this.renderer=a;this.applySimpleRenderer(a)}),c.hitch(this,function(){}))),this.showField){this.showField=this.showField.toLowerCase();a=this._getLayerFields();for(e=0;e<a.length;e++)if(a[e].name.toLowerCase()==this.showField){d=a[e].name;break}d?(this._rendererAttribute.set("value",d),0<this.attributesCount.number&&!this.hasDynamic&&b.set(this._rendererAddAttribute,"display","")):(delete this.noSimple,delete this.showField,
this.buildList(),this.setTypeOptions(),this.selectTypeBox())}else if(d)this.getAttributeItem(d).then(c.hitch(this,function(a){this.attributeItem=a;this._rendererAttribute.set("value",a.name);delete this.noSimple;this.buildList();this.setTypeOptions();this.selectTypeBox();0<this.attributesCount.number&&!this.hasDynamic&&b.set(this._rendererAddAttribute,"display","")}));else if("simple"===this.getRendererStyle(this.renderer)&&this.noSimple){var a=this._getLayerFields(),n=-1,v=-1,s=-1,f=-1,D,h,l,m;g.forEach(a,
function(a,b){var e=a.name.toLowerCase(),c=g.indexOf(this.numberFieldOrder,e);if(-1<c&&(-1===n||n>c))n=c,D=a.name;for(c=0;c<this.numberFieldOrder.length;c++){var d=this.numberFieldOrder[c];if(-1<e.indexOf(d)){if(-1===s||s>c)s=c,l=a.name;break}}c=g.indexOf(this.stringFieldOrder,e);if(-1<c&&(-1===v||v>c))v=c,h=a.name;for(c=0;c<this.stringFieldOrder.length;c++)if(d=this.stringFieldOrder[c],-1<e.indexOf(d)){if(-1===f||f>c)f=c,m=a.name;break}},this);if(-1!==n)d=D;else if(-1!==s)d=l;else if(-1!==v)d=h;
else if(-1!==f)d=m;else{for(e=0;e<a.length;e++)if(-1<g.indexOf(["esriFieldTypeInteger","esriFieldTypeDouble","esriFieldTypeSingle","esriFieldTypeSmallInteger"],a[e].type)&&this.layer.objectIdField!==a[e].name&&-1===g.indexOf(this.dontUseFields,a[e].name.toLowerCase())){d=a[e].name;break}if(!d)for(e=0;e<a.length;e++)if("esriFieldTypeString"===a[e].type){d=a[e].name;break}}d?(this._rendererAttribute.set("value",d),0<this.attributesCount.number&&!this.hasDynamic&&b.set(this._rendererAddAttribute,"display",
"")):(delete this.noSimple,this.buildList(),this.setTypeOptions(),this.selectTypeBox())}else delete this.noSimple,this.buildList(),this.setTypeOptions(),this.selectTypeBox()},selectTypeBox:function(){switch(this.getRendererStyle(this.renderer)){case "simple":b.set(this._vars.simple.select,"display","none");b.set(this._vars.simple.options,"display","");b.set(this._vars.simple.check,"display","");f.add(this._vars.simple.title,"checked");break;case "type":b.set(this._vars.unique.select,"display","none");
b.set(this._vars.unique.options,"display","");b.set(this._vars.unique.check,"display","");f.add(this._vars.unique.title,"checked");break;case "color":case "classedColor":b.set(this._vars.color.select,"display","none");b.set(this._vars.color.options,"display","");b.set(this._vars.color.check,"display","");f.add(this._vars.color.title,"checked");break;case "size":case "classedSize":b.set(this._vars.size.select,"display","none");b.set(this._vars.size.options,"display","");b.set(this._vars.size.check,
"display","");f.add(this._vars.size.title,"checked");break;case "heatMap":b.set(this._vars.heatMap.select,"display","none");b.set(this._vars.heatMap.options,"display","");b.set(this._vars.heatMap.check,"display","");f.add(this._vars.heatMap.title,"checked");break;case "predominance":b.set(this._vars.predominance.select,"display","none");b.set(this._vars.predominance.options,"display","");b.set(this._vars.predominance.check,"display","");f.add(this._vars.predominance.title,"checked");break;case "predominancesize":b.set(this._vars.predominancesize.select,
"display","none");b.set(this._vars.predominancesize.options,"display","");b.set(this._vars.predominancesize.check,"display","");f.add(this._vars.predominancesize.title,"checked");break;case "colorsize":b.set(this._vars.colorsize.select,"display","none");b.set(this._vars.colorsize.options,"display","");b.set(this._vars.colorsize.check,"display","");f.add(this._vars.colorsize.title,"checked");break;case "uniquesize":b.set(this._vars.uniquesize.select,"display","none");b.set(this._vars.uniquesize.options,
"display","");b.set(this._vars.uniquesize.check,"display","");f.add(this._vars.uniquesize.title,"checked");break;case "watercolor":b.set(this._vars.watercolor.select,"display","none");b.set(this._vars.watercolor.options,"display","none");b.set(this._vars.watercolor.check,"display","");f.add(this._vars.watercolor.title,"checked");break;case "ratio":b.set(this._vars.ratio.select,"display","none"),b.set(this._vars.ratio.options,"display",""),b.set(this._vars.ratio.check,"display",""),f.add(this._vars.ratio.title,
"checked")}this.adjustHeight()},updateList:function(){var a="none"!==b.get(this._rendererAttributeDiv2,"display"),c="none"!==b.get(this._rendererAttributeDiv3,"display"),d="none"!==b.get(this._rendererAttributeDiv4,"display"),k="none"!==b.get(this._rendererAttributeDiv5,"display");if(!(a&&!this.attributeItem2||c&&!this.attributeItem3||d&&!this.attributeItem4||k&&!this.attributeItem5)&&!this.checkKeepPartsOfRenderer())!this.attributeItem||"showLocationOnly"===this.attributeItem.name?(this.buildList("simple"),
this.setTypeOptions(),this._select_simple()):this.attributeItem.codedValues||"esriFieldTypeString"===this.attributeItem.type?this.attributeItem2?(this.buildList("uniquesize"),this.setTypeOptions(),this._select_uniquesize(),b.set(this._rendererSwitchAttribute12,"display","none")):(this.buildList("type"),this.setTypeOptions(),this._select_unique()):("esriFieldTypeInteger"==this.attributeItem.type||"esriFieldTypeDouble"==this.attributeItem.type||"esriFieldTypeSingle"==this.attributeItem.type||"esriFieldTypeSmallInteger"==
this.attributeItem.type)&&this.layer.objectIdField!==this.attributeItem.name?this.attributeItem2?this.attributeItem3?(this.buildList("predominance"),this.setTypeOptions(),this._select_predominance()):this.isTypeString(this.attributeItem2)||this.attributeItem.codedValues||this.attributeItem.codedValues?(this.buildList("uniquesize"),this.setTypeOptions(),this._select_uniquesize(),b.set(this._rendererSwitchAttribute12,"display","none"),b.set(this._rendererAddAttribute,"display","none")):(this.buildList("colorsize"),
this.setTypeOptions(),this._select_colorsize(),this.attributeItem.name!==this.attributeItem2.name?b.set(this._rendererSwitchAttribute12,"display",""):b.set(this._rendererSwitchAttribute12,"display","none")):"esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType?(this.buildList("classedSize"),this.setTypeOptions(),this._select_size()):"esriGeometryPolyline"==this.geometryType?(this.buildList("classedSize"),this.setTypeOptions(),this._select_size()):"esriGeometryPolygon"==
this.geometryType&&("esriFieldTypeInteger"==this.attributeItem.type||"esriFieldTypeSmallInteger"==this.attributeItem.type?(this.buildList("classedSize"),this.setTypeOptions(),this._select_size()):(this.buildList("classedColor"),this.setTypeOptions(),this._select_color())):"esriFieldTypeDate"==this.attributeItem.type&&(this.buildList("simple"),this.setTypeOptions(),this._select_simple()),this.adjustHeight()},checkKeepPartsOfRenderer:function(){var a=this.getRendererStyle(this.renderer);if(this.attributeItem&&
this.attributeItem2&&!this.attributeItem3&&-1<dojo.indexOf(["colorsize","uniquesize"],a)){var b,c=this.getVisualVariableByType("colorInfo",null,this.renderer.visualVariables);b=this.getVisualVariableByType("sizeInfo",null,this.renderer.visualVariables);var k=this.getVisualVariableByType("opacityInfo",null,this.renderer.visualVariables),n=this.renderer.attributeField||this.renderer.field,v=c&&c.field,s=b&&b.field,f,g,h;this.renderer.authoringInfo&&(f=this.getVisualVariableByType("colorInfo",null,this.renderer.authoringInfo.visualVariables),
g=this.getVisualVariableByType("sizeInfo",null,this.renderer.authoringInfo.visualVariables),h=this.getVisualVariableByType("transparencyInfo",null,this.renderer.authoringInfo.visualVariables));if("colorsize"===a&&this.attributeItem.name===v){if(!this.isTypeString(this.attributeItem2)&&!this.attributeItem2.codedValues)return b={colorInfo:c,authColorInfo:f,opacityInfo:k,authOpacityInfo:h},this._select_colorsize(b),!0}else{if("colorsize"===a&&this.attributeItem2.name===s)return this.isTypeString(this.attributeItem)||
this.attributeItem.codedValues?(b={sizeInfo:b,authSizeInfo:g,opacityInfo:k,authOpacityInfo:h},this._select_uniquesize(b)):(b={sizeInfo:b,authSizeInfo:g,opacityInfo:k,authOpacityInfo:h},this._select_colorsize(b)),!0;if("uniquesize"===a&&this.attributeItem.name===s)return this.isTypeString(this.attributeItem2)||this.attributeItem2.codedValues?(b={sizeInfo:b,authSizeInfo:g,opacityInfo:k,authOpacityInfo:h},this._select_uniquesize(b)):(this.attributeItem.name!==this.attributeItem2.name&&(this._rendererAttribute.set("value",
this.attributeItem2.name,!1),this._rendererAttribute2.set("value",this.attributeItem.name,!1),a=this.attributeItem,this.attributeItem=this.attributeItem2,this.attributeItem2=a),b={sizeInfo:b,authSizeInfo:g,opacityInfo:k,authOpacityInfo:h},this._select_colorsize(b)),!0;if("uniquesize"===a&&this.attributeItem2.name===s)return this.isTypeString(this.attributeItem)||this.attributeItem.codedValues?(b={sizeInfo:b,authSizeInfo:g,opacityInfo:k,authOpacityInfo:h},this._select_uniquesize(b)):(b={sizeInfo:b,
authSizeInfo:g,opacityInfo:k,authOpacityInfo:h},this._select_colorsize(b)),!0;if("uniquesize"===a&&(this.attributeItem.name===n&&!this.isTypeString(this.attributeItem2)&&!this.attributeItem2.codedValues||this.attributeItem2.name===n&&!this.isTypeString(this.attributeItem)&&!this.attributeItem.codedValues))return b={types:!0,opacityInfo:k,authOpacityInfo:h},this._select_uniquesize(b),!0}}return!1},_onChangeAttribute:function(a){!this.disableAllEvents&&!(this.attributeItem&&this.attributeItem.name===
a)&&(this.changeAttribute(a),this.updateListQueued||(this.updateListQueued=!0,setTimeout(c.hitch(this,function(){delete this.updateListQueued;this.updateList()}),1E3)))},_onChangeAttribute2:function(a){!this.disableAllEvents&&!(this.attributeItem2&&this.attributeItem2.name===a)&&(this.changeAttribute2(a),this.updateListQueued||(this.updateListQueued=!0,setTimeout(c.hitch(this,function(){delete this.updateListQueued;this.updateList()}),1E3)))},_onChangeAttribute3:function(a){!this.disableAllEvents&&
!(this.attributeItem3&&this.attributeItem3.name===a)&&(this.changeAttribute3(a),this.updateListQueued||(this.updateListQueued=!0,setTimeout(c.hitch(this,function(){delete this.updateListQueued;this.updateList()}),1E3)))},_onChangeAttribute4:function(a){!this.disableAllEvents&&!(this.attributeItem4&&this.attributeItem4.name===a)&&(this.changeAttribute4(a),this.updateListQueued||(this.updateListQueued=!0,setTimeout(c.hitch(this,function(){delete this.updateListQueued;this.updateList()}),1E3)))},_onChangeAttribute5:function(a){!this.disableAllEvents&&
!(this.attributeItem5&&this.attributeItem5.name===a)&&(this.changeAttribute5(a),this.updateListQueued||(this.updateListQueued=!0,setTimeout(c.hitch(this,function(){delete this.updateListQueued;this.updateList()}),1E3)))},_onAddAttributeClick:function(a){var c="none"!==b.get(this._rendererAttributeDiv2,"display"),d="none"!==b.get(this._rendererAttributeDiv3,"display"),k="none"!==b.get(this._rendererAttributeDiv4,"display");b.get(this._rendererAttributeDiv5,"display");c&&d&&k?(b.set(this._rendererAddAttribute,
"display","none"),b.set(this._rendererAttributeDiv5,"display",""),b.set(this._rendererSwitchAttribute12,"display","none")):c&&d?(4<this.attributesCount.number?b.set(this._rendererAddAttribute,"display",""):b.set(this._rendererAddAttribute,"display","none"),b.set(this._rendererAttributeDiv4,"display",""),b.set(this._rendererSwitchAttribute12,"display","none")):c?(this.showPredominance&&!this.isTypeString(this.attributeItem)&&!this.isTypeString(this.attributeItem2)&&3<this.attributesCount.number?b.set(this._rendererAddAttribute,
"display",""):b.set(this._rendererAddAttribute,"display","none"),b.set(this._rendererAttributeDiv3,"display",""),b.set(this._rendererSwitchAttribute12,"display","none")):(this.showPredominance&&2<this.attributesCount.number?b.set(this._rendererAddAttribute,"display",""):b.set(this._rendererAddAttribute,"display","none"),b.set(this._rendererAttributeDiv2,"display",""));this.updateAttributeDropdowns(a)},changeAttribute:function(a){if(!this.disableAllEvents){delete this.allUniqueValues;delete this.attributeItem;
this.savedRenderers={};var e="none"!==b.get(this._rendererAttributeDiv2,"display"),d="none"!==b.get(this._rendererAttributeDiv3,"display"),k="none"!==b.get(this._rendererAttributeDiv4,"display"),n="none"!==b.get(this._rendererAttributeDiv5,"display");a=this._rendererAttribute.get("value");"showLocationOnly"===a?(e&&this._onRemoveAttribute2Click(),d&&this._onRemoveAttribute3Click(),k&&this._onRemoveAttribute4Click(),n&&this._onRemoveAttribute5Click(),b.set(this._rendererAddAttribute,"display","none")):
this.attributesStore.fetchItemByIdentity({identity:a,onItem:c.hitch(this,function(a){this.attributeItem=a=this.clean(a);if(!this.style||!this.setupStyleFromURL())"multiple"===this.attributeItem.type.toString()?e&&this._onRemoveAttribute2Click():a.codedValues?0<this.attributesCount.number&&(!e&&!this.hasDynamic?b.set(this._rendererAddAttribute,"display",""):this.updateAttributeDropdowns()):("esriFieldTypeInteger"==this.attributeItem.type||"esriFieldTypeDouble"==this.attributeItem.type||"esriFieldTypeSingle"==
this.attributeItem.type||"esriFieldTypeSmallInteger"==this.attributeItem.type)&&this.layer.objectIdField!==this.attributeItem.name?e?this.updateAttributeDropdowns():this.hasDynamic||b.set(this._rendererAddAttribute,"display",""):"esriFieldTypeDate"==a.type?(e&&this._onRemoveAttribute2Click(),d&&this._onRemoveAttribute3Click(),k&&this._onRemoveAttribute4Click(),n&&this._onRemoveAttribute5Click(),b.set(this._rendererAddAttribute,"display","none")):0<this.attributesCount.number&&(e?("esriFieldTypeString"==
this.attributeItem2.type?(this._onRemoveAttribute2Click(),d&&this._onRemoveAttribute3Click(),k&&this._onRemoveAttribute4Click(),n&&this._onRemoveAttribute5Click()):(d&&this._onRemoveAttribute3Click(),k&&this._onRemoveAttribute4Click(),n&&this._onRemoveAttribute5Click(),b.set(this._rendererAddAttribute,"display","none")),this.updateAttributeDropdowns()):this.hasDynamic||b.set(this._rendererAddAttribute,"display",""))})})}},changeAttribute2:function(a){delete this.attributeItem2;this.savedRenderers=
{};this.attributesStore.fetchItemByIdentity({identity:this._rendererAttribute2.get("value"),onItem:c.hitch(this,function(a){this.attributeItem2=a=this.clean(a);this.updateAttributeDropdowns();!this.attributeItem3&&(this.isTypeString(this.attributeItem)||this.isTypeString(this.attributeItem2)||this.attributeItem.codedValues||this.attributeItem.codedValues)?(b.set(this._rendererSwitchAttribute12,"display","none"),a="none"!==b.get(this._rendererAttributeDiv3,"display"),this.showPredominance&&!a&&(this.isTypeString(this.attributeItem)&&
2<this.attributesCount.number||3<this.attributesCount.number)?b.set(this._rendererAddAttribute,"display",""):b.set(this._rendererAddAttribute,"display","none")):this.attributeItem3?b.set(this._rendererSwitchAttribute12,"display","none"):(this.attributeItem.name!==this.attributeItem2.name?b.set(this._rendererSwitchAttribute12,"display",""):b.set(this._rendererSwitchAttribute12,"display","none"),a="none"!==b.get(this._rendererAttributeDiv3,"display"),this.showPredominance&&3<this.attributesCount.number&&
!a?b.set(this._rendererAddAttribute,"display",""):b.set(this._rendererAddAttribute,"display","none"))})})},changeAttribute3:function(a){delete this.attributeItem3;this.savedRenderers={};this.attributesStore.fetchItemByIdentity({identity:this._rendererAttribute3.get("value"),onItem:c.hitch(this,function(a){this.attributeItem3=a=this.clean(a)})})},changeAttribute4:function(a){delete this.attributeItem4;this.savedRenderers={};this.attributesStore.fetchItemByIdentity({identity:this._rendererAttribute4.get("value"),
onItem:c.hitch(this,function(a){this.attributeItem4=a=this.clean(a)})})},changeAttribute5:function(a){delete this.attributeItem5;this.savedRenderers={};this.attributesStore.fetchItemByIdentity({identity:this._rendererAttribute5.get("value"),onItem:c.hitch(this,function(a){this.attributeItem5=a=this.clean(a)})})},updateAttributeDropdowns:function(a){if(this.attributeItem){var c="none"!==b.get(this._rendererAttributeDiv2,"display"),d="none"!==b.get(this._rendererAttributeDiv3,"display");a="none"!==
b.get(this._rendererAttributeDiv4,"display");var k="none"!==b.get(this._rendererAttributeDiv5,"display");this.isTypeString(this.attributeItem)?(delete this.attributeItem3,delete this.attributeItem4,delete this.attributeItem5,b.set(this._rendererAttributeDiv3,"display","none"),b.set(this._rendererAttributeDiv4,"display","none"),b.set(this._rendererAttributeDiv5,"display","none"),b.set(this._rendererAddAttribute,"display","none"),this.attributeItem2?this.isTypeString(this.attributeItem2)||this.attributeItem2.codedValues?
(delete this.attributeItem2,b.set(this._rendererAttributeDiv2,"display","none"),b.set(this._rendererAddAttribute,"display","")):(this._rendererAttribute2.setStore(this.attributesStore,"",{query:"NOT type:'none' AND NOT type:'total' AND NOT type:'blank' AND NOT type:'percent' AND NOT type:'showLocationOnly' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeDate' AND NOT type:'esriFieldTypeString' AND hasCodedValues:'false' AND NOT name:'"+this.layer.objectIdField+
"'"}),this._rendererAttribute2.set("value",this.attributeItem2.name)):c?(c=this._rendererAttribute2.get("value"),this._rendererAttribute2.setStore(this.attributesStore,"",{query:"NOT type:'none' AND NOT type:'total' AND NOT type:'blank' AND NOT type:'percent' AND NOT type:'showLocationOnly' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeDate' AND NOT type:'esriFieldTypeString' AND hasCodedValues:'false' AND NOT name:'"+this.layer.objectIdField+"'"}),
this._rendererAttribute2.options[0].value===c&&this._onChangeAttribute2(this._rendererAttribute2.get("value"))):b.set(this._rendererAddAttribute,"display","")):!this.attributeItem2||this.attributeItem2&&!this.attributeItem3?(this._rendererAttribute2.setStore(this.attributesStore,"",{query:"NOT type:'none' AND NOT type:'total' AND NOT type:'blank' AND NOT type:'percent' AND NOT type:'showLocationOnly' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeDate' AND NOT name:'"+
this.layer.objectIdField+"'"}),this.attributeItem2?this._rendererAttribute2.set("value",this.attributeItem2.name):this._rendererAttribute2.options[0].value===this.attributeItem.name&&1<this._rendererAttribute2.options.length?this._rendererAttribute2.set("value",this._rendererAttribute2.options[1].value):this._onChangeAttribute2(this._rendererAttribute2.get("value")),this.attributeItem2&&(!this.attributeItem3&&d)&&(c=this._rendererAttribute3.options.length?this._rendererAttribute3.options[0].value:
null,this._rendererAttribute3.setStore(this.attributesStore,"",{query:"NOT type:'none' AND NOT type:'total' AND NOT type:'blank' AND NOT type:'percent' AND NOT type:'showLocationOnly' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeDate' AND NOT type:'esriFieldTypeString' AND hasCodedValues:'false' AND NOT name:'"+this.layer.objectIdField+"' AND NOT name:'"+this.attributeItem.name+"' AND NOT name:'"+this.attributeItem2.name+"'"}),c&&this._rendererAttribute3.options[0].value===
c&&this._onChangeAttribute3(this._rendererAttribute3.get("value")))):(this._rendererAttribute2.setStore(this.attributesStore,"",{query:"NOT type:'none' AND NOT type:'total' AND NOT type:'blank' AND NOT type:'percent' AND NOT type:'showLocationOnly' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeDate' AND NOT type:'esriFieldTypeString' AND hasCodedValues:'false' AND NOT name:'"+this.layer.objectIdField+"' AND NOT name:'"+this.attributeItem.name+"'"}),
this.attributeItem2?!this.isTypeString(this.attributeItem2)&&!this.attributeItem2.codedValues?this._rendererAttribute2.set("value",this.attributeItem2.name):(delete this.attributeItem2,this._onChangeAttribute2(this._rendererAttribute2.get("value"))):this._onChangeAttribute2(this._rendererAttribute2.get("value")),d&&(c=this._rendererAttribute3.options.length?this._rendererAttribute3.options[0].value:null,this._rendererAttribute3.setStore(this.attributesStore,"",{query:"NOT type:'none' AND NOT type:'total' AND NOT type:'blank' AND NOT type:'percent' AND NOT type:'showLocationOnly' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeDate' AND NOT type:'esriFieldTypeString' AND hasCodedValues:'false' AND NOT name:'"+
this.layer.objectIdField+"' AND NOT name:'"+this.attributeItem.name+"' AND NOT name:'"+this.attributeItem2.name+"'"}),c&&this._rendererAttribute3.options[0].value===c&&this._onChangeAttribute3(this._rendererAttribute3.get("value")),a&&(c=this._rendererAttribute4.options.length?this._rendererAttribute4.options[0].value:null,this._rendererAttribute4.setStore(this.attributesStore,"",{query:"NOT type:'none' AND NOT type:'total' AND NOT type:'blank' AND NOT type:'percent' AND NOT type:'showLocationOnly' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeDate' AND NOT type:'esriFieldTypeString' AND hasCodedValues:'false' AND NOT name:'"+
this.layer.objectIdField+"' AND NOT name:'"+this.attributeItem.name+"' AND NOT name:'"+this.attributeItem2.name+"' AND NOT name:'"+this.attributeItem3.name+"'"}),c&&this._rendererAttribute4.options[0].value===c&&this._onChangeAttribute4(this._rendererAttribute4.get("value")),k&&(c=this._rendererAttribute5.options.length?this._rendererAttribute5.options[0].value:null,this._rendererAttribute5.setStore(this.attributesStore,"",{query:"NOT type:'none' AND NOT type:'total' AND NOT type:'blank' AND NOT type:'percent' AND NOT type:'showLocationOnly' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeDate' AND NOT type:'esriFieldTypeString' AND hasCodedValues:'false' AND NOT name:'"+
this.layer.objectIdField+"' AND NOT name:'"+this.attributeItem.name+"' AND NOT name:'"+this.attributeItem2.name+"' AND NOT name:'"+this.attributeItem3.name+"' AND NOT name:'"+this.attributeItem4.name+"'"}),c&&this._rendererAttribute5.options[0].value===c&&this._onChangeAttribute5(this._rendererAttribute5.get("value"))))));h.publish("updateAttributeDropdownsFinished")}},_onRemoveAttribute2Click:function(){this.attributeItem5?(this.attributeItem2=this.attributeItem3,this.attributeItem3=this.attributeItem4,
this.attributeItem4=this.attributeItem5,delete this.attributeItem5,this._rendererAttribute2.set("value",this.attributeItem2.name),this._rendererAttribute3.set("value",this.attributeItem3.name),this._rendererAttribute4.set("value",this.attributeItem4.name),b.set(this._rendererAddAttribute,"display",""),b.set(this._rendererAttributeDiv5,"display","none")):this.attributeItem4?(this.attributeItem2=this.attributeItem3,this.attributeItem3=this.attributeItem4,delete this.attributeItem4,this._rendererAttribute2.set("value",
this.attributeItem2.name),this._rendererAttribute3.set("value",this.attributeItem3.name),b.set(this._rendererAddAttribute,"display",""),b.set(this._rendererAttributeDiv4,"display","none")):this.attributeItem3?(this.attributeItem2=this.attributeItem3,delete this.attributeItem3,this._rendererAttribute2.set("value",this.attributeItem2.name),b.set(this._rendererAddAttribute,"display",""),b.set(this._rendererAttributeDiv3,"display","none"),this.attributeItem.name!==this.attributeItem2.name?b.set(this._rendererSwitchAttribute12,
"display",""):b.set(this._rendererSwitchAttribute12,"display","none")):(delete this.attributeItem2,b.set(this._rendererAddAttribute,"display",""),b.set(this._rendererAttributeDiv2,"display","none"),b.set(this._rendererSwitchAttribute12,"display","none"),this.changeAttribute());this.updateList()},_onRemoveAttribute3Click:function(){this.attributeItem5?(this.attributeItem3=this.attributeItem4,this.attributeItem4=this.attributeItem5,delete this.attributeItem5,this._rendererAttribute3.set("value",this.attributeItem3.name),
this._rendererAttribute4.set("value",this.attributeItem4.name),b.set(this._rendererAddAttribute,"display",""),b.set(this._rendererAttributeDiv5,"display","none")):this.attributeItem4?(this.attributeItem3=this.attributeItem4,delete this.attributeItem4,this._rendererAttribute3.set("value",this.attributeItem3.name),b.set(this._rendererAddAttribute,"display",""),b.set(this._rendererAttributeDiv4,"display","none")):this.attributeItem3&&(delete this.attributeItem3,b.set(this._rendererAddAttribute,"display",
""),b.set(this._rendererAttributeDiv3,"display","none"),this.attributeItem.name!==this.attributeItem2.name?b.set(this._rendererSwitchAttribute12,"display",""):b.set(this._rendererSwitchAttribute12,"display","none"),this.changeAttribute2());this.updateList()},_onRemoveAttribute4Click:function(){this.attributeItem5?(this.attributeItem4=this.attributeItem5,delete this.attributeItem5,this._rendererAttribute4.set("value",this.attributeItem4.name),b.set(this._rendererAddAttribute,"display",""),b.set(this._rendererAttributeDiv5,
"display","none")):this.attributeItem4&&(delete this.attributeItem4,b.set(this._rendererAddAttribute,"display",""),b.set(this._rendererAttributeDiv4,"display","none"),this.changeAttribute3());this.updateList()},_onRemoveAttribute5Click:function(){b.set(this._rendererAddAttribute,"display","");b.set(this._rendererAttributeDiv5,"display","none");delete this.attributeItem5;this.changeAttribute4();this.updateList()},_onSwitchAttributeClick:function(){delete this.attributeItem;delete this.attributeItem2;
var a=this._rendererAttribute.get("value"),b=this._rendererAttribute2.get("value");this._rendererAttribute.set("value",b);var d=h.subscribe("updateAttributeDropdownsFinished",c.hitch(this,function(){h.unsubscribe(d);this._rendererAttribute2.set("value",a)}))},setupStyleFromURL:function(){this.buildList(this.style);this.setTypeOptions();if("simple"===this.style)return this._select_simple(),delete this.style,!0;if("type"===this.style&&this._vars.unique&&"none"!==b.get(this._vars.unique.root,"display"))return this._select_unique(),
delete this.style,!0;if("color"===this.style&&this._vars.color&&"none"!==b.get(this._vars.color.root,"display"))return this._select_color(),delete this.style,!0;if("size"===this.style&&this._vars.size&&"none"!==b.get(this._vars.size.root,"display"))return this._select_size(),delete this.style,!0;if("heatMap"===this.style&&this._vars.heatMap&&"none"!==b.get(this._vars.heatMap.root,"display"))return this._select_heatMap(),delete this.style,!0;delete this.style;return!1},_select_simple:function(){this.resetTypeOptionsClearCheck();
b.set(this._vars.simple.select,"display","none");b.set(this._vars.simple.options,"display","");b.set(this._vars.simple.check,"display","");f.add(this._vars.simple.title,"checked");this.saveCurrentRenderer();this.savedRenderers.simple?(this.renderer=l.fromJson(this.savedRenderers.simple.renderer),this.scheme=this.savedRenderers.simple.scheme,this.authoringInfo=c.clone(this.renderer.authoringInfo),this.applySimpleRenderer(this.renderer),this.setOpacity(this.savedRenderers.simple.opacity)):(this.scheme=
null,this.buildSimpleRenderer().then(c.hitch(this,function(a){this.renderer=a;this.applySimpleRenderer(a);this.savedRenderers.simple={renderer:a.toJson(),scheme:this.scheme}}),c.hitch(this,function(){this.updateUIWithRenderer();this.adjustHeight()})))},_select_unique:function(){this.getAttributeItem().then(c.hitch(this,function(a){this.attributeItem=a;this.resetTypeOptionsClearCheck();b.set(this._vars.unique.select,"display","none");b.set(this._vars.unique.options,"display","");b.set(this._vars.unique.check,
"display","");f.add(this._vars.unique.title,"checked");this.saveCurrentRenderer();this.savedRenderers.type?(this.renderer=l.fromJson(this.savedRenderers.type.renderer),this.scheme=this.savedRenderers.type.scheme,this.authoringInfo=c.clone(this.renderer.authoringInfo),this.applyUniqueRenderer(this.renderer),this.setOpacity(this.savedRenderers.type.opacity)):(this.scheme=null,this.buildUniqueRenderer().then(c.hitch(this,function(a){this.hideBusy();this.lastUniqueDefaultLabel=this.lastUniqueDefaultSymbol=
null;this.renderer=a;this.savedRenderers.type={renderer:a.toJson(),scheme:this.scheme};this.applyUniqueRenderer(a)}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)})))}))},_select_color:function(){this.getAttributeItem().then(c.hitch(this,function(a){this.attributeItem=a;this.resetTypeOptionsClearCheck();b.set(this._vars.color.select,"display","none");b.set(this._vars.color.options,"display","");b.set(this._vars.color.check,
"display","");f.add(this._vars.color.title,"checked");this.saveCurrentRenderer();if(this.savedRenderers.color){a=l.fromJson(this.savedRenderers.color.renderer);var e=this.getVisualVariableByType("colorInfo",null,this.renderer.visualVariables);this.scheme=y.getSchemes({theme:e&&e.theme?e.theme:"high-to-low",basemap:this.getBasemapType(),geometryType:this.geometryType}).primaryScheme;this.renderer=this.updateSchemeOnColorRenderer({scheme:this.scheme,renderer:a});this.authoringInfo=c.clone(this.renderer.authoringInfo);
this.applyColorRenderer(this.renderer);(this.savedRenderers.color.scheme&&this.savedRenderers.color.scheme.id===this.scheme.id||!this.savedRenderers.color.scheme)&&this.setOpacity(this.savedRenderers.color.opacity)}else this.scheme=null,this.buildColorRenderer({classificationMethod:"natural-breaks"}).then(c.hitch(this,function(a){a=a.renderer;this.hideBusy();this.renderer=a;a.authoringInfo=this.authoringInfo?c.clone(this.authoringInfo):a.authoringInfo;this.savedRenderers.color={renderer:a.toJson(),
scheme:this.scheme};this.applyColorRenderer(a)}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)}))}))},_select_size:function(){this.getAttributeItem().then(c.hitch(this,function(a){this.attributeItem=a;this.resetTypeOptionsClearCheck();b.set(this._vars.size.select,"display","none");b.set(this._vars.size.options,"display","");b.set(this._vars.size.check,"display","");f.add(this._vars.size.title,"checked");
this.saveCurrentRenderer();this.savedRenderers.size?(this.renderer=l.fromJson(this.savedRenderers.size.renderer),this.scheme=this.savedRenderers.size.scheme,this.authoringInfo=c.clone(this.renderer.authoringInfo),this.applySizeRenderer(this.renderer),this.setOpacity(this.savedRenderers.size.opacity)):(this.scheme=null,this.buildSizeRenderer({classificationMethod:"natural-breaks"}).then(c.hitch(this,function(a){a=a.renderer;this.hideBusy();this.renderer=a;a.authoringInfo=this.authoringInfo?c.clone(this.authoringInfo):
a.authoringInfo;this.savedRenderers.size={renderer:a.toJson(),scheme:this.scheme};this.applySizeRenderer(a)}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)})))}))},_select_density:function(){alert("not yet implemented")},_select_heatMap:function(){var a=c.hitch(this,function(a){this.resetTypeOptionsClearCheck();b.set(this._vars.heatMap.select,"display","none");b.set(this._vars.heatMap.options,"display",
"");b.set(this._vars.heatMap.check,"display","");f.add(this._vars.heatMap.title,"checked");this.saveCurrentRenderer();this.savedRenderers.heatMap?(this.renderer=l.fromJson(this.savedRenderers.heatMap.renderer),this.scheme=this.savedRenderers.heatMap.scheme,this.authoringInfo=c.clone(this.renderer.authoringInfo),this.applyHeatMapRenderer(this.renderer),this.setOpacity(this.savedRenderers.heatMap.opacity)):(this.scheme=null,this.buildHeatMapRenderer(a).then(c.hitch(this,function(a){this.hideBusy();
this.renderer=a;this.savedRenderers.heatMap={renderer:a.toJson(),scheme:this.scheme};this.applyHeatMapRenderer(a)}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)})))});this.getAttributeItem().then(c.hitch(this,function(b){var d={};this.renderer instanceof K?(this.attributeItem=b,d.field=this.attributeItem.name,a(d)):"esriFieldTypeInteger"==b.type||"esriFieldTypeDouble"==b.type||"esriFieldTypeSingle"==
b.type||"esriFieldTypeSmallInteger"==b.type?this.hasDataNegativeValues(this.layer,b).then(c.hitch(this,function(c){c||(this.attributeItem=b,d.field=this.attributeItem.name);a(d)})):a(d)}))},_select_predominance:function(){var a=c.hitch(this,function(){this.resetTypeOptionsClearCheck();b.set(this._vars.predominance.select,"display","none");b.set(this._vars.predominance.options,"display","");b.set(this._vars.predominance.check,"display","");f.add(this._vars.predominance.title,"checked");this.saveCurrentRenderer();
this.savedRenderers.predominance?(this.renderer=l.fromJson(this.savedRenderers.predominance.renderer),this.scheme=this.savedRenderers.predominance.scheme,this.authoringInfo=c.clone(this.renderer.authoringInfo),this.applyPredominanceRenderer(this.renderer),this.setOpacity(this.savedRenderers.predominance.opacity)):(this.scheme=null,this.buildPredominanceRenderer().then(c.hitch(this,function(a){this.hideBusy();this.lastUniqueDefaultLabel=this.lastUniqueDefaultSymbol=null;this.renderer=a;this.savedRenderers.predominance=
{renderer:a.toJson(),scheme:this.scheme};this.applyPredominanceRenderer(a)}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)})))}),e="none"!==b.get(this._rendererAttributeDiv3,"display"),d="none"!==b.get(this._rendererAttributeDiv4,"display"),k="none"!==b.get(this._rendererAttributeDiv5,"display");this.getAttributeItem().then(c.hitch(this,function(b){this.attributeItem=b;this.getAttributeItem2().then(c.hitch(this,
function(b){this.attributeItem2=b;e?this.getAttributeItem3().then(c.hitch(this,function(b){this.attributeItem3=b;d?this.getAttributeItem4().then(c.hitch(this,function(b){this.attributeItem4=b;k?this.getAttributeItem5().then(c.hitch(this,function(b){this.attributeItem5=b;a()})):a()})):a()})):a()}))}))},_select_predominancesize:function(){var a=c.hitch(this,function(){this.resetTypeOptionsClearCheck();b.set(this._vars.predominancesize.select,"display","none");b.set(this._vars.predominancesize.options,
"display","");b.set(this._vars.predominancesize.check,"display","");f.add(this._vars.predominancesize.title,"checked");this.saveCurrentRenderer();this.savedRenderers.predominancesize?(this.renderer=l.fromJson(this.savedRenderers.predominancesize.renderer),this.scheme=this.savedRenderers.predominancesize.scheme,this.authoringInfo=c.clone(this.renderer.authoringInfo),this.applyPredominanceRenderer(this.renderer),this.setOpacity(this.savedRenderers.predominancesize.opacity)):(this.scheme=null,this.buildPredominanceRenderer().then(c.hitch(this,
function(a){this.buildSizeInfo({classificationMethod:"natural-breaks",attributeItem:this.getFieldForSizeRenderer(),statistics:null,scheme:null}).then(c.hitch(this,function(b){this.replaceVisualVariable("sizeInfo",null,b.sizeInfo,a);this.authoringInfo=b.authoringInfo;a.authoringInfo=c.clone(this.authoringInfo);"esriGeometryPolygon"===this.geometryType&&(g.forEach(a.infos,function(a){a.symbol=this.convertFillToMarkerSymbol(a.symbol)},this),a.backgroundFillSymbol=b.backgroundFillSymbol);this.hideBusy();
this.lastUniqueDefaultLabel=this.lastUniqueDefaultSymbol=null;this.renderer=a;this.savedRenderers.predominancesize={renderer:a.toJson(),scheme:this.scheme};this.applyPredominanceRenderer(a)}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)}))}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)})))}),e=
"none"!==b.get(this._rendererAttributeDiv3,"display"),d="none"!==b.get(this._rendererAttributeDiv4,"display"),k="none"!==b.get(this._rendererAttributeDiv5,"display");this.getAttributeItem().then(c.hitch(this,function(b){this.attributeItem=b;this.getAttributeItem2().then(c.hitch(this,function(b){this.attributeItem2=b;e?this.getAttributeItem3().then(c.hitch(this,function(b){this.attributeItem3=b;d?this.getAttributeItem4().then(c.hitch(this,function(b){this.attributeItem4=b;k?this.getAttributeItem5().then(c.hitch(this,
function(b){this.attributeItem5=b;a()})):a()})):a()})):a()}))}))},_select_colorsize:function(a){this.getAttributeItem().then(c.hitch(this,function(e){this.attributeItem=e;this.getAttributeItem2().then(c.hitch(this,function(d){this.attributeItem2=d;if(a)if(this.buildList("colorsize"),this.setTypeOptions(),this.resetTypeOptionsClearCheck(),b.set(this._vars.colorsize.select,"display","none"),this._vars.colorsize.optionsButton.set("disabled",!0),b.set(this._vars.colorsize.options,"display",""),b.set(this._vars.colorsize.check,
"display",""),f.add(this._vars.colorsize.title,"checked"),a.colorInfo)this.buildSizeRenderer({classificationMethod:"natural-breaks",attributeItem:this.isTypeString(this.attributeItem2)||this.attributeItem2.codedValues?this.attributeItem:this.attributeItem2}).then(c.hitch(this,function(b){var d=b.renderer;this.replaceVisualVariable("colorInfo",null,a.colorInfo,d);a.authColorInfo&&(d.authoringInfo=d.authoringInfo||{},d.authoringInfo.visualVariables=d.authoringInfo.visualVariables||[],this.replaceVisualVariable("colorInfo",
null,a.authColorInfo,d.authoringInfo));a.opacityInfo&&(this.replaceVisualVariable("opacityInfo",null,a.opacityInfo,d),d.authoringInfo=d.authoringInfo||{},d.authoringInfo.visualVariables=d.authoringInfo.visualVariables||[],this.replaceVisualVariable("transparencyInfo",null,a.authOpacityInfo,d.authoringInfo));this.authoringInfo=c.clone(d.authoringInfo);d.attributeField=this.attributeItem.name;d.normalizationField=a.colorInfo.normalizationField;d.normalizationType=a.colorInfo.normalizationType;var e=
this.renderer.infos[0].symbol;b=d.infos[0];"esriGeometryPolygon"===this.geometryType?b.symbol=this.convertFillToMarkerSymbol(b.symbol,e.style,e.outline):"esriGeometryPolyline"===this.geometryType?b.symbol=b.symbol.setStyle(e.style):(b.symbol=b.symbol.setStyle(e.style),-1<dojo.indexOf(["circle","diamond","square"],b.symbol.style)&&-1<dojo.indexOf(["circle","diamond","square"],e.style)&&b.symbol.setOutline(e.outline));d.clearBreaks();d.addBreak(b);this.hideBusy();this.renderer=d;this.savedRenderers.colorsize=
{renderer:d.toJson(),scheme:this.scheme};this.applySizeRenderer(d);this._vars.colorsize.optionsButton.set("disabled",!1)}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)}));else{var e=this.renderer;"colorsize"===this.getRendererStyle(this.renderer)?this.buildColorInfo({classificationMethod:"natural-breaks",attributeItem:this.attributeItem,statistics:null,scheme:null}).then(c.hitch(this,function(a){this.replaceVisualVariable("colorInfo",
null,a.colorInfo,e);a=a.authoringInfo?this.getVisualVariableByType("colorInfo",null,a.authoringInfo.visualVariables):null;this.replaceVisualVariable("colorInfo",null,a,e.authoringInfo);this.authoringInfo=c.clone(e.authoringInfo);e.attributeField=this.attributeItem.name;e.normalizationField=null;e.normalizationType=null;a=this.renderer.infos[0].symbol;var b=e.infos[0];"esriGeometryPolygon"===this.geometryType?b.symbol=this.convertFillToMarkerSymbol(b.symbol,a.style,a.outline):"esriGeometryPolyline"===
this.geometryType?b.symbol=b.symbol.setStyle(a.style):(b.symbol=b.symbol.setStyle(a.style),-1<dojo.indexOf(["circle","diamond","square"],b.symbol.style)&&-1<dojo.indexOf(["circle","diamond","square"],a.style)&&b.symbol.setOutline(a.outline));e.clearBreaks();e.addBreak(b);this.hideBusy();this.renderer=e;this.savedRenderers.colorsize={renderer:e.toJson(),scheme:this.scheme};this.applySizeRenderer(e);this._vars.colorsize.optionsButton.set("disabled",!1)}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();
this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)})):(b.set(this._rendererSwitchAttribute12,"display",""),this.scheme=null,this.buildSizeRenderer({classificationMethod:"natural-breaks",attributeItem:this.attributeItem2}).then(c.hitch(this,function(b){var d=b.renderer;this.replaceVisualVariable("sizeInfo",null,a.sizeInfo,d);a.authSizeInfo&&(d.authoringInfo=d.authoringInfo||{},d.authoringInfo.visualVariables=d.authoringInfo.visualVariables||[],this.replaceVisualVariable("sizeInfo",
null,a.authSizeInfo,d.authoringInfo));a.opacityInfo&&(this.replaceVisualVariable("opacityInfo",null,a.opacityInfo,d),d.authoringInfo=d.authoringInfo||{},d.authoringInfo.visualVariables=d.authoringInfo.visualVariables||[],this.replaceVisualVariable("transparencyInfo",null,a.authOpacityInfo,d.authoringInfo));var e=this.renderer.infos[0].symbol;b=d.infos[0];"esriGeometryPolygon"===this.geometryType?b.symbol=this.convertFillToMarkerSymbol(b.symbol,e.style,e.outline):"esriGeometryPolyline"===this.geometryType?
b.symbol=b.symbol.setStyle(e.style):(b.symbol=b.symbol.setStyle(e.style),-1<dojo.indexOf(["circle","diamond","square"],b.symbol.style)&&-1<dojo.indexOf(["circle","diamond","square"],e.style)&&b.symbol.setOutline(e.outline));d.clearBreaks();d.addBreak(b);this.buildColorInfo({classificationMethod:"natural-breaks",attributeItem:this.attributeItem,statistics:this.attributeItem2.name===this.attributeItem.name?b.statistics:null,scheme:null}).then(c.hitch(this,function(a){this.replaceVisualVariable("colorInfo",
null,a.colorInfo,d);a=a.authoringInfo?this.getVisualVariableByType("colorInfo",null,a.authoringInfo.visualVariables):null;d.authoringInfo=d.authoringInfo||{};d.authoringInfo.visualVariables=d.authoringInfo.visualVariables||[];this.replaceVisualVariable("colorInfo",null,a,d.authoringInfo);this.authoringInfo=c.clone(d.authoringInfo);d.attributeField=this.attributeItem.name;this.hideBusy();this.renderer=d;this.savedRenderers.colorsize={renderer:d.toJson(),scheme:this.scheme};this.applySizeRenderer(d);
this._vars.colorsize.optionsButton.set("disabled",!1)}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)}))}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)})))}else if(this.resetTypeOptionsClearCheck(),b.set(this._vars.colorsize.select,"display","none"),this._vars.colorsize.optionsButton.set("disabled",
!0),b.set(this._vars.colorsize.options,"display",""),b.set(this._vars.colorsize.check,"display",""),f.add(this._vars.colorsize.title,"checked"),this.saveCurrentRenderer(),this.savedRenderers.colorsize){d=l.fromJson(this.savedRenderers.colorsize.renderer);var n=this.getVisualVariableByType("colorInfo",null,this.renderer.visualVariables);this.scheme=y.getSchemes({theme:n&&n.theme?n.theme:"high-to-low",basemap:this.getBasemapType(),geometryType:this.geometryType}).primaryScheme;this.renderer=e=this.updateSchemeOnColorRenderer({scheme:this.scheme,
renderer:d});this.authoringInfo=c.clone(this.renderer.authoringInfo);this.applyColorRenderer(this.renderer);(this.savedRenderers.colorsize.scheme&&this.savedRenderers.colorsize.scheme.id===this.scheme.id||!this.savedRenderers.colorsize.scheme)&&this.setOpacity(this.savedRenderers.colorsize.opacity);this._vars.colorsize.optionsButton.set("disabled",!1)}else this.scheme=null,this.buildSizeRenderer({classificationMethod:"natural-breaks",attributeItem:this.attributeItem2}).then(c.hitch(this,function(a){var b=
a.renderer;this.buildColorInfo({classificationMethod:"natural-breaks",attributeItem:this.attributeItem,statistics:this.attributeItem2.name===this.attributeItem.name?a.statistics:null,scheme:null}).then(c.hitch(this,function(a){this.replaceVisualVariable("colorInfo",null,a.colorInfo,b);a=a.authoringInfo?this.getVisualVariableByType("colorInfo",null,a.authoringInfo.visualVariables):null;this.replaceVisualVariable("colorInfo",null,a,this.authoringInfo);b.authoringInfo=c.clone(this.authoringInfo);b.attributeField=
this.attributeItem.name;this.hideBusy();this.renderer=b;this.savedRenderers.colorsize={renderer:b.toJson(),scheme:this.scheme};this.applySizeRenderer(b);this._vars.colorsize.optionsButton.set("disabled",!1)}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)}))}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",
a)}))}))}))},_select_uniquesize:function(a){this.getAttributeItem().then(c.hitch(this,function(e){this.attributeItem=e;this.getAttributeItem2().then(c.hitch(this,function(d){this.attributeItem2=d;if(a)if(this._vars.uniquesize.optionsButton.set("disabled",!0),a.types){var e=this.renderer;this.buildSizeInfo({classificationMethod:"natural-breaks",attributeItem:this.getFieldForSizeRenderer(),statistics:null,scheme:null}).then(c.hitch(this,function(a){this.replaceVisualVariable("sizeInfo",null,a.sizeInfo,
e);a=this.getVisualVariableByType("sizeInfo",null,a.authoringInfo.visualVariables);e.authoringInfo=e.authoringInfo||{};e.authoringInfo.visualVariables=e.authoringInfo.visualVariables||[];this.replaceVisualVariable("sizeInfo",null,a,e.authoringInfo);this.authoringInfo=c.clone(e.authoringInfo);this.hideBusy();this.lastUniqueDefaultLabel=this.lastUniqueDefaultSymbol=null;this.renderer=e;this.savedRenderers.uniquesize={renderer:e.toJson(),scheme:this.scheme};this.applyUniqueRenderer(e);this._vars.uniquesize.optionsButton.set("disabled",
!1)}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)}))}else"colorsize"===this.getRendererStyle(this.renderer)&&(this.buildList("uniquesize"),this.setTypeOptions(),this.resetTypeOptionsClearCheck(),b.set(this._vars.uniquesize.select,"display","none"),this._vars.uniquesize.optionsButton.set("disabled",!0),b.set(this._vars.uniquesize.options,"display",""),b.set(this._vars.uniquesize.check,"display",
""),f.add(this._vars.uniquesize.title,"checked"),b.set(this._rendererSwitchAttribute12,"display","none"),this.scheme=null),this.buildUniqueRenderer({attributeItem:this.getFieldForUniqueRenderer()}).then(c.hitch(this,function(b){this.buildSizeInfo({classificationMethod:"natural-breaks",attributeItem:this.getFieldForSizeRenderer(),statistics:null,scheme:null}).then(c.hitch(this,function(d){this.replaceVisualVariable("sizeInfo",null,a.sizeInfo,b);a.authSizeInfo&&(b.authoringInfo=b.authoringInfo||{},
b.authoringInfo.visualVariables=b.authoringInfo.visualVariables||[],this.replaceVisualVariable("sizeInfo",null,a.authSizeInfo,b.authoringInfo));var e=this.renderer.infos[0].symbol,f=[];g.forEach(b.infos,function(a){f.push(c.clone(a))});g.forEach(f,function(a){b.removeValue(a.value)});g.forEach(f,function(a){"esriGeometryPolygon"===this.geometryType?a.symbol=this.convertFillToMarkerSymbol(a.symbol,e.style,e.outline):"esriGeometryPolyline"===this.geometryType?a.symbol=a.symbol.setStyle(e.style):(a.symbol=
a.symbol.setStyle(e.style),-1<dojo.indexOf(["circle","diamond","square"],a.symbol.style)&&-1<dojo.indexOf(["circle","diamond","square"],e.style)&&a.symbol.setOutline(e.outline));b.addValue(a)},this);a.opacityInfo&&(this.replaceVisualVariable("opacityInfo",null,a.opacityInfo,b),b.authoringInfo=b.authoringInfo||{},b.authoringInfo.visualVariables=b.authoringInfo.visualVariables||[],this.replaceVisualVariable("transparencyInfo",null,a.authOpacityInfo,b.authoringInfo));this.authoringInfo=c.clone(b.authoringInfo);
"esriGeometryPolygon"===this.geometryType&&(g.forEach(b.infos,function(a){a.symbol=this.convertFillToMarkerSymbol(a.symbol,e.style,e.outline)},this),b.backgroundFillSymbol=d.backgroundFillSymbol);this.hideBusy();this.lastUniqueDefaultLabel=this.lastUniqueDefaultSymbol=null;this.renderer=b;this.savedRenderers.uniquesize={renderer:b.toJson(),scheme:this.scheme};this.applyUniqueRenderer(b);this._vars.uniquesize.optionsButton.set("disabled",!1)}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();
this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)}))}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)}));else this.resetTypeOptionsClearCheck(),b.set(this._vars.uniquesize.select,"display","none"),this._vars.uniquesize.optionsButton.set("disabled",!0),b.set(this._vars.uniquesize.options,"display",""),b.set(this._vars.uniquesize.check,"display",""),f.add(this._vars.uniquesize.title,
"checked"),this.saveCurrentRenderer(),this.savedRenderers.uniquesize?(this.renderer=l.fromJson(this.savedRenderers.uniquesize.renderer),this.scheme=this.savedRenderers.uniquesize.scheme,this.authoringInfo=c.clone(this.renderer.authoringInfo),this.applyUniqueRenderer(this.renderer),this.setOpacity(this.savedRenderers.uniquesize.opacity),this._vars.uniquesize.optionsButton.set("disabled",!1)):(this.scheme=null,this.buildUniqueRenderer({attributeItem:this.getFieldForUniqueRenderer()}).then(c.hitch(this,
function(a){this.buildSizeInfo({classificationMethod:"natural-breaks",attributeItem:this.getFieldForSizeRenderer(),statistics:null,scheme:null}).then(c.hitch(this,function(b){this.replaceVisualVariable("sizeInfo",null,b.sizeInfo,a);this.authoringInfo=b.authoringInfo;a.authoringInfo=c.clone(this.authoringInfo);"esriGeometryPolygon"===this.geometryType&&(g.forEach(a.infos,function(a){a.symbol=this.convertFillToMarkerSymbol(a.symbol)},this),a.backgroundFillSymbol=b.backgroundFillSymbol);this.hideBusy();
this.lastUniqueDefaultLabel=this.lastUniqueDefaultSymbol=null;this.renderer=a;this.savedRenderers.uniquesize={renderer:a.toJson(),scheme:this.scheme};this.applyUniqueRenderer(a);this._vars.uniquesize.optionsButton.set("disabled",!1)}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)}))}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",
a)})))}))}))},_select_watercolor:function(){var a=c.hitch(this,function(){this.resetTypeOptionsClearCheck();b.set(this._vars.watercolor.select,"display","none");b.set(this._vars.watercolor.options,"display","none");b.set(this._vars.watercolor.check,"display","");f.add(this._vars.watercolor.title,"checked");this.saveCurrentRenderer();this.savedRenderers.watercolor?(this.renderer=l.fromJson(this.savedRenderers.watercolor.renderer),this.scheme=this.savedRenderers.watercolor.scheme,this.authoringInfo=
c.clone(this.renderer.authoringInfo),this.applWatercolorRenderer(this.renderer),this.setOpacity(this.savedRenderers.watercolor.opacity)):(this.scheme=null,this.buildWatercolorRenderer().then(c.hitch(this,function(a){this.hideBusy();this.renderer=a;this.applyWatercolorRenderer(a)}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)})))}),e="none"!==b.get(this._rendererAttributeDiv3,"display"),d="none"!==
b.get(this._rendererAttributeDiv4,"display"),g="none"!==b.get(this._rendererAttributeDiv5,"display");this.getAttributeItem().then(c.hitch(this,function(b){this.attributeItem=b;this.getAttributeItem2().then(c.hitch(this,function(b){this.attributeItem2=b;e?this.getAttributeItem3().then(c.hitch(this,function(b){this.attributeItem3=b;d?this.getAttributeItem4().then(c.hitch(this,function(b){this.attributeItem4=b;g?this.getAttributeItem5().then(c.hitch(this,function(b){this.attributeItem5=b;a()})):a()})):
a()})):a()}))}))},_select_ratio:function(){this.getAttributeItem().then(c.hitch(this,function(a){this.attributeItem=a;this.resetTypeOptionsClearCheck();b.set(this._vars.ratio.select,"display","none");b.set(this._vars.ratio.options,"display","");b.set(this._vars.ratio.check,"display","");f.add(this._vars.ratio.title,"checked");this.saveCurrentRenderer();this.savedRenderers.ratio?(this.renderer=l.fromJson(this.savedRenderers.ratio.renderer),this.scheme=this.savedRenderers.ratio.scheme,this.authoringInfo=
c.clone(this.renderer.authoringInfo),this.applyRatioRenderer(this.renderer),this.setOpacity(this.savedRenderers.ratio.opacity)):(this.scheme=null,this.buildRatioRenderer().then(c.hitch(this,function(a){this.hideBusy();var b=a.renderer;this.renderer=a.renderer;b.authoringInfo=this.authoringInfo?c.clone(this.authoringInfo):b.authoringInfo;this.savedRenderers.ratio={renderer:b.toJson(),scheme:this.scheme};this.applyRatioRenderer(b)}),c.hitch(this,function(){this.hideBusy();this.updateUIWithRenderer();
this.adjustHeight()}),c.hitch(this,function(a){this.showBusy("rendererStack",a)})))}))},_select_cluster:function(){alert("not yet implemented")},_goToSimplePanel:function(){this.hideLegendPopup();this.rendererSimpleStack||(this.rendererSimpleStack=new u({id:"rendererSimpleStack",region:"top",style:"margin:0; padding:0;",splitter:!1,gutters:!1}));this.rendererSimplePanel&&this.rendererSimplePanel.destroy();var a=this.getVisualVariableByType("colorInfo",null,this.renderer.visualVariables),e=this.getVisualVariableByType("sizeInfo",
null,this.renderer.visualVariables);this.getAttributeItem(this.renderer.attributeField||this.renderer.field||a&&a.field||e&&e.field).then(c.hitch(this,function(a){"showLocationOnly"===a.name?a=null:this._rendererAttribute.set("value",a.name);!this.isGeoRSS&&!this.isSL&&(this.setTypeOptions(a),b.set(this._vars.simple.select,"display","none"),b.set(this._vars.simple.options,"display",""),b.set(this._vars.simple.check,"display",""),f.add(this._vars.simple.title,"checked"));this.rendererSimplePanel=new L({id:"rendererSimplePanel",
params:{portalPanel:this,subLayerId:this.subLayerId,mapLayer:this.mapLayer,layer:this.layer,fLayer:this.fLayer,renderer:l.fromJson(this.renderer.toJson()),geometryType:this.geometryType,origRenderer:this.origRenderer,isHosted:this.isHosted,isFeatColl:this.isFeatColl,isCSV:this.isCSV,isSL:this.isSL,isGeoRSS:this.isGeoRSS,isOwnerOfHostedFS:this.isOwnerOfHostedFS,hasDynamic:this.hasDynamic,attributesStore:this.attributesStore,hasNumericField:this.hasNumericField},containerNode:this.rendererSimpleStack,
region:"top"});leftPanel.sc.addChild(this.rendererSimpleStack);leftPanel.sc.startup();leftPanel.sc.selectChild(this.rendererSimpleStack);leftPanel.visibleStack="rendererSimpleStack";q.byId("rendererSimplePanel").adjustHeight()}))},_goToHeatMapPanel:function(){this.hideLegendPopup();this.rendererHeatMapStack||(this.rendererHeatMapStack=new u({id:"rendererHeatMapStack",region:"top",style:"margin:0; padding:0;",splitter:!1,gutters:!1}));this.rendererHeatMapPanel&&this.rendererHeatMapPanel.destroy();
this.getAttributeItem(this.renderer.field).then(c.hitch(this,function(a){"showLocationOnly"===a.name?a=null:this._rendererAttribute.set("value",a.name);this.setTypeOptions(a);b.set(this._vars.heatMap.select,"display","none");b.set(this._vars.heatMap.options,"display","");b.set(this._vars.heatMap.check,"display","");f.add(this._vars.heatMap.title,"checked");this.rendererHeatMapPanel=new M({id:"rendererHeatMapPanel",params:{portalPanel:this,subLayerId:this.subLayerId,mapLayer:this.mapLayer,layer:this.layer,
renderer:l.fromJson(this.renderer.toJson()),geometryType:this.geometryType,origRenderer:this.origRenderer,isHosted:this.isHosted,isFeatColl:this.isFeatColl,isCSV:this.isCSV,isSL:this.isSL,isOwnerOfHostedFS:this.isOwnerOfHostedFS,hasDynamic:this.hasDynamic,attributeItem:a,attributesStore:this.attributesStore,hasNumericField:this.hasNumericField},containerNode:this.rendererHeatMapStack,region:"top"});leftPanel.sc.addChild(this.rendererHeatMapStack);leftPanel.sc.startup();leftPanel.sc.selectChild(this.rendererHeatMapStack);
leftPanel.visibleStack="rendererHeatMapStack";q.byId("rendererHeatMapPanel").adjustHeight()}))},_goToColorSizePanel:function(){this.hideLegendPopup();this.rendererMultiAttributesStack||(this.rendererMultiAttributesStack=new u({id:"rendererMultiAttributesStack",region:"top",style:"margin:0; padding:0;",splitter:!1,gutters:!1}));this.rendererMultiAttributesPanel&&this.rendererMultiAttributesPanel.destroy();var a=this.renderer.attributeField||this.renderer.field||e&&e.field||d&&d.field,e=this.getVisualVariableByType("colorInfo",
null,this.renderer.visualVariables),d=this.getVisualVariableByType("sizeInfo",null,this.renderer.visualVariables),a=e?e.field:a;this.getAttributeItem(a).then(c.hitch(this,function(a){this._rendererAttribute.set("value",a.name);this.getAttributeItem(d.field).then(c.hitch(this,function(c){this._rendererAttribute2.set("value",c.name);this.setTypeOptions(a,c);b.set(this._vars.colorsize.select,"display","none");b.set(this._vars.colorsize.options,"display","");b.set(this._vars.colorsize.check,"display",
"");f.add(this._vars.colorsize.title,"checked");this.rendererMultiAttributesPanel=new z({id:"rendererMultiAttributesPanel",params:{portalPanel:this,subLayerId:this.subLayerId,mapLayer:this.mapLayer,layer:this.layer,fLayer:this.fLayer,renderer:l.fromJson(this.renderer.toJson()),geometryType:this.geometryType,origRenderer:this.origRenderer,isHosted:this.isHosted,isFeatColl:this.isFeatColl,isCSV:this.isCSV,isSL:this.isSL,isOwnerOfHostedFS:this.isOwnerOfHostedFS,hasDynamic:this.hasDynamic,attributeItem:a,
attributeItem2:c,attributesStore:this.attributesStore,hasNumericField:this.hasNumericField},containerNode:this.rendererMultiAttributesStack,region:"top"});leftPanel.sc.addChild(this.rendererMultiAttributesStack);leftPanel.sc.startup();leftPanel.sc.selectChild(this.rendererMultiAttributesStack);leftPanel.visibleStack="rendererMultiAttributesStack";q.byId("rendererMultiAttributesPanel").adjustHeight()}))}))},_goToUniqueSizePanel:function(){this.hideLegendPopup();this.rendererMultiAttributesStack||(this.rendererMultiAttributesStack=
new u({id:"rendererMultiAttributesStack",region:"top",style:"margin:0; padding:0;",splitter:!1,gutters:!1}));this.rendererMultiAttributesPanel&&this.rendererMultiAttributesPanel.destroy();var a=this.renderer.attributeField||this.renderer.field||visVarColor&&visVarColor.field||e&&e.field,e=this.getVisualVariableByType("sizeInfo",null,this.renderer.visualVariables);this.getAttributeItem(a).then(c.hitch(this,function(a){this.getAttributeItem(e.field).then(c.hitch(this,function(c){this.setTypeOptions(a,
c);b.set(this._vars.uniquesize.select,"display","none");b.set(this._vars.uniquesize.options,"display","");b.set(this._vars.uniquesize.check,"display","");f.add(this._vars.uniquesize.title,"checked");this.rendererMultiAttributesPanel=new z({id:"rendererMultiAttributesPanel",params:{portalPanel:this,subLayerId:this.subLayerId,mapLayer:this.mapLayer,layer:this.layer,fLayer:this.fLayer,renderer:l.fromJson(this.renderer.toJson()),geometryType:this.geometryType,origRenderer:this.origRenderer,isHosted:this.isHosted,
isFeatColl:this.isFeatColl,isCSV:this.isCSV,isSL:this.isSL,isOwnerOfHostedFS:this.isOwnerOfHostedFS,hasDynamic:this.hasDynamic,attributeItem:a,attributeItem2:c,attributesStore:this.attributesStore,hasNumericField:this.hasNumericField},containerNode:this.rendererMultiAttributesStack,region:"top"});leftPanel.sc.addChild(this.rendererMultiAttributesStack);leftPanel.sc.startup();leftPanel.sc.selectChild(this.rendererMultiAttributesStack);leftPanel.visibleStack="rendererMultiAttributesStack";q.byId("rendererMultiAttributesPanel").adjustHeight()}))}))},
_goToRatioPanel:function(){this.hideLegendPopup();var a=q.byId("rendererRatioStack");this.rendererRatioStack=a?a:new u({id:"rendererRatioStack",region:"top",style:"margin:0; padding:0;",splitter:!1,gutters:!1});(a=q.byId("rendererRatioPanel"))&&a.destroy();var e=this.getVisualVariableByType("colorInfo",null,this.renderer.visualVariables);this.getAttributeItem(e&&e.field||this.renderer.attributeField||this.renderer.field).then(c.hitch(this,function(a){this._rendererAttribute.set("value",a.name);this.getAttributeItem(e.normalizationField).then(c.hitch(this,
function(c){this._rendererAttribute2.set("value",c.name);this.setTypeOptions(a,c);b.set(this._vars.ratio.select,"display","none");b.set(this._vars.ratio.options,"display","");b.set(this._vars.ratio.check,"display","");f.add(this._vars.ratio.title,"checked");this.rendererRatioPanel=new N({id:"rendererRatioPanel",params:{portalPanel:this,subLayerId:this.subLayerId,mapLayer:this.mapLayer,layer:this.layer,fLayer:this.fLayer,renderer:l.fromJson(this.renderer.toJson()),geometryType:this.geometryType,origRenderer:this.origRenderer,
isHosted:this.isHosted,isFeatColl:this.isFeatColl,isCSV:this.isCSV,isSL:this.isSL,isOwnerOfHostedFS:this.isOwnerOfHostedFS,hasDynamic:this.hasDynamic,attributeItem:a,attributeItem2:c,attributesStore:this.attributesStore,hasNumericField:this.hasNumericField},containerNode:this.rendererRatioStack,region:"top"});leftPanel.sc.addChild(this.rendererRatioStack);leftPanel.sc.startup();leftPanel.sc.selectChild(this.rendererRatioStack);leftPanel.visibleStack="rendererRatioStack";q.byId("rendererRatioPanel").adjustHeight()}))}))},
_goToPredominanceSizePanel:function(){this.hideLegendPopup();this.rendererMultiAttributesStack||(this.rendererMultiAttributesStack=new u({id:"rendererMultiAttributesStack",region:"top",style:"margin:0; padding:0;",splitter:!1,gutters:!1}));this.rendererMultiAttributesPanel&&this.rendererMultiAttributesPanel.destroy();this.getVisualVariableByType("sizeInfo",null,this.renderer.visualVariables);var a=this.renderer.infos,e=a[1].value;this.getAttributeItem(a[0].value).then(c.hitch(this,function(a){this._rendererAttribute.set("value",
a.name);this.getAttributeItem(e).then(c.hitch(this,function(c){this._rendererAttribute2.set("value",c.name);this.setTypeOptions(a,c);b.set(this._vars.predominancesize.select,"display","none");b.set(this._vars.predominancesize.options,"display","");b.set(this._vars.predominancesize.check,"display","");f.add(this._vars.predominancesize.title,"checked");this.rendererMultiAttributesPanel=new z({id:"rendererMultiAttributesPanel",params:{portalPanel:this,subLayerId:this.subLayerId,mapLayer:this.mapLayer,
layer:this.layer,fLayer:this.fLayer,renderer:l.fromJson(this.renderer.toJson()),geometryType:this.geometryType,origRenderer:this.origRenderer,isHosted:this.isHosted,isFeatColl:this.isFeatColl,isCSV:this.isCSV,isSL:this.isSL,isOwnerOfHostedFS:this.isOwnerOfHostedFS,hasDynamic:this.hasDynamic,attributeItem:a,attributeItem2:c,attributesStore:this.attributesStore,hasNumericField:this.hasNumericField},containerNode:this.rendererMultiAttributesStack,region:"top"});leftPanel.sc.addChild(this.rendererMultiAttributesStack);
leftPanel.sc.startup();leftPanel.sc.selectChild(this.rendererMultiAttributesStack);leftPanel.visibleStack="rendererMultiAttributesStack";q.byId("rendererMultiAttributesPanel").adjustHeight()}))}))},resetTypeOptions:function(){g.forEach("simple unique color size heatMap predominance predominancesize colorsize uniquesize watercolor ratio".split(" "),function(a){b.set(this._vars[a].root,"display","none");-1<g.indexOf(["simple","unique","color","size"],a)&&(f.remove(this._vars[a].root,"point"),f.remove(this._vars[a].root,
"line"),f.remove(this._vars[a].root,"polygon"))},this);this.resetTypeOptionsClearCheck()},resetTypeOptionsClearCheck:function(){g.forEach("simple unique color size heatMap predominance predominancesize colorsize uniquesize watercolor ratio".split(" "),function(a){this._vars[a].optionsButton.set("disabled",!1);b.set(this._vars[a].select,"display","");b.set(this._vars[a].options,"display","none");b.set(this._vars[a].check,"display","none");f.remove(this._vars[a].title,"checked")},this)},setTypeOptions:function(a,
c,d,k,h){this.resetTypeOptions();a=a||this.attributeItem;c=c||this.attributeItem2;d=d||this.attributeItem3;a&&c&&d&&this.showPredominance?(d=["predominance","predominancesize"],this.newStyles&&"esriGeometryPolygon"==this.geometryType&&d.push("watercolor"),"esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType?g.forEach(d,function(a){f.addlist(this._vars[a].root,"point")},this):"esriGeometryPolyline"==this.geometryType?g.forEach(d,function(a){f.add(this._vars[a].root,"line")},
this):"esriGeometryPolygon"==this.geometryType&&g.forEach(d,function(a){f.add(this._vars[a].root,"polygon")},this),g.forEach(d,function(a){b.set(this._vars[a].root,"display","")},this)):a&&c?this.isTypeString(a)||this.isTypeString(c)||a.codedValues||c.codedValues?("esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType?g.forEach(["uniquesize"],function(a){f.add(this._vars[a].root,"point")},this):"esriGeometryPolyline"==this.geometryType?g.forEach(["uniquesize"],function(a){f.add(this._vars[a].root,
"line")},this):"esriGeometryPolygon"==this.geometryType&&g.forEach(["uniquesize"],function(a){f.add(this._vars[a].root,"polygon")},this),b.set(this._vars.uniquesize.root,"display","")):(d=["colorsize","uniquesize"],a.name!=c.name&&(d.push("ratio"),this.showPredominance&&(d.push("predominance"),d.push("predominancesize")),this.newStyles&&"esriGeometryPolygon"==this.geometryType&&d.push("watercolor")),"esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType?g.forEach(d,function(a){f.add(this._vars[a].root,
"point")},this):"esriGeometryPolyline"==this.geometryType?g.forEach(d,function(a){f.add(this._vars[a].root,"line")},this):"esriGeometryPolygon"==this.geometryType&&g.forEach(d,function(a){f.add(this._vars[a].root,"polygon")},this),g.forEach(d,function(a){b.set(this._vars[a].root,"display","")},this)):!a||"none"===this._rendererAttribute.get("value")?("esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType?(g.forEach(["simple","heatMap"],function(a){f.add(this._vars[a].root,
"point")},this),!this.hasDynamic&&(!m("ie")||9<=m("ie"))&&b.set(this._vars.heatMap.root,"display","")):"esriGeometryPolyline"==this.geometryType?f.add(this._vars.simple.root,"line"):"esriGeometryPolygon"==this.geometryType&&f.add(this._vars.simple.root,"polygon"),b.set(this._vars.simple.root,"display","")):"multiple"===a.type.toString()?("esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType?(g.forEach(["simple","predominance","watercolor","heatMap"],function(a){f.add(this._vars[a].root,
"point")},this),!this.hasDynamic&&(!m("ie")||9<=m("ie"))&&b.set(this._vars.heatMap.root,"display","")):"esriGeometryPolyline"==this.geometryType?g.forEach(["simple","predominance","watercolor"],function(a){f.add(this._vars[a].root,"polygon")},this):"esriGeometryPolygon"==this.geometryType&&g.forEach(["simple","predominance","watercolor"],function(a){f.add(this._vars[a].root,"polygon")},this),g.forEach(["simple","predominance","watercolor"],function(a){b.set(this._vars[a].root,"display","")},this)):
"esriFieldTypeInteger"==a.type||"esriFieldTypeSmallInteger"==a.type?("esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType?(g.forEach(["simple","unique","color","size","heatMap"],function(a){f.add(this._vars[a].root,"point")},this),!this.hasDynamic&&(!m("ie")||9<=m("ie"))&&b.set(this._vars.heatMap.root,"display","")):"esriGeometryPolyline"==this.geometryType?g.forEach(["simple","unique","color","size"],function(a){f.add(this._vars[a].root,"line")},this):"esriGeometryPolygon"==
this.geometryType&&g.forEach(["simple","unique","color","size"],function(a){f.add(this._vars[a].root,"polygon")},this),g.forEach(["simple","unique","color","size"],function(a){b.set(this._vars[a].root,"display","")},this)):"esriFieldTypeDouble"==a.type||"esriFieldTypeSingle"==a.type?("esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType?(g.forEach(["simple","color","size","heatMap","unique"],function(a){f.add(this._vars[a].root,"point")},this),!this.hasDynamic&&(!m("ie")||
9<=m("ie"))&&b.set(this._vars.heatMap.root,"display","")):"esriGeometryPolyline"==this.geometryType?g.forEach(["simple","color","size","unique"],function(a){f.add(this._vars[a].root,"line")},this):"esriGeometryPolygon"==this.geometryType&&g.forEach(["simple","color","size","unique"],function(a){f.add(this._vars[a].root,"polygon")},this),g.forEach(["simple","color","size","unique"],function(a){b.set(this._vars[a].root,"display","")},this)):"esriFieldTypeDate"==a.type.toString()?("esriGeometryPoint"==
this.geometryType||"esriGeometryMultipoint"==this.geometryType?(g.forEach(["simple","heatMap","unique"],function(a){f.add(this._vars[a].root,"point")},this),!this.hasDynamic&&(!m("ie")||9<=m("ie"))&&b.set(this._vars.heatMap.root,"display","")):"esriGeometryPolyline"==this.geometryType?g.forEach(["simple","unique"],function(a){f.add(this._vars[a].root,"line")},this):"esriGeometryPolygon"==this.geometryType&&g.forEach(["simple","unique"],function(a){f.add(this._vars[a].root,"polygon")},this),g.forEach(["simple",
"unique"],function(a){b.set(this._vars[a].root,"display","")},this)):("esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType?(g.forEach(["simple","unique","heatMap"],function(a){f.add(this._vars[a].root,"point")},this),!this.hasDynamic&&(!m("ie")||9<=m("ie"))&&b.set(this._vars.heatMap.root,"display","")):"esriGeometryPolyline"==this.geometryType?g.forEach(["simple","unique"],function(a){f.add(this._vars[a].root,"line")},this):"esriGeometryPolygon"==this.geometryType&&
g.forEach(["simple","unique"],function(a){f.add(this._vars[a].root,"polygon")},this),g.forEach(["simple","unique"],function(a){b.set(this._vars[a].root,"display","")},this))},getAttributeStore:function(){if(!this.attributesStore){var a=arcgisonline.map.table.getPopupInfo(this.mapLayer,this.mapLayer.layer instanceof H?null:this.subLayerId),b=function(b){if(a&&a.fieldInfos){var c;for(c=0;c<a.fieldInfos.length;c++){var d=a.fieldInfos[c];if(d.fieldName==b)return d.label}}return null};this.attributesCount=
{number:0,string:0,date:0};var d=this.getVisualVariableByType("colorInfo",null,this.renderer.visualVariables),f=this.getVisualVariableByType("sizeInfo",null,this.renderer.visualVariables);(d=this.renderer.attributeField||this.renderer.field||this.renderer.fields||d&&d.field||f&&f.field)&&-1<g.indexOf(this.dontUseFields,d.toLowerCase())&&this.dontUseFields.splice(g.indexOf(this.dontUseFields,d.toLowerCase()),1);this.layer.objectIdField&&this.dontUseFields.push(this.layer.objectIdField.toLowerCase());
var d=this._getLayerFields(),h=[];g.forEach(d,c.hitch(this,function(a,c){if(-1===g.indexOf(this.dontUseFields,a.name.toLowerCase())){var d={name:a.name,alias:arcgisonline.sharing.util.htmlEncode(b(a.name)||a.alias||a.name),type:a.type,hasCodedValues:a.codedValues?"true":"false"};a.domain&&a.domain.codedValues&&(d.codedValues=F.stringify(a.domain.codedValues));switch(a.type){case "esriFieldTypeSingle":this.attributesCount.number++;break;case "esriFieldTypeDouble":this.attributesCount.number++;break;
case "esriFieldTypeInteger":this.attributesCount.number++;break;case "esriFieldTypeSmallInteger":this.attributesCount.number++;break;case "esriFieldTypeString":this.attributesCount.string++;break;case "esriFieldTypeDate":this.attributesCount.date++}h.push(d)}}));h=h.sort(function(a,c){var d=(b(a.name)||a.alias||a.name).toLowerCase(),f=(b(c.name)||c.alias||c.name).toLowerCase();return d==f?0:d<f?-1:1});h.splice(0,0,{name:" ",alias:" ",type:"blank"});h.splice(0,0,{name:"_total_",alias:E.substitute(this.i18n.total,
{field:" "}),type:"total"});h.splice(0,0,{name:this.i18n.none,alias:this.i18n.none,type:"none"});h.splice(0,0,{name:"showLocationOnly",alias:this.i18n.showLocationOnly,type:"showLocationOnly"});this.attributesStore=new G({data:{label:"alias",identifier:"name",items:h}})}},fillRendererAttribute:function(){this.attributesStore||(this.getAttributeStore(),(this.renderer.attributeField||this.renderer.field||this.renderer.fields)===this.layer.objectIdField?this.isFeatColl||this.isCSV?this._rendererAttribute.setStore(this.attributesStore,
this.i18n.showLocationOnly,{query:"NOT type:'none' AND NOT type:'total' AND NOT type:'blank' AND NOT type:'percent' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry'"}):this._rendererAttribute.setStore(this.attributesStore,this.i18n.showLocationOnly,{query:"NOT type:'none' AND NOT type:'total' AND NOT type:'blank' AND NOT type:'percent' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeDate'"}):this.isFeatColl||this.isCSV?this._rendererAttribute.setStore(this.attributesStore,
this.i18n.showLocationOnly,{query:"NOT type:'none' AND NOT type:'total' AND NOT type:'blank' AND NOT type:'percent' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT name:'"+this.layer.objectIdField+"'"}):this._rendererAttribute.setStore(this.attributesStore,this.i18n.showLocationOnly,{query:"NOT type:'none' AND NOT type:'total' AND NOT type:'blank' AND NOT type:'percent' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeDate' AND NOT name:'"+
this.layer.objectIdField+"'"}))},_showLoading:function(a){},_hideLoading:function(){this._hideError()},_showError:function(a){p.coords(a)},_hideError:function(){},_isLoading:function(){},_getLayerFields:function(){if(this.hasDynamic){var a=this.serviceLayerInfo.fields;return this.mapLayer.thematicGroup&&this.mapLayer.thematicGroup.fieldNames&&this.mapLayer.thematicGroup.fieldNames.length?g.filter(a,function(a){return g.some(this.mapLayer.thematicGroup.fieldNames,function(b){return b===a.name},this)},
this):a}return this.layer.fields},saveCurrentRenderer:function(){var a=this.getVisualVariableByType("colorInfo",null,this.renderer.visualVariables),b=this.getVisualVariableByType("sizeInfo",null,this.renderer.visualVariables),c=this.renderer.attributeField||this.renderer.field;if(!c||this.attributeItem&&!this.attributeItem2&&c===this.attributeItem.name||this.attributeItem&&this.attributeItem2&&("ratio"===this.getRendererStyle(this.renderer)&&this.attributeItem.name===a.field&&this.attributeItem2.name===
a.normalizationField||"colorsize"===this.getRendererStyle(this.renderer)&&this.attributeItem.name===a.field&&this.attributeItem2.name===b.field||"uniquesize"===this.getRendererStyle(this.renderer)&&this.attributeItem.name===c&&this.attributeItem2.name===b.field))a={renderer:this.renderer.toJson()},a.renderer&&!esri.isEmpty(a.renderer)&&(this.scheme&&(a.scheme=this.scheme),a.opacity=(this.fLayer||this.layer).opacity,this.savedRenderers[this.getRendererType(this.renderer)]=a)},adjustHeight:function(a){if(!("undefined"==
typeof leftPanel||"rendererStack"!=leftPanel.visibleStack)){a=p.coords(t.byId("leftContentStackContainer")).h;var c=p.coords(t.byId("rendererHeader")).h,d=p.coords(this._rendererTitle2).t-p.coords(this._rendererTitle1).t,f=p.coords(this._rendererTitle2).h,g=p.coords(this._doneButton.domNode).h,h=p.coords(t.byId("rendererFooter_links")).h+10;b.set(t.byId("rendererContentFooter"),"height",h+"px");a=a-c-d-f-g-h-33;0<a&&b.set(this._rendererTypes,"height",a+"px");a=p.coords(t.byId("leftContentStackContainer")).w-
10;0<a&&(b.set(t.byId("rendererGalleryPane"),"width",a+"px"),b.set(this._rendererAttribute.domNode,"width",a-75+"px"),b.set(this._rendererAttribute2.domNode,"width",a-75+"px"),b.set(this._rendererAttribute3.domNode,"width",a-75+"px"),b.set(this._rendererAttribute4.domNode,"width",a-75+"px"),b.set(this._rendererAttribute5.domNode,"width",a-75+"px"),b.set(this._rendererTypes,"width",a+"px"),a=Math.min(a-15,500),r(".rendererType").style("width",a+"px"),r(".rendererTypeThumb").style("width",a-20+"px"),
d=300<a?150:Math.min(a/2,150),r(".rendererTypeThumb").style("height",d+"px"),300>a?r(".rendererTypeThumb").style("backgroundSize","cover"):r(".rendererTypeThumb").style("backgroundSize","500px 150px"),c=0,r(".rendererTitleText").forEach(function(a){c=Math.max(c,p.coords(a).h)}),a=(d-c)/2-17,r(".rendererSelect").style("top",a+"px"),r(".rendererOptions").style("top",a+"px"))}}});m("extend-esri")&&c.setObject("arcgisonline.map.dijit.renderer.Gallery",x);return x});