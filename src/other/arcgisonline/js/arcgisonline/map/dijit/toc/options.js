// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/map/dijit/toc/options",["dijit","dojo","dojox","dojo/require!arcgisonline/map/main"],function(h,d,s){d.provide("arcgisonline.map.dijit.toc.options");d.require("arcgisonline.map.main");arcgisonline.map.dijit.toc.options={intervalHandlers:[],toolOptionsHtml:function(a,b,f,c){var g=h.byId("tocPanel"),e=arcgisonline.map.featColl.isFeatureCollection(a),p=a.layer instanceof esri.layers.KMLLayer,k=a.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer,q=a.layer instanceof esri.layers.ArcGISTiledMapServiceLayer,
m=a.layer&&"esri.layers.VectorTileLayer"===a.layer.declaredClass;if((k||q)&&esri.isDefined(b)&&!c){var n;arcgisonline.map.dijit.toc.options.getParams(a,b).then(d.hitch(this,function(a,b,c){var g=arcgisonline.map.dijit.toc.options.toolOptionsHtml(a,b,!1,c);n=g;if(g.length){var p=a.id+(esri.isDefined(b)?"_"+b:"")+"_tools",f=d.byId(p);if(f)f.innerHTML!==g&&(f.innerHTML=g);else var e=setInterval(function(){if(f=d.byId(p))clearInterval(e),f.innerHTML=g},100)}},a,b));return n||null}var l="",r=!1;if(a.layer&&
(a.layer.renderer||10.2<=a.layer.version&&a.layer instanceof esri.layers.ArcGISImageServiceLayer))r=!0;if(!f&&arcgisonline.map.dijit.toc.options.canShowLegend(a,b,c)&&(r||(k||q||m||e)&&esri.isDefined(b)))if(!k&&!q&&a.layer)e=d.byId(a.id+"_legend"),l=!e||e&&"none"===d.style(e,"display")?l+('\x3cdiv id\x3d"'+a.id+'_legendTool" class\x3d"iconShowLegend toc_tool"\x3e\x3cspan onclick\x3d"JavaScript:arcgisonline.map.dijit.toc.legend.showLegend(\''+a.id+'\');" title\x3d"'+g.i18n.showLayerLegend+'"\x3e\x3c/span\x3e\x3c/div\x3e'):
l+('\x3cdiv id\x3d"'+a.id+'_legendTool" class\x3d"iconHideLegend toc_tool"\x3e\x3cspan onclick\x3d"JavaScript:arcgisonline.map.dijit.toc.legend.hideLegend(\''+a.id+'\');" title\x3d"'+g.i18n.hideLayerLegend+'"\x3e\x3c/span\x3e\x3c/div\x3e');else if((k||q||m||e)&&esri.isDefined(b))k=esri.isDefined(b)?"string"===typeof b?"'"+b+"'":""+b:"null",e=d.byId(a.id+"_"+b+"_legend"),l=!e||e&&"none"===d.style(e,"display")?l+('\x3cdiv id\x3d"'+a.id+"_"+b+'_legendTool" class\x3d"iconShowLegend toc_tool"\x3e\x3cspan onclick\x3d"JavaScript:arcgisonline.map.dijit.toc.legend.showLegend(\''+
a.id+"',"+k+');" title\x3d"'+g.i18n.showLayerLegend+'"\x3e\x3c/span\x3e\x3c/div\x3e'):l+('\x3cdiv id\x3d"'+a.id+"_"+b+'_legendTool" class\x3d"iconHideLegend toc_tool"\x3e\x3cspan onclick\x3d"JavaScript:arcgisonline.map.dijit.toc.legend.hideLegend(\''+a.id+"',"+k+');" title\x3d"'+g.i18n.hideLayerLegend+'"\x3e\x3c/span\x3e\x3c/div\x3e');arcgisonline.map.dijit.toc.options.canShowTable(a,b,c)&&(k=esri.isDefined(b)?"string"===typeof b?"'"+b+"'":""+b:"null",l=arcgisonline.map.table.isTableVisible(a.id,
b)?l+('\x3cdiv id\x3d"'+a.id+(esri.isDefined(b)?"_"+b:"")+'_tableTool" class\x3d"iconHideAttributeTable toc_tool"\x3e\x3cspan onclick\x3d"JavaScript:dijit.byId(\'tocPanel\').hideAttributeTable(\''+a.id+"',"+k+');" title\x3d"'+g.i18n.hideTable+'"\x3e\x3c/span\x3e\x3c/div\x3e'):l+('\x3cdiv id\x3d"'+a.id+(esri.isDefined(b)?"_"+b:"")+'_tableTool" class\x3d"iconShowAttributeTable toc_tool"\x3e\x3cspan onclick\x3d"JavaScript:dijit.byId(\'tocPanel\').showAttributeTable(\''+a.id+"',"+k+');" title\x3d"'+g.i18n.showTable+
'"\x3e\x3c/span\x3e\x3c/div\x3e'));!f&&arcgisonline.map.dijit.toc.options.canShowStyle(a,b,c)&&(k=esri.isDefined(b)?"string"===typeof b?"'"+b+"'":""+b:"null",l+="\x3cdiv class\x3d\"iconChangeStyle toc_tool\"\x3e\x3cspan onclick\x3d\"JavaScript:dijit.byId('tocPanel').smartMappingRenderer('"+a.id+"',"+k+');" title\x3d"'+g.i18n.changeStyle+'"\x3e\x3c/span\x3e\x3c/div\x3e');arcgisonline.map.dijit.toc.options.canShowFilter(a,b,c)&&(k=esri.isDefined(b)?"string"===typeof b?"'"+b+"'":""+b:"null",l+="\x3cdiv class\x3d\"iconFilter toc_tool\"\x3e\x3cspan onclick\x3d\"JavaScript:dijit.byId('tocPanel').filter('"+
a.id+"',"+k+');" title\x3d"'+g.i18n.filter+'"\x3e\x3c/span\x3e\x3c/div\x3e');if((!isEmbedded||!isEmbedded.hideAnalysis)&&!f)e=a.id+(esri.isDefined(b)?"_"+b:""),l+='\x3cdiv id\x3d"'+e+'_performAnalysisPlaceholder" style\x3d"display:none;"\x3e\x3c/div\x3e',arcgisonline.map.dijit.toc.options.updateAnalysisPlaceholder(a,b,e,c);if(l.length&&(!esri.isDefined(b)||!p))l=2===l.split("/div").length&&-1<l.indexOf("_performAnalysisPlaceholder")?l+('\x3cdiv id\x3d"'+a.id+"_"+(esri.isDefined(b)?b:"")+'_toolSeparator" class\x3d"toc_tool_separator" style\x3d"display:none;"\x3e\x3c/div\x3e'):
l+('\x3cdiv id\x3d"'+a.id+"_"+(esri.isDefined(b)?b:"")+'_toolSeparator" class\x3d"toc_tool_separator"\x3e\x3c/div\x3e');f?l=esri.isDefined(b)?l+('\x3cdiv class\x3d"iconMenu toc_tool" id\x3d"'+a.id+"_"+b+"_menu\"\x3e\x3cspan onclick\x3d\"JavaScript:dijit.byId('tocPanel').onSubTableMenuClick('"+a.id+"',"+("string"===typeof b?"'"+b+"'":""+b)+'); return false;" title\x3d"'+g.i18n.moreOptions+'"\x3e\x3c/span\x3e\x3c/div\x3e'):l+('\x3cdiv class\x3d"iconMenu toc_tool" id\x3d"'+a.id+"_menu\"\x3e\x3cspan onclick\x3d\"JavaScript:dijit.byId('tocPanel').onTableMenuClick('"+
a.id+'\'); return false;" title\x3d"'+g.i18n.moreOptions+'"\x3e\x3c/span\x3e\x3c/div\x3e'):esri.isDefined(b)?p||(k=esri.isDefined(b)?"string"===typeof b?"'"+b+"'":""+b:"null",l+='\x3cdiv class\x3d"iconMenu toc_tool" id\x3d"'+a.id+"_"+b+"_menu\"\x3e\x3cspan onclick\x3d\"JavaScript:dijit.byId('tocPanel').onSubLayerMenuClick('"+a.id+"',"+k+'); return false;" title\x3d"'+g.i18n.moreOptions+'"\x3e\x3c/span\x3e\x3c/div\x3e'):l+='\x3cdiv class\x3d"iconMenu toc_tool" id\x3d"'+a.id+"_menu\"\x3e\x3cspan onclick\x3d\"JavaScript:dijit.byId('tocPanel').onLayerMenuClick('"+
a.id+'\'); return false;" title\x3d"'+g.i18n.moreOptions+'"\x3e\x3c/span\x3e\x3c/div\x3e';return l},getParams:function(a,b){var f=new d.Deferred,c=a.layer instanceof esri.layers.ArcGISTiledMapServiceLayer,g={};if(a.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer){var e;arcgisonline.map.main.hasDynamicLayers(a)?(d.forEach(a.layer.dynamicLayerInfos,function(a){a.id===b&&(layerInfo=a)}),esri.isDefined(layerInfo.source.mapLayerId)&&d.forEach(a.layer.layerInfos,function(b,c){b.id==layerInfo.source.mapLayerId&&
(e=b.id,arcgisonline.map.main.getLayerInfo(a,b.id).then(function(a){layerInfoType=a.type}))},this)):d.forEach(a.layer.layerInfos,function(a){a.id===b&&(layerInfo=a)});arcgisonline.map.main.getLayerInfoForQuery(a,esri.isDefined(e)?e:layerInfo.id,layerInfo.subLayerIds).then(d.hitch(this,function(b){var c=b.url&&-1<b.url.toLowerCase().indexOf("/mapserver")&&-1==b.url.toLowerCase().indexOf("/featureserver"),d=b.capabilities&&b.capabilities.toLowerCase(),d=d&&(!c&&-1<d.indexOf("query")||c&&-1<d.indexOf("query")&&
-1<d.indexOf("data"));g.layerInfoType=b.type;c=b.subLayers&&0<b.subLayers.length;g.isGroupLayer=c;if(b&&("Feature Layer"===b.type&&d)&&(g.supportsQuery=!0,d=a.serviceInfo?a.serviceInfo.currentVersion:null,!c&&10.01<=d&&(!esri.isDefined(b.maxRecordCount)||10<=b.maxRecordCount)))g.canShowTable=!0;f.callback(g)}),function(){f.callback(g)})}else c&&arcgisonline.map.main.getLayerInfoForQuery(a,b).then(d.hitch(this,function(b){var c=b.url&&-1<b.url.toLowerCase().indexOf("/mapserver")&&-1==b.url.toLowerCase().indexOf("/featureserver"),
d=b.capabilities&&b.capabilities.toLowerCase(),d=d&&(!c&&-1<d.indexOf("query")||c&&-1<d.indexOf("query")&&-1<d.indexOf("data"));g.layerInfoType=b.type;c=b.subLayers&&0<b.subLayers.length;g.isGroupLayer=c;if(b&&("Feature Layer"===b.type&&d)&&(g.supportsQuery=!0,d=a.serviceInfo?a.serviceInfo.currentVersion:null,!c&&10.01<=d&&(!esri.isDefined(b.maxRecordCount)||10<=b.maxRecordCount)))g.canShowTable=!0;f.callback(g)}),function(){f.callback(g)});return f},updateToolOptions:function(a,b){if(a){var f;if(f=
esri.isDefined(b)?d.byId(a.id+"_"+b+"_tools"):d.byId(a.id+"_tools")){var c=arcgisonline.map.dijit.toc.options.toolOptionsHtml(a,b,a.serviceInfo&&"Table"===a.serviceInfo.type);esri.isDefined(c)&&(f.innerHTML=c)}}},updateLegendTool:function(a,b,f){if(a){var c=h.byId("tocPanel"),g=a.id+(esri.isDefined(b)?"_"+b:""),e=d.byId(g+"_legendTool");if(e)if(!f&&"none"===d.style(d.byId(g+"_legend"),"display")||"show"===f)d.removeClass(e,"iconHideLegend"),d.addClass(e,"iconShowLegend"),e.childNodes[0].title=c.i18n.showLayerLegend,
e.childNodes[0].onclick=d.hitch(this,function(a,b){arcgisonline.map.dijit.toc.legend.showLegend(a,b)},a.id,b);else if(!f||"hide"===f)d.removeClass(e,"iconShowLegend"),d.addClass(e,"iconHideLegend"),e.childNodes[0].title=c.i18n.hideLayerLegend,e.childNodes[0].onclick=d.hitch(this,function(b,c){arcgisonline.map.dijit.toc.legend.hideLegend(a.id,c)},a.id,b)}},updateTableTool:function(a,b){if(a){var f=h.byId("tocPanel"),c=a.id+(esri.isDefined(b)?"_"+b:"");if(c=d.byId(c+"_tableTool"))arcgisonline.map.table.isTableVisible(a.id,
b)?(d.removeClass(c,"iconShowAttributeTable"),d.addClass(c,"iconHideAttributeTable"),c.childNodes[0].title=f.i18n.hideTable,c.childNodes[0].onclick=d.hitch(this,function(b,c){h.byId("tocPanel").hideAttributeTable(a.id,c)},a.id,b)):(d.removeClass(c,"iconHideAttributeTable"),d.addClass(c,"iconShowAttributeTable"),c.childNodes[0].title=f.i18n.showTable,c.childNodes[0].onclick=d.hitch(this,function(a,b){h.byId("tocPanel").showAttributeTable(a,b)},a.id,b))}},showAllTablesHiddenInToolOptions:function(a,
b){a?arcgisonline.map.dijit.toc.options.updateToolOptions(a,b):d.query(".iconHideAttributeTable .toc_tool").forEach(function(a){a=a.parentNode;var b=a.id.indexOf("_tools");a=b=a.id.substring(0,b);var d,e=arcgisonline.map.main.getParameterListById(b);if(!e)for(b=b.lastIndexOf("_");-1<b&&!e;)d=a.substring(b+1),b=a.substring(0,b),e=arcgisonline.map.main.getParameterListById(b),b=b.lastIndexOf("_");arcgisonline.map.dijit.toc.options.updateToolOptions(e,d)})},showTocTools:function(a,b){var f=arcgisonline.sharing.util.urlToObject(document.URL)||
{};d.query(".toc_tools").forEach(function(a){var b=a.id.substring(0,a.id.indexOf("_tools"));(b=h.byId(b+"_performAnalysisPopupMenu"))&&h.popup.close(b);esri.isTouchEnabled||f.query.useClick?d.style(a,"display","none"):d.style(a,"visibility","hidden")});var c;(c=esri.isDefined(b)?d.byId(a+"_"+b+"_tools"):d.byId(a+"_tools"))&&(esri.isTouchEnabled||f.query.useClick?d.style(c,"display",""):d.style(c,"visibility","visible"))},updateAnalysisPlaceholder:function(a,b,f,c){var g=h.byId("tocPanel");arcgisonline.map.dijit.toc.options.canShowAnalysis(a,
b,c).then(d.hitch(this,function(a,b,c,f){var m=esri.isDefined(b)?"string"===typeof b?"'"+b+"'":""+b:"null";if(f.performAnalysis||f.performAnalysisPopup){var n=0;arcgisonline.map.dijit.toc.options.intervalHandlers[c]&&clearInterval(arcgisonline.map.dijit.toc.options.intervalHandlers[c]);arcgisonline.map.dijit.toc.options.intervalHandlers[c]=setInterval(d.hitch(this,function(a,b,c){var e=d.byId(c+"_performAnalysisPlaceholder");if(e){clearInterval(arcgisonline.map.dijit.toc.options.intervalHandlers[c]);
delete arcgisonline.map.dijit.toc.options.intervalHandlers[c];h.byId(c+"_performAnalysisPopupMenu")&&h.byId(c+"_performAnalysisPopupMenu").destroy();e.innerHTML="";var k=a.layer instanceof esri.layers.KMLLayer;f.performAnalysis?(c='\x3cdiv class\x3d"iconPerformAnalysis toc_tool"\x3e\x3cspan onclick\x3d"JavaScript:',k&&(c+="dijit.byId('tocPanel').prepConfigureAnalysis(null, null, null, '"+a.id+"',"+m+"); "),c+="dijit.byId('tocPanel').configureAnalysis(null, '"+a.id+"',"+m+');" title\x3d"'+g.i18n.performAnalysis+
'"\x3e\x3c/span\x3e\x3c/div\x3e',e.innerHTML=c):f.performAnalysisPopup&&(1===f.geometryTypes.length?("point"===f.geometryTypes[0]&&(c='\x3cdiv class\x3d"iconPerformAnalysis toc_tool"\x3e\x3cspan onclick\x3d"JavaScript:',k&&(c+="dijit.byId('tocPanel').prepConfigureAnalysis(null, null, null, '"+a.id+"',"+m+"); "),c+="dijit.byId('tocPanel').configureAnalysis({analysisType:'esriGeometryPoint'}, '"+a.id+"',"+m+');" title\x3d"'+g.i18n.performAnalysis+'"\x3e\x3c/span\x3e\x3c/div\x3e',e.innerHTML=c),"line"===
f.geometryTypes[0]&&(c='\x3cdiv class\x3d"iconPerformAnalysis toc_tool"\x3e\x3cspan onclick\x3d"JavaScript:',k&&(c+="dijit.byId('tocPanel').prepConfigureAnalysis(null, null, null, '"+a.id+"',"+m+"); "),c+="dijit.byId('tocPanel').configureAnalysis({analysisType:'esriGeometryPolyline'}, '"+a.id+"',"+m+');" title\x3d"'+g.i18n.performAnalysis+'"\x3e\x3c/span\x3e\x3c/div\x3e',e.innerHTML=c),"polygon"===f.geometryTypes[0]&&(c='\x3cdiv class\x3d"iconPerformAnalysis toc_tool"\x3e\x3cspan onclick\x3d"JavaScript:',
k&&(c+="dijit.byId('tocPanel').prepConfigureAnalysis(null, null, null, '"+a.id+"',"+m+"); "),c+="dijit.byId('tocPanel').configureAnalysis({analysisType:'esriGeometryPolygon'}, '"+a.id+"',"+m+');" title\x3d"'+g.i18n.performAnalysis+'"\x3e\x3c/span\x3e\x3c/div\x3e',e.innerHTML=c)):(k=d.create("div",{"class":"iconPerformAnalysis toc_tool"},e),d.create("span",{id:c+"_performAnalysisPopup",title:g.i18n.performAnalysis},k),c=new h.Menu({id:c+"_performAnalysisPopupMenu",targetNodeIds:[c+"_performAnalysisPopup"],
leftClickToOpen:!0}),-1<d.indexOf(f.geometryTypes,"point")&&(k=new h.MenuItem({label:g.i18n.points,onClick:d.hitch(this,function(a,b){a.layer&&a.layer.folders&&h.byId("tocPanel").prepConfigureAnalysis(null,null,null,a.id,b);h.byId("tocPanel").configureAnalysis({analysisType:"esriGeometryPoint"},a.id,b)},a,b)}),c.addChild(k)),-1<d.indexOf(f.geometryTypes,"line")&&(k=new h.MenuItem({label:g.i18n.lines,onClick:d.hitch(this,function(a,b){a.layer&&a.layer.folders&&h.byId("tocPanel").prepConfigureAnalysis(null,
null,null,a.id,b);h.byId("tocPanel").configureAnalysis({analysisType:"esriGeometryPolyline"},a.id,b)},a,b)}),c.addChild(k)),-1<d.indexOf(f.geometryTypes,"polygon")&&(k=new h.MenuItem({label:g.i18n.areas,onClick:d.hitch(this,function(a,b){a.layer&&a.layer.folders&&h.byId("tocPanel").prepConfigureAnalysis(null,null,null,a.id,b);h.byId("tocPanel").configureAnalysis({analysisType:"esriGeometryPolygon"},a.id,b)},a,b)}),c.addChild(k)),c.startup()));d.style(e,"display","inline-block");(a=d.byId(a.id+"_"+
(esri.isDefined(b)?b:"")+"_toolSeparator"))&&d.style(a,"display","inline-block")}else 10<n&&(clearInterval(arcgisonline.map.dijit.toc.options.intervalHandlers[c]),delete arcgisonline.map.dijit.toc.options.intervalHandlers[c]);n++},a,b,c),500)}},a,b,f))},closeToolTipDialogs:function(){},canShowScale:function(a,b){var d="mapNotes"===a.type,c=arcgisonline.map.featColl.isFeatureCollection(a),g=a.layer instanceof esri.layers.GeoRSSLayer,e=a.layer instanceof esri.layers.KMLLayer,p=a.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&
a.layer.supportsDynamicLayers,k="base"===a.type||"labels"===a.type;if(esri.isDefined(b)){if(arcgisonline.map.role.isAllowed("toc_menu_visibilityRange")&&(c||g||p)&&!e)return!0}else if(!k&&arcgisonline.map.role.isAllowed("toc_menu_visibilityRange")&&(a.layer||d))return!0;return!1},canShowTable:function(a,b,d){if(esri.isDefined(b)){b=arcgisonline.map.featColl.isFeatureCollection(a);var c=a.layer instanceof esri.layers.GeoRSSLayer,g=a.serviceInfo?a.serviceInfo.currentVersion:null;if(b||c||d&&d.canShowTable)return!0}else{d=
"base"===a.type||"labels"===a.type;b=arcgisonline.map.featColl.isFeatureCollection(a);var c=a.layer instanceof esri.layers.FeatureLayer&&!(a.layer instanceof esri.layers.StreamLayer),e=a.layer instanceof esri.layers.CSVLayer,p=a.layer instanceof esri.layers.ArcGISImageServiceLayer,k=a.layer instanceof esri.layers.ArcGISImageServiceVectorLayer,g=a.serviceInfo?a.serviceInfo.currentVersion:null,h=!1,m=!1;if(a.layer&&a.layer.capabilities)var h=supportsMosaicRule=-1<a.layer.capabilities.toLowerCase().indexOf("catalog"),
m=a.layer.url&&-1<a.layer.url.toLowerCase().indexOf("/mapserver")&&-1==a.layer.url.toLowerCase().indexOf("/featureserver"),n=a.layer.capabilities&&a.layer.capabilities.toLowerCase(),m=!m&&-1<n.indexOf("query")||m&&-1<n.indexOf("query")&&-1<n.indexOf("data");if(!d&&(b&&a.layer||e||(c&&m||(p||k)&&h)&&10.01<=g))if(!c||b||e||!(esri.isDefined(a.layer.maxRecordCount)&&10>a.layer.maxRecordCount))return!0}return!1},canShowStyle:function(a,b,d){if(esri.isDefined(b)){b=arcgisonline.map.featColl.isFeatureCollection(a);
var c=a.layer instanceof esri.layers.GeoRSSLayer,g=a.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&a.layer.supportsDynamicLayers;if(b&&a.layers||c||d&&g&&"Feature Layer"===d.layerInfoType&&!d.isGroupLayer)return!0}else{d="base"===a.type||"labels"===a.type;b=arcgisonline.map.featColl.isFeatureCollection(a);var g=a.layer instanceof esri.layers.FeatureLayer&&!(a.layer instanceof esri.layers.StreamLayer),e=a.layer instanceof esri.layers.StreamLayer,p=a.layer instanceof esri.layers.CSVLayer,
k=a.layer instanceof esri.layers.ArcGISImageServiceVectorLayer,h=(c=a.layer instanceof esri.layers.GeoRSSLayer)?1==a.layer.getFeatureLayers().length:!1;if(!d&&(a.layer&&b||c&&h||p||e||k||g))return!0}return!1},canShowFilter:function(a,b,d){if(esri.isDefined(b)){if(a=a.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer,d&&a&&"Feature Layer"===d.layerInfoType&&!d.isGroupLayer)return!0}else{d="base"===a.type||"labels"===a.type;b=arcgisonline.map.featColl.isFeatureCollection(a);var c=a.layer instanceof
esri.layers.FeatureLayer&&!(a.layer instanceof esri.layers.StreamLayer),g=a.layer instanceof esri.layers.StreamLayer,e=a.layer instanceof esri.layers.CSVLayer,h=a.layer instanceof esri.layers.ArcGISImageServiceLayer,k=a.layer instanceof esri.layers.ArcGISImageServiceVectorLayer,q=!1;a.layer&&a.layer.capabilities&&(q=supportsMosaicRule=-1<a.layer.capabilities.toLowerCase().indexOf("catalog"));if((c||g||(h||k)&&q&&!d)&&!b&&!e)return!0}return!1},canShowLegend:function(a,b,d){var c=a.layer instanceof
esri.layers.ArcGISImageServiceLayer,g=a.layer instanceof esri.layers.ArcGISImageServiceVectorLayer,e=a.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer,h=a.layer instanceof esri.layers.ArcGISTiledMapServiceLayer,k=arcgisonline.map.featColl.isFeatureCollection(a);return a.layer&&(a.layer.renderer||(e||h)&&d&&!d.isGroupLayer&&esri.isDefined(b)||10.2<=a.layer.version&&(c||g))||k&&a.layers&&esri.isDefined(b)?!0:!1},canShowAnalysis:function(a,b,f){var c=new d.Deferred,g=arcgisonline.map.dijit.toc.analysis,
e=g.canPerformAnalysis();if(e)if(esri.isDefined(b)){f=arcgisonline.map.featColl.isFeatureCollection(a);var h=null,k=!1,q=null,m=null;this._isKmlNetworkLinkFolder=!1;this._kmlAnalysisLayer=this._kmlFcollbycurfolder=null;var n=a.layer&&a.layer instanceof esri.layers.KMLLayer&&a.layer.folders;if(f)h=d.filter(a.layers,function(a){if(a.id===b)return a})[0];else if(a.layer instanceof esri.layers.GeoRSSLayer)h=d.filter(a.layer.getFeatureLayers(),function(a){if(a.id===b)return a})[0];else if(arcgisonline.map.main.hasDynamicLayers(a))h=
d.filter(a.layer.dynamicLayerInfos,function(a){if(a.id===b)return a})[0],esri.isDefined(h.source.mapLayerId)&&d.forEach(a.layer.layerInfos,function(b,c){b.id==h.source.mapLayerId&&(q=b.id,arcgisonline.map.main.getLayerInfo(a,b.id).then(function(a){}))},this),k=!0;else if(n){if(h=m=d.filter(a.layer.folders,function(a){if(a.id===b)return a})[0],m=(this._kmlFcollbycurfolder=a.layer.getFeatureCollection(m.id))&&0<this._kmlFcollbycurfolder.length)this._kmlAnalysisLayer=a.layer}else h=d.filter(a.layer.layerInfos,
function(a){if(a.id===b)return a})[0];if(n)if(this._kmlFcollbycurfolder){var l=[];d.forEach(this._kmlFcollbycurfolder,function(a){"esriGeometryPoint"===a.layerDefinition.geometryType&&l.push("point");"esriGeometryPolyline"===a.layerDefinition.geometryType&&l.push("line");"esriGeometryPolygon"===a.layerDefinition.geometryType&&l.push("polygon")},this);c.callback({performAnalysis:!1,performAnalysisPopup:!0,geometryTypes:l})}else c.callback({performAnalysis:!0,performAnalysisPopup:!1});else f||a.layer instanceof
esri.layers.GeoRSSLayer?c.callback({performAnalysis:!0,performAnalysisPopup:!1}):arcgisonline.map.main.getLayerInfoForQuery(a,esri.isDefined(q)?q:h.id,h.subLayerIds).then(d.hitch(this,function(b){var f=b.url&&-1<b.url.toLowerCase().indexOf("/mapserver")&&-1==b.url.toLowerCase().indexOf("/featureserver"),h=b.capabilities&&b.capabilities.toLowerCase(),f=h&&(!f&&-1<h.indexOf("query")||f&&-1<h.indexOf("query")&&-1<h.indexOf("data"));b&&("Feature Layer"===b.type&&(f||!b.capabilities&&a.identify))&&g.checkLayers().always(d.hitch(this,
function(){var f=esri.isDefined(a.analysisProxyCheck)?"failure"===a.analysisProxyCheck:!1,h=k&&a.thematicGroup,l=g.hasShapeField(b)||a.queryServiceUrl;!l&&a.itemLayers&&d.forEach(a.itemLayers,function(a){a.id===b.id&&(a.layerUrl&&arcgisonline.sharing.util.isHostedService(a.layerUrl))&&(l=!0)});e&&!h&&!f&&l?c.callback({performAnalysis:!0,performAnalysisPopup:!1}):c.callback({performAnalysis:!1,performAnalysisPopup:!1})}))}),function(){c.callback({performAnalysis:!1,performAnalysisPopup:!1})})}else g.checkLayers().always(d.hitch(this,
function(b){if(g.isPerformAnalysisLayer(a,-1)){var e,f=0,h=[];a.layers&&0<a.layers.length?e=a.layers:a.layer&&a.layer instanceof esri.layers.GeoRSSLayer&&0<a.layer.getFeatureLayers().length?e=a.layer.getFeatureLayers():f=1;0===f&&d.forEach(e,function(a){0<a.graphics.length&&(h.push(a.geometryType),f++)});if(0===f)c.callback({performAnalysis:!1,performAnalysisPopup:!1});else if(1===f)a.layer instanceof esri.layers.GeoRSSLayer?"esriGeometryPoint"===e[0].geometryType?c.callback({performAnalysis:!1,performAnalysisPopup:!0,
geometryTypes:["point"]}):"esriGeometryPolyline"===e[0].geometryType?c.callback({performAnalysis:!1,performAnalysisPopup:!0,geometryTypes:["line"]}):"esriGeometryPolygon"===e[0].geometryType&&c.callback({performAnalysis:!1,performAnalysisPopup:!0,geometryTypes:["polygon"]}):c.callback({performAnalysis:!0,performAnalysisPopup:!1});else if(1<f){a.layers&&0<a.layers.length?e=a.layers:0<a.layer.getFeatureLayers().length&&(e=a.layer.getFeatureLayers());var k=[];d.forEach(e,function(a){var b=a.graphics.length;
"esriGeometryPoint"===a.geometryType&&0<b?k.push("point"):"esriGeometryPolyline"===a.geometryType&&0<b?k.push("line"):"esriGeometryPolygon"===a.geometryType&&0<b&&k.push("polygon")},this);c.callback({performAnalysis:!1,performAnalysisPopup:!0,geometryTypes:k})}}else c.callback({performAnalysis:!1,performAnalysisPopup:!1})}));else c.callback({performAnalysis:!1,performAnalysisPopup:!1});return c}}});