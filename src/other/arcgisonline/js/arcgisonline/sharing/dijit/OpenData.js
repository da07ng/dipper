// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
require({cache:{"url:arcgisonline/sharing/dijit/templates/OpenData.html":'\x3cdiv class\x3d"${baseClass} widgetContent"\x3e\r\n  \x3ctable\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"titleColumn"\x3e\x3cspan data-dojo-attach-point\x3d"_thumbnail"\x3e\x3c/span\x3e\x3c/td\x3e\r\n        \x3ctd class\x3d"valignTop"\x3e\r\n          \x3cdiv class\x3d"section2"\x3e${i18n.description}\x3c/div\x3e\r\n\r\n          \x3cdiv class\x3d"section"\x3e\r\n            \x3cbutton data-dojo-attach-point\x3d"_enableOpenData" data-dojo-type\x3d"dijit/form/Button"\r\n                    data-dojo-attach-event\x3d"onClick:onEnableOpenData" class\x3d"calcite tertiary small"\x3e${i18n.enableLabel}\x3c/button\x3e\r\n            \x3cbutton data-dojo-attach-point\x3d"_disableOpenData" data-dojo-type\x3d"dijit/form/Button"\r\n                    data-dojo-attach-event\x3d"onClick:onDisableOpenData" class\x3d"calcite caution small"\x3e${i18n.disableLabel}\x3c/button\x3e\r\n            \x3cbutton data-dojo-attach-point\x3d"_configureBtn" data-dojo-type\x3d"dijit/form/Button"\r\n                    data-dojo-attach-event\x3d"onClick:onLaunchSite" class\x3d"calcite tertiary small"\x3e${i18n.launchSiteLabel}\x3c/button\x3e\r\n            \x3cspan data-dojo-attach-point\x3d"_spinner" style\x3d"display:none;"\x3e\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_enabledInfo" style\x3d"display:none;" class\x3d"infoSection"\x3e\r\n            \x3cdiv class\x3d"section"\x3e\r\n              ${i18n.siteUrlReminder}\x3cbr/\x3e\r\n              \x3cspan data-dojo-attach-point\x3d"_openDataUrl" class\x3d"open-data-site"\x3e\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"section"\x3e\r\n              \x3cdiv class\x3d"subSection esriFloatLeading" data-dojo-attach-point\x3d"_openDataSiteContainer"\x3e\r\n                \x3cdiv class\x3d"listTitle action"\x3e${i18n.openDataSites}\x3c/div\x3e\r\n                \x3cdiv class\x3d"list" data-dojo-attach-point\x3d"_openDataSites"\x3e\r\n                  \x3c!-- list of open data sites written here --\x3e\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n\r\n\r\n              \x3cdiv class\x3d"subSection esriFloatLeading"\x3e\r\n                \x3cdiv class\x3d"listTitle action"\x3e${i18n.openDataGroups}\x3c/div\x3e\r\n                \x3cdiv class\x3d"list" data-dojo-attach-point\x3d"_openDataGroups"\x3e\r\n                  \x3c!-- list of open data groups written here --\x3e\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"section2 clearBoth"\x3e\r\n              ${i18n.membersNote}\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"section2"\x3e\r\n              \x3cdiv class\x3d"action"\x3e${i18n.assignMembersTitle}\x3c/div\x3e\x3cbr\x3e\r\n              \x3cbutton data-dojo-attach-point\x3d"_assignToGroupsBtn" data-dojo-type\x3d"dijit/form/Button"\r\n                      data-dojo-attach-event\x3d"onClick:onAssignToGroups" class\x3d"calcite tertiary small"\x3e${i18n.assignMembers}\x3c/button\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"section"\x3e\r\n              \x3cdiv class\x3d"action"\x3e${i18n.shareContentTitle}\x3c/div\x3e\x3cbr\x3e\r\n              \x3cbutton data-dojo-attach-point\x3d"_viewContentBtn" data-dojo-type\x3d"dijit/form/Button"\r\n                      data-dojo-attach-event\x3d"onClick:onViewContent" class\x3d"calcite tertiary small"\x3e${i18n.viewContent}\x3c/button\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n'}});
define("arcgisonline/sharing/dijit/OpenData","require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojo/i18n dojo/json dojo/keys dojo/on dojo/query dojo/topic dojo/request/xhr dojo/Deferred dojo/promise/all dojo/sniff esri/lang esri/request arcgisonline/sharing/util arcgisonline/sharing/dijit/dialog/BatchAssignToGroupsDlg arcgisonline/sharing/dijit/dialog/DeleteWarningDlg arcgisonline/sharing/dijit/dialog/GeneralDlg arcgisonline/sharing/geow/Account dijit/a11yclick dijit/_Widget dijit/_Templated dijit/registry dijit/form/Button dijit/form/TextBox dijit/layout/BorderContainer dijit/layout/ContentPane dijit/layout/StackContainer dojo/i18n!arcgisonline/nls/arcgisonline dojo/text!arcgisonline/sharing/dijit/templates/OpenData.html".split(" "),
function(w,x,I,f,p,J,g,q,c,d,K,y,L,M,N,O,z,r,s,t,h,P,e,A,B,C,D,E,F,G,u,Q,R,S,T,U,v,H){return x([F,G],{declaredClass:"arcgisonline.sharing.dijit.OpenData",basePath:w.toUrl("esri/arcgisonline/sharing/dijit"),baseClass:"esriAGOOpenData",widgetsInTemplate:!0,templateString:H,organization:null,postMixInProperties:function(){this.inherited(arguments);this.i18n={};f.mixin(this.i18n,v.common);f.mixin(this.i18n,v.openData)},postCreate:function(){this.inherited(arguments)},startup:function(){this._corsConfigured=
!1;this._deleteWarningDlg=B.prototype.statics.getInstance();this._generalDlg=C.prototype.statics.getInstance();this._batchAssignToGroupsDlg=new A({initialGroupSearch:"isopendata:true"});this._initUI()},reset:function(){d.set(this._spinner,"display","none");this.organization&&h.isDefined(this.organization.portalProperties)&&h.isDefined(this.organization.portalProperties.openData)&&h.isDefined(this.organization.portalProperties.openData.enabled)&&!0===this.organization.portalProperties.openData.enabled?
this._loadOpenDataInfo():this._hideEnabledInfo()},updateOpenDataProperty:function(a){this.organization.portalProperties?this.organization.portalProperties.openData={enabled:a}:this.organization.portalProperties={openData:{enabled:a}};a=esriGeowConfig.restBaseUrl+"portals/self/update";var b={access:this.organization.access,portalProperties:y.stringify(this.organization.portalProperties)};return e.request({url:a,content:b},{usePost:!0})},disableOpenDataSites:function(){return z.put(this._openDataAPIUrl+
"status.json",{handleAs:"json",query:{"public":!1,token:e.getToken()}}).promise},_showDisableError:function(a){console.log("error disabling Open Data capabilities",a);this._hideSpinner();this._generalDlg.show({title:this.i18n.errorTitle,message:this.i18n.errors.cantDisableSite})},onEnableOpenData:function(a){var b=this;b._showSpinner();b.updateOpenDataProperty(!0).then(function(){b._hideSpinner();b._loadOpenDataInfo();b.onOpenDataEnabled()},function(a){b._hideSpinner();this._generalDlg.show({title:this.i18n.errorTitle,
message:this.i18n.cantEnableSite})})},onDisableOpenData:function(a){var b=this,m=function(){b.updateOpenDataProperty(!1).then(function(a){a&&!a.code?(b._hideSpinner(),b._hideEnabledInfo(),b.onOpenDataDisabled()):b._showDisableError(a)},function(a){b._showDisableError(a)})};this._deleteWarningDlg.showMsgTitleButton(b.i18n.messages.reallyDisableSite,b.i18n.disableLabel,b.i18n.disableLabel,f.hitch(b,function(){b._showSpinner();m()}));q.remove(u.byId("button_delete-warning-submit").domNode,"orange");
q.add(u.byId("button_delete-warning-submit").domNode,"caution")},onLaunchSite:function(a){this._openDataConfigUrl?window.open(this._openDataConfigUrl,"_blank"):esriGeowConfig.openDataUrl?window.open(esriGeowConfig.openDataUrl,"_blank"):console.log("No Open Data URL configured in the application. Config property esriGeowConfig.openDataUrl is ",esriGeowConfig.openDataUrl)},onAssignToGroups:function(a){a&&a.preventDefault();this._batchAssignToGroupsDlg.show();g.set(this._batchAssignToGroupsDlg._step2Message,
"innerHTML","\x3cstrong\x3e"+this.i18n.assignMembersGroups+"\x3c/strong\x3e")},onViewContent:function(a){a&&a.preventDefault();window.location=esriGeowConfig.baseUrl+"content.html"},onCreateOpenDataGroup:function(a){a&&a.preventDefault();var b=this,m=b.organization.name;a=m+" "+b.i18n.groupOpenData;var m=h.substitute({name:m},b.i18n.groupSummary),c={title:a,snippet:m,tags:b.i18n.groupOpenData,access:"public",isOpenData:!0,isInvitationOnly:!0,isViewOnly:!1},d;esriGeowConfig.hideDefaultCheckErrorMessage=
!0;e.request({url:esriGeowConfig.restBaseUrl+"community/createGroup",content:c},{usePost:!0}).then(function(a){delete esriGeowConfig.hideDefaultCheckErrorMessage;a&&a.success?b._loadOpenDataInfo():(console.log("unable to create group",a),d=b.i18n.errors.cantCreateGroup,a.messageCode&&"COM_0044"===a.messageCode&&(d=h.substitute({name:c.title},b.i18n.errors.groupExists)),b._generalDlg.show({title:b.i18n.errorTitle,message:d}))},function(a){delete esriGeowConfig.hideDefaultCheckErrorMessage;console.log("error creating default open data group",
a);d=b.i18n.errors.cantCreateGroup;a.messageCode&&"COM_0044"===a.messageCode&&(d=h.substitute({name:c.title},b.i18n.errors.groupExists));b._generalDlg.show({title:b.i18n.errorTitle,message:d})})},onOpenDataEnabled:function(){},onOpenDataDisabled:function(){},_showSpinner:function(){d.set(this._spinner,"display","")},_hideSpinner:function(){d.set(this._spinner,"display","none")},_configureOpenDataSiteUrl:function(){if(esriGeowConfig.self.urlKey){var a=esriGeowConfig.openDataUrl.indexOf("://"),b=esriGeowConfig.self.allSSL?
"https://":"http://";this._openDataOrgUrl=-1<a?b+esriGeowConfig.self.urlKey+"."+esriGeowConfig.openDataUrl.substring(a+3):b+esriGeowConfig.self.urlKey+"."+esriGeowConfig.openDataUrl;this._openDataConfigUrl=-1<a?"https://"+esriGeowConfig.self.urlKey+"."+esriGeowConfig.openDataUrl.substring(a+3):"https://"+esriGeowConfig.self.urlKey+"."+esriGeowConfig.openDataUrl;this._openDataAPIUrl=e.getSecureUrl(this._openDataConfigUrl.replace("/sites","/api/"));this._corsConfigured||(esri.config.defaults.io.corsEnabledServers.push(this._openDataConfigUrl.substring(0,
this._openDataConfigUrl.indexOf("/sites"))),this._corsConfigured=!0)}else this._openDataOrgUrl=this._openDataConfigUrl=esriGeowConfig.openDataUrl},_loadOpenDataInfo:function(){var a=this,b=[];a._configureOpenDataSiteUrl();10>t("ie")||6>t("trident")?d.set(a._openDataSiteContainer,"display","none"):b.push(a._retrieveOpenDataSites());b.push(a._retrieveOpenDataGroups());s(b).then(function(){a._showEnabledInfo()})},_retrieveOpenDataSites:function(){var a=this,b=new r,c=null;e.request({url:a._openDataAPIUrl+
"sites.json"}).then(function(d){d&&d.sites&&(c=d.sites);a._configureSites(c);b.resolve()},function(d){console.log("error retrieving Open Data sites",d);a._configureSites(c);b.resolve()});return b.promise},_retrieveOpenDataGroups:function(){var a=this,b=new r,c=0,d=-1,e=0,h=[],n=[],f={start:1,num:100,q:"orgid:"+a.organization.id+" isopendata:true"},g,k;a._searchGroups(f).then(function(l){if(l&&l.results)if(n=n.concat(l.results),0<l.nextStart){c=l.total-l.results.length;e=Math.ceil(c/100);for(d=l.nextStart;k<
e;k++)f.start=d+100*k,h.push(a._searchGroups(f));s(h).then(function(c){for(k=0;k<c.length;k++)g=c[k],!g.code&&!g.message&&(n=n.concat(g.results));a._configureGroups(n);b.resolve()},function(c){console.log("error retrieving the rest of the groups",c);a._configureGroups(null);b.resolve()})}else a._configureGroups(n),b.resolve();else b.resolve()},function(c){a._configureGroups(null);b.resolve()});return b.promise},_searchGroups:function(a){return e.request({url:esriGeowConfig.restBaseUrl+"community/groups",
content:a}).promise},_configureGroups:function(a){var b=this;this._batchAssignToGroupsDlg._groupSelector.set("groups",f.clone(a));b._createGroupHandle&&b._createGroupHandle.remove();g.set(b._openDataGroups,"innerHTML","");a&&0<a.length?p.forEach(a,function(a){c.create("a",{href:esriGeowConfig.baseUrl+"group.html?id\x3d"+a.id,innerHTML:a.title},c.create("span",{"class":"esriItemLinks"},b._openDataGroups));c.create("br",null,b._openDataGroups)}):(c.create("label",{innerHTML:b.i18n.noGroups},b._openDataGroups),
c.create("br",null,b._openDataGroups),a=c.create("a",{innerHTML:b.i18n.createGroup},c.create("span",{"class":"esriItemLinks clickable"},b._openDataGroups)),b._createGroupHandle=E(a,f.hitch(b,b.onCreateOpenDataGroup)))},_configureSites:function(a){var b=this;g.set(b._openDataSites,"innerHTML","");a&&0<a.length?p.forEach(a,function(a){a["public"]?c.create("a",{href:location.protocol+"//"+a.internal_url,innerHTML:a.title+" "+b.i18n.publicSite},c.create("span",{"class":"esriItemLinks"},b._openDataSites)):
c.create("span",{innerHTML:a.title+" "+b.i18n.privateSite},b._openDataSites);c.create("br",null,b._openDataSites)}):(c.create("label",{innerHTML:b.i18n.noSites},b._openDataSites),c.create("br",null,b._openDataSites),c.create("a",{href:b._openDataConfigUrl,innerHTML:b.i18n.createSite},c.create("span",{"class":"esriItemLinks"},b._openDataSites)))},_showEnabledInfo:function(){d.set(this._enableOpenData.domNode,"display","none");d.set(this._disableOpenData.domNode,"display","");d.set(this._configureBtn.domNode,
"display","");d.set(this._enabledInfo,"display","");g.set(this._openDataUrl,"innerHTML",this._openDataOrgUrl)},_hideEnabledInfo:function(){d.set(this._disableOpenData.domNode,"display","none");d.set(this._enableOpenData.domNode,"display","");d.set(this._configureBtn.domNode,"display","none");d.set(this._enabledInfo,"display","none")},_initUI:function(){var a=this;D.getSelf(function(b){a.organization=b;c.create("img",{src:e.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-open-data.png")},
a._thumbnail);c.create("img",{src:e.relativeToExplicitUrl("js/arcgisonline/css/images/spinner20.gif"),className:"spinner"},a._spinner);a.reset()})}})});