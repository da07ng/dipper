// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/OrganizationInvite",["dijit","dojo","dojox","dojo/i18n!arcgisonline/nls/arcgisonline","dojo/require!dijit/_Widget,dijit/_Templated,dijit/_WidgetBase,dijit/_TemplatedMixin,dijit/form/Button,dijit/form/ComboBox,dijit/form/SimpleTextarea,dijit/form/TextBox,dijit/form/RadioButton,dijit/layout/ContentPane,dijit/layout/TabContainer,dojo/data/ItemFileReadStore,dojo/data/ItemFileWriteStore,dojo/io/iframe,dojo/json,dojox/data/CsvStore,arcgisonline/sharing/util,arcgisonline/sharing/geow/Account,arcgisonline/sharing/geow/Geow,arcgisonline/sharing/geow/Roles,arcgisonline/sharing/dijit/DataGrid,arcgisonline/sharing/dijit/GroupSelector,arcgisonline/sharing/dijit/dialog/ChoiceDlg,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/dialog/SelectEnterpriseGroupDlg,arcgisonline/sharing/dijit/dialog/SelectEnterpriseUserDlg"],
function(h,b,s){b.provide("arcgisonline.sharing.dijit.OrganizationInvite");b.require("dijit._Widget");b.require("dijit._Templated");b.require("dijit._WidgetBase");b.require("dijit._TemplatedMixin");b.require("dijit.form.Button");b.require("dijit.form.ComboBox");b.require("dijit.form.SimpleTextarea");b.require("dijit.form.TextBox");b.require("dijit.form.RadioButton");b.require("dijit.layout.ContentPane");b.require("dijit.layout.TabContainer");b.require("dojo.data.ItemFileReadStore");b.require("dojo.data.ItemFileWriteStore");
b.require("dojo.io.iframe");b.require("dojo.json");b.require("dojox.data.CsvStore");b.require("arcgisonline.sharing.util");b.require("arcgisonline.sharing.geow.Account");b.require("arcgisonline.sharing.geow.Geow");b.require("arcgisonline.sharing.geow.Roles");b.require("arcgisonline.sharing.dijit.DataGrid");b.require("arcgisonline.sharing.dijit.GroupSelector");b.require("arcgisonline.sharing.dijit.dialog.ChoiceDlg");b.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");b.require("arcgisonline.sharing.dijit.dialog.SelectEnterpriseGroupDlg");
b.require("arcgisonline.sharing.dijit.dialog.SelectEnterpriseUserDlg");b.requireLocalization("arcgisonline","arcgisonline");b.declare("arcgisonline.sharing.dijit.OrganizationInvite",[h._Widget,h._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv data-dojo-type\x3d"dijit.layout.ContentPane" data-dojo-attach-point\x3d"containerNode" class\x3d"orgInvite"\x3e\r\n\r\n  \x3cdiv class\x3d"topButtonRow" data-dojo-attach-point\x3d"_topButtonRow"\x3e\r\n    \x3cbutton data-dojo-attach-event\x3d"onClick:onCancel" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"calcite transparent"\x3e${i18n.cancel}\x3c/button\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"mainContent" data-dojo-attach-point\x3d"_mainContent"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_step1"\x3e\r\n      \x3cdiv class\x3d"stepHeader"\x3e\r\n        \x3cdiv class\x3d"esriFloatLeading stepSprite step1"\x3e\x26nbsp;\x3c/div\x3e\x26nbsp;\x26nbsp;\r\n        \x3cdiv class\x3d"stepMessageContainer"\x3e\r\n          \x3cdiv class\x3d"stepMessage"\x3e\x3cstrong\x3e${i18n.step1.message}\x3c/strong\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cbr style\x3d"clear:both;"\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_addUsersBtn" id\x3d"addUsers" name\x3d"inviteUsers" data-dojo-type\x3d"dijit.form.RadioButton"/\x3e\x3clabel data-dojo-attach-point\x3d"_addOptionLabel" for\x3d"addUsers"\x3e\x3c/label\x3e\r\n      \x3cbr /\x3e\x3cbr /\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_createUsersBtn" id\x3d"createUsers" name\x3d"inviteUsers" checked data-dojo-type\x3d"dijit.form.RadioButton"/\x3e\x3clabel data-dojo-attach-point\x3d"_createOptionLabel" for\x3d"createUsers"\x3e\x3c/label\x3e\r\n      \x3cbr /\x3e\x3cbr /\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_inviteUsersBtn" id\x3d"inviteUsers" name\x3d"inviteUsers"  data-dojo-type\x3d"dijit.form.RadioButton"/\x3e\x3clabel data-dojo-attach-point\x3d"_inviteOptionLabel" for\x3d"inviteUsers"\x3e\x3c/label\x3e\r\n      \x3cbr /\x3e\x3cbr /\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_idpOptionDiv"\x3e\r\n        \x3cinput data-dojo-attach-point\x3d"_idpUsersBtn" id\x3d"idpUsers" name\x3d"inviteUsers" data-dojo-type\x3d"dijit.form.RadioButton"\x3e\x3clabel data-dojo-attach-point\x3d"_idpOptionLabel" for\x3d"idpUsers"\x3e\x3c/label\x3e\r\n        \x3cbr/\x3e\x3cbr/\x3e\r\n      \x3c/div\x3e\r\n      \x3cbutton class\x3d"calcite secondary small" data-dojo-type\x3d"dijit.form.Button" data-dojo-attach-event\x3d"onClick:onNext" type\x3d"button"\x3e${i18n.next}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_step1Create" style\x3d"display:none;"\x3e\r\n      \x3cdiv class\x3d"stepHeader"\x3e\r\n        \x3cdiv class\x3d"esriFloatLeading stepSprite step1"\x3e\x26nbsp;\x3c/div\x3e\x26nbsp;\x26nbsp;\r\n        \x3cdiv class\x3d"stepMessageContainer"\x3e\r\n          \x3cdiv class\x3d"stepMessage"\x3e\x3cstrong\x3e${i18n.step1Create.message}\x3c/strong\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cbr style\x3d"clear:both;"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_createTypeContainer"\x3e\r\n        \x3cinput type\x3d"radio" name\x3d"memberType" data-dojo-type\x3d"dijit.form.RadioButton" data-dojo-attach-point\x3d"_radioBuiltin" id\x3d"userTypeBuiltin" checked\x3d"checked" value\x3d"builtin"/\x3e\r\n        \x3clabel for\x3d"userTypeBuiltin"\x3e${i18n.step1Create.addBuiltin}\x3c/label\x3e\r\n        \x3cbr/\x3e\x3cbr/\x3e\r\n        \x3cinput type\x3d"radio" name\x3d"memberType" data-dojo-type\x3d"dijit.form.RadioButton" data-dojo-attach-point\x3d"_radioSAML" id\x3d"userTypeSAML" value\x3d"saml"/\x3e\r\n        \x3clabel for\x3d"userTypeSAML" data-dojo-attach-point\x3d"_radioSAMLLabel"\x3e\x3c/label\x3e\r\n        \x3cbr/\x3e\x3cbr/\x3e\r\n        \x3cinput type\x3d"radio" name\x3d"memberType" data-dojo-type\x3d"dijit.form.RadioButton" data-dojo-attach-point\x3d"_radioEnterprise" id\x3d"userTypeEnterprise"/\x3e\r\n        \x3clabel for\x3d"userTypeEnterprise" data-dojo-attach-point\x3d"_radioEnterpriseLabel"\x3e${i18n.step1Create.addEnterprise}\x3c/label\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_step2IDP" style\x3d"display:none;"\x3e\r\n      \x3cdiv class\x3d"stepHeader"\x3e\r\n        \x3cdiv class\x3d"esriFloatLeading stepSprite step2"\x3e\x26nbsp;\x3c/div\x3e\x26nbsp;\x26nbsp;\r\n        \x3cdiv class\x3d"stepMessageContainer"\x3e\r\n          \x3cdiv class\x3d"stepMessage"\x3e\x3cstrong\x3e\x3clabel data-dojo-attach-point\x3d"_step2IDPMsgLabel"\x3e\x3c/label\x3e\x3c/strong\x3e\x3c/div\x3e\r\n          \x3clabel\x3e${i18n.selectNonAdmin}\x3c/label\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cbr style\x3d"clear:both;"\x3e\r\n      \x3cdiv style\x3d"display:none;" data-dojo-attach-point\x3d"_idpErrorContainer"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_idpTabContainer"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_step2Create" style\x3d"display:none;"\x3e\r\n      \x3cdiv class\x3d"stepHeader"\x3e\r\n        \x3cdiv class\x3d"esriFloatLeading stepSprite step2"\x3e\x26nbsp;\x3c/div\x3e\x26nbsp;\x26nbsp;\r\n        \x3cdiv class\x3d"stepMessageContainer"\x3e\r\n          \x3cdiv class\x3d"stepMessage"\x3e\x3cstrong\x3e\x3clabel data-dojo-attach-point\x3d"_step2CreateMsgLabel"\x3e\x3c/label\x3e\x3c/strong\x3e\x3c/div\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"_step2CreateSubMsgLabel"\x3e${i18n.selectNonAdmin}\x3c/label\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"display:none;" data-dojo-attach-point\x3d"_createErrorContainer"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_createTabContainer"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_fixErrors" style\x3d"display:none;"\x3e\r\n      \x3cdiv class\x3d"stepHeader"\x3e\r\n        \x3cdiv class\x3d"esriFloatLeading stepSprite step2"\x3e\x26nbsp;\x3c/div\x3e\x26nbsp;\x26nbsp;\r\n        \x3cdiv class\x3d"stepMessageContainer"\x3e\r\n          \x3cdiv class\x3d"stepMessage"\x3e\x3cstrong\x3e\x3clabel data-dojo-attach-point\x3d"_fixErrorsMsgLabel"\x3e\x3c/label\x3e\x3c/strong\x3e\x3c/div\x3e\r\n          \x3clabel\x3e${i18n.selectNonAdmin}\x3c/label\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"display:none;" data-dojo-attach-point\x3d"_fixErrorsErrorContainer"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_fixErrorsContainer"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_step2Invite" style\x3d"display:none;"\x3e\r\n      \x3cdiv class\x3d"stepHeader"\x3e\r\n        \x3cdiv class\x3d"esriFloatLeading stepSprite step2"\x3e\x26nbsp;\x3c/div\x3e\x26nbsp;\x26nbsp;\r\n        \x3cdiv class\x3d"stepMessageContainer"\x3e\r\n          \x3cdiv class\x3d"stepMessage"\x3e\x3cstrong\x3e\x3clabel data-dojo-attach-point\x3d"_step2InviteLabel"\x3e${i18n.step3.message}\x3c/label\x3e\x3c/strong\x3e\x3c/div\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"_step2InviteSubLabel"\x3e\x3c/label\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"display:none;" data-dojo-attach-point\x3d"_inviteErrorContainer"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_inviteTabContainer"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_step3" style\x3d"display:none; width:762px; height:350px;"\x3e\r\n      \x3cdiv class\x3d"stepHeader"\x3e\r\n        \x3cdiv class\x3d"esriFloatLeading stepSprite step3"\x3e\x26nbsp;\x3c/div\x3e\x26nbsp;\x26nbsp;\r\n        \x3cdiv class\x3d"stepMessageContainer"\x3e\r\n          \x3cdiv class\x3d"stepMessage"\x3e\x3cstrong\x3e\x3clabel data-dojo-attach-point\x3d"_step3Message"\x3e${i18n.step3.message}\x3c/label\x3e\x3c/strong\x3e\x3c/div\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"_step3SubMessage"\x3e\x3c/label\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"display:none;" data-dojo-attach-point\x3d"_ReviewErrorContainer"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit.layout.BorderContainer" design\x3d"headline" gutters\x3d"false" preventcache\x3d"true" usecache\x3d"false" cachecontent\x3d"false" region\x3d"center" class\x3d"borderedContent" style\x3d"width:100%; height:242px;"\x3e\r\n        \x3cdiv id\x3d"userGridContainer" data-dojo-type\x3d"dijit.layout.ContentPane" region\x3d"center" style\x3d"width:100%; height:100%;"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"step3ButtonRow" class\x3d"esriAlignTrailing"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_backInvitations" data-dojo-attach-event\x3d"onClick:onBackInvitations" class\x3d"calcite default small" data-dojo-type\x3d"dijit.form.Button" type\x3d"button"\x3e${i18n.backLabel}\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:none;" data-dojo-attach-point\x3d"_groupSelection" data-dojo-attach-event\x3d"onClick:onGroupSelection" class\x3d"calcite tertiary small" data-dojo-type\x3d"dijit.form.Button" type\x3d"button"\x3e${i18n.step3.specifyGroups}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_sendInvitations" data-dojo-attach-event\x3d"onClick:onSendInvitations" class\x3d"calcite secondary small" data-dojo-type\x3d"dijit.form.Button" type\x3d"button"\x3e${i18n.step3.sendInvitations}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_step4" style\x3d"display:none;" class\x3d"specifyGroups"\x3e\r\n      \x3cdiv class\x3d"stepHeader"\x3e\r\n        \x3cdiv class\x3d"esriFloatLeading stepSprite step4"\x3e\x26nbsp;\x3c/div\x3e\x26nbsp;\x26nbsp;\r\n        \x3cdiv class\x3d"stepMessageContainer"\x3e\r\n          \x3cdiv class\x3d"stepMessage"\x3e\x3cstrong\x3e\x3clabel data-dojo-attach-point\x3d"_step4Message"\x3e${i18n.step4.message}\x3c/label\x3e\x3c/strong\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_groupSelector" data-dojo-type\x3d"arcgisonline.sharing.dijit.GroupSelector"\r\n           data-dojo-props\x3d"autoLoad: true, excludeEnterpriseGroups: true" class\x3d"marginBottom15"\x3e\x3c/div\x3e\r\n      \x3cdiv id\x3d"step4ButtonRow" class\x3d"esriAlignTrailing"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_backGroups" data-dojo-attach-event\x3d"onClick:onBackGroups" class\x3d"calcite default small" data-dojo-type\x3d"dijit.form.Button" type\x3d"button"\x3e${i18n.backLabel}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_sendGroupInvitations" data-dojo-attach-event\x3d"onClick:onSendInvitations" class\x3d"calcite secondary small" data-dojo-type\x3d"dijit.form.Button" type\x3d"button"\x3e${i18n.step3.sendInvitations}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_completed" style\x3d"display:none;"\x3e\r\n      \x3cp\x3e\x3cstrong\x3e${i18n.completed.title}\x3c/strong\x3e\x3c/p\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"_completedMessageSpan"\x3e\x3cimg alt\x3d"success" data-dojo-attach-point\x3d"_completeCheckIcon" class\x3d"completeSuccess"/\x3e \x3cspan data-dojo-attach-point\x3d"_completedMessage"\x3e\x3c/span\x3e\x3c/span\x3e\x3cbr/\x3e\x3cbr/\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_uninvitedMessageSpan" style\x3d"display:none;"\x3e\x3cdiv data-dojo-attach-point\x3d"_uninvitedMessage" style\x3d"color:red;"\x3e\x3c/div\x3e\x3cbr/\x3e\x3cbr/\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_existedUserMessageSpan" style\x3d"display:none;"\x3e\x3cdiv data-dojo-attach-point\x3d"_existedUserMessage" style\x3d"color:red;"\x3e\x3c/div\x3e\x3cbr/\x3e\x3cbr/\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_inviteMoreBtn" data-dojo-attach-event\x3d"onClick:onInviteMoreClicked" class\x3d"calcite tertiary small" data-dojo-type\x3d"dijit.form.Button" type\x3d"button"\x3e${i18n.completed.inviteAnother}\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_returnToOrgBtn" data-dojo-attach-event\x3d"onClick:onReturnToOrgClicked" class\x3d"calcite blue small" data-dojo-type\x3d"dijit.form.Button" type\x3d"button"\x3e${i18n.completed.returnToOrg}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e\r\n',
_util:arcgisonline.sharing.util,_account:arcgisonline.sharing.geow.Account,_geow:arcgisonline.sharing.geow.Geow,_user:null,_settings:null,_mode:null,_isPortal:!1,_currentIDP:null,_supportsEnterpriseGroups:!1,_supportsSAML:!1,_supportsWindows:!1,_supportsLDAP:!1,_portalDefaultUser:"account_user",_topButtonRow:null,_mainContent:null,_step1:null,_idpOptionDiv:null,_idpOptionLabel:null,_createOptionLabel:null,_inviteOptionLabel:null,_idpUsersBtn:null,_createUsersBtn:null,_inviteUsersBtn:null,_createUsersBtnContainer:null,
_createTypeContainer:null,_nextBtn:null,_step1Create:null,_userType:null,_radioBuiltin:null,_radioSAML:null,_radioSAMLLabel:null,_radioEnterprise:null,_radioEnterpriseLabel:null,_step2IDP:null,_step2IDPMsgLabel:null,_idpErrorContainer:null,_idpTabContainer:null,_idpTabs:null,_idpSingleTab:null,_idpSingleEmail:null,_idpSingleRole:null,_idpSingleRoleStore:null,_idpSingleMessage:null,_idpSingleInviteBtn:null,_idpSingleReviewBtn:null,_idpBatchTab:null,_idpBatchForm:null,_idpBatchFile:null,_idpBatchMessage:null,
_idpBatchUploadBtn:null,_currentSelectedIDPRole:null,_currentIDPMessage:null,_editingIDP:!1,_editingIDPUser:null,_addMode:!1,_step2Create:null,_step2CreateMsgLabel:null,_createErrorContainer:null,_createTabContainer:null,_createTabs:null,_createSingleTab:null,_createSingleEmail:null,_createSingleFirstName:null,_createSingleLastName:null,_createSingleUsername:null,_createSingleRole:null,_createSingleRoleStore:null,_createSingleMessage:null,_createSingleInviteBtn:null,_createSingleReviewBtn:null,_createBatchTab:null,
_createBatchFile:null,_createBatchMessage:null,_createBatchUploadBtn:null,_createEnterpriseTab:null,_createEnterpriseGroup:null,_createEnterpriseSearchBtn:null,_createGroupRole:null,_createGroupRoleStore:null,_createGroupMessage:null,_createGroupReviewBtn:null,_createEnterpriseUser:null,_createUserInviteBtn:null,_createUserReviewBtn:null,_createUserBackBtn:null,_currentSelectedCreateRole:null,_currentCreateMessage:null,_editingCreate:!1,_editingCreateUser:null,_settingCreateSingleEmail:!1,_settingCreateSingleUser:!1,
_fixErrors:null,_fixErrorsMsgLabel:null,_fixErrorsErrorContainer:null,_fixErrorsContainer:null,_fixErrorsContentPane:null,_fixAlertDiv:null,_fixAlert:null,_fixBackBtn:null,_fixBtn:null,_fixReviewBtn:null,_fixEditDiv:null,_fixCurrent:null,_fixEmail:null,_fixFirstName:null,_fixLastName:null,_fixUsername:null,_fixPassword:null,_fixRoleStore:null,_fixRole:null,_fixNextBtn:null,_minUsernameLength:6,_maxUsernameLength:128,_maxSAMLUsernameLength:128,_minPasswordLength:8,_maxPasswordLength:28,_numToFix:0,
_totalUsers:0,_fixingNumber:0,_currentlyFixing:null,_settingFixEmail:null,_settingFixUsername:null,_step2Invite:null,_step2InviteLabel:null,_inviteErrorContainer:null,_inviteTabContainer:null,_inviteTabs:null,_inviteSingleTab:null,_inviteSingleEmail:null,_inviteSingleRole:null,_inviteSingleRoleStore:null,_inviteSingleMessage:null,_inviteSingleInviteBtn:null,_inviteSingleReviewBtn:null,_inviteBatchTab:null,_inviteBatchForm:null,_inviteBatchFile:null,_inviteBatchMessage:null,_inviteBatchUploadBtn:null,
_currentSelectedInviteRole:null,_currentInviteMessage:null,_editingInvite:!1,_editingInviteUser:null,_step3:null,_userStore:null,_userGrid:null,_sendInvitations:null,_userLimitReached:!1,_userCount:0,_ReviewErrorContainer:null,_completed:null,_completedMessage:null,_completedMessageSpan:null,_uninvitedMessageSpan:null,_uninvitedMessage:null,_inviteMoreBtn:null,_returnToOrgBtn:null,_completeCheckIcon:null,_existedUserMessage:null,_existedUserMessageSpan:null,_invitingUser:null,accountAdminRole:"account_admin",
accountPublisherRole:"account_publisher",accountUserRole:"account_user",orgAdminRole:"org_admin",orgPublisherRole:"org_publisher",orgUserRole:"org_user",modeIDP:"idp",modeCreate:"create",modeInvite:"invite",maxUsersPerInvite:25,userInviteLimitBeforeSplit:200,arcgisUserType:"arcgisonly",arcgisProvider:"arcgis",enterpriseProvider:"enterprise",i18n:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=b.i18n.getLocalization("arcgisonline","arcgisonline").common;b.mixin(this.i18n,b.i18n.getLocalization("arcgisonline",
"arcgisonline").organizationInvite)},postCreate:function(){esriGeowConfig.isRightToLeft&&(b.addClass(this._mainContent,"mainContentRtl"),b.removeClass(this._mainContent,"mainContent"),b.addClass(this._topButtonRow,"topButtonRowRtl"),b.removeClass(this._topButtonRow,"topButtonRow"));this._completeCheckIcon&&b.attr(this._completeCheckIcon,"src",this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/check.png"))},startup:function(){esri.config.defaults.io.proxyUrl=esriGeowConfig.proxyServer;
esriGeowConfig.proxyUrl&&(esri.config.defaults.io.proxyUrl=esriGeowConfig.proxyUrl);this._rolesAPI=new arcgisonline.sharing.geow.Roles;this.hide();this._user=this._util.getUser();this._createUsersBtn.set("disabled",!0);this._inviteUsersBtn.set("disabled",!0);this._account.getSelf(b.hitch(this,this.handleGetSelf),b.hitch(this,this.handleGetSelf))},_getTenantTypeString:function(){return this._isPortal?this.i18n.portalType:this.i18n.organizationType},_createTable:function(a){return b.create("tbody",
null,b.create("table",{style:{width:"100%"}},a))},_createSpacerRow:function(a){a=b.create("tr",null,a);b.create("td",{innerHTML:"\x26nbsp;"},a);return a},_checkEnterpriseGroupStore:function(){var a=new b.Deferred,e=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))+"/portaladmin/security/config",c;this._isPortal?this._util.request({url:e}).then(b.hitch(this,function(b){b&&b.defaultRoleForUser&&(this._portalDefaultUser=b.defaultRoleForUser);b&&(b.groupStoreConfig&&b.groupStoreConfig.type)&&
(c=b.groupStoreConfig.type.toLowerCase(),"builtin"!==c&&"saml"!==c&&(this._isWindowsGroupStore="windows"===c,this._supportsEnterpriseGroups=!0),"windows"===c&&(this._supportsWindows=!0),"ldap"===c&&(this._supportsLDAP=!0));b&&(b.userStoreConfig&&b.userStoreConfig.type)&&(c=b.userStoreConfig.type.toLowerCase(),"windows"===c&&(this._supportsWindows=!0),"ldap"===c&&(this._supportsLDAP=!0));a.resolve()}),b.hitch(this,function(b){a.resolve()})):a.resolve();return a},buildFixErrors:function(){var a=b.create,
e=a("div");this._fixAlertDiv=a("div",null,e);var c=a("span",null,a("div",null,this._fixAlertDiv));a("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/exclamation.png"),alt:"",style:{"vertical-align":"middle"}},c);var d=esri.substitute({x:this._numToFix,n:this._totalUsers,name:this._isPortal?this._settings.name:this.i18n.arcgis},this._addMode?this.i18n.fixErrors.needAttentionAdd:this.i18n.fixErrors.needAttention);this._fixAlert=a("span",{innerHTML:" "+d},c);a("p",
{innerHTML:this.i18n.fixErrors.ifNoFix},this._fixAlertDiv);this._fixBackBtn=new h.form.Button({type:"button",label:this.i18n.backLabel},a("div",null,this._fixAlertDiv));b.addClass(this._fixBackBtn.domNode,"calcite default small");this._fixBtn=new h.form.Button({type:"button",label:this.i18n.fixErrors.fixTheseIssues},a("div",null,this._fixAlertDiv));b.addClass(this._fixBtn.domNode,"calcite secondary small");this._fixEditDiv=a("div",null,e);c=a("tbody",null,a("table",null,this._fixEditDiv));this._createSpacerRow(c);
var d=a("tr",null,c),d=a("td",{colSpan:"2"},d),f=esri.substitute({x:this._fixingNumber,n:this._numToFix,name:this._isPortal?this._settings.name:this.i18n.arcgis},this._addMode?this.i18n.fixErrors.usersNeedAttentionAdd:this.i18n.fixErrors.usersNeedAttention);this._fixCurrent=a("span",{innerHTML:f},d);this._createSpacerRow(c);if("builtin"===this._userType||"saml"===this._userType||!this._isPortal)d=a("tr",null,c),a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+
this.i18n.fixErrors.email+"\x3c/strong\x3e"},d),d=a("td",null,d),this._fixEmail=new h.form.TextBox({trim:!0,type:"text"},a("div",null,d)),this._createSpacerRow(c),"ja"===b.locale?(d=a("tr",null,c),a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.fixErrors.lastName+"\x3c/strong\x3e"},d),d=a("td",null,d),this._fixLastName=new h.form.TextBox({trim:!0,type:"text"},a("div",null,d)),this._createSpacerRow(c),d=a("tr",null,c),a("td",{className:esriGeowConfig.isRightToLeft?
"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.fixErrors.firstName+"\x3c/strong\x3e"},d),d=a("td",null,d),this._fixFirstName=new h.form.TextBox({trim:!0,type:"text"},a("div",null,d))):(d=a("tr",null,c),a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.fixErrors.firstName+"\x3c/strong\x3e"},d),d=a("td",null,d),this._fixFirstName=new h.form.TextBox({trim:!0,type:"text"},a("div",null,d)),this._createSpacerRow(c),d=a("tr",null,
c),a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.fixErrors.lastName+"\x3c/strong\x3e"},d),d=a("td",null,d),this._fixLastName=new h.form.TextBox({trim:!0,type:"text"},a("div",null,d))),this._createSpacerRow(c);d=a("tr",null,c);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.fixErrors.username+"\x3c/strong\x3e"},d);d=a("td",null,d);this._fixUsername=new h.form.TextBox({trim:!0,
type:"text"},a("div",null,d));this._createSpacerRow(c);if("builtin"===this._userType||!this._isPortal)this._fixPasswordRow=a("tr",null,c),a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.fixErrors.password+"\x3c/strong\x3e"},this._fixPasswordRow),d=a("td",null,this._fixPasswordRow),this._fixPassword=new h.form.TextBox({trim:!0,type:"password"},a("div",null,d)),this._fixPasswordSpacer=this._createSpacerRow(c);d=a("tr",null,c);a("td",{className:esriGeowConfig.isRightToLeft?
"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.fixErrors.role+"\x3c/strong\x3e"},d);d=a("td",null,d);this._fixRoleStore=new b.data.ItemFileReadStore({data:{identifier:"role",label:"name",items:this._roleItems}});this._fixRoleStore.comparatorMap={name:arcgisonline.sharing.geow.Account.caseInsensitiveComparator};this._fixRole=new h.form.ComboBox({store:this._fixRoleStore,searchAttr:"name",fetchProperties:{sort:[{attribute:"name",descending:!1}]},style:{width:"125px",marginLeft:"0"}},
a("div",null,d));this._isPortal?(this._fixRole.set("value",this._lookupFullRoleName(this._portalDefaultUser)),this._fixRole.set("title",this.getRoleDesc(this._portalDefaultUser))):(this._fixRole.set("value",this.i18n.userRoles.user),this._fixRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip)));this._createSpacerRow(c);c=a("tr",null,c);c=a("td",{colSpan:"2",style:{"text-align":"right"}},c);this._fixNextBtn=new h.form.Button({type:"button",label:this.i18n.fixErrors.next},
a("div",null,c));b.addClass(this._fixNextBtn.domNode,"calcite blue small");b.connect(this._fixBackBtn,"onClick",this,this.onFixBackClicked);b.connect(this._fixBtn,"onClick",this,this.onFixClicked);b.connect(this._fixEmail,"onChange",this,this.onFixEmailChanged);b.connect(this._fixUsername,"onChange",this,this.onFixUsernameChanged);this._fixPassword&&b.connect(this._fixPassword,"onChange",this,this.onFixPasswordChanged);b.connect(this._fixNextBtn,"onClick",this,this.onFixNextClicked);b.connect(this._fixRole,
"onChange",this,this.onFixSingleRoleChanged);b.style(this._fixEditDiv,"display","none");this._fixErrorsContentPane=new h.layout.ContentPane({content:e},this._fixErrorsContainer)},buildCreateTabs:function(){var a=b.create;this._createTabs=new h.layout.TabContainer({tabPosition:"top",doLayout:!1,useMenu:!1,style:{width:"490px",height:"420px"}},this._createTabContainer);var e=a("div");b.addClass(e,"tabForm");var c=this._createTable(e);this._createSpacerRow(c);if(this._isPortal&&"saml"===this._userType){var d=
a("tr",null,c);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.addSAML+"\x3c/strong\x3e",colspan:2},d);this._createSpacerRow(c)}d=a("tr",null,c);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.email+"\x3c/strong\x3e"},d);d=a("td",null,d);this._createSingleEmail=new h.form.TextBox({trim:!0,type:"text"},a("div",null,d));this._createSpacerRow(c);"ja"===b.locale?
(d=a("tr",null,c),a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.lastName+"\x3c/strong\x3e"},d),d=a("td",null,d),this._createSingleLastName=new h.form.TextBox({trim:!0,type:"text"},a("div",null,d)),this._createSpacerRow(c),d=a("tr",null,c),a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.firstName+"\x3c/strong\x3e"},d),d=a("td",null,d),this._createSingleFirstName=
new h.form.TextBox({trim:!0,type:"text"},a("div",null,d))):(d=a("tr",null,c),a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.firstName+"\x3c/strong\x3e"},d),d=a("td",null,d),this._createSingleFirstName=new h.form.TextBox({trim:!0,type:"text"},a("div",null,d)),this._createSpacerRow(c),d=a("tr",null,c),a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.lastName+
"\x3c/strong\x3e"},d),d=a("td",null,d),this._createSingleLastName=new h.form.TextBox({trim:!0,type:"text"},a("div",null,d)));this._createSpacerRow(c);d=a("tr",null,c);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.username+"\x3c/strong\x3e"},d);d=a("td",null,d);this._createSingleUsername=new h.form.TextBox({trim:!0,type:"text"},a("div",null,d));this._createSpacerRow(c);if("builtin"===this._userType||!this._isPortal)this._createSinglePasswordRow=
a("tr",null,c),a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.password+"\x3c/strong\x3e"},this._createSinglePasswordRow),d=a("td",null,this._createSinglePasswordRow),this._createSinglePassword=new h.form.TextBox({trim:!0,type:"password"},a("div",null,d)),this._createSinglePasswordSpacer=this._createSpacerRow(c);d=a("tr",null,c);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+
this.i18n.step2Create.role+"\x3c/strong\x3e"},d);d=a("td",null,d);this._createSingleRoleStore=new b.data.ItemFileReadStore({data:{identifier:"role",label:"name",items:this._roleItems}});this._createSingleRoleStore.comparatorMap={name:arcgisonline.sharing.geow.Account.caseInsensitiveComparator};this._createSingleRole=new h.form.ComboBox({store:this._createSingleRoleStore,searchAttr:"name",fetchProperties:{sort:[{attribute:"name",descending:!1}]},style:{width:"125px",marginLeft:"0"}},a("div",null,d));
this._isPortal?(this._createSingleRole.set("value",this._lookupFullRoleName(this._portalDefaultUser)),this._createSingleRole.set("title",this.getRoleDesc(this._portalDefaultUser))):(this._createSingleRole.set("value",this.i18n.userRoles.user),this._createSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip)));this._createSpacerRow(c);this._createSingleMsgRow=a("tr",{style:{display:this._addMode?"none":""}},c);a("td",{className:esriGeowConfig.isRightToLeft?
"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.userMessage+"\x3c/strong\x3e"},this._createSingleMsgRow);d=a("td",null,this._createSingleMsgRow);this._createSingleMessage=new h.form.SimpleTextarea({width:"290px",height:"80px",rows:5,style:{resize:"no"}},a("div",null,d));var d=esriGeowConfig.portalName||this.i18n.arcgis,f=esri.substitute({user:this.createFullName(this._user),organization:this._settings.name,portalName:d},this.i18n.step2Create.emailMessage);this._isPortal&&
(f=esri.substitute({user:this.createFullName(this._user),organization:this._settings.name},this.i18n.step2Create.emailPortalMessage));this._createSingleMessage.set("value",f);this._createSpacerRow(c);c=a("tr",null,c);c=a("td",{colSpan:"2",className:"esriAlignTrailing"},c);this._createSingleBackBtn=new h.form.Button({label:this.i18n.backLabel},a("div",null,c));b.addClass(this._createSingleBackBtn.domNode,"calcite default small");this._createSingleInviteBtn=new h.form.Button({label:this._isPortal?this.i18n.step2Create.addAnother:
this.i18n.step2Create.inviteAnother},a("div",null,c));this._createSingleReviewBtn=new h.form.Button({label:this._isPortal?this.i18n.step2Create.reviewAddition:this.i18n.step2Create.reviewInvitation},a("div",null,c));b.addClass(this._createSingleInviteBtn.domNode,"calcite tertiary small");b.addClass(this._createSingleReviewBtn.domNode,"calcite secondary small");var c=b.create("div"),f={firstNameHeader:this.i18n.csv.firstName,lastNameHeader:this.i18n.csv.lastName,emailHeader:this.i18n.csv.email,roleHeader:this.i18n.csv.role,
usernameHeader:this.i18n.csv.username,passwordHeader:this.i18n.csv.password},g=esri.substitute(f,this._addMode?this.i18n.step2Create.uploadCSVAdd:this.i18n.step2Create.uploadCSV);this._isPortal&&(g=esri.substitute(f,"saml"===this._userType?this.i18n.step2Create.uploadCSVAddSAML:"builtin"===this._userType?this.i18n.step2Create.uploadCSVPortal:this.i18n.step2Create.uploadCSVAddAD));"saml"===this._userType?a("div",{className:"uploadDesc",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.addSAML+"\x3c/strong\x3e"},
c):"windows"===this._userType?a("div",{className:"uploadDesc",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.addAD+"\x3c/strong\x3e"},c):"ldap"===this._userType&&a("div",{className:"uploadDesc",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.addLDAP+"\x3c/strong\x3e"},c);this._createUploadMsg=a("div",{className:"uploadDesc",innerHTML:g},c);this._createBatchForm=b.create("form",{id:"createBatchForm",enctype:"multipart/form-data",method:"post",onSubmit:"return false;"},c);9>b.isIE&&(this._createBatchForm.encoding=
"multipart/form-data");f=this._createTable(this._createBatchForm);this._createSpacerRow(f);g=a("tr",null,f);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.file+"\x3c/strong\x3e"},g);g=a("td",null,g);g=a("span",null,g);this._createBatchFile=new h.form.TextBox({type:"file",name:"file"},a("div",null,g));this._createSpacerRow(f);this._createBatchMsgRow=a("tr",{style:{display:this._addMode?"none":""}},f);a("td",{className:esriGeowConfig.isRightToLeft?
"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.allUsersMessage+"\x3c/strong\x3e"},this._createBatchMsgRow);g=a("td",null,this._createBatchMsgRow);this._createBatchMessage=new h.form.SimpleTextarea({width:"290px",height:"80px",rows:5,style:{resize:"no"}},a("div",null,g));d=esri.substitute({user:this.createFullName(this._user),organization:this._settings.name,portalName:d},this.i18n.step2Create.emailMessage);this._isPortal&&(d=esri.substitute({user:this.createFullName(this._user),
organization:this._settings.name},this.i18n.step2Create.emailPortalMessage));this._createBatchMessage.set("value",d);this._createSpacerRow(f);d=a("td",{colSpan:"2",className:"esriAlignTrailing"},a("tr",null,f));this._createBatchUploadBtn=new h.form.Button({type:"submit",label:this._addMode||this._isPortal?this.i18n.step2Create.uploadAndReviewAdd:this.i18n.step2Create.uploadAndReview},a("div",null,d));b.addClass(this._createBatchUploadBtn.domNode,"calcite blue small");this._createSpacerRow(f);this._createBatchTab=
new h.layout.ContentPane({title:this.i18n.step2Create.batchTab,selected:!1,content:c});c=a("div");b.addClass(c,"tabForm");d=this._createTable(c);this._createSpacerRow(d);f=a("tr",null,d);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+("windows"===this._userType?this.i18n.step2Create.addAD:this.i18n.step2Create.addLDAP)+"\x3c/strong\x3e",colspan:2},f);this._createSpacerRow(d);f=a("tr",null,d);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":
"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.username+"\x3c/strong\x3e"},f);f=a("td",null,f);f=a("span",{style:{position:"relative"}},f);this._createEnterpriseUser=new h.form.TextBox({type:"text",placeHolder:this.i18n.step2Create.userPlaceholder},a("div",null,f));this._createEnterpriseUserSearchBtn=new h.form.Button({type:"button",style:{position:"absolute"}},a("div",null,f));b.addClass(this._createEnterpriseUser.domNode,"enterpriseGroupSearchInput");b.addClass(this._createEnterpriseUserSearchBtn.domNode,
"calcite userSearchIcon");b.addClass(this._createEnterpriseUserSearchBtn.domNode,"searchIconTrailing");this._createSpacerRow(d);f=a("tr",null,d);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.role+"\x3c/strong\x3e"},f);f=a("td",null,f);this._createUserRoleStore=new b.data.ItemFileReadStore({data:{identifier:"role",label:"name",items:this._roleItems}});this._createUserRole=new h.form.ComboBox({store:this._createUserRoleStore,
style:{width:"125px",marginLeft:"0"}},a("div",null,f));this._isPortal?(this._createUserRole.set("value",this._lookupFullRoleName(this._portalDefaultUser)),this._createUserRole.set("title",this.getRoleDesc(this._portalDefaultUser))):(this._createUserRole.set("value",this.i18n.userRoles.user),this._createUserRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip)));this._createSpacerRow(d);f=a("tr",null,d);f=a("td",{colSpan:"3",className:"esriAlignTrailing"},f);
this._createUserBackBtn=new h.form.Button({label:this.i18n.backLabel},a("div",null,f));b.addClass(this._createUserBackBtn.domNode,"calcite default small");this._createUserInviteBtn=new h.form.Button({label:this.i18n.step2Create.addAnother},a("div",null,f));this._createUserReviewBtn=new h.form.Button({label:this.i18n.step2Create.reviewAddition},a("div",null,f));b.addClass(this._createUserInviteBtn.domNode,"calcite tertiary small");b.addClass(this._createUserReviewBtn.domNode,"calcite secondary small");
b.create("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/css/images/spinner20.gif"),width:"14",height:"14",style:{verticalAlign:"middle"}},a("span",{id:"reviewSpinnerUser",style:{display:"none"},innerHTML:" "},a("span",null,f)));this._createSpacerRow(d);d=a("div");b.addClass(d,"tabForm");a("div",{className:"uploadDesc",innerHTML:this.i18n.step2Create.selectGroup},d);f=this._createTable(d);this._createSpacerRow(f);g=a("tr",null,f);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":
"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.enterpriseGroup+"\x3c/strong\x3e"},g);g=a("td",null,g);g=a("span",{style:{position:"relative"}},g);this._createEnterpriseGroup=new h.form.TextBox({type:"text",placeHolder:this.i18n.step2Create.namePlaceholder},a("div",null,g));this._createEnterpriseSearchBtn=new h.form.Button({type:"button",style:{position:"absolute"}},a("div",null,g));b.addClass(this._createEnterpriseGroup.domNode,"enterpriseGroupSearchInput");b.addClass(this._createEnterpriseSearchBtn.domNode,
"calcite userSearchIcon");b.addClass(this._createEnterpriseSearchBtn.domNode,"searchIconTrailing");this._createSpacerRow(f);g=a("tr",null,f);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Create.role+"\x3c/strong\x3e"},g);g=a("td",null,g);this._createGroupRoleStore=new b.data.ItemFileReadStore({data:{identifier:"role",label:"name",items:this._roleItems}});this._createGroupRoleStore.comparatorMap={name:arcgisonline.sharing.geow.Account.caseInsensitiveComparator};
this._createGroupRole=new h.form.ComboBox({store:this._createGroupRoleStore,searchAttr:"name",fetchProperties:{sort:[{attribute:"name",descending:!1}]},style:{width:"125px",marginLeft:"0"}},a("div",null,g));this._isPortal?(this._createGroupRole.set("value",this._lookupFullRoleName(this._portalDefaultUser)),this._createGroupRole.set("title",this.getRoleDesc(this._portalDefaultUser))):(this._createGroupRole.set("value",this.i18n.userRoles.user),this._createGroupRole.set("title",esri.substitute({type:this._getTenantTypeString()},
this.i18n.userRoleTooltip)));this._createSpacerRow(f);this._createSpacerRow(f);g=a("tr",null,f);g=a("td",{colSpan:"2",className:"esriAlignTrailing"},g);this._createGroupReviewBtn=new h.form.Button({label:this.i18n.step2Create.reviewAddition},a("div",null,g));b.addClass(this._createGroupReviewBtn.domNode,"calcite blue small");b.create("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/css/images/spinner20.gif"),width:"14",height:"14",style:{verticalAlign:"middle"}},a("span",{id:"reviewSpinner",
style:{display:"none"},innerHTML:" "},a("span",null,g)));this._createSpacerRow(f);this._createEnterpriseTab=new h.layout.ContentPane({title:this.i18n.step2Create.enterpriseTab,selected:!1,content:d});b.connect(this._createBatchFile,"onClick",b.hitch(this,function(){this.resetCreateErrorMessage()}));("builtin"===this._userType||!this._isPortal)&&b.connect(this._createSingleEmail,"onChange",this,this.onCreateEmailChanged);b.connect(this._createSingleUsername,"onChange",this,this.onCreateUsernameChanged);
this._createSinglePassword&&b.connect(this._createSinglePassword,"onChange",this,this.onCreatePasswordChanged);b.connect(this._createBatchForm,"onSubmit",function(){return!1});b.connect(this._createBatchForm,"onsubmit",this,this.onCreateBatchSubmit);b.connect(this._createEnterpriseGroup,"onKeyDown",this,this.onCreateEnterpriseGroupKeyDown);b.connect(this._createEnterpriseSearchBtn,"onClick",this,this.onSelectEnterpriseGroup);b.connect(this._createEnterpriseUser,"onKeyDown",this,this.onCreateEnterpriseUserKeyDown);
b.connect(this._createEnterpriseUserSearchBtn,"onClick",this,this.onSelectEnterpriseUser);this._isPortal?b.connect(this._createSingleBackBtn,"onClick",this,this.onBackToStartPortal):b.connect(this._createSingleBackBtn,"onClick",this,this.onBackToStart);b.connect(this._createUserBackBtn,"onClick",this,this.onBackToStartPortal);b.connect(this._createSingleInviteBtn,"onClick",this,this.onCreateAnotherClicked);b.connect(this._createSingleReviewBtn,"onClick",this,this.onCreateReviewClicked);b.connect(this._createSingleRole,
"onChange",this,this.onCreateSingleRoleChanged);b.connect(this._createGroupReviewBtn,"onClick",this,this.onCreateGroupReviewClicked);b.connect(this._createUserInviteBtn,"onClick",this,this.onCreateAnotherUserClicked);b.connect(this._createUserReviewBtn,"onClick",this,this.onCreateUserReviewClicked);b.subscribe("enterprise-group-selected",b.hitch(this,function(a){this._createEnterpriseGroup.set("value",a.rolename)}));b.subscribe("enterprise-user-selected",b.hitch(this,function(a){this._createEnterpriseUser.set("value",
a.username)}));this._createSingleTab=this._isPortal&&("ldap"===this._userType||"windows"===this._userType)?new h.layout.ContentPane({title:this.i18n.step2Create.singleTab,selected:!0,className:"tabForm",content:c}):new h.layout.ContentPane({title:this.i18n.step2Create.singleTab,selected:!0,className:"tabForm",content:e});this._createTabs.addChild(this._createSingleTab);this._createTabs.addChild(this._createBatchTab);if(this._isPortal&&this._supportsEnterpriseGroups&&("ldap"===this._userType||"windows"===
this._userType))this._createTabs.addChild(this._createEnterpriseTab),b.attr(b.byId("item-title"),"innerHTML",this.i18n.docPortalTitle);this._createTabs.startup();(b.isIos||b.isAndroid)&&b.style(this._createBatchTab.controlButton.domNode,{display:"none"})},buildIDPTabs:function(){var a=b.create;this._idpTabs=new h.layout.TabContainer({tabPosition:"top",doLayout:!1,useMenu:!1,style:{width:"490px",height:"380px"}},this._idpTabContainer);var e=a("div"),c=this._createTable(e);this._createSpacerRow(c);
var d=a("tr",null,c);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2IDP.email+"\x3c/strong\x3e"},d);d=a("td",null,d);this._idpSingleEmail=new h.form.TextBox({trim:!0,type:"text"},a("div",null,d));this._createSpacerRow(c);d=a("tr",null,c);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2IDP.role+"\x3c/strong\x3e"},d);d=a("td",null,d);this._idpSingleRoleStore=new b.data.ItemFileReadStore({data:{identifier:"role",
label:"name",items:this._roleItems}});this._idpSingleRoleStore.comparatorMap={name:arcgisonline.sharing.geow.Account.caseInsensitiveComparator};this._idpSingleRole=new h.form.ComboBox({store:this._idpSingleRoleStore,searchAttr:"name",fetchProperties:{sort:[{attribute:"name",descending:!1}]},style:{width:"125px",marginLeft:"0"}},a("div",null,d));this._isPortal?(this._idpSingleRole.set("value",this._lookupFullRoleName(this._portalDefaultUser)),this._idpSingleRole.set("title",this.getRoleDesc(this._portalDefaultUser))):
(this._idpSingleRole.set("value",this.i18n.userRoles.user),this._idpSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip)));this._createSpacerRow(c);d=a("tr",null,c);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2IDP.userMessage+"\x3c/strong\x3e"},d);d=a("td",null,d);this._idpSingleMessage=new h.form.SimpleTextarea({width:"290px",height:"80px",rows:5,style:{resize:"no"}},a("div",null,
d));var d=esriGeowConfig.portalName||this.i18n.arcgis,f=esri.substitute({user:this.createFullName(this._user),organization:this._settings.name,portalName:d,idpName:this._currentIDP.name},this.i18n.step2IDP.emailMessage);this._isPortal&&(f=esri.substitute({user:this.createFullName(this._user),organization:this._settings.name,idpName:this._currentIDP.name},this.i18n.step2IDP.emailPortalMessage));this._idpSingleMessage.set("value",f);this._createSpacerRow(c);f=a("td",{colSpan:"2",className:"esriAlignTrailing"},
a("tr",null,c));this._idpSingleBackBtn=new h.form.Button({label:this.i18n.backLabel},a("div",null,f));this._idpSingleInviteBtn=new h.form.Button({label:this.i18n.step2IDP.inviteAnother},a("div",null,f));this._idpSingleReviewBtn=new h.form.Button({label:this.i18n.step2IDP.reviewInvitation},a("div",null,f));b.addClass(this._idpSingleBackBtn.domNode,"calcite default small");b.addClass(this._idpSingleInviteBtn.domNode,"calcite tertiary small");b.addClass(this._idpSingleReviewBtn.domNode,"calcite secondary small");
this._createSpacerRow(c);this._idpSingleTab=new h.layout.ContentPane({title:this.i18n.step2IDP.singleTab,selected:!0,className:"tabForm",content:e});e=b.create("div");c={emailHeader:this.i18n.csv.email,roleHeader:this.i18n.csv.role};f=esri.substitute(c,this.i18n.step2IDP.uploadCSV);this._isPortal&&(f=esri.substitute(c,this.i18n.step2IDP.uploadCSVPortal));a("div",{className:"uploadDesc",innerHTML:f},e);this._idpBatchForm=b.create("form",{id:"idpBatchForm",enctype:"multipart/form-data",method:"post",
onSubmit:"return false;"},e);9>b.isIE&&(this._idpBatchForm.encoding="multipart/form-data");c=this._createTable(this._idpBatchForm);this._createSpacerRow(c);f=a("tr",null,c);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2IDP.file+"\x3c/strong\x3e"},f);f=a("td",null,f);f=a("span",null,f);this._idpBatchFile=new h.form.TextBox({type:"file",name:"file"},a("div",null,f));this._createSpacerRow(c);f=a("tr",null,c);a("td",{className:esriGeowConfig.isRightToLeft?
"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2IDP.allUsersMessage+"\x3c/strong\x3e"},f);f=a("td",null,f);this._idpBatchMessage=new h.form.SimpleTextarea({width:"290px",height:"80px",rows:5,style:{resize:"no"}},a("div",null,f));d=esri.substitute({user:this.createFullName(this._user),organization:this._settings.name,portalName:d,idpName:this._currentIDP.name},this.i18n.step2IDP.emailMessage);this._isPortal&&(d=esri.substitute({user:this.createFullName(this._user),organization:this._settings.name,
idpName:this._currentIDP.name},this.i18n.step2IDP.emailPortalMessage));this._idpBatchMessage.set("value",d);this._createSpacerRow(c);d=a("td",{colSpan:"2",className:"esriAlignTrailing"},a("tr",null,c));this._idpBatchUploadBtn=new h.form.Button({type:"submit",label:this.i18n.step2IDP.uploadAndReview},a("div",null,d));b.addClass(this._idpBatchUploadBtn.domNode,"calcite blue small");this._createSpacerRow(c);this._idpBatchTab=new h.layout.ContentPane({title:this.i18n.step2IDP.batchTab,selected:!1,content:e});
b.connect(this._idpBatchFile,"onClick",b.hitch(this,function(){this.resetIDPErrorMessage()}));b.connect(this._idpBatchForm,"onSubmit",function(){return!1});b.connect(this._idpBatchForm,"onsubmit",this,this.onIDPBatchSubmit);b.connect(this._idpSingleBackBtn,"onClick",this,this.onBackToStart);b.connect(this._idpSingleInviteBtn,"onClick",this,this.onIDPAnotherClicked);b.connect(this._idpSingleReviewBtn,"onClick",this,this.onIDPReviewClicked);b.connect(this._idpSingleRole,"onChange",this,this.onIDPSingleRoleChanged);
this._idpTabs.addChild(this._idpSingleTab);this._idpTabs.addChild(this._idpBatchTab);this._idpTabs.startup();(b.isIos||b.isAndroid)&&b.style(this._idpBatchTab.controlButton.domNode,{display:"none"})},buildInviteTabs:function(){var a=b.create;this._inviteTabs=new h.layout.TabContainer({tabPosition:"top",doLayout:!1,useMenu:!1,style:{width:"490px",height:"380px"}},this._inviteTabContainer);var e=a("div"),c=this._createTable(e);this._createSpacerRow(c);var d=a("tr",null,c);a("td",{className:esriGeowConfig.isRightToLeft?
"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Invite.email+"\x3c/strong\x3e"},d);d=a("td",null,d);this._inviteSingleEmail=new h.form.TextBox({trim:!0,type:"text"},a("div",null,d));this._createSpacerRow(c);d=a("tr",null,c);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Invite.role+"\x3c/strong\x3e"},d);d=a("td",null,d);this._inviteSingleRoleStore=new b.data.ItemFileReadStore({data:{identifier:"role",label:"name",
items:this._roleItems}});this._inviteSingleRoleStore.comparatorMap={name:arcgisonline.sharing.geow.Account.caseInsensitiveComparator};this._inviteSingleRole=new h.form.ComboBox({store:this._inviteSingleRoleStore,searchAttr:"name",fetchProperties:{sort:[{attribute:"name",descending:!1}]},style:{width:"125px",marginLeft:"0"}},a("div",null,d));this._isPortal?(this._inviteSingleRole.set("value",this._lookupFullRoleName(this._portalDefaultUser)),this._inviteSingleRole.set("title",this.getRoleDesc(this._portalDefaultUser))):
(this._inviteSingleRole.set("value",this.i18n.userRoles.user),this._inviteSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip)));this._createSpacerRow(c);d=a("tr",null,c);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Invite.userMessage+"\x3c/strong\x3e"},d);d=a("td",null,d);this._inviteSingleMessage=new h.form.SimpleTextarea({width:"290px",height:"80px",rows:5,style:{resize:"no"}},a("div",
null,d));var d=esriGeowConfig.portalName||this.i18n.arcgis,f=esri.substitute({user:this.createFullName(this._user),organization:this._settings.name,portalName:d},this.i18n.step2Invite.emailMessage);this._isPortal&&(f=esri.substitute({user:this.createFullName(this._user),organization:this._settings.name},this.i18n.step2Invite.emailPortalMessage));this._inviteSingleMessage.set("value",f);this._createSpacerRow(c);f=a("td",{colSpan:"2",className:"esriAlignTrailing"},a("tr",null,c));this._inviteSingleBackBtn=
new h.form.Button({label:this.i18n.backLabel},a("div",null,f));this._inviteSingleInviteBtn=new h.form.Button({label:this.i18n.step2Invite.inviteAnother},a("div",null,f));this._inviteSingleReviewBtn=new h.form.Button({label:this.i18n.step2Invite.reviewInvitation},a("div",null,f));b.addClass(this._inviteSingleBackBtn.domNode,"calcite default small");b.addClass(this._inviteSingleInviteBtn.domNode,"calcite tertiary small");b.addClass(this._inviteSingleReviewBtn.domNode,"calcite secondary small");this._createSpacerRow(c);
this._inviteSingleTab=new h.layout.ContentPane({title:this.i18n.step2Invite.singleTab,selected:!0,className:"tabForm",content:e});e=b.create("div");c={emailHeader:this.i18n.csv.email,roleHeader:this.i18n.csv.role};f=esri.substitute(c,this.i18n.step2Invite.uploadCSV);this._isPortal&&(f=esri.substitute(c,this.i18n.step2Invite.uploadCSVPortal));a("div",{className:"uploadDesc",innerHTML:f},e);this._inviteBatchForm=b.create("form",{id:"inviteBatchForm",enctype:"multipart/form-data",method:"post",onSubmit:"return false;"},
e);9>b.isIE&&(this._inviteBatchForm.encoding="multipart/form-data");c=this._createTable(this._inviteBatchForm);this._createSpacerRow(c);f=a("tr",null,c);a("td",{className:esriGeowConfig.isRightToLeft?"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Invite.file+"\x3c/strong\x3e"},f);f=a("td",null,f);f=a("span",null,f);this._inviteBatchFile=new h.form.TextBox({type:"file",name:"file"},a("div",null,f));this._createSpacerRow(c);f=a("tr",null,c);a("td",{className:esriGeowConfig.isRightToLeft?
"labelColRtl":"labelCol",innerHTML:"\x3cstrong\x3e"+this.i18n.step2Invite.allUsersMessage+"\x3c/strong\x3e"},f);f=a("td",null,f);this._inviteBatchMessage=new h.form.SimpleTextarea({width:"290px",height:"80px",rows:5,style:{resize:"no"}},a("div",null,f));d=esri.substitute({user:this.createFullName(this._user),organization:this._settings.name,portalName:d},this.i18n.step2Invite.emailMessage);this._isPortal&&(d=esri.substitute({user:this.createFullName(this._user),organization:this._settings.name},this.i18n.step2Invite.emailPortalMessage));
this._inviteBatchMessage.set("value",d);this._createSpacerRow(c);d=a("td",{colSpan:"2",className:"esriAlignTrailing"},a("tr",null,c));this._inviteBatchUploadBtn=new h.form.Button({type:"submit",label:this.i18n.step2Invite.uploadAndReview},a("div",null,d));b.addClass(this._inviteBatchUploadBtn.domNode,"calcite blue small");this._createSpacerRow(c);this._inviteBatchTab=new h.layout.ContentPane({title:this.i18n.step2Invite.batchTab,selected:!1,content:e});b.connect(this._inviteBatchFile,"onClick",b.hitch(this,
function(){this.resetInviteErrorMessage()}));b.connect(this._inviteBatchForm,"onSubmit",function(){return!1});b.connect(this._inviteBatchForm,"onsubmit",this,this.onInviteBatchSubmit);b.connect(this._inviteSingleBackBtn,"onClick",this,this.onBackToStart);b.connect(this._inviteSingleInviteBtn,"onClick",this,this.onInviteAnotherClicked);b.connect(this._inviteSingleReviewBtn,"onClick",this,this.onInviteReviewClicked);b.connect(this._inviteSingleRole,"onChange",this,this.onInviteSingleRoleChanged);this._inviteTabs.addChild(this._inviteSingleTab);
this._inviteTabs.addChild(this._inviteBatchTab);this._inviteTabs.startup();(b.isIos||b.isAndroid)&&b.style(this._inviteBatchTab.controlButton.domNode,{display:"none"})},buildCreateGridLayout:function(){return[[{field:"firstname",get:this.firstNameFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.firstName,width:"127px"},{field:"lastname",get:this.lastNameFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.lastName,width:"127px"},{field:"email",get:this.emailFormatter,
formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.email,width:"127px"},{field:"rolename",get:this.roleFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.role,width:b.isSafari?"126px":"84px"},{field:"username",get:this.usernameFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.username,width:"127px"},{get:this.editFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.edit,width:"127px"}]]},buildCreateUserGrid:function(){this._userGrid=
new arcgisonline.sharing.dijit.DataGrid({structure:this.buildCreateGridLayout(),region:"center",noDataMessage:"",id:"userGridNode",jsid:"userGrid",selectionMode:"none",clientSort:!0,gutters:!1,sortInfo:1,canSort:this.canSortColumns,updateDelay:0},b.byId("userGridContainer"));this._userGrid.startup()},buildInviteGridLayout:function(){return[[{field:"email",get:this.emailFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.email,width:"100%"},{field:"rolename",get:this.roleFormatter,
formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.role,width:"150px"},{get:this.editFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.edit,width:"100px"}]]},buildInviteGroupGridLayout:function(){return[[{field:"fullname",get:this.fullNameFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.fullname,width:"127px"},{field:"username",get:this.usernameFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.username,width:"100%"},
{field:"rolename",get:this.roleFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.role,width:"150px"},{field:"email",get:this.emailFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.email,width:"127px"},{get:this.editFormatterGroup,formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.edit,width:"100px"}]]},buildInviteUserGrid:function(){this._userGrid=new arcgisonline.sharing.dijit.DataGrid({structure:this.buildInviteGridLayout(),region:"center",
noDataMessage:"",id:"userGridNode",jsid:"userGrid",selectionMode:"none",clientSort:!0,gutters:!1,sortInfo:1,canSort:this.canSortColumns},b.byId("userGridContainer"));this._userGrid.startup()},buildInviteGroupUserGrid:function(){this._userGrid=new arcgisonline.sharing.dijit.DataGrid({structure:this.buildInviteGroupGridLayout(),region:"center",noDataMessage:"",id:"userGridNode",jsid:"userGrid",selectionMode:"none",clientSort:!0,gutters:!1,sortInfo:1,canSort:this.canSortGroupColumns},b.byId("userGridContainer"));
this._userGrid.startup()},buildIDPGridLayout:function(){return[[{field:"email",get:this.emailFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.email,width:"100%"},{field:"rolename",get:this.roleFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.role,width:"150px"},{get:this.editFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.userGrid.edit,width:"100px"}]]},buildIDPUserGrid:function(){this._userGrid=new arcgisonline.sharing.dijit.DataGrid({structure:this.buildIDPGridLayout(),
region:"center",noDataMessage:"",id:"userGridNode",jsid:"userGrid",selectionMode:"none",clientSort:!0,gutters:!1,sortInfo:1,canSort:this.canSortColumns},b.byId("userGridContainer"));this._userGrid.startup()},buildUserStore:function(){var a;this._mode===this.modeInvite||this._mode===this.modeIDP?(a={identifier:"email",label:"email",items:[]},this._userStore=new b.data.ItemFileWriteStore({data:a})):this._mode===this.modeCreate&&(a={identifier:"username",label:"username",items:[]},this._userStore=new b.data.ItemFileWriteStore({data:a}));
this._userStore&&(this._userStore.comparatorMap={firstname:arcgisonline.sharing.geow.Account.caseInsensitiveComparator,lastname:arcgisonline.sharing.geow.Account.caseInsensitiveComparator,email:arcgisonline.sharing.geow.Account.caseInsensitiveComparator,username:arcgisonline.sharing.geow.Account.caseInsensitiveComparator,rolename:arcgisonline.sharing.geow.Account.caseInsensitiveComparator})},initializeUserStore:function(){this._userStore||this.buildUserStore()},initializeCreateUserGrid:function(){if(this._userGrid){var a=
this.buildCreateGridLayout();this._userGrid.setStructure(a)}else this.buildCreateUserGrid();this._userStore&&(this._userGrid.set("store",this._userStore),this._userGrid.render());this.checkUserLimit()},initializeInviteUserGrid:function(){if(this._userGrid){var a=this.buildInviteGridLayout();this._userGrid.setStructure(a)}else this.buildInviteUserGrid();this._userStore&&(this._userGrid.set("store",this._userStore),this._userGrid.render());this.checkUserLimit()},initializeInviteGroupUserGrid:function(){if(this._userGrid){var a=
this.buildInviteGroupGridLayout();this._userGrid.setStructure(a)}else this.buildInviteGroupUserGrid();this._userStore.fetch({onComplete:b.hitch(this,function(a){b.forEach(a,b.hitch(this,function(a){(!this._userStore.getValue(a,"email")||""===this._userStore.getValue(a,"email"))&&this.setReviewWarningMessage(this.i18n.step3.missingEmail)}))})});this._userStore&&(this._userGrid.set("store",this._userStore),this._userGrid.render());this.checkUserLimit()},initializeIDPUserGrid:function(){if(this._userGrid){var a=
this.buildIDPGridLayout();this._userGrid.setStructure(a)}else this.buildIDPUserGrid();this._userStore&&(this._userGrid.set("store",this._userStore),this._userGrid.render());this.checkUserLimit()},checkUserLimit:function(){var a=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),e=this._isPortal?this._portalLicenseInfo.maximumRegisteredMembers:this._settings.subscriptionInfo.maxUsers,c=this._addMode?this.i18n.step3.tooManyUsersAdviceAdd:this.i18n.step3.tooManyUsersAdvice,
d=esri.substitute({type:this._getTenantTypeString(),totalUsers:this._isPortal?this._portalLicenseInfo.currentRegisteredMembers:this._userCount,maxUsers:e},"\x3cp\x3e"+this.i18n.step3.tooManyUsers+"\x3c/p\x3e\x3cp\x3e"+c+"\x3c/p\x3e");this._userLimitReached?(this._sendInvitations.set("disabled",!0),this._groupSelection.set("disabled",!0),this._sendGroupInvitations.set("disabled",!0),a.show({title:this.i18n.notice,message:d})):this._userStore?this._userStore.fetch({onComplete:b.hitch(this,function(b){b=
this._userCount+(b?b.length:0);!this._isPortal&&-1<this._settings.subscriptionInfo.maxUsers&&b>this._settings.subscriptionInfo.maxUsers||this._isPortal&&-1<this._portalLicenseInfo.maximumRegisteredMembers&&b>this._portalLicenseInfo.maximumRegisteredMembers?(this._sendInvitations.set("disabled",!0),this._groupSelection.set("disabled",!0),this._sendGroupInvitations.set("disabled",!0),a.show({title:this.i18n.notice,message:d})):(this._sendInvitations.set("disabled",!1),this._groupSelection.set("disabled",
!1),this._sendGroupInvitations.set("disabled",!1))})}):(this._sendInvitations.set("disabled",!1),this._groupSelection.set("disabled",!1),this._sendGroupInvitations.set("disabled",!1))},handleGetSelf:function(a){a&&!a.code&&!a.message?(this._settings=a,this._isPortal=this._util.isPortal(),this._customRoles=[],this._isAdmin=esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin(),this._isCustomRole=esriGeowConfig.userRole&&esriGeowConfig.userRole.isCustom(),this._roleCanInviteUsers=esriGeowConfig.userRole&&
esriGeowConfig.userRole.canViewUsers()&&esriGeowConfig.userRole.canInviteUsers(),this._roleCanAddUsers=this._isCustomRole&&esriGeowConfig.userRole.canAssignUsersToOrgGroups(),this.setupInvitingUser(a.user),this.getPasswordPolicy(),this._isAdmin||this._isCustomRole&&this._roleCanInviteUsers?this.getRoles().then(b.hitch(this,function(){this.getIDP().then(b.hitch(this,this.configure))})):this.getRoles().then(b.hitch(this,this.configure))):console.log(a)},getPasswordPolicy:function(){this._util.request({url:this._util.getSecureUrl(esriGeowConfig.restBaseUrl)+
"portals/self/securityPolicy/passwordPolicy"}).then(b.hitch(this,function(a){this._passwordPolicy=a&&!a.code&&!a.messageCode?a:null}))},setupInvitingUser:function(a){this._invitingUser=b.clone(a)},getCustomRoleId:function(a){var b;if(a)for(var c=0;c<this._customRoles.length;c++)if(this._customRoles[c].name&&this._customRoles[c].name.toLowerCase()===a.toLowerCase()){b=this._customRoles[c].id;break}return b},getCustomRoleName:function(a){for(var b,c=0;c<this._customRoles.length;c++)if(this._customRoles[c].id===
a){b=this._customRoles[c].name;break}return b},getCustomRoleDesc:function(a){for(var b,c=0;c<this._customRoles.length;c++)if(this._customRoles[c].id===a){b=this._customRoles[c].description;break}return b},getRoleDesc:function(a){return a===this.accountAdminRole||a===this.orgAdminRole?esri.substitute({type:this._getTenantTypeString()},this.i18n.adminRoleTooltip):a===this.accountPublisherRole||a===this.orgPublisherRole?esri.substitute({type:this._getTenantTypeString()},this.i18n.publisherRoleTooltip):
a===this.accountUserRole||a===this.orgUserRole?esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip):this.getCustomRoleDesc(a)},getRoles:function(){var a=new b.Deferred,e=0,c=0,d;this._rolesAPI.getRoles(1,100).then(b.hitch(this,function(f){if(f&&f.roles)if(this._customRoles=f.roles,0<f.nextStart){e=f.total-f.roles.length;c=Math.ceil(e/100);var g=[];f=f.nextStart;for(var q=0;q<c;q++)g.push(this._rolesAPI.getRoles(f+100*q,100));d=new b.DeferredList(g);d.then(b.hitch(this,function(c){b.forEach(c,
b.hitch(this,function(a){a[1]&&a[1].roles&&(this._customRoles=this._customRoles.concat(a[1].roles))}));this.getAllRolePrivileges().then(b.hitch(this,function(){this.filterOutAdminRoles();a.resolve()}))}),b.hitch(this,function(b){a.resolve()}))}else this.getAllRolePrivileges().then(b.hitch(this,function(){this.filterOutAdminRoles();a.resolve()}))}),b.hitch(this,function(b){a.resolve()}));return a},filterOutAdminRoles:function(){this._roleItems=[{role:this.accountPublisherRole,name:this.i18n.userRoles.publisher},
{role:this.accountUserRole,name:this.i18n.userRoles.user}];this._isPortal&&this._roleItems.push({role:this.accountAdminRole,name:this.i18n.userRoles.admin});for(var a=[],b=0;b<this._customRoles.length;b++){var c=!1,d;if(this._customRoles[b]&&this._customRoles[b].privileges)for(var f=0;f<this._customRoles[b].privileges.length;f++)if(d=this._customRoles[b].privileges[f],-1<d.indexOf(":admin")){c=!0;break}if(!c||this._isPortal)a.push(this._customRoles[b]),this._roleItems.push({role:this._customRoles[b].id,
name:this._customRoles[b].name})}this._customRoles=a},getAllRolePrivileges:function(){var a=new b.Deferred,e=[];b.forEach(this._customRoles,b.hitch(this,function(a,b){e.push(this._rolesAPI.getPrivileges(a.id))}));(new b.DeferredList(e)).then(b.hitch(this,function(c){b.forEach(c,b.hitch(this,function(a){for(var b=0;b<this._customRoles.length;b++)if(this._customRoles[b].id===a[1].id){this._customRoles[b].privileges=a[1].privileges;break}}));a.resolve()}),b.hitch(this,function(b){a.resolve()}));return a},
getIDP:function(){var a=new b.Deferred;esriGeowConfig.enterpriseLoginConfigEnabled?this._util.request({url:esriGeowConfig.restBaseUrl+"portals/self/idp"}).then(b.hitch(this,function(b){this._currentIDP=esri.isDefined(b)&&esri.isDefined(b.id)?b:null;a.resolve()}),b.hitch(this,function(b){this._currentIDP=null;a.resolve()})):a.resolve();return a},hasIDP:function(){return esri.isDefined(this._currentIDP)&&esri.isDefined(this._currentIDP.id)},configure:function(){this.overrideProperties();this.checkAccess();
this.localization();this.initialize();this._createUsersBtn.set("disabled",!1);this._inviteUsersBtn.set("disabled",!1);this._account.getAccountUsers(this._settings.id,{start:1,num:1},b.hitch(this,function(a){this._userCount=a.total;if(this._isPortal){var e=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"));this._util.request({url:e+"/portaladmin/system/licenses",content:{ts:(new Date).getTime()}}).then(b.hitch(this,function(b){this._portalLicenseInfo=b;this._userCount=this._portalLicenseInfo.currentRegisteredMembers||
a.total;this.setUserLimitReachedFlag()}))}else this._account.getPendingAccountUsers(this._settings.id,{start:1,num:1,type:"email"},b.hitch(this,function(a){this._userCount+=a.total;this.setUserLimitReachedFlag()}),b.hitch(this,function(a){this.setUserLimitReachedFlag()}))}))},setUserLimitReachedFlag:function(){this._userLimitReached=this._isPortal?-1<this._portalLicenseInfo.maximumRegisteredMembers&&this._portalLicenseInfo.currentRegisteredMembers>=this._portalLicenseInfo.maximumRegisteredMembers:
-1<this._settings.subscriptionInfo.maxUsers&&this._userCount>=this._settings.subscriptionInfo.maxUsers},overrideProperties:function(){this._settings.portalName&&(esriGeowConfig.portalName=this._settings.portalName)},checkAccess:function(){if(this._util.isLoggedIn()){if(this._user=this._util.getUser(),!this._user.accountId||this._user.accountId!==this._settings.id||!this._isAdmin&&!this._roleCanInviteUsers)window.location=esriGeowConfig.baseUrl+"error.html?c\x3dAccessDenied"}else this._util.requireAuthentication()},
localization:function(){var a=(this._settings.thumbnail?"\x26nbsp;":"")+esri.substitute({organization:this._settings.name},this._isPortal?this.i18n.pagePortalTitle:this.i18n.pageTitle);b.attr(b.byId("item-title"),"innerHTML",a);this._settings.thumbnail&&b.create("img",{src:esriGeowConfig.restBaseUrl+"portals/self/resources/"+this._settings.thumbnail+"?token\x3d"+this._user.token+"\x26ts\x3d"+(new Date).getTime(),style:{verticalAlign:"middle"},className:"groupThumbnail"},b.byId("item-title"),"first")},
initialize:function(){this._mode=null;this.hide();this.hasIDP()?(b.attr(this._idpOptionLabel,"innerHTML","\x26nbsp;"+esri.substitute({name:this._currentIDP.name},this.i18n.step1.idpUsersLabel)),this._idpUsersBtn.set("checked",!0)):b.style(this._idpOptionDiv,"display","none");b.attr(this._createOptionLabel,"innerHTML","\x26nbsp;"+esri.substitute({name:this._isPortal?this._settings.name:this.i18n.arcgis},this.i18n.step1.createUsersLabel));b.attr(this._inviteOptionLabel,"innerHTML","\x26nbsp;"+esri.substitute({name:this._isPortal?
this._settings.name:this.i18n.arcgis},this.i18n.step1.inviteUsersLabel));b.attr(this._addOptionLabel,"innerHTML","\x26nbsp;"+(this._isPortal?this.i18n.step1.addPortalUsersLabel:this.i18n.step1.addUsersLabel));this._isPortal?this.advanceToStep1Add():b.style(this._step1,"display","block")},advanceToStep1Add:function(){this._addUsersBtn.set("checked",!0);this.onNext()},buildChooseType:function(){this.hide();b.style(this._step1Create,"display","block");this._checkEnterpriseGroupStore().then(b.hitch(this,
function(){var a=b.create,e=this._createTable(this._createTypeContainer);this._radioSAMLLabel.innerHTML=esri.substitute({name:this._currentIDP?this._currentIDP.name:""},this.i18n.step1Create.addSAML);this._supportsSAML||(this._radioSAML.set("disabled",!0),b.addClass(this._radioSAMLLabel,"notSupport"));this._radioEnterprise.set("value",this._supportsLDAP?"ldap":"windows");this._radioBuiltin.set("checked",!0);!this._supportsLDAP&&!this._supportsWindows&&(this._radioEnterprise.set("disabled",!0),b.addClass(this._radioEnterpriseLabel,
"notSupport"));this._createSpacerRow(e);e=a("tr",null,e);e=a("td",{colspan:2},e);this._nextBtn=new h.form.Button({label:this.i18n.step1Create.nextBtn},a("div",null,e));b.addClass(this._nextBtn.domNode,"calcite blue small");b.connect(this._nextBtn,"onClick",this,this.onTypeNextClicked)}))},hide:function(){b.style(this._step1,"display","none");this.hasIDP()&&(b.style(this._step2IDP,"display","none"),b.attr(this._step2IDPMsgLabel,"innerHTML",esri.substitute({name:this._currentIDP.name},b.isIos||b.isAndroid?
this.i18n.step2IDP.messageMobile:this.i18n.step2IDP.message)),this._supportsSAML=!0);b.style(this._step1Create,"display","none");b.style(this._step2Create,"display","none");var a,e;this._addMode?("saml"===this._userType?(a=this.i18n.step2Create.messageAddPortalSAML,e=this.i18n.step2Create.subMessageAddPortalSAML):"ldap"===this._userType||"windows"===this._userType?(a=this.i18n.step2Create.messageAddPortalAD,e=this.i18n.step2Create.subMessageAddPortalAD):(a=this.i18n.step2Create.messageAddPortal,e=
this.i18n.step2Create.subMessageAddPortal),a=b.isIos||b.isAndroid?this._isPortal?this.i18n.step2Create.messageAddPortalMobile:this.i18n.step2Create.messageAddMobile:this._isPortal?a:this.i18n.step2Create.messageAdd,e=b.isIos||b.isAndroid?this._isPortal?this.i18n.step2Create.subMessageAddPortalMobile:this.i18n.step2Create.subMessageAddMobile:this._isPortal?e:this.i18n.step2Create.subMessageAdd):(a=b.isIos||b.isAndroid?this.i18n.step2Create.messageMobile:this.i18n.step2Create.message,e=b.isIos||b.isAndroid?
this.i18n.step2Create.subMessageMobile:this.i18n.step2Create.subMessage);b.attr(this._step2CreateMsgLabel,"innerHTML",esri.substitute({name:this._isPortal?this._settings.name:this.i18n.arcgis},a));b.attr(this._step2CreateSubMsgLabel,"innerHTML",e);this._createBatchUploadBtn&&this._createBatchUploadBtn.set("disabled",!1);b.style(this._fixErrors,"display","none");this._addMode?b.attr(this._fixErrorsMsgLabel,"innerHTML",esri.substitute({name:this._isPortal?this._settings.name:this.i18n.arcgis},this.i18n.fixErrors.messageAdd)):
b.attr(this._fixErrorsMsgLabel,"innerHTML",esri.substitute({name:this._isPortal?this._settings.name:this.i18n.arcgis},this.i18n.fixErrors.message));this._fixAlertDiv&&b.style(this._fixAlertDiv,"display","block");this._fixEditDiv&&b.style(this._fixEditDiv,"innerHTML","");b.style(this._step2Invite,"display","none");a=b.isIos||b.isAndroid?this.i18n.step2Invite.messageMobile:this.i18n.step2Invite.message;e=esri.substitute({name:this._isPortal?this._settings.name:this.i18n.arcgis},this.i18n.step2Invite.subMessage)+
" "+this.i18n.selectNonAdmin;this._isPortal&&!esriGeowConfig.useDefaultIdentityStore&&(a=b.isIos||b.isAndroid?this.i18n.step2Invite.messageNonDefaultIdentityStoreMobile:this.i18n.step2Invite.messageNonDefaultIdentityStore,e="");b.attr(this._step2InviteLabel,"innerHTML",a);b.attr(this._step2InviteSubLabel,"innerHTML",e);this._inviteBatchUploadBtn&&this._inviteBatchUploadBtn.set("disabled",!1);b.style(this._step3,"display","none");this._sendInvitations&&(this._sendInvitations.set("disabled",!1),b.attr(this._sendInvitations,
"label",this.i18n.step3.sendInvitations),b.attr(this._sendGroupInvitations,"label",this.i18n.step3.sendInvitations));this._addMode&&(b.attr(this._sendInvitations,"label",this.i18n.step3.addMembers),b.attr(this._sendGroupInvitations,"label",this.i18n.step3.addMembers));b.style(this._step4,"display","none");b.style(this._completed,"display","none");b.style(this._completedMessageSpan,"display","block");b.style(this._uninvitedMessageSpan,"display","none")},setFixErrorMessage:function(a){b.attr(this._fixErrorsErrorContainer,
"innerHTML",a);b.style(this._fixErrorsErrorContainer,"display","block");b.removeClass(this._fixErrorsErrorContainer,"successMsg");b.addClass(this._fixErrorsErrorContainer,"errorMsg")},setFixSuccessMessage:function(a){b.attr(this._fixErrorsErrorContainer,"innerHTML",a);b.style(this._fixErrorsErrorContainer,"display","block");b.removeClass(this._fixErrorsErrorContainer,"errorMsg");b.addClass(this._fixErrorsErrorContainer,"successMsg")},resetFixErrorMessage:function(){b.attr(this._fixErrorsErrorContainer,
"innerHTML","");b.style(this._fixErrorsErrorContainer,"display","none");b.removeClass(this._fixErrorsErrorContainer,"errorMsg");b.removeClass(this._fixErrorsErrorContainer,"successMsg")},setCreateErrorMessage:function(a){b.attr(this._createErrorContainer,"innerHTML",a);b.style(this._createErrorContainer,"display","block");b.removeClass(this._createErrorContainer,"successMsg");b.addClass(this._createErrorContainer,"errorMsg");this._createBatchUploadBtn&&this._createBatchUploadBtn.set("disabled",!1)},
setCreateSuccessMessage:function(a){b.attr(this._createErrorContainer,"innerHTML",a);b.style(this._createErrorContainer,"display","block");b.removeClass(this._createErrorContainer,"errorMsg");b.addClass(this._createErrorContainer,"successMsg")},setInviteErrorMessage:function(a){b.attr(this._inviteErrorContainer,"innerHTML",a);b.style(this._inviteErrorContainer,"display","block");b.removeClass(this._inviteErrorContainer,"successMsg");b.addClass(this._inviteErrorContainer,"errorMsg");this._inviteBatchUploadBtn&&
this._inviteBatchUploadBtn.set("disabled",!1)},setInviteSuccessMessage:function(a){b.attr(this._inviteErrorContainer,"innerHTML",a);b.style(this._inviteErrorContainer,"display","block");b.removeClass(this._inviteErrorContainer,"errorMsg");b.addClass(this._inviteErrorContainer,"successMsg")},setIDPSuccessMessage:function(a){b.attr(this._idpErrorContainer,"innerHTML",a);b.style(this._idpErrorContainer,"display","block");b.removeClass(this._idpErrorContainer,"errorMsg");b.addClass(this._idpErrorContainer,
"successMsg")},setIDPErrorMessage:function(a){b.attr(this._idpErrorContainer,"innerHTML",a);b.style(this._idpErrorContainer,"display","block");b.removeClass(this._idpErrorContainer,"successMsg");b.addClass(this._idpErrorContainer,"errorMsg");this._idpBatchUploadBtn&&this._idpBatchUploadBtn.set("disabled",!1)},resetCreateErrorMessage:function(){b.attr(this._createErrorContainer,"innerHTML","");b.style(this._createErrorContainer,"display","none");b.removeClass(this._createErrorContainer,"errorMsg");
b.removeClass(this._createErrorContainer,"successMsg")},resetInviteErrorMessage:function(){b.attr(this._inviteErrorContainer,"innerHTML","");b.style(this._inviteErrorContainer,"display","none");b.removeClass(this._inviteErrorContainer,"errorMsg");b.removeClass(this._inviteErrorContainer,"successMsg")},resetIDPErrorMessage:function(){b.attr(this._idpErrorContainer,"innerHTML","");b.style(this._idpErrorContainer,"display","none");b.removeClass(this._idpErrorContainer,"errorMsg");b.removeClass(this._idpErrorContainer,
"successMsg")},setReviewWarningMessage:function(a){b.attr(this._ReviewErrorContainer,"innerHTML",a);b.style(this._ReviewErrorContainer,"display","block");b.addClass(this._ReviewErrorContainer,"errorMsg")},resetReviewWarningMessage:function(){b.attr(this._ReviewErrorContainer,"innerHTML","");b.style(this._ReviewErrorContainer,"display","none");b.removeClass(this._ReviewErrorContainer,"errorMsg")},validIDPUsers:function(a){var e=!0,c=!1,d=null,f=[],g;for(g=0;g<a.length;g++){-1<b.indexOf(f,a[g].email)?
(c=!0,d=a[g].email):f.push(a[g].email);if(c){this._idpSingleEmail.focus();a=esri.substitute({email:d},this.i18n.step2IDP.invalid.emailDuplicate);this.setIDPErrorMessage(a);e=!1;break}e=this.isValidIDPUser(a[g]);if(!e)break}return e},validInviteUsers:function(a){var e=!0,c=!1,d=null,f=[],g;for(g=0;g<a.length;g++){-1<b.indexOf(f,a[g].email)?(c=!0,d=a[g].email):f.push(a[g].email);if(c){this._inviteSingleEmail.focus();a=esri.substitute({email:d},this.i18n.step2Invite.invalid.emailDuplicate);this.setInviteErrorMessage(a);
e=!1;break}e=this.isValidInviteUser(a[g]);if(!e)break}return e},usernameContainsAlphaNumeric:function(a){var b=/^[a-zA-Z0-9@_\.]+$/g;return a&&!!b.test(a)},usernameContainsAlphaNumericPortal:function(a){var b=/^[a-zA-Z0-9@_\.\-]+$/g;return a&&!!b.test(a)},isValidFixedUser:function(a){var b=null,c=!1,d="";this.notSet(a.email)?(c=!0,d+=this.i18n.fixErrors.invalid.emailNotSet+"\x3cbr\x3e",b||(b=this._fixEmail)):this.containsRequiredEmailChars(a.email)||(c=!0,d+=esri.substitute({email:this._util.stripHTML(a.email)},
this.i18n.fixErrors.invalid.emailAddress)+"\x3cbr\x3e",b||(b=this._fixEmail));var f=this._isPortal&&"saml"===this._userType?this._maxSAMLUsernameLength:this._maxUsernameLength;if(this.notSet(a.username))c=!0,d+=this.i18n.fixErrors.invalid.usernameIsBlank+"\x3cbr\x3e",b||(b=this._fixUsername);else if(a.username.length<this._minUsernameLength)c=!0,d+=this.i18n.fixErrors.invalid.usernameTooShort+"\x3cbr\x3e",b||(b=this._fixUsername);else if(a.username.length>f)c=!0,d+=this._isPortal&&"saml"===this._userType?
this.i18n.fixErrors.invalid.samlUsernameTooLong+"\x3cbr\x3e":this.i18n.fixErrors.invalid.usernameTooLong+"\x3cbr\x3e",b||(b=this._fixUsername);else if(!(this._isPortal?this.usernameContainsAlphaNumericPortal(a.username):this.usernameContainsAlphaNumeric(a.username)))c=!0,d+=this.i18n.fixErrors.invalid.usernameInvalidChars+"\x3cbr\x3e",b||(b=this._fixUsername);if(this._addMode&&this._fixPassword&&"saml"!==this._userType)if(esriGeowConfig.passwordPolicyEnabled&&this._passwordPolicy)f=this._util.meetsPasswordPolicyStrength(this._passwordPolicy,
a.password),f.meetsRequirements()||(c=!0,f.minLength||(d+=esri.substitute({num:this._passwordPolicy.minLength},this.i18n.step2Create.invalid.passwordLength)+"\x3cbr\x3e"),f.minLetter||(d+=esri.substitute({num:this._passwordPolicy.minLetter},this.i18n.step2Create.invalid.passwordLetter)+"\x3cbr\x3e"),f.minUpper||(d+=esri.substitute({num:this._passwordPolicy.minUpper},this.i18n.step2Create.invalid.passwordUpper)+"\x3cbr\x3e"),f.minLower||(d+=esri.substitute({num:this._passwordPolicy.minLower},this.i18n.step2Create.invalid.passwordLower)+
"\x3cbr\x3e"),f.minDigit||(d+=esri.substitute({num:this._passwordPolicy.minDigit},this.i18n.step2Create.invalid.passwordDigit)+"\x3cbr\x3e"),f.minOther||(d+=esri.substitute({num:this._passwordPolicy.minOther},this.i18n.step2Create.invalid.passwordOther)+"\x3cbr\x3e"),b||(b=this._createSinglePassword));else if(this.notSet(a.password)||this.isSet(a.password)&&!this._util.meetsPasswordStrength(a.password))c=!0,d+=this.i18n.passwordHintText+"\x3cbr\x3e",b||(b=this._fixPassword);this.notSet(a.firstname)&&
(c=!0,d+=this.i18n.fixErrors.invalid.firstNameIsBlank+"\x3cbr\x3e",b||(b=this._fixFirstName));this.notSet(a.lastname)&&(c=!0,d+=this.i18n.fixErrors.invalid.lastNameIsBlank+"\x3cbr\x3e",b||(b=this._fixLastName));c&&(b&&b.focus(),this.setFixErrorMessage(d));return!c},isValidFixedUserAD:function(a){var b=null,c=!1,d="";if(this.notSet(a.username))c=!0,d+=this.i18n.fixErrors.invalid.usernameIsBlank+"\x3cbr\x3e",b||(b=this._fixUsername);else if(a.username.length<this._minUsernameLength)c=!0,d+=this.i18n.fixErrors.invalid.usernameTooShort+
"\x3cbr\x3e",b||(b=this._fixUsername);else if(a.username.length>this._maxUsernameLength)c=!0,d+=this.i18n.fixErrors.invalid.usernameTooLong+"\x3cbr\x3e",b||(b=this._fixUsername);else if(!(this._isPortal?this.usernameContainsAlphaNumericPortal(a.username):this.usernameContainsAlphaNumeric(a.username)))c=!0,d+=this.i18n.fixErrors.invalid.usernameInvalidChars+"\x3cbr\x3e",b||(b=this._fixUsername);c&&(b&&b.focus(),this.setFixErrorMessage(d));return!c},isValidCreateUser:function(a){var e=null,c=!1,d="",
f;this.notSet(a.email)?(c=!0,d+=this.i18n.step2Create.invalid.emailNotSet+"\x3cbr\x3e",e||(e=this._createSingleEmail)):this.containsRequiredEmailChars(a.email)||(c=!0,d+=esri.substitute({email:this._util.stripHTML(a.email)},this.i18n.step2Create.invalid.emailAddress)+"\x3cbr\x3e",e||(e=this._createSingleEmail));f=this._isPortal&&"saml"===this._userType?this._maxSAMLUsernameLength:this._maxUsernameLength;if(this.notSet(a.username))c=!0,d+=this.i18n.step2Create.invalid.usernameIsBlank+"\x3cbr\x3e",
e||(e=this._createSingleUsername);else if(a.username.length<this._minUsernameLength)c=!0,d+=this.i18n.step2Create.invalid.usernameTooShort+"\x3cbr\x3e",e||(e=this._createSingleUsername);else if(a.username.length>f)c=!0,d+=this._isPortal&&"saml"===this._userType?this.i18n.step2Create.invalid.samlUsernameTooLong+"\x3cbr\x3e":this.i18n.step2Create.invalid.usernameTooLong+"\x3cbr\x3e",e||(e=this._createSingleUsername);else if(this._isPortal?this.usernameContainsAlphaNumericPortal(a.username):this.usernameContainsAlphaNumeric(a.username))if(this._editingCreate){if(this._editingCreate&&
a.id)for(f=0;f<this._userStore._arrayOfAllItems.length;f++)if(this._userStore._arrayOfAllItems[f]&&a.username===this._userStore._arrayOfAllItems[f].username[0]&&a.id!==this._userStore._arrayOfAllItems[f].id[0]){c=!0;d+=esri.substitute({username:a.username},this.i18n.step2Create.invalid.usernameExists)+"\x3cbr\x3e";e||(e=this._createSingleEmail);break}}else for(f=0;f<this._userStore._arrayOfAllItems.length;f++){if(this._userStore._arrayOfAllItems[f]&&a.username===this._userStore._arrayOfAllItems[f].username[0]){c=
!0;d+=esri.substitute({username:a.username},this.i18n.step2Create.invalid.usernameExists)+"\x3cbr\x3e";e||(e=this._createSingleEmail);break}}else c=!0,d+=this.i18n.step2Create.invalid.usernameInvalidChars+"\x3cbr\x3e",e||(e=this._createSingleUsername);if(this._addMode&&this._createSinglePassword&&"saml"!==this._userType)if(esriGeowConfig.passwordPolicyEnabled&&this._passwordPolicy)f=this._util.meetsPasswordPolicyStrength(this._passwordPolicy,a.password),f.meetsRequirements()||(c=!0,f.minLength||(d+=
esri.substitute({num:this._passwordPolicy.minLength},this.i18n.step2Create.invalid.passwordLength)+"\x3cbr\x3e"),f.minLetter||(d+=esri.substitute({num:this._passwordPolicy.minLetter},this.i18n.step2Create.invalid.passwordLetter)+"\x3cbr\x3e"),f.minUpper||(d+=esri.substitute({num:this._passwordPolicy.minUpper},this.i18n.step2Create.invalid.passwordUpper)+"\x3cbr\x3e"),f.minLower||(d+=esri.substitute({num:this._passwordPolicy.minLower},this.i18n.step2Create.invalid.passwordLower)+"\x3cbr\x3e"),f.minDigit||
(d+=esri.substitute({num:this._passwordPolicy.minDigit},this.i18n.step2Create.invalid.passwordDigit)+"\x3cbr\x3e"),f.minOther||(d+=esri.substitute({num:this._passwordPolicy.minOther},this.i18n.step2Create.invalid.passwordOther)+"\x3cbr\x3e"),e||(e=this._createSinglePassword));else if(this.notSet(a.password)||this.isSet(a.password)&&!this._util.meetsPasswordStrength(a.password))c=!0,d+=this.i18n.passwordHintText+"\x3cbr\x3e",e||(e=this._createSinglePassword);this.notSet(a.firstname)&&(c=!0,d+=this.i18n.step2Create.invalid.firstNameIsBlank+
"\x3cbr\x3e",e||(e=this._createSingleFirstName));this.notSet(a.lastname)&&(c=!0,d+=this.i18n.step2Create.invalid.lastNameIsBlank+"\x3cbr\x3e",e||(e=this._createSingleLastName));(a=this._createSingleMessage.get("value"))&&(a=b.trim(a));this.notSet(a)&&(c=!0,d+=this.i18n.step2Create.invalid.messageIsBlank+"\x3cbr\x3e",e||(e=this._createSingleMessage));c&&(e&&e.focus(),this.setCreateErrorMessage(d));return!c},isValidInviteUser:function(a){var e=null,c=!1,d="",f;if(this.notSet(a.email))c=!0,d+=this.i18n.step2Invite.invalid.emailNotSet+
"\x3cbr\x3e",e||(e=this._inviteSingleEmail);else if(this.containsRequiredEmailChars(a.email)){if(!this._editingInvite)for(f=0;f<this._userStore._arrayOfAllItems.length;f++)this._userStore._arrayOfAllItems[f]&&a.email===this._userStore._arrayOfAllItems[f].email[0]&&(c=!0,d+=esri.substitute({email:this._util.stripHTML(a.email)},this.i18n.step2Invite.invalid.emailExists),e||(e=this._inviteSingleEmail))}else c=!0,d+=esri.substitute({email:this._util.stripHTML(a.email)},this.i18n.step2Invite.invalid.emailAddress),
e||(e=this._inviteSingleEmail);(a=this._inviteSingleMessage.get("value"))&&(a=b.trim(a));this.notSet(a)&&(c=!0,d+=this.i18n.step2Invite.invalid.messageIsBlank+"\x3cbr\x3e",e||(e=this._inviteSingleMessage));c&&(e&&e.focus(),this.setInviteErrorMessage(d));return!c},isValidIDPUser:function(a){var e=null,c=!1,d="",f;if(this.notSet(a.email))c=!0,d+=this.i18n.step2IDP.invalid.emailNotSet+"\x3cbr\x3e",e||(e=this._idpSingleEmail);else if(this.containsRequiredEmailChars(a.email)){if(!this._editingIDP)for(f=
0;f<this._userStore._arrayOfAllItems.length;f++)this._userStore._arrayOfAllItems[f]&&a.email===this._userStore._arrayOfAllItems[f].email[0]&&(c=!0,d+=esri.substitute({email:this._util.stripHTML(a.email)},this.i18n.step2IDP.invalid.emailExists),e||(e=this._idpSingleEmail))}else c=!0,d+=esri.substitute({email:this._util.stripHTML(a.email)},this.i18n.step2IDP.invalid.emailAddress),e||(e=this._idpSingleEmail);(a=this._idpSingleMessage.get("value"))&&(a=b.trim(a));this.notSet(a)&&(c=!0,d+=this.i18n.step2IDP.invalid.messageIsBlank+
"\x3cbr\x3e",e||(e=this._idpSingleMessage));c&&(e&&e.focus(),this.setIDPErrorMessage(d));return!c},editInvite:function(a){this._userStore.fetch({onComplete:b.hitch(this,function(e){var c;this._mode===this.modeInvite?(b.forEach(e,b.hitch(this,function(b){this._userStore.getValue(b,"email")===a&&(this._editingInvite=!0,this._editingInviteUser=b)})),this._editingInvite&&(this.resetInviteSingleForm(!0),e=this._userStore.getValue(this._editingInviteUser,"role"),this._inviteSingleEmail.set("value",this._userStore.getValue(this._editingInviteUser,
"email")),this._isPortal&&e===this.accountAdminRole?(this._inviteSingleRole.set("value",this.i18n.userRoles.admin),this._currentSelectedInviteRole=this.accountAdminRole):e===this.accountPublisherRole?(this._inviteSingleRole.set("value",this.i18n.userRoles.publisher),this._currentSelectedInviteRole=this.accountPublisherRole):e===this.accountUserRole?(this._inviteSingleRole.set("value",this.i18n.userRoles.user),this._currentSelectedInviteRole=this.accountUserRole):(c=this.getCustomRoleName(e))?(this._inviteSingleRole.set("value",
c),this._currentSelectedInviteRole=e):this._isPortal?(this._inviteSingleRole.set("value",this._lookupFullRoleName(this._portalDefaultUser)),this._currentSelectedInviteRole=this._portalDefaultUser):(this._inviteSingleRole.set("value",this.i18n.userRoles.user),this._currentSelectedInviteRole=this.accountUserRole),this._inviteSingleMessage.set("value",this._currentInviteMessage),this._inviteSingleEmail.focus(),this.hide(),b.style(this._step2Invite,"display","block"),this._userGrid.set("store",null))):
this._mode===this.modeIDP?(b.forEach(e,b.hitch(this,function(b){this._userStore.getValue(b,"email")===a&&(this._editingIDP=!0,this._editingIDPUser=b)})),this._editingIDP&&(this.resetIDPSingleForm(!0),e=this._userStore.getValue(this._editingIDPUser,"role"),this._idpSingleEmail.set("value",this._userStore.getValue(this._editingIDPUser,"email")),this._isPortal&&e===this.accountAdminRole?(this._idpSingleRole.set("value",this.i18n.userRoles.admin),this._currentSelectedIDPRole=this.accountAdminRole):e===
this.accountPublisherRole?(this._idpSingleRole.set("value",this.i18n.userRoles.publisher),this._currentSelectedIDPRole=this.accountPublisherRole):e===this.accountUserRole?(this._idpSingleRole.set("value",this.i18n.userRoles.user),this._currentSelectedIDPRole=this.accountUserRole):(c=this.getCustomRoleName(e))?(this._idpSingleRole.set("value",c),this._currentSelectedIDPRole=e):this._isPortal?(this._idpSingleRole.set("value",this._lookupFullRoleName(this._portalDefaultUser)),this._currentSelectedIDPRole=
this._portalDefaultUser):(this._idpSingleRole.set("value",this.i18n.userRoles.user),this._currentSelectedIDPRole=this.accountUserRole),this._idpSingleMessage.set("value",this._currentIDPMessage),this._idpSingleEmail.focus(),this.hide(),b.style(this._step2IDP,"display","block"),this._userGrid.set("store",null))):this._mode===this.modeCreate&&(b.forEach(e,b.hitch(this,function(b){this._userStore.getValue(b,"username")===a&&(this._editingCreate=!0,this._editingCreateUser=b)})),this._editingCreate&&(this.resetCreateSingleForm(!0),
this._settingCreateSingleUser=this._settingCreateSingleEmail=!0,this._addMode&&(this._settingCreateSinglePassword=!0),this._createSingleEmail.set("value",this._userStore.getValue(this._editingCreateUser,"email")),this._createSingleFirstName.set("value",this._userStore.getValue(this._editingCreateUser,"firstname")),this._createSingleLastName.set("value",this._userStore.getValue(this._editingCreateUser,"lastname")),this._createSingleUsername.set("value",this._userStore.getValue(this._editingCreateUser,
"username")),this._addMode&&(this._createSinglePassword&&"saml"!==this._userType)&&this._createSinglePassword.set("value",this._userStore.getValue(this._editingCreateUser,"password")),e=this._userStore.getValue(this._editingCreateUser,"role"),this._isPortal&&e===this.accountAdminRole?(this._createSingleRole.set("value",this.i18n.userRoles.admin),this._currentSelectedCreateRole=this.accountAdminRole):e===this.accountPublisherRole?(this._createSingleRole.set("value",this.i18n.userRoles.publisher),this._currentSelectedCreateRole=
this.accountPublisherRole):e===this.accountUserRole?(this._createSingleRole.set("value",this.i18n.userRoles.user),this._currentSelectedCreateRole=this.accountUserRole):(c=this.getCustomRoleName(e))?(this._createSingleRole.set("value",c),this._currentSelectedCreateRole=e):this._isPortal?(this._createSingleRole.set("value",this._lookupFullRoleName(this._portalDefaultUser)),this._currentSelectedCreateRole=this._portalDefaultUser):(this._createSingleRole.set("value",this.i18n.userRoles.user),this._currentSelectedCreateRole=
this.accountUserRole),this._createSingleMessage.set("value",this._currentCreateMessage),this._createSingleEmail.focus(),this.hide(),b.style(this._step2Create,"display","block"),this._userGrid.set("store",null)))})})},removeInvite:function(a){this._userStore.fetch({onComplete:b.hitch(this,function(e){var c=!1,d=e.length;b.forEach(e,b.hitch(this,function(b){this._mode===this.modeInvite||this._mode===this.modeIDP?this._userStore.getValue(b,"email")===a&&(this._userStore.deleteItem(b),c=!0):this._mode===
this.modeCreate&&this._userStore.getValue(b,"username")===a&&(this._userStore.deleteItem(b),c=!0)}));c&&this._userStore.save({onComplete:b.hitch(this,function(){this._userGrid.set("store",this._userStore);this._userGrid.sort();1===d?this._mode===this.modeInvite?(this.resetInviteErrorMessage(),this.hide(),b.style(this._step2Invite,"display","block"),this.resetUserStore()):this._mode===this.modeIDP?(this.resetIDPErrorMessage(),this.hide(),b.style(this._step2IDP,"display","block"),this.resetUserStore()):
this._mode===this.modeCreate&&(this.resetCreateErrorMessage(),this.hide(),b.style(this._step2Create,"display","block"),this.resetUserStore()):this.checkUserLimit()})})})})},createFullName:function(a){var e=a.fullName;esri.isDefined(a.firstName)&&esri.isDefined(a.lastName)&&(e="ja"===b.locale?a.lastName+" "+a.firstName:a.firstName+" "+a.lastName);return e},buildCreateEmailSubject:function(){return this.i18n.email.createSubject},buildCreateEmailMessage:function(a){var b=this._util.getSecureUrl(esriGeowConfig.baseUrl),
c=this.createHTMLLineBreaks(a);a=esriGeowConfig.baseUrl.indexOf(location.host);b="";-1<a&&(b=esriGeowConfig.baseUrl.substring(a+location.host.length));a="";this._settings.urlKey&&this._settings.customBaseUrl?(a=(this._settings.allSSL?"https://":"http://")+this._settings.urlKey+"."+this._settings.customBaseUrl,a+=b):a=esriGeowConfig.baseUrl;b="https://"+this._settings.portalHostname+b;c="\x3chtml\x3e\x3cbody\x3e\x3cp\x3e"+c+"\x3c/p\x3e"+("\x3cp\x3e"+this.i18n.email.clickToSignIn+'\x3ca href\x3d"'+
b+'newuser.html?invitation\x3d@@invitation.id@@"\x3e');c+=b+"newuser.html?invitation\x3d@@invitation.id@@\x3c/a\x3e\x3c/p\x3e";c+="\x3cp\x3e"+esri.substitute({username:"\x3cstrong\x3e@@touser.username@@\x3c/strong\x3e",organizationURL:a},this.i18n.email.usernameMsg)+"\x3c/p\x3e";this._isPortal||(c+="\x3cp\x3e",this._invitingUser?(b=this.createFullName(this._invitingUser),c+=esri.substitute({name:b,email:this._invitingUser.email},this.i18n.email.emailDifficultyAdminMsg)):c+=this.i18n.email.emailDifficultyMsg,
c+=" "+this.i18n.email.preEstablishedAddon+"\x3c/p\x3e");if(this._settings.subscriptionInfo&&("Trial"===this._settings.subscriptionInfo.type||"Trial Press"===this._settings.subscriptionInfo.type))c+="\x3cp\x3e"+this.i18n.email.trialMsg+"\x3c/p\x3e";c+="\x3cp\x3e"+this.i18n.email.orgUrlMsg+"\x3cbr\x3e"+a+"\x3c/p\x3e";c+="\x3cp\x3e"+this.i18n.email.linkExpiresMsg+"\x3c/p\x3e";c+='\x3cp style\x3d"color:gray;"\x3e';c+=this.i18n.email.automatedMsg;return c+="\x3c/p\x3e\x3c/body\x3e\x3c/html\x3e"},buildIDPEmailSubject:function(){var a=
esri.substitute({organization:this._settings.name,portalName:esriGeowConfig.portalName||this.i18n.arcgis},this.i18n.email.idpSubject);this._isPortal&&(a=esri.substitute({organization:this._settings.name},this.i18n.email.idpPortalSubject));return a},buildIDPEmailMessage:function(a){var b=this._util.getSecureUrl(esriGeowConfig.baseUrl),c=esriGeowConfig.baseUrl.indexOf(location.host),b="",d=!1===esriGeowConfig.isMultiTenant;-1<c&&(b=esriGeowConfig.baseUrl.substring(c+location.host.length));c="";this._settings.urlKey&&
this._settings.customBaseUrl?(c=(this._settings.allSSL?"https://":"http://")+this._settings.urlKey+"."+this._settings.customBaseUrl,c+=b,b=this._util.getSecureUrl(c)):(c=esriGeowConfig.baseUrl,b="https://"+this._settings.portalHostname+b,d&&(b=arcgisonline.sharing.util.getSecureUrl(b)));a=this.createHTMLLineBreaks(a);d=b+"join.html";a="\x3chtml\x3e\x3cbody\x3e\x3cp\x3e"+a+"\x3c/p\x3e"+("\x3cp\x3e"+this.i18n.email.clickToJoin+'\x3cbr\x3e\x3ca href\x3d"'+d+'?invitation\x3d@@invitation.id@@\x26join\x3dtrue"\x3e');
a+=d+"?invitation\x3d@@invitation.id@@\x26join\x3dtrue\x3c/a\x3e\x3c/p\x3e";this._isPortal||(a+="\x3cp\x3e",this._invitingUser?(d=this.createFullName(this._invitingUser),a+=esri.substitute({name:d,email:this._invitingUser.email},this.i18n.email.emailDifficultyAdminMsg)):a+=this.i18n.email.emailDifficultyMsg,a+="\x3c/p\x3e");a+="\x3cp\x3e"+this.i18n.email.orgUrlMsg+"\x3cbr\x3e"+c+"\x3c/p\x3e";a+="\x3cp\x3e"+this.i18n.email.linkExpiresMsg+"\x3c/p\x3e";a+='\x3cp style\x3d"color:gray;"\x3e';a+=this.i18n.email.automatedMsg;
return a+="\x3c/p\x3e\x3c/body\x3e\x3c/html\x3e"},buildInvitationEmailSubject:function(){var a=esri.substitute({organization:this._settings.name,portalName:esriGeowConfig.portalName||this.i18n.arcgis},this.i18n.email.inviteSubject);this._isPortal&&(a=esri.substitute({organization:this._settings.name},this.i18n.email.invitePortalSubject));return a},buildInvitationEmailMessage:function(a){var b=this._util.getSecureUrl(esriGeowConfig.baseUrl),c=esriGeowConfig.baseUrl.indexOf(location.host),b="",d=!1===
esriGeowConfig.isMultiTenant;-1<c&&(b=esriGeowConfig.baseUrl.substring(c+location.host.length));c="";this._settings.urlKey&&this._settings.customBaseUrl?(c=(this._settings.allSSL?"https://":"http://")+this._settings.urlKey+"."+this._settings.customBaseUrl,c+=b,b="https://"+this._settings.portalHostname+b):(c=esriGeowConfig.baseUrl,b="https://"+this._settings.portalHostname+b,d&&(b=arcgisonline.sharing.util.getSecureUrl(b)));d=this.createHTMLLineBreaks(a);a=b+esriGeowConfig.signin;if(this._settings.subscriptionInfo){var f=
this._settings.subscriptionInfo.type;if("Trial"===f||"Trial Press"===f||"Evaluation"===f)a=b+esriGeowConfig.createAccount}b="\x3chtml\x3e\x3cbody\x3e\x3cp\x3e"+d+"\x3c/p\x3e"+("\x3cp\x3e"+this.i18n.email.clickToJoin+'\x3cbr\x3e\x3ca href\x3d"'+a+'?invitation\x3d@@invitation.id@@"\x3e');b+=a+"?invitation\x3d@@invitation.id@@\x3c/a\x3e\x3c/p\x3e";this._isPortal||(b+="\x3cp\x3e",this._invitingUser?(a=this.createFullName(this._invitingUser),b+=esri.substitute({name:a,email:this._invitingUser.email},this.i18n.email.emailDifficultyAdminMsg)):
b+=this.i18n.email.emailDifficultyMsg,b+=" "+this.i18n.email.existingAddon+"\x3c/p\x3e");if(this._settings.subscriptionInfo&&("Trial"===this._settings.subscriptionInfo.type||"Trial Press"===this._settings.subscriptionInfo.type))b+="\x3cp\x3e"+this.i18n.email.trialMsg+"\x3c/p\x3e";b+="\x3cp\x3e"+this.i18n.email.orgUrlMsg+"\x3cbr\x3e"+c+"\x3c/p\x3e";b+="\x3cp\x3e"+this.i18n.email.linkExpiresMsg+"\x3c/p\x3e";b+='\x3cp style\x3d"color:gray;"\x3e';b+=this.i18n.email.automatedMsg;return b+="\x3c/p\x3e\x3c/body\x3e\x3c/html\x3e"},
handleCheckFixedUsername:function(a){a&&!a.code&&!a.message?a.usernames&&a.usernames[0]&&(a=a.usernames[0],this._settingFixUsername=!0,a.requested===a.suggested?this._fixUsername.set("value",a.requested):this._fixUsername.set("value",a.suggested)):console.log(a)},handleCheckUsername:function(a){a&&!a.code&&!a.message?a.usernames&&a.usernames[0]&&(a=a.usernames[0],this._settingCreateSingleUser=!0,a.requested===a.suggested?this._createSingleUsername.set("value",a.requested):this._createSingleUsername.set("value",
a.suggested)):console.log(a)},handleCreateFileSelection:function(a){0===b.trim(this._createBatchFile.get("value")).length?this.setCreateErrorMessage(this.i18n.step2Create.invalid.noFile):(this._createBatchUploadBtn.set("disabled",!0),a&&1===a.length&&"undefined"!==typeof FileReader?this.handleCreateFile(a[0]):(this._createBatchFile.domNode.name="data",esri.request({url:esriGeowConfig.reflectorUrl,form:this._createBatchForm,content:{f:"json"},callbackParamName:"callback.html",handleAs:"json",load:b.hitch(this,
function(a){a.error?this.uploadError(a.error):this.handleCreateFile(a)}),error:b.hitch(this,this.uploadError)})))},handleInviteFileSelection:function(a){0===b.trim(this._inviteBatchFile.get("value")).length?this.setInviteErrorMessage(this.i18n.step2Invite.invalid.noFile):(this._inviteBatchUploadBtn.set("disabled",!0),a&&1===a.length&&"undefined"!==typeof FileReader?this.handleInviteFile(a[0]):(this._inviteBatchFile.domNode.name="data",esri.request({url:esriGeowConfig.reflectorUrl,form:this._inviteBatchForm,
content:{f:"json"},callbackParamName:"callback.html",handleAs:"json",load:b.hitch(this,function(a){a.error?this.uploadError(a.error):this.handleInviteFile(a)}),error:b.hitch(this,this.uploadError)})))},handleIDPFileSelection:function(a){0===b.trim(this._idpBatchFile.get("value")).length?this.setIDPErrorMessage(this.i18n.step2IDP.invalid.noFile):(this._idpBatchUploadBtn.set("disabled",!0),a&&1===a.length&&"undefined"!==typeof FileReader?this.handleIDPFile(a[0]):(this._idpBatchFile.domNode.name="data",
esri.request({url:esriGeowConfig.reflectorUrl,form:this._idpBatchForm,content:{f:"json"},callbackParamName:"callback.html",handleAs:"json",load:b.hitch(this,function(a){a.error?this.uploadError(a.error):this.handleIDPFile(a)}),error:b.hitch(this,this.uploadError)})))},handleCreateFile:function(a){var e=(a.type||a.contentType||" ").toLowerCase(),c=a.name||a.fileName;if(b.isIE)var d=c.split("\\"),c=d[d.length-1];c=c.toLowerCase();if(-1!==e.indexOf("text/")||-1!==c.indexOf(".txt")||-1!==c.indexOf(".csv"))if(a.data)a=
this.bytesToString(s.encoding.base64.decode(a.data)),this._isPortal&&("ldap"===this._userType||"windows"===this._userType)?this.processCreateCsvDataAD(a,c):this.processCreateCsvData(a,c);else{var f=new FileReader;f.onload=b.hitch(this,function(){this._isPortal&&("ldap"===this._userType||"windows"===this._userType)?this.processCreateCsvDataAD(f.result,c):this.processCreateCsvData(f.result,c)});f.readAsText(a)}else this.setCreateErrorMessage(this.i18n.step2Create.invalid.fileType)},handleInviteFile:function(a){var e=
(a.type||a.contentType||" ").toLowerCase(),c=a.name||a.fileName;if(b.isIE)var d=c.split("\\"),c=d[d.length-1];c=c.toLowerCase();if(-1!==e.indexOf("text/")||-1!==c.indexOf(".txt")||-1!==c.indexOf(".csv"))if(a.data)a=this.bytesToString(s.encoding.base64.decode(a.data)),this.processInviteCsvData(a,c);else{var f=new FileReader;f.onload=b.hitch(this,function(){this.processInviteCsvData(f.result,c)});f.readAsText(a)}else this.setInviteErrorMessage(this.i18n.step2Invite.invalid.fileType)},handleIDPFile:function(a){var e=
(a.type||a.contentType||" ").toLowerCase(),c=a.name||a.fileName;if(b.isIE)var d=c.split("\\"),c=d[d.length-1];c=c.toLowerCase();if(-1!==e.indexOf("text/")||-1!==c.indexOf(".txt")||-1!==c.indexOf(".csv"))if(a.data)a=this.bytesToString(s.encoding.base64.decode(a.data)),this.processIDPCsvData(a,c);else{var f=new FileReader;f.onload=b.hitch(this,function(){this.processIDPCsvData(f.result,c)});f.readAsText(a)}else this.setIDPErrorMessage(this.i18n.step2IDP.invalid.fileType)},generateUsername:function(a,
b){var c="",d=0<b?""+b:"",f=this._settings.urlKey?"_"+this._settings.urlKey:"",c=this.containsRequiredEmailChars(a)?a.split("@")[0]:""+b,g=c.length+d.length+f.length;return c=c.substring(0,c.length-(g>this._maxUsernameLength?g%this._maxUsernameLength:0))+d+f},_lookupFullRoleName:function(a){if(a===this.accountAdminRole||a===this.orgAdminRole)return this.i18n.userRoles.admin;if(a===this.accountPublisherRole||a===this.orgPublisherRole)return this.i18n.userRoles.publisher;if(a===this.accountUserRole||
a===this.orgUserRole)return this.i18n.userRoles.user;var e=b.filter(this._customRoles,function(b){return b.id===a});return e&&e[0]?e[0].name:""},_lookupRoleName:function(a){if(a===this.accountAdminRole||a===this.orgAdminRole)return this.i18n.userRoles.admin.toLowerCase();if(a===this.accountPublisherRole||a===this.orgPublisherRole)return this.i18n.userRoles.publisher.toLowerCase();if(a===this.accountUserRole||a===this.orgUserRole)return this.i18n.userRoles.user.toLowerCase();var e=b.filter(this._customRoles,
function(b){return b.id===a});return(e&&e[0]?e[0].name:"").toLowerCase()},_toggleGroupSelection:function(){if(this._mode===this.modeCreate&&(this._isAdmin||this._roleCanAddUsers)){b.style(this._groupSelection.domNode,"display","");var a=esri.substitute({groupsButtonName:this.i18n.step3.specifyGroups,addButtonName:this._addMode||this._isPortal?this.i18n.step3.addMembers:this.i18n.step3.sendInvitations},this._isPortal?this.i18n.step3.subMessageAddPortal:this.i18n.step3.subMessageAdd);b.attr(this._step3SubMessage,
"innerHTML",a)}else b.style(this._groupSelection.domNode,"display","none"),b.attr(this._step3SubMessage,"innerHTML","")},onGroupSelection:function(){b.attr(this._step4Message,"innerHTML",this._isPortal?this.i18n.step4.messagePortal:this.i18n.step4.message);this.hide();b.style(this._step4,"display","block");this._groupSelector._initialize();this.checkUserLimit()},onBackGroups:function(){this._groupSelector.set("selectedGroups",[]);this._selectedGroups=[];this.goToStep3();this.checkUserLimit()},goToStep3:function(){this.hide();
b.style(this._step3,"display","block");this._toggleGroupSelection()},processCreateCsvData:function(a,e,c){e=a.indexOf("\n");e=b.trim(a.substr(0,e));e=this.getSeparator(e);var d=new s.data.CsvStore({data:a,separator:e});d.fetch({onComplete:b.hitch(this,function(a){this.initializeUserStore();var c=this._userStore?this._userStore._arrayOfAllItems.length:0,e=[],h=[],l=!1,m=0,n;b.forEach(a,b.hitch(this,function(a){var f=d.getValue(a,this.i18n.csv.firstName),l=d.getValue(a,this.i18n.csv.lastName),n=d.getValue(a,
this.i18n.csv.email),p=d.getValue(a,this.i18n.csv.role),r=d.getValue(a,this.i18n.csv.username),v=0,t;if(!esri.isDefined(r)||1>r.length)r=this.generateUsername(esri.isDefined(n)?n:"",v);for(this._addMode&&(t=d.getValue(a,this.i18n.csv.password));-1<b.indexOf(h,r);)v++,r=this.generateUsername(n,v);this._isPortal&&p&&p.toLowerCase()===this.i18n.userRoles.admin.toLowerCase()?p=this.accountAdminRole:p&&p.toLowerCase()===this.i18n.csv.publisherRole.toLowerCase()?p=this.accountPublisherRole:p&&p.toLowerCase()===
this.i18n.csv.userRole.toLowerCase()?p=this.accountUserRole:(p=this.getCustomRoleId(p))||(p=this._isPortal?this._portalDefaultUser:this.accountUserRole);a="ja"===b.locale?l+" "+f:f+" "+l;v=this._lookupRoleName(p);f={id:e.length+c,firstname:f,lastname:l,fullname:a,username:this._isPortal?this.cleanUsernamePortal(r):this.cleanUsername(r),email:n,role:p,rolename:v};this._addMode&&(f.password=t?b.trim(t):"");this._isPortal&&"saml"===this._userType&&(f.provider=this.enterpriseProvider);if(this._isPortal&&
("ldap"===this._userType||"windows"===this._userType)?this.containsInvalidFieldsAD(f):this._isPortal&&"saml"===this._userType?this.containsInvalidFieldsSAML(f):this.containsInvalidFields(f))f.invalid=!0,m++;e.push(f);h.push(f.username)}));0<h.length?this._account.checkUsernames(h,b.hitch(this,function(a){if(a.usernames&&a.usernames.length===h.length){var c=[];for(n=0;n<a.usernames.length;n++){var d=-1,f;for(f=0;f<e.length;f++)if(e[f].username===a.usernames[n].requested){d=f;break}var g=new b.Deferred;
if(-1<d)if(this._isPortal&&"saml"===this._userType){var r=!1;e[d].username!=a.usernames[n].suggested&&(this.setReviewWarningMessage(this.i18n.step2Create.invalid.usernameExistsFile),r=!0);this._userStore.fetchItemByIdentity({identity:e[d].username,onItem:b.hitch(this,function(a){!esri.isDefined(a)&&!r?this._userStore.newItem(e[d]):e[d].invalid&&(e[d].invalid=!1,m--);l=!0;g.resolve()})})}else e[d].username=a.usernames[n].suggested,this._userStore.fetchItemByIdentity({identity:e[d].username,onItem:b.hitch(this,
function(a){esri.isDefined(a)?e[d].invalid&&(e[d].invalid=!1,m--):this._userStore.newItem(e[d]);l=!0;g.resolve()})});else g.resolve();c.push(g)}(new b.DeferredList(c)).then(b.hitch(this,function(){l?this._userStore.save({onComplete:b.hitch(this,function(){this._currentCreateMessage=this._createBatchMessage.get("value");this._editingCreate=!1;this._editingCreateUser=null;this.resetCreateSingleForm(!0);m?(this.initializeFixErrors(),this.hide(),b.style(this._fixErrors,"display","block")):(this.goToStep3(),
this.initializeCreateUserGrid())})}):this.setCreateErrorMessage(this.i18n.step2Create.invalid.uploadNoUsers)}))}else this.setCreateErrorMessage(this.i18n.step2Create.invalid.upload)})):this.setCreateErrorMessage(this.i18n.step2Create.invalid.uploadNoUsers)}),onError:b.hitch(this,function(a){console.log("CSV fetch error",a);this.setCreateErrorMessage(this.i18n.step2Create.invalid.upload)})})},processCreateCsvDataAD:function(a,e,c){this.resetReviewWarningMessage();e=a.indexOf("\n");e=b.trim(a.substr(0,
e));e=this.getSeparator(e);var d=new s.data.CsvStore({data:a,separator:e});d.fetch({onComplete:b.hitch(this,function(a){this.initializeUserStore();var c=[],e=[],h=[],l=!1,m=0,n;b.forEach(a,b.hitch(this,function(a){a=d.getValue(a,this.i18n.csv.username);var b=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))+"/portaladmin/security/users/getEnterpriseUser/";this.notSet(a)||(a=this._util.request({url:b,content:{username:a}},{usePost:!0}),h.push(a))}));(new b.DeferredList(h)).then(b.hitch(this,
function(h){b.forEach(h,b.hitch(this,function(l){if(l[0]&&l[1]){var h="";b.forEach(a,b.hitch(this,function(a){var b=d.getValue(a,this.i18n.csv.username);-1<l[1].username.toLowerCase().indexOf(b.toLowerCase())&&(h=d.getValue(a,this.i18n.csv.role),this._isPortal&&h&&h.toLowerCase()===this.i18n.userRoles.admin.toLowerCase()?h=this.accountAdminRole:h&&h.toLowerCase()===this.i18n.csv.publisherRole.toLowerCase()?h=this.accountPublisherRole:h&&h.toLowerCase()===this.i18n.csv.userRole.toLowerCase()?h=this.accountUserRole:
(h=this.getCustomRoleId(h))||(h=this._isPortal?this._portalDefaultUser:this.accountUserRole))}));""===h&&(h=this._isPortal?this._portalDefaultUser:this.accountUserRole);var m=this._lookupRoleName(h),k=l[1].email,n=this._cleanUsernameDomain(l[1].username),u=l[1].fullname,t=u.split(" "),m={username:n,fullname:u,firstname:t[0],lastname:t[1],email:k,role:h,rolename:m,provider:this.enterpriseProvider};m.id=(new Date).getTime();c.push(m);e.push(m.username)}}));0<e.length?this._account.checkUsernames(e,
b.hitch(this,function(a){if(a.usernames&&a.usernames.length===e.length){var d=[];for(n=0;n<a.usernames.length;n++){var f=-1,h;for(h=0;h<c.length;h++)if(c[h].username===a.usernames[n].requested){f=h;break}var k=new b.Deferred;if(-1<f){var u=!1;c[f].username!=a.usernames[n].suggested&&(this.setReviewWarningMessage(this.i18n.step2Create.invalid.usernameExistsFile),u=!0);this._userStore.fetchItemByIdentity({identity:c[f].username,onItem:b.hitch(this,function(a){!esri.isDefined(a)&&!u?this._userStore.newItem(c[f]):
c[f].invalid&&(c[f].invalid=!1,m--);l=!0;k.resolve()})})}else k.resolve();d.push(k)}(new b.DeferredList(d)).then(b.hitch(this,function(){l?this._userStore.save({onComplete:b.hitch(this,function(){this._currentCreateMessage=this._createBatchMessage.get("value");this._editingCreate=!1;this._editingCreateUser=null;this.resetCreateSingleForm(!0);m?(this.initializeFixErrors(),this.hide(),b.style(this._fixErrors,"display","block")):(this.goToStep3(),this.initializeInviteGroupUserGrid())})}):this.setCreateErrorMessage(this.i18n.step2Create.invalid.uploadNoUsers)}))}else this.setCreateErrorMessage(this.i18n.step2Create.invalid.upload)})):
this.setCreateErrorMessage(this.i18n.step2Create.invalid.uploadNoUsers)}))}),onError:b.hitch(this,function(a){console.log("CSV fetch error",a);this.setCreateErrorMessage(this.i18n.step2Create.invalid.upload)})})},goToNextInvalidUser:function(){this._userStore.fetch({onComplete:b.hitch(this,function(a){this._currentlyFixing=null;var e=!1,c;for(c=0;c<a.length;c++){var d=this._userStore.getValue(a[c],"invalid");if(esri.isDefined(d)&&!0===d){this._currentlyFixing=a[c];this._fixingNumber++;e=!0;break}}e?
(a=esri.substitute({x:this._fixingNumber,n:this._numToFix},this.i18n.fixErrors.usersNeedAttention),b.attr(this._fixCurrent,"innerHTML",a),this.populateFixErrorsForm(),this.onFixNextClicked()):(this.resetFixErrorsForm(!0),this.goToStep3(),this.initializeCreateUserGrid())})})},initializeFixErrors:function(){this._userStore.fetch({onComplete:b.hitch(this,function(a){b.forEach(a,b.hitch(this,function(a){this._totalUsers++;var b=this._userStore.getValue(a,"invalid");esri.isDefined(b)&&!0===b&&(this._numToFix++,
this._currentlyFixing||(this._currentlyFixing=a,this._fixingNumber=1))}));this._fixErrorsContentPane?(a=esri.substitute({x:this._numToFix,n:this._totalUsers,name:this._isPortal?this._settings.name:this.i18n.arcgis},this._addMode?this.i18n.fixErrors.needAttentionAdd:this.i18n.fixErrors.needAttention),b.attr(this._fixAlert,"innerHTML"," "+a),a=esri.substitute({x:this._fixingNumber,n:this._numToFix,name:this._isPortal?this._settings.name:this.i18n.arcgis},this._addMode?this.i18n.fixErrors.usersNeedAttentionAdd:
this.i18n.fixErrors.usersNeedAttention),b.attr(this._fixCurrent,"innerHTML",a)):this.buildFixErrors();this._addMode?(this._fixPasswordRow&&b.style(this._fixPasswordRow,"display",""),this._fixPasswordSpacer&&b.style(this._fixPasswordSpacer,"display","")):(this._fixPasswordRow&&b.style(this._fixPasswordRow,"display","none"),this._fixPasswordSpacer&&b.style(this._fixPasswordSpacer,"display","none"))})})},processInviteCsvData:function(a){var e=a.indexOf("\n"),e=b.trim(a.substr(0,e)),e=this.getSeparator(e),
c=new s.data.CsvStore({data:a,separator:e});c.fetch({onComplete:b.hitch(this,function(a){this.initializeUserStore();var e=[],g=!1;b.forEach(a,b.hitch(this,function(a){var b=c.getValue(a,this.i18n.csv.email);a=c.getValue(a,this.i18n.csv.role);b&&(this._isPortal&&a&&a.toLowerCase()===this.i18n.userRoles.admin.toLowerCase()?a=this.accountAdminRole:a&&a.toLowerCase()===this.i18n.csv.publisherRole.toLowerCase()?a=this.accountPublisherRole:a&&a.toLowerCase()===this.i18n.csv.userRole.toLowerCase()?a=this.accountUserRole:
(a=this.getCustomRoleId(a))||(a=this._isPortal?this._portalDefaultUser:this.accountUserRole),e.push({email:b,role:a,rolename:this._lookupRoleName(a)}))}));a=[];var h;for(h=0;h<e.length;h++){var k=new b.Deferred;this._userStore.fetchItemByIdentity({identity:e[h].email,onItem:b.hitch(this,function(a){esri.isDefined(a)||this._userStore.newItem(e[h]);g=!0;k.resolve()}),onError:b.hitch(this,function(a){this._userStore.newItem(e[h]);g=!0;k.resolve()})});a.push(k)}(new b.DeferredList(a)).then(b.hitch(this,
function(){g?this._userStore.save({onComplete:b.hitch(this,function(){this._currentInviteMessage=this._inviteBatchMessage.get("value");this._editingInvite=!1;this._editingInviteUser=null;this.resetInviteSingleForm(!0);this.goToStep3();this.initializeInviteUserGrid()})}):this.setInviteErrorMessage(this.i18n.step2Invite.invalid.uploadNoUsers)}))}),onError:b.hitch(this,function(a){console.log("CSV fetch error",a);this.setInviteErrorMessage(this.i18n.step2Invite.invalid.upload)})})},processIDPCsvData:function(a){var e=
a.indexOf("\n"),e=b.trim(a.substr(0,e)),e=this.getSeparator(e),c=new s.data.CsvStore({data:a,separator:e});c.fetch({onComplete:b.hitch(this,function(a){this.initializeUserStore();var e=[],g=!1;b.forEach(a,b.hitch(this,function(a){var b=c.getValue(a,this.i18n.csv.email);a=c.getValue(a,this.i18n.csv.role);b&&(this._isPortal&&a&&a.toLowerCase()===this.i18n.userRoles.admin.toLowerCase()?a=this.accountAdminRole:a&&a.toLowerCase()===this.i18n.csv.publisherRole.toLowerCase()?a=this.accountPublisherRole:
a&&a.toLowerCase()===this.i18n.csv.userRole.toLowerCase()?a=this.accountUserRole:(a=this.getCustomRoleId(a))||(a=this._isPortal?this._portalDefaultUser:this.accountUserRole),e.push({email:b,role:a,rolename:this._lookupRoleName(a)}))}));a=[];var h;for(h=0;h<e.length;h++){var k=new b.Deferred;this._userStore.fetchItemByIdentity({identity:e[h].email,onItem:b.hitch(this,function(a){esri.isDefined(a)||this._userStore.newItem(e[h]);g=!0;k.resolve()}),onError:b.hitch(this,function(a){this._userStore.newItem(e[h]);
g=!0;k.resolve()})});a.push(k)}(new b.DeferredList(a)).then(b.hitch(this,function(){g?this._userStore.save({onComplete:b.hitch(this,function(){this._currentIDPMessage=this._idpBatchMessage.get("value");this._editingIDP=!1;this._editingIDPUser=null;this.resetIDPSingleForm(!0);this.goToStep3();this.initializeIDPUserGrid()})}):this.setIDPErrorMessage(this.i18n.step2IDP.invalid.uploadNoUsers)}))}),onError:b.hitch(this,function(a){console.log("CSV fetch error",a);this.setIDPErrorMessage(this.i18n.step2IDP.invalid.upload)})})},
containsInvalidFields:function(a){return a.firstname&&a.lastname&&a.username&&a.email&&a.role&&(!this._addMode||this._addMode&&a.password)?!this.containsRequiredEmailChars(a.email)||a.username.length<this._minUsernameLength||a.username.length>this._maxUsernameLength||!(this._isPortal?this.usernameContainsAlphaNumericPortal(a.username):this.usernameContainsAlphaNumeric(a.username))||this._addMode&&!this._util.meetsPasswordStrength(a.password):!0},containsInvalidFieldsSAML:function(a){return a.firstname&&
a.lastname&&a.username&&a.email&&a.role?!this.containsRequiredEmailChars(a.email)||a.username.length<this._minUsernameLength||a.username.length>this._maxSAMLUsernameLength||!(this._isPortal?this.usernameContainsAlphaNumericPortal(a.username):this.usernameContainsAlphaNumeric(a.username)):!0},containsInvalidFieldsAD:function(a){return a.username&&a.role?!(this._isPortal?this.usernameContainsAlphaNumericPortal(a.username):this.usernameContainsAlphaNumeric(a.username)):!0},uploadError:function(a){console.error("uploadError: ",
a);this._mode===this.modeInvite?this.setInviteErrorMessage(this.i18n.step2Invite.invalid.upload):this._mode===this.modeCreate&&this.setCreateErrorMessage(this.i18n.step2Create.invalid.upload)},populateFixErrorsForm:function(){if(this._currentlyFixing){this._settingFixUsername=this._settingFixEmail=!0;this._addMode&&(this._settingFixPassword=!0);if(this._fixEmail){var a=this._userStore.getValue(this._currentlyFixing,"email");a?this._fixEmail.set("value",a):""===this._fixEmail.get("value")?this._settingFixEmail=
!1:this._fixEmail.set("value","")}this._fixFirstName&&((a=this._userStore.getValue(this._currentlyFixing,"firstname"))?this._fixFirstName.set("value",a):this._fixFirstName.set("value",""));this._fixLastName&&((a=this._userStore.getValue(this._currentlyFixing,"lastname"))?this._fixLastName.set("value",a):this._fixLastName.set("value",""));this._fixUsername&&((a=this._userStore.getValue(this._currentlyFixing,"username"))?(this._fixUsername.set("value",a),this._settingFixUsername=!1):""===this._fixUsername.get("value")?
this._settingFixUsername=!1:this._fixUsername.set("value",""));this._addMode&&(this._fixPassword&&"saml"!==this._userType)&&((a=this._userStore.getValue(this._currentlyFixing,"password"))?this._fixPassword.set("value",a):""===this._fixPassword.get("value")?this._settingFixPassword=!1:this._fixPassword.set("value",""));a=this._userStore.getValue(this._currentlyFixing,"role");this._isPortal&&this.accountAdminRole?this._fixRole.set("value",this.i18n.userRoles.admin):a===this.accountPublisherRole?this._fixRole.set("value",
this.i18n.userRoles.publisher):a===this.accountUserRole?this._fixRole.set("value",this.i18n.userRoles.user):(a=this.getCustomRoleName(a))?this._fixRole.set("value",a):this._isPortal?this._fixRole.set("value",this._portalDefaultUser):this._fixRole.set("value",this.i18n.userRoles.user)}},getSeparator:function(a){var e=0,c="";b.forEach([","," ",";","|","\t"],function(b){var f=a.split(b).length;f>e&&(e=f,c=b)});return c},bytesToString:function(a){var b=0,c=[],d=a.length,f,g,h,k;for("239,187,191"==a.slice(0,
3)&&(b=3);b<d;b++)f=a[b],128>f?c.push(String.fromCharCode(f)):194<=f&&224>f?(g=a[++b],c.push(String.fromCharCode(((f&31)<<6)+(g&63)))):224<=f&&240>f?(g=a[++b],h=a[++b],c.push(String.fromCharCode(((f&255)<<12)+((g&63)<<6)+(h&63)))):240<=f&&245>f&&(g=a[++b],h=a[++b],k=a[++b],f=((f&7)<<18)+((g&63)<<12)+((h&63)<<6)+(k&63),f-=65536,c.push(String.fromCharCode((f>>10)+55296,(f&1023)+56320)));return c.join("")},isSet:function(a){return esri.isDefined(a)&&0<a.length},notSet:function(a){return!esri.isDefined(a)||
""===a},cleanUsername:function(a){a&&0<a.length&&(a=a.replace(/[^[a-zA-Z0-9@_\.]]*/g,"_"));return a},cleanUsernamePortal:function(a){a&&0<a.length&&(a=a.replace(/[^[a-zA-Z0-9@_\.\-]]*/g,"_"));return a},containsRequiredEmailChars:function(a){if(window.RegExp){var b=/^.+@(\[?)[a-zA-Z0-9\-\.]+\.([a-zA-Z]{2,20}|[0-9]{1,3})(\]?)$/;return!/(@.*@)|(\.\.)|(@\.)|(\.@)|(^\.)/.test(a)&&b.test(a)?!0:!1}return-1===a.indexOf("@")||-1===a.indexOf(".")?!1:!0},createHTMLLineBreaks:function(a){if(a)for(var b=-1;-1<
(b=a.indexOf("\n"));)a=0===b?"\x3cbr\x3e"+a.substring(b+1):a.substring(0,b)+"\x3cbr\x3e"+a.substring(b+1);return a},firstNameFormatter:function(a,b){return!b?this.defaultValue:b.firstname[0]?b.firstname[0]:""},lastNameFormatter:function(a,b){return!b?this.defaultValue:b.lastname[0]?b.lastname[0]:""},fullNameFormatter:function(a,b){return!b?this.defaultValue:(b.firstname[0]?b.firstname[0]:"")+" "+(b.lastname[0]?b.lastname[0]:"")},emailFormatter:function(a,b){return!b?this.defaultValue:b.email[0]?b.email[0]:
""},usernameFormatter:function(a,b){return!b?this.defaultValue:b.username[0]?b.username[0]:""},roleFormatter:function(a,b){if(!b)return this.defaultValue;var c,d,f=b.role[0],g=h.byId("inviteWidget");if(f===g.accountUserRole)c=g.i18n.userRoles.user,d=g.i18n.userRoleTooltip;else if(f===g.accountPublisherRole)c=g.i18n.userRoles.publisher,d=g.i18n.publisherRoleTooltip;else if(g._isPortal&&f===g.accountAdminRole)c=g.i18n.userRoles.admin,d=g.i18n.adminRoleTooltip;else{var q=g.getCustomRoleName(f),f=g.getCustomRoleDesc(f);
q&&(c=q,f&&(d=f))}return'\x3cspan title\x3d"'+d+'"\x3e'+c+"\x3c/span\x3e"},editFormatter:function(a,b){if(!b)return this.defaultValue;var c=h.byId("inviteWidget"),d=c.i18n.formatters.editLabel,f=c.i18n.formatters.removeLabel,g="",q=c._mode;q===c.modeInvite||q===c.modeIDP?g=b.email[0]:q===c.modeCreate&&(g=b.username[0]);return c="\x3ca class\x3d'esriContentItemTitle' style\x3d'text-decoration:underline;' href\x3d'#' onclick\x3d'dijit.byId(\"inviteWidget\").editInvite(\""+g+"\");'\x3e"+d+"\x3c/a\x3e"+
(" \x3ca class\x3d'esriContentItemTitle' style\x3d'text-decoration:underline;' href\x3d'#' onclick\x3d'dijit.byId(\"inviteWidget\").removeInvite(\""+g+"\");'\x3e"+f+"\x3c/a\x3e")},editFormatterGroup:function(a,b){if(!b)return this.defaultValue;var c=h.byId("inviteWidget"),d=c.i18n.formatters.removeLabel,f="",g=c._mode;g===c.modeInvite||g===c.modeIDP?f=b.email[0]:g===c.modeCreate&&(f=b.username[0]);return" \x3ca class\x3d'esriContentItemTitle' style\x3d'text-decoration:underline;' href\x3d'#' onclick\x3d'dijit.byId(\"inviteWidget\").removeInvite(\""+
f+"\");'\x3e"+d+"\x3c/a\x3e"},canSortGroupColumns:function(a){return 5!==a},canSortColumns:function(a){var b=h.byId("inviteWidget");return b._mode===b.modeCreate?6!==a:3!==a},onTypeNextClicked:function(){b.forEach(b.query("[name\x3d'memberType']"),b.hitch(this,function(a){a.checked&&(this._userType=a.value)}));this.onCreateUsers()},onFixBackClicked:function(){this.resetCreateSingleForm(!0);this.hide();b.style(this._step2Create,"display","block");this.resetUserStore()},onFixClicked:function(){this.populateFixErrorsForm();
this.onFixNextClicked();b.style(this._fixAlertDiv,"display","none");b.style(this._fixEditDiv,"display","block")},onFixReviewClicked:function(){this.resetFixErrorsForm(!0);this.goToStep3();this.initializeCreateUserGrid()},onFixEmailChanged:function(){if(this._settingFixEmail)this._settingFixEmail=!1;else{var a=this._fixEmail.get("value");if(this.containsRequiredEmailChars(a)){this.resetFixErrorMessage();var a=a.split("@")[0],e=this._settings.urlKey?"_"+this._settings.urlKey:"",c=a.length+e.length,
a=a.substring(0,a.length-(c>this._maxUsernameLength?c%this._maxUsernameLength:0))+e,a=this._isPortal?this.cleanUsernamePortal(a):this.cleanUsername(a);this._account.checkUsernames([a],b.hitch(this,this.handleCheckFixedUsername),b.hitch(this,this.handleCheckFixedUsername))}else this.setCreateErrorMessage(esri.substitute({email:a},this.i18n.fixErrors.invalid.emailAddress))}},onFixUsernameChanged:function(){if(this._settingFixUsername)this._settingFixUsername=!1;else{var a=this._fixUsername.get("value");
this.notSet(a)?this.setFixErrorMessage(this.i18n.fixErrors.invalid.usernameIsBlank):this.usernameContainsAlphaNumeric(a)?(a=this._isPortal?this.cleanUsernamePortal(a):this.cleanUsername(a),this._account.checkUsernames([a],b.hitch(this,this.handleCheckFixedUsername),b.hitch(this,this.handleCheckFixedUsername))):this.setFixErrorMessage(this.i18n.fixErrors.invalid.usernameInvalidChars)}},onFixPasswordChanged:function(){if(this._settingFixPassword)this._settingFixPassword=!1;else{var a=this._fixPassword.get("value");
(this.notSet(a)||this.isSet(a)&&this._util.meetsPasswordStrength(a))&&this.setCreateErrorMessage(this.i18n.passwordHintText)}},onFixNextClicked:function(){var a="",e="",c="";this._fixEmail&&(this._fixFirstName&&this._fixLastName)&&(a=this._util.stripHTML(this._fixEmail.get("value")),e=this._util.stripHTML(this._fixFirstName.get("value")),c=this._util.stripHTML(this._fixLastName.get("value")));var d=this._util.stripHTML(this._fixUsername.get("value")),f=this._util.stripHTML(this._fixRole.get("value")),
g=this.accountUserRole,g=this._isPortal&&f===this.i18n.userRoles.admin?this.accountAdminRole:f===this.i18n.userRoles.publisher?this.accountPublisherRole:this._isPortal&&f===this.i18n.userRoles.user?this.accountUserRole:this.getCustomRoleId(f)||this.getDefaultUserRole(),e=this._util.stripHTML(b.trim(e)),c=this._util.stripHTML(b.trim(c)),a=this._util.stripHTML(b.trim(a)),h="ja"===b.locale?c+" "+e:e+" "+c,k={username:this._isPortal?this.cleanUsernamePortal(d):this.cleanUsername(d),fullname:h,firstname:e,
lastname:c,email:a,role:g,rolename:f};this._addMode&&(this._fixPassword&&"saml"!==this._userType)&&(k.password=b.trim(this._fixPassword.get("value")));(this._isPortal&&("ldap"===this._userType||"windows"===this._userType)?this.isValidFixedUserAD(k):this.isValidFixedUser(k))&&this._userStore.fetch({onComplete:b.hitch(this,function(a){var c,d,f;b.forEach(a,b.hitch(this,function(a){c=this._currentlyFixing.username[0];d=this._userStore.getValue(a,"username");f=c===d;this._currentlyFixing&&f&&(c!==k.username?
(this._userStore.deleteItem(a),this._userStore.newItem(k)):(this._userStore.setValue(a,"email",k.email),this._userStore.setValue(a,"fullname",k.fullname),this._userStore.setValue(a,"firstname",k.firstname),this._userStore.setValue(a,"lastname",k.lastname),this._addMode&&"builtin"===this._userType&&this._userStore.setValue(a,"password",k.password),this._userStore.setValue(a,"role",k.role),this._userStore.setValue(a,"rolename",k.rolename),this._userStore.setValue(a,"invalid",null)))}));this._userStore.save({onComplete:b.hitch(this,
function(){var a=esri.substitute({username:k.username},this.i18n.fixErrors.success.userFixed);this.setFixSuccessMessage(a);this._fixingNumber===this._numToFix?(this.resetFixErrorsForm(!0),this.goToStep3(),this.initializeCreateUserGrid()):this.goToNextInvalidUser()}),onError:b.hitch(this,function(a){this.setCreateErrorMessage(a)})})})})},onCreateUsernameChanged:function(){if(this._settingCreateSingleUser)this._settingCreateSingleUser=!1;else{var a=this._createSingleUsername.get("value");this.notSet(a)?
this.setCreateErrorMessage(this.i18n.step2Create.invalid.usernameIsBlank):(this._isPortal?this.usernameContainsAlphaNumericPortal(a):this.usernameContainsAlphaNumeric(a))?(a=this._isPortal?this.cleanUsernamePortal(a):this.cleanUsername(a),this._account.checkUsernames([a],b.hitch(this,this.handleCheckUsername),b.hitch(this,this.handleCheckUsername))):this.setCreateErrorMessage(this.i18n.step2Create.invalid.usernameInvalidChars)}},onCreatePasswordChanged:function(){if(this._settingCreateSinglePassword)this._settingCreateSinglePassword=
!1;else{var a=this._createSinglePassword.get("value");this.notSet(a)||a.length<this._minPasswordLength?this.setCreateErrorMessage(this.i18n.step2Create.invalid.passwordTooShort):a.length>this._maxPasswordLength&&this.setCreateErrorMessage(this.i18n.step2Create.invalid.passwordTooLong)}},onCreateEmailChanged:function(){if(this._settingCreateSingleEmail)this._settingCreateSingleEmail=!1;else{var a=this._util.stripHTML(this._createSingleEmail.get("value"));if(this.containsRequiredEmailChars(a)){this.resetCreateErrorMessage();
var a=a.split("@")[0],e=this._settings.urlKey?"_"+this._settings.urlKey:"",c=a.length+e.length,a=a.substring(0,a.length-(c>this._maxUsernameLength?c%this._maxUsernameLength:0))+e;a.length<this._minUsernameLength&&(a=this._lengthenUsername(a,this._minUsernameLength-a.length));a=this._isPortal?this.cleanUsernamePortal(a):this.cleanUsername(a);this._account.checkUsernames([a],b.hitch(this,this.handleCheckUsername),b.hitch(this,this.handleCheckUsername))}else this.setCreateErrorMessage(esri.substitute({email:a},
this.i18n.step2Create.invalid.emailAddress))}},_lengthenUsername:function(a,b){if(a&&0<b){var c=""+(new Date).getTime();return a+c.substring(c.length-b)}return a},_cleanUsernameDomain:function(a){if(a&&(this._supportsLDAP||this._supportsWindows)){var b=a.indexOf("\\");if(-1<b&&b<=a.length-2)return a.substring(b+1)+"@"+a.substring(0,b).toUpperCase()}return a},onCreateAnotherUserClicked:function(){this.resetCreateErrorMessage();this.initializeUserStore();var a=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))+
"/portaladmin/security/users/getEnterpriseUser",e=this._createEnterpriseUser.get("value"),c=this._createUserRole.get("value");this._currentSelectedCreateRole=this.accountUserRole;this._currentSelectedCreateRole=this._isPortal&&c===this.i18n.userRoles.admin?this.accountAdminRole:c===this.i18n.userRoles.publisher?this.accountPublisherRole:this._isPortal&&c===this.i18n.userRoles.user?this.accountUserRole:this.getCustomRoleId(c)||this.getDefaultUserRole();var d=!1;this.notSet(e)&&(d=!0,this.setCreateErrorMessage(this.i18n.step2Create.invalid.usernameIsBlank));
d||this._util.request({url:a,content:{username:e}},{usePost:!0}).then(b.hitch(this,function(a){b.style(b.byId("reviewSpinnerUser"),"display","none");this._createUserReviewBtn.setDisabled(!1);if(a){var d=a.email,h=this._cleanUsernameDomain(a.username);a=a.fullname;var k=a.split(" "),l={username:h,fullname:a,firstname:k[0],lastname:k[1],email:d,role:this._currentSelectedCreateRole,rolename:c,provider:this.enterpriseProvider};this._editingCreate&&this._editingCreateUser&&(l.id=this._editingCreateUser.id[0]);
l.id=(new Date).getTime();this._userStore.fetch({onComplete:b.hitch(this,function(a){var c=!1;b.forEach(a,b.hitch(this,function(a){this._userStore.getValue(a,"username")===l.username&&(c=!0)}));c?(a=esri.substitute({username:l.username},this.i18n.step2Create.invalid.usernameExists),this.setCreateErrorMessage(a)):(this._userStore.newItem(l),this._userStore.save({onComplete:b.hitch(this,function(){this._editingCreate=!1;this._editingCreateUser=null;var a=esri.substitute({email:l.email},this.i18n.step2Invite.success.userAdded);
this.setCreateSuccessMessage(a);this.resetCreateUserForm()}),onError:b.hitch(this,function(a){this.setCreateErrorMessage(a)})}))})})}else arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorTitle,message:esri.substitute({name:this._util.stripHTML(e)},this.i18n.step2Create.invalid.userNameDoesntExist)})}),b.hitch(this,function(a){b.style(b.byId("reviewSpinnerUser"),"display","none");this._createUserReviewBtn.setDisabled(!1);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorTitle,
message:esri.substitute({name:this._util.stripHTML(e)},this.i18n.step2Create.invalid.userNameDoesntExist)})}))},onCreateUserReviewClicked:function(){this.resetCreateErrorMessage();this.resetReviewWarningMessage();this.initializeUserStore();var a=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))+"/portaladmin/security/users/getEnterpriseUser",e=this._createEnterpriseUser.get("value"),c=this._createUserRole.get("value");this._currentSelectedCreateRole=this.accountUserRole;
this._currentSelectedCreateRole=this._isPortal&&c===this.i18n.userRoles.admin?this.accountAdminRole:c===this.i18n.userRoles.publisher?this.accountPublisherRole:this._isPortal&&c===this.i18n.userRoles.user?this.accountUserRole:this.getCustomRoleId(c)||this.getDefaultUserRole();this.notSet(e)&&this._userStore&&this._userStore._arrayOfAllItems&&0===this._userStore._arrayOfAllItems.length?(this.setCreateErrorMessage(this.i18n.step2Create.invalid.usernameIsBlank),b.style(b.byId("reviewSpinnerUser"),"display",
"none"),this._createUserReviewBtn.setDisabled(!1)):(b.style(b.byId("reviewSpinnerUser"),"display",""),this._createUserReviewBtn.setDisabled(!0),this.notSet(e)?(this.goToStep3(),this.initializeInviteGroupUserGrid(),b.style(b.byId("reviewSpinnerUser"),"display","none"),this._createUserReviewBtn.setDisabled(!1)):this._util.request({url:a,content:{username:e}},{usePost:!0}).then(b.hitch(this,function(a){b.style(b.byId("reviewSpinnerUser"),"display","none");this._createUserReviewBtn.setDisabled(!1);if(a){var f=
a.email,g=this._cleanUsernameDomain(a.username);a=a.fullname;var h=a.split(" "),k={username:g,fullname:a,firstname:h[0],lastname:h[1],email:f,role:this._currentSelectedCreateRole,rolename:c,provider:this.enterpriseProvider};this._editingCreate&&this._editingCreateUser&&(k.id=this._editingCreateUser.id[0]);k.id=(new Date).getTime();this._userStore.fetch({onComplete:b.hitch(this,function(a){var c=!1;b.forEach(a,b.hitch(this,function(a){this._userStore.getValue(a,"username")===k.username&&(c=!0)}));
c||this._userStore.newItem(k);this._userStore.save({onComplete:b.hitch(this,function(){this._editingCreate=!1;this._editingCreateUser=null;var a=esri.substitute({email:k.email},this.i18n.step2Invite.success.userAdded);this.setCreateSuccessMessage(a);this.resetCreateUserForm();this.goToStep3();this.initializeInviteGroupUserGrid()}),onError:b.hitch(this,function(a){this.setCreateErrorMessage(a)})})})})}else arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorTitle,
message:esri.substitute({name:this._util.stripHTML(e)},this.i18n.step2Create.invalid.userNameDoesntExist)})}),b.hitch(this,function(a){b.style(b.byId("reviewSpinnerUser"),"display","none");this._createUserReviewBtn.setDisabled(!1);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorTitle,message:esri.substitute({name:this._util.stripHTML(e)},this.i18n.step2Create.invalid.userNameDoesntExist)})})))},onCreateGroupReviewClicked:function(){this.resetCreateErrorMessage();
this.resetUserStore();this.initializeUserStore();var a=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))+"/portaladmin/security/groups/getUsersWithinEnterpriseGroup",e=this._createEnterpriseGroup.get("value"),c=this._createGroupRole.get("value");this._currentSelectedCreateRole=this.accountUserRole;this._currentSelectedCreateRole=this._isPortal&&c===this.i18n.userRoles.admin?this.accountAdminRole:c===this.i18n.userRoles.publisher?this.accountPublisherRole:this._isPortal&&
c===this.i18n.userRoles.user?this.accountUserRole:this.getCustomRoleId(c)||this.getDefaultUserRole();var d=!1;this.notSet(e)&&(d=!0,this.setCreateErrorMessage(this.i18n.step2Create.invalid.groupNameIsBlank));d||(b.style(b.byId("reviewSpinner"),"display",""),this._createGroupReviewBtn.setDisabled(!0),this._util.request({url:a,content:{groupName:e}},{usePost:!0}).then(b.hitch(this,function(a){b.style(b.byId("reviewSpinner"),"display","none");this._createGroupReviewBtn.setDisabled(!1);a&&!a.code?b.forEach(a.users,
b.hitch(this,function(a){var d=a.email,f=this._cleanUsernameDomain(a.username);a=a.fullname;var e=a.split(" "),h={username:f,fullname:a,firstname:e[0],lastname:e[1],email:d,role:this._currentSelectedCreateRole,rolename:c,provider:this.enterpriseProvider};this._editingCreate&&this._editingCreateUser&&(h.id=this._editingCreateUser.id[0]);this._editingCreate?this._userStore.fetch({onComplete:b.hitch(this,function(a){var c=!1;b.forEach(a,b.hitch(this,function(a){!c&&this._userStore.getValue(this._editingCreateUser,
"id")===this._userStore.getValue(a,"id")&&(c=!0,this._userStore.getValue(this._editingCreateUser,"username")!==h.username?(this._userStore.deleteItem(a),this._userStore.newItem(h)):(this._userStore.setValue(a,"email",h.email),this._userStore.setValue(a,"fullname",h.fullname),this._userStore.setValue(a,"firstname",h.firstname),this._userStore.setValue(a,"lastname",h.lastname),this._addMode&&this._userStore.setValue(a,"password",h.password),this._userStore.setValue(a,"role",h.role),this._userStore.setValue(a,
"rolename",h.rolename)))}));this._userStore.save({onComplete:b.hitch(this,function(){this._editingCreate=!1;this._editingCreateUser=null;var a=esri.substitute({email:h.email},this.i18n.step2Invite.success.userAdded);this.setCreateSuccessMessage(a);this.goToStep3();this.initializeInviteGroupUserGrid()}),onError:b.hitch(this,function(a){this.setCreateErrorMessage(a)})})})}):(h.id=(new Date).getTime(),this._userStore.newItem(h),this._userStore.save({onComplete:b.hitch(this,function(){var a=esri.substitute({username:h.username},
this.i18n.step2Create.success.userAdded);this.setCreateSuccessMessage(a);this.resetCreateSingleForm(!0);this.goToStep3();this.initializeInviteGroupUserGrid()}),onError:b.hitch(this,function(a){this.setCreateErrorMessage(a)})}))})):arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorTitle,message:esri.substitute({name:this._util.stripHTML(e)},this.i18n.step2Create.invalid.groupNameDoesntExist)})}),b.hitch(this,function(a){b.style(b.byId("reviewSpinner"),
"display","none");this._createGroupReviewBtn.setDisabled(!1);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorTitle,message:esri.substitute({name:this._util.stripHTML(e)},this.i18n.step2Create.invalid.groupNameDoesntExist)})})))},onCreateAnotherClicked:function(){this.resetCreateErrorMessage();this.initializeUserStore();var a=this._util.stripHTML(this._createSingleEmail.get("value")),e=this._util.stripHTML(this._createSingleFirstName.get("value")),
c=this._util.stripHTML(this._createSingleLastName.get("value")),d=this._util.stripHTML(this._createSingleUsername.get("value")),f=this._util.stripHTML(this._createSingleRole.get("value"));this._currentSelectedCreateRole=this.accountUserRole;this._currentSelectedCreateRole=this._isPortal&&f===this.i18n.userRoles.admin?this.accountAdminRole:f===this.i18n.userRoles.publisher?this.accountPublisherRole:this._isPortal&&f===this.i18n.userRoles.user?this.accountUserRole:this.getCustomRoleId(f)||this.getDefaultUserRole();
var g={username:d,fullname:"ja"===b.locale?c+" "+e:e+" "+c,firstname:e,lastname:c,email:b.trim(a),role:this._currentSelectedCreateRole,rolename:f};this._addMode&&(this._createSinglePassword&&"saml"!==this._userType)&&(g.password=this._createSinglePassword.get("value"));this._editingCreate&&this._editingCreateUser&&(g.id=this._editingCreateUser.id[0]);this._isPortal&&"saml"===this._userType&&(g.provider=this.enterpriseProvider);a=function(a){a&&(a.usernames&&a.usernames[0]&&a.usernames[0].suggested)&&
(d=a.usernames[0].suggested);this.isValidCreateUser(g)&&(g.username=this._isPortal?this.cleanUsernamePortal(d):this.cleanUsername(d),this._currentCreateMessage=this._createSingleMessage.get("value"),this._editingCreate?this._userStore.fetch({onComplete:b.hitch(this,function(a){b.forEach(a,b.hitch(this,function(a){this._userStore.getValue(this._editingCreateUser,"id")===this._userStore.getValue(a,"id")&&(this._userStore.getValue(this._editingCreateUser,"username")!==g.username?(this._userStore.deleteItem(a),
this._userStore.newItem(g)):(this._userStore.setValue(a,"email",g.email),this._userStore.setValue(a,"fullname",g.fullname),this._userStore.setValue(a,"firstname",g.firstname),this._userStore.setValue(a,"lastname",g.lastname),this._addMode&&this._userStore.setValue(a,"password",g.password),this._userStore.setValue(a,"role",g.role),this._userStore.setValue(a,"rolename",g.rolename)))}));this._userStore.save({onComplete:b.hitch(this,function(){this._editingCreate=!1;this._editingCreateUser=null;var a=
esri.substitute({email:g.email},this.i18n.step2Create.success.userAdded);this.setCreateSuccessMessage(a);this.resetCreateSingleForm()}),onError:b.hitch(this,function(a){this.setCreateErrorMessage(a)})})})}):(g.username=this._isPortal?this.cleanUsernamePortal(d):this.cleanUsername(d),g.id=(new Date).getTime(),this._userStore.newItem(g),this._userStore.save({onComplete:b.hitch(this,function(){var a=esri.substitute({username:g.username},this.i18n.step2Create.success.userAdded);this.setCreateSuccessMessage(a);
this.resetCreateSingleForm()}),onError:b.hitch(this,function(a){this.setCreateErrorMessage(a)})})))};this.notSet(d)?this.setCreateErrorMessage(this.i18n.step2Create.invalid.usernameIsBlank):(this._isPortal?this.usernameContainsAlphaNumericPortal(g.username):this.usernameContainsAlphaNumeric(g.username))?(g.username=this._isPortal?this.cleanUsernamePortal(d):this.cleanUsername(d),this._account.checkUsernames([d],b.hitch(this,a),b.hitch(this,a))):this.setCreateErrorMessage(this.i18n.step2Create.invalid.usernameInvalidChars)},
onCreateReviewClicked:function(a){this.resetCreateErrorMessage();this.initializeUserStore();a=this._util.stripHTML(this._createSingleEmail.get("value"));var e=this._util.stripHTML(this._createSingleFirstName.get("value")),c=this._util.stripHTML(this._createSingleLastName.get("value")),d=this._util.stripHTML(this._createSingleUsername.get("value")),f=this._util.stripHTML(this._createSingleRole.get("value"));this._currentSelectedCreateRole=this.accountUserRole;this._currentSelectedCreateRole=this._isPortal&&
f===this.i18n.userRoles.admin?this.accountAdminRole:f===this.i18n.userRoles.publisher?this.accountPublisherRole:this._isPortal&&f===this.i18n.userRoles.user?this.accountUserRole:this.getCustomRoleId(f)||this.getDefaultUserRole();var g={username:d,fullname:"ja"===b.locale?c+" "+e:e+" "+c,firstname:e,lastname:c,email:b.trim(a),role:this._currentSelectedCreateRole,rolename:f};this._isPortal&&"saml"===this._userType&&(g.provider=this.enterpriseProvider);this._addMode&&(this._createSinglePassword&&"saml"!==
this._userType)&&(g.password=b.trim(this._createSinglePassword.get("value")));this._editingCreate&&this._editingCreateUser&&(g.id=this._editingCreateUser.id[0]);a=function(a){a&&(a.usernames&&a.usernames[0]&&a.usernames[0].suggested)&&(d=a.usernames[0].suggested);this.isValidCreateUser(g)&&(g.username=this.cleanUsername(d),this._currentCreateMessage=this._createSingleMessage.get("value"),this._editingCreate?this._userStore.fetch({onComplete:b.hitch(this,function(a){var c=!1;b.forEach(a,b.hitch(this,
function(a){!c&&this._userStore.getValue(this._editingCreateUser,"id")===this._userStore.getValue(a,"id")&&(c=!0,this._userStore.getValue(this._editingCreateUser,"username")!==g.username?(this._userStore.deleteItem(a),this._userStore.newItem(g)):(this._userStore.setValue(a,"email",g.email),this._userStore.setValue(a,"fullname",g.fullname),this._userStore.setValue(a,"firstname",g.firstname),this._userStore.setValue(a,"lastname",g.lastname),this._addMode&&(this._createSinglePassword&&"saml"!==this._userType)&&
this._userStore.setValue(a,"password",g.password),this._userStore.setValue(a,"role",g.role),this._userStore.setValue(a,"rolename",g.rolename)))}));this._userStore.save({onComplete:b.hitch(this,function(){this._editingCreate=!1;this._editingCreateUser=null;var a=esri.substitute({email:g.email},this.i18n.step2Invite.success.userAdded);this.setCreateSuccessMessage(a);this.resetCreateSingleForm(!0);this.goToStep3();this.initializeCreateUserGrid()}),onError:b.hitch(this,function(a){this.setCreateErrorMessage(a)})})})}):
(g.username=this._isPortal?this.cleanUsernamePortal(d):this.cleanUsername(d),g.id=(new Date).getTime(),this._userStore.newItem(g),this._userStore.save({onComplete:b.hitch(this,function(){var a=esri.substitute({username:g.username},this.i18n.step2Create.success.userAdded);this.setCreateSuccessMessage(a);this.resetCreateSingleForm(!0);this.goToStep3();this.initializeCreateUserGrid()}),onError:b.hitch(this,function(a){this.setCreateErrorMessage(a)})})))};this.notSet(g.firstname)&&this.notSet(g.lastname)&&
this.notSet(g.email)&&this.notSet(g.username)&&(!this._addMode||this._addMode&&this.notSet(g.password))&&this._userStore&&this._userStore._arrayOfAllItems&&0<this._userStore._arrayOfAllItems.length?(this.resetCreateSingleForm(!0),this.goToStep3(),this.initializeCreateUserGrid()):this.notSet(d)?this.setCreateErrorMessage(this.i18n.step2Create.invalid.usernameIsBlank):(this._isPortal?this.usernameContainsAlphaNumericPortal(g.username):this.usernameContainsAlphaNumeric(g.username))?(g.username=this._isPortal?
this.cleanUsernamePortal(d):this.cleanUsername(d),this._account.checkUsernames([d],b.hitch(this,a),b.hitch(this,a))):this.setCreateErrorMessage(this.i18n.step2Create.invalid.usernameInvalidChars)},onCreateSingleRoleChanged:function(a){this._isPortal&&this.i18n.userRoles.admin===a?(this._currentSelectedCreateRole=this.accountAdminRole,this._createSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.adminRoleTooltip))):this.i18n.userRoles.publisher===a?(this._currentSelectedCreateRole=
this.accountPublisherRole,this._createSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.publisherRoleTooltip))):this.i18n.userRoles.user===a?(this._currentSelectedCreateRole=this.accountUserRole,this._createSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip))):(a=this.getCustomRoleId(a))?(this._currentSelectedCreateRole=a,this._createSingleRole.set("title",this.getCustomRoleDesc(a))):this._isPortal?(this._currentSelectedCreateRole=
this._portalDefaultUser,this._createSingleRole.set("title",this.getRoleDesc(this._portalDefaultUser))):(this._currentSelectedCreateRole=this.accountUserRole,this._createSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip)))},onInviteSingleRoleChanged:function(a){this._isPortal&&this.i18n.userRoles.admin===a?(this._currentSelectedInviteRole=this.accountAdminRole,this._inviteSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.adminRoleTooltip))):
this.i18n.userRoles.publisher===a?(this._currentSelectedInviteRole=this.accountPublisherRole,this._inviteSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.publisherRoleTooltip))):this.i18n.userRoles.user===a?(this._currentSelectedInviteRole=this.accountUserRole,this._inviteSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip))):(a=this.getCustomRoleId(a))?(this._currentSelectedInviteRole=a,this._inviteSingleRole.set("title",
this.getCustomRoleDesc(a))):this._isPortal?(this._currentSelectedInviteRole=this._portalDefaultUser,this._inviteSingleRole.set("title",this.getRoleDesc(this._portalDefaultUser))):(this._currentSelectedInviteRole=this.accountUserRole,this._inviteSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip)))},onIDPSingleRoleChanged:function(a){this._isPortal&&this.i18n.userRoles.admin===a?(this._currentSelectedIDPRole=this.accountAdminRole,this._idpSingleRole.set("title",
esri.substitute({type:this._getTenantTypeString()},this.i18n.adminRoleTooltip))):this.i18n.userRoles.publisher===a?(this._currentSelectedIDPRole=this.accountPublisherRole,this._idpSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.publisherRoleTooltip))):this.i18n.userRoles.user===a?(this._currentSelectedIDPRole=this.accountUserRole,this._idpSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip))):(a=this.getCustomRoleId(a))?
(this._currentSelectedIDPRole=a,this._idpSingleRole.set("title",this.getCustomRoleDesc(a))):this._isPortal?(this._currentSelectedIDPRole=this._portalDefaultUser,this._idpSingleRole.set("title",this.getRoleDesc(this._portalDefaultUser))):(this._currentSelectedIDPRole=this.accountUserRole,this._idpSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip)))},onFixSingleRoleChanged:function(a){this._isPortal&&this.i18n.userRoles.admin===a?this._fixRole.set("title",
esri.substitute({type:this._getTenantTypeString()},this.i18n.adminRoleTooltip)):this.i18n.userRoles.publisher===a?this._fixRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.publisherRoleTooltip)):this.i18n.userRoles.user===a?this._fixRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip)):(a=this.getCustomRoleId(a))?this._fixRole.set("title",this.getCustomRoleDesc(a)):this._isPortal?this._fixRole.set("title",this.getRoleDesc(this._portalDefaultUser)):
this._fixRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip))},onCreateEnterpriseGroupKeyDown:function(a){a&&a.keyCode==b.keys.ENTER&&(a.preventDefault(),a.stopPropagation(),this.onSelectEnterpriseGroup())},onCreateEnterpriseUserKeyDown:function(a){a&&a.keyCode==b.keys.ENTER&&(a.preventDefault(),a.stopPropagation(),this.onSelectEnterpriseUser())},onSelectEnterpriseGroup:function(){var a=this._createEnterpriseGroup.get("value");arcgisonline.sharing.dijit.dialog.SelectEnterpriseGroupDlg.prototype.statics.getInstance().show(a)},
onSelectEnterpriseUser:function(){var a=this._createEnterpriseUser.get("value");arcgisonline.sharing.dijit.dialog.SelectEnterpriseUserDlg.prototype.statics.getInstance().show(a)},getDefaultUserRole:function(){return this._isPortal?this._portalDefaultUser:this.accountUserRole},resetUserStore:function(){this._userStore=null;this._userGrid&&this._userGrid.set("store",this._userStore)},resetFixErrorsForm:function(a){this._settingFixUsername=this._settingFixEmail=!0;this._addMode&&(this._settingFixPassword=
!0);this._numToFix=this._totalUsers=0;this._currentlyFixing=null;this._fixingNumber=0;a&&this.resetFixErrorMessage();this._fixEmail.setValue("");this._fixFirstName.setValue("");this._fixLastName.setValue("");this._fixUsername.setValue("");this._addMode&&(this._fixPassword&&"saml"!==this._userType)&&this._fixPassword.setValue("");this._isPortal?(this._fixRole.set("value",this._lookupFullRoleName(this._portalDefaultUser)),this._fixRole.set("title",this.getRoleDesc(this._portalDefaultUser))):(this._fixRole.set("value",
this.i18n.userRoles.user),this._fixRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip)))},resetCreateUserForm:function(){this._createEnterpriseUser.setValue("");this._isPortal?(this._createUserRole.set("value",this._lookupFullRoleName(this._portalDefaultUser)),this._createUserRole.set("title",this.getRoleDesc(this._portalDefaultUser))):(this._createUserRole.set("value",this.i18n.userRoles.user),this._createUserRole.set("title",esri.substitute({type:this._getTenantTypeString()},
this.i18n.userRoleTooltip)))},resetCreateSingleForm:function(a){this._settingCreateSingleUser=this._settingCreateSingleEmail=!0;this._addMode&&(this._settingCreateSinglePassword=!0);this._editingCreate?this._addMode?(b.attr(this._createSingleInviteBtn,"label",this.i18n.step2Create.saveAddAnother),b.attr(this._createSingleReviewBtn,"label",this.i18n.step2Create.saveReviewAdd)):(b.attr(this._createSingleInviteBtn,"label",this.i18n.step2Create.saveInviteAnother),b.attr(this._createSingleReviewBtn,"label",
this.i18n.step2Create.saveReviewInvitation)):this._addMode?(b.attr(this._createSingleInviteBtn,"label",this.i18n.step2Create.addAnother),b.attr(this._createSingleReviewBtn,"label",this.i18n.step2Create.reviewAdd)):(b.attr(this._createSingleInviteBtn,"label",this.i18n.step2Create.inviteAnother),b.attr(this._createSingleReviewBtn,"label",this.i18n.step2Create.reviewInvitation));this._createSingleEmail.setValue("");this._createSingleFirstName.setValue("");this._createSingleLastName.setValue("");this._createSingleUsername.setValue("");
this._addMode&&(this._createSinglePassword&&"saml"!==this._userType)&&this._createSinglePassword.setValue("");this._isPortal?(this._createSingleRole.set("value",this._lookupFullRoleName(this._portalDefaultUser)),this._createSingleRole.set("title",this.getRoleDesc(this._portalDefaultUser))):(this._createSingleRole.set("value",this.i18n.userRoles.user),this._createSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip)));a&&this.resetCreateErrorMessage();
this._createBatchFile.setValue("");this._createBatchUploadBtn.set("disabled",!1);this._createTabs.selectChild(this._createSingleTab);this._createSingleEmail.focus()},resetInviteSingleForm:function(a){this._editingInvite?(b.attr(this._inviteSingleInviteBtn,"label",this.i18n.step2Invite.saveInviteAnother),b.attr(this._inviteSingleReviewBtn,"label",this.i18n.step2Invite.saveReviewInvitation)):(b.attr(this._inviteSingleInviteBtn,"label",this.i18n.step2Invite.inviteAnother),b.attr(this._inviteSingleReviewBtn,
"label",this.i18n.step2Invite.reviewInvitation));this._inviteSingleEmail.setValue("");this._isPortal?(this._inviteSingleRole.set("value",this._lookupFullRoleName(this._portalDefaultUser)),this._inviteSingleRole.set("title",this.getRoleDesc(this._portalDefaultUser))):(this._inviteSingleRole.set("value",this.i18n.userRoles.user),this._inviteSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip)));a&&this.resetInviteErrorMessage();this._inviteBatchFile.setValue("");
this._inviteBatchUploadBtn.set("disabled",!1);this._inviteTabs.selectChild(this._inviteSingleTab);this._inviteSingleEmail.focus()},resetIDPSingleForm:function(a){this._editingIDP?(b.attr(this._idpSingleInviteBtn,"label",this.i18n.step2IDP.saveInviteAnother),b.attr(this._idpSingleReviewBtn,"label",this.i18n.step2IDP.saveReviewInvitation)):(b.attr(this._idpSingleInviteBtn,"label",this.i18n.step2IDP.inviteAnother),b.attr(this._idpSingleReviewBtn,"label",this.i18n.step2IDP.reviewInvitation));this._idpSingleEmail.setValue("");
this._isPortal?(this._idpSingleRole.set("value",this._lookupFullRoleName(this._portalDefaultUser)),this._idpSingleRole.set("title",this.getRoleDesc(this._portalDefaultUser))):(this._idpSingleRole.set("value",this.i18n.userRoles.user),this._idpSingleRole.set("title",esri.substitute({type:this._getTenantTypeString()},this.i18n.userRoleTooltip)));a&&this.resetIDPErrorMessage();this._idpBatchFile.setValue("");this._idpBatchUploadBtn.set("disabled",!1);this._idpTabs.selectChild(this._idpSingleTab);this._idpSingleEmail.focus()},
onIDPAnotherClicked:function(){this.resetIDPErrorMessage();this.initializeUserStore();if(this._editingIDP){var a=this._idpSingleEmail.get("value"),e={email:b.trim(a),role:this._currentSelectedIDPRole,rolename:this._lookupRoleName(this._currentSelectedIDPRole)};this.isValidIDPUser(e)&&(this._currentIDPMessage=this._idpSingleMessage.get("value"),this._userStore.fetch({onComplete:b.hitch(this,function(a){var c=!1;b.forEach(a,b.hitch(this,function(a){!c&&this._userStore.getValue(this._editingIDPUser,
"email")===this._userStore.getValue(a,"email")&&(c=!0,this._userStore.getValue(this._editingIDPUser,"email")!==e.email?(this._userStore.deleteItem(a),this._userStore.newItem(e)):(this._userStore.setValue(a,"role",e.role),this._userStore.setValue(a,"rolename",e.rolename)))}));this._userStore.save({onComplete:b.hitch(this,function(){this._editingIDP=!1;this._editingIDPUser=null;var a=esri.substitute({email:e.email},this.i18n.step2IDP.success.userAdded);this.setIDPSuccessMessage(a);this.resetIDPSingleForm()}),
onError:b.hitch(this,function(a){this.setIDPErrorMessage(a)})})})}))}else{var c=this._idpSingleEmail.get("value");c&&(c=c.split(","));var d=[];if(c&&0<c.length)for(a=0;a<c.length;a++)d.push({email:b.trim(c[a]),role:this._currentSelectedIDPRole,rolename:this._lookupRoleName(this._currentSelectedIDPRole)});else d.push({email:"",role:this._currentSelectedIDPRole,rolename:this._lookupRoleName(this._currentSelectedIDPRole)});if(this.validIDPUsers(d)){this._currentIDPMessage=this._idpSingleMessage.get("value");
for(a=0;a<d.length;a++)this._userStore.newItem(d[a]);this._userStore.save({onComplete:b.hitch(this,function(){var a;1<c.length?(a=c.join(", "),a=esri.substitute({emailList:a},this.i18n.step2IDP.success.usersAdded)):1===c.length&&(a=esri.substitute({email:c[0]},this.i18n.step2IDP.success.userAdded));this.setIDPSuccessMessage(a);this.resetIDPSingleForm()}),onError:b.hitch(this,function(a){this.setIDPErrorMessage(a)})})}}},onIDPReviewClicked:function(){this.resetIDPErrorMessage();this.initializeUserStore();
if(this._editingIDP){var a=b.trim(this._idpSingleEmail.get("value")),e={email:this._util.stripHTML(a),role:this._currentSelectedIDPRole,rolename:this._lookupRoleName(this._currentSelectedIDPRole)};this.isValidIDPUser(e)&&(this._currentIDPMessage=this._idpSingleMessage.get("value"),this._userStore.fetch({onComplete:b.hitch(this,function(a){b.forEach(a,b.hitch(this,function(a){this._userStore.getValue(this._editingIDPUser,"email")===this._userStore.getValue(a,"email")&&(this._userStore.getValue(this._editingIDPUser,
"email")!==e.email?(this._userStore.deleteItem(a),this._userStore.newItem(e)):(this._userStore.setValue(a,"role",e.role),this._userStore.setValue(a,"rolename",e.rolename)))}));this._userStore.save({onComplete:b.hitch(this,function(){this._editingIDP=!1;this._editingIDPUser=null;this.resetIDPSingleForm(!0);this.goToStep3();this.initializeIDPUserGrid()}),onError:b.hitch(this,function(a){this.setIDPErrorMessage(a)})})})}))}else{var c=this._idpSingleEmail.get("value");c&&(c=c.split(","));var d=[];if(c&&
0<c.length)for(a=0;a<c.length;a++)d.push({email:this._util.stripHTML(b.trim(c[a])),role:this._currentSelectedIDPRole,rolename:this._lookupRoleName(this._currentSelectedIDPRole)});else d.push({email:"",role:this._currentSelectedIDPRole,rolename:this._lookupRoleName(this._currentSelectedIDPRole)});if(this.validIDPUsers(d)){this._currentIDPMessage=this._idpSingleMessage.get("value");for(a=0;a<d.length;a++)this._userStore.newItem(d[a]);this._userStore.save({onComplete:b.hitch(this,function(){var a;1<
c.length?(a=c.join(", "),a=esri.substitute({emailList:a},this.i18n.step2IDP.success.usersAdded)):1===c.length&&(a=esri.substitute({email:c[0]},this.i18n.step2IDP.success.userAdded));this.setIDPSuccessMessage(a);this.resetIDPSingleForm(!0);this.goToStep3();this.initializeIDPUserGrid()}),onError:b.hitch(this,function(a){this.setIDPErrorMessage(a)})})}else this._userStore.fetch({onComplete:b.hitch(this,function(a){a&&0<a.length&&(this.resetIDPSingleForm(!0),this.goToStep3(),this.initializeIDPUserGrid())})})}},
onInviteAnotherClicked:function(){this.resetInviteErrorMessage();this.initializeUserStore();if(this._editingInvite){var a=b.trim(this._inviteSingleEmail.get("value")),e={email:this._util.stripHTML(a),role:this._currentSelectedInviteRole,rolename:this._lookupRoleName(this._currentSelectedInviteRole)};this.isValidInviteUser(e)&&(this._currentInviteMessage=this._inviteSingleMessage.get("value"),this._userStore.fetch({onComplete:b.hitch(this,function(a){b.forEach(a,b.hitch(this,function(a){this._userStore.getValue(this._editingInviteUser,
"email")===this._userStore.getValue(a,"email")&&(this._userStore.getValue(this._editingInviteUser,"email")!==e.email?(this._userStore.deleteItem(a),this._userStore.newItem(e)):(this._userStore.setValue(a,"role",e.role),this._userStore.setValue(a,"rolename",e.rolename)))}));this._userStore.save({onComplete:b.hitch(this,function(){this._editingInvite=!1;this._editingInviteUser=null;var a=esri.substitute({email:e.email},this.i18n.step2Invite.success.userAdded);this.setInviteSuccessMessage(a);this.resetInviteSingleForm()}),
onError:b.hitch(this,function(a){this.setInviteErrorMessage(a)})})})}))}else{var c=this._inviteSingleEmail.get("value");c&&(c=c.split(","));var d=[];if(c&&0<c.length)for(a=0;a<c.length;a++)d.push({email:this._util.stripHTML(b.trim(c[a])),role:this._currentSelectedInviteRole,rolename:this._lookupRoleName(this._currentSelectedInviteRole)});else d.push({email:"",role:this._currentSelectedInviteRole,rolename:this._lookupRoleName(this._currentSelectedInviteRole)});if(this.validInviteUsers(d)){this._currentInviteMessage=
this._inviteSingleMessage.get("value");for(a=0;a<d.length;a++)this._userStore.newItem(d[a]);this._userStore.save({onComplete:b.hitch(this,function(){var a;1<c.length?(a=c.join(", "),a=esri.substitute({emailList:a},this.i18n.step2Invite.success.usersAdded)):1===c.length&&(a=esri.substitute({email:c[0]},this.i18n.step2Invite.success.userAdded));this.setInviteSuccessMessage(a);this.resetInviteSingleForm()}),onError:b.hitch(this,function(a){this.setInviteErrorMessage(a)})})}}},onInviteReviewClicked:function(){this.resetInviteErrorMessage();
this.initializeUserStore();if(this._editingInvite){var a=b.trim(this._inviteSingleEmail.get("value")),e={email:this._util.stripHTML(a),role:this._currentSelectedInviteRole,rolename:this._lookupRoleName(this._currentSelectedInviteRole)};this.isValidInviteUser(e)&&(this._currentInviteMessage=this._inviteSingleMessage.get("value"),this._userStore.fetch({onComplete:b.hitch(this,function(a){var c=!1;b.forEach(a,b.hitch(this,function(a){!c&&this._userStore.getValue(this._editingInviteUser,"email")===this._userStore.getValue(a,
"email")&&(c=!0,this._userStore.getValue(this._editingInviteUser,"email")!==e.email?(this._userStore.deleteItem(a),this._userStore.newItem(e)):(this._userStore.setValue(a,"role",e.role),this._userStore.setValue(a,"rolename",e.rolename)))}));this._userStore.save({onComplete:b.hitch(this,function(){this._editingInvite=!1;this._editingInviteUser=null;this.resetInviteSingleForm(!0);this.goToStep3();this.initializeInviteUserGrid()}),onError:b.hitch(this,function(a){this.setInviteErrorMessage(a)})})})}))}else{var c=
this._inviteSingleEmail.get("value");c&&(c=c.split(","));var d=[];if(c&&0<c.length)for(a=0;a<c.length;a++)d.push({email:this._util.stripHTML(b.trim(c[a])),role:this._currentSelectedInviteRole,rolename:this._lookupRoleName(this._currentSelectedInviteRole)});else d.push({email:"",role:this._currentSelectedInviteRole,rolename:this._lookupRoleName(this._currentSelectedInviteRole)});if(this.validInviteUsers(d)){this._currentInviteMessage=this._inviteSingleMessage.get("value");for(a=0;a<d.length;a++)this._userStore.newItem(d[a]);
this._userStore.save({onComplete:b.hitch(this,function(){var a;1<c.length?(a=c.join(", "),a=esri.substitute({emailList:a},this.i18n.step2Invite.success.usersAdded)):1===c.length&&(a=esri.substitute({email:c[0]},this.i18n.step2Invite.success.userAdded));this.setInviteSuccessMessage(a);this.resetInviteSingleForm(!0);this.goToStep3();this.initializeInviteUserGrid()}),onError:b.hitch(this,function(a){this.setInviteErrorMessage(a)})})}else this._userStore.fetch({onComplete:b.hitch(this,function(a){a&&
0<a.length&&(this.resetInviteSingleForm(!0),this.goToStep3(),this.initializeInviteUserGrid())})})}},onCreateBatchSubmit:function(a){a.preventDefault();a.target.data?this.handleCreateFileSelection(a.target.data.files):this.handleCreateFileSelection(a.target.file.files)},onInviteBatchSubmit:function(a){a.preventDefault();a.target.data?this.handleInviteFileSelection(a.target.data.files):this.handleInviteFileSelection(a.target.file.files)},onIDPBatchSubmit:function(a){a.preventDefault();a.target.data?
this.handleIDPFileSelection(a.target.data.files):this.handleIDPFileSelection(a.target.file.files)},onNext:function(){this._addMode=this._addUsersBtn.get("checked");if(this.hasIDP()&&this._idpUsersBtn.get("checked"))this.onIDPUsers();else if((this._addMode||this._createUsersBtn.get("checked"))&&!this._isPortal)this.onCreateUsers();else if((this._addMode||this._createUsersBtn.get("checked"))&&this._isPortal)this.buildChooseType();else this.onInviteUsers()},onIDPUsers:function(){this._mode=this.modeIDP;
this.hide();b.style(this._step2IDP,"display","block");b.attr(this._step3Message,"innerHTML",this.i18n.step3.message);this._idpTabs||this.buildIDPTabs()},onCreateUsers:function(){this._mode=this.modeCreate;this.hide();b.style(this._step2Create,"display","block");if(this._createTabs){if(this._createUploadMsg){var a=esri.substitute({firstNameHeader:this.i18n.csv.firstName,lastNameHeader:this.i18n.csv.lastName,emailHeader:this.i18n.csv.email,roleHeader:this.i18n.csv.role,usernameHeader:this.i18n.csv.username,
passwordHeader:this.i18n.csv.password},this._addMode?this.i18n.step2Create.uploadCSVAdd:this.i18n.step2Create.uploadCSV);b.attr(this._createUploadMsg,"innerHTML",a)}}else this._isPortal?this._checkEnterpriseGroupStore().then(b.hitch(this,function(){this.buildCreateTabs()})):this.buildCreateTabs();this._addMode?(b.attr(this._step3Message,"innerHTML",this._isPortal?this.i18n.step3.messageAddPortal:this.i18n.step3.messageAdd),this._createBatchMsgRow&&b.style(this._createBatchMsgRow,"display","none"),
this._createSingleMsgRow&&b.style(this._createSingleMsgRow,"display","none"),this._createSinglePasswordRow&&b.style(this._createSinglePasswordRow,"display",""),this._createSinglePasswordSpacer&&b.style(this._createSinglePasswordSpacer,"display",""),this._createSingleInviteBtn&&this._createSingleInviteBtn.set("label",this.i18n.step2Create.addAnother),this._createSingleReviewBtn&&this._createSingleReviewBtn.set("label",this.i18n.step2Create.reviewAdd)):(b.attr(this._step3Message,"innerHTML",this.i18n.step3.message),
this._createBatchMsgRow&&b.style(this._createBatchMsgRow,"display",""),this._createSingleMsgRow&&b.style(this._createSingleMsgRow,"display",""),this._createSinglePasswordRow&&b.style(this._createSinglePasswordRow,"display","none"),this._createSinglePasswordSpacer&&b.style(this._createSinglePasswordSpacer,"display","none"),this._createSingleInviteBtn&&this._createSingleInviteBtn.set("label",this.i18n.step2Create.inviteAnother),this._createSingleReviewBtn&&this._createSingleReviewBtn.set("label",this.i18n.step2Create.reviewInvitation))},
onInviteUsers:function(){this._mode=this.modeInvite;this.hide();b.style(this._step2Invite,"display","block");b.attr(this._step3Message,"innerHTML",this.i18n.step3.message);this._inviteTabs||this.buildInviteTabs()},onBackToStart:function(){this.hide();b.style(this._step1,"display","block");this._mode===this.modeCreate?this.setCreateErrorMessage(""):this._mode===this.modeInvite?this.resetInviteErrorMessage():this._mode===this.modeIDP&&this.resetIDPErrorMessage();this._resetTrackedModeInfo();this.resetUserStore()},
onBackToStartPortal:function(){this.hide();b.style(this._step1Create,"display","block");this._mode===this.modeCreate?this.setCreateErrorMessage(""):this._mode===this.modeInvite?this.resetInviteErrorMessage():this._mode===this.modeIDP&&this.resetIDPErrorMessage();this._userType="";this._fixErrorsContentPane=this._createTabs=null;b.empty(this._step2Create);var a;this._step2Create.innerHTML='\x3cdiv class\x3d"stepHeader"\x3e\x3cdiv class\x3d"esriFloatLeading stepSprite step2"\x3e\x26nbsp;\x3c/div\x3e\x26nbsp;\x26nbsp;\x3cdiv class\x3d"stepMessageContainer"\x3e\x3cdiv class\x3d"stepMessage"\x3e\x3cstrong\x3e\x3clabel data-dojo-attach-point\x3d"_step2CreateMsgLabel"\x3e\x3c/label\x3e\x3c/strong\x3e\x3c/div\x3e\x3clabel data-dojo-attach-point\x3d"_step2CreateSubMsgLabel"\x3e${i18n.selectNonAdmin}\x3c/label\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d"display:none;" data-dojo-attach-point\x3d"_createErrorContainer"\x3e\x3c/div\x3e\x3cdiv data-dojo-attach-point\x3d"_createTabContainer"\x3e\x3c/div\x3e';
this._step2CreateMsgLabel=b.query("[data-dojo-attach-point\x3d_step2CreateMsgLabel]",this._step2Create)[0];this._step2CreateSubMsgLabel=b.query("[data-dojo-attach-point\x3d_step2CreateSubMsgLabel]",this._step2Create)[0];this._createErrorContainer=b.query("[data-dojo-attach-point\x3d_createErrorContainer]",this._step2Create)[0];this._createTabContainer=b.query("[data-dojo-attach-point\x3d_createTabContainer]",this._step2Create)[0];b.empty(this._fixErrors);a='\x3cdiv class\x3d"stepHeader"\x3e\x3cdiv class\x3d"esriFloatLeading stepSprite step2"\x3e\x26nbsp;\x3c/div\x3e\x26nbsp;\x26nbsp;\x3cdiv class\x3d"stepMessageContainer"\x3e\x3cdiv class\x3d"stepMessage"\x3e\x3cstrong\x3e\x3clabel data-dojo-attach-point\x3d"_fixErrorsMsgLabel"\x3e\x3c/label\x3e\x3c/strong\x3e\x3c/div\x3e\x3clabel\x3e'+
this.i18n.selectNonAdmin+'\x3c/label\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d"display:none;" data-dojo-attach-point\x3d"_fixErrorsErrorContainer"\x3e\x3c/div\x3e\x3cdiv data-dojo-attach-point\x3d"_fixErrorsContainer"\x3e\x3c/div\x3e';this._fixErrors.innerHTML=a;this._fixErrorsMsgLabel=b.query("[data-dojo-attach-point\x3d_fixErrorsMsgLabel]",this._fixErrors)[0];this._fixErrorsErrorContainer=b.query("[data-dojo-attach-point\x3d_fixErrorsErrorContainer]",this._fixErrors)[0];this._fixErrorsContainer=
b.query("[data-dojo-attach-point\x3d_fixErrorsContainer]",this._fixErrors)[0];this.resetUserStore()},_resetTrackedModeInfo:function(){this._mode=null;this._addMode=!1;this._currentIDPMessage=this._currentSelectedIDPRole=null;this._editingIDP=!1;this._currentCreateMessage=this._currentSelectedCreateRole=this._editingIDPUser=null;this._editingCreate=!1;this._editingCreateUser=null;this._settingCreateSingleUser=this._settingCreateSingleEmail=!1;this._fixingNumber=this._numToFix=0;this._currentInviteMessage=
this._currentSelectedInviteRole=this._settingFixUsername=this._settingFixEmail=this._currentlyFixing=null;this._editingInvite=!1;this._editingInviteUser=null},onBackInvitations:function(){b.style(this._groupSelection.domNode,"display","none");this.hide();this._mode===this.modeInvite?(this.resetInviteSingleForm(!0),b.style(this._step2Invite,"display","block")):this._mode===this.modeIDP?(this.resetIDPSingleForm(!0),b.style(this._step2IDP,"display","block")):this._mode===this.modeCreate&&(this.resetCreateSingleForm(!0),
b.style(this._step2Create,"display","block"))},onSendInvitations:function(){this._groupSelector&&this._mode===this.modeCreate&&(this._selectedGroups=this._groupSelector.get("value"));this._sendInvitations.set("disabled",!0);this._sendGroupInvitations.set("disabled",!0);this._sendInvitations.set("label",this._addMode?this.i18n.step3.addingMembers:this.i18n.step3.sendingInvitations);this._sendGroupInvitations.set("label",this._addMode?this.i18n.step3.addingMembers:this.i18n.step3.sendingInvitations);
var a=[],e,c;this._mode===this.modeInvite?(e=this.buildInvitationEmailSubject(),c=this.buildInvitationEmailMessage(this._currentInviteMessage)):this._mode===this.modeIDP?(e=this.buildIDPEmailSubject(),c=this.buildIDPEmailMessage(this._currentIDPMessage)):this._mode===this.modeCreate&&(e=this.buildInvitationEmailSubject(),c=this.buildCreateEmailMessage(this._currentCreateMessage));this._userStore.fetch({onComplete:b.hitch(this,function(d,f){var g=d.length;b.forEach(d,b.hitch(this,function(b){if(b)if(this._mode===
this.modeInvite||this._mode===this.modeIDP)a.push({email:this._userStore.getValue(b,"email"),role:this._userStore.getValue(b,"role")});else if(this._mode===this.modeCreate&&!this._addMode)a.push({username:this._userStore.getValue(b,"username"),firstname:this._userStore.getValue(b,"firstname"),lastname:this._userStore.getValue(b,"lastname"),fullname:this._userStore.getValue(b,"fullname"),email:this._userStore.getValue(b,"email"),role:this._userStore.getValue(b,"role")});else if(this._mode===this.modeCreate&&
this._addMode){var c=this._userStore.getValue(b,"username"),d=this._userStore.getValue(b,"role"),e=this._userStore.getValue(b,"provider");b={username:c,password:this._userStore.getValue(b,"password"),firstname:this._userStore.getValue(b,"firstname"),lastname:this._userStore.getValue(b,"lastname"),fullname:this._userStore.getValue(b,"fullname"),email:this._userStore.getValue(b,"email"),role:d};this._isPortal&&(b.provider=e||this.arcgisProvider);a.push(b)}}));if(this._mode===this.modeCreate&&this._addMode&&
this._isPortal)this._createBatchPortalUsers(a);else{var h=(this._mode===this.modeCreate&&this._addMode?this._util.getSecureUrl(esriGeowConfig.restBaseUrl):esriGeowConfig.restBaseUrl)+"portals/self/invite";if(a.length<=this.userInviteLimitBeforeSplit){var k={subject:e,html:c,invitationList:b.json.stringify({invitations:a})};this._util.request({url:h,content:k},{usePost:!0}).then(b.hitch(this,this.onUsersInvited,a,g),b.hitch(this,this.onUsersInvited,a,g))}else{for(var k=[],l=0;l<Math.ceil(a.length/
this.maxUsersPerInvite);l++){var m=0===l?0:l*this.maxUsersPerInvite,n=0===l?this.maxUsersPerInvite:this.maxUsersPerInvite+l*this.maxUsersPerInvite;0>m&&(m=0);n>a.length&&(n=a.length);m={subject:e,html:c,invitationList:b.json.stringify({invitations:a.slice(m,n)})};m=this._util.request({url:h,content:m},{usePost:!0});k.push(m)}0<k.length&&(new b.DeferredList(k)).then(b.hitch(this,this.onBatchUsersInvited,a,g),b.hitch(this,this.onBatchUsersInvited,a,g))}}})})},_createBatchPortalUsers:function(a){var e=
esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))+"/portaladmin/security/users/createUser",c=[],d;for(d=0;d<a.length;d++)c.push(this._util.request({url:e,content:a[d]},{usePost:!0}));(new b.DeferredList(c)).then(b.hitch(this,function(c){var d=a.length,e=0,h=[],l=[],m,n;for(m=0;m<c.length;m++)if((n=c[m][1])&&(!n.status||"success"!==n.status))e++,-1<n.message.indexOf("user already exists")?l.push(a[m].username):h.push(a[m].username);d-=e;esri.isDefined(this._selectedGroups)&&
0<this._selectedGroups.length?this._addUsersToGroups(a,h.concat(l),this._selectedGroups).then(b.hitch(this,function(a){this.completeBatchPortalUsers(d,h,l)}),b.hitch(this,function(a){console.log("error adding users to groups",a);this.completeBatchPortalUsers(d,h,l)})):this.completeBatchPortalUsers(d,h,l)}))},_addUsersToGroups:function(a,e,c){a=this._getInvitedUserList(a,e).join(",");e=[];var d=esriGeowConfig.restBaseUrl+"community/groups/${groupId}/addUsers",f,g;for(g=0;g<c.length;g++)f=c[g],e.push(this._util.request({url:esri.substitute({groupId:f.id},
d),content:{users:a}},{usePost:!0}));return new b.DeferredList(e)},_getInvitedUserList:function(a,e){var c=[],d;for(i=0;i<a.length;i++)d=a[i],-1===b.indexOf(e,d.username)&&c.push(d.username);return c},completeBatchPortalUsers:function(a,e,c){this.hide();b.style(this._completed,"display","block");1===a?b.attr(this._completedMessage,"innerHTML",this.i18n.completed.successSingleAdd):1<a&&b.attr(this._completedMessage,"innerHTML",esri.substitute({n:a},this.i18n.completed.successBatchAdd));e&&0<e.length&&
(a=e.join(", "),b.attr(this._uninvitedMessage,"innerHTML",esri.substitute({userList:a},this.i18n.completed.unaddedUsers)),b.style(this._uninvitedMessageSpan,"display","block"));c&&0<c.length&&(c=c.join(", "),b.attr(this._existedUserMessage,"innerHTML",esri.substitute({userList:c},this.i18n.completed.existedUsers)),b.style(this._existedUserMessageSpan,"display","block"))},onBatchUsersInvited:function(a,e,c){if(c){var d=e;e=0;for(var f=[],g=0;g<c.length;g++){var h=c[g][1];h.notInvited&&(e=h.notInvited.length,
f=f.concat(h.notInvited));d-=e}esri.isDefined(this._selectedGroups)&&0<this._selectedGroups.length?this._addUsersToGroups(a,f,this._selectedGroups).then(b.hitch(this,function(a){this.completeBatchUserInvite(d,f)}),b.hitch(this,function(a){console.log("error adding users to groups",a);this.completeBatchUserInvite(d,f)})):this.completeBatchUserInvite(d,f)}else this.inviteError(c)},completeBatchUserInvite:function(a,e){this.hide();b.style(this._completed,"display","block");1===a?b.attr(this._completedMessage,
"innerHTML",this._addMode?this.i18n.completed.successSingleAdd:this.i18n.completed.successSingle):1<a&&b.attr(this._completedMessage,"innerHTML",esri.substitute({n:a},this._addMode?this.i18n.completed.successBatchAdd:this.i18n.completed.successBatch));if(e&&0<e.length){var c=e.join(", "),d;this._mode===this.modeInvite||this._mode===this.modeIDP?d=esri.substitute({emailList:c},this.i18n.completed.uninvitedEmails):this._mode===this.modeCreate&&(d=esri.substitute({userList:c},this._addMode?this.i18n.completed.unaddedUsers:
this.i18n.completed.uninvitedUsers));b.attr(this._uninvitedMessage,"innerHTML",d);b.style(this._uninvitedMessageSpan,"display","block")}},onUsersInvited:function(a,e,c){if(c&&!0===c.success){var d=e;e=0;var f=c.notInvited||[];c.notInvited&&(e=c.notInvited.length);d-=e;esri.isDefined(this._selectedGroups)&&0<this._selectedGroups.length?this._addUsersToGroups(a,f,this._selectedGroups).then(b.hitch(this,function(a){this.completeUserInvite(d,c)}),b.hitch(this,function(a){console.log("error adding users to groups",
a);this.completeUserInvite(d,c)})):this.completeUserInvite(d,c)}else this.inviteError(c)},completeUserInvite:function(a,e){this.hide();b.style(this._completed,"display","block");1===a?b.attr(this._completedMessage,"innerHTML",this._addMode?this.i18n.completed.successSingleAdd:this.i18n.completed.successSingle):1<a&&b.attr(this._completedMessage,"innerHTML",esri.substitute({n:a},this._addMode?this.i18n.completed.successBatchAdd:this.i18n.completed.successBatch));if(e.notInvited&&0<e.notInvited.length){var c=
e.notInvited.join(", "),d;this._mode===this.modeInvite||this._mode===this.modeIDP?d=esri.substitute({emailList:c},this.i18n.completed.uninvitedEmails):this._mode===this.modeCreate&&(d=esri.substitute({userList:c},this._addMode?this.i18n.completed.unaddedUsers:this.i18n.completed.uninvitedUsers));b.attr(this._uninvitedMessage,"innerHTML",d);b.style(this._uninvitedMessageSpan,"display","block")}},inviteError:function(a){console.log("error",a);this.hide();b.style(this._completedMessageSpan,"display",
"none");b.style(this._completed,"display","block");b.attr(this._uninvitedMessage,"innerHTML",this._addMode?this.i18n.completed.errorAdding:this.i18n.completed.errorSendingInvitations);b.style(this._uninvitedMessageSpan,"display","block")},onInviteMoreClicked:function(){window.location.reload()},onReturnToOrgClicked:function(){window.location=esriGeowConfig.baseUrl+"organization.html"},onCancel:function(){this._userStore?this._userStore.fetch({onComplete:b.hitch(this,function(a){0<a.length?(a={title:this.i18n.noticeLabel,
message:this._addMode?this.i18n.notFinishedAdding:this.i18n.notFinishedInviting,choiceOneTitle:this.i18n.stopInviting,choiceTwoTitle:this.i18n.finishInviting},a.choiceOneHandler=b.hitch(this,function(a){window.location=(this._settings.allSSL?this._util.getSecureUrl(esriGeowConfig.baseUrl):this._util.getHttpUrl(esriGeowConfig.baseUrl))+"organization.html"}),a.choiceTwoHandler=function(a){},dlg=arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance(),dlg.show(a)):window.location=
(this._settings.allSSL?this._util.getSecureUrl(esriGeowConfig.baseUrl):this._util.getHttpUrl(esriGeowConfig.baseUrl))+"organization.html"})}):window.location=(this._settings.allSSL?this._util.getSecureUrl(esriGeowConfig.baseUrl):this._util.getHttpUrl(esriGeowConfig.baseUrl))+"organization.html"}})});