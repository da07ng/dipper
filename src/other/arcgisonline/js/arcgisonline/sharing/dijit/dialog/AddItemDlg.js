// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/dialog/AddItemDlg",["dijit","dojo","dojox","dojo/i18n!arcgisonline/nls/arcgisonline","dojo/require!dijit/form/Form,dojox/form/Manager,dijit/form/Select,dijit/form/Button,dojox/validate/regexp,dojox/widget/Standby,dojo/i18n,esri/layers/wms,esri/layers/KMLLayer,arcgisonline/sharing/util,arcgisonline/sharing/dijit/dialog/_AddItemDlgMixin,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/dialog/ChoiceDlg,arcgisonline/map/main,arcgisonline/sharing/dijit/HelpManager,esri/IdentityManager,arcgisonline/sharing/dijit/ServiceInfo,esri/dijit/Tags"],
function(l,b,k){b.provide("arcgisonline.sharing.dijit.dialog.AddItemDlg");b.require("dijit.form.Form");b.require("dojox.form.Manager");b.require("dijit.form.Select");b.require("dijit.form.Button");b.require("dojox.validate.regexp");b.require("dojox.widget.Standby");b.require("dojo.i18n");b.requireLocalization("arcgisonline","arcgisonline");b.require("esri.layers.wms");b.require("esri.layers.KMLLayer");b.require("arcgisonline.sharing.util");b.require("arcgisonline.sharing.dijit.dialog._AddItemDlgMixin");
b.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");b.require("arcgisonline.sharing.dijit.dialog.ChoiceDlg");b.require("arcgisonline.map.main");b.require("arcgisonline.sharing.dijit.HelpManager");b.require("esri.IdentityManager");b.require("arcgisonline.sharing.dijit.ServiceInfo");b.require("esri.dijit.Tags");b.declare("arcgisonline.sharing.dijit.dialog.AddItemDlg",[l.form.Form,l._WidgetsInTemplateMixin,k.form.manager._Mixin,k.form.manager._NodeMixin,k.form.manager._EnableMixin,k.form.manager._ValueMixin,
k.form.manager._DisplayMixin,k.form.manager._ClassMixin,arcgisonline.sharing.dijit.dialog._AddItemDlgMixin],{templateString:b.cache("arcgisonline.sharing.dijit.dialog","templates/AddItemDlg.html",'\x3cform dojoAttachPoint\x3d"containerNode" enctype\x3d"multipart/form-data" action\x3d"" method\x3d"POST"  dojoAttachEvent\x3d"onsubmit:onSubmit"\x3e\r\n\x3cdiv dojoAttachPoint\x3d"formNode" class\x3d"esriItemLinks dijitDialogPaneContentArea"\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_instructions" class\x3d"addNew"\x3e${i18n.instructions}\x3c/div\x3e\r\n    \x3cdiv class\x3d"publishOld" style\x3d"display:none;"\x3e${i18n.publishInstructions}\x3c/div\x3e\r\n    \x3cbr /\x3e\r\n    \x3cfieldset class\x3d"addNew"\x3e\r\n        \x3clabel dojoAttachPoint\x3d"addItemLbl" for\x3d"itemType"\x3e${i18n.itemType}\x3c/label\x3e\r\n        \x3cselect dojoAttachPoint\x3d"itemType" class\x3d"wideselect"  dojoType\x3d"dijit.form.Select" name\x3d\'itemType\' observer\x3d"changeType, changePlaceholder, deleteGrid"\x3e\r\n           \x3coption value\x3d"file" selected\x3e${i18n.itemTypeCpu}\x3c/option\x3e\r\n           \x3coption value\x3d"url"\x3e${i18n.itemTypeWeb}\x3c/option\x3e\r\n           \x3coption value\x3d"app"\x3e${i18n.itemTypeApp}\x3c/option\x3e\r\n        \x3c/select\x3e\r\n        \x3cdiv class\x3d"type app" style\x3d"display:none;"\x3e\r\n            \x3clabel\x3e${i18n.type}${i18n.colon}\x3c/label\x3e\r\n            \x3cdiv class\x3d"indent"\x3e\r\n                \x3cinput id\x3d"apimap" dojoType\x3d"dijit.form.RadioButton" class\x3d"radio" name\x3d"app" value\x3d"apimap" checked observer\x3d"changeApiType, changePlaceholder" /\x3e\r\n                \x3clabel for\x3d"apimap"\x3e${i18n.appMap}\x3c/label\x3e\r\n                \x3cinput id\x3d"apimobile" dojoType\x3d"dijit.form.RadioButton" class\x3d"radio" name\x3d"app" value\x3d"apimobile" observer\x3d"changeApiType, changePlaceholder" /\x3e\r\n                \x3clabel for\x3d"apimobile"\x3e${i18n.appMobile}\x3c/label\x3e\r\n                \x3cinput id\x3d"app" dojoType\x3d"dijit.form.RadioButton" style\x3d"display:none;" class\x3d"radio orgOnly" name\x3d"app" value\x3d"desktopapplication" observer\x3d"changeApiType"/\x3e\r\n                \x3clabel class\x3d"orgOnly" style\x3d"display:none;" for\x3d"app"\x3e${i18n.desktop}\x3c/label\x3e\r\n                \x3cinput id\x3d"apiapp" dojoType\x3d"dijit.form.RadioButton" style\x3d"display:none;" class\x3d"radio orgOnly" name\x3d"app" value\x3d"apiapp" observer\x3d"changeApiType" /\x3e\r\n                \x3clabel class\x3d"orgOnly" style\x3d"display:none;" for\x3d"apiapp"\x3e${i18n.appApplication}\x3c/label\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"indent esriLeadingMargin73 orgOnly adminOnly" style\x3d"display:none;"\x3e\r\n                \x3cinput id\x3d"opext" dojoType\x3d"dijit.form.RadioButton" style\x3d"display:none;" class\x3d"radio orgOnly adminOnly" name\x3d"app" value\x3d"opext" observer\x3d"changeApiType" /\x3e\r\n                \x3clabel class\x3d"orgOnly adminOnly" style\x3d"display:none;" for\x3d"opext"\x3e${i18n.opExtension}\x3c/label\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cfieldset class\x3d"type app api" style\x3d"display:none;"\x3e\r\n        \x3cspan class\x3d"indent esriLeadingMargin73"\x3e\r\n           \x3clabel for\x3d"purpose"\x3e${i18n.itemPurpose}${i18n.colon}\x3c/label\x3e\r\n            \x3cselect dojoType\x3d"dijit.form.Select" name\x3d"purpose"\x3e\r\n                \x3coption value\x3d"Ready To Use" selected\x3e${i18n.itemReady}\x3c/option\x3e\r\n                \x3coption value\x3d"Configurable"\x3e${i18n.itemConfigurable}\x3c/option\x3e\r\n                \x3coption value\x3d"selfConfigured"\x3e${i18n.itemSelfConfigurable}\x3c/option\x3e\r\n                \x3coption value\x3d"Code Sample"\x3e${i18n.itemCode}\x3c/option\x3e\r\n            \x3c/select\x3e\r\n        \x3c/span\x3e\r\n         \x3cspan class\x3d"indent esriLeadingMargin73 esriLeadingMargin2 apiType apimap"\x3e\r\n           \x3clabel for\x3d"api"\x3e${i18n.itemAPI}${i18n.colon}\x3c/label\x3e\r\n            \x3cselect dojoType\x3d"dijit.form.Select" name\x3d"desktopapi"\x3e\r\n                \x3coption value\x3d"JavaScript" selected\x3e${i18n.itemJS}\x3c/option\x3e\r\n                \x3coption value\x3d"Flex"\x3e${i18n.itemFlex}\x3c/option\x3e\r\n                \x3coption value\x3d"Silverlight"\x3e${i18n.itemSL}\x3c/option\x3e\r\n                \x3coption value\x3d"Web ADF"\x3e${i18n.itemADF}\x3c/option\x3e\r\n                \x3coption value\x3d"Other"\x3e${i18n.itemOther}\x3c/option\x3e\r\n            \x3c/select\x3e\r\n        \x3c/span\x3e\r\n        \x3cspan class\x3d"indent esriLeadingMargin73 esriLeadingMargin2 apiType apimobile" style\x3d"display:none;"\x3e\r\n           \x3clabel for\x3d"api"\x3e${i18n.itemSDK}${i18n.colon}\x3c/label\x3e\r\n            \x3cselect dojoType\x3d"dijit.form.Select" name\x3d"mobileapi"\x3e\r\n                \x3coption value\x3d"ArcGIS for Android"\x3e${i18n.itemAndroid}\x3c/option\x3e\r\n                \x3coption value\x3d"ArcGIS for iPhone"\x3e${i18n.itemIOS}\x3c/option\x3e\r\n                \x3coption value\x3d"JavaScript" selected\x3e${i18n.itemJS}\x3c/option\x3e\r\n                \x3coption value\x3d"Flex"\x3e${i18n.itemFlex}\x3c/option\x3e\r\n                \x3coption value\x3d"Windows Mobile"\x3e${i18n.itemMobile}\x3c/option\x3e\r\n                \x3coption value\x3d"ArcGIS for Windows Phone"\x3e${i18n.itemWindows}\x3c/option\x3e\r\n            \x3c/select\x3e\r\n        \x3c/span\x3e\r\n        \x3cspan class\x3d"indent esriLeadingMargin73 esriLeadingMargin05 apiType desktopapplication" style\x3d"display:none;"\x3e\r\n           \x3clabel for\x3d"apidesktopapp"\x3e${i18n.itemPlatform}${i18n.colon}\x3c/label\x3e\r\n            \x3cselect dojoType\x3d"dijit.form.Select" name\x3d"apidesktopapp"\x3e\r\n                \x3coption value\x3d"Java"\x3eJava\x3c/option\x3e\r\n                \x3coption value\x3d".NET\u2013Windows Desktop"\x3e.NET\u2013Windows Desktop\x3c/option\x3e\r\n                \x3coption value\x3d"OS X" selected\x3eOS X\x3c/option\x3e\r\n                \x3coption value\x3d"Qt"\x3eQt\x3c/option\x3e\r\n                \x3coption value\x3d"WPF"\x3eWPF\x3c/option\x3e\r\n            \x3c/select\x3e\r\n        \x3c/span\x3e\r\n        \x3c/fieldset\x3e\r\n        \x3cdiv class\x3d"type file desktopapplication"\x3e\r\n            \x3clabel for\x3d"file"\x3e${i18n.itemFile}${i18n.colon}\x3c/label\x3e\r\n            \x3cspan dojoAttachPoint\x3d"fileDiv"\x3e\r\n              \x3cinput id\x3d"file" class\x3d"required" size\x3d"41" type\x3d"file" name\x3d"file"\x3e\r\n            \x3c/span\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv class\x3d"type url" style\x3d"display:none;"\x3e\r\n            \x3clabel\x3e${i18n.type}${i18n.colon}\x3c/label\x3e\r\n            \x3cdiv class\x3d"webTypes"\x3e\r\n                \x3cinput dojoType\x3d"dijit.form.RadioButton" checked value\x3d"ags" class\x3d"radio" name\x3d"web" observer\x3d"changeServiceType, changePlaceholder, deleteGrid" /\x3e\r\n                \x3clabel for\x3d"ags"\x3e${i18n.webService}\x3c/label\x3e\r\n                \x3cinput dojoType\x3d"dijit.form.RadioButton" value\x3d"kml" name\x3d"web" class\x3d"radio" observer\x3d"changeServiceType, changePlaceholder, deleteGrid" /\x3e\r\n                \x3clabel for\x3d"kml"\x3e${i18n.webKML}\x3c/label\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"indent esriLeadingMargin73 webTypes"\x3e\r\n                \x3cinput dojoType\x3d"dijit.form.RadioButton" value\x3d"ogc" name\x3d"web" class\x3d"radio" observer\x3d"changeServiceType, changePlaceholder, deleteGrid" /\x3e\r\n                \x3clabel for\x3d"ogc"\x3e${i18n.webOGC}\x3c/label\x3e\r\n                \x3cinput dojoType\x3d"dijit.form.RadioButton" style\x3d"display:none;" value\x3d"document" name\x3d"web" class\x3d"orgOnly radio" observer\x3d"changeServiceType, changePlaceholder, deleteGrid" /\x3e\r\n                \x3clabel class\x3d"orgOnly" style\x3d"display:none;" for\x3d"document"\x3e${i18n.webDocument}\x3c/label\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"type url app api opext" style\x3d"display:none;"\x3e\r\n          \x3clabel id\x3d"urlLbl" for\x3d"url"\x3e${i18n.itemURL}\x3c/label\x3e\r\n          \x3cinput id\x3d"url" dojoType\x3d"dijit.form.TextBox" trim\x3d"true" name\x3d"url" observer\x3d"_getUrlAndType" placeHolder\x3d"${i18n.urlRulesSvc}"\x3e\r\n        \x3c/div\x3e\r\n        \x3c!--\x3ca dojoAttachPoint\x3d"supportedItems" class\x3d"indent esriLeadingMargin73 nosvcauth all" target\x3d"_blank" href\x3d""\x3e${i18n.itemSupportedItems}\x3c/a\x3e--\x3e\r\n        \x3c!--\x3cbr /\x3e--\x3e\r\n        \x3cfieldset class\x3d"type svcauth indent esriLeadingMargin73" style\x3d"display:none;"\x3e\r\n          \x3cdiv\x3e${i18n.secureservice}\x3c/div\x3e\r\n          \x3cdiv class\x3d"credentials"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"storecredentials"\x3e\r\n          \x3cinput dojoType\x3d"dijit.form.RadioButton" class\x3d"radio" checked value\x3d"nostore" name\x3d"storeauth" observer\x3d"changeStoreCredentials" /\x3e\r\n          \x3clabel class\x3d"wide" for\x3d"storeauth"\x3e${!i18n.nostoreauth}\x3c/label\x3e\r\n          \x3cbr /\x3e\r\n          \x3cinput dojoattachpoint\x3d"_storeAuth" dojoType\x3d"dijit.form.RadioButton" class\x3d"radio" value\x3d"store" name\x3d"storeauth" observer\x3d"changeStoreCredentials"/\x3e\r\n          \x3clabel class\x3d"wide" for\x3d"storeauth"\x3e${!i18n.storeauth}\x3c/label\x3e\r\n          \x3cbr /\x3e\r\n          \x3ca dojoAttachPoint\x3d"learnMore" target\x3d"_blank" href\x3d""\x3e${i18n.learnMore}\x3c/a\x3e\r\n          \x3cbr /\x3e\r\n          \x3c/div\x3e\r\n        \x3c/fieldset\x3e\r\n        \x3cspan class\x3d"indent type zip esriLeadingMargin73" style\x3d"display:none;"\x3e\r\n           \x3clabel for\x3d"archiveSelect"\x3e${i18n.itemContents}\x3c/label\x3e\r\n            \x3cselect dojoType\x3d"dijit.form.Select" id\x3d"archiveSelect" name\x3d"archiveSelect" observer\x3d"changeArchive"\x3e\r\n              \x3coption value\x3d"shapefile" selected\x3e${i18n.typeShapefile}\x3c/option\x3e\r\n              \x3coption value\x3d"filegeodatabase"\x3e${i18n.itemFileGeodatabase}\x3c/option\x3e\r\n\t            \x3coption value\x3d"dtemp"\x3e${i18n.typeDesktopTemplate}\x3c/option\x3e\r\n\t            \x3coption value\x3d"mtemp"\x3e${i18n.typeMapTemplate}\x3c/option\x3e\r\n              \x3coption value\x3d"gpsample"\x3e${i18n.typeGPSample}\x3c/option\x3e\r\n              \x3coption value\x3d"codesample"\x3e${i18n.itemCode}\x3c/option\x3e\r\n              \x3coption value\x3d"arcpadpackage"\x3e${i18n.itemArcPadPackage}\x3c/option\x3e\r\n              \x3coption value\x3d"caddrawing"\x3e${i18n.itemCadDrawing}\x3c/option\x3e\r\n              \x3coption value\x3d"csvcollection"\x3e${i18n.itemCsvCollection}\x3c/option\x3e\r\n              \x3coption value\x3d"kmlcollection"\x3e${i18n.itemKmlCollection}\x3c/option\x3e\r\n\t        \x3c/select\x3e\r\n        \x3c/span\x3e\r\n        \x3cspan class\x3d"indent right type codesample esriLeadingMargin73" style\x3d"display:none;"\x3e\r\n           \x3clabel for\x3d"codesample"\x3e${i18n.itemLanguage}${i18n.colon}\x3c/label\x3e\r\n            \x3cselect dojoType\x3d"dijit.form.Select" name\x3d"codesample" style\x3d"width:120px;"\x3e\r\n              \x3coption value\x3d"C"\x3eC\x3c/option\x3e\r\n              \x3coption value\x3d"C#"\x3eC#\x3c/option\x3e\r\n              \x3coption value\x3d"C++"\x3eC++\x3c/option\x3e\r\n              \x3coption value\x3d"Java" selected\x3eJava\x3c/option\x3e\r\n\t            \x3coption value\x3d"Perl"\x3ePerl\x3c/option\x3e\r\n\t            \x3coption value\x3d"PHP"\x3ePHP\x3c/option\x3e\r\n\t            \x3coption value\x3d"Python"\x3ePython\x3c/option\x3e\r\n              \x3coption value\x3d"Ruby"\x3eRuby\x3c/option\x3e\r\n              \x3coption value\x3d"SQL"\x3eSQL\x3c/option\x3e\r\n              \x3coption value\x3d"VB"\x3eVB\x3c/option\x3e\r\n              \x3coption value\x3d"VB"\x3eWPF\x3c/option\x3e\r\n              \x3coption value\x3d"Other"\x3eOther\x3c/option\x3e\r\n\t        \x3c/select\x3e\r\n        \x3c/span\x3e\r\n        \x3cspan class\x3d"indent right type arcpadpackage esriLeadingMargin73" style\x3d"display:none;"\x3e\r\n           \x3clabel for\x3d"arcpadpackage"\x3e${i18n.type}${i18n.colon}\x3c/label\x3e\r\n            \x3cselect dojoType\x3d"dijit.form.Select" name\x3d"arcpadpackage"\x3e\r\n              \x3coption value\x3d"ArcPad Project"\x3e${i18n.itemArcPadProject}\x3c/option\x3e\r\n              \x3coption value\x3d"ArcPad Template"\x3e${i18n.itemArcPadTemplate}\x3c/option\x3e\r\n\t        \x3c/select\x3e\r\n        \x3c/span\x3e\r\n        \x3cspan class\x3d"indent type stylx esriLeadingMargin73" style\x3d"display:none;"\x3e\r\n           \x3clabel for\x3d"stylx"\x3e${i18n.type}${i18n.colon}\x3c/label\x3e\r\n            \x3cselect dojoType\x3d"dijit.form.Select" id\x3d"stylx" name\x3d"stylx"\x3e\r\n              \x3coption value\x3d"2d"\x3e${i18n.2d}\x3c/option\x3e\r\n              \x3coption value\x3d"3d"\x3e${i18n.3d}\x3c/option\x3e\r\n            \x3c/select\x3e\r\n        \x3c/span\x3e\r\n    \x3c/fieldset\x3e\r\n\r\n    \x3cdiv dojoAttachPoint\x3d"_publishServiceDiv" class\x3d"indent publish type esriLeadingMargin73" style\x3d"display:none;"\x3e\r\n      \x3cfieldset dojoAttachPoint\x3d"_publishNode" class\x3d"type publish"\x3e\r\n        \x3cinput dojoAttachPoint\x3d"_enablePublishing" name\x3d"enablePublishing" dojoType\x3d"dijit.form.CheckBox" checked observer\x3d"onPublishCheck"\x3e\r\n        \x3clabel dojoAttachPoint\x3d"_enablePublishingLabel" for\x3d"enablePublishing"\x3e${i18n.publishService}\x3c/label\x3e\r\n      \x3c/fieldset\x3e\r\n    \x3c/div\x3e\r\n    \x3cfieldset\x3e\r\n        \x3cdiv class\x3d"title"\x3e\r\n          \x3clabel for\x3d"title"\x3e${i18n.itemTitle}${i18n.colon}\x3c/label\x3e\r\n          \x3cinput id\x3d"title" dojoType\x3d"dijit.form.TextBox" trim\x3d"true" class\x3d"required" name\x3d"title" placeHolder\x3d"${i18n.titleRules}"\x3e\r\n          \x3cbr /\x3e\r\n        \x3c/div\x3e\r\n        \x3ctable width\x3d"100%"\x3e\r\n          \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd class\x3d"tagLbl"\x3e\x3clabel data-dojo-attach-point\x3d"_tagsLbl" for\x3d"tags"\x3e${i18n.itemTags}${i18n.colon}\x3c/label\x3e\x3c/td\x3e\r\n              \x3ctd\x3e\x3cinput data-dojo-attach-point\x3d"_tags" data-dojo-type\x3d"esri/dijit/Tags" class\x3d"required" name\x3d"tags" data-dojo-props\x3d"minWidth:\'450px\',maxWidth:\'450px\'"\x3e\x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n        \x3c!--\x3clabel for\x3d"tags"\x3e${i18n.itemTags}${i18n.colon}\x3c/label\x3e--\x3e\r\n        \x3c!--\x3cdiv data-dojo-attach-point\x3d"_tags" data-dojo-type\x3d"arcgisonline/sharing/dijit/Tags" class\x3d"required esriFloatTrailing esriTrailingMargin02px" name\x3d"tags" data-dojo-props\x3d"minWidth:\'450px\',maxWidth:\'450px\'"\x3e\x3c/div\x3e--\x3e\r\n\r\n        \x3c!--\x3cinput dojoType\x3d"dijit.form.TextBox" trim\x3d"true" class\x3d"required" name\x3d"tags" placeHolder\x3d"${i18n.tagRules}"\x3e--\x3e\r\n        \x3c!--\x3cbr /\x3e--\x3e\r\n        \x3c!--\x3ca class\x3d"indent esriLeadingMargin73" target\x3d"_blank" dojoAttachEvent\x3d"onclick:showUserTags"\x3e${i18n.itemChooseTags}\x3c/a\x3e--\x3e\r\n    \x3c/fieldset\x3e\r\n    \x3cdiv class\x3d\'subtable opextwarning opextwarningmsg esriLeadingMargin73\' style\x3d"display:none;"\x3e\r\n      \x3cdiv\x3e${i18n.opExtensionMsg}\x3c/div\x3e\r\n      \x3cul\x3e\r\n        \x3cli class\x3d"useDataFromView opextwarningmsg" style\x3d"display:none;"\x3e${i18n.manifestWarnings.useDataFromView}\x3c/li\x3e\r\n        \x3cli class\x3d"usePortalServices opextwarningmsg" style\x3d"display:none;"\x3e${i18n.manifestWarnings.usePortalServices}\x3c/li\x3e\r\n        \x3cli class\x3d"useExternalAGSServices opextwarningmsg" style\x3d"display:none;"\x3e${i18n.manifestWarnings.useExternalAGSServices}\x3c/li\x3e\r\n      \x3c/ul\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d\'subtable hosted\' style\x3d"display:none;"\x3e\r\n      \x3cdiv dojoAttachPoint\x3d"_publishCSVDiv" class\x3d"publish type" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d\'csv\' style\x3d"display:none;"\x3e\r\n          \x3cp\x3e${i18n.locateUsing}${i18n.colon}\r\n            \x3cinput dojoType\x3d"dijit.form.RadioButton" class\x3d"radio csv portal noGeocode" name\x3d"geocode" value\x3d"locationTypes" checked observer\x3d"onChangeGeocode" /\x3e\r\n            \x3clabel class\x3d"csv portal noGeocode"\x3e${i18n.latLong}\x3c/label\x3e\r\n            \x3cinput dojoType\x3d"dijit.form.RadioButton" class\x3d"radio csv portal" name\x3d"geocode" value\x3d"addressTypes" observer\x3d"onChangeGeocode"/\x3e\r\n            \x3clabel class\x3d"csv portal"\x3e${i18n.address}\x3c/label\x3e\r\n            \x3cinput dojoType\x3d"dijit.form.RadioButton" class\x3d"radio csv portal noGeocode tableOnly" name\x3d"geocode" value\x3d"none" observer\x3d"onChangeGeocode"/\x3e\r\n            \x3clabel class\x3d"noGeocode csv portal tableOnly"\x3e${i18n.table}\x3c/label\x3e\r\n          \x3c/p\x3e\r\n\r\n          \x3cdiv class\x3d\'multigeocode\'\x3e\r\n            \x3cspan\x3e\r\n              \x3clabel for\x3d"geocoderSelect"\x3e${i18n.selectGeocoder}\x3c/label\x3e\r\n              \x3cselect dojoattachpoint\x3d"_geocoderSelect" dojoType\x3d"dijit.form.Select" style\x3d"width:175px;" maxHeight\x3d"200" name\x3d"geocodeAddress"\x3e\x3c/select\x3e\x3c!-- observer\x3d"onChangeGeocoder"--\x3e\r\n            \x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cspan class\x3d\'csv geocode\'\x3e\r\n            \x3clabel for\x3d"geocodeAddress"\x3e${i18n.country}${i18n.colon}\x3c/label\x3e\r\n            \x3cselect dojoattachpoint\x3d"_countryCodes" dojoType\x3d"dijit.form.Select" style\x3d"width:175px;" maxHeight\x3d"200" name\x3d"geocodeAddress" data-dojo-attach-event\x3d"onChange:onChangeCountry"\x3e\x3c/select\x3e\x3c!-- observer\x3d"onChangeCountry"--\x3e\r\n          \x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cspan dojoAttachPoint\x3d"geocodeReviewMsg" class\x3d\'csv\' style\x3d"display:none;"\x3e${i18n.review}\x3c/span\x3e\r\n      \x3cdiv dojoAttachPoint\x3d\'gridNode\' class\x3d"grid"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n\x3cdiv class\x3d"submitButtons dijitDialogPaneActionBar"\x3e\r\n    \x3cspan dojoAttachPoint\x3d"spinnerNode" style\x3d"display:none"\x3e${i18n.pleaseWait}\x3c/span\x3e\r\n    \x3cinput dojoType\x3d"dijit.form.Button" class\x3d"primary" id\x3d"addItem-btn" name\x3d"addItem" type\x3d"submit" label\x3d"${i18n.addItem}"\x3e\r\n    \x3cinput dojoType\x3d"dijit.form.Button" class\x3d"cancel" name\x3d"cancel" type\x3d"button" observer\x3d"onCancel" label\x3d"${i18n.cancel}"\x3e\r\n\x3c/div\x3e\r\n\x3c/form\x3e'),
baseClass:"esriAGOAddItemForm",_requestParams:{f:"json"},postMixInProperties:function(){this.inherited(arguments);this.i18nCommon=b.mixin({},b.i18n.getLocalization("arcgisonline","arcgisonline").common);this.i18n=b.mixin({},this.i18nCommon);this.i18n=b.mixin(this.i18n,b.i18n.getLocalization("arcgisonline","arcgisonline").addItemFrm);this.i18n=b.mixin(this.i18n,{fileZipFormat:b.i18n.getLocalization("arcgisonline","arcgisonline").attachCodeDlg.fileZipFormat});this.countryCodes=b.mixin({},b.i18n.getLocalization("arcgisonline",
"arcgisonline").countryCodes);this._publishTypes={tilepackage:1,csv:1,shapefile:1,servicedefinition:1,filegeodatabase:1,geojson:1,json:1,vectortilepackage:1,scenepackage:1,featurecollection:1};this._maxFileSize=1E9},startup:function(){this.inherited(arguments);if(b.isIos||b.isAndroid){for(var a=this.itemType.options,c=0;c<a.length;c++)if("file"===a[c].value){this.itemType.removeOption(a[c]);break}this.elementValue("itemType","url");this.changeType("url")}this._loadConnections();this._util=arcgisonline.sharing.util;
this._errorDlg=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();this._choiceDlg=arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance();this._user=b.mixin(this._util.getUser(),this.overrideUser||{});this._restBaseUrl=esriGeowConfig.allSSL?esriGeowConfig.restBaseUrl.replace("http:/","https:/"):esriGeowConfig.restBaseUrl;this._restBaseUrl+=this._restBaseUrl.lastIndexOf("/")===this._restBaseUrl.length-1?"":"/";this._portalUrl=this._restBaseUrl+"portals";
this._contentUri=this._restBaseUrl+"content";this._publishUri=this._contentUri+"/users/"+this._user.username;this._userContentUri=this._publishUri+(this.folder&&"/"!==this.folder?"/"+this.folder:"");this._geocodeServiceUrl=this._agoGeocodeServiceUrl="arcgis.com/arcgis/rest/services/world/geocodeserver";this._geocodeServers=(this._helperServices=esriGeowConfig.self&&esriGeowConfig.self.helperServices)&&this._helperServices.geocode;this._isPortal=esriGeowConfig.self.isPortal;this._isCustomRole=esriGeowConfig.userRole&&
esriGeowConfig.userRole.isCustom();this._isAdmin=esriGeowConfig.userRole&&esriGeowConfig.userRole.isBasedOnAdmin();this._roleCanPublishFeatures=(this._roleCanCreateItem=esriGeowConfig.userRole&&esriGeowConfig.userRole.canCreateItem())&&esriGeowConfig.userRole.canPublishFeatures();this._roleCanPublishTiles=this._roleCanCreateItem&&esriGeowConfig.userRole.canPublishTiles();this._roleCanUseGeocode=this._roleCanCreateItem&&esriGeowConfig.userRole.canUseGeocode();this._roleCanPublishScenes=this._roleCanCreateItem&&
esriGeowConfig.userRole.canPublishScenes();if((this._geocodeServers=this._util.filterBatchGeocoders(this._geocodeServers,!this._roleCanUseGeocode))&&this._geocodeServers.length)this._roleCanUseGeocode=!0,this._setGeocoder(this._geocodeServers[0].url),this._setGeocoderOptions(),2>this._geocodeServers.length&&b.query(".multigeocode").style("display","none");esri.config.defaults.io.proxyUrl=esriGeowConfig.proxyServer;this.item||(a=b.create("a",{className:"esriHelpIcon",title:this.i18n.helpIconSupportedItems,
href:esriGeowConfig.self?esriGeowConfig.self.helpBase+esriGeowConfig.self.helpMap.m["120000456"]:"",target:"_blank"}),c=b.query(".dijitDialogTitle",this.dialog.domNode),b.place(a,c[0],"last"));this._requestParams.token=this._user.token;this._basicStandby=new k.widget.Standby({target:this.dialog&&this.dialog.domNode||this.containerNode});b.body().appendChild(this._basicStandby.domNode);this._basicStandby.startup();this._serviceInfoPane=new arcgisonline.sharing.dijit.ServiceInfo({},b.query(".credentials")[0]);
this._serviceInfoPane.setProtocolErrorHandler(b.hitch(this,"_showReloadDlg"));this._credentialConnect=b.connect(this._serviceInfoPane,"onCredentialChange",b.hitch(this,function(){clearTimeout(this._changeCredentialTimeout);this._changeCredentialTimeout=setTimeout(b.hitch(this,function(){var a=this._serviceInfoPane.get("userInfo");a&&(a.username&&a.password)&&(this.disable(!1,this.i18n.fetching),this._getServiceInfo(this.elementValue("url"),this.elementValue("title"),this.item.type))}),250)}));this._fetchCountryCodes();
if(esriGeowConfig.self.user&&esriGeowConfig.self.user.accountId){var e=l.byId("archiveSelect");this.itemInfo=b.mixin(this.itemInfo,this.orgOnly);b.forEach(["Pages","Numbers","Keynote"],b.hitch(this,function(a){e.addOption({value:a.toLowerCase(),label:this.i18n["item"+a]})}));b.query(".orgOnly").style("display","");this._isAdmin?b.query(".adminOnly").style("display",""):b.query(".adminOnly").style("display","none")}this._util.loadUserTags(this._user.username).then(b.hitch(this,function(a){this._tags.set("knownTags",
a);this._updateUI();this.allowPublish&&this.item&&this._tags.set("tags",this.item.tags)}));this.message&&b.attr(this._instructions,"innerHTML",this.message);if("file"===this.selected||"url"===this.selected||"app"===this.selected)esri.hide(this.itemType.domNode),esri.hide(this.addItemLbl),this.itemType.set("value",this.selected);this.allowPublish&&this.item&&this.startupForPublish()},_setGeocoderOptions:function(){for(var a=[],b=0;b<this._geocodeServers.length;b++)a.push({label:this._geocodeServers[b].name,
value:this._geocodeServers[b].url});this._geocoderSelect.set("options",a);this._geocoderSelect.set("value",this._geocodeServers[0].name,!1)},_setGeocoder:function(a){this._geocodeServiceUrl=a;this._isAgoWorldGeocodeServer=this._util.isEsriWorldGeocoderNoProxy(this._geocodeServiceUrl);this._isServiceProxyAgoWorldGeocodeServer=this._util.isEsriWorldGeocoderThroughProxy(this._geocodeServiceUrl);this._isWorldGeocodeServer=this._isAgoWorldGeocodeServer||this._isServiceProxyAgoWorldGeocodeServer;a=!0;if(!this._isAgoWorldGeocodeServer&&
!this._isServiceProxyAgoWorldGeocodeServer)for(var b in this._geocodeServers)b.url===this._geocodeServiceUrl&&(a=!!b.batch);this._allowGeocode=(!this._isCustomRole||this._roleCanUseGeocode)&&(!this._isPortal&&a||this._isPortal&&(!this._isAgoWorldGeocodeServer||this._isServiceProxyAgoWorldGeocodeServer)&&a)},startupForPublish:function(){this._publishOnly=!0;this.elementValue("title",this.item.title);this.formWidgets.addItem.widget.set("label",this.i18n.publishItem);this.item.type=this.item.type.replace(/\s+/g,
"").toLowerCase();this._updateUI("servicedefinition"===this.item.type?"title":null,this.item.type);this._updateUI("addNew","publishOld");this.removeClass("required",["file","url"]);"csv"===this.item.type?this._analyze(this.item).then(b.hitch(this,"_loadCSV")):this.item.publishParameters={}},enable:function(){this.inherited(arguments);b.query("a",this.containerNode).removeClass("disabledLink");esri.hide(this.spinnerNode);this._serviceInfoPane&&this._serviceInfoPane.set("disabled",!1)},disable:function(a,
c){this.inherited(arguments);b.attr(this.spinnerNode,"innerHTML",c||this.i18n.pleaseWait);b.style(this.spinnerNode,"display","inline-block");b.query("a",this.containerNode).addClass("disabledLink");this._serviceInfoPane&&this._serviceInfoPane.set("disabled",!0)},isValid:function(a){var c=this.gatherFormValues(this.i18n.errors.required),e=this.gatherClassState("required",this.i18n.errors.required),f=this.item&&this.item.type||null,d=this.elementValue("url");if(!a)for(var g in c)if(e[g]&&this._isEmpty(this.elementValue(g)))return this._showError(this.i18n.errors.required[g]);
c=this._tags.get("tags");if(!c||0===c.length)return this._showError(this.i18n.errors.required.tags);if(this.item&&this.item.error)return this._showError(this.item.error);if(e.file||a&&"file"===a){if(window.FileReader&&b.byId("file").files[0].size>this._maxFileSize)return this._showError(this.i18n.errors.fileToLarge);d=this.item.name||this.item.url||this.item.title||this.item.item}if("desktopapplication"===this.item.type&&!this.item.isZip)return this._showError({message:this.i18n.fileZipFormat});if(this._itemExists({name:d,
title:this.elementValue("title"),type:this.item.type}))return!1;if(!this.itemInfo[f.toLowerCase()])return this._showError({message:this.i18n.errors.unknownType.message});f=f&&f.toLowerCase()||null;if("opdashboardaddin"===f&&this._user&&"account_admin"!==this._user.role&&"account_publisher"!==this._user.role)return this._showError(this.i18n.errors.insuffientPrivs);if("opext"!==f||this._validateOpExtension(this._opExtensionInfo))return this.allowPublish&&!1!==this.publish&&f in this._publishTypes?(a=
this.value.title.split(" ").join("_"),(this._isPortal?/[.@~`!#$%\^&*+=\-\[\]\\';,\/{}|\\":<>\?]/g.test(a):/[.@#%&*+=\-\\';,\/|\\":<>\?]/g.test(a))||120<a.length?this._showError(this.i18n.errors.invalidServiceTitle):"servicedefinition"!==f?this._serviceNameAvailable(this.item).then(b.hitch(this,function(a){return a})):!0):this._reload?(this._showReloadDlg(),!1):!0},validate:function(a,b){return!RegExp("^(?:"+b+")").test(this.elementValue(a))?this._showError(this.i18n.errors.invalid[a]):!0},_validateOpExtension:function(a){var c=
{Widget:1,"Map Tool":1,"Feature Action":1},e=[];if(!a)return this._showError({message:this.i18n.errors.opExtensionNotJson});if(!a.type||!1===a.type in c)return this._showError({message:this.i18n.errors.opExtensionInvalidType});if(!a.runtime||!a.runtime.path)return this._showError({message:this.i18n.errors.opExtensionNoPath});a&&(a.useDataFromView&&e.push(".useDataFromView"),a.usePortalServices&&e.push(".usePortalServices"),a.useExternalAGSServices&&e.push(".useExternalAGSServices"),e.length&&(e.push(".opextwarning"),
b.query(e.join(","),this.domNode).style("display","block")));return!0},_isEmpty:function(a){return(this.trim?/^\s*$/:/^$/).test(a)},changeType:function(a){delete this._reload;this._updateUI("type",a);this._updateUI(null,"title");this._updateUI(null,"all");this.removeClass("required",["file","url"]);"file"!==a?(this.unregisterNode("file"),this.fileDiv.innerHTML=this.fileDiv.innerHTML,this.registerNode(b.byId("file")),b.disconnect(this._fileInputConnect),this._fileInputConnect=b.connect(b.byId("file"),
"onchange",b.hitch(this,"_getFileAndType")),this.addClass("required",["url"])):"url"!==a&&this.addClass("required",["file"]);"app"===a&&(a=this.elementValue("app"),this.changeApiType(a));this.elementValue("title","");this.elementValue("url","")},changeServiceType:function(a){delete this._reload;this.item=this.item||{};this.item.type=a},changeApiType:function(a){this._opExtensionInfo=null;this.item=this.item||{};this.item.type=a;this._updateUI("desktopapplication",null);this._updateUI("apiapp"===a||
"opext"===a?"api":null,"apiapp"!==a&&"opext"!==a?"api":null);"opext"!==a&&b.query(".subtable.opextwarning",this.domNode).style("display","none");this["apiapp"===a||"desktopapplication"===a?"removeClass":"addClass"]("required",["url"]);this["desktopapplication"===a?"addClass":"removeClass"]("required",["file"]);b.attr(b.byId("urlLbl"),"innerHTML","opext"===a?this.i18n.urlManifestLbl:this.i18n.itemURL);this._updateUI("apiType",a)},changeArchive:function(a){this.item=this.item||{};this.item.type=a;this._updateUI("publish");
this._updateUI("codesample");this._updateUI("arcpadpackage");this._updateUI("shapefile",!this.allowPublish&&a in this._publishTypes?null:a);this.allowPublish&&a in this._publishTypes&&(this._updateUI(null,"publish"),b.attr(this._enablePublishingLabel,"innerHTML",this.i18n["filegeodatabase"===a?"publishFGDB":"publishService"]))},changePlaceholder:function(a){this.elementValue("title","");this.elementValue("url","");if(esriGeowConfig.isRightToLeft&&(9>b.has("ie")||5>b.has("trident")))this.formWidgets.url.widget.set("placeHolder",
"");else{a="url"===a?this._getRadioButtonValue("web"):a;var c=this.i18n.urlRules;"ags"===a?c=this.i18n.urlRulesSvc:"app"===a||"apimobile"===a||"apimap"===a?c=this.i18n.urlRulesApp:"opext"===a&&(c=this.i18n.urlManifest);this.formWidgets.url.widget.set("placeHolder",c)}},changeStoreCredentials:function(a){},showUserTags:function(){arcgisonline.sharing.dijit.dialog.TagsDlg.prototype.statics.getInstance().show(this._user||null)},onPublishCheck:function(a){"csv"===this.item.type?(this._updateUI(a?null:
"csv",a?"csv":null),this._updateUI(a?null:"grid",a?"grid":null),a&&this._grid.setStore(this._oStore)):"servicedefinition"===this.item.type&&this._updateUI(a?"title":null,a?null:"title");this.publish=a},onCancel:function(){this.dialog&&this.dialog.hide()},onSubmit:function(a){a.preventDefault();this._serviceInfoPane&&this._serviceInfoPane._editingCredential&&this._serviceInfoPane.domNode?l.byId("addItem-btn").focus():b.when(this.isValid(),b.hitch(this,function(a){if(!a)return!1;switch(this.elementValue("itemType")){case "url":this._addService();
break;case "app":this._addApplication();break;default:this._addFile()}}))},onChangeGeocoder:function(a){this._setGeocoder(a);this._analyzed=!1;this.onChangeGeocode("addressTypes")},onChangeGeocode:function(a){"none"===a?(this._grid.layout.setColumnVisibility(2,!1),this._grid.layout.setColumnVisibility(3,!1),b.attr(this.geocodeReviewMsg,"innerHTML",this.i18n.reviewTable)):(this._grid.layout.setColumnVisibility("addressTypes"===a?2:3,!0),this._grid.layout.setColumnVisibility("addressTypes"===a?3:2,
!1),b.attr(this.geocodeReviewMsg,"innerHTML",this.i18n.review));this._updateUI("geocode","addressTypes"===a&&(!this._isPortal&&this._isWorldGeocodeServer||this._isPortal&&this._isServiceProxyAgoWorldGeocodeServer)?"geocode":null);if("addressTypes"===a&&!this._analyzed)this.onChangeCountry();"addressTypes"!==a?b.query(".multigeocode").style("display","none"):1<this._geocodeServers.length&&b.query(".multigeocode").style("display","")},onChangeCountry:function(){this.item&&(this._basicStandby.show(),
this.deleteGrid(!0),this._analyze(this.item).then(b.hitch(this,function(a){this._analyzed=!0;a.publishParameters.sourceCountry=a.publishParameters.sourceCountry||"world";a.publishParameters.sourceCountryHint="";return this._loadCSV(a)})))},_addFile:function(){if(this.item&&(this.item.publishParameters||this._analyzeError)){this.disable(null,this.i18n.updating);var a=this.gatherFormValues(["title"]),c=this._tags.get("tags")||"",e=this.item.tags?b.isArray(this.item.tags)?this.item.tags:this.item.tags.split(","):
[],c=this._unique(e.concat(c.split(","))).join(","),f=["showUnmatchedAddresses"],d=this.item.title,a=b.mixin(a,{tags:c});return this._update(this.item,a).then(b.hitch(this,"_publish",this.item)).then(b.hitch(this,function(a){if(a&&a.error)return this._update(this.item,{title:d},!0).then(b.hitch(this,function(){return this._showError(a.error)}));if(a&&this.item.csvInfo)return this._fetch(a).then(b.hitch(this,function(c){f=f.concat(c&&c.item&&c.item.typeKeywords||[]);f=this.item.csvInfo.publishParameters&&
"none"===this.item.csvInfo.publishParameters.locationType?f.concat("Table"):f;return this._update({id:a.id,type:a.type},{typeKeywords:f.join(",")}).then(b.hitch(this,"_showItem",a))}));if("featurecollection"===this.item.type)this._fetchItemData(this.item).then(b.hitch(this,function(c){var e={layers:[]};b.forEach(c.layers||[],b.hitch(this,function(a,c){var d={id:c};a&&a.popupInfo&&(d.popupInfo=b.clone(a.popupInfo));a.layerDefinition&&(a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.labelingInfo)&&
(d.showLabels=!0);e.layers.push(d)}));return e.layers.length?this._update({id:a.id,type:a.type},{text:b.json.stringify(e)}).then(b.hitch(this,"_showItem",a)):this._showItem(a)}));else return this._showItem(a)}))}this._upload().then(b.hitch(this,function(a){if(!a||!a.id)return!1;var c=new b.Deferred;a=this.item=b.mixin(this.item||{},a);a=b.mixin(a,{tags:this._tags.get("tags")});this.item=b.mixin(a,this.gatherFormValues(["title"]));switch(a.type.toLowerCase()){case "servicedefinition":c.then(b.hitch(this,
"_publish",a)).then(b.hitch(this,function(c){if(c&&c.error||c.length&&(c[0]&&c[0].error||c[1]&&c[1].error))return this._showItem(c);var e=this.item.title;if(c.length&&c[0].serviceurl||c.serviceurl)e=c.length?c[0].serviceurl.split("/"):c.serviceurl.split("/"),e=e[e.length-2];return this._update(a,{title:e}).then(b.hitch(this,"_showItem",c))}));break;case "filegeodatabase":case "tilepackage":case "vectortilepackage":case "scenepackage":case "geojson":case "json":case "shapefile":c.then(b.hitch(this,
"_publish",a)).then(b.hitch(this,"_showItem"));break;case "csv":this.allowPublish&&this._publishTypes.csv&&!this._analyzeError?c.then(b.hitch(this,"_analyze",a)).then(b.hitch(this,"_loadCSV")):c.then(b.hitch(this,"_showItem",a));break;case "kml":case "kmz":a.url=this._contentUri+"/items/"+a.id+"/data?token\x3d"+this._user.token;c.then(b.hitch(this,"_setKmlExtent",a)).then(b.hitch(this,function(a){return this._update(a,{extent:a.extent,url:this._contentUri+"/items/"+a.id+"/data"},!0).then(this._showItem)}));
break;default:c.then(b.hitch(this,"_showItem",a))}this._checkStatus(a,function(a){c.resolve(a)},b.hitch(this,function(a){return this._showError(a)}))}))},_addService:function(){var a;this.disable();switch(this._getRadioButtonValue("web")){case "ags":a=this._addSecureAGSService().then(this._showItem);break;case "kml":a=this._addKMLUrl();break;case "ogc":a=this._addOGCUrl();break;default:a=this._addUrl()}return a},_addSecureAGSService:function(){var a=this.item.serviceInfo,c=this.item.type.toLowerCase(),
c=this._checkThumbnailURL(this.itemInfo[c]),c=b.mixin(c,this.gatherFormValues(["url","title"])),c=b.mixin(c,{tags:this._tags.get("tags")});if(a&&a.isSecure&&!a.userInfo)throw this._showError(this.i18n.errors.invalidCredentials),Error();if(this.item.isSecured&&"store"===this._getRadioButtonValue("storeauth")){if(!this._isPortal||this._isPortal&&this._checkProtocol())c.serviceUsername=this._serviceInfoPane.userInfo.username,c.servicePassword=this._serviceInfoPane.userInfo.password;else throw this._basicStandby.hide(),
this.enable(),Error();if(401===this.item.isSecured.httpStatusCode)return this._add(c).then(b.hitch(this,"_fetch")).then(b.hitch(this,function(a){this.item.id=a.item&&a.item.id;this.item.url=a.item&&a.item.url;this.item.sourceUrl=a.item&&a.item.sourceUrl;return this._addAGSService(!0)}));if(a&&a.isSecure&&!a.userInfo)throw this._showError(this.i18n.errors.invalidCredentials),Error();}return this._addAGSService(!1)},_addAGSService:function(a){var c=this.item.serviceInfo,e=this.item.type.toLowerCase(),
f=this._checkThumbnailURL(this.itemInfo[e]),d=b.mixin(f,this.gatherFormValues(["url","title"])),g={streamserver:1,imageserver:1},d=b.mixin(d,{tags:this._tags.get("tags")});if(!c)throw this._showError({message:esri.substitute({name:d.title},this.i18n.errors.serviceNotExist.message)}),Error();f=c.documentInfo||{};d=b.mixin(d,{description:c.serviceDescription||c.description||f.Comments||"",snippet:f.Subject||"",accessInformation:c.copyrightText||f.Credits||"",spatialReference:this._getSpatialReference(this.item),
url:this.item.url||this.elementValue("url").split("?")[0]});e&&"mapserver"===e.toLowerCase()&&(d.typeKeywords+=c.singleFusedMapCache?" ,Tiled":" ,Dynamic");c&&(c.type&&"Table"===c.type)&&(d.typeKeywords+=", Table, Singlelayer");if(e&&e.toLowerCase()in g)d.typeKeywords+=" ,Singlelayer";else if(c&&(c.layers||c.tables))(!c.layers||!c.layers.length)&&c.tables&&c.tables.length?(-1===d.typeKeywords.indexOf("Table")&&(d.typeKeywords+=" ,Table"),d.typeKeywords+=1<c.tables.length?" ,Multilayer":" ,Singlelayer"):
(c=(c.layers||[]).concat(c.tables||[]),d.typeKeywords+=1<c.length?" ,Multilayer":" ,Singlelayer");return this._projectExtent2WGS84(d).then(b.hitch(this,"_getThumbnail",this.item,d)).then(b.hitch(this,function(a){d.thumbnailURL=a;d.thumbnailURL&&this.item.thumbnailToken&&(d.thumbnailURL+=(-1<d.thumbnailURL.indexOf("?")?"\x26":"?")+"token\x3d"+this.item.thumbnailToken);return d}),b.hitch(this,function(a){return d})).then(b.hitch(this,function(c){return a?this._update(this.item,b.mixin(c,{url:this.item.sourceUrl}),
!0):this._add(c)}))},_addKMLUrl:function(){var a=this.item.type.toLowerCase(),a=this._checkThumbnailURL(this.itemInfo[a]),c=b.mixin(a,this.gatherFormValues(["url","title"])),a=new b.Deferred,c=b.mixin(c,{tags:this._tags.get("tags")});a.then(b.hitch(this,"_setKmlExtent",c)).then(b.hitch(arcgisonline.map.thumbnail,"buildThumbnailURLFromKMLItem",c,null)).then(b.hitch(this,function(a){c.thumbnailURL=a;return c}),b.hitch(this,function(a){return c})).then(b.hitch(this,"_add",c)).then(b.hitch(this,"_showItem"));
a.resolve();return a},_setKmlExtent:function(a){esri.config.defaults.kmlService=esriGeowConfig.kmlService;var c=new b.Deferred,e=new esri.layers.KMLLayer(a.url),f=b.connect(e,"onLoad",b.hitch(this,function(){b.disconnect(f);a.extent=this._extent2String(this._getKmlExtent(e));c.resolve(a)})),d=b.connect(e,"onError",b.hitch(this,function(a){b.disconnect(d);this._showError({message:a.message});throw a;}));return c},_getKmlExtent:function(a){a=a.getLayers();var c;b.forEach(a,function(a){a.graphics&&0<
a.graphics.length&&(a=esri.graphicsExtent(a.graphics),c=!c?a:c.union(a))});return c||null},_addOGCUrl:function(){if(!this.item||!this.item.ogcInfo)this._showError({message:esri.substitute({name:""},this.i18n.errors.serviceNotExist.message)});else{var a=this.item.type.toLowerCase(),a=this._checkThumbnailURL(this.itemInfo[a]),c=b.mixin(a,this.gatherFormValues(["title"])),a=this.item.ogcInfo,e=new b.Deferred,f=[],d,g,h=!1,c=b.mixin(c,{tags:this._tags.get("tags")});this._grid&&this._grid.edit&&this._grid.edit.apply();
d=this._mStore&&this._mStore.query({visible:!0}).map(function(a){g=!g?a.extent:a.extent?g.union(a.extent):g;f.push(a.name);var b={name:a.name,title:a.title};a.legendURL&&(b.legendURL=a.legendURL);return b});a.setVisibleLayers(f);g=g||a.fullExtent;h=!b.some(a.spatialReferences,function(a){return a===g.spatialReference.wkid});c=b.mixin(c,{url:a.url,description:a.description||"",accessInformation:a.copyright||"",text:this._getWMSData(a,d),extent:g});h&&e.then(b.hitch(this,"_project",g,new esri.SpatialReference({wkid:a.spatialReferences[0]}))).then(b.hitch(this,
function(a){c.extent=a;return c}));e.then(b.hitch(this,"_getWMSImageUrl",c,a)).then(b.hitch(this,"_add")).then(b.hitch(this,"_showItem"));e.resolve();return e}},_getWMSImageUrl:function(a,c){var e=new b.Deferred,f=b.hitch(this,function(b){a.thumbnailURL=b||a.thumbnailURL;a.extent=this._extent2String(a.extent);e.resolve(a)});c.getImageUrl(a.extent,200,133,f,f);return e},_getWMSData:function(a,c){return b.json.stringify({title:a.title||"",url:a.url,mapUrl:a.getMapURL,version:a.version,layers:c,copyright:a.copyright||
"",maxHeight:a.maxHeight,maxWidth:a.maxWidth,spatialReferences:a.spatialReferences,format:"png"!==a.getImageFormat()?a.getImageFormat():null})},_addUrl:function(){var a=this._getRadioButtonValue("web"),a=this._checkThumbnailURL(this.itemInfo[a]),a=b.mixin(a,this.gatherFormValues(["url","title"])),a=b.mixin(a,{tags:this._tags.get("tags")});this.disable(["addItem","cancel"]);return this._add(a).then(this._showItem)},_addApplication:function(){var a=this._getRadioButtonValue("app"),c=this._checkThumbnailURL(this.itemInfo[a]),
e=this.elementValue("purpose"),f=this._opExtensionInfo,d;"apiapp"!==a&&("apimobile"===a?c.typeKeywords+=", "+this.elementValue("mobileapi"):"desktopapplication"===a?c.typeKeywords+=", "+this.elementValue("apidesktopapp"):"opext"!==a&&(c.typeKeywords+=", "+this.elementValue("desktopapi")),"opext"!==a&&(c.typeKeywords+=", "+e,"selfConfigured"===e&&(c.typeKeywords+=", Configurable")),c=b.mixin(c,this.gatherFormValues(["url"])));e=this.elementValue("title")+"_"+(new Date).getTime();d=b.mixin(c,this.gatherFormValues(["title"]));
d=b.mixin(d,{name:e});d=b.mixin(d,{tags:this._tags.get("tags")});"opext"===a&&f&&(d.thumbnailURL=f.thumbnailPath?d.url.substring(0,d.url.lastIndexOf("/")+1)+f.thumbnailPath:f.iconUrl||c.thumbnailUrl,d.accessInformation=f.credits||"",d.description=f.description||"",d.summary=d.description,d.typeKeywords+=", "+f.type,d.text=b.json.stringify(f));this.disable(["addItem","cancel"]);if("desktopapplication"!==a)return c=this._add(d),"apiapp"===a?c.then(b.hitch(this,"_registerApp")):c.then(b.hitch(this,"_showItem"));
a=b.create("div",null,this.formNode);d.itemType="file";for(e in d)b.place(b.create("input",{name:e,type:"text",value:c[e],style:{display:"none"}}),a);b.place(b.create("input",{type:"text",name:"overwrite",value:!1,style:{display:"none"}}),a);b.place(b.create("input",{type:"text",name:"async",value:!0,style:{display:"none"}}),a);return this._uploadFile(this.domNode,this._userContentUri+"/addItem",a).then(b.hitch(this,function(a){this._checkStatus(a,b.hitch(this,function(a){return this._showItem(a)}),
b.hitch(this,function(a){this._showError(a)}))}))},_upload:function(){var a=this._checkThumbnailURL(this.itemInfo[this.item.type]);if("codesample"===this.item.type||"arcpadpackage"===this.item.type||"stylx"===this.item.type)a.typeKeywords+=", "+this.elementValue(this.item.type);var c=b.create("div",null,this.formNode),a=b.mixin(a,{tags:this._tags.get("tags")}),e;for(e in a)b.place(b.create("input",{name:e,type:"text",value:a[e],style:{display:"none"}}),c);b.place(b.create("input",{type:"text",name:"overwrite",
value:!1,style:{display:"none"}}),c);b.place(b.create("input",{type:"text",name:"async",value:!0,style:{display:"none"}}),c);this.disable(["addItem","cancel"]);return this._uploadFile(this.domNode,this._userContentUri+"/addItem",c)},_add:function(a){return this._request((this._userContentUri+"/addItem").replace("http:/",a.serviceUsername&&a.servicePassword?"https:/":"http:/"),a,{usePost:!0})},_update:function(a,c,e){var f=e||!1;if(!e)for(var d in c)!a[d]||c[d]!==a[d]?f=!0:delete c[d];if(f)return this._request(this._userContentUri+
"/items/"+a.id+"/update",c,{usePost:!0});c=new b.Deferred;c.resolve(a);return c},_delete:function(a){if(!this._publishOnly)return this._request(this._userContentUri+"/items/"+a.id+"/delete",{},{usePost:!0},null,function(a){console.log(a)})},_fetch:function(a){return this._request(this._userContentUri+"/items/"+a.id,{},{})},_registerApp:function(a){return this._request(this._restBaseUrl+"oauth2/registerApp",{itemId:a.id,appType:"multiple",redirect_uris:'["urn:ietf:wg:oauth:2.0:oob"]'},{usePost:!0}).then(b.hitch(this,
function(a){return a}),b.hitch(this,function(a){throw Error(a);})).then(b.hitch(this,"_showItem",a))},_publish:function(a){if(!this.allowPublish||!1===this.publish||this._analyzeError){var c=new b.Deferred;c.resolve(a);return c}var e=a.type.toLowerCase(),c=this._getDefaultPublishParameters(a),f;if("servicedefinition"!==e){if("csv"===e){f=this.item.csvInfo.publishParameters.standardizedFieldNames;this._grid.edit.apply();var d=this._getRadioButtonValue("geocode"),g;if("addressTypes"===d){var h=0,m=
{};g=f;c.publishParameters.locationType="address";this._mStore.query(function(a){"unknown"!==a.locationType&&a.locationType in g&&(m[a.locationType]=a.name,h++)});if(1>h)return{error:this.i18n.errors.noAddressFields};c.publishParameters.addressFields=m}else if("locationTypes"===d){var n={locationType:"coordinates",latitudeFieldName:null,longitudeFieldName:null};g=b.mixin({},this.i18n[d]);this._mStore.query(function(a){"unknown"!==a.locationType&&a.locationType in g&&(n[a.locationType+"FieldName"]=
a.name)});if(!n.latitudeFieldName||!n.longitudeFieldName)return{error:this.i18n.errors.noLocationFields};b.mixin(c.publishParameters,n)}else c.publishParameters.locationType="none"}c.publishParameters=b.json.stringify(c.publishParameters)}this.disable(null,this.i18n.publishing);this.item.publishParameters={};return this._request(this._publishUri+"/publish",c,{usePost:!0}).then(b.hitch(this,function(c){this.item.publishParameters=a.publishParameters||{};return(c=b.map(c.services,b.hitch(this,function(a){var c=
b.mixin(a,{id:a.serviceItemId,type:a.type||this.i18n.service,name:this.elementValue("title"),error:a.error});esri._isDefined(a.success)&&!a.success&&!a.error&&(c.error=this.i18n.errors.publishError);if("tilepackage"===e||"scenepackage"===e)c.buildCache=!0;return c})))&&1===c.length&&("Map Service"!==c[0].type||"tilepackage"===e)?c[0]:c}))},_analyze:function(a){var c=this._contentUri+"/features/analyze",e={analyzeParameters:{enableGlobalGeocoding:!0,sourceLocale:b.locale},filetype:this.itemInfo[this.item.type.toLowerCase()].type.toLowerCase(),
itemid:a.id};this.disable(!1,this.i18n.analyzing);if(this._isPortal||!this._isPortal&&!this._isWorldGeocodeServer&&this._geocodeServers&&this._geocodeServers.length)e.analyzeParameters.geocodeServiceUrl=encodeURI(this._geocodeServiceUrl);a&&a.csvInfo&&(e.analyzeParameters.locationType="addressTypes"===this._getRadioButtonValue("geocode")?"address":"coordinates");if(!this._isPortal&&this._isWorldGeocodeServer||this._isPortal&&this._isServiceProxyAgoWorldGeocodeServer)e.analyzeParameters.sourceCountry=
a.csvInfo?this._countryCodes.get("value").toLowerCase():"",e.analyzeParameters.sourceCountryHint=a.csvInfo?"":this._sourceCountry;e.analyzeParameters=b.json.stringify(e.analyzeParameters);(a=arcgisonline.sharing.util.getToken())&&(c+="?token\x3d"+a);return this._request(c,e,{usePost:!0}).then(null,b.hitch(this,function(a){this._analyzeError||this.deleteGrid()}))},_createGrid:function(a){var c=this.item,e=c.type.toLowerCase(),f=this.gridInfo[e],d,g;c&&c.csvInfo&&(d=c.csvInfo.publishParameters,a=b.map(a,
b.hitch(this,function(a){if(d.addressFields)for(var c in d.addressFields){if(d.addressFields[c]===a.name)return b.mixin(a,{locationType:c})}else{if(a.name===d.longitudeFieldName)return b.mixin(a,{locationType:"longitude"});if(a.name===d.latitudeFieldName)return b.mixin(a,{locationType:"latitude"})}return b.mixin(a,{locationType:"unknown"})})));b.forEach(f,function(a){a.name=this.i18n[a.name]||a.name;a.select&&(g="csv"===e&&"addressTypes"===a.select?b.mixin({},b.mixin(b.clone(this.i18n.notUsed),d.standardizedFieldNames||
this.i18n[a.select])):b.mixin({},this.i18n[a.select]),b.mixin(a,this._toSelectOptions(g,"unknown")))},this);this._mStore=new b.store.Memory({data:a,idProperty:"name"});this._oStore=new b.data.ObjectStore({objectStore:this._mStore});this._updateUI(null,"hosted");this._publishOnly&&"csv"===c.type&&this._updateUI(null,"csv");this._grid=new k.grid.DataGrid({id:"_grid",selectionMode:"none",singleClickEdit:!0},b.create("div",{},this.gridNode));this._grid.set("structure",f);this._grid.setStore(this._oStore);
this._grid.startup();this._basicStandby.hide();this.enable();!this._publishOnly&&"csv"===c.type&&this._updateUI(null,"publish");this._updateUI(null,e)},deleteGrid:function(a){!a&&(this.item&&this.item.id)&&(this._delete(this.item),this.item.id=null);this._grid&&(9>b.isIE&&b.style(this.dialog.domNode,"height","350px"),this._updateUI("csv"),this._updateUI("hosted"),delete this._mStore,delete this._oStore,this._grid.destroy(),delete this._grid,this._mStore=this._oStore=this._grid=null)},_getServiceInfo:function(a,
c,e){var f=[499,498],d=this._tags.get("tags"),g,h=this._serviceInfoPane.get("userInfo"),m="FeatureServer"===e&&-1===a.indexOf(".arcgis.com")?a.replace("FeatureServer","MapServer"):a;!this.item.isSecured||this.item.isSecured&&401!==this.item.isSecured.httpStatusCode&&h&&h.username&&h.password?this._serviceInfoPane.getServiceInfo(m,this.item.isSecured).then(b.hitch(this,function(b){if("ImageServer"===this.item.type&&(b.tileInfo&&"LERC"===b.tileInfo.format||b.cacheType&&"elevation"===b.cacheType.toLowerCase()))this.item.type=
"ElevationServer";g=b.credential||esri.id.findCredential(a);h=this._serviceInfoPane.get("userInfo");this.item.thumbnailToken=g&&g.token||null;this.item.serviceInfo=b;this.item.serviceInfo.isSecure=h?!0:!1;this.item.serviceInfo.userInfo=h;d=((b.documentInfo||{}).Keywords||"").split(",").concat((d||"").split(","));this._tags.set("tags",this._unique(d).join(","));this.item.extent=b.fullExtent||b.extent;this.enable()}),b.hitch(this,function(d){this._reload?this.enable():-1!==b.indexOf(f,d.code)?(this.enable(),
this._updateUI("nosvcauth","svcauth"),this.item.checkUrlError?this._updateUI("storecredentials",null):this._updateUI(null,"storecredentials"),this.item.serviceInfo={isSecure:!0},this.item.isSecured=!0):d&&403===d.code?(this._showError(d),this.item.serviceInfo={isSecure:!0},this.item.isSecured=!0):"FeatureServer"!==e?this._showError({message:esri.substitute({name:c},this.i18n.errors.serviceNotExist.message)}):this._getServiceInfo(a.replace("MapServer","FeatureServer"),c,null)})):this.item.isSecured&&
(this.item.isSecured.isFederatedWithWebTierAuth||401===this.item.isSecured.httpStatusCode)?this._request(this.item.url,{},{}).then(b.hitch(this,function(a){this.item.serviceInfo=a;d=((a.documentInfo||{}).Keywords||"").split(",").concat((d||"").split(","));this._tags.set("tags",this._unique(d).join(","));this.item.extent=a.fullExtent||a.extent;this.enable()}),b.hitch(this,function(a){this._showError({message:esri.substitute({name:item.title},this.i18n.errors.serviceNotExist.message)});throw Error();
})):this.enable()},_getOGCServiceInfo:function(a,c){var e=new esri.layers.WMSLayer(this._stripParameters(a,["version","service","request"])),f=new b.Deferred,d=b.connect(e,"onLoad",b.hitch(this,function(){b.disconnect(d);f.resolve(e)})),g=b.connect(e,"onError",b.hitch(this,function(){b.disconnect(g);this._showError({message:esri.substitute({name:c},this.i18n.errors.serviceNotExist.message)});f.cancel()}));return f},_loadOGC:function(a){this.item.ogcInfo=a;this.item.url=a.url;this.elementValue("url",
a.url);this.elementValue("title",a.title);var c=[];b.forEach(a.layerInfos,b.hitch(this,"_getWMSLayers",c));b.some(c,function(a,b){a.visible=!0;return 9<b});this._createGrid(c);this._grid.canSort=b.hitch(this,function(a){return 1!==Math.abs(a)});this._gridConnects.push(b.connect(this._oStore,"onSet",b.hitch(this,function(a,c){"visible"===c&&(b.byId("_ogcCB").checked=this._mStore.query({visible:!0}).length===this._mStore.data.length)})));this._gridConnects.push(b.connect(this._grid,"onHeaderCellClick",
b.hitch(this,function(a){if(!1!==esri.isDefined(a.target.checked)){var b=a.target.checked;this._mStore.query({visible:!b}).forEach(function(a){a.visible=b;this._mStore.put(a)},this);this._grid._fetch(0,!0)}})))},_loadCSV:function(a){if(a){var c=a.publishParameters||{},e="address"===c.locationType||"none"===c.locationType&&c.standardizedFieldNames?"addressTypes":"locationTypes",f=c.layerInfo&&c.layerInfo.fields||[];this.item.csvInfo=a;this.item.publishParameters=c;if(!this._isPortal&&this._isWorldGeocodeServer||
this._isPortal&&this._isServiceProxyAgoWorldGeocodeServer)this._isWorldGeocodeServer=esri._isDefined(a.publishParameters.sourceCountry),a=a.publishParameters.sourceCountry||"world",this._countryCodes.set("value","wo"===a?"world":a,!1);this._analyzed="addressTypes"===e;this._createGrid(f);this._publishOnly&&this._updateUI(null,"csv");!this._allowGeocode&&"addressTypes"===e&&(e="none",b.query(".noGeocode").style("display","none"),b.query(".tableOnly").style("display",""));this.elementValue("geocode",
e);this.onChangeGeocode(e);this._gridConnects.push(b.connect(this._oStore,"onSet",b.hitch(this,function(a,b,c,e){"locationType"===b&&this._mStore.query({locationType:e}).forEach(function(b){b.name!==a.name&&(b=this._mStore.get(b.name),b.locationType="unknown",this._mStore.put(b),this._grid._fetch(0,!0))},this)})));this._gridConnects.push(b.connect(this._grid,"onApplyCellEdit",b.hitch(this,function(a,b,e){if("locationType"===e&&(a===c.standardizedFieldNames.Postal||a===this.i18n.addressFields.Postal))a=
this._grid.getItem(b),a.__isTypeUpdatedByUser||(a.type="esriFieldTypeString",a.__isTypeUpdatedByUser=!0,this._mStore.put(a))})))}else this._publishOnly&&this._showNoGeocodeDlg()},_getWMSLayers:function(a,c){!c.subLayers||!c.subLayers.length?a.push({name:c.name,visible:!1,title:c.title.replace(/ /g,String.fromCharCode(160)),extent:c.extent,legendURL:c.legendURL}):b.forEach(c.subLayers,b.hitch(this,"_getWMSLayers",a))},_getThumbnail:function(a,c){var e=new b.Deferred;if(a.thumbnailURL)return e.resolve(a.thumbnailURL),
e;if("MapServer"!==a.type&&"FeatureServer"!==a.type&&"ImageServer"!==a.type)return e.resolve(null),e;if("MapServer"===a.type||"ImageServer"===a.type||-1!==a.url.indexOf("MapServer")){var f=a.serviceInfo||{},d=a.extent||{},g=a.url||c.url,h=this._extent2String(a.extent);e.resolve(d?arcgisonline.map.main.buildExportCall(g,h,null,null,"200,133",null,"image",null,f):null);return e}e=c.extent.split(",");return arcgisonline.map.thumbnail.buildThumbnailURLFromFSUrl(a.url,[[parseFloat(e[0]),parseFloat(e[1])],
[parseFloat(e[2]),parseFloat(e[3])]])},_project:function(a,c){var e=new b.Deferred,f=b.hitch(this,function(a){e.resolve(a&&a.length&&a[0]&&a[0].type&&"extent"===a[0].type?a[0]:null)}),d=new esri.geometry.Extent(a);arcgisonline.map.main.projectExtent(d,c,f,f);return e},_projectExtent2WGS84:function(a){var c=this.item.extent||{},e=c.spatialReference&&(c.spatialReference.wkid||c.spatialReference.wkt),f=new esri.SpatialReference({wkid:4326}),d=new b.Deferred;if(e&&!arcgisonline.map.main.sameSpatialReference(f,
c.spatialReference))return this._project(c,f).then(b.hitch(this,function(b){a.extent=this._extent2String(b);return a}));a.extent=this._extent2String(c);d.resolve(a);return d},_showItem:function(a){if(!a||a.error)return this._showError(a);esri.hide(this.dialog&&this.dialog.domNode);a.id?window.location="item.html?id\x3d"+a.id+(a.jobId?"\x26jobid\x3d"+a.jobId:"")+(a.buildCache?"\x26buildCache\x3dtrue":""):a&&a.length&&this._showServiceResultsDlg(a);this.item&&(this.item.id=null);this.dialog&&this.dialog.hide()},
_showServiceResultsDlg:function(a){var c=b.doc.createDocumentFragment(),e=b.create("div",{"class":"esriAGOServicesDlg esriItemLinks"},c,"first"),f=b.create("ul",null,e),d;b.forEach(a,b.hitch(this,function(a){esri.isDefined(a.error)?(a.type="Map Service"===a.type?"Tile Layer":"Feature Layer",a.error&&(a.error.message&&-1<a.error.message.indexOf("already exist"))&&(a.error.message=this.i18n.errors.serviceDefinitionExists.message),b.create("li",{innerHTML:esri.substitute(b.mixin(a,{error:a.error.message}),
this.i18n.publishServicesError)},f)):(d="item.html?id\x3d"+a.id+(a.jobId?"\x26jobid\x3d"+a.jobId:"")+("Map Service"===a.type?"\x26showManageTiles\x3dtrue":""),a=b.mixin(a,{linkTitle:this.i18n["Map Service"!==a.type?"publishServiceView":"publishServiceBuild"],itemUrl:d}),a.type="Map Service"===a.type?"Tile Layer":"Feature Layer",b.create("li",{innerHTML:esri.substitute(a,this.i18n.publishServicesSuccess)},f))}));a=(new l.Dialog).placeAt(b.body());a.set({title:this.i18n.publishServicesTitle,content:c});
a.show();var g=b.connect(a,"onHide",this,function(){b.disconnect(g);b.publish("itemAdded",[])})},_fetchCountryCodes:function(){var a=[],b=esriGeowConfig.self||{},b=(b=(b.user||{}).region||b.ipCntryCode||"")&&"wo"===b.toLowerCase()?"world":b,e;for(e in this.countryCodes)a.push({label:this.countryCodes[e],value:e.toLowerCase()});a=a.sort(function(a,b){return a.label<b.label?-1:a.label>b.label?1:0});this._countryCodes.set("options",a);this._countryCodes.set("value",this.countryCodes[b]?b.toLowerCase():
"world",!1);this._sourceCountry=b.toLowerCase()},_fetchItemData:function(a){return this._request(this._contentUri+"/items/"+a.id+"/data")},_fetchOpExtension:function(a){var c=new b.Deferred;this.disable(null,this.i18n.fetchOpExtension);b.query(".opextwarningmsg",this.domNode).style("display","none");esri.request({url:a,handleAs:"json"},{useProxy:!1}).then(b.hitch(this,function(a){this.enable();c.resolve(a)}),b.hitch(this,function(a){a&&(a.message&&-1<a.message.indexOf("Unexpected string"))&&(a=this.i18n.errors.opExtensionInvalidJson);
this._showError(a);this.enable();c.cancel()}));return c},_request:function(a,c,e,f,d){c=b.mixin(b.mixin({},this._requestParams),c||{});var g=this._util.request({url:a,content:c},e);g.then(b.hitch(this,function(a){return a.error?this._showError(a.error):a}),b.hitch(this,function(a){if(this._isPortal&&a.message&&-1<a.message.indexOf("ERROR 001551"))throw this._analyzeError=!0,this._basicStandby.hide(),this.enable(),a;d?d(a):this._showError(b.mixin(a,{code:"timeout"===a.dojoType?408:a.code,message:a.message,
details:a.details}),g)}));return g},_uploadFile:function(a,c,e){var f=b.mixin({},this._requestParams),d=this._util.request({url:c,content:f,form:a,timeout:0});d.then(b.hitch(this,function(a){b.destroy(e);return a.error?this._showError(a.error):a}),b.hitch(this,function(a){b.destroy(e);return this._showError(a,d)}));return d},_checkStatus:function(a,c,e,f){a||e();this._request(this._userContentUri+"/items/"+a.id+"/status").then(b.hitch(this,function(d){d=d||{status:"failed"};if("completed"===d.status)return c(a);
if("failed"===d.status||""===d.status)return d&&d.statusMessage&&0<d.statusMessage.indexOf("Invalid Shapefile")?d.statusMessage=esri.substitute({name:a.item},this.i18n.errors.invalidShapefile.message):d&&(d.statusMessage&&0<d.statusMessage.indexOf("Invalid File Geodatabase"))&&(d.statusMessage=esri.substitute({name:a.item},this.i18n.errors.invalidFileGeodatabase.message)),e({message:d.statusMessage||this.i18n.errors.error});f=(f||500)+250;setTimeout(b.hitch(this,function(){this._checkStatus(a,c,e,
f)}),f)}),e)},_getFileAndType:function(){if(window.FileReader&&b.byId("file").files[0].size>this._maxFileSize)return this._showError(this.i18n.errors.fileToLarge);var a=/(?:\.([^.]+))?$/,c=b.byId("file").value.replace(/^.*(\\|\/|:)/,""),a=c?a.exec(c)[1].toLowerCase():"",e=c?c.substring(0,c.lastIndexOf(".")):"";if(this.item&&this.item.type&&"desktopapplication"===this.item.type){this.item.type="desktopapplication";this.item.item=c;this.item.name=c;this.elementValue("title",e);this.item.isZip="zip"===
a;if("zip"===a){this._itemExists({item:c,title:e,name:c,type:this.item.type});return}return this._showError({message:this.i18n.fileZipFormat})}"xml"===a&&-1!==c.indexOf(".rft.xml",c.length-8)&&(a="rft",e=c?c.substring(0,c.lastIndexOf(".rft.xml")):"");if("tpk"===a&&-1<c.indexOf("-"))return this.item={error:this.i18n.errors.invalidFileTitle},this._showError({message:this.i18n.errors.invalidFileTitle.message});this.deleteGrid();this._updateUI("zip","title");this._updateUI("csv");this._updateUI("shapefile");
this._updateUI("servicedefinition");this._updateUI("publish");this._updateUI("codesample");this._updateUI("arcpadpackage");this._updateUI("stylx");this.item={};a="sd"===a?"servicedefinition":a;a="tpk"===a?"tilepackage":a;a="spk"===a?"scenepackage":a;a="vtpk"===a?"vectortilepackage":a;this.item.type=a;this.item.item=c;this.item.isFile=!0;this.item.fileExtension=a;this.elementValue("title",e);b.attr(this._enablePublishingLabel,"innerHTML",this.i18n["servicedefinition"===a?"publishServiceDef":"tilepackage"===
a?"publishTilePackage":"vectortilepackage"===a?"publishVectorTilePackage":"scenepackage"===a?"publishScenePackage":"publishService"]);var f=!0,d=!0,g=!0,h=!0;if(this.allowPublish||this._allowPublishChanged){this._allowPublishChanged&&(this.allowPublish=!0,this._allowPublishChanged=!1);if(("shapefile"===a||"csv"===a||"geojson"===a||"json"===a||"zip"===a&&("shapefile"===this.elementValue("archiveSelect")||"filegeodatabase"===this.elementValue("archiveSelect")))&&!this._roleCanPublishFeatures)this.allowPublish=
d=f=!1,this._allowPublishChanged=!0;"tilepackage"===a&&!this._roleCanPublishTiles&&(this.allowPublish=h=f=!1,this._allowPublishChanged=!0);"scenepackage"===a&&!this._roleCanPublishScenes&&(this.allowPublish=g=f=!1,this._allowPublishChanged=!0);"servicedefinition"===a&&(!this._roleCanPublishFeatures&&!this._roleCanPublishTiles?(this.allowPublish=h=d=f=!1,this._allowPublishChanged=!0):(this._roleCanPublishFeatures||(d=!1),this._roleCanPublishTiles||(h=!1)))}this._enablePublishing.set("value",f);if(this._itemExists({item:c,
title:e,name:c,type:this.item.type}))return!1;if("zip"===a){a=this.elementValue("archiveSelect");this.item.type=a;if(this._itemExists({item:c,title:e,name:c,type:this.item.type,isFile:!0,fileExtension:"ZIP"}))return;this._updateUI("app","zip");this._updateUI(null,this.allowPublish&&a in this._publishTypes&&d?a:null);this._updateUI(null,this.allowPublish&&a in this._publishTypes&&d?"publish":null)}else if("csv"===a&&this.allowPublish&&d&&this._publishTypes.csv)this._basicStandby.show(),this._addFile();
else if(("geojson"===a||"json"===a)&&this.allowPublish&&(d||h))this._updateUI(null,"publish"),this._updateUI(null,a);else if(("servicedefinition"===a||"geojson"===a||"json"===a)&&this.allowPublish&&(d||h))this._updateUI("title","publish"),this._updateUI(null,a);else if("tilepackage"===a)this.allowPublish&&h&&(this._updateUI(null,"publish"),this._updateUI(null,a));else if("scenepackage"===a)!this._isPortal&&!esriGeowConfig.publishPackagesOnline?this.publish=!1:this.allowPublish&&g&&(this._updateUI(null,
"publish"),this._updateUI(null,a));else if("vectortilepackage"===a)!this._isPortal&&!esriGeowConfig.publishPackagesOnline?this.publish=!1:this.allowPublish&&h&&(this._updateUI(null,"publish"),this._updateUI(null,a));else if("opcenteraddin"===a){if(this._user&&"account_admin"!==this._user.role&&"account_publisher"!==this._user.role)return this._showError(this.i18n.errors.insuffientPrivs)}else if("stylx"===a)this._updateUI(null,"stylx"),this._updateUI(null,"file");else if(this.itemInfo[a])this._updateUI(null,
"file");else return this._showError({message:this.i18n.errors.unknownType.message});return{file:c,type:a}},_getUrlAndType:function(){var a=/(http|https|ftp):\/\/?/,c=/http.+\/(arcgis\/rest\/services|\/.*\/rest\/services|arcgis\/services)\/?/ig,e=/(\/(MapServer|GeocodeServer|GPServer|GeometryServer|ImageServer|NAServer|FeatureServer|GeoDataServer|GlobeServer|MobileServer|WMServer|SceneServer|VectorTileServer|StreamServer)).*/ig,f=this.elementValue("url"),d=-1<f.indexOf("MapServer/dynamicLayer?")?f.replace(/(?:&f=html)|(?:&f=json)|(?:\?f=html)|(?:\?f=json)/,
""):f.split("?")[0],g;"/"==d.substr(-1)&&(d=d.substr(0,d.length-1));"opext"===this._getRadioButtonValue("app")&&(b.query(".opextwarningmsg",this.domNode).style("display","none"),this.elementValue("title",""));this.deleteGrid();this._updateUI("svcauth","all");this._updateUI(null,"storecredentials");this.item&&this.item.serviceInfo&&(this.item.serviceInfo=null);if(d){a.exec(d)||this.elementValue("url",d="http://"+d);this.item=this.item||{};if("url"===this.elementValue("itemType"))if(g=d.replace(/^.*\//,
"").replace(/.[^.]*$/,""),a=this._getRadioButtonValue("web"),this.item.type=a,"ags"===a){g=d.replace(e,"").replace(/^.*\//,"").replace(/\?.*$/,"");a=(c=d.replace(c,"").match(e))&&c.length?c[0].split("/")[1]:null;if(!a||"SceneServer"===a&&!esriGeowConfig.sceneViewerEnabled)return c=esri.substitute({portalName:esriGeowConfig.portalName||this.i18n.portalName},this.i18n.errors.unknownAGSType.message),this._showError({message:c});c=c.length?c[0].split("/")[2]:null;"MapServer"===a&&!isNaN(c)&&(a="FeatureServer");
this.item.type=a;if((esriGeowConfig.allSSL||"https:"===location.protocol)&&(this._util.isHostedService(d)||this._util.supportsHttps(d)))d=d.replace("http:/","https:/");this.disable(!1,this.i18n.fetching);this._serviceInfoPane.getIsSecured(d).then(b.hitch(this,function(a){if(a.secured)this._serviceInfoPane.isFederatedWithWebTierAuth(d,a).then(b.hitch(this,function(c){if(!c&&401!==a.httpStatusCode)this.item.isSecured=a,this._updateUI("nosvcauth","svcauth"),this._updateUI(null,"storecredentials"),a.isOverride&&
this._storeAuth.set("checked",!0),this._serviceInfoPane.get("userInfo")&&this._getServiceInfo(d),this.enable();else return-1===c?(this.item.isSecured=!1,this.item.checkUrlError=!0,this._storeAuth.set("checked",!1)):this.item=b.mixin(this.item,{isSecured:{httpStatusCode:401,isFederatedWithWebTierAuth:c}}),this._getServiceInfo(d)}));else return this._getServiceInfo(d)}),b.hitch(this,function(a){this.item.isSecured=!1;this.item.checkUrlError=!0;this._storeAuth.set("checked",!1);return this._getServiceInfo(d)}))}else{if("ogc"===
a)return this._basicStandby.show(),this.disable(!1,this.i18n.fetching),this._getOGCServiceInfo(this.elementValue("url"),g).then(b.hitch(this,"_loadOGC"))}else g=d.replace(/^.*\//,"").replace(/.[^.]*$/,""),this.item.type=this._getRadioButtonValue("app"),"opext"===this.item.type&&(-1===d.indexOf(".json",d.length-5)?this._showError({message:this.i18n.errors.opExtensionNotJson}):this._fetchOpExtension(d).then(b.hitch(this,function(a){this._opExtensionInfo=a;this._validateOpExtension(a)&&(g=a&&(a.name||
a.title||g),this.elementValue("title",decodeURI(g)))})));this.item.url=d;this.elementValue("title",decodeURI(g))}},_getDefaultPublishParameters:function(a){var c=a.type.toLowerCase(),e={itemId:a.id,filetype:c};e.filetype="servicedefinition"===c?"serviceDefinition":"tilepackage"===c?"tilePackage":"scenepackage"===c?"scenePackage":"json"===c?"geojson":c;if("servicedefinition"!==c&&"tilepackage"!==c&&"scenepackage"!==c&&"vectortilepackage"!==c)e.publishParameters=b.mixin(a.csvInfo&&a.csvInfo.publishParameters||
a.publishParameters||{},{hasStaticData:!0,name:this.elementValue("title").replace(/ /g,"_"),maxRecordCount:2E3}),e.publishParameters.layerInfo=b.mixin(e.publishParameters.layerInfo||{},{capabilities:"Query"}),"csv"===c&&(e.publishParameters.persistErrorRecordsForReview=!0);else{if("tilepackage"===c||"scenepackage"===c||"vectortilepackage"===c)e.publishParameters=b.mixin(a.publishParameters||{},{name:this.elementValue("title").replace(/ /g,"_"),maxRecordCount:2E3}),"scenepackage"===c?e.outputType=
"sceneService":"vectortilepackage"===c&&(e.outputType="VectorTiles");e.buildInitialCache="tilepackage"===c||("vectortilepackage"===c||"scenepackage"===c)&&!this._isPortal}return e},_getSpatialReference:function(a){var b=a.serviceInfo||{};if(a="ImageServer"!==a.type?b.spatialReference:b.extent&&b.extent.spatialReference){if(a.wkid)return a.wkid;if(a.wkt&&-1!==a.wkt.search(/^PROJCS/i))return/^PROJCS\["[A-Za-z0-9_]*/i.exec(a.wkt)[0].split("[")[1]}return null},_extent2String:function(a,c){c=c||4;var e=
"";if(a&&this._isValidNum(a.xmin)&&this._isValidNum(a.ymin)&&this._isValidNum(a.xmax)&&this._isValidNum(a.ymax))var e=b.number.round(a.xmin,c),f=b.number.round(a.ymin,c),d=b.number.round(a.xmax,c),g=b.number.round(a.ymax,c),e=!isNaN(e)&&!isNaN(f)&&!isNaN(d)&&!isNaN(g)?e+","+f+","+d+","+g:"";return e},_checkProtocol:function(){return-1===window.location.protocol.toLowerCase().indexOf("https")&&(this._cookie=this._cookie||this._util.getCookie("esri_auth"))&&this._cookie.auth_tier&&"web"===this._cookie.auth_tier.toLowerCase()?
(this._showReloadDlg(),!1):!0},_isValidNum:function(a){return!isNaN(a)&&void 0!==a&&null!==a?!0:!1},_updateUI:function(a,c){a&&b.query("."+a).style("display","none");if(c){if(!this._publishOnly&&"csv"===c)b.place(this._publishNode,this._publishCSVDiv,"first"),esri.show(this._publishCSVDiv),esri.hide(this._publishServiceDiv);else if(!this._publishOnly&&("json"===c||"geojson"===c||"shapefile"===c||"servicedefinition"===c||"filegeodatabase"===c))b.place(this._publishNode,this._publishServiceDiv,"first"),
esri.show(this._publishServiceDiv),esri.hide(this._publishCSVDiv);b.query("."+c).style("display","");"csv"===c&&!this._allowGeocode&&(b.query(".portal").style("display","none"),b.query(".noGeocode").style("display",""))}esriGeowConfig.userRole&&!this._roleCanCreateItem&&l.byId("addItem-btn").set("disabled",!0);b.query(".esriAGOAddItemForm").style("height","auto");this.dialog.resize()},_itemExists:function(a){var c=this.existingItems||[],e=this.itemInfo[a.type.toLowerCase()]?this.itemInfo[a.type.toLowerCase()].type:
a.type;return(c=b.filter(c,function(b){b.item=b.name||b.title;a.item=(a.name?a.name.replace(" ","_"):a.name)||a.title||a.url;return b.type===e&&(b.name===a.item||b.item===a.item||b.title===a.title)}))&&c.length?(c=!this.item.isFile?esri.substitute({type:c[0].type,item:a.item,title:c[0].title},this.i18n.errors.itemExists.message):esri.substitute({type:a.fileExtension,item:a.item,name:c[0].name,title:c[0].title},this.i18n.errors.itemExistsFile.message),!this._showError({message:c})):!1},_serviceNameAvailable:function(a){a=
"tilepackage"===a.type?"Map Service":"scenepackage"===a.type?"Scene Service":"vectortilepackage"===a.type?"Vector Tile Service":"Feature Service";a={name:this.elementValue("title").split(" ").join("_"),type:a};this.disable(["addItem","cancel"]);return this._request(this._portalUrl+"/"+esriGeowConfig.self.user.accountId+"/isServiceNameAvailable",a).then(b.hitch(this,function(a){return a.available?!0:this._showError(this.i18n.errors.serviceNameExists)}))},_loadConnections:function(){esriGeowConfig.isRightToLeft&&
(9>b.has("ie")||5>b.has("trident"))&&this._tags._textTags.set("placeHolder","");b.subscribe("onSelectedTagsUpdate",b.hitch(this,function(a){var b=this._tags.get("tags");a=b?a.split(",").concat(b.split(",")):a.split(",");this._tags.set("tags",this._unique(a).join(","))}));9>b.isIE&&b.query(".radio").connect("onclick",b.hitch(this,function(a){if(a.focusNode?b.attr(a.focusNode,"checked"):1)b.forEach(this.formWidgets[(a.target||a.srcElement).name].widget,b.hitch(this,function(a){b.forEach(a.observer.split(/[ ,]+/),
b.hitch(this,function(b){if(!1!==a.get("value"))this[b](a.get("value"))}))}))}));b.connect(this._tagsLbl,"onclick",b.hitch(this,function(a){this._tags._inputTextBox.focus();b.query(".select2-choices",this._tags.domNode).addClass("focus")}));b.connect(this._tags.domNode,"onfocusout",b.hitch(this,function(a){b.query(".select2-choices",this._tags.domNode).removeClass("focus")}));b.connect(this._tags.domNode,"onfocusin",b.hitch(this,function(a){b.query(".select2-choices",this._tags.domNode).addClass("focus")}));
this._dlgConnect=b.connect(this.dialog,"hide",b.hitch(this,function(){this.deleteGrid();b.forEach([this._fileInputConnect,this._dlgConnect,this._credentialConnect].concat(this._gridConnects),b.disconnect);this._basicStandby.destroy();this.destroy()}));this._dlgConnect=b.connect(this._geocoderSelect,"onChange",b.hitch(this,this.onChangeGeocoder));var a=arcgisonline.sharing.dijit.HelpManager.prototype.statics.getInstance(),c=setInterval(b.hitch(this,function(){a.isLoaded()&&(clearInterval(c),this.learnMore.href=
a.getHelpUrl("120000597"))}),200);this._fileInputConnect=b.connect(b.byId("file"),"onchange",b.hitch(this,"_getFileAndType"));this._gridConnects=[];esri.id.setProtocolErrorHandler(b.hitch(this,"_showReloadDlg"))},_getRadioButtonValue:function(a){var c;return 9>=b.isIE?(b.some(this.formWidgets[a].widget||[],function(a){return a.get("checked")?(c=a,!0):!1}),c?c.get("value"):""):this.elementValue(a)},_unique:function(a){var c={};return b.filter(a,function(a){return!a||c[a]?!1:c[a]=!0})},_stripParameters:function(a,
c){var e=esri.urlToObject(a),f=[],d;for(d in e.query)-1===b.indexOf(c,d.toLowerCase())&&f.push(d+"\x3d"+e.query[d]);return e.path+(f.length?"?"+f.join("\x26"):"")},_checkThumbnailURL:function(a){a.thumbnailURL&&(a.thumbnailURL=this._util.getStaticImagesUrl()+a.thumbnailURL);arcgisonline.sharing.util.isPortal()&&(a.thumbnailURL&&!a.thumbnailURL.startsWith("http"))&&(a.thumbnailURL=window.location.protocol+"//"+window.location.host+a.thumbnailURL);return a},_toSelectOptions:function(a,b){var e=[],f=
[],d;for(d in a)e.push(a[d]),f.push(d);return{formatter:function(d){return a[d]||a[b]},options:e,values:f}},_showReloadDlg:function(){this._reload=!0;if(window.location&&-1===window.location.protocol.indexOf("https:")){var a={title:this.i18n.reloadTitle,message:"\x3cp\x3e"+this.i18n.reloadMessage+"\x3c/p\x3e",choiceOneTitle:this.i18n.yesLabel,choiceTwoTitle:this.i18n.noLabel,choiceOneHandler:b.hitch(this,function(){window.location=window.location.href.replace("http:","https:")}),choiceTwoHandler:b.hitch(this,
function(){this._choiceDlg.hide()})};this._choiceDlg.show(a);return!1}},_showNoGeocodeDlg:function(){var a=b.connect(this._errorDlg,"onHide",b.hitch(this,function(){b.disconnect(a);this.onCancel()})),c=b.mixin({},this.i18n.errors.error,{message:!this._roleCanUseGeocode?this.i18nCommon.errors.noGeocodingRole:this.i18nCommon.errors.noBatchGeocoding});this._errorDlg.show(c)},_showError:function(a,c){if(!c||!c.canceled){a=a.error||a||{};a.code=a.code||0;a=this.i18n.errors[a.code]||a;a.details=a.details&&
b.isArray(a.details)&&a.details.length?b.filter(a.details,"return item !\x3d\x3d null"):null;a.details&&a.details.length&&(a.details=a.details.join("\x3cbr /\x3e"),a.message=a.message?a.message+"\x3cbr /\x3e"+a.details:a.details);var e=b.mixin(b.mixin({},this.i18n.errors.error),a);this._errorDlg.show(e)}this._basicStandby.hide();this.enable();return!1}})});