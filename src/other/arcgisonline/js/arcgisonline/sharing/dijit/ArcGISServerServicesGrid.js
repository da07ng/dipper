// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/ArcGISServerServicesGrid",["dijit","dojo","dojox","dojo/require!dijit/_Widget,dojo/data/ItemFileReadStore,dojox/grid/DataGrid,dojox/rpc/Service,dojo/rpc/JsonService,arcgisonline/sharing/util"],function(h,b,q){b.provide("arcgisonline.sharing.dijit.ArcGISServerServicesGrid");b.require("dijit._Widget");b.require("dojo.data.ItemFileReadStore");b.require("dojox.grid.DataGrid");b.require("dojox.rpc.Service");b.require("dojo.rpc.JsonService");b.require("arcgisonline.sharing.util");
b.declare("arcgisonline.sharing.dijit.ArcGISServerServicesGrid",[h._Widget],{i18n:null,id:"arcgisServerServicesGrid",grid:null,servicesItems:[],allItemsByIdentity:{},cleared:!1,url:"",lastURL:"",baseUrl:"",width:100,lastQueryString:"",lastResultCount:-1,timerArray:[],lastOpenDropDown:null,gridScrollBox:null,scrollTopPos:0,listExpanded:!1,layerAddedHandler:null,layerAddFailedHandler:null,layerAddedIds:[],_eventConnections:[],_util:arcgisonline.sharing.util,constructor:function(a,c){null!=a&&a.w&&(this.width=
a.w)},postMixInProperties:function(){this.inherited(arguments);this.i18n=b.i18n.getLocalization("arcgisonline","arcgisonline").common;b.mixin(this.i18n,b.i18n.getLocalization("arcgisonline","arcgisonline").arcGISServerServices)},postCreate:function(){this.createGrid()},createGrid:function(){this.grid=new q.grid.DataGrid({structure:[[{get:arcgisonline.sharing.dijit.ArcGISServerServicesGrid.formatters.name,formatter:arcgisonline.sharing.util.fix,width:"auto"},{get:arcgisonline.sharing.dijit.ArcGISServerServicesGrid.formatters.blank,
formatter:arcgisonline.sharing.util.fix,width:"10px"}]],rowsPerPage:20,noDataMessage:"\x3cspan style\x3d'font-size:1em;color:#7a7979;'\x3e"+this.i18n.error.noMatch+"\x3c/span\x3e",loadingMessage:'\x3cdiv class\x3d"throb-loading-grid"\x3e\x3cdiv class\x3d"throb-loading-grid-text"\x3e'+this.i18n.loadingShort+"\x3c/div\x3e\x3c/div\x3e",region:"center",id:"arcgisServerServicesNode",selectionMode:"none",style:"width:"+this.width+"px"});container.addChild(this.grid);this.grid.startup();var a=this.i18n.specifyUrl;
esriGeowConfig.addContentSecurityText&&0<esriGeowConfig.addContentSecurityText.length&&(a+="\x3cbr/\x3e\x3cbr/\x3e"+esriGeowConfig.addContentSecurityText);this.grid.showMessage("\x3cspan style\x3d'font-size:1em;color:#7a7979;'\x3e"+a+"\x3c/span\x3e");b.style(this.grid.messagesNode,"height","100%");this.gridScrollBox=this.grid.views.views[0].scrollboxNode;b.connect(this.grid,"onRowClick",b.hitch(this,"onRowClick"));esri.isTouchEnabled&&(a=esri.setScrollable(this.gridScrollBox),this._eventConnections.push(a[0],
a[1]))},servicesToStore:function(a){var c=this.lastQueryString.toLowerCase(),e=this.baseUrl.indexOf("http://"),d=this.baseUrl.substring(e+7,this.baseUrl.length),e=d.indexOf("/"),d=d.substring(0,e);b.forEach(a,function(a,e){if("mapserver"==a.type.toLowerCase()||"imageserver"==a.type.toLowerCase()||"featureserver"==a.type.toLowerCase())if(0<this.lastQueryString.length&&-1<a.name.toLowerCase().indexOf(c)||0==this.lastQueryString.length){var b=a.name,h="",p=b.lastIndexOf("/");-1<p&&(h=b.substring(0,p),
b=b.substring(p+1,b.length));b={id:"srv_"+d+"_"+this.servicesItems.length+1,fullName:a.name,name:b,folder:h,title:b+("featureserver"==a.type.toLowerCase()?" (Feature Service)":""),url:this.baseUrl,fullUrl:a.url,type:a.type,status:"new"};this.servicesItems[this.servicesItems.length]=b;this.allItemsByIdentity[b.id]||(this.allItemsByIdentity[b.id]=b)}},this);a={identifier:"id",label:"item",items:this.servicesItems};b.publish("gridCount",[this.servicesItems.length,"GIS"]);return new b.data.ItemFileReadStore({data:a})},
destroy:function(){this.inherited(arguments);b.forEach(this._eventConnections,b.disconnect)},emptyStore:function(){this.servicesItems=[];this.lastResultCount=-1;var a=new b.data.ItemFileReadStore({data:{identifier:"name",label:"item",items:this.servicesItems}});this.grid.setStore(a);this.url.length||this.grid.showMessage("\x3cspan style\x3d'font-size:1em;color:#7a7979;'\x3e"+this.i18n.specifyUrl+"\x3c/span\x3e")},newSearch:function(a){this.getServices(this.url,a)},getServices:function(a,c){this.layerAddedHandler&&
b.unsubscribe(this.layerAddedHandler);this.layerAddFailedHandler&&b.unsubscribe(this.layerAddFailedHandler);this.emptyStore();this.allItemsByIdentity={};this.url=a;this.lastQueryString=c;if(0==this.url.length)this.grid.showMessage("\x3cspan style\x3d'font-size:1em;color:#7a7979;'\x3e"+this.i18n.specifyUrl+"\x3c/span\x3e");else if(this.url=this.checkUrl(this.url),null!=this.url){var e=b.connect(esri.id,"onDialogCancel",b.hitch(this,function(a){m&&clearTimeout(m);b.disconnect(e);g||(g=!0,this.grid.showMessage("\x3cspan style\x3d'font-size:1em;color:#7a7979;'\x3e"+
this.i18n.error.notAuthorized+"\x3c/span\x3e"))})),d=this.grid,g=!1,m=setTimeout(b.hitch(this,function(a){if(!esri.id.isBusy()&&this.lastUrl===a)if(g=!0,-1==a.toLowerCase().indexOf("/arcgis/")&&-1<a.toLowerCase().indexOf("/rest/services")){var b=a.indexOf("/rest/services");a=a.substring(0,b)+"/arcgis"+a.substring(b,a.length);h.byId("arcgisServerServicesGrid").getServices(a,c)}else-1<a.toLowerCase().indexOf("/arcgis/rest/services/")?(b=a.lastIndexOf("/"),a=a.substring(0,b),h.byId("arcgisServerServicesGrid").getServices(a,
c)):d.showMessage("\x3cspan style\x3d'font-size:1em;color:#7a7979;'\x3e"+this.i18n.error.badUrl+"\x3c/span\x3e")},a),1E4);this.lastUrl=a=this.url;this.grid.showMessage('\x3cdiv class\x3d"throb-loading-grid"\x3e\x3cdiv class\x3d"throb-loading-grid-text"\x3e'+this.i18n.loadingShort+"\x3c/div\x3e\x3c/div\x3e");var k=this.url,l="";arcgisonline.sharing.util.isHostedService(k)&&(l=arcgisonline.sharing.util.getToken(),k+=l?(-1==k.indexOf("?")?"?":"\x26")+"token\x3d"+l:"");this.getJson(k,b.hitch(this,function(a,
c){m&&clearTimeout(m);e&&b.disconnect(e);if(!g&&-1!=c.args.url.indexOf(this.lastUrl))if(a.services){this.searchFolders(a.folders,this.url);var d=this.servicesToStore(a.services);(!a.folders||0==a.folders.length)&&this.grid.setStore(d);b.publish("ArcGISServerServicesSearchSuccess",[this.url])}else if(null!==a.description){var d=c.args.url,d=d.substring(0,d.indexOf("?")),k=d.lastIndexOf("/"),h=d.substring(k+1,d.length);if("mapserver"==h.toLowerCase()||"imageserver"==h.toLowerCase()||"featureserver"==
h.toLowerCase()){var l=d,l=l.substring(this.baseUrl.length+1,l.length),k=l.lastIndexOf("/"),l=l.substring(0,k),k=[];k.push({name:l,type:h,url:d});d=this.servicesToStore(k);this.grid.setStore(d);b.publish("ArcGISServerServicesSearchSuccess",[this.url])}else this.grid.showMessage("\x3cspan style\x3d'font-size:1em;color:#7a7979;'\x3e"+this.i18n.error.badUrl+"\x3c/span\x3e")}else this.grid.showMessage("\x3cspan style\x3d'font-size:1em;color:#7a7979;'\x3e"+this.i18n.error.badUrl+"\x3c/span\x3e")}),b.hitch(this,
function(a,d){m&&clearTimeout(m);e&&b.disconnect(e);if(!g)if("https:"===document.location.protocol&&0===this.url.indexOf("http:"))this.grid.showMessage("\x3cspan style\x3d'font-size:1em;color:#7a7979;'\x3e"+this.i18n.error.badUrl+"\x3c/span\x3e");else if(-1==this.url.toLowerCase().indexOf("/arcgis/")&&-1<this.url.toLowerCase().indexOf("/rest/services")){var f=this.url.indexOf("/rest/services"),f=this.url.substring(0,f)+"/arcgis"+this.url.substring(f,this.url.length);h.byId("arcgisServerServicesGrid").getServices(f,
c)}else-1<this.url.toLowerCase().indexOf("/arcgis/rest/services")?(f=this.url.lastIndexOf("/"),f=this.url.substring(0,f),h.byId("arcgisServerServicesGrid").getServices(f,c)):this.grid.showMessage("\x3cspan style\x3d'font-size:1em;color:#7a7979;'\x3e"+this.i18n.error.noMatch+"\x3c/span\x3e")}));return this.url}},searchFolders:function(a,c){if(a)for(var e=b.hitch(this,"searchFolders"),d=b.hitch(this,"servicesToStore"),g=this.grid,h=function(c,b){if(k==a.length-1){var e=d([]);g.setStore(e)}else k++},
k=0,l=0;l<a.length;l++)esri.request({url:c+"/"+a[l]+"?f\x3djson",callbackParamName:"callback",load:function(c,b){if(c.error&&""!=c.error)h(c.error,b);else{var f=b.args.url.substring(0,b.args.url.length-7);e(c.folders,f);f=d(c.services);k==a.length-1?g.setStore(f):k++}},error:function(a,c){h(a,{args:c})}})},checkUrl:function(a){var c=a.toLowerCase();-1==c.indexOf("http://")&&-1==c.indexOf("https://")&&(a="http://"+a,c=a.toLowerCase());var b=c.indexOf("//"),b=c.indexOf("/",b+2);-1==b?(a+="/arcgis/rest/services",
c=a.toLowerCase()):b==c.length-1&&(a+="arcgis/rest/services",c=a.toLowerCase());var d=c.indexOf("/arcgis",b);d==c.length-7?(a+="/rest/services",c=a.toLowerCase()):d==c.length-8&&(a+="rest/services",c=a.toLowerCase());var d=c.indexOf("/rest/services",b),g=c.indexOf("/services",b),b=c.indexOf("/rest",b);-1==d&&-1<g?(a=a.substring(0,g)+"/rest/services"+a.substring(g+9),c=a.toLowerCase()):-1==d&&-1<b&&(a=a.substring(0,b)+"/rest/services"+a.substring(b+5),c=a.toLowerCase());if(-1==c.indexOf("/rest/services"))return this.grid.showMessage("\x3cspan style\x3d'font-size:1em;color:#7a7979;'\x3e"+
this.i18n.error.notServerUrl+"\x3c/span\x3e"),null;b=c.lastIndexOf("/");d=c.substring(b+1,c.length);if("mapserver"!=d&&("imageserver"!=d&&"featureserver"!=d)&&"wmsserver"!==d&&(g=a.substring(0,b),b=g.lastIndexOf("/"),d=g.substring(b+1,g.length).toLowerCase(),"mapserver"==d||"imageserver"==d||"featureserver"==d))a=g;c=c.indexOf("/rest/services");this.baseUrl=a.substring(0,c+14);return a},onRowClick:function(a){-1<a.target.id.indexOf("_title")&&(this.scrollTopPos=this.gridScrollBox.scrollTop)},hide:function(){},
onMouseOver:function(a){if(!1==this.listExpanded){this.listExpanded=!0;var c=b.query(".dojoxGridContent","arcgisServerServicesNode");0<c.length&&b.style(c[0],"height",b.style(c[0],"height")+20+"px")}b.style(b.byId(a+"_addIcon"),"display","block")},onMouseOut:function(a){b.style(b.byId(a+"_addIcon"),"display","none")},tooltipInfo:function(a,c,e){if(h.byId(e+"_dropDownButton"))h.byId(e+"_dropDownButton")._openDropDown(b.byId(e+"_toolTipLaunch")),this.lastOpenDropDown=h.byId(e+"_dropDownButton"),this.gridScrollBox.scrollTop=
this.scrollTopPos;else{var d;d='\x3cdiv dojoType\x3d"dijit.TooltipDialog" style\x3d"width:350px;"\x3e'+('\x3cdiv style\x3d"float:right;"\x3e\x3cA href\x3d"JavaScript:dijit.byId(\''+this.id+"').hideTooltip('"+e+'\');" title\x3d"'+this.i18n.close+"\"\x3e\x3cimg src\x3d'"+this._util.relativeToExplicitUrl("images/close.gif")+'\' border\x3d"0"/\x3e\x3c/A\x3e\x3c/div\x3e');d+='\x3cdiv id\x3d"'+e+'_toolTip_message" class\x3d"tooltipLink" style\x3d"height:180px;"\x3e'+this.i18n.loadingShort+"\x3c/div\x3e";
d+="\x3c/div\x3e";b.parser.parse(b.byId(e+"_row"));h.byId(e+"_toolTip").set("content",d);h.byId(e+"_dropDownButton")._openDropDown(b.byId(e+"_toolTipLaunch"));this.lastOpenDropDown=h.byId(e+"_dropDownButton");this.gridScrollBox.scrollTop=this.scrollTopPos;var g=function(a,d){clearTimeout(m);console.log(a);var g="",g=a&&500==a.code?this.i18n.error.noResponse:b.string.substitute(this.i18n.error.inaccessible,{title:c});if(h.byId(e+"_toolTip_message"))h.byId(e+"_toolTip_message").set("content",g);else{var n;
n='\x3cdiv dojoType\x3d"dijit.TooltipDialog" style\x3d"width:350px;"\x3e'+('\x3cdiv style\x3d"float:right;"\x3e\x3cA href\x3d"JavaScript:dijit.byId(\''+this.id+"').hideTooltip('"+e+'\');" title\x3d"'+this.i18n.close+"\"\x3e\x3cimg src\x3d'"+this._util.relativeToExplicitUrl("images/close.gif")+'\' border\x3d"0"/\x3e\x3c/A\x3e\x3c/div\x3e');n+='\x3cdiv id\x3d"'+e+'_toolTip_message" class\x3d"tooltipLink" style\x3d"height:180px;"\x3e'+g+"\x3c/div\x3e";n+="\x3c/div\x3e";b.parser.parse(b.byId(e+"_row"));
h.byId(e+"_toolTip").set("content",n);h.byId(e+"_dropDownButton")._openDropDown(b.byId(e+"_toolTipLaunch"))}},m=setTimeout(function(){clearTimeout(m);g()},15E3);this.getJson(a,b.hitch(this,function(d,g){clearTimeout(m);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().hide();var p="",n="",f="";if(-1<a.indexOf("/MapServer")||-1<a.indexOf("/ImageServer")){null!=d.documentInfo&&(p=d.documentInfo.Author);f=arcgisonline.sharing.util.removeHTMLTags(d.serviceDescription);if((null==
f||0==f.length)&&null!=d.description&&0<d.description.length)f=d.description;n=150<f.length?b.string.substitute(this.i18n.shortenedText,{text:f.substring(0,150)}):f}f='\x3cdiv dojoType\x3d"dijit.TooltipDialog" style\x3d"width:350px;"\x3e'+('\x3cdiv class\x3d"esriFloatTrailing"\x3e\x3cA id\x3d"closeButton" href\x3d"JavaScript:dijit.byId(\''+this.id+"').hideTooltip('"+e+'\');" title\x3d"'+this.i18n.close+"\"\x3e\x3cimg src\x3d'"+this._util.relativeToExplicitUrl("images/close.gif")+'\' border\x3d"0"/\x3e\x3c/A\x3e\x3c/div\x3e');
f+='\x3cdiv class\x3d"tooltipTitle"\x3e'+c.replace(/\_/g," ")+"\x3c/div\x3e";f=f+"\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%'\x3e\x3ctr width\x3d'100%'\x3e\x3ctd width\x3d'160'\x3e"+('\t\x3cdiv id\x3d"'+e+'_item-thumbnail" class\x3d"esriWebThumbnail"\x3e\x3c/div\x3e');f+='\x3c/td\x3e\x3ctd width\x3d"15"\x3e';f+='\t\x3cdiv style\x3d"width:15px;"\x3e\x3c/div\x3e';f+='\x3c/td\x3e\x3ctd width\x3d"100%" valign\x3d"top"\x3e';f+="\t\x3cspan class\x3d\"tooltipLink\"\x3e\x3cA href\x3d\"JavaScript:dijit.byId('arcgisServerServicesGrid').addLayer('"+
a+"','"+e+"');dijit.byId('"+this.id+"').hideTooltip('"+e+"');\"\x3e"+this.i18n.addToMap+"\x3c/A\x3e\x3c/span\x3e";f+='  \x3cdiv style\x3d"height:7px;"\x3e\x26nbsp;\x3c/div\x3e';f+='\t\x3cspan class\x3d"tooltipLink"\x3e\x3cA href\x3d"JavaScript:arcgisonline.sharing.util.openPage(\''+a+"');\"\x3e"+this.i18n.serviceDetails+"\x3c/A\x3e\x3c/span\x3e";if(-1<a.indexOf("/MapServer")||-1<a.indexOf("/ImageServer"))f+='  \x3cdiv style\x3d"height:7px;"\x3e\x26nbsp;\x3c/div\x3e',f+='\t\x3cspan class\x3d"tooltipLink"\x3e\x3cA href\x3d"JavaScript:arcgisonline.map.save_open.switchBaseMapByUrl(\''+
a+"');dijit.byId('"+this.id+"').hideTooltip('"+e+"');\"\x3e"+this.i18n.useAsBasemap+"\x3c/A\x3e\x3c/span\x3e";f+="\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e";f+="\x3cbr /\x3e";null!=d.documentInfo&&(f+='\x3ctable\x3e\x3ctbody\x3e\x3ctr\x3e\x3ctd nowrap valign\x3d"top"\x3e',f+='\x3cspan class\x3d"tooltipTitle"\x3e'+this.i18n.authorLabel+"\x3c/span\x3e",f+="\x3c/td\x3e\x3ctd\x3e",f+='\x3cspan id\x3d"item-owner" style\x3d"padding-left:10px;"\x3e'+p+"\x3c/span\x3e",f+="\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e");
if(-1<a.indexOf("/MapServer")||-1<a.indexOf("/ImageServer"))f+='\x3cspan class\x3d"tooltipTitle" style\x3d"line-height:20px;"\x3e'+this.i18n.summaryLabel+"\x3c/span\x3e",f+="\x3cbr /\x3e",f+='\x3cdiv id\x3d"item-summary"\x3e'+n+"\x3c/div\x3e";f+="\x3c/div\x3e";b.parser.parse(b.byId(e+"_row"));h.byId(e+"_toolTip").set("content",f);h.byId(e+"_dropDownButton")._openDropDown(b.byId(e+"_toolTipLaunch"));-1<a.toLowerCase().indexOf("/featureserver")?this.getJson(a+"/"+d.layers[0].id,b.hitch(this,function(b,
c){this.getThumbnailImage(a,b,e)})):this.getThumbnailImage(a,d,e)}),b.hitch(this,g))}},getThumbnailImage:function(a,c,e){if(null!=b.byId(e+"_item-thumbnail")){var d=c.initialExtent;null==d&&(d=c.extent);d=""+Math.round(1E3*d.xmin)/1E3+","+Math.round(1E3*d.ymin)/1E3+","+Math.round(1E3*d.xmax)/1E3+","+Math.round(1E3*d.ymax)/1E3;if(-1<a.indexOf("/FeatureServer")){var g=null,h=a.indexOf("/FeatureServer/");-1==h?a=a.replace("/FeatureServer","/MapServer"):(g=a.substring(h+15,a.length),a=a.substring(0,h)+
"/MapServer");a=arcgisonline.map.main.buildExportCall(a,d,null,null,"150,100",null,"image",g,c)}else a=arcgisonline.map.main.buildExportCall(a,d,null,null,"150,100",null,"image",null,c);b.byId(e+"_item-thumbnail").innerHTML='\x3cspan id\x3d"'+e+'_item-thumbnail_span" style\x3d"width:150px;height:100px;background-image:url(\''+this._util.relativeToExplicitUrl("images/web-thumbnail-loading.png")+'\');background-repeat:no-repeat;display:inline-block;"\x3e\x3cimg src\x3d"'+a+'" id\x3d"'+e+'_item-thumbnail_img" border\x3d"0"/\x3e\x3c/span\x3e';
b.connect(b.byId(e+"_item-thumbnail_img"),"onload",b.hitch(this,"onImageLoad",e));this.timerArray[e]=setTimeout(b.hitch(this,"onImageLoadTimeout",e),1E4)}},onImageLoad:function(a){clearTimeout(this.timerArray[a]);b.byId(a+"_item-thumbnail_span").style.background="url('"+this._util.relativeToExplicitUrl("/images/transparent.gif")+"') top left no-repeat"},onImageLoadTimeout:function(a){b.style(b.byId(a+"_item-thumbnail_span"),"backgroundImage","url('"+this._util.relativeToExplicitUrl("images/web-thumbnail-error.png")+
"')")},hideTooltip:function(a){this.lastOpenDropDown&&this.lastOpenDropDown._closeDropDown();null==this.lastOpenDropDown},getJson:function(a,b,e){a=0<=a.indexOf("?")?a+"\x26f\x3djson":a+"?f\x3djson";esri.request({url:a,callbackParamName:"callback",load:function(d,g){arcgisonline.sharing.util.handler(d,g,a,b,e)},error:function(b,c){arcgisonline.sharing.util.errorHandler(b,c,a,e)}})},addLayer:function(a,c){this.disconnectHandlers();b.byId(c+"_link").innerHTML="\x3cspan style\x3d'color:#999;'\x3e\x3cdiv class\x3d'circularLoadingIcon esriFloatTrailing'\x3e\x3c/div\x3e\x3c/span\x3e";
this.layerAddedHandler=b.subscribe("layerAdded",b.hitch(this,"onLayerAdded",a,c));this.layerAddFailedHandler=b.subscribe("layerAddFailed",b.hitch(this,"onLayerAddFailed",c));arcgisonline.map.save_open.addServiceByUrl(a,null)},removeLayer:function(a,c,e){var d=this.allItemsByIdentity[c];d&&(d.status="new");this.disconnectHandlers();e=e.split(",");for(d=0;d<e.length;d++)b.byId(c+"_link").innerHTML="\x3ca href\x3d\"JavaScript:dijit.byId('arcgisServerServicesGrid').addLayer('"+a+"','"+c+"');\"\x3e"+this.i18n.add+
"\x3c/A\x3e",arcgisonline.map.layer.removeCompleteLayer(e[d])},onLayerAdded:function(a,c,e){this.layerAddedIds.push(e);if(e=this.allItemsByIdentity[c])e.status="added",e.layerAddedIds=this.layerAddedIds.toString();b.byId(c+"_link").innerHTML="\x3ca href\x3d\"JavaScript:dijit.byId('arcgisServerServicesGrid').removeLayer('"+a+"','"+c+"','"+this.layerAddedIds.toString()+"');\"\x3e"+this.i18n.remove+"\x3c/A\x3e"},onLayerAddFailed:function(a){if(0==this.layerAddedIds.length){var c=this.allItemsByIdentity[a];
c&&(c.status="unavailable");b.byId(a+"_link").innerHTML="\x3cspan style\x3d'color:#999;'\x3e"+this.i18n.unavailable+"\x3c/span\x3e"}},disconnectHandlers:function(){this.layerAddedIds=[];this.layerAddedHandler&&b.unsubscribe(this.layerAddedHandler);this.layerAddFailedHandler&&b.unsubscribe(this.layerAddFailedHandler)},clearList:function(){this.cleared=!0},runLastQuery:function(){this.cleared&&(this.cleared=!1,this.getServices(this.url,this.lastQueryString))}});arcgisonline.sharing.dijit.ArcGISServerServicesGrid.formatters=
{name:function(a,c){this.i18n=b.i18n.getLocalization("arcgisonline","arcgisonline").common;b.mixin(this.i18n,b.i18n.getLocalization("arcgisonline","arcgisonline").arcGISServerServices);if(!c)return this.defaultValue;var e=c.url+"/"+c.fullName+"/"+c.type;c.fullUrl&&1<c.fullUrl.length&&(e=c.fullUrl);var d="\x3cdiv id\x3d'"+c.id+"_row' class\x3d'listServiceTitle'\x3e",d=d+"\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%'\x3e\x3ctr width\x3d'100%'\x3e\x3ctd nowrap\x3d'nowrap'\x3e"+("  \x3cdiv id\x3d'"+
c.id+'_toolTipLaunch\' style\x3d"position:absolute; left:80px; top:10px; width:1px; height:1px; background: transparent;"\x3e\x3c/div\x3e'),d=d+("\t \x3cdiv style\x3d'overflow:hidden;'\x3e\x3ca id\x3d'"+c.id+"_title' href\x3d\"JavaScript:dijit.byId('arcgisServerServicesGrid').tooltipInfo('"+decodeURI(e)+"','"+decodeURI(c.title)+"','"+c.id+'\');" style\x3d"height:16px;"\x3e'+decodeURI(c.title)+"\x3c/a\x3e\x3c/div\x3e"),d=d+("\t \x3cdiv id\x3d'"+c.id+'_dropDownButton\' dojoType\x3d"arcgisonline.sharing.dijit.DropDownButton" style\x3d"display:none;line-height:5px;"\x3e\x3cspan\x3e\x26nbsp;\x3c/span\x3e'),
d=d+("\t\t\t\x3cdiv id\x3d'"+c.id+"_toolTip' dojoType\x3d'dijit.TooltipDialog'\x3e\x3c/div\x3e"),d=d+"\t \x3c/div\x3e",d=d+"\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",d=d+"\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%' class\x3d'bottomRowTable'\x3e\x3ctr width\x3d'100%'\x3e\x3ctd nowrap\x3d'nowrap'\x3e",g=c.folder;c.folder instanceof Array&&0<c.folder.length&&(g=c.folder[0]);d+="  \x3cspan class\x3d'esriAlignLeading' style\x3d'color:#656565;'\x3e"+(0<g.length?this.i18n.folderLabel:"")+
" "+g+"\x3c/span\x3e";d+="\x3c/td\x3e\x3ctd style\x3d'padding-right:5px;padding-left:3px;'\x3e";d="added"===c.status?d+(" \x3cdiv class\x3d'esriAlignTrailing' id\x3d'"+c.id+"_link'\x3e\x3ca href\x3d\"JavaScript:dijit.byId('arcgisServerServicesGrid').removeLayer('"+e+"','"+c.id+"','"+c.layerAddedIds+"');\"\x3e"+this.i18n.remove+"\x3c/A\x3e\x3c/div\x3e"):"unavailable"===c.status?d+("  \x3cdiv class\x3d'esriAlignTrailing' id\x3d'"+c.id+"_link'\x3e\x3cspan style\x3d'color:#999;'\x3e"+this.i18n.unavailable+
"\x3c/span\x3e\x3c/div\x3e"):d+("  \x3cdiv class\x3d'esriAlignTrailing' id\x3d'"+c.id+"_link'\x3e\x3ca href\x3d\"JavaScript:dijit.byId('arcgisServerServicesGrid').addLayer('"+decodeURI(e)+"','"+c.id+"');\"\x3e"+this.i18n.add+"\x3c/A\x3e\x3c/div\x3e");d+="\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e";return d+="\x3c/div\x3e"},blank:function(a,b){return""}}});