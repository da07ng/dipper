// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/map/dijit/ManageTemplates",["dijit","dojo","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/Menu,dijit/form/CheckBox,dijit/form/Button,dijit/form/TextBox,dijit/form/ValidationTextBox,dijit/layout/BorderContainer,dijit/layout/ContentPane,arcgisonline/sharing/util,arcgisonline/sharing/dijit/dialog/FeatureTypeDlg,arcgisonline/sharing/dijit/dialog/FeatureTemplateDlg"],function(h,a,k){a.provide("arcgisonline.map.dijit.ManageTemplates");a.require("dijit._Widget");a.require("dijit._Templated");
a.require("dijit.Menu");a.require("dijit.form.CheckBox");a.require("dijit.form.Button");a.require("dijit.form.TextBox");a.require("dijit.form.ValidationTextBox");a.require("dijit.layout.BorderContainer");a.require("dijit.layout.ContentPane");a.require("arcgisonline.sharing.util");a.require("arcgisonline.sharing.dijit.dialog.FeatureTypeDlg");a.require("arcgisonline.sharing.dijit.dialog.FeatureTemplateDlg");a.declare("arcgisonline.map.dijit.ManageTemplates",[h._Widget,h._Templated],{widgetsInTemplate:!0,
templateString:'\x3cdiv dojoType\x3d"dijit.layout.BorderContainer" region\x3d"top"\x3e\r\n  \x3cdiv id\x3d"manageTemplatesContentHeader" class\x3d"panel panel_left" dojoType\x3d"dijit.layout.ContentPane" region\x3d"top"\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing" style\x3d"padding:0;"\x3e\r\n      \x3cA href\x3d"JavaScript:void(0);" dojoAttachPoint\x3d"_closeBtn" title\x3d"${i18n.close}" class\x3d"panel panel_close panel_collapse"\x3e\r\n        \x3cimg src\x3d"images/close.gif" border\x3d"0"/\x3e\r\n      \x3c/A\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"manageTemplatesTitle" class\x3d"esriFloatLeading" style\x3d"font-weight:bold;"\x3e\r\n      ${i18n.manageTemplatesPanelTitle}\r\n    \x3c/div\x3e\r\n    \x3cdiv style\x3d"clear:both; border-bottom: #333 thin solid; height:1px;"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"manageTemplatesContentPane" dojoType\x3d"dijit.layout.ContentPane" region\x3d"center" style\x3d"overflow-x:hidden;overflow-y:auto;position:relative;" class\x3d"scrollPane"\x3e\r\n    \x3cdiv id\x3d"manageTemplates-main"\x3e\r\n      \x3cdiv id\x3d"manageTemplates-layer"\x3e\r\n        \x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n          \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd id\x3d"mgTmplCol1" nowrap\x3e\r\n                \x3clabel\x3e\r\n                  ${i18n.layerLabel}\r\n                \x3c/label\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd id\x3d"mgTmplCol2"\x3e\r\n                \x26nbsp;\r\n              \x3c/td\x3e\r\n              \x3ctd id\x3d"mgTmplCol3"\x3e\r\n                \x3cselect dojoType\x3d"dijit.form.ComboBox" dojoAttachPoint\x3d"manageTemplatesLayer" id\x3d"manageTemplatesLayer" class\x3d"dijitComboBoxNonEditable"\x3e\r\n                \x3c/select\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"manageTemplates-tree" style\x3d"overflow-x:hidden;overflow-y:auto;"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"manageTemplates-buttonsDiv"\x3e\r\n      \x3ccenter\x3e\r\n        \x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" class\x3d"calcite light" dojoAttachPoint\x3d"newFeatureType" dojoAttachEvent\x3d"onClick:_addNewFeatureType" style\x3d"display:none;"\x3e\r\n          \x3cspan\x3e${i18n.addNewTypeBtn}\x3c/span\x3e\r\n        \x3c/button\x3e\r\n        \x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" class\x3d"calcite blue" dojoAttachPoint\x3d"saveButton" dojoAttachEvent\x3d"onClick:_updateFeatureService"\x3e\r\n          \x3cspan\x3e${i18n.saveChangesBtn}\x3c/span\x3e\r\n        \x3c/button\x3e\r\n      \x3c/center\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"manageTemplatesContentFooter" dojoType\x3d"dijit.layout.ContentPane" region\x3d"bottom" style\x3d"height:40px; padding: 0 5px 0 5px; display:none;"\x3e\r\n    \x3cdiv class\x3d"footer" id\x3d"manageTemplatesSiteFooter" dojotype\x3d"arcgisonline.sharing.dijit.SiteFooterMap" style\x3d"white-space:normal;"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"typeMenu" dojoType\x3d"dijit.Menu" style\x3d"display: none;"\x3e\r\n    \x3cdiv id\x3d"typeMenu.moveUp" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconMoveUp"\x3e\r\n      ${i18n.moveUp}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"typeMenu.moveDown" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconMoveDown"\x3e\r\n      ${i18n.moveDown}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"typeMenu.remove" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconTemplateRemove"\x3e\r\n      ${i18n.remove}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"typeMenu.newTemplate" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconTemplateNew"\x3e\r\n      ${i18n.newTemplate}\r\n    \x3c/div\x3e\r\n     \x3cdiv id\x3d"typeMenu.properties" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconTemplateProperties"\x3e\r\n      ${i18n.properties}\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"templateMenu" dojoType\x3d"dijit.Menu" style\x3d"display: none;"\x3e\r\n    \x3cdiv id\x3d"templateMenu.moveUp" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconMoveUp"\x3e\r\n      ${i18n.moveUp}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"templateMenu.moveDown" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconMoveDown"\x3e\r\n      ${i18n.moveDown}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"templateMenu.copy" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconTemplateCopy"\x3e\r\n      ${i18n.copy}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"templateMenu.remove" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconTemplateRemove"\x3e\r\n      ${i18n.remove}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"templateMenu.properties" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconTemplateProperties"\x3e\r\n      ${i18n.properties}\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
i18n:null,container:null,mapLayer:null,mapLayerPos:0,menuOpen:!1,_eventConnections:[],constructor:function(a,d){null!=a&&a.containerNode&&(this.container=a.containerNode)},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.i18n.getLocalization("arcgisonline","arcgisonline").common;a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").viewer.main);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").tocPanel);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline",
"arcgisonline").manageTemplatesPanel)},postCreate:function(){this.container.addChild(h.byId("manageTemplatesPanel"));this.manageTemplatesLayer.textbox.readOnly=!0;a.style(this.manageTemplatesLayer.textbox,"cursor","pointer");this.manageTemplatesLayer.textbox.onclick=a.hitch(this,function(){this.manageTemplatesLayer.loadDropDown()});this.loadConnections()},loadConnections:function(){a.connect(h.byId("leftContentPanel"),"resize",this,"adjustHeight");a.connect(this.manageTemplatesLayer,"onChange",this,
"newLayer");if(esri.isTouchEnabled){var b=a.query(".scrollPane",this.domNode)[0],b=esri.setScrollable(b);this._eventConnections.push(b[0],b[1])}this._eventConnections.push(a.connect(this._closeBtn,"onclick",a.hitch(this,"_onClose",!1)));a.connect(h.byId("typeMenu"),"onClose",this,"onMenuClose");a.connect(h.byId("templateMenu"),"onClose",this,"onMenuClose");a.connect(h.byId("typeMenu.moveUp"),"onClick",this,"moveUpType");a.connect(h.byId("typeMenu.moveDown"),"onClick",this,"moveDownType");a.connect(h.byId("typeMenu.remove"),
"onClick",this,"removeType");a.connect(h.byId("typeMenu.newTemplate"),"onClick",this,"newTemplate");a.connect(h.byId("typeMenu.properties"),"onClick",this,"featureTypeProperties");a.connect(h.byId("templateMenu.moveUp"),"onClick",this,"moveUpTemplate");a.connect(h.byId("templateMenu.moveDown"),"onClick",this,"moveDownTemplate");a.connect(h.byId("templateMenu.copy"),"onClick",this,"copyTemplate");a.connect(h.byId("templateMenu.remove"),"onClick",this,"removeTemplate");a.connect(h.byId("templateMenu.properties"),
"onClick",this,"templateProperties");a.subscribe("onFeatureTypeChanges",this,"onFeatureTypeChanges")},destroy:function(){this.inherited(arguments);a.forEach(this._eventConnections,a.disconnect);this._eventConnections=[]},loadContent:function(){isEmbedded||a.style(a.byId("manageTemplatesContentFooter"),"display","");this.loadLayers();setTimeout(function(){h.byId("manageTemplatesPanel").adjustHeight()},100)},loadLayers:function(){for(var b=new a.data.ItemFileWriteStore({data:{identifier:"pos",items:[]}}),
d=arcgisonline.sharing.util.getUser(),c=null,e=arcgisonline.map.main.mapLayers.length-1;0<=e;e--){var f=arcgisonline.map.main.mapLayers[e];if(f.layer&&f.layer instanceof esri.layers.FeatureLayer&&f.itemId&&f.layer.isEditable()&&(arcgisonline.sharing.util.isHostedService(f.layer.url)||f.itemCard&&-1<a.indexOf(f.itemCard.typeKeywords,"providerSDS")))if(f.itemCard&&("update"===f.itemCard.itemControl||"admin"===f.itemCard.itemControl)){var g=this.shortenTitle(f);b.newItem({name:g,pos:e});c=c||g}else arcgisonline.map.mapUtil.checkFSItemAccess(f,
a.hitch(this,function(){if(f.itemOwner&&f.itemOwner===d.email){var a=this.shortenTitle(f);b.newItem({name:a,pos:e});c=c||a}}))}this.manageTemplatesLayer.set("store",b);this.manageTemplatesLayer.set("value",c)},newLayer:function(a){this.displayLayer()},displayLayer:function(){var b=this.manageTemplatesLayer.get("value");this.manageTemplatesLayer.store.fetch({query:{},onComplete:a.hitch(this,function(a){for(var c=0;c<a.length;c++)if(this.manageTemplatesLayer.store.getValue(a[c],"name")==b){this.mapLayerPos=
this.manageTemplatesLayer.store.getValue(a[c],"pos");break}})});this.mapLayer=arcgisonline.map.main.mapLayers[this.mapLayerPos];this.mapLayer.featureTemplatesChanged||this.mapLayer.rendererChanged||this.mapLayer.scaleChanged?this.saveButton.set("disabled",!1):this.saveButton.set("disabled",!0);this.buildLayerTree()},buildLayerTree:function(){a.byId("manageTemplates-tree").innerHTML="";a.style(a.byId("manageTemplates-tree"),"position","relative");var b=this.mapLayer.layer.renderer;"esri.renderer.SimpleRenderer"==
b.declaredClass||"esri.renderer.ClassBreaksRenderer"==b.declaredClass?(a.style(this.newFeatureType.domNode,"display","none"),this.adjustHeight(),this.buildTemplatesTree()):(a.style(this.newFeatureType.domNode,"display",""),this.adjustHeight(),this.buildTypesTree())},buildTemplatesTree:function(){var b=a.byId("manageTemplates-tree");a.forEach(this.mapLayer.layer.templates,function(a,c){this.buildTemplate(a,c,null,b)},this)},buildTypesTree:function(){var b=a.byId("manageTemplates-tree");a.forEach(this.mapLayer.layer.types,
function(a,c){this.buildType(a,c,b)},this)},buildTemplate:function(b,d,c,e){var f=this.mapLayerPos+(esri.isDefined(c)?"_"+c+"_":"_")+d;e=a.create("div",{id:f,"class":esri.isDefined(c)?"manageTemplates_level2 esriLeadingMargin27":"manageTemplates_level1"},e);a.connect(e,"onmouseover",a.hitch(this,"onTemplateMouseOver",f));a.connect(e,"onmouseout",a.hitch(this,"onTemplateMouseOut",f));e=a.create("table",{cellpadding:0,cellspacing:0},e);e=a.create("tbody",{},e);e=a.create("tr",{},e);if(esri.isDefined(c))g=
a.create("td",{valign:"top",width:"10"},e),a.create("div",{style:"width:10px;"},g);else{var g=a.create("td",{valign:"top",width:"20"},e),g=a.create("div",{style:"width:30px;height:30px;"},g);this.mapLayer.layer.renderer.symbol?this.drawSymbol(g,this.mapLayer.layer.renderer.symbol,30,30):this.mapLayer.layer.renderer.defaultSymbol?this.drawSymbol(g,this.mapLayer.layer.renderer.defaultSymbol,30,30):this.drawSymbol(g,this._getDefaultSymbol(this.mapLayer.layer.geometryType),30,30)}g=a.create("td",{nowrap:"true"},
e);a.create("span",{innerHTML:k.html.entities.encode(b.name.replace(/\_/g," ")),"class":"esriLeadingMargin1"},g);g=a.create("td",{width:"18"},e);b=a.create("div",{id:f+"_menu","class":"esriFloatTrailing calciteContextMenu",style:"display:none;width:10px;"},g);b=a.create("a",{href:"JavaScript:void(0);"},b);a.connect(b,"onclick",a.hitch(this,"onTemplateMenuClick",f,c,d));a.style(a.byId(f+"_menu"),"display","none")},buildType:function(b,d,c){var e=this.mapLayerPos+"_"+d,f=a.create("div",{id:e,"class":"manageTemplates_level1"},
c);c=a.create("div",{id:e+"_row"},f);a.connect(c,"onmouseover",a.hitch(this,"onTypeMouseOver",e));a.connect(c,"onmouseout",a.hitch(this,"onTypeMouseOut",e));c=a.create("table",{cellpadding:0,cellspacing:0},c);c=a.create("tbody",{},c);c=a.create("tr",{},c);for(var g=a.create("td",{valign:"top",width:"20"},c),g=a.create("div",{style:"width:30px;height:30px;"},g),h=!1,l=0;l<this.mapLayer.layer.renderer.infos.length;l++){var m=this.mapLayer.layer.renderer.infos[l];if(m.value==b.id){this.drawSymbol(g,
m.symbol,30,30);h=!0;break}}h||(this.mapLayer.layer.renderer.defaultSymbol?this.drawSymbol(g,this.mapLayer.layer.renderer.defaultSymbol,30,30):this.drawSymbol(g,this._getDefaultSymbol(this.mapLayer.layer.geometryType),30,30));g=a.create("td",{nowrap:"true"},c);a.create("span",{innerHTML:k.html.entities.encode(b.name.replace(/\_/g," ")),"class":"esriLeadingMargin1 manageTemplates_types"},g);g=a.create("td",{width:"18"},c);c=a.create("div",{id:e+"_menu","class":"esriFloatTrailing calciteContextMenu",
style:"display:none;"},g);c=a.create("a",{href:"JavaScript:void(0);"},c);a.connect(c,"onclick",a.hitch(this,"onTypeMenuClick",e,d));a.style(a.byId(e+"_menu"),"display","none");a.forEach(b.templates,function(a,b){this.buildTemplate(a,b,d,f)},this)},onTemplateMouseOver:function(b){a.style(a.byId(b+"_menu"),"display","inline")},onTemplateMouseOut:function(b){this.menuOpen||a.style(a.byId(b+"_menu"),"display","none")},onTypeMouseOver:function(b){a.style(a.byId(b+"_menu"),"display","inline")},onTypeMouseOut:function(b){this.menuOpen||
a.style(a.byId(b+"_menu"),"display","none")},onTemplateMenuClick:function(b,d,c){this.menuOpen=!0;this.typePos=d;this.templatePos=c;var e;e=esri.isDefined(d)?this.mapLayer.layer.types[d].templates:this.mapLayer.layer.templates;d=h.byId("templateMenu");a.forEach(d.getChildren(),function(a){-1<a.id.indexOf("templateMenu.moveUp")&&0===c?a.set("disabled",!0):-1<a.id.indexOf("templateMenu.moveDown")&&c===e.length-1?a.set("disabled",!0):a.set("disabled",!1)},this);d=a.coords(a.byId(b+"_menu"));b={target:a.byId(b+
"_menu"),pageX:d.x,pageY:d.y};b.preventDefault=b.stopPropagation=function(){};h.byId("templateMenu")._openMyself(b)},onTypeMenuClick:function(b,d){this.menuOpen=!0;this.typePos=d;this.templatePos=null;var c=this.mapLayer.layer.types,e=h.byId("typeMenu");a.forEach(e.getChildren(),function(a){-1<a.id.indexOf("typeMenu.moveUp")&&0===d?a.set("disabled",!0):-1<a.id.indexOf("typeMenu.moveDown")&&d===c.length-1?a.set("disabled",!0):-1<a.id.indexOf("typeMenu.remove")&&1===c.length?a.set("disabled",!0):a.set("disabled",
!1)},this);e=a.coords(a.byId(b+"_menu"));e={target:a.byId(b+"_menu"),pageX:e.x,pageY:e.y};e.preventDefault=e.stopPropagation=function(){};h.byId("typeMenu")._openMyself(e)},onMenuClose:function(){if(this.menuOpen){var b=this.mapLayerPos+"_"+(esri.isDefined(this.typePos)?this.typePos+"_":"")+(esri.isDefined(this.templatePos)?this.templatePos+"_":"");a.style(a.byId(b+"menu"),"display","none");this.menuOpen=!1}},onFeatureTypeChanges:function(){this.saveButton.set("disabled",!1);this.buildLayerTree();
this.mapLayer.featureTemplatesChanged=!0;a.publish("onLayerUpdate",[""])},_onClose:function(a,d){d.preventDefault();arcgisonline.map.leftPanel.openLeftEditPanel()},moveUpType:function(){var a=this.mapLayer.layer.types[this.typePos];this.mapLayer.layer.types[this.typePos]=this.mapLayer.layer.types[this.typePos-1];this.mapLayer.layer.types[this.typePos-1]=a;this.mapLayer.layer._typesDirty=!0;this.onFeatureTypeChanges()},moveDownType:function(){var a=this.mapLayer.layer.types[this.typePos];this.mapLayer.layer.types[this.typePos]=
this.mapLayer.layer.types[this.typePos+1];this.mapLayer.layer.types[this.typePos+1]=a;this.mapLayer.layer._typesDirty=!0;this.onFeatureTypeChanges()},removeType:function(){var a=this.mapLayer.layer.types.splice(this.typePos,1)[0];this.mapLayer.layer._typesDirty=!0;for(var d=0;d<this.mapLayer.layer.renderer.infos.length;d++){var c=this.mapLayer.layer.renderer.infos[d];if(c.value===a.id){this.mapLayer.layer.renderer.removeValue(c.value);this.mapLayer.layer.refresh();break}}this.onFeatureTypeChanges()},
newTemplate:function(){var b=new esri.layers.FeatureTemplate;b.description="";b.name=this.i18n.newTemplate;var d={};a.forEach(this.mapLayer.layer.fields,function(a){a.editable&&(d[a.name]=null,!1===a.nullable&&(d[a.name]="esriFieldTypeString"===a.type?" ":0))});esri.isDefined(this.typePos)&&(d[this.mapLayer.layer.typeIdField]=this.mapLayer.layer.types[this.typePos].id);var c=new esri.Graphic({attributes:d});b.prototype=c;var e=null;esri.isDefined(this.typePos)&&(e=this.mapLayer.layer.types[this.typePos]);
arcgisonline.sharing.dijit.dialog.FeatureTemplateDlg.prototype.statics.getInstance().show({layer:this.mapLayer.layer,type:e,template:b,okHandler:a.hitch(this,function(a){esri.isDefined(this.typePos)?(e.templates.push(a),this.mapLayer.layer._typesDirty=!0):(this.mapLayer.layer.templates.push(a),this.updateTemplates(this.mapLayer.layer,this.mapLayer.layer.templates));this.onFeatureTypeChanges()})})},moveUpTemplate:function(){if(esri.isDefined(this.typePos)){var a=this.mapLayer.layer.types[this.typePos],
d=a.templates[this.templatePos];a.templates[this.templatePos]=a.templates[this.templatePos-1];a.templates[this.templatePos-1]=d}else a=this.mapLayer.layer.templates,d=a[this.templatePos],a[this.templatePos]=a[this.templatePos-1],a[this.templatePos-1]=d,this.updateTemplates(this.mapLayer.layer,a);this.onFeatureTypeChanges()},moveDownTemplate:function(){if(esri.isDefined(this.typePos)){var a=this.mapLayer.layer.types[this.typePos],d=a.templates[this.templatePos];a.templates[this.templatePos]=a.templates[this.templatePos+
1];a.templates[this.templatePos+1]=d}else a=this.mapLayer.layer.templates,d=a[this.templatePos],a[this.templatePos]=a[this.templatePos+1],a[this.templatePos+1]=d,this.updateTemplates(this.mapLayer.layer,a);this.onFeatureTypeChanges()},copyTemplate:function(){var b=null,d;esri.isDefined(this.typePos)?(b=this.mapLayer.layer.types[this.typePos],d=a.clone(b.templates[this.templatePos])):d=a.clone(this.mapLayer.layer.templates[this.templatePos]);d.name=d.name+" - "+this.i18n.copy;arcgisonline.sharing.dijit.dialog.FeatureTemplateDlg.prototype.statics.getInstance().show({layer:this.mapLayer.layer,
type:b,template:d,okHandler:a.hitch(this,function(a){esri.isDefined(this.typePos)?(b.templates.push(a),this.mapLayer.layer._typesDirty=!0):(this.mapLayer.layer.templates.push(a),this.updateTemplates(this.mapLayer.layer,this.mapLayer.layer.templates));this.onFeatureTypeChanges()})})},removeTemplate:function(){if(esri.isDefined(this.typePos))this.mapLayer.layer.types[this.typePos].templates.splice(this.templatePos,1),this.mapLayer.layer._typesDirty=!0;else{var a=this.mapLayer.layer.templates;a.splice(this.templatePos,
1);this.updateTemplates(this.mapLayer.layer,a)}this.onFeatureTypeChanges()},templateProperties:function(){arcgisonline.sharing.dijit.dialog.FeatureTemplateDlg.prototype.statics.getInstance().show({layer:this.mapLayer.layer,type:esri.isDefined(this.typePos)?this.mapLayer.layer.types[this.typePos]:null,template:esri.isDefined(this.typePos)?this.mapLayer.layer.types[this.typePos].templates[this.templatePos]:this.mapLayer.layer.templates[this.templatePos],okHandler:a.hitch(this,function(a){this.onFeatureTypeChanges()})})},
_addNewFeatureType:function(){arcgisonline.sharing.dijit.dialog.FeatureTypeDlg.prototype.statics.getInstance().show({mapLayer:this.mapLayer,okHandler:a.hitch(this,function(a){this.onFeatureTypeChanges()})})},featureTypeProperties:function(){arcgisonline.sharing.dijit.dialog.FeatureTypeDlg.prototype.statics.getInstance().show({mapLayer:this.mapLayer,featureTypePos:this.typePos,okHandler:a.hitch(this,function(a){this.onFeatureTypeChanges()})})},_updateFeatureService:function(){arcgisonline.map.itemData.updateFeatureService(this.mapLayer);
this.saveButton.set("disabled",!0)},drawSymbol:function(b,d,c,e){b=k.gfx.createSurface(b,c,e);d=esri.symbol.getShapeDescriptors(d);d=b.createShape(d.defaultShape).setFill(d.fill).setStroke(d.stroke);var f={dx:c/2,dy:e/2},g=d.getBoundingBox(),h=g.width,g=g.height;if(h>c||g>e)c=((c<e?c:e)-5)/(h>g?h:g),a.mixin(f,{xx:c,yy:c});d.applyTransform(f);return b},updateTypeIdField:function(b,d){b.typeIdField=d;if(b._collection){var c;c=9>a.isIE?a.json.parse(b._json):JSON.parse(b._json);c.layerDefinition?c.layerDefinition.typeIdField=
d:c.typeIdField=d;b._json=9>a.isIE?a.json.stringify(c):JSON.stringify(c)}},updateTemplates:function(b,d){b.templates=d;if(b._collection){var c;c=9>a.isIE?a.json.parse(b._json):JSON.parse(b._json);c.layerDefinition?c.layerDefinition.templates=d:c.templates=d;b._json=9>a.isIE?a.json.stringify(c):JSON.stringify(c)}},_getDefaultSymbol:function(a){return"esriGeometryPoint"==a?new esri.symbol.SimpleMarkerSymbol:"esriGeometryPolyline"==a?new esri.symbol.SimpleLineSymbol:"esriGeometryPolygon"==a?new esri.symbol.SimpleFillSymbol:
null},shortenTitle:function(a){var d=a.title;if(-1<d.indexOf(" - ")){a=a.url;var c=a.indexOf("/FeatureServer");if(-1==c)return d;a=a.substring(0,c);a=a.substring(a.lastIndexOf("/")+1,a.length);d.startsWith(a+" - ")&&(d=d.substring((a+" - ").length,d.length))}return d},adjustHeight:function(b){if(!("undefined"==typeof leftPanel||"manageTemplatesStack"!=leftPanel.visibleStack)){var d=a.coords(a.byId("leftPanelDiv")).h,c=a.coords(a.byId("manageTemplatesContentHeader")).h;b=a.coords(a.byId("manageTemplatesSiteFooter_links")).h+
10;var e=a.coords(a.byId("manageTemplates-buttonsDiv")).h||66,f=a.coords(a.byId("manageTemplates-layer")).h,d=d-c-b-15;a.style(a.byId("manageTemplatesContentFooter"),"height",b+"px");a.style(a.byId("manageTemplatesContentPane"),"height",d+"px");a.style(a.byId("manageTemplates-tree"),"height",d-e-f-10+"px");b=a.coords(a.byId("leftContentStackContainer")).w-15;0<b&&(e=a.style(a.byId("mgTmplCol1"),"width"),f=a.style(a.byId("mgTmplCol2"),"width"),a.style(a.byId("widget_manageTemplatesLayer"),"width",
(0<b-(e+f+6)?b-(e+f+6):0)+"px"))}}})});