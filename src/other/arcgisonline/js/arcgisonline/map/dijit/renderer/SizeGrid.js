// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/map/dijit/renderer/SizeGrid","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/html dojo/on dojo/dom dojo/query dojo/mouse dojo/has dojo/topic dojo/string dojo/dom-class dojo/dom-style dojo/dom-construct dojox/html/entities dijit/form/Button dijit/form/CheckBox dijit/Tooltip esri/symbols/jsonUtils esri/styles/size esri/lang dgrid/OnDemandGrid dgrid/Selection dgrid/editor dojo/store/Memory dojo/store/Observable arcgisonline/map/dijit/renderer/_SizeMixin arcgisonline/map/dijit/renderer/_SymbolsMixin arcgisonline/map/dijit/renderer/_RendererMixin arcgisonline/map/dijit/renderer/_LabelsMixin dojo/i18n!arcgisonline/nls/arcgisonline dijit/_Widget dijit/registry".split(" "),
function(k,b,d,l,h,r,s,m,F,n,t,G,H,I,g,u,J,K,v,L,w,M,x,N,y,e,p,z,A,B,C,q,D,O){h=k([D],{declaredClass:"arcgisonline.map.dijit.renderer.SizeGrid",basePath:require.toUrl("arcgisonline/map/dijit/renderer"),baseClass:"esriAGOSizeGrid",i18n:null,id:"",grid:null,lastDefaultLabel:null,lastDefaultSymbol:null,ordersList:null,didDragFromSource:!1,ungroupButton:null,symbolButton:null,otherCheckBox:null,scrollPos:0,batchCount:205,tooltips:[],constructor:function(a,c){b.mixin(this,z);b.mixin(this,B);b.mixin(this,
A);b.mixin(this,C);null!=a&&(a.id&&(this.id=a.id),a.renderer&&(this.renderer=a.renderer),a.style&&(this.style=a.style),a.onSymbolClick&&(this.onSymbolClick=a.onSymbolClick),a.onLabelClick&&(this.onLabelClick=a.onLabelClick),a.params&&b.mixin(this,a.params))},postMixInProperties:function(){this.inherited(arguments);this.i18n=b.clone(q.common);b.mixin(this.i18n,q.rendererSizePanel)},postCreate:function(){this.createGrid()},destroy:function(){this.onRendererItemChangeHandler&&t.unsubscribe(this.onRendererItemChangeHandler);
d.forEach(this.tooltips,function(a){a.destroy()});this.grid&&(delete this.store,this.grid.destroy(),delete this.grid);this.inherited(arguments)},resize:function(){m(".symbolCell").style("width",this.maxSymbolWidth+10+"px");this.grid.resize()},hide:function(){},updateGrid:function(a){this.renderer=a;this.getData();this.store=p(new e({data:this.data,idProperty:"id",query:function(a,b){b=b||{};b.sort=[{attribute:"id"}];return e.prototype.query.call(this,a,b)}}));this.scrollPos=this.grid.bodyNode.scrollTop;
this.grid.set("store",this.store)},createGrid:function(){this.grid?(d.forEach(this.tooltips,function(a){a.destroy()}),this.scrollPos=this.grid.bodyNode.scrollTop,delete this.store,this.grid.destroy(),delete this.grid):this.scrollPos=0;s.byId("_sizeRendererGrid")||g.create("div",{id:"_sizeRendererGrid"},this.domNode);this.getColumns();this.maxSymbolWidth=30;this.getData();this.store=p(new e({data:this.data,idProperty:"id",query:function(a,c){c=c||{};c.sort=[{attribute:"id"}];return e.prototype.query.call(this,
a,c)}}));this.grid=new (k([x]))({store:this.store,selectionMode:"single",columns:this.columns,className:"dgrid-autoheight",style:this.style?this.style:"width: 200px;",sort:[{attribute:"id"}],minRowsPerPage:this.batchCount,maxRowsPerPage:this.batchCount,showHeader:!1},"_sizeRendererGrid");this.grid.on("dgrid-editor-hide",b.hitch(this,function(a){this.handleLabelChange(a.cell.row.data,a.editor.value)}));this.grid.on("dgrid-error",b.hitch(this,function(a){console.log("dGrid error",a.error.message)}));
this.grid.on("dgrid-refresh-complete",b.hitch(this,function(a){this.grid.scrollTo({y:this.scrollPos});m(".symbolCell").style("width",this.maxSymbolWidth+10+"px")}));this.resize()},getColumns:function(){this.columns={};this.columns.symbol={className:"symbolCell",field:"symbol",label:"",sortable:!1,renderCell:b.hitch(this,function(a,c,E,d){if(c){var f=g.create("div",{style:"width:"+a.symbolSize.width+"px;height:"+a.symbolSize.height+"px;margin: auto;","class":"symbol"});r(E,"click",b.hitch(this,function(a){this.onRowClickSymbolHandler(a)},
a));this.tooltips.push(new v({connectId:[f],label:"\x3cdiv class\x3d'rendererTooltip'\x3e"+this.i18n.oneSymbolTooltip+"\x3c/div\x3e"}));9>n("ie")?setTimeout(b.hitch(this,function(a,c,b){this.drawSymbol(a,c,b.symbolSize.width,b.symbolSize.height,null,1);this.updateBackgroundForAlmostWhite(c,a)},f,c,a),100):(this.drawSymbol(f,c,a.symbolSize.width,a.symbolSize.height,null,1),this.updateBackgroundForAlmostWhite(c,f))}return f})};this.columns.label=y({className:"labelCell",field:"label",name:this.i18n.labelTitle,
label:this.i18n.labelTitle,sortable:!1,canEdit:function(a){return!0},renderCell:b.hitch(this,function(a,c,b,d){return g.create("span",{innerHTML:u.encode(a.label),"class":"info"})})},"text","click")},getData:function(){this.data=d.map(this.renderer.infos,function(a,b){var d=this._calcSymbolWidthHeight(a.symbol);this.maxSymbolWidth=Math.max(this.maxSymbolWidth,d.width);return{symbol:a.symbol,symbolSize:d,label:a.label,minValue:a.minValue,maxValue:a.maxValue,id:this.renderer.infos.length-b}},this);
if(this.renderer.defaultSymbol){var a=this._calcSymbolWidthHeight(this.renderer.defaultSymbol);this.maxSymbolWidth=Math.max(this.maxSymbolWidth,a.width);this.data.push({symbol:this.renderer.defaultSymbol,symbolSize:a,label:this.renderer.defaultLabel||this.i18n.other,minValue:"_default_",maxValue:"_default_",id:this.renderer.infos.length+1})}},handleLabelChange:function(a,b){a.label=b.length?b:"_default_"===a.minValue?this.i18n.other:this.getLabel(a,0);d.forEach(this.data,function(b){a.id==b.id&&(b.label=
a.label)},this);l.publish("onUpdateSize",[{symbol:a.symbol,minValue:a.minValue,maxValue:a.maxValue,label:a.label}])},onRowClickSymbolHandler:function(a,c){var d=w.getSchemes({theme:"default",basemap:this.getBasemapType(),geometryType:this.geometryType});"_default_"===a.minValue?this.showSymbolStyler(a.symbol,{externalSizing:!1,optimizeOutline:this.hasOptimizeOutline(this.renderer.visualVariables),schemes:d},b.hitch(this,"onSymbolChange",a)):this.showSymbolStyler(a.symbol,{externalSizing:!1,schemes:d},
b.hitch(this,"onSymbolChange",a))},onSymbolChange:function(a,c,e,h,f){e=this._calcSymbolWidthHeight(c);var g={symbol:c,symbolSize:e,label:a.label};d.forEach(this.data,function(c){a.id==c.id&&(c=b.mixin(c,g),this.store.put(c))},this);this.maxSymbolWidth=this._calcTotalSymbolWidthHeight().width;l.publish("onUpdateSize",[{symbol:c,minValue:a.minValue,maxValue:a.maxValue,label:a.label},f])}});n("extend-esri")&&b.setObject("arcgisonline.map.dijit.renderer.SizeGrid",h);return h});