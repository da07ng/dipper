// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/views/3d/webgl-engine/materials/BillboardMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderBillboard"\x3e\x3c![CDATA[\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tuniform mat4 modelNormal;\r\n\tattribute vec3 $position;\r\n\tattribute vec3 $normal;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\tvarying vec3 vnormal;\r\n\tconst float size \x3d 1.05;\r\n\r\n\tvoid main(void) {\r\n\t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\r\n\t\tvec2 uv01 \x3d floor($uv0);\r\n\t\tvec2 uv \x3d $uv0 - uv01;\r\n\t\tvec3 zDir \x3d normalize(-pos);\r\n\t\tvec3 xDir \x3d normalize(cross(vec3(.0, 1.0, .0), zDir));\r\n\t\tvec3 yDir \x3d cross(zDir, xDir);\r\n\t\tpos +\x3d xDir * (uv01.x - .5) * size;\r\n\t\tpos +\x3d yDir * (uv01.y - .5) * size;\r\n\t\tvec4 pos4 \x3d proj * vec4(pos, 1.0);\r\n\t\tgl_Position \x3d pos4;\r\n\t\tvtc \x3d uv;\r\n\t\tvnormal \x3d normalize((modelNormal * vec4($normal, 1.0)).xyz);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderBillboard"\x3e\x3c![CDATA[\r\n\tprecision mediump float;\r\n\r\n\tuniform vec4 lightAmbient;\r\n\tuniform vec4 lightDiffuse;\r\n\tuniform vec3 lightDirection;\r\n\tuniform sampler2D tex;\r\n\tvarying vec2 vtc;\r\n\tvarying vec3 vnormal;\r\n\r\n\tvoid main() {\r\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\r\n\t\tif (texColor.a \x3c .15) discard;\r\n\t\tgl_FragColor \x3d texColor;\r\n\t\tgl_FragColor.rgb *\x3d lightAmbient.rgb * lightAmbient.w + lightDiffuse.rgb * lightDiffuse.w * dot(lightDirection, vnormal);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderBillboardDepth"\x3e\x3c![CDATA[\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tuniform vec2 nearFar;\r\n\tattribute vec3 $position;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\tvarying float depth;\r\n\tconst float size \x3d 1.05;\r\n\r\n\tvoid main(void) {\r\n\t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\r\n\t\tvec2 uv01 \x3d floor($uv0);\r\n\t\tvec2 uv \x3d $uv0 - uv01;\r\n\t\tpos.x +\x3d (uv01.x - .5) * size;\r\n\t\tpos.y +\x3d (uv01.y - .5) * size;\r\n\t\tvec4 eye \x3d vec4(pos, 1.0);\r\n\t\tgl_Position \x3d proj * eye;\r\n\t\tdepth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\r\n\t\tvtc \x3d uv;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e'}});
define(["dojo/text!./BillboardMaterial.xml","./internal/MaterialUtil","../lib/GLSLProgram","../lib/GLSLShader"],function(u,m,n,q){var t=function(a,k){m.basicMaterialConstructor(this,k);var f=m.Layouts.PosNormTex;this.getSize=function(){return 1.05};this.dispose=function(){};this.getTextureId=function(){return a};this.getOutputAmount=function(c){return 6*c*f.getStride()};this.getVertexBufferLayout=function(){return f};this.fillInterleaved=function(c,d,g,a,e,b){a=m.fill;var k=c.faces.indices.va,f=c.vertexAttr.va.data,
l=c.vertexAttr.tc4.data,n=c.vertexAttr.n0.data,q=c.vertexAttr.n1.data,r=c.vertexAttr.n2.data;c=c.vertexAttr.n3.data;for(var s=0;s<k.length;++s){var h=4*k[s],p=3*k[s];b+=a(f,h,e,b,d,3);b+=a(n,p,e,b,g,3);e[b++]=l[h];e[b++]=l[h+1];b+=a(f,h,e,b,d,3);b+=a(q,p,e,b,g,3);e[b++]=l[h+2]+1;e[b++]=l[h+1];b+=a(f,h,e,b,d,3);b+=a(r,p,e,b,g,3);e[b++]=l[h+2]+1;e[b++]=l[h+3]+1;b+=a(f,h,e,b,d,3);b+=a(r,p,e,b,g,3);e[b++]=l[h+2]+1;e[b++]=l[h+3]+1;b+=a(f,h,e,b,d,3);b+=a(c,p,e,b,g,3);e[b++]=l[h];e[b++]=l[h+3]+1;b+=a(f,
h,e,b,d,3);b+=a(n,p,e,b,g,3);e[b++]=l[h];e[b++]=l[h+1]}};this.intersect=function(){};this.getGLMaterials=function(){return[v,w,void 0,r]};this.getAllTextureIds=function(){return[a]}},v=function(a,k,f){m.basicGLMaterialConstructor(this,a);var c=k.get("billboard");m.singleTextureGLMaterialConstructor(this,f,{textureId:a.getTextureId()});this.beginSlot=function(a){return 2===a};this.getProgram=function(){return c};this.bind=function(d,g){c.use();this.bindTexture(d,c);a.getVertexBufferLayout().enableVertexAttribArrays(d,
c)};this.release=function(d){a.getVertexBufferLayout().disableVertexAttribArrays(d,c)};this.bindView=function(a,g){m.bindView(g.origin,g.view,c)};this.bindInstance=function(a,g){c.uniformMatrix4fv("model",g.transformation);c.uniformMatrix4fv("modelNormal",g.transformationNormal)};this.getDrawMode=function(a){return a.TRIANGLES}},r=function(a,k,f,c){m.basicGLMaterialConstructor(this,a);var d=null==c?k.get("billboardDepth"):k.get("billboardDepthShadowMap");m.singleTextureGLMaterialConstructor(this,
f,{textureId:a.getTextureId()});this.beginSlot=function(a){return 2===a};this.getProgram=function(){return d};this.bind=function(c,f){d.use();this.bindTexture(c,d);d.uniform2fv("nearFar",f.nearFar);a.getVertexBufferLayout().enableVertexAttribArrays(c,d)};this.release=function(c){a.getVertexBufferLayout().disableVertexAttribArrays(c,d)};this.bindView=function(a,c){m.bindView(c.origin,c.view,d)};this.bindInstance=function(a,c){d.uniformMatrix4fv("model",c.transformation)};this.getDrawMode=function(a){return a.TRIANGLES}},
w=function(a,k,f){r.call(this,a,k,f,!0)};t.loadShaders=function(a,k,f,c){a._parse(u);var d=new q(c.VERTEX_SHADER,a.vertexShaderBillboard,c),g=new q(c.FRAGMENT_SHADER,a.fragmentShaderBillboard,c),d=new n([d,g],c);a=new q(c.VERTEX_SHADER,a.vertexShaderBillboardDepth,c);g=k.get("fsDepthTextured");k=k.get("fsDepthTexturedShadowMap");g=new n([a,g],c);c=new n([a,k],c);f.add("billboard",d);f.add("billboardDepth",g);f.add("billboardDepthShadowMap",c)};return t});