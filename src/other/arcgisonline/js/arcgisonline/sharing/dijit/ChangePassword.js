// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/ChangePassword",["dijit","dojo","dojox","dojo/i18n!arcgisonline/nls/arcgisonline","dojo/require!dijit/_Templated,dijit/form/Button,dijit/form/TextBox,dijit/layout/ContentPane,arcgisonline/sharing/util,arcgisonline/sharing/geow/Community,arcgisonline/sharing/dijit/dialog/GeneralDlg"],function(d,b,f){b.provide("arcgisonline.sharing.dijit.ChangePassword");b.require("dijit._Templated");b.require("dijit.form.Button");b.require("dijit.form.TextBox");b.require("dijit.layout.ContentPane");
b.require("arcgisonline.sharing.util");b.require("arcgisonline.sharing.geow.Community");b.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");b.requireLocalization("arcgisonline","arcgisonline");b.declare("arcgisonline.sharing.dijit.ChangePassword",[d._Widget,d._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv dojotype\x3d"dijit.layout.ContentPane" region\x3d"top" dojoAttachPoint\x3d"containerNode"\x3e\r\n\r\n  \x3ch1\x3e${i18n.changePasswordLabel}\x3c/h1\x3e\r\n  \x3cdiv style\x3d"overflow:auto; margin-top:15px;" class\x3d"userDetails"\x3e\r\n\r\n    \x3cdiv class\x3d"esriFloatLeading" style\x3d"clear:both; width: 150px;"\x3e\r\n      \x3cimg dojoAttachPoint\x3d"thumbnailImage" class\x3d"profileThumbnail" /\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"esriFloatLeading esriLeadingMargin1" style\x3d"width:700px;"\x3e\r\n\r\n      \x3cspan class\x3d"esriItemTitle" style\x3d"display:block;" dojoAttachPoint\x3d"label_fullName"\x3e\x3c/span\x3e\r\n\r\n      \x3cdiv style\x3d"margin-top:1em;" class\x3d"property"\x3e\r\n        \x3ctable\x3e\r\n          \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd\x3e\r\n                \x3clabel for\x3d"new_password" style\x3d"padding:0;margin:0;"\x3e\r\n                  ${i18n.newPasswordLabel}\r\n                \x3c/label\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cdiv id\x3d"new_password" name\x3d"new_password" style\x3d"padding:2px;margin:0;" type\x3d"password" dojotype\x3d"dijit.form.TextBox" trim\x3d"true"\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr height\x3d"5"\x3e\r\n              \x3ctd colspan\x3d"2" height\x3d"5"\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd\x3e\r\n                \x3clabel for\x3d"verify_password" style\x3d"padding:0;margin:0;"\x3e\r\n                  ${i18n.verifyPasswordLabel}\r\n                \x3c/label\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cdiv id\x3d"verify_password" name\x3d"verify_password" style\x3d"padding:2px;margin:0;" type\x3d"password" dojotype\x3d"dijit.form.TextBox" trim\x3d"true"\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cbr/\x3e\r\n                \x3cdiv dojoType\x3d"dijit.form.Button" type\x3d"button" dojoAttachEvent\x3d"onClick:_submitPasswordChange" iconclass\x3d"esriSaveIcon"\x3e${i18n.changePasswordLabel}\x3c/div\x3e\r\n                \x3cdiv dojoType\x3d"dijit.form.Button" type\x3d"button" dojoAttachEvent\x3d"onClick:_cancelPasswordChange" iconclass\x3d"esriCloseIcon"\x3e${i18n.cancel}\x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n  \x3c/div\x3e\r\n\r\n  \x3cform dojoAttachPoint\x3d"passwordForm" method\x3d"post"\x3e\r\n    \x3cinput type\x3d"hidden" name\x3d"username"/\x3e\r\n    \x3cinput type\x3d"hidden" name\x3d"fullName"/\x3e\r\n    \x3cinput type\x3d"hidden" name\x3d"email"/\x3e\r\n    \x3cinput type\x3d"hidden" name\x3d"password"/\x3e\r\n    \x3cinput type\x3d"hidden" name\x3d"organization"/\x3e\r\n    \x3cinput type\x3d"hidden" name\x3d"tags"/\x3e\r\n    \x3cinput type\x3d"hidden" name\x3d"description"/\x3e\r\n    \x3cinput type\x3d"hidden" name\x3d"privacy"/\x3e\r\n    \x3cinput type\x3d"hidden" name\x3d"storageQuota"/\x3e\r\n  \x3c/form\x3e\r\n\x3c/div\x3e\r\n',
_util:arcgisonline.sharing.util,_community:arcgisonline.sharing.geow.Community,_user:null,_showUser:null,_profile:null,_isAdmin:!1,_submitButton:null,_cancelButton:null,thumbnailPath:null,thumbnailImage:null,label_fullName:null,passwordForm:null,accountAdminRole:"account_admin",i18n:null,constructor:function(){var a=b.queryToObject(window.location.search.slice(1));a.user&&0<a.user.length&&(this._showUser=a.user);this._util.isLoggedIn()?(this._user=this._util.getUser(),this._user.accountId&&(this._user.role&&
this._user.role===this.accountAdminRole)&&(this._isAdmin=!0)):this._showUser||this._util.requireAuthentication()},postMixInProperties:function(){this.inherited(arguments);this.i18n=b.i18n.getLocalization("arcgisonline","arcgisonline").common;b.mixin(this.i18n,b.i18n.getLocalization("arcgisonline","arcgisonline").changePassword);this.i18n.invalidPasswordLength=b.i18n.getLocalization("arcgisonline","arcgisonline").troubleshoot.errors.invalidPassword.message},postCreate:function(){this.inherited(arguments);
esri.config.defaults.io.proxyUrl=esriGeowConfig.proxyServer;this.thumbnailImage.src=b.baseUrl.substring(0,b.baseUrl.indexOf("/js"))+"/js/arcgisonline/css/images/transparent.gif"},startup:function(){this._community.getProfile(this._isAdmin&&this._showUser?this._showUser:this._user.email,b.hitch(this,this._handle_getProfile))},onProfileLoad:function(a){},_handle_getProfile:function(a){this._profile=a;this._loadProfile(a);this.onProfileLoad(this._profile)},_handle_updateProfile:function(a){this._loadUserPage()},
_loadProfile:function(a){this.thumbnailImage.src=a.thumbnail&&0<a.thumbnail.length?this._community.getProfileThumbnailUrl(a,!0):b.baseUrl.substring(0,b.baseUrl.indexOf("/js"))+"/js/arcgisonline/css/images/no-user-thumb.jpg";this.label_fullName.innerHTML=a.fullName},_submitPasswordChange:function(a){a=this.passwordForm;a.username.value=this._profile.username;a.fullName.value=this._profile.fullName;a.email.value=this._profile.email;a.tags.value=this._profile.tagsStr;a.description.value=this._profile.description;
a.privacy.value=this._profile.privacy;a.storageQuota.value=this._profile.storageQuota;var c=b.byId("new_password").value,d=b.byId("verify_password").value,e=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();8>c.length||28<c.length?e.show({title:this.i18n.invalidPassword,message:this.i18n.invalidPasswordLength}):0<c.length&&0<d.length&&c===d?(a.password.value=c,this._community.updateUserSecure(this._isAdmin&&this._showUser?this._showUser:this._user.email,a,b.hitch(this,this._handle_updateProfile))):
1>c.length?e.show({title:this.i18n.invalidPassword,message:this.i18n.passwordBlank}):e.show({title:this.i18n.invalidPassword,message:this.i18n.noMatch})},_cancelPasswordChange:function(a){this._loadUserPage()},_loadUserPage:function(){var a=esriGeowConfig.baseUrl+"user.html";this._isAdmin&&this._showUser&&(a+="?user\x3d"+this._showUser);window.location=a}})});