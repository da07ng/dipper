// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("../geometry/support/normalizeUtils ../Graphic ../request ./support/NAMessage ./support/RouteResult ./Task dojo/_base/array dojo/_base/lang".split(" "),function(g,u,h,v,w,e,k,l){e=e.createSubclass({declaredClass:"esri.tasks.RouteTask",__msigns:[{n:"solve",c:1,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_parsedUrlGetter:function(a){var c=this.inherited(arguments);c.path+="/solve";return c},url:null,solve:function(a,c){var b=
c.assembly,b=this._encode(l.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON(b&&b[0])));return h({url:this.parsedUrl.path,content:b,callbackParamName:"callback"}).then(this._handleSolveResponse)},_handleSolveResponse:function(a){var c=[],b=[],e=a.routes?a.routes.features:[],n=a.stops?a.stops.features:[],g=a.barriers?a.barriers.features:[],h=a.polygonBarriers?a.polygonBarriers.features:[],l=a.polylineBarriers?a.polylineBarriers.features:[],m=a.messages,f=k.forEach,p=k.indexOf,q=!0,d,r,s=a.routes&&
a.routes.spatialReference||a.stops&&a.stops.spatialReference||a.barriers&&a.barriers.spatialReference||a.polygonBarriers&&a.polygonBarriers.spatialReference||a.polylineBarriers&&a.polylineBarriers.spatialReference;f(a.directions||[],function(a){c.push(d=a.routeName);b[d]={directions:a}});f(e,function(a){if(-1===p(c,d=a.attributes.Name))c.push(d),b[d]={};b[d].route=a});f(n,function(a){r=a.attributes;if(-1===p(c,d=r.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME"))c.push(d),b[d]={};"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==
d&&(q=!1);void 0===b[d].stops&&(b[d].stops=[]);b[d].stops.push(a)});0<n.length&&!0===q&&(b[c[0]].stops=b["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete b["esri.tasks.RouteTask.NULL_ROUTE_NAME"],c.splice(k.indexOf(c,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),1));var t=[];f(c,function(a,c){b[a].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===a?null:a;b[a].spatialReference=s;t.push(w.fromJSON(b[a]))});a=function(a){f(a,function(b,c){b.geometry&&(b.geometry.spatialReference=s);a[c]=u.fromJSON(b)});
return a};f(m,function(a,b){m[b]=v.fromJSON(a)});return{routeResults:t,barriers:a(g),polygonBarriers:a(h),polylineBarriers:a(l),messages:m}}});g._createWrappers(e);return e});