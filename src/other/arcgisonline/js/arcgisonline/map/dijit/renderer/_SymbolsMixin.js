// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/map/dijit/renderer/_SymbolsMixin","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dojo/dom dojo/Deferred dojo/_base/Color dijit/registry dijit/TooltipDialog dijit/popup dijit/Dialog esri/symbols/jsonUtils dojox/gfx dojo/dom-style dojo/dom-class dojo/dom-construct esri/lang esri/symbols/jsonUtils esri/styles/type esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/Color arcgisonline/map/dijit/renderer/SymbolStylerDlg".split(" "),
function(E,m,w,k,x,F,y,e,t,G,H,z,u,A,n,p,B,v,h,C,q,l,r,s,D){return{pointJson:{type:"esriSMS",style:"esriSMSCircle",color:[34,114,162,128],size:6,outline:{color:[34,114,162,255],width:1}},pointStreamJson:{type:"esriSMS",style:"esriSMSCircle",color:[77,77,77,255],size:4,outline:{color:[255,255,255,255],width:1}},lineJson:{type:"esriSLS",style:"esriSLSSolid",color:[77,77,77,255],width:2},lineStreamJson:{type:"esriSLS",style:"esriSLSSolid",color:[77,77,77,255],width:2},polygonJson:{type:"esriSFS",style:"esriSFSSolid",
color:[227,139,79,204],outline:{type:"esriSLS",style:"esriSLSSolid",color:[255,255,255,255],width:0.75}},backgroundPolygonJson:{type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,0],outline:{type:"esriSLS",style:"esriSLSSolid",color:[128,128,128,255],width:0.75}},markerJson:{type:"esriSMS",style:"esriSMSCircle",color:[77,77,77,255],size:6,outline:{color:[255,255,255,255],width:1}},getMarkerJson:function(){var a=this.markerJson;a.url=arcgisonline.sharing.util.getRedSphereUrl();return a},_getSymbol:function(a,
b){var c;if("esriGeometryPoint"==a||"esriGeometryMultipoint"==a){if(c=this.getDefaultSymbol(a),b)if("cross"===c.style||"x"===c.style)if("string"===typeof b){var d=new e(b);d.a=c.color.toRgba()[3];c.outline.setColor(d)}else c.outline.setColor(new e([b[0],b[1],b[2],c.color.toRgba()[3]]));else"string"===typeof b?(d=new e(b),d.a=c.color.toRgba()[3],c.setColor(d)):c.setColor(new e([b[0],b[1],b[2],c.color.toRgba()[3]]))}else if("esriGeometryPolyline"==a||"esriGeometryPolygon"==a)c=h.fromJson(this.symbol.toJson()),
b&&(this.symbol.color&&0.1<this.symbol.color.toRgba()[3]?"string"===typeof b?(d=new e(b),d.a=this.symbol.color.toRgba()[3],c.setColor(d)):c.setColor(new e([b[0],b[1],b[2],this.symbol.color.toRgba()[3]])):"string"===typeof b?(d=new e(b),c.setColor(d)):c.setColor(new e(b)));return c},getDefaultSymbol:function(a){var b=C.getSchemes({theme:"default",basemap:this.getBasemapType(),geometryType:a}).primaryScheme;return"esriGeometryPoint"==a||"esriGeometryMultipoint"==a?(a=new l(l.STYLE_SOLID,new s(b.outline.color),
b.outline.width),new q(q.STYLE_CIRCLE,b.size,a,b.noDataColor)):"esriGeometryPolyline"==a?new l(l.STYLE_SOLID,new s(b.noDataColor),b.width):"esriGeometryPolygon"==a?(a=new l(l.STYLE_SOLID,new s(b.outline.color),b.outline.width),new r(r.STYLE_SOLID,a,b.noDataColor)):null},switchSymbolKeepSize:function(a,b){var c=h.fromJson(a.toJson());switch(b.type){case "simplemarkersymbol":return"simplemarkersymbol"===a.type?c.size=b.size:(c.width=b.size,c.height=a.height/a.width*c.width),c;case "picturemarkersymbol":return"simplemarkersymbol"===
a.type?c.size=(b.width+b.height)/2:(c.width=b.width,c.height=a.height/a.width*c.width),c;case "simplelinesymbol":case "cartographiclinesymbol":return c.width=b.width,c}},switchSizeKeepSymbol:function(a,b){var c=h.fromJson(a.toJson());switch(a.type){case "simplemarkersymbol":return c.size=b,c;case "picturemarkersymbol":return c.width=b,c.height=a.height/a.width*c.width,c;case "simplelinesymbol":case "cartographiclinesymbol":return c.width=b,c}},switchSymbolKeepColor:function(a,b){var c=h.fromJson(a.toJson());
switch(b.type){case "simplemarkersymbol":return("cross"===c.style||"x"===c.style)&&("cross"===b.style||"x"===b.style)?c.outline.setColor(b.outline.color):"cross"===c.style||"x"===c.style?c.outline.setColor(b.color):"cross"===b.style||"x"===b.style?(c.setColor(b.outline.color),c.outline.setColor(new e([153,153,153,255]))):c.setColor(b.color),c;case "picturemarkersymbol":return c;case "simplelinesymbol":case "cartographiclinesymbol":return c.setColor(b.color),c;case "simplefillsymbol":return c.setColor(b.color),
c}},applyColorToSymbol:function(a,b){var c=h.fromJson(a.toJson());switch(c.type){case "simplemarkersymbol":return"cross"===c.style||"x"===c.style?c.outline.setColor(b):c.setColor(b),c;case "picturemarkersymbol":return c;case "simplelinesymbol":case "cartographiclinesymbol":return c.setColor(b),c;case "simplefillsymbol":return c.setColor(b),c}},setOutlineWidthOfSymbol:function(a,b){if(!a)return null;var c=h.fromJson(a.toJson());switch(c.type){case "simplemarkersymbol":return"cross"===c.style||"x"===
c.style||c.outline.setWidth(b),c;case "picturemarkersymbol":return c;case "simplelinesymbol":case "cartographiclinesymbol":return c;case "simplefillsymbol":return c.outline.setWidth(b),c}},setOutlineOpacityOfSymbol:function(a,b){if(!a)return null;var c=h.fromJson(a.toJson());switch(c.type){case "simplemarkersymbol":if(!("cross"===c.style||"x"===c.style)&&c.outline.color){var d=c.outline.color.toRgba();c.outline.setColor(new e([d[0],d[1],d[2],b]))}return c;case "picturemarkersymbol":return c;case "simplelinesymbol":case "cartographiclinesymbol":return c;
case "simplefillsymbol":return c.outline.color&&(d=c.outline.color.toRgba(),c.outline.setColor(new e([d[0],d[1],d[2],b]))),c}},convertFillToMarkerSymbol:function(a,b,c){a=h.fromJson(a.toJson());return new q(b||q.STYLE_CIRCLE,6,c||a.outline,a.color)},convertMarkerToFillSymbol:function(a){a=h.fromJson(a.toJson());return new r(r.STYLE_SOLID,a.outline,a.color)},applySchemeToSymbol:function(a,b){var c=!1;if(!a||"picturemarkersymbol"===a.type)c=!0,"esriGeometryPoint"===this.geometryType||"esriGeometryMultipoint"===
this.geometryType?a=h.fromJson(this.getMarkerJson()):"esriGeometryPolyline"===this.geometryType?a=h.fromJson(this.lineJson):"esriGeometryPolygon"===this.geometryType&&(a=h.fromJson(this.polygonJson));var d=h.fromJson(a.toJson());switch(d.type){case "simplemarkersymbol":return"cross"===d.style||"x"===d.style?d.outline.setColor(b.color):d.setColor(b.color),c&&(d.size=b.size,d.outline.setColor(b.outline.color),d.outline.width=b.outline.width),d;case "simplelinesymbol":case "cartographiclinesymbol":return d.setColor(b.color),
c&&(d.width=b.width),d;case "simplefillsymbol":return d.setColor(b.color),c&&(d.outline.setColor(b.outline.color),d.outline.width=b.outline.width),d}},getSymbolColor:function(a){switch(a.type){case "simplemarkersymbol":return"cross"===a.style||"x"===a.style?a.outline.color:a.color;case "picturemarkersymbol":return new e([0,0,0,1]);case "simplelinesymbol":case "cartographiclinesymbol":return a.color;case "simplefillsymbol":return a.color}},getSymbolSize:function(a){var b=h.fromJson(a.toJson());switch(a.type){case "simplemarkersymbol":return b.size;
case "picturemarkersymbol":return b.width;case "simplelinesymbol":case "cartographiclinesymbol":return b.width}},_checkSymbol:function(a,b){if("simplemarkersymbol"!==a.type&&"simplelinesymbol"!==a.type&&"cartographiclinesymbol"!==a.type&&"simplefillsymbol"!==a.type||!a.color)return a;var c=a.color.toRgba();if(0===c[3]&&(!a.outline||a.outline&&(0===a.outline.width||a.outline.color&&0===a.outline.color.toRgba()[3])))b?0===b.color.toRgba()[3]&&(!b.outline||b.outline&&(0===b.outline.width||b.outline.color&&
0===b.outline.color.toRgba()[3]))?a.setColor(new e([c[0],c[1],c[2],1])):a=b:a.setColor(new e([c[0],c[1],c[2],1]));return a},drawSymbol:function(a,b,c,d,g,f){if(!v.isDefined(c)||!v.isDefined(d))d=this._calcSymbolWidthHeight(b),c=d.width,d=d.height;a.innerHTML="";b=u.fromJson(b.toJson());"simplelinesymbol"===b.type||"cartographiclinesymbol"===b.type||"textsymbol"===b.type?b.color&&(g=b.color.toRgba(),g[3]*=f,b.color.setColor(g)):"simplemarkersymbol"===b.type||"simplefillsymbol"===b.type?(b.color&&(g=
b.color.toRgba(),g[3]*=f,b.color.setColor(g)),b.outline&&b.outline.color&&(g=b.outline.color.toRgba(),g[3]*=f,b.outline.color.setColor(g))):"picturemarkersymbol"===b.type&&(a.style.opacity=f,a.style.filter="alpha(opacity\x3d("+100*f+"))");a=A.createSurface(a,c,d);x("ie")&&(f=a.getEventSource(),n.set(f,"position","relative"),n.set(f.parentNode,"position","relative"));f=u.getShapeDescriptors(b);"esri.symbol.SimpleFillSymbol"===b.declaredClass&&(f.defaultShape={type:"path",path:"M -8,-8 L 8,-8 L 8,8 L -8,8 L -8,-8 E"});
var e;try{e=a.createShape(f.defaultShape).setFill(f.fill).setStroke(f.stroke)}catch(h){a.clear();a.destroy();return}var k=e.getBoundingBox();f=k.width;b=k.height;g=-(k.x+f/2);var k=-(k.y+b/2),l=a.getDimensions();g={dx:g+l.width/2,dy:k+l.height/2};if(f>c||b>d)c=((c<d?c:d)-5)/(f>b?f:b),m.mixin(g,{xx:c,yy:c});e.applyTransform(g);return a},_calcSymbolWidthHeight:function(a){var b=30,c=30;if(a&&"simplemarkersymbol"==a.type)var d=a.outline?a.outline.width:0,b=Math.min(Math.max(b,a.size+2*d),125),c=Math.min(Math.max(c,
a.size+2*d),125);else a&&"picturemarkersymbol"==a.type&&(b=Math.min(Math.max(b,a.width),125),c=Math.min(a.height?a.height:c,125));return{width:b,height:c}},_calcTotalSymbolWidthHeight:function(){var a=30,b=30;w.forEach(this.data,function(c){c.symbol&&(c=this._calcSymbolWidthHeight(c.symbol),a=Math.max(a,c.width),b=Math.max(b,c.height))},this);return{width:a,height:b}},isSymbolAlmostWhite:function(a){return a&&this.isColorAlmostWhite(a.color)&&(!a.outline||this.isColorAlmostWhite(a.outline.color))},
isColorAlmostWhite:function(a){return!a||246<a.r&&246<a.g&&246<a.b},updateBackgroundForAlmostWhite:function(a,b){p.remove(b,"esriSwatchEmptyContainer");this.isSymbolAlmostWhite(a)?p.add(b,"almostWhiteSymbol"):p.remove(b,"almostWhiteSymbol")},isSymbolTransparent:function(a){return a&&this.isColorTransparent(a.color)&&(!a.outline||this.isColorTransparent(a.outline.color))},isColorTransparent:function(a){return!a||0===a.a},drawTransparentSymbol:function(a){a.innerHTML="";p.remove(a,"almostWhiteSymbol");
B.create("div",{"class":"esriSwatchEmpty"},a);p.add(a,"esriSwatchEmptyContainer")},getSuggestedOutline:function(){var a=new y;if("esriGeometryPolygon"!==this.geometryType||this.hasDynamic)return a.reject(),a;this.layer.addPlugin("esri/plugins/FeatureLayerStatistics").then(m.hitch(this,function(){this.layer.statisticsPlugin.getSuggestedOutline({allowZeroWidth:!0}).then(m.hitch(this,function(b){a.resolve(b)}),m.hitch(this,function(b){console.log("getSuggestedScaleRange error",b);a.reject()}))}));return a},
showSymbolStyler:function(a,b,c){this.symbolStylerDlg=(new z({id:"symbolStylerDlg",style:"width:340px; visibility: hidden;"})).placeAt(document.body);this.symbolStylerDlgContent=new D({id:"symbolStylerDlgContent"});this.symbolStylerDlg.set({title:"",content:this.symbolStylerDlgContent});this.symbolStylerDlgHideHandler=k.connect(this.symbolStylerDlg,"onHide",m.hitch(this,function(){this.destroySymbolStylerDlg()}));this.symbolStylerDlgOkHandler=k.subscribe("symbolStylerOk",m.hitch(this,function(a,b){this.activeTab=
b;this.symbolStylerDlg.hide();c(a.symbol,a.colors,a.scheme,a.optimizeOutline)}));this.symbolStylerDlgCancelHandler=k.subscribe("symbolStylerCancel",m.hitch(this,function(a){this.symbolStylerDlg.hide()}));this.symbolStylerDlg.show().then(m.hitch(this,function(){n.set(this.symbolStylerDlg.domNode,"top","95px");esriGeowConfig.isRightToLeft?n.set(this.symbolStylerDlg.domNode,"right",arcgisonline.map.leftPanel.leftPanelWidth+18+"px"):n.set(this.symbolStylerDlg.domNode,"left",arcgisonline.map.leftPanel.leftPanelWidth+
18+"px");n.set(this.symbolStylerDlg.domNode,"visibility","visible");b.activeTab=this.activeTab;this.symbolStylerDlgContent.show(a,b)}))},hideSymbolStyler:function(){this.symbolStylerDlg&&this.symbolStylerDlg.hide()},destroySymbolStylerDlg:function(){this.symbolStylerDlgOkHandler&&k.unsubscribe(this.symbolStylerDlgOkHandler);this.symbolStylerDlgOkHandler=null;this.symbolStylerDlgCancelHandler&&k.unsubscribe(this.symbolStylerDlgCancelHandler);this.symbolStylerDlgCancelHandler=null;this.symbolStylerDlgHideHandler&&
k.disconnect(this.symbolStylerDlgHideHandler);this.symbolStylerDlgHideHandler=null;this.symbolStylerDlgContent&&this.symbolStylerDlgContent.destroy();this.symbolStylerDlgContent=null;this.symbolStylerDlg&&this.symbolStylerDlg.destroy();this.symbolStylerDlg=null;t.byId("symbolStylerDlg")&&t.byId("symbolStylerDlg").destroy()}}});