// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
require({cache:{"url:webSceneViewer/widgets/SymbologyEditor/templates/SymbologyEditor.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"paneSectionTitle" data-dojo-attach-point\x3d"symbols"\x3e\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"originalChangeSymbology" class\x3d"changeSymbols"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"editorWrapper" data-dojo-attach-point\x3d"editorWrapper"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"symbologyLoading" class\x3d"symbologyLoading hide"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"paneSectionTitle subSection" data-dojo-attach-point\x3d"dimensions"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"toggle2d3d" data-dojo-attach-point\x3d"changeDimension"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"symbolLayerContainer" class\x3d"subSection"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \r\n\x3c/div\x3e\r\n'}});
define("esri/core/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/Select dojo/text!./templates/SymbologyEditor.html dojo/dom-class dojo/on esri/views/3d/layers/graphics/SymbolConverter esri/renderers/SimpleRenderer esri/symbols/PointSymbol3D esri/symbols/LineSymbol3D esri/symbols/PolygonSymbol3D esri/symbols/MeshSymbol3D ./PointSymbolLayerEditor ./LineSymbolLayerEditor ./PolygonSymbolLayerEditor dojo/i18n!../nls/widgets".split(" "),function(r,s,t,u,k,v,c,l,
m,h,w,x,n,y,z,p,q,e){function A(a,b){if(null==a!==(null==b))return!1;if(a===b||null==a&&null==b||JSON.stringify(a.toJSON())===JSON.stringify(b.toJSON()))return!0;if(!(a.visualVariables!=b.visualVariables||null==a||null==b||null==a.symbol||null==b.symbol||null==a.symbol.symbolLayers||null==b.symbol.symbolLayers)&&a.symbol.symbolLayers&&b.symbol.symbolLayers&&0<a.symbol.symbolLayers.length&&0<b.symbol.symbolLayers.length){if(a.symbol.symbolLayers.length!==b.symbol.symbolLayers.length)return!1;for(var d=
!0,f=0;f<a.symbol.symbolLayers.length;f++){var c=a.symbol.symbolLayers[f],g=b.symbol.symbolLayers[f];d&&(d=c===g||null==c&&null==g?!0:JSON.stringify(c.toJSON())===JSON.stringify(g.toJSON())?!0:void 0)}return d}return!1}return r([s,t,u],{name:"SymbologyEditor",templateString:v,baseClass:"SymbologyEditor",editor:void 0,layer:void 0,view:void 0,symbolLayerDimensionType:void 0,_setSymbolLayerDimensionTypeAttr:function(a){a!==this.symbolLayerDimensionType&&(this._set("symbolLayerDimensionType",a),this._symbolLayerEditors.forEach(function(b){b.set("dimensionType",
a)}))},constructor:function(a,b){this._symbolLayerEditors=[];this._onHandles=[];this._geometryType=a.layer.geometryType;this._defaultDimension=(this._showShield=this._needsShield(a.layer.renderer))?"2d":this._readDimensionFromRenderer(a.layer.renderer)},destroy:function(){this.inherited(arguments);this._symbolLayerEditors.forEach(function(a){a.destroy()});this._symbolLayerEditors.length=0;this._onHandles.forEach(function(a){a.remove?a.remove():a.unwatch&&a.unwatch()});this.layer=null},postCreate:function(){this.inherited(arguments);
this.symbols.textContent=e.symbologyEditor.symbols;this._symbolEditDropdown=new k({className:"toggleOriginalEdited",options:[{label:e.symbologyEditor.originalSymbology,value:"Original",selected:!this.layer._websceneEditorProperties.editedFlags.renderer},{label:e.symbologyEditor.modifySymbology,value:"Change",selected:this.layer._websceneEditorProperties.editedFlags.renderer}]});this._onHandles.push(l(this._symbolEditDropdown,"change",function(a){this._toggleSymbols(a)}.bind(this)));this._symbolEditDropdown.placeAt(this.originalChangeSymbology);
this._symbolEditDropdown.startup();this.set("symbolLayerDimensionType",this._defaultDimension);this.dimensions.textContent=e.symbologyEditor.type;var a="2D",b="3D";"esriGeometryPolyline"===this._geometryType?(a=e.symbologyEditor.line2d,b=e.symbologyEditor.path3d):"esriGeometryPoint"===this._geometryType?(a=e.symbologyEditor.icon2d,b=e.symbologyEditor.object3D):"esriGeometryPolygon"===this._geometryType&&(a=e.symbologyEditor.polygon2d,b=e.symbologyEditor.polygon3d);this._symbol2D3D=new k({className:"toggle2D3D",
options:[{label:a,value:"2D",selected:"2d"===this._defaultDimension},{label:b,value:"3D",selected:"3d"===this._defaultDimension}]});this._onHandles.push(l(this._symbol2D3D,"change",function(a){this._toggleDimension(a)}.bind(this)));this._symbol2D3D.placeAt(this.changeDimension);this._symbol2D3D.startup();this._setupSymbolLayerEditors(!1);this.layer._websceneEditorProperties.editedFlags.renderer?this._enableEditing(!1):this._disableEditing()},_toggleSymbols:function(a){"Original"===a?this._disableEditing():
(this._enableEditing(!0),this.editor.setWebSceneChanged())},_toggleDimension:function(a){"2D"===a?this.set("symbolLayerDimensionType","2d"):this.set("symbolLayerDimensionType","3d")},_disableEditing:function(){this._editingInitialized&&this._resetLayerSymbology();c.add(this.editorWrapper,"disable")},_enableEditing:function(a){this.layer._websceneEditorProperties.editedFlags.renderer;c.remove(this.editorWrapper,"disable");a&&this._symbolLayerEditors.forEach(function(a){a.updateSymbolLayerFromUI()});
this._editingInitialized=!0},_resetLayerSymbology:function(){var a=this.layer._websceneEditorProperties.originalRenderer;a!==this.layer.get("renderer")&&(this.layer.set("renderer",a),this.layer._websceneEditorProperties.editedFlags.renderer=!1,this._symbolLayerEditors.forEach(function(a){a.updateUIFromSelectedValues()}))},_toggleOriginalSymbologyClickHandler:function(a){this._disableEditing()},_toggleEditedSymbologyClickHandler:function(a){this._enableEditing(!0);this.editor.setWebSceneChanged()},
_setupSymbolLayerEditors:function(a){switch(this._geometryType){case "esriGeometryPoint":this._createPointSymbolLayers(a);break;case "esriGeometryPolyline":this._createLineSymbolLayers(a);break;case "esriGeometryPolygon":this._createPolygonSymbolLayers(a);break;case "esriGeometryMesh":this.set("symbolLayerDimensionType","2d"),this._hide2d3dToggle(),this._createMeshSymbolLayers(a)}},_createPointSymbolLayers:function(a){var b=new z({dimensionType:this.symbolLayerDimensionType,layer:this.layer,view:this.view,
colorTitle:e.symbologyEditor.fillColor});this._addSymbolLayerEditor(b);var d=b.watch("symbolLayer",function(a,d,g){"Object"!==g.type?(c.remove(b.outlineSizeText,"hide"),c.remove(b.selectedOutlineColorDropdown.domNode,"hide"),c.remove(b.outlineSizeInput.domNode,"hide")):(c.add(b.outlineSizeText,"hide"),c.add(b.selectedOutlineColorDropdown.domNode,"hide"),c.add(b.outlineSizeInput.domNode,"hide"));a=w.fromJSON({type:"PointSymbol3D",symbolLayers:[g]});a=new h(a);this._applyRendererToLayer(a)}.bind(this));
this._onHandles.push(d);a&&b.updateSymbolLayerFromUI()},_createLineSymbolLayers:function(a){var b=new p({dimensionType:this.symbolLayerDimensionType,layer:this.layer,view:this.view});this._addSymbolLayerEditor(b);var c=b.watch("symbolLayer",function(a,b,c){a=x.fromJSON({type:"LineSymbol3D",symbolLayers:[c]});a=new h(a);this._applyRendererToLayer(a)}.bind(this));this._onHandles.push(c);a&&b.updateSymbolLayerFromUI()},_createPolygonSymbolLayers:function(a){var b=new q({dimensionType:this.symbolLayerDimensionType,
layer:this.layer,view:this.view,colorTitle:e.symbologyEditor.fillColor});this._addSymbolLayerEditor(b);var d=new p({dimensionType:this.symbolLayerDimensionType,layer:this.layer,view:this.view,colorTitle:e.symbologyEditor.outlineColor,sizeTitle:e.symbologyEditor.outlineSize});this._addSymbolLayerEditor(d);b.updateSymbolLayerFromUI();d.updateSymbolLayerFromUI();var f=b.watch("symbolLayer",function(a,b,f){a=d.get("symbolLayer");b=[];b.push(f);"Extrude"!==f.type&&"tube"!==a.profile?(b.push(a),c.remove(d.sizeText,
"hide"),c.remove(d.selectedColorDropdown.domNode,"hide"),c.remove(d.sizeInput.domNode,"hide")):(c.add(d.sizeText,"hide"),c.add(d.selectedColorDropdown.domNode,"hide"),c.add(d.sizeInput.domNode,"hide"));f=n.fromJSON({type:"PolygonSymbol3D",symbolLayers:b});f=new h(f);this._applyRendererToLayer(f)}.bind(this));this._onHandles.push(f);f=d.watch("symbolLayer",function(a,f,e){a=b.get("symbolLayer");f=[a];"Extrude"!==a.type&&(f.push(e),c.remove(d.sizeText,"hide"),c.remove(d.selectedColorDropdown.domNode,
"hide"),c.remove(d.sizeInput.domNode,"hide"));e=n.fromJSON({type:"PolygonSymbol3D",symbolLayers:f});e=new h(e);this._applyRendererToLayer(e)}.bind(this));this._onHandles.push(f);a&&b.updateSymbolLayerFromUI()},_createMeshSymbolLayers:function(a){var b=new q({dimensionType:this.symbolLayerDimensionType,layer:this.layer,view:this.view});this._addSymbolLayerEditor(b);var c=b.watch("symbolLayer",function(a,b,c){a=y.fromJSON({symbolLayers:[c]});a=new h(a);this._applyRendererToLayer(a)}.bind(this));this._onHandles.push(c);
a&&b.updateSymbolLayerFromUI()},_addSymbolLayerEditor:function(a){a.placeAt(this.symbolLayerContainer);a.startup();this._symbolLayerEditors.push(a)},_disable3d:function(){this.set("symbolLayerDimensionType","2d");this._symbol2D3D.set("value","2D");c.add(this._symbol2D3D.domNode,"disable")},_hide2d3dToggle:function(){c.add(this._symbol2D3D.domNode,"disable")},_needsShield:function(a){if(null==a)return!1;if(!a.toJSON||"simple"!==a.toJSON().type)return!0;if(!(null==a||(a.infos&&0<a.infos.length?null!=
a.infos[0].symbol.symbolLayers:a.symbol&&null!=a.symbol.symbolLayers)))null!=a&&(a=m.toWeb3DRenderer(a));a=a.symbol;if(!a||0===a.symbolLayers.length)return!0;switch(this._geometryType){case "esriGeometryPoint":if(1<a.symbolLayers.length||!a.symbolLayers[0].resource||!a.symbolLayers[0].resource.primitive)return!0;break;case "esriGeometryPolyline":if(1<a.symbolLayers.length)return!0;break;case "esriGeometryPolygon":if(2<a.symbolLayers.length)return!0}return!1},_readDimensionFromRenderer:function(a){if(a&&
a.symbol)return a=m.toWeb3DRenderer(a).symbol.symbolLayers[0],"Object"===a.type||"Path"===a.type||"Extrude"===a.type?"3d":"2d"},_applyRendererToLayer:function(a){A(this.layer.renderer,a)||(c.remove(this.symbologyLoading,"hide"),setTimeout(function(){this.layer.set("renderer",a);var b=this.view.getLayerView(this.layer);if(b["symbols-updating"])var b=this.view.getLayerView(this.layer),d=b.on("symbols-updating-change",function(a){!1===a.newValue&&(c.add(this.symbologyLoading,"hide"),d.remove())}.bind(this));
else c.add(this.symbologyLoading,"hide")}.bind(this),100),this.layer._websceneEditorProperties.editedFlags.renderer=!0)},updateUIFromSelectedValues:function(){var a=this.getSelectedShape();this.shapePickerDropdown.set("label",a);a=this.getSelectedColor();this._setColorSwatch(a);a=this.getSelectedSize();this.sizeInput.set("value",a,!1)}})});