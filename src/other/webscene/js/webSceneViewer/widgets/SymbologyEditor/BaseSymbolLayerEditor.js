// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("esri/core/declare dojo/keys dojo/dom-class dojo/dom-style dojo/query esri/geometry/ScreenPoint dojo/i18n!../nls/widgets".split(" "),function(h,e,c,f,d,g,b){function k(a){a="#"==a.charAt(0)?a.substring(1,7):a;var b=parseInt(a.substring(0,2),16),c=parseInt(a.substring(2,4),16);a=parseInt(a.substring(4,6),16);return[b,c,a]}return h([],{view:void 0,layer:void 0,dimensionType:void 0,colorTitle:void 0,sizeTitle:void 0,_initialSize:void 0,_setDimensionTypeAttr:function(a){a!==this.dimensionType&&
(this.sizeText&&(this.sizeText.textContent=this.sizeTitle+" ("+("2d"===a?b.symbologyEditor.px:b.symbologyEditor.meters)+")"),this.extrusionHeightInput&&("3d"===a?(c.remove(this.extrusionHeightInput.domNode,"hide"),c.remove(this.extrusionHeightText,"hide")):(c.add(this.extrusionHeightInput.domNode,"hide"),c.add(this.extrusionHeightText,"hide"))),this._set("dimensionType",a),this._set("dimensionType",a),this._initialSize&&this.updateOptimal3DSize(),this.updateUIFromSelectedValues(),this.updateSymbolLayerFromUI())},
symbolLayer:void 0,constructor:function(a,b){this._selectedShape={"2d":"circle","3d":"sphere"};this._selectedColor={"2d":[50,205,50],"3d":[50,205,50]};this._selectedSize={"2d":16,"3d":50};this._selectedTransparency={"2d":0,"3d":0};this._selectedOutlineColor={"2d":[0,0,0],"3d":[0,0,0]};this._selectedOutlineSize={"2d":1,"3d":1};this._selectedOutlineTransparency={"2d":0,"3d":0};this._initialSize=!0;this._readLayerSymbology(a.layer.renderer)},destroy:function(){this.inherited(arguments);this.layer=null},
_initUIStrings:function(){void 0===this.colorTitle&&(this.colorTitle=b.symbologyEditor.color);void 0===this.sizeTitle&&(this.sizeTitle=b.symbologyEditor.size);this.extrusionHeightInput&&"2d"===this.dimensionType&&(c.add(this.extrusionHeightInput.domNode,"hide"),c.add(this.extrusionHeightText,"hide"));this.extrusionHeightText&&(this.extrusionHeightText.textContent=b.symbologyEditor.extrusion);this.shapeText&&(this.shapeText.textContent=b.symbologyEditor.shape);this.colorText&&(this.colorText.textContent=
this.colorTitle);this.sizeText&&(this.sizeText.textContent=this.sizeTitle+" ("+("2d"===this.dimensionType?b.symbologyEditor.px:b.symbologyEditor.meters)+")");this.transparencyText&&(this.transparencyText.textContent=b.symbologyEditor.transparency);this.outlineSizeText&&(this.outlineSizeText.textContent=b.symbologyEditor.outlineSize+" ("+("2d"===this.dimensionType?b.symbologyEditor.px:b.symbologyEditor.meters)+")");this.OutlineTransparencyText&&(this.OutlineTransparencyText.textContent=b.symbologyEditor.transparency);
this.outlineColorText&&(this.outlineColorText.textContent=b.symbologyEditor.outlineColor)},setSelectedColor:function(a){this._setColorSwatch(a,this.getSelectedTransparency());this._selectedColor["2d"]=a;this._selectedColor["3d"]=a},getSelectedColor:function(){return this._selectedColor[this.dimensionType]},setSelectedTransparency:function(a,b){this.transparencyInput&&this.transparencyInput.get("value")!==a&&(b?this.transparencyInput._set("value",a):this.transparencyInput.set("value",a));this._setColorSwatch(this.getSelectedColor(),
a);this._selectedTransparency["2d"]=a;this._selectedTransparency["3d"]=a},getSelectedTransparency:function(){return this._selectedTransparency[this.dimensionType]},setSelectedSize:function(a,b){this.sizeInput&&this.sizeInput.get("value")!==a&&(b?this.sizeInput._set("value",a):this.sizeInput.set("value",a));this._selectedSize[this.dimensionType]=a},updateOptimal3DSize:function(){if("3d"===this.dimensionType){var a=this.view.pixelSizeAt(new g(0.5*this.view.width,0.5*this.view.height));0>=a&&(a=this.view.pixelSizeAt(new g(0.5*
this.view.width,0.95*this.view.height)),0>=a&&(a=this.view.get("camera").position,a.z=0,a=2*this.view.pixelSizeAt(a)));this._initialSize=!1;this._selectedSize[this.dimensionType]=this._roundToUserFriendly(10*a)}},getSelectedSize:function(){return this._selectedSize[this.dimensionType]},_roundToUserFriendly:function(a){return 10>=a?Math.round(10*a)/10:1E3>=a?Math.round(a):10*Math.round(a/10)},updateUIFromSelectedValues:function(){throw Error("this method must be implemented in a subclass");},updateSymbolLayerFromUI:function(){throw Error("this method must be implemented in a subclass");
},_readLayerSymbology:function(a){throw Error("this method must be implemented in a subclass");},_readColorFromSymbolLayer:function(a){a.material&&(a=a.material.get("color"),this._selectedColor["3d"]=a.toRgb(),this._selectedColor["2d"]=a.toRgb(),a=100*(1-a.a),this._selectedTransparency["3d"]=a,this._selectedTransparency["2d"]=a)},_setColorSwatch:function(a,b){var c=1-b/100;isNaN(c)&&(c=1);"string"!==typeof a&&(a="rgba("+a[0]+","+a[1]+","+a[2]+","+c+")");0<d(".colorSwatch",this.domNode).length?f.set(d(".colorSwatch",
this.domNode)[0],"backgroundColor",a):setTimeout(function(){f.set(d(".colorSwatch",this.domNode)[0],"backgroundColor",a)}.bind(this),200)},_onColorPaletteWidgetChange:function(a){this.selectedColorDropdown.closeDropDown();a!==this.getSelectedColor()&&(this.setSelectedColor(k(a)),this.updateSymbolLayerFromUI())},_updateSizeInputSelectedValue:function(){0>this.sizeInput.get("value")?this.sizeInput.set("value",this._selectedSize[this.dimensionType]):null!=this.sizeInput.get("value")&&this.sizeInput.get("value")!==
this.getSelectedSize()&&(this.setSelectedSize(this.sizeInput.get("value")),this.updateSymbolLayerFromUI())},_onSizeInputKeypressHandler:function(a){(a.charOrCode||a.keyCode)==e.ENTER&&this._updateSizeInputSelectedValue()},_updateTransparencyInputSelectedValue:function(){0>this.transparencyInput.get("value")||100<this.transparencyInput.get("value")?this.transparencyInput.set("value",this._selectedTransparency[this.dimensionType]):null!=this.transparencyInput.get("value")&&this.transparencyInput.get("value")!==
this.getSelectedTransparency()&&(this.setSelectedTransparency(this.transparencyInput.get("value")),this.updateSymbolLayerFromUI())},_onTransparencyInputKeypressHandler:function(a){(a.charOrCode||a.keyCode)==e.ENTER&&this._updateTransparencyInputSelectedValue()}})});