// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("../../../core/declare dojo/keys dojo/dom dojo/aspect ../../../core/sniff ../../inputs/Handler ../../2d/viewpointUtils".split(" "),function(k,g,l,h,m,n,f){return k(n,{declaredClass:"esri.views.2d.handlers.Navigation",constructor:function(){this.scroll=this.scroll.bind(this);this._surfaceWatcher=this._surfaceWatcher.bind(this);this.watch("surface",this._surfaceWatcher);this._mouseDownHandler=this._mouseDownHandler.bind(this);this._mouseUpHandler=this._mouseUpHandler.bind(this);this._mouseRotateHandler=
this._mouseRotateHandler.bind(this);h.around(this,"tap",this._tapTest.bind(this));h.around(this,"click",this._tapTest.bind(this))},_scrollAccum:0,_lastPosition:null,useSmartNavigation:!1,mouseRotate:"right",mouseZoomOut:g.SHIFT,mouseWheelZoom:!0,pan:function(a){var b=a.deltaX,c=a.deltaY,d=a.lastEvent,b=d?d.deltaX-b:-b,c=d?c-d.deltaY:c,d=this.view,e=0,e=a.eventType;e==this._phaseDict.START&&(d.interacting=!0);e>=this._phaseDict.END?d.interacting=!1:(d.interacting||(d.interacting=!0),0===b&&0===c||
(this._hasRotateKey(a.srcEvent)?(e=Math.abs(b)>Math.abs(c)?b:c,d.viewpoint=this._scaleAndRotateViewpoint(Math.floor(d.width/2),Math.floor(d.height/2),1,e)):d.viewpoint=f.translateBy(this.viewpoint,d.viewpoint,[b||0,c||0])))},"double-tap":function(a){var b=a.srcEvent.shiftKey?0.5:2,c=this.view;c.interacting=!1;c.animateTo(this._scaleViewpoint(a.center.x,a.center.y,b))},pinch:function(a){var b=this.view,c=a.lastEvent,d=a.scale,e=a.rotation,g=a.eventType;if(!(1===d&&0===e)){var e=c?e-c.rotation:e,d=
c?d/c.scale:d,c=Math.abs(1-d),f=Math.abs(e/90);g>=this._phaseDict.END?b.interacting=!1:(!1===b.interacting&&(b.interacting=!0),c>=f&&1!==d?b.viewpoint=this._scaleViewpoint(a.center.x,a.center.y,d):f>c&&0!==e&&(b.viewpoint=this._scaleAndRotateViewpoint(a.center.x,a.center.y,d,e)))}},scroll:function(a){if(this.mouseWheelZoom){a.stopPropagation();a.preventDefault();var b=this.view,c=-1*a.deltaY;if(0!==c){var d=m("ff")?9:this.view.height/4;this._scrollAccum=0<c&&0<=this._scrollAccum||0>c&&0>=this._scrollAccum?
this._scrollAccum+c:c;Math.abs(this._scrollAccum)>d&&(this._scrollAccum=0,b.interacting=!1,b.animateTo(this._scaleViewpoint(a.clientX,a.clientY,0>c?0.5:2)))}}},tap:function(a){},click:function(a){},hold:function(a){},swipe:function(a){},_mouseDownHandler:function(a){if(0<a.button){a.preventDefault();a.stopImmediatePropagation();var b=this.surface;this._lastPosition=this.view.pageToContainer(a.clientX,a.clientY,this._lastPosition);b.addEventListener("mousemove",this._mouseRotateHandler);b.addEventListener("mouseup",
this._mouseUpHandler);this.view.interacting=!0}},_mouseUpHandler:function(a){var b=this.surface;0<a.button&&(b.removeEventListener("mousemove",this._mouseRotateHandler),b.removeEventListener("mouseup",this._mouseUpHandler),this.view.interacting=!1)},_mouseRotateHandler:function(a){var b=this.view;this._coords=b.pageToContainer(a.clientX,a.clientY,this._coords);a=f.angleBetween(b.state.paddedScreenCenter,this._lastPosition,this._coords);b.viewpoint=f.rotateBy(this.viewpoint,b.content.viewpoint,a);
b=this._lastPosition;this._lastPosition=this._coords;this._coords=b},_contextStop:function(a){a.preventDefault()},_surfaceWatcher:function(a,b){b&&(b.removeEventListener("wheel",this.scroll),b.removeEventListener("mousedown",this._mouseDownHandler));if(a&&(l.setSelectable(a,!1),a.addEventListener("wheel",this.scroll),"right"==this.mouseRotate||"center"==this.mouseRotate))a.addEventListener("mousedown",this._mouseDownHandler),a.addEventListener("contextmenu",this._contextStop,!0)},_scaleViewpoint:function(a,
b,c){var d=this.view;a=this._getContentCoords(a,b,d);return f.scaleBy(this.viewpoint,a.viewpoint,c,a.coordinates,d.content.size)},_scaleAndRotateViewpoint:function(a,b,c,d){var e=this.view;a=this._getContentCoords(a,b,e);return f.scaleAndRotateBy(this.viewpoint,a.viewpoint,c,d,a.coordinates,e.content.size)},_getContentCoords:function(a,b,c){var d=c.content,d=c.animation?c.animation.target:d.viewpoint;a=c.pageToContent(a,b);return{viewpoint:d,coordinates:a}},_tapTest:function(a){return function(b){this.view.hitTest(b.center.x,
b.center.y).then(function(c){b.graphic=c.graphic;b.mapPoint=c.mapPoint;a(b)})}},_hasRotateKey:function(a){var b=this.mouseRotate,c=!1;if(!1===b)return c;a.altKey&&b==g.ALT?c=!0:a.ctrlKey&&b==g.CTRL?c=!0:a.metaKey&&b==g.META?c=!0:a.shiftKey&&b==g.SHIFT&&(c=!0);return c}})});