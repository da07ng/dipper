// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/ItemProperties",["dijit","dojo","dojox","dojo/require!dijit/form/Form,dijit/form/TextBox,dijit/form/Button,dijit/form/CheckBox,dijit/Editor,dijit/_editor/plugins/FontChoice,dijit/_editor/plugins/TextColor,dijit/_editor/plugins/ViewSource,dojo/fx/easing,dijit/InlineEditBox,dijit/_Widget,dijit/_Templated,dijit/Toolbar,dijit/Menu,dojox/widget/Standby,dojo/data/ItemFileReadStore,dojo/DeferredList,dojo/promise/all,dgrid/Grid,dgrid/OnDemandGrid,dgrid/extensions/DijitRegistry,dojo/store/Observable,dgrid/editor,dijit/form/Select,dojo/on,dojo/aspect,dojo/has,arcgisonline/sharing/geow/Account,arcgisonline/sharing/geow/Content,arcgisonline/sharing/geow/Folder,arcgisonline/sharing/geow/Community,arcgisonline/sharing/util,arcgisonline/map/mapUtil,arcgisonline/sharing/dijit/dialog/AttachCodeDlg,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/dialog/ChoiceDlg,arcgisonline/sharing/dijit/dialog/TagsDlg,arcgisonline/sharing/dijit/dialog/UpdateItemDlg,arcgisonline/sharing/dijit/dialog/SelectAccountUserDlg,arcgisonline/sharing/dijit/dialog/AccountMoveToDlg,arcgisonline/sharing/dijit/dialog/SharingDlg,arcgisonline/sharing/dijit/dialog/ExportDlg,arcgisonline/sharing/dijit/dialog/ExtentDlg,arcgisonline/sharing/dijit/dialog/DeleteWarningDlg,arcgisonline/sharing/dijit/dialog/ManageTilesDlg,arcgisonline/sharing/dijit/dialog/PublishTileServiceDlg,arcgisonline/sharing/dijit/LinkDialog,arcgisonline/sharing/dijit/ComboBox,arcgisonline/sharing/dijit/ProfilePopup,arcgisonline/sharing/dijit/ItemRating,arcgisonline/sharing/dijit/dialog/AddItemDlg,arcgisonline/sharing/dijit/dialog/UsageDlg,arcgisonline/sharing/dijit/dialog/SubscriptionStatusDlg,arcgisonline/sharing/dijit/ServiceInfo,arcgisonline/sharing/dijit/dialog/LayerTimeSettings,arcgisonline/sharing/dijit/dialog/RegisterApp,arcgisonline/sharing/dijit/dialog/UsageApp,arcgisonline/sharing/dijit/dialog/ConfirmDialog,arcgisonline/sharing/dijit/dialog/ItemPropertiesDlg,arcgisonline/sharing/dijit/dialog/_CreateItemUtilMixin,arcgisonline/sharing/dijit/dialog/RateLimiting,esri/tasks/gp,esri/dijit/Tags"],
function(f,a,u){a.provide("arcgisonline.sharing.dijit.ItemProperties");a.require("dijit.form.Form");a.require("dijit.form.TextBox");a.require("dijit.form.Button");a.require("dijit.form.CheckBox");a.require("dijit.Editor");a.require("dijit._editor.plugins.FontChoice");a.require("dijit._editor.plugins.TextColor");a.require("dijit._editor.plugins.ViewSource");a.require("dojo.fx.easing");a.require("dijit.InlineEditBox");a.require("dijit._Widget");a.require("dijit._Templated");a.require("dijit.Toolbar");
a.require("dijit.Menu");a.require("dojox.widget.Standby");a.require("dojo.data.ItemFileReadStore");a.require("dojo.DeferredList");a.require("dojo.promise.all");a.require("dgrid.Grid");a.require("dgrid.OnDemandGrid");a.require("dgrid.extensions.DijitRegistry");a.require("dojo.store.Observable");a.require("dgrid.editor");a.require("dijit.form.Select");a.require("dojo.on");a.require("dojo.aspect");a.require("dojo.has");a.require("arcgisonline.sharing.geow.Account");a.require("arcgisonline.sharing.geow.Content");
a.require("arcgisonline.sharing.geow.Folder");a.require("arcgisonline.sharing.geow.Community");a.require("arcgisonline.sharing.util");a.require("arcgisonline.map.mapUtil");a.require("arcgisonline.sharing.dijit.dialog.AttachCodeDlg");a.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");a.require("arcgisonline.sharing.dijit.dialog.ChoiceDlg");a.require("arcgisonline.sharing.dijit.dialog.TagsDlg");a.require("arcgisonline.sharing.dijit.dialog.UpdateItemDlg");a.require("arcgisonline.sharing.dijit.dialog.SelectAccountUserDlg");
a.require("arcgisonline.sharing.dijit.dialog.AccountMoveToDlg");a.require("arcgisonline.sharing.dijit.dialog.SharingDlg");a.require("arcgisonline.sharing.dijit.dialog.ExportDlg");a.require("arcgisonline.sharing.dijit.dialog.ExtentDlg");a.require("arcgisonline.sharing.dijit.dialog.DeleteWarningDlg");a.require("arcgisonline.sharing.dijit.dialog.ManageTilesDlg");a.require("arcgisonline.sharing.dijit.dialog.PublishTileServiceDlg");a.require("arcgisonline.sharing.dijit.LinkDialog");a.require("arcgisonline.sharing.dijit.ComboBox");
a.require("arcgisonline.sharing.dijit.ProfilePopup");a.require("arcgisonline.sharing.dijit.ItemRating");a.require("arcgisonline.sharing.dijit.dialog.AddItemDlg");a.require("arcgisonline.sharing.dijit.dialog.UsageDlg");a.require("arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg");a.require("arcgisonline.sharing.dijit.ServiceInfo");a.require("arcgisonline.sharing.dijit.dialog.LayerTimeSettings");a.require("arcgisonline.sharing.dijit.dialog.RegisterApp");a.require("arcgisonline.sharing.dijit.dialog.UsageApp");
a.require("arcgisonline.sharing.dijit.dialog.ConfirmDialog");a.require("arcgisonline.sharing.dijit.dialog.ItemPropertiesDlg");a.require("arcgisonline.sharing.dijit.dialog._CreateItemUtilMixin");a.require("arcgisonline.sharing.dijit.dialog.RateLimiting");a.require("esri.tasks.gp");a.require("esri.dijit.Tags");a.declare("arcgisonline.sharing.dijit.ItemProperties",[f._Widget,f._Templated],{baseClass:"esriItem",widgetsInTemplate:!0,templateString:'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit.layout.ContentPane" data-dojo-props\x3d"region:\'top\'" class\x3d"esriItemLinks"\x3e\r\n    \x3cform id\x3d"item-form" data-dojo-type\x3d"dijit.form.Form" enctype\x3d"multipart/form-data" action\x3d"" method\x3d"post" onSubmit\x3d"return false;"\x3e\r\n      \x3cinput id\x3d"item-form-overwrite" name\x3d"overwrite" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d"false"/\x3e\r\n      \x3cinput id\x3d"item-form-item" name\x3d"item" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput id\x3d"item-form-url" name\x3d"url" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput id\x3d"item-form-title" name\x3d"title" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput id\x3d"item-form-tags" name\x3d"tags" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput id\x3d"item-form-type" name\x3d"type" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput id\x3d"item-form-type-keywords" name\x3d"typeKeywords" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput id\x3d"item-form-description" name\x3d"description" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput id\x3d"item-form-snippet" name\x3d"snippet" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput id\x3d"item-form-licenseInfo" name\x3d"licenseInfo" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput id\x3d"item-form-accessInformation" name\x3d"accessInformation" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput id\x3d"item-form-extent" name\x3d"extent" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput id\x3d"item-form-thumbnailURL" name\x3d"thumbnailURL" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput id\x3d"item-form-listingProperties" name\x3d"listingProperties" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n      \x3cinput id\x3d"clearEmptyFields" name\x3d"clearEmptyFields" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d"true"/\x3e\r\n\r\n      \x3c!--\x3cdiv data-dojo-type\x3d"dijit.layout.ContentPane" class\x3d"dijitReset ownerOnly"\x3e--\x3e\r\n        \x3cdiv id\x3d"item-edit-toolbar" class\x3d"editOnly item_edit_toobar item_edit_toobar_top" style\x3d"display:none;"\x3e\r\n          \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" id\x3d"item-save-button" class\x3d"calcite blue"\x3e\r\n            \x3cspan\x3e${i18n.save}\x3c/span\x3e\r\n          \x3c/button\x3e\r\n          \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" id\x3d"item-close-button" class\x3d"calcite transparent"\x3e\r\n            \x3cspan\x3e${i18n.cancel}\x3c/span\x3e\r\n          \x3c/button\x3e\r\n        \x3c/div\x3e\r\n      \x3c!--\x3c/div\x3e--\x3e\r\n\r\n      \x3c!-- don\'t add "position: relative;", otherwise the search box menu opens below --\x3e\r\n      \x3cdiv style\x3d"clear:both;"\x3e\r\n        \x3ch1 class\x3d"esriItemTitle page_title readOnly" id\x3d"item-title"\x3e\x3c/h1\x3e\r\n        \x3cspan id\x3d"item-title-edit" class\x3d"editOnly"\x3e\r\n          \x3cspan style\x3d"clear:none;margin-top:10px;" class\x3d"esriItemProperties"\x3e${i18n.title}\x3c/span\x3e\r\n          \x3cinput id\x3d"item-title-edit-input" class\x3d"esriItemTitle" data-dojo-type\x3d"dijit.form.TextBox" maxlength\x3d"250" data-dojo-props\x3d"trim:true" required\x3d"true" style\x3d"width:700px;" /\x3e\r\n        \x3c/span\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3c!-- fills entire width and clears  --\x3e\r\n      \x3c!-- don\'t add "position: relative;", otherwise the search box menu opens below --\x3e\r\n      \x3cdiv class\x3d"itemDetail medium left" style\x3d"margin-top: 15px; width: 100%;"\x3e\r\n        \x3cdiv class\x3d"itemThumbnailContainer" style\x3d"position:relative;"\x3e\r\n          \x3cspan id\x3d"item-thumbnail"\x3e\x3c/span\x3e\r\n\r\n          \x3cdiv data-dojo-attach-point\x3d"_favoritesNode" class\x3d"fav-icon" style\x3d"display:none;"\x3e\r\n            \x3ca href\x3d"#"\x3e\r\n              \x3cdiv data-dojo-attach-point\x3d"_favon" class\x3d"fav-on" style\x3d"display:none;"\x3e\r\n                \x3cdiv class\x3d"star-on"\x3e\x3c/div\x3e\r\n                \x3cp id\x3d"addString"\x3e${i18n.gallery.addFavorite}\x3c/p\x3e\r\n              \x3c/div\x3e\r\n            \x3c/a\x3e\r\n            \x3ca href\x3d"#"\x3e\r\n              \x3cdiv data-dojo-attach-point\x3d"_favoff" class\x3d"fav-off" style\x3d"display:none;"\x3e\r\n                \x3cdiv class\x3d"star-off"\x3e\x3c/div\x3e\r\n                \x3cp id\x3d"remString"\x3e${i18n.gallery.removeFavorite}\x3c/p\x3e\r\n              \x3c/div\x3e\r\n            \x3c/a\x3e\r\n          \x3c/div\x3e\r\n\r\n          \x3cspan id\x3d"item-thumbnail-text" style\x3d"padding-top:3px;color:#7B797B; display:none;"\x3e\x3c/span\x3e\r\n          \x3c!--\x3cspan data-dojo-attach-point\x3d"_openMenuContainer"\x3e\x3c/span\x3e--\x3e \x3c!-- moved to button --\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"itemTextContainer"\x3e\r\n          \x3cspan class\x3d"esriItemSnippet readOnly" id\x3d"item-summary"\x3e\x3c/span\x3e\r\n          \x3cspan class\x3d"editOnly" id\x3d"item-summary-edit"\x3e\r\n            \x3cspan style\x3d"clear:none;" class\x3d"esriItemProperties"\x3e${i18n.summary}\x3c/span\x3e\r\n            \x3cinput id\x3d"item-summary-edit-input" class\x3d"esriItemSnippet" data-dojo-type\x3d"dijit.form.TextBox" maxlength\x3d"250" data-dojo-props\x3d"trim:true" required\x3d"true" style\x3d"width:700px;" /\x3e\r\n          \x3c/span\x3e\r\n          \x3cspan class\x3d"readOnly"\x3e\r\n            \x3c!-- item author line --\x3e\r\n            \x3cspan class\x3d"dim"\x3e\x3cspan id\x3d"item-icon"\x3e\x3c/span\x3e\x3cspan id\x3d"item-type"\x3e\x3c/span\x3e\x26nbsp;${i18n.by} \x3c/span\x3e\r\n            \x3cspan class\x3d"esriItemAuthor" id\x3d"item-owner"\x3e\x3c/span\x3e\x3cbr/\x3e\r\n            \x3cdiv style\x3d"display:none" class\x3d"esriItemAuthor ownerOnly" id\x3d"item-source"\x3e${i18n.source}\x26nbsp;\x3ca id\x3d"item-source-url" href\x3d"#"\x3e\x3c/a\x3e\x3c/div\x3e\r\n            \x3cspan class\x3d"dim"\x3e${i18n.lastModified}: \x3cspan id\x3d"item-modified"\x3e\x3c/span\x3e\x3c/span\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_premiumNode" class\x3d"dim esriHide"\x3e\x3c/div\x3e\r\n          \x3c/span\x3e\r\n          \x3cspan class\x3d"dim readOnly"\x3e\x3cspan data-dojo-attach-point\x3d"ratingNode" style\x3d"zoom:0"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3e(\x3cspan class\x3d"ratingCount"\x3e\x3c/span\x3e\x3cspan class\x3d"viewCount"\x3e\x3c/span\x3e)\x3c/span\x3e\x3c/span\x3e\r\n          \x3cspan class\x3d"dim itemRatingLabel readOnly"\x3e\x3c/span\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_connectContainer" class\x3d"esriFloatLeading socialNetworkBadges"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv data-dojo-type\x3d"dijit.layout.ContentPane" data-dojo-attach-point\x3d"tools" class\x3d"toolbar dijitReset" style\x3d"margin-top: 1em; clear:both; visibility:hidden;"\x3e\r\n        \x3cspan style\x3d"display:inline-block;"\x3e\r\n          \x3cbutton data-dojo-type\x3d"dijit.form.DropDownButton" id\x3d"item-open-button" class\x3d"readOnly calcite blue" data-dojo-props\x3d"iconClass:\'esriOpenIcon\'"\x3e\r\n            \x3cspan\x3e${i18n.open}\x3c/span\x3e\r\n          \x3c/button\x3e\r\n          \x3cspan id\x3d"item-share-toolbar" class\x3d"ownerOnly readOnly" style\x3d"display:none;"\x3e\r\n            \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" id\x3d"item-share-button" class\x3d"readOnly calcite narrow transparent" data-dojo-props\x3d"iconClass:\'esriShareIcon\'"\x3e\r\n              \x3cspan\x3e${i18n.share}\x3c/span\x3e\r\n            \x3c/button\x3e\r\n          \x3c/span\x3e\r\n          \x3cspan id\x3d"item-create-toolbar" class\x3d"createApp" style\x3d"display:none;"\x3e\r\n            \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" id\x3d"item-create-button"\r\n                    class\x3d"readOnly calcite narrow transparent" data-dojo-props\x3d"iconClass:\'esriPublishIcon\'"\x3e\r\n              \x3cspan\x3e${i18n.create}\x3c/span\x3e\r\n            \x3c/button\x3e\r\n          \x3c/span\x3e\r\n          \x3cspan id\x3d"item-owner-toolbar" class\x3d"ownerOnly sharedOwner readOnly" style\x3d"display:none;"\x3e\r\n            \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" id\x3d"item-edit-button" class\x3d"calcite narrow transparent" data-dojo-props\x3d"iconClass:\'esriEditIcon\'"\x3e\r\n              \x3cspan\x3e${i18n.edit}\x3c/span\x3e\r\n            \x3c/button\x3e\r\n            \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" id\x3d"item-delete-button" class\x3d"notSharedOwner calcite narrow transparent" data-dojo-props\x3d"iconClass:\'esriDeleteIcon\'"\x3e\r\n              \x3cspan\x3e${i18n.deleteLabel}\x3c/span\x3e\r\n            \x3c/button\x3e\r\n            \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"publishOnly calcite narrow transparent" id\x3d"item-publish-button" data-dojo-props\x3d"iconClass:\'esriPublishIcon\'" data-dojo-attach-event\x3d"onClick:publishItem_onClick"\x3e\r\n              \x3cspan\x3e${i18n.publishItem}\x3c/span\x3e\r\n            \x3c/button\x3e\r\n            \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" id\x3d"item-publish-tile-service-button" class\x3d"calcite narrow transparent" data-dojo-props\x3d"iconClass:\'esriPublishIcon\'" data-dojo-attach-event\x3d"onClick:publishTileService_onClick" style\x3d"display:none;"\x3e\r\n              \x3cspan\x3e${i18n.publishItem}\x3c/span\x3e\r\n            \x3c/button\x3e\r\n            \x3cbutton data-dojo-type\x3d"dijit.form.DropDownButton" id\x3d"item-moveto-button" class\x3d"notSharedOwner calcite narrow transparent" disabled data-dojo-props\x3d"iconClass:\'esriMoveToIcon\'"\x3e\r\n              \x3cspan\x3e${i18n.moveTo}\x3c/span\x3e\r\n              \x3c!-- if we do this here the dropdown doesn\'t work\r\n              \x3cdiv data-dojo-type\x3d"dijit.Menu" id\x3d"item-moveto-menu"\x3e\r\n              \x3c/div\x3e\r\n              --\x3e\r\n            \x3c/button\x3e\r\n            \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" id\x3d"item-reassign-button" class\x3d"calcite transparent" data-dojo-props\x3d"iconClass:\'esriReassignIcon\'" style\x3d"display:none;"\x3e\r\n                \x3cspan\x3e${i18n.reassign}\x3c/span\x3e\r\n            \x3c/button\x3e\r\n            \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"usageOnly calcite transparent" id\x3d"item-usage-button" data-dojo-props\x3d"iconClass:\'esriUsageIcon\'" data-dojo-attach-event\x3d"onClick:showUsage_onClick"\x3e\r\n              \x3cspan\x3e${i18n.itemUsage}\x3c/span\x3e\r\n            \x3c/button\x3e\r\n            \x3cspan\x3e\r\n                \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"appOnly codeAttachment calcite transparent" id\x3d"item-attach-button" data-dojo-props\x3d"iconClass:\'esriAttachIcon\'" disabled data-dojo-attach-point\x3d"attachCodeButton" data-dojo-attach-event\x3d"onClick:attachCode_onClick"\x3e\r\n                  \x3cspan id\x3d"esriAttachButtonLabel"\x3e${i18n.attachCode}\x3c/span\x3e\r\n                \x3c/button\x3e\r\n            \x3c/span\x3e\r\n            \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"calcite transparent" data-dojo-props\x3d"iconClass:\'esriConfigureIcon\',disabled:true" style\x3d"display:none;" data-dojo-attach-point\x3d"configureAppButton" data-dojo-attach-event\x3d"onClick:configureApp_onClick"\x3e\r\n              \x3cspan id\x3d"esriConfigureButtonLabel"\x3e${i18n.configureApp}\x3c/span\x3e\r\n            \x3c/button\x3e\r\n            \x3c!--\x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"appOnly" data-dojo-props\x3d"iconClass:\'esriRegisterIcon\'" style\x3d"display:none;" data-dojo-attach-point\x3d"registerAppButton" data-dojo-attach-event\x3d"onClick:showRegisterDlg_onClick"\x3e--\x3e\r\n              \x3c!--\x3cspan id\x3d"esriRegisterButtonLabel"\x3e${i18n.registerApp}\x3c/span\x3e--\x3e\r\n            \x3c!--\x3c/button\x3e--\x3e\r\n            \x3cspan id\x3d"item-update-button-div" style\x3d"display:none;"\x3e\r\n              \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" id\x3d"item-update-button" class\x3d"calcite transparent" data-dojo-props\x3d"iconClass:\'esriUpdateIcon\'"\x3e\r\n                \x3cspan\x3e${i18n.update}\x3c/span\x3e\r\n              \x3c/button\x3e\r\n            \x3c/span\x3e\r\n          \x3c/span\x3e\r\n\r\n          \x3cspan id\x3d"item-metadata-button-span" style\x3d"display:none;"\x3e\r\n            \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" id\x3d"item-metadata-button" class\x3d"calcite transparent" data-dojo-props\x3d"iconClass:\'esriMetadataIcon\'"\x3e\r\n              \x3cspan\x3e${i18n.metadata}\x3c/span\x3e\r\n            \x3c/button\x3e\r\n          \x3c/span\x3e\r\n\r\n          \x3cspan id\x3d"item-export-toolbar" class\x3d"readOnly" style\x3d"display:none;"\x3e\r\n            \x3cbutton data-dojo-type\x3d"dijit.form.DropDownButton" id\x3d"item-export-layers-button" class\x3d"calcite narrow transparent" style\x3d"display:none;" data-dojo-props\x3d"iconClass:\'esriExportLayerIcon\'"\x3e\r\n              \x3cspan\x3e${i18n.exportLayers}\x3c/span\x3e\r\n            \x3c/button\x3e\r\n          \x3c/span\x3e\r\n\r\n        \x3c/span\x3e\r\n        \x3cdiv id\x3d"item-wait-toolbar" style\x3d"display:none;"\x3e\r\n          \x3cspan style\x3d"padding-left:10px;line-height:25px;"\x3e${i18n.wait}\x3c/span\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n        \x3cdiv class\x3d"section"\x3e\r\n          \x3c!-- Item Description --\x3e\r\n          \x3cspan class\x3d"esriItemProperties"\x3e${i18n.description}\x3c/span\x3e\r\n          \x3cp\x3e\r\n            \x3cspan id\x3d"item-description" class\x3d"readOnly" style\x3d"display: block; overflow: auto;"\x3e\x3c/span\x3e\r\n            \x3cspan id\x3d"item-description-edit-div" class\x3d"editOnly"\x3e\x3c/span\x3e\r\n          \x3c/p\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv class\x3d"section" data-dojo-attach-point\x3d"_itemAccessSection"\x3e\r\n          \x3c!-- Item Access --\x3e\r\n          \x3cspan class\x3d"esriItemProperties"\x3e${i18n.access}\x3c/span\x3e\r\n          \x3cp\x3e\r\n            \x3cspan id\x3d"item-licenseInfo" class\x3d"readOnly" style\x3d"display: block; overflow: auto;"\x3e\x3c/span\x3e\r\n            \x3cspan id\x3d"item-licenseInfo-edit-div" class\x3d"editOnly"\x3e\x3c/span\x3e\r\n          \x3c/p\x3e\r\n        \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"section" style\x3d"display:none;" data-dojo-attach-point\x3d"_screenshotSection"\x3e\r\n        \x3cspan class\x3d"readOnly esriItemProperties"\x3e${i18n.screenshots}\x3c/span\x3e\r\n        \x3cdiv id\x3d"screenshots" class\x3d"readOnly screenshots"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n       \x3cdiv class\x3d"section registerSection" data-dojo-attach-point\x3d"_itemRegistrationSection"\x3e\r\n          \x3c!-- Item Registration --\x3e\r\n          \x3cspan class\x3d"esriItemProperties"\x3e${i18n.registration}\x3c/span\x3e\r\n          \x3cdiv\x3e\r\n            \x3cspan data-dojo-attach-point\x3d"_registrationInfo" class\x3d"unRegisteredApp" style\x3d"display: block; overflow: auto;"\x3e${i18n.notRegistered}\x3c/span\x3e\r\n            \x3cdiv class\x3d"registered" style\x3d"margin-top:0.5em;"\x3e\r\n              \x3cdiv class\x3d"readOnly"\x3e\r\n                \x3cbutton class\x3d"registeredApp calcite transparent" data-dojo-type\x3d"dijit.form.Button" type\x3d"button"\r\n                        data-dojo-props\x3d"disabled:true" data-dojo-attach-point\x3d"registeredInfoButton" data-dojo-attach-event\x3d"onClick:showRegisterInfo_onClick"\x3e${i18n.registerAppInfo}\x3c/button\x3e\r\n                \x3cbutton class\x3d"unRegisteredApp calcite transparent" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-attach-point\x3d"registerAppButton" data-dojo-attach-event\x3d"onClick:showRegisterDlg_onClick"\x3e\r\n                  ${i18n.register}\r\n                \x3c/button\x3e\r\n                \x3cdiv class\x3d"registeredApp registration"\x3e\r\n                  \x3cdiv data-dojo-attach-point\x3d"_registration" style\x3d"margin:0.5em 0 0 0"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n              \x3cbutton class\x3d"editOnly calcite transparent" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-attach-point\x3d"registerEditButton" data-dojo-attach-event\x3d"onClick:showRegisterEditDlg_onClick"\x3e\r\n                ${i18n.registerEdit}\r\n              \x3c/button\x3e\r\n              \x3cbutton class\x3d"editOnly calcite transparent" data-dojo-type\x3d"dijit.form.Button" data-dojo-attach-point\x3d"_unRegisterApp" data-dojo-attach-event\x3d"onClick:unregisterApp" type\x3d"button"\x3e\r\n                ${i18n.unRegisterApp}\r\n              \x3c/button\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"readOnly section marketplaceSection" style\x3d"display:none;" data-dojo-attach-point\x3d"_itemMarketplaceSection"\x3e\r\n          \x3cspan class\x3d"esriItemProperties"\x3e${i18n.marketplace}\x3c/span\x3e\r\n          \x3cp data-dojo-attach-point\x3d"marketplaceInfo"\x3e${i18n.marketplaceInfo}\x3c/p\x3e\r\n          \x3cdiv\x3e\r\n            \x3cbutton class\x3d"createListing calcite transparent"  data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-attach-point\x3d"createListingButton" data-dojo-attach-event\x3d"onClick:createListing_onClick"\x3e\r\n              ${i18n.createListing}\r\n            \x3c/button\x3e\r\n            \x3cbutton class\x3d"viewListing calcite transparent"  data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-attach-point\x3d"viewListingButton" data-dojo-attach-event\x3d"onClick:viewListing_onClick"\x3e\r\n              ${i18n.viewListing}\r\n            \x3c/button\x3e\r\n            \x3cbutton class\x3d"viewListing calcite transparent" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-attach-point\x3d"unlistItemButton" data-dojo-attach-event\x3d"onClick:unlist_onClick"\x3e\r\n              ${i18n.unlistListing}\r\n            \x3c/button\x3e\r\n          \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"readOnly section advancedSection" style\x3d"display:none;"\r\n           data-dojo-attach-point\x3d"_itemAdvancedSection"\x3e\r\n        \x3cspan class\x3d"esriItemProperties"\x3e${i18n.advanced}\x3c/span\x3e\r\n        \x3cdiv\x3e\r\n          \x3cbutton class\x3d"calcite transparent" data-dojo-type\x3d"dijit.form.Button" type\x3d"button"\r\n                  data-dojo-attach-event\x3d"onClick:_showRateLimitDlg"\x3e\r\n            ${i18n.rateLimitingTitle}\r\n          \x3c/button\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"mapOnly urlOnly"\x3e\r\n      \x3cdiv class\x3d"section readOnly"\x3e\r\n          \x3c!-- Map Contents --\x3e\r\n          \x3cdiv class\x3d"mapOnly"\x3e\r\n            \x3cdiv class\x3d"readOnly"\x3e\r\n              \x3cspan class\x3d"esriItemProperties" id\x3d"map-contents-span" data-dojo-attach-point\x3d"mapContentsSpan"\x3e${i18n.mapContents}\x3c/span\x3e\r\n              \x3cspan id\x3d"item-map-contents" class\x3d"mapContents" style\x3d"display:block; overflow:hidden;"\x3e\x3c/span\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n\r\n          \x3cdiv class\x3d"urlOnly"\x3e\r\n            \x3cdiv class\x3d"readOnly"\x3e\r\n              \x3cspan id\x3d"item-rest-url-title" class\x3d"esriItemProperties"\x3e${i18n.restUrl}\x3c/span\x3e\r\n              \x3cp\x3e\r\n               \x3cspan id\x3d"item-rest-url" style\x3d"display:block; overflow:hidden;"\x3e\x3c/span\x3e\r\n              \x3c/p\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n         \x3c/div\x3e\r\n       \x3c/div\x3e\r\n         \x3cdiv class\x3d"section"\x3e\r\n         \x3c!-- Item Properties --\x3e\r\n          \x3cspan class\x3d"esriItemProperties"\x3e${i18n.properties}\x3c/span\x3e\r\n          \x3cdiv style\x3d"margin-top:1.0em;"\x3e\r\n          \x3cdiv class\x3d"appOnly application serviceEdit"\x3e\r\n            \x3ctable style\x3d"border-collapse: collapse;" width\x3d"100%"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd valign\x3d"top" width\x3d"140"\x3e\x3cspan\x3e${i18n.url}\x3c/span\x3e\x3c/td\x3e\r\n                  \x3ctd valign\x3d"top"\x3e\r\n                    \x3cdiv class\x3d"readOnly" id\x3d"item-url"\x3e\x3c/div\x3e\r\n                    \x3cinput id\x3d"item-url-edit-input" style\x3d"width: 95%;" class\x3d"editOnly serviceEdit" data-dojo-type\x3d"dijit.form.TextBox" maxlength\x3d"250" data-dojo-props\x3d"trim:true" /\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr\x3e\x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"appOnly"\x3e\r\n            \x3ctable class\x3d"readOnly" style\x3d"border-collapse: collapse;" width\x3d"100%"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd valign\x3d"top" width\x3d"140" nowrap\x3d"nowrap"\x3e\x3cspan class\x3d"codeAttachment"\x3e${i18n.codeAttachment}\x3c/span\x3e\x3c/td\x3e\r\n                  \x3ctd valign\x3d"top"\x3e\r\n                    \x3cdiv class\x3d"readOnly codeAttachment" id\x3d"item-attachment" style\x3d"width:460px;overflow:hidden;"\x3e\x3c/div\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr\x3e\x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd valign\x3d"top"\x3e\x3cspan\x3e${i18n.purpose}\x3c/span\x3e\x3c/td\x3e\r\n                  \x3ctd\x3e\x3cspan id\x3d"item-purpose"\x3e\x3c/span\x3e\x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr\x3e\x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd valign\x3d"top"\x3e\x3cspan data-dojo-attach-point\x3d"_apiLabel"\x3e${i18n.api}\x3c/span\x3e\x3c/td\x3e\r\n                  \x3ctd\x3e\x3cspan id\x3d"item-api"\x3e\x3c/span\x3e\x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr\x3e\x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n            \x3ctable class\x3d"editOnly" style\x3d"border-collapse: collapse;" width\x3d"100%"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd valign\x3d"top" width\x3d"140"\x3e\x3cspan\x3e${i18n.purpose}\x3c/span\x3e\x3c/td\x3e\r\n                  \x3ctd valign\x3d"top"\x3e\r\n                    \x3cselect style\x3d"margin:0;padding:0;" data-dojo-type\x3d"dijit.form.FilteringSelect" disabled\x3d"true" data-dojo-attach-point\x3d"_appPurposeSelect"\x3e\r\n                      \x3coption value\x3d"Ready To Use" selected\x3e${i18n.readyToUse}\x3c/option\x3e\r\n                      \x3coption value\x3d"Configurable"\x3e${i18n.configurable}\x3c/option\x3e\r\n                      \x3coption value\x3d"selfConfigured"\x3e${i18n.selfConfigurable}\x3c/option\x3e\r\n                      \x3coption value\x3d"Code Sample"\x3e${i18n.codeSample}\x3c/option\x3e\r\n                    \x3c/select\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr\x3e\x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd valign\x3d"top"\x3e\x3cspan data-dojo-attach-point\x3d"_apiEditLabel"\x3e${i18n.api}\x3c/span\x3e\x3c/td\x3e\r\n                  \x3ctd valign\x3d"top"\x3e\r\n                    \x3cselect data-dojo-type\x3d"arcgisonline.sharing.dijit.ComboBox" disabled\x3d"true" style\x3d"margin:0;padding:0;display:none;" data-dojo-attach-point\x3d"_webAppApiSelect"\x3e\r\n                      \x3coption value\x3d"JavaScript" selected\x3eJavaScript\x3c/option\x3e\r\n                      \x3coption value\x3d"Flex"\x3eFlex\x3c/option\x3e\r\n                      \x3coption value\x3d"Silverlight"\x3eSilverlight\x3c/option\x3e\r\n                      \x3coption value\x3d"Web ADF"\x3eWeb ADF\x3c/option\x3e\r\n                      \x3coption value\x3d"Other"\x3e${i18n.other}\x3c/option\x3e\r\n                    \x3c/select\x3e\r\n\r\n                    \x3cselect data-dojo-type\x3d"arcgisonline.sharing.dijit.ComboBox" disabled\x3d"true" style\x3d"margin:0;padding:0;display:none;" data-dojo-attach-point\x3d"_mobileAppApiSelect"\x3e\r\n                      \x3coption value\x3d"ArcGIS for iPhone" selected\x3eiOS\x3c/option\x3e\r\n                      \x3coption value\x3d"Windows Mobile"\x3eMobile\x3c/option\x3e\r\n                      \x3coption value\x3d"ArcGIS for Windows Phone"\x3eWindows Phone\x3c/option\x3e\r\n                      \x3coption value\x3d"ArcGIS for Android"\x3eAndroid\x3c/option\x3e\r\n                    \x3c/select\x3e\r\n\r\n                    \x3cselect data-dojo-type\x3d"arcgisonline.sharing.dijit.ComboBox" disabled\x3d"true" style\x3d"margin:0;padding:0;display:none;" data-dojo-attach-point\x3d"_platformAppApiSelect"\x3e\r\n                      \x3coption value\x3d"Java" selected\x3eJava\x3c/option\x3e\r\n                      \x3coption value\x3d".NET\u2013Windows Desktop"\x3e.NET\u2013Windows Desktop\x3c/option\x3e\r\n                      \x3coption value\x3d"OS X"\x3eOS X\x3c/option\x3e\r\n                      \x3coption value\x3d"Qt"\x3eQt\x3c/option\x3e\r\n                      \x3coption value\x3d"WPF"\x3eWPF\x3c/option\x3e\r\n                    \x3c/select\x3e\r\n\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr\x3e\x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n          \x3c/div\x3e\r\n\r\n          \x3cdiv class\x3d"ownerOnly readOnly"\x3e\r\n            \x3cdiv class\x3d"registeredApp"\x3e\r\n              \x3ctable class\x3d"registerSection appUsageSection" style\x3d"display:none;border-collapse: collapse;" width\x3d"100%"\x3e\r\n                \x3ctbody\x3e\r\n                  \x3ctr\x3e\r\n                    \x3ctd valign\x3d"top" width\x3d"140"\x3e\x3cspan\x3e${i18n.creditUsage}\x3c/span\x3e\x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                      \x3ca href\x3d"#" data-dojo-attach-point\x3d"_itemUsage" id\x3d"item-usage"\x3e${i18n.creditUsageLink}\x3c/a\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                  \x3ctr\x3e\x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n                \x3c/tbody\x3e\r\n              \x3c/table\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n\r\n          \x3cdiv class\x3d"ownerOnly"\x3e\r\n            \x3cdiv class\x3d"readOnly"\x3e\r\n              \x3ctable class\x3d"readOnly" style\x3d"border-collapse: collapse;" width\x3d"100%"\x3e\r\n                \x3ctbody\x3e\r\n                  \x3ctr\x3e\r\n                    \x3ctd valign\x3d"top" width\x3d"140"\x3e\x3cspan\x3e${i18n.sharedWith}\x3c/span\x3e\x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                      \x3cspan id\x3d"item-shared-title"\x3e\x3c/span\x3e\r\n                      \x3cspan id\x3d"item-groups"\x3e\x3c/span\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                  \x3ctr\x3e\x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n                \x3c/tbody\x3e\r\n              \x3c/table\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n\r\n          \x3cdiv class\x3d"editOnly"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_serviceInfoPaneDiv" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n\r\n          \x3ctable style\x3d"border-collapse: collapse;" width\x3d"100%"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd valign\x3d"top" width\x3d"140"\x3e\x3cspan\x3e${i18n.tags}\x3c/span\x3e\x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cspan id\x3d"item-tags" class\x3d"readOnly"\x3e\x3c/span\x3e\r\n                  \x3cdiv id\x3d"item-tags-edit" class\x3d"editOnly"\x3e\r\n                    \x3cdiv id\x3d"item-tags-edit-input" data-dojo-attach-point\x3d"_tags" data-dojo-type\x3d"esri/dijit/Tags" data-dojo-props\x3d"minWidth:\'500px\',maxWidth:\'500px\'"\x3e\x3c/div\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd valign\x3d"top"\x3e\x3cspan\x3e${i18n.credits}\x3c/span\x3e\x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cspan id\x3d"item-copyright" class\x3d"readOnly"\x3e\x3c/span\x3e\r\n                  \x3cdiv id\x3d"item-copyright-edit" class\x3d"editOnly" style\x3d"line-height:20px;"\x3e\r\n                    \x3cdiv id\x3d"item-copyright-edit-input" data-dojo-type\x3d"dijit.form.TextBox" maxlength\x3d"250" data-dojo-props\x3d"trim:true" required\x3d"true" style\x3d"width:498px;"\x3e\x3c/div\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n              \x3ctr class\x3d"readOnly"\x3e\r\n                \x3ctd valign\x3d"top"\x3e\x3cspan\x3e${i18n.size}\x3c/span\x3e\x3c/td\x3e\r\n                \x3ctd\x3e\x3cspan class\x3d"" id\x3d"item-size"\x3e\x3c/span\x3e\x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\x3ctd class\x3d"ownerOnly" colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n              \x3ctr class\x3d"ownerOnly"\x3e\r\n                \x3ctd valign\x3d"top"\x3e\x3cspan\x3e${i18n.deleteProtectionLbl}\x3c/span\x3e\x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cspan id\x3d"item-delete-protection" class\x3d"readOnly"\x3e\x3c/span\x3e\r\n                  \x3cdiv id\x3d"item-delete-protection-edit" class\x3d"editOnly" style\x3d"line-height:20px;"\x3e\r\n                    \x3cinput id\x3d"item-delete-protection-edit-input" data-dojo-type\x3d"dijit.form.CheckBox"/\x3e\x26nbsp;\x3clabel style\x3d"vertical-align:middle;"\x3e${i18n.deleteProtectionMsg}\x3c/label\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\r\n              \x3ctd class\x3d"viewOnly" colspan\x3d"0" style\x3d"display:none;height: 0.5em;"\x3e\x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr class\x3d"viewOnly" style\x3d"display:none;"\x3e\r\n                \x3ctd class\x3d"ownerOnly sharedOwner" valign\x3d"top"\x3e\x3cspan\x3e${i18n.saveAs}\x3c/span\x3e\x3c/td\x3e\r\n                \x3ctd class\x3d"ownerOnly sharedOwner"\x3e\r\n                  \x3cspan id\x3d"item-view-only" class\x3d"readOnly"\x3e\x3c/span\x3e\r\n                  \x3cdiv id\x3d"item-view-only-edit" class\x3d"editOnly" style\x3d"line-height:20px;"\x3e\r\n                    \x3cinput id\x3d"item-view-only-edit-input" data-dojo-type\x3d"dijit.form.CheckBox"/\x3e\x26nbsp;\x3clabel style\x3d"vertical-align:middle;"\x3e${i18n.viewOnlyMsg}\x3c/label\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr class\x3d"orgMapOnly"\x3e\r\n                \x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr class\x3d"orgMapOnly" style\x3d"width:100%;"\x3e\r\n                \x3ctd class\x3d"ownerOnly sharedOwner" valign\x3d"top"\x3e\x3cspan\x3e${i18n.offlineModeLabel}\x3c/span\x3e\x3c/td\x3e\r\n                \x3ctd class\x3d"ownerOnly sharedOwner" valign\x3d"top"\x3e\r\n                  \x3cspan id\x3d"item-offline-map" class\x3d"readOnly"\x3e\x3c/span\x3e\r\n                  \x3cdiv id\x3d"item-offline-map-edit" class\x3d"editOnly" style\x3d"line-height:20px;"\x3e\r\n                    \x3cinput id\x3d"item-offline-map-edit-input" data-dojo-type\x3d"dijit.form.CheckBox" data-dojo-attach-event\x3d"onClick:checkOfflineModeSupport"/\x3e\x26nbsp;\x3clabel style\x3d"vertical-align:middle;"\x3e${i18n.offlineModeEnable}\x3c/label\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd valign\x3d"top"\x3e\x3cspan\x3e${i18n.extent}\x3c/span\x3e\x3c/td\x3e\r\n                \x3ctd valign\x3d"top"\x3e\r\n                  \x3cdiv id\x3d"item-description-extent-unavailable" style\x3d"display:none;"\x3e\r\n                    \x3cdiv id\x3d"item-extent-button-div1" style\x3d"display:none;"\x3e\r\n                      \x3cbutton style\x3d"margin:0;" data-dojo-type\x3d"dijit.form.Button" class\x3d"calcite light" type\x3d"button" id\x3d"item-extent-button1"\x3e${i18n.setExtent}\x3c/button\x3e\r\n                    \x3c/div\x3e\r\n                  \x3c/div\x3e\r\n\r\n                  \x3cdiv id\x3d"item-description-extent-available" style\x3d"display:none;"\x3e\r\n                    \x3ctable\x3e\r\n                      \x3ctr\x3e\r\n                        \x3ctd\x3e${i18n.left}:\x3c/td\x3e\r\n                        \x3ctd align\x3d"right" nowrap\x3d"nowrap"\x3e\x3cspan id\x3d"item-extent-left"\x3e\x3c/span\x3e\x3c/td\x3e\r\n                        \x3ctd style\x3d"width: 2em;"\x3e\x3c/td\x3e\r\n                        \x3ctd\x3e${i18n.right}:\x3c/td\x3e\r\n                        \x3ctd align\x3d"right" nowrap\x3d"nowrap"\x3e\x3cspan id\x3d"item-extent-right"\x3e\x3c/span\x3e\x3c/td\x3e\r\n                        \x3ctd rowspan\x3d"3"\x3e\r\n                          \x3cdiv id\x3d"item-extent-button-div2" style\x3d"display:none;padding-left:30px;"\x3e\r\n                            \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"calcite light" style\x3d"margin:0;" id\x3d"item-extent-button2"\x3e${i18n.setExtent}\x3c/button\x3e\r\n                          \x3c/div\x3e\r\n                        \x3c/td\x3e\r\n                      \x3c/tr\x3e\r\n                      \x3ctr\x3e\r\n                        \x3ctd colspan\x3d"5" style\x3d"line-height:5px;"\x3e\x26nbsp;\x3c/td\x3e\r\n                      \x3c/tr\x3e\r\n                      \x3ctr\x3e\r\n                        \x3ctd\x3e${i18n.top}:\x3c/td\x3e\r\n                        \x3ctd align\x3d"right" nowrap\x3d"nowrap"\x3e\x3cspan id\x3d"item-extent-top"\x3e\x3c/span\x3e\x3c/td\x3e\r\n                        \x3ctd\x3e\x3c/td\x3e\r\n                        \x3ctd\x3e${i18n.bottom}:\x3c/td\x3e\r\n                        \x3ctd align\x3d"right" nowrap\x3d"nowrap"\x3e\x3cspan id\x3d"item-extent-bottom"\x3e\x3c/span\x3e\x3c/td\x3e\r\n                        \x3ctd\x3e\x3c/td\x3e\r\n                      \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr class\x3d"operationsCollector" style\x3d"display:none;line-height: 20px;"\x3e\r\n                \x3c!--Collector app properties--\x3e\r\n                \x3ctd class\x3d"column" valign\x3d"top"\x3e\x3cspan\x3e${i18n.operationsCollector}\x3c/span\x3e\x3c/td\x3e\r\n                \x3ctd class\x3d"column"\x3e\r\n                  \x3cdiv class\x3d"editOnly"\x3e\r\n                      \x3cspan style\x3d"margin-top:0.7em;"\x3e${i18n.operationsCollectorSummary}\x3c/span\x3e\r\n                      \x3cbr/\x3e\r\n                      \x3cfieldset style\x3d"margin:0.7em 0 0.7em 0;"\x3e\r\n                          \x3cinput label\x3d"${i18n.opRouting}" class\x3d"opSetting" data-dojo-attach-point\x3d"_opRouting" type\x3d"checkbox" checked data-dojo-type\x3d"dijit.form.CheckBox" name\x3d"opRouting"/\x3e\r\n                          \x3clabel class\x3d"esriLeadingMargin05" for\x3d"opRouting"\x3e${i18n.opRouting}\x3c/label\x3e\r\n                          \x3cbr/\x3e\r\n                          \x3cinput label\x3d"${i18n.opMeasure}" class\x3d"opSetting" data-dojo-attach-point\x3d"_opMeasure" type\x3d"checkbox" checked data-dojo-type\x3d"dijit.form.CheckBox" name\x3d"opMeasure"/\x3e\r\n                          \x3clabel class\x3d"esriLeadingMargin05" for\x3d"opMeasure"\x3e${i18n.opMeasure}\x3c/label\x3e\r\n                          \x3cbr/\x3e\r\n                          \x3cinput label\x3d"${i18n.opBasemap}" class\x3d"opSetting" data-dojo-attach-point\x3d"_opBasemap" type\x3d"checkbox" checked data-dojo-type\x3d"dijit.form.CheckBox" name\x3d"opBasemap"/\x3e\r\n                          \x3clabel class\x3d"esriLeadingMargin05" for\x3d"opBasemap"\x3e${i18n.opBasemap}\x3c/label\x3e\r\n                          \x3cbr/\x3e\r\n                          \x3cinput label\x3d"${i18n.opFindLocations}" class\x3d"opSetting opFindLocations" data-dojo-attach-point\x3d"_opFindLocations" type\x3d"checkbox" checked data-dojo-type\x3d"dijit.form.CheckBox" name\x3d"opFindLocations"/\x3e\r\n                          \x3clabel class\x3d"esriLeadingMargin05 opFindLocations" for\x3d"opFindLocations"\x3e${i18n.opFindLocations}\x3c/label\x3e\r\n                          \x3cspan data-dojo-attach-point\x3d"_opFindLocationsLink" class\x3d"expcon opFindLocations"\x3e${i18n.customRoles.contract}\x3c/span\x3e\r\n                            \x3cdiv class\x3d"fieldsGrid opFindLocationsDiv opFindLocations esriLeadingMargin23" style\x3d"padding-top:5px;"\x3e\r\n                              \x3clabel class\x3d"opFindLocations" for\x3d"opFindLocations"\x3e${i18n.hintText}\x3c/label\x3e\x26nbsp;\r\n                              \x3cdiv class\x3d"opFindLocations" id\x3d"item-hint-text-input" data-dojo-attach-point\x3d"_opFindLocationsHintText" data-dojo-type\x3d"dijit.form.TextBox" value\x3d"${i18n.findPlace}" maxlength\x3d"250" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n                              \x3cbr /\x3e\r\n                              \x3cdiv style\x3d"margin-top:10px;"\x3e\r\n                                \x3cinput label\x3d"${i18n.findByLayer}" class\x3d"opSetting opFindLocations" data-dojo-attach-point\x3d"_opByLayer" type\x3d"checkbox" checked data-dojo-type\x3d"dijit.form.CheckBox" name\x3d"opByLayer"/\x3e\r\n                                \x3clabel class\x3d"esriLeadingMargin05 opFindLocations" for\x3d"opByLayer"\x3e${i18n.byLayer}\x3c/label\x3e\r\n                                \x3cbr/\x3e\r\n                                \x3cdiv data-dojo-attach-point\x3d"_byLayerDiv" class\x3d"byLayerDiv esriLeadingMargin23"\x3e\r\n                                  \x3cdiv class\x3d"opFindLocations" style\x3d"width:700px;height:auto;display:none;" data-dojo-attach-point\x3d"_opFindLocationsGrid"\x3e\x3c/div\x3e\r\n                                  \x3cdiv id\x3d"addFieldBtn" class\x3d"calcite transparent opFindLocations" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.addLayerFromUrlDlg.addLayerBtn}\x3c/div\x3e\r\n                                \x3c/div\x3e\r\n                              \x3c/div\x3e\r\n                              \x3cdiv style\x3d"margin-top:10px;"\x3e\r\n                                \x3cinput label\x3d"${i18n.findByAddress}" class\x3d"opSetting opFindLocations" data-dojo-attach-point\x3d"_opByAddress" type\x3d"checkbox" checked data-dojo-type\x3d"dijit.form.CheckBox" name\x3d"opByAddress"/\x3e\r\n                                \x3clabel class\x3d"esriLeadingMargin05 opFindLocations" for\x3d"opByAddress"\x3e${i18n.byAddress}\x3c/label\x3e\r\n                              \x3c/div\x3e\r\n                            \x3c/div\x3e\r\n                          \x3cbr/\x3e\r\n                          \x3cdiv class\x3d"opTracking"\x3e\r\n                              \x3cinput label\x3d"${i18n.opLocationTracking}" class\x3d"opSetting" type\x3d"checkbox" data-dojo-attach-point\x3d"_opTracking" data-dojo-type\x3d"dijit.form.CheckBox" name\x3d"opTracking"/\x3e\r\n                              \x3clabel class\x3d"esriLeadingMargin05" for\x3d"opTracking"\x3e${i18n.opTrackFrequency}\x3c/label\x3e\r\n                              \x3cselect class\x3d"esriLeadingMargin05 opSetting" data-dojo-attach-point\x3d"_opTrackingSelect" disabled data-dojo-type\x3d"dijit.form.Select"\x3e\r\n                                  \x3coption value\x3d"30"\x3e${i18n.thirtysec}\x3c/option\x3e\r\n                                  \x3coption value\x3d"60"\x3e${i18n.onemin}\x3c/option\x3e\r\n                                  \x3coption value\x3d"120"\x3e${i18n.twomin}\x3c/option\x3e\r\n                                  \x3coption value\x3d"300"\x3e${i18n.fivemin}\x3c/option\x3e\r\n                                  \x3coption value\x3d"1800"\x3e${i18n.thirtymin}\x3c/option\x3e\r\n                                  \x3coption value\x3d"3600"\x3e${i18n.onehour}\x3c/option\x3e\r\n                              \x3c/select\x3e\r\n                          \x3c/div\x3e\r\n                      \x3c/fieldset\x3e\r\n                  \x3c/div\x3e\r\n                  \x3cdiv data-dojo-attach-point\x3d"_opCollectorReadOnly" class\x3d"readOnly"\x3e\x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd colspan\x3d\'2\'\x3e\r\n                    \x3c!--Configuration string--\x3e\r\n                    \x3cdiv id\x3d"item-configuration" style\x3d"margin-top:2.0em;display:none;"\x3e\r\n                      \x3clabel for\x3d"item-form-text" style\x3d"margin-top:1.5em;"\x3e${i18n.configurationParameters}\x3c/label\x3e\x3cbr/\x3e\r\n                      \x3ctextarea data-dojo-type\x3d"dijit.form.SimpleTextarea" id\x3d"item-form-text" data-dojo-attach-point\x3d"configurationSettings" data-dojo-props\x3d"trim:true" name\x3d"text" class\x3d"dijitReset" style\x3d"margin: 0.7em 0 0 0;padding:0;border: 1px solid #ccc; clear:both; width:99%; height: 100px;"\x3e\r\n                      \x3c/textarea\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n\r\n          \x3ctable class\x3d"hostedTilesOnly" style\x3d"border-collapse:collapse; margin-top:2em;" width\x3d"100%"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr class\x3d"manageTiles-flag"\x3e\r\n                \x3ctd valign\x3d"top" width\x3d"140" class\x3d"hostedTilesCol"\x3e\x3cspan\x3e${i18n.tilesLabel}\x3c/span\x3e\x3c/td\x3e\r\n                \x3ctd\x3e\x3cspan class\x3d"" id\x3d"item-percentTiles"\x3e\x3c/span\x3e\x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd valign\x3d"top" width\x3d"140" class\x3d"hostedTilesCol"\x3e\x3cspan\x3e${i18n.visibleRangeLabel}\x3c/span\x3e\x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cspan class\x3d"readOnly" id\x3d"item-scaleRange"\x3e\x3c/span\x3e\r\n                  \x3cdiv class\x3d"editOnly" id\x3d"item-scaleRangeEdit"\x3e\r\n                    \x3cdiv style\x3d"width:200px;display:inline-block;" data-dojo-type\x3d"arcgisonline.sharing.dijit.ComboBox" data-dojo-attach-point\x3d"fromScaleRange"\x3e\x3c/div\x3e\r\n                    ${i18n.to}\r\n                    \x3cdiv style\x3d"width:200px;display:inline-block;" data-dojo-type\x3d"arcgisonline.sharing.dijit.ComboBox" data-dojo-attach-point\x3d"toScaleRange"\x3e\x3c/div\x3e\r\n                    \x3cbr/\x3e\r\n                    \x3cspan class\x3d"editOnly" data-dojo-attach-point\x3d"scaleNote"\x3e${i18n.scaleNote}\x3c/span\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n              \x3ctr class\x3d"exportTiles-flag"\x3e\r\n                \x3ctd valign\x3d"top" width\x3d"140" class\x3d"hostedTilesCol"\x3e\x3cspan\x3e${i18n.offlineModeLabel}\x3c/span\x3e\x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cspan class\x3d"readOnly" id\x3d"item-exportTiles"\x3e\x3c/span\x3e\r\n                  \x3cdiv class\x3d"editOnly" id\x3d"item-exportTiles-edit"\x3e\r\n                    \x3cspan\x3e\r\n                      \x3cdiv id\x3d"item-exportTiles-enable" data-dojo-attach-point\x3d"enableExportTiles"\r\n                           data-dojo-type\x3d"dijit.form.CheckBox" type\x3d"checkbox"\x3e\x3c/div\x3e\r\n                      \x3clabel for\x3d"item-exportTiles-enable"\x3e${i18n.offlineModeEnable}\x3c/label\x3e\r\n                    \x3c/span\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n\r\n          \x3ctable class\x3d"hostedFeaturesOnly" style\x3d"border-collapse:collapse; margin-top:2em;" width\x3d"100%"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd valign\x3d"top" width\x3d"140" class\x3d"hostedFeaturesCol"\x3e\x3cspan\x3e${i18n.editFeatures}\x3c/span\x3e\x3c/td\x3e\r\n                \x3ctd\x3e\r\n                    \x3cspan class\x3d"readOnly" id\x3d"item-editFeatures"\x3e\x3c/span\x3e\r\n                    \x3cdiv class\x3d"editOnly"\x3e\r\n                      \x3cspan\x3e\r\n                        \x3cdiv id\x3d"item-enable-editing" data-dojo-attach-point\x3d"enableEditing" data-dojo-type\x3d"dijit.form.CheckBox" data-dojo-attach-event\x3d"onChange:onEnableEditingChange" type\x3d"checkbox"\x3e\x3c/div\x3e\r\n                        \x3clabel for\x3d"item-enable-editing"\x3e${i18n.configEditFeatures}\x3c/label\x3e\r\n                      \x3c/span\x3e\x3cbr/\x3e\r\n                      \x3cspan class\x3d"esriLeadingMargin15"\x3e\r\n                        \x3cdiv name\x3d"editPermissions" id\x3d"item-enable-geometry-update" data-dojo-attach-point\x3d"enableGeometryUpdate" data-dojo-type\x3d"dijit.form.RadioButton" type\x3d"radio"\x3e\x3c/div\x3e\r\n                        \x3clabel for\x3d"item-enable-geometry-update"\x3e${i18n.configEditFeaturesAll}\x3c/label\x3e\r\n                      \x3c/span\x3e\x3cbr/\x3e\r\n                      \x3cspan class\x3d"esriLeadingMargin15"\x3e\r\n                        \x3cdiv name\x3d"editPermissions" id\x3d"item-disable-geometry-update" data-dojo-attach-point\x3d"disableGeometryUpdate" data-dojo-type\x3d"dijit.form.RadioButton" type\x3d"radio"\x3e\x3c/div\x3e\r\n                        \x3clabel for\x3d"item-disable-geometry-update"\x3e${i18n.configEditFeaturesUpdate}\x3c/label\x3e\r\n                      \x3c/span\x3e\x3cbr/\x3e\r\n                      \x3cspan class\x3d"esriLeadingMargin15"\x3e\r\n                        \x3cdiv name\x3d"editPermissions" id\x3d"item-enable-add-only" data-dojo-attach-point\x3d"allowAddOnly" data-dojo-type\x3d"dijit.form.RadioButton" type\x3d"radio"\x3e\x3c/div\x3e\r\n                        \x3clabel for\x3d"item-enable-add-only"\x3e${i18n.configEditFeaturesAdd}\x3c/label\x3e\r\n                      \x3c/span\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n              \x3ctr class\x3d"enableExport"\x3e\r\n                \x3ctd valign\x3d"top" class\x3d"hostedFeaturesCol"\x3e\x3cspan\x3e${i18n.exportLabel}\x3c/span\x3e\x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cspan class\x3d"readOnly" id\x3d"item-exportData"\x3e\x3c/span\x3e\r\n                  \x3cdiv class\x3d"editOnly" id\x3d"item-exportData-edit"\x3e\r\n                    \x3cspan\x3e\r\n                        \x3cdiv id\x3d"item-export-data" data-dojo-attach-point\x3d"enableExport" data-dojo-type\x3d"dijit.form.CheckBox" type\x3d"checkbox"\x3e\x3c/div\x3e\r\n                        \x3clabel for\x3d"item-export-data"\x3e${i18n.configEnableExport}\x3c/label\x3e\r\n                      \x3c/span\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd valign\x3d"top" class\x3d"hostedFeaturesCol portalSync"\x3e\x3cspan\x3e${i18n.syncLabel}\x3c/span\x3e\x3c/td\x3e\r\n                \x3ctd class\x3d"portalSync"\x3e\r\n                  \x3cspan class\x3d"readOnly" id\x3d"item-editSync"\x3e\x3c/span\x3e\r\n                  \x3cdiv class\x3d"editOnly" id\x3d"item-editSync-edit"\x3e\r\n                    \x3cspan\x3e\r\n                        \x3cdiv id\x3d"item-enable-sync" data-dojo-attach-point\x3d"enableSync" data-dojo-type\x3d"dijit.form.CheckBox" type\x3d"checkbox"\x3e\x3c/div\x3e\r\n                        \x3clabel for\x3d"item-enable-sync"\x3e${i18n.configEnableSync}\x3c/label\x3e\r\n                      \x3c/span\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\x3ctd colspan\x3d"0" style\x3d"height: 0.5em;"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd valign\x3d"top" class\x3d"hostedFeaturesCol portalEdits"\x3e\x3cspan\x3e${i18n.trackEdits}\x3c/span\x3e\x3c/td\x3e\r\n                \x3ctd class\x3d"portalEdits"\x3e\r\n                  \x3cspan class\x3d"readOnly" id\x3d"item-trackEdits"\x3e\x3c/span\x3e\r\n                  \x3cdiv class\x3d"editOnly" id\x3d"item-trackEdits-edit"\x3e\r\n                    \x3cspan\x3e\r\n                      \x3cdiv id\x3d"item-enable-tracking" data-dojo-attach-point\x3d"enableTracking" data-dojo-type\x3d"dijit.form.CheckBox" data-dojo-attach-event\x3d"onChange:onEnableTrackingChange" type\x3d"checkbox"\x3e\x3c/div\x3e\r\n                      \x3clabel for\x3d"item-enable-tracking"\x3e${i18n.configTrackEdits}\x3c/label\x3e\r\n                    \x3c/span\x3e\x3cbr/\x3e\r\n                    \x3cspan class\x3d"esriLeadingMargin15"\x3e\r\n                      \x3cdiv id\x3d"item-restrict-edits" data-dojo-attach-point\x3d"enableRestrictedEdits" data-dojo-type\x3d"dijit.form.CheckBox" data-dojo-attach-event\x3d"onClick:onRestrictedEditChange" type\x3d"checkbox"\x3e\x3c/div\x3e\r\n                      \x3clabel for\x3d"item-restrict-edits"\x3e${i18n.trackEditsRestricted}\x3c/label\x3e\r\n                    \x3c/span\x3e\x3cbr/\x3e\r\n                    \x3cspan class\x3d"esriLeadingMargin15"\x3e\r\n                      \x3cdiv id\x3d"item-restrict-view-edits" data-dojo-attach-point\x3d"enableViewEdits" data-dojo-type\x3d"dijit.form.CheckBox" data-dojo-attach-event\x3d"onClick:onRestrictedEditChange" type\x3d"checkbox"\x3e\x3c/div\x3e\r\n                      \x3clabel for\x3d"item-restrict-edits"\x3e${i18n.trackEditsView}\x3c/label\x3e\r\n                    \x3c/span\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n\r\n        \x3cdiv id\x3d"item-save-buttons" class\x3d"disply_none item_edit_toobar item_edit_toobar_bottom" style\x3d"display:none; "\x3e\r\n          \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" id\x3d"item-save-button2" class\x3d"calcite blue"\x3e\r\n            \x3cspan\x3e${i18n.save}\x3c/span\x3e\r\n          \x3c/button\x3e\r\n          \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" id\x3d"item-close-button2" class\x3d"calcite transparent"\x3e\r\n            \x3cspan\x3e${i18n.cancel}\x3c/span\x3e\r\n          \x3c/button\x3e\r\n        \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv class\x3d"section" data-dojo-attach-point\x3d"_commentsSection"\x3e\r\n          \x3c!-- Comments --\x3e\r\n          \x3cspan class\x3d"esriItemProperties"\x3e${i18n.comments} \x3cspan style\x3d"font-weight:lighter;"\x3e(\x3cspan class\x3d"commentCount"\x3e\x3c/span\x3e)\x3c/span\x3e \x3ca href\x3d"#" target\x3d"_blank" data-dojo-attach-point\x3d"commentsRSSLink" style\x3d"display:none;"\x3e\x3cimg data-dojo-attach-point\x3d"commentsRSS" alt\x3d"${i18n.commentsFeed}" class\x3d"feedRSS" style\x3d"vertical-align:middle;" title\x3d"${i18n.commentsFeed}"\x3e\x3c/a\x3e\x3c/span\x3e\r\n\r\n          \x3cdiv style\x3d"height: auto; padding: 0.5em; margin-top: 1em;" class\x3d"commentsDisabled"\x3e\r\n            \x3cspan\x3e${i18n.commentsDisabled}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n\r\n          \x3cdiv style\x3d"clear:both; height: auto; overflow: auto; padding: 0.5em; margin-top: 1em;" class\x3d"commentsEnabled scrollPane"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"comments"\x3e\x3c!-- comments go in here --\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n\r\n          \x3cp\x3e\x3c/p\x3e\r\n\r\n          \x3cdiv data-dojo-attach-point\x3d"addCommentPane" style\x3d"display:none;"\x3e\r\n          \x3cspan\x3e${i18n.addComment}\x3c/span\x3e\r\n          \x3ctextarea data-dojo-attach-point\x3d"newComment" class\x3d"dijitReset" style\x3d"margin-top:0.5em;border: 1px solid #ccc; width:99% !important; max-width:99% !important; min-width:99% !important; height:100px; max-height:100px !important; min-height:100px !important; resize:none;"\x3e\x3c/textarea\x3e\r\n          \x3cdiv data-dojo-type\x3d"dijit.form.Button" data-dojo-attach-point\x3d"publishCommentButton" class\x3d"calcite light" data-dojo-attach-event\x3d"onClick:publishComment" style\x3d"margin-top:0.5em;"\x3e${i18n.publishComment}\x3c/div\x3e\r\n          \x3c/div\x3e\r\n\r\n          \x3cdiv data-dojo-attach-point\x3d"signInPane" style\x3d"display:none;"\x3e\r\n            \x3cspan class\x3d"commentsEnabled"  style\x3d"display:block; text-align:center;"\x3e\r\n              \x3ca href\x3d"#"\x3e${i18n.signIn}\x3c/a\x3e ${i18n.toAddNewComment}\r\n            \x3c/span\x3e\r\n          \x3c/div\x3e\r\n\r\n        \x3c/div\x3e\r\n\r\n      \x3cdiv style\x3d""\x3e\x3c/div\x3e\r\n\r\n      \x3cdiv id\x3d"layerMenu" class\x3d"layerMenu" data-dojo-type\x3d"dijit.Menu" style\x3d"display:none;"\x3e\r\n        \x3cdiv id\x3d"layerMenu-exportShapefile" data-dojo-type\x3d"dijit.MenuItem" data-dojo-props\x3d"iconClass:\'iconExportData\'"\x3e\r\n          ${i18n.exportToShapefile}\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"layerMenu-exportData" data-dojo-type\x3d"dijit.MenuItem" data-dojo-props\x3d"iconClass:\'iconExportFile\'"\x3e\r\n          ${i18n.exportToCSVFile}\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"layerMenu-exportFgdb" data-dojo-type\x3d"dijit.MenuItem" data-dojo-props\x3d"iconClass:\'iconExportFile\'"\x3e\r\n          ${i18n.exportToFgdb}\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"layerMenu-exportGeoJson" data-dojo-type\x3d"dijit.MenuItem" data-dojo-props\x3d"iconClass:\'iconExportFile\'"\x3e\r\n            ${i18n.exportToGeoJson}\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"layerMenu-exportFeatureCollection" data-dojo-type\x3d"dijit.MenuItem" data-dojo-props\x3d"iconClass:\'iconExportFile\'"\x3e\r\n            ${i18n.exportToFeatureCollection}\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"layerMenu-serviceUrl" data-dojo-type\x3d"dijit.MenuItem" data-dojo-props\x3d"iconClass:\'iconServiceUrl\'"\x3e\r\n          ${i18n.serviceURL}\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"layerMenu-enableAttachments" data-dojo-type\x3d"dijit.MenuItem" data-dojo-props\x3d"iconClass:\'iconAttachment\'" style\x3d"display:none;"\x3e\r\n          ${i18n.enableAttachments}\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"layerMenu-disableAttachments" data-dojo-type\x3d"dijit.MenuItem" data-dojo-props\x3d"iconClass:\'iconAttachment\'" style\x3d"display:none;"\x3e\r\n          ${i18n.disableAttachments}\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"layerMenu-timeSettings" data-dojo-type\x3d"dijit.MenuItem" data-dojo-props\x3d"iconClass:\'iconServiceUrl\'"\x3e\r\n          ${i18n.timeSettings}\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"layerMenu-reviewAddresses" style\x3d"display:none;" data-dojo-type\x3d"dijit.MenuItem" data-dojo-props\x3d"iconClass:\'iconReviewGeocode\'"\x3e\r\n          ${i18n.geocodePanel.geocodePanelTitle}\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv id\x3d"metadataMenu" data-dojo-type\x3d"dijit.Menu" style\x3d"display:none;"\x3e\r\n        \x3cdiv id\x3d"metadataMenu-view" data-dojo-type\x3d"dijit.MenuItem"\x3e\r\n          ${i18n.metadataView}\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"metadataMenu-edit" data-dojo-type\x3d"dijit.MenuItem"\x3e\r\n          ${i18n.metadataEdit}\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv id\x3d"publishFromFeaturesMenu" data-dojo-type\x3d"dijit.Menu" style\x3d"display:none;"\x3e\r\n        \x3cdiv id\x3d"publishFromFeaturesMenu-tiles" data-dojo-type\x3d"dijit.MenuItem"\x3e\r\n          ${i18n.publishTileLayer}\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"publishFromFeaturesMenu-scene" data-dojo-type\x3d"dijit.MenuItem"\x3e\r\n          ${i18n.publishSceneLayer}\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv id\x3d"item-thumbnail-dialog" class\x3d"thumbnailDialog dijitDialog"\x3e\r\n        \x3cdiv id\x3d"item-thumbnail-header"\x3e\r\n          \x3cdiv style\x3d"background:none;padding-top:2px;" class\x3d"dijitDialogTitle dijitDialogTitleBar"\x3e${i18n.uploadThumbnail}\x3c/div\x3e\r\n          \x3cdiv id\x3d"item-thumbnail-close" title\x3d"${i18n.close}" class\x3d"dijitDialogCloseIcon"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"item-thumbnail-content"\x3e\r\n          \x3cdiv class\x3d"esriFloatLeading"\x3e\x3clabel for\x3d"item-thumbnail-file"\x3e${i18n.thumbnailImage}\x3c/label\x3e\x3c/div\x3e\r\n          \x3cbr/\x3e\r\n          \x3cbr/\x3e\r\n          \x3cspan class\x3d"esriFloatLeading" style\x3d"margin-top:6px;"\x3e\x3clabel for\x3d"item-thumbnail-file"\x3e${i18n.image}:\x26nbsp;\x3c/label\x3e\x3c/span\x3e\r\n          \x3c!--\x3cinput type\x3d"hidden" name\x3d"MAX_FILE_SIZE" value\x3d"1024000"\x3e--\x3e\r\n          \x3cinput type\x3d"file" id\x3d"item-thumbnail-file" name\x3d"thumbnail" size\x3d"44"\x3e\r\n          \x3cbr /\x3e\r\n          \x3cbr /\x3e\r\n          \x3cdiv style\x3d"font-size:0.9em; padding-bottom:10px;"\x3e${i18n.thumbnailSpecification}\x3c/div\x3e\r\n          \x3cbutton id\x3d"item-thumbnail-cancel" class\x3d"esriFloatTrailing jevent calcite transparent" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n          \x3cbutton id\x3d"item-thumbnail-ok" class\x3d"esriFloatTrailing jevent calcite blue" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.ok}\x3c/button\x3e\r\n          \x26nbsp;\x3cbr /\x3e \x26nbsp;\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"padding: 10px" data-dojo-attach-point\x3d"_basicStandby" data-dojo-type\x3d"dojox.widget.Standby" centerIndicator\x3d"text" target\x3d"item-thumbnail"\x3e\x3c/div\x3e\r\n    \x3c/form\x3e\r\n\r\n    \x3cimg id\x3d"${id}_testImage" style\x3d"position:absolute;top:0;left:-3000px"/\x3e\r\n\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
account:arcgisonline.sharing.geow.Account,community:arcgisonline.sharing.geow.Community,content:arcgisonline.sharing.geow.Content,folder:arcgisonline.sharing.geow.Folder,util:arcgisonline.sharing.util,addItemDlg:arcgisonline.sharing.dijit.dialog.AddItemDlg,usageDlg:arcgisonline.sharing.dijit.dialog.UsageDlg,registerDlg:arcgisonline.sharing.dijit.dialog.RegisterApp,createItemUtil:arcgisonline.sharing.dijit.dialog._CreateItemUtilMixin,itemID:"",token:"",item:null,userFolders:null,userItems:null,userGroups:null,
sharedToGroups:"",newExtent:null,startupStarted:!1,origDescription:"",origLicenseInfo:"",firstPageUnloadCall:!0,tools:null,comments:null,publishCommentButton:null,addCommentPane:null,signInPane:null,newComment:null,ratingNode:null,rating:null,serviceInfo:null,codeAttachment:null,text:null,_eventConnections:[],numberPattern:"#.#",isAdmin:!1,currentUser:null,itemUser:null,adminGroups:null,_helperSummary:"",scaleNote:null,fromScaleRange:null,toScaleRange:null,serviceDefinitionID:null,serviceDefinitionType:null,
mapContentsSpan:null,adminServiceInfo:null,adminEditingInfo:null,selectedLayer:null,enableEditing:null,enableGeometryUpdate:null,disableGeometryUpdate:null,allowAddOnly:null,enableTracking:null,enableRestrictedEdits:null,standbyLoadingIcon:null,_connectContainer:null,_thumbOnClickConnect:null,_thumbEditOnClickConnect:null,_openConnects:[],_appPurposeSelect:null,_webAppApiSelect:null,_mobileAppApiSelect:null,attachCodeButton:null,attachCodeDialog:null,_canEnableEdit:!1,_canEnableEditInterval:null,
waitingForThumbnail:!1,formatDefault:"default",formatArcGIS:"arcgis",formatFGDC:"fgdc",formatINSPIRE:"inspire",formatISO19139:"iso19139",formatISO1913932:"iso19139-3.2",formatISO19115:"iso19115",constructor:function(a,c){},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.mixin({},a.i18n.getLocalization("arcgisonline","arcgisonline").common);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").itemProperties);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline",
"arcgisonline").itemLinks);a.mixin(this.i18n,{platform:a.i18n.getLocalization("arcgisonline","arcgisonline").addItemFrm.itemPlatform});a.mixin(this.i18n,{addingItem:a.i18n.getLocalization("arcgisonline","arcgisonline").addItemFrm.addingItem});a.mixin(this.i18n,{gallery:a.i18n.getLocalization("arcgisonline","arcgisonline").gallery});a.mixin(this.i18n,{saveAs:a.i18n.getLocalization("arcgisonline","arcgisonline").viewer.saveAs});a.mixin(this.i18n,{geocodePanel:a.i18n.getLocalization("arcgisonline","arcgisonline").geocodePanel});
a.mixin(this.i18n,{addLayerFromUrlDlg:a.i18n.getLocalization("arcgisonline","arcgisonline").addLayerFromUrlDlg});a.mixin(this.i18n,{shareCheckDlg:a.i18n.getLocalization("arcgisonline","arcgisonline").shareCheckDlg});a.mixin(this.i18n,{tableStatisticsDlg:a.i18n.getLocalization("arcgisonline","arcgisonline").tableStatisticsDlg});a.mixin(this.i18n,{customRoles:a.i18n.getLocalization("arcgisonline","arcgisonline").customRoles});a.mixin(this.i18n,{AddItemFromLayerDlg:a.i18n.getLocalization("arcgisonline",
"arcgisonline").AddItemFromLayerDlg});a.mixin(this.i18n,{overwrite:a.i18n.getLocalization("arcgisonline","arcgisonline").updateItemDlg.updateFeatures});a.mixin(this.i18n,{serviceDetailsDesc:a.i18n.getLocalization("arcgisonline","arcgisonline").publishTileServiceDlg.serviceDetailsDesc});a.mixin(this.i18n,{sceneServiceDetailsDesc:a.i18n.getLocalization("arcgisonline","arcgisonline").publishTileServiceDlg.sceneServiceDetailsDesc});a.mixin(this.i18n,{publishTileDialogTitle:a.i18n.getLocalization("arcgisonline",
"arcgisonline").publishTileServiceDlg.publishTileDialogTitle});a.mixin(this.i18n,{publishingTileService:a.i18n.getLocalization("arcgisonline","arcgisonline").publishTileServiceDlg.publishingTileService});a.mixin(this.i18n,{publishingSceneService:a.i18n.getLocalization("arcgisonline","arcgisonline").publishTileServiceDlg.publishingSceneService});this._helperSummary=this.i18n.helperSummary;this.standbyLoadingIcon=this.util.relativeToExplicitUrl("js/jsapi/dojox/widget/Standby/images/loading.gif")},postCreate:function(){this.loadConnections();
var b=a.query;b(".ownerOnly",this.domNode).style("display","none");b(".editOnly",this.domNode).style("display","none");b(".mapOnly",this.domNode).style("display","none");b(".orgMapOnly",this.domNode).style("display","none");b(".appOnly",this.domNode).style("display","none");b(".sharingOnly",this.domNode).style("display","none");b(".urlOnly",this.domNode).style("display","none");b(".readOnly",this.domNode).style("display","");b(".hostedTilesOnly",this.domNode).style("display","none");b(".hostedFeaturesOnly",
this.domNode).style("display","none");b(".publishOnly",this.domNode).style("display","none");b(".usageOnly",this.domNode).style("display","none");b(".registerSection").forEach(esri.hide);a.query(".registeredApp").forEach(esri.hide);a.query(".unRegisteredApp").forEach(esri.hide);a.query(".registration").forEach(esri.hide);b(".marketplaceSection").forEach(esri.hide);b(".advancedSection").forEach(esri.hide);esri.config.defaults.io.proxyUrl=esriGeowConfig.proxyServer;esriGeowConfig.proxyUrl&&(esri.config.defaults.io.proxyUrl=
esriGeowConfig.proxyUrl);this._basicStandby&&a.attr(this._basicStandby,"text","\x3ccenter\x3e\x3cimg src\x3d"+this.standbyLoadingIcon+"\x3e\x3c/center\x3e\x3cbr/\x3e\x3cspan style\x3d'background-color:#FFF;'id\x3d'standbyText'\x3e"+this.i18n.creatingService+"\x3c/span\x3e");this._errorDlg=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();this._choiceDlg=arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance();this._exportDlg=arcgisonline.sharing.dijit.dialog.ExportDlg.prototype.statics.getInstance()},
startup:function(){if(!this.startupStarted){this.startupStarted=!0;this.disableEditButton();this.currentUser=this.util.getUser();var b=this.util.getToken();b&&(this.token="?token\x3d"+b);this.account.getSelf(a.hitch(this,function(b){this._isPortal=this.util.isPortal();this._setRoleFlags();esriGeowConfig.metadataEnabled&&this._setMetadataFlags(b);this._isPortal?(a.query(".portalSync").style("display","none"),a.query(".portalEdits").style("display","none"),this._getFederatedServers().then(a.hitch(this,
function(){this.fillItemInfo()}))):this.fillItemInfo()}))}},_setMetadataFlags:function(a){a&&!0===a.metadataEditable&&(this._metadataEnabled=!0,this._metadataFormats=a.metadataFormats)},_setRoleFlags:function(){this.isAdmin=esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin();this._roleCanViewUsers=(this._isCustomRole=esriGeowConfig.userRole&&esriGeowConfig.userRole.isCustom())&&esriGeowConfig.userRole.canViewUsers();this._roleCanViewItems=this._isCustomRole&&esriGeowConfig.userRole.canViewOrgItems();
this._roleCanUpdateItems=this._isCustomRole&&esriGeowConfig.userRole.canUpdateOrgItems();this._roleCanDeleteItems=this._isCustomRole&&esriGeowConfig.userRole.canDeleteOrgItems();this._roleCanReassignItems=this._isCustomRole&&esriGeowConfig.userRole.canReassignOrgItems();this._roleCanPublishFeatures=(this._roleCanCreateItem=esriGeowConfig.userRole&&esriGeowConfig.userRole.canCreateItem())&&esriGeowConfig.userRole.canPublishFeatures();this._roleCanPublishTiles=this._roleCanCreateItem&&esriGeowConfig.userRole.canPublishTiles();
this._roleCanPublishScenes=this._roleCanCreateItem&&esriGeowConfig.userRole.canPublishScenes();this._roleCanShareToGroup=this._isCustomRole&&esriGeowConfig.userRole.canShareItemToGroup();this._roleCanShareToOrg=this._isCustomRole&&esriGeowConfig.userRole.canShareItemToOrg();this._roleCanShareToPublic=this._isCustomRole&&esriGeowConfig.userRole.canShareItemToPublic()&&esriGeowConfig.self.canSharePublic;this._roleCanShare=this._roleCanShareToGroup||this._roleCanShareToOrg||this._roleCanShareToPublic;
this._roleCanEditFeatures=this._isCustomRole&&esriGeowConfig.userRole.canEditFeatures();this._roleCanManageMarketplace=this._isCustomRole&&esriGeowConfig.userRole.canManageMarketplace();this._roleCanStartTrial=this._isCustomRole&&esriGeowConfig.userRole.canTrialMarketplace();this._roleCanPurchase=this._isCustomRole&&esriGeowConfig.userRole.canPurchaseMarketplace();this._roleCanConsumeListings=this._roleCanStartTrial||this._roleCanPurchase;this._roleCanEditWithFullControl=this._isCustomRole&&esriGeowConfig.userRole.canEditFeaturesFullControl()},
loadConnections:function(){var b=a.connect;b(f.byId("item-edit-button"),"onClick",this,"editItem");b(f.byId("item-share-button"),"onClick",this,"shareItem");b(f.byId("item-reassign-button"),"onClick",this,"reassignItem");b(f.byId("item-delete-button"),"onClick",this,"deleteItem");b(f.byId("item-update-button"),"onClick",this,"updateItem");b(f.byId("item-save-button"),"onClick",this,"saveItem");b(f.byId("item-close-button"),"onClick",this,"cancelEditItem");b(f.byId("item-save-button2"),"onClick",this,
"saveItem");b(f.byId("item-close-button2"),"onClick",this,"cancelEditItem");b(a.byId("item-extent-button1"),"onclick",this,"editExtent");b(a.byId("item-extent-button2"),"onclick",this,"editExtent");esriGeowConfig.metadataEnabled&&(b(f.byId("item-metadata-button"),"onClick",this,"loadMetadata"),b(f.byId("metadataMenu-view"),"onClick",this,"viewMetadata"),b(f.byId("metadataMenu-edit"),"onClick",this,"loadMetadataEditor"));b(f.byId("publishFromFeaturesMenu-tiles"),"onClick",a.hitch(this,"openPublishTileLayer",
"tiles"));b(f.byId("publishFromFeaturesMenu-scene"),"onClick",a.hitch(this,"openPublishTileLayer","scenes"));b(a.byId("item-thumbnail-close"),"onclick",this,"thumbnailCancel");b(a.byId("item-thumbnail-cancel"),"onclick",this,"thumbnailCancel");b(a.byId("item-thumbnail-ok"),"onclick",this,"thumbnailOk");b(f.byId("item-summary-edit-input"),"onFocus",this,this._handle_summaryOnFocus);b(f.byId("item-summary-edit-input"),"onBlur",this,this._handle_summaryOnBlur);b(f.byId("item-form-text"),"onChange",this,
function(){this._isConfigUpdated=!0});b(f.byId("layerMenu-exportShapefile"),"onClick",a.hitch(this,"doExportShapefile",null));b(f.byId("layerMenu-exportData"),"onClick",a.hitch(this,"doExportCsv",null));b(f.byId("layerMenu-exportFgdb"),"onClick",a.hitch(this,"doExportFgdb",null));b(f.byId("layerMenu-exportGeoJson"),"onClick",a.hitch(this,"doExportGeoJson",null));b(f.byId("layerMenu-exportFeatureCollection"),"onClick",a.hitch(this,"doExportFeatureCollection",null));b(f.byId("layerMenu-serviceUrl"),
"onClick",this,"openServiceUrl");b(f.byId("layerMenu-reviewAddresses"),"onClick",this,"openLayerWithReview");b(f.byId("layerMenu-enableAttachments"),"onClick",this,"enableAttachments");b(f.byId("layerMenu-disableAttachments"),"onClick",this,"disableAttachments");b(f.byId("layerMenu-timeSettings"),"onClick",this,"showTimeSettings");b(this._itemUsage,"onclick",this,"showUsageDlg");b(f.byId("item-create-button"),"onClick",this,"showCreateAppDlg");a.query(".opSetting").map(f.byNode).connect("onClick",
a.hitch(this,function(b){this._isAppPropertiesChanged=!0;"opFindLocations"===b.target.name&&(a.query(".opFindLocationsDiv",this.domNode)[this._opFindLocations.get("value")?"removeClass":"addClass"]("hide"),a.attr(this._opFindLocationsLink,"innerHTML",this._opFindLocations.get("value")?this.i18n.customRoles.contract:this.i18n.customRoles.expand))}));a.query(".opSetting").map(f.byNode).connect("onChange",a.hitch(this,function(a){this._isAppPropertiesChanged=!0}));a.connect(this._opFindLocationsHintText,
"onChange",a.hitch(this,function(a){this._isAppPropertiesChanged=!0}));b(this._opFindLocationsLink,"onclick",a.hitch(this,function(b){b.preventDefault();a.query(".opFindLocationsDiv",this.domNode).toggleClass("hide");a.attr(b.target,"innerHTML",a.attr(b.target,"innerHTML")===this.i18n.customRoles.expand?this.i18n.customRoles.contract:this.i18n.customRoles.expand)}));a.query(".fav-icon a",this.domNode).connect("onclick",a.hitch(this,function(b){b.preventDefault();var d=a.hasClass(b.target.parentNode,
"fav-off"),e=b.target.parentNode.parentNode.parentNode;return dfd=this.content[d?"addToFavorites":"removeFromFavorites"](this.item).then(a.hitch(this,function(b){b.notSharedWith&&b.notSharedWith.length||b.notUnsharedFrom&&b.notUnsharedFrom.length?this._showError({message:this.i18n.error.cantShareFavorites}):(a.query(".fav-on",e).style({display:d?"":"none"}),a.query(".fav-off",e).style({display:d?"none":""}),setTimeout(a.hitch(this,function(){a.query(".fav-on",e).style({width:d?"200px":"24px"});a.query(".fav-off",
e).style({width:d?"24px":"200px"});setTimeout(a.hitch(this,function(){a.query(".fav-off, .fav-on",this.domNode).style({width:"24px"})}),2500)}),50));return b}),a.hitch(this,function(a){a&&"item not provisioned"===a.message&&(a={message:this.i18n.error.noShareListedItem});return this._showError(a)}))}));a.query(".fav-icon a",this.domNode).connect("onmouseout",a.hitch(this,function(b){a.style(b.target.parentNode,{width:"24px"})}));b(this._opTracking,"onChange",a.hitch(this,function(a){this._opTrackingSelect.set("disabled",
!a)}));a.subscribe("onItemUpdate",this,"fillItemInfo");a.subscribe("onShareUpdate",this,"onShareUpdate");a.subscribe("onNotShareUpdate",this,"onNotShareUpdate");a.subscribe("onExtentUpdate",this,"updateExtent");window.onbeforeunload=a.hitch(this,"onPageUnload");esri.isTouchEnabled&&(b=a.query(".scrollPane",this.domNode)[0],b=esri.setScrollable(b),this._eventConnections.push(b[0],b[1]))},destroy:function(){try{this.inherited(arguments)}catch(b){}a.forEach(this._eventConnections,a.disconnect)},addToArcGIS:function(a){a.preventDefault();
window.location=this.util.getItemDataPath()},downloadItem:function(a){a.preventDefault();window.location=this.util.getItemDataPath()},addToMap:function(a){a.preventDefault();arcgisonline.map.mapUtil.addToMap(this.itemID)},openMap:function(a){a.preventDefault();arcgisonline.map.mapUtil.openMap(this.itemID)},editItemThumbnail:function(b){b=a.position(a.byId("item-thumbnail"));a.style(a.byId("item-thumbnail-dialog"),"top",Math.round(b.y)+"px");a.style(a.byId("item-thumbnail-dialog"),"left",(esriGeowConfig.isRightToLeft?
Math.round(b.x)+b.w-a.style("item-thumbnail-dialog","width"):Math.round(b.x))+"px");a.style(a.byId("item-thumbnail-dialog"),"display","block")},_onItemLoad:function(b){if(!this.item.numViews&&-1===a.indexOf(this.item.typeKeywords,"Layer Template")&&-1<a.indexOf(this.item.typeKeywords,"Hosted Service")&&("Feature Service"===this.item.type||"Feature Collection"===this.item.type))this.item.extraUrlParams=!0,"Feature Service"===this.item.type&&this._getRelatedItems("Service2Data","forward").then(a.hitch(this,
function(c){if(c&&c.length&&("Feature Collection"===c[0].type||"Service Definition"===c[0].type))this.item.extraUrlParams=!1,c=this.util.getGalleryMainLinkInfo(b),a.attr("item-thumbnail-a",{href:c.href})}));this._setCustomRoleButtonVisibility();this.onItemLoad(b);if(a.byId("item-thumbnail-a")){this._cleanUpThumbnailClickConnect();var c=this.util.getGalleryMainLinkInfo(b);a.attr("item-thumbnail-a",{href:c.href,title:c.tip,alt:c.tip,target:c.target});c.onclick&&(this._thumbOnClickConnect=a.connect(a.byId("item-thumbnail-a"),
"onclick",c.onclick))}a.byId("item-delete-protection").innerHTML=this.item["protected"]?this.i18n.editFeaturesEnabled:this.i18n.disabledLabel;f.byId("item-delete-protection-edit-input").set("checked",this.item["protected"]?!0:!1);f.byId("item-delete-button").set("disabled",this.item["protected"]);f.byId("item-delete-button").attr("title",this.item["protected"]?this.i18n.deleteProtectionEnabled:"");if(("Web Map"===this.item.type||"Operation View"===this.item.type)&&this.currentUser&&(this.isAdmin||
this._roleCanViewItems||this.item.owner===this.currentUser.email||this._isOwnershipShared))c=-1<a.indexOf(this.item.typeKeywords,"useOnly"),a.byId("item-view-only").innerHTML=c?this.i18n.disabledLabel:this.i18n.editFeaturesEnabled,f.byId("item-view-only-edit-input").set("checked",!c?!0:!1),a.query(".viewOnly",this.domNode).style("display","");if("Web Map"===this.item.type&&this.currentUser&&esriGeowConfig.userRole&&(this.isAdmin||this._roleCanViewItems||this.item.owner===this.currentUser.email||this._isOwnershipShared)){var d=
(c=-1<a.indexOf(this.item.typeKeywords,"Offline"))?this.i18n.offlineModeEnabled:this.i18n.disabledLabel;a.byId("item-offline-map").innerHTML=d;f.byId("item-offline-map-edit-input").set("checked",c)}this.updateOpenMenu();this._setupCommentRSSLink();this._toggleCommentVisibility();if(this.currentUser&&(this.isAdmin||this._roleCanViewItems||this.item.owner===this.currentUser.email||this._isOwnershipShared)&&b.url&&-1<a.indexOf(b.typeKeywords,"Hosted Service")&&(this.util.isHostedServiceItem(b)||arcgisonline.sharing.util.portalSupportsHostedServices()))if(c=
esri.urlToObject(document.URL),c=c.query&&c.query.jobid||null)b=a.mixin(b,{folder:b.folderId,overrideUser:this.itemUser&&this.itemUser.username||null,jobid:c}),this.checkJobStatus(b),this.enableEditButton();else if(this.util.isPortal()&&-1<this.item.url.indexOf("/SceneServer"))this.checkSceneStatus(b);else if(this.util.isPortal()&&-1<this.item.url.indexOf("/ImageServer")&&-1===a.indexOf(this.item.typeKeywords,"Elevation 3D Layer"))this.checkStatus(b);else if(-1===this.item.url.indexOf("/MapServer")&&
-1===this.item.url.indexOf("/VectorTileServer")&&-1===this.item.url.indexOf("/ImageServer")&&-1===this.item.url.indexOf("/SceneServer"))this.checkStatus(b);else{if(-1<this.item.url.indexOf("/MapServer")||-1<this.item.url.indexOf("/VectorTileServer")){var e=a.hitch(this,function(b){this.serviceInfo=b;this.serviceInfo.tileInfo&&(this.serviceInfo.tileInfo.width||(this.serviceInfo.tileInfo.width=256),this.serviceInfo.tileInfo.height||(this.serviceInfo.tileInfo.height=256));this.getServiceDefinitionID().then(a.hitch(this,
function(){this.checkTileStatus()}))}),g=a.hitch(this,function(a){console.log("Error retrieving service info",a)});this._isPortal?this._getServerToken(this.item.url).then(a.hitch(this,function(c){this.serverToken=c.token;c=a.query("#item-map-contents span \x3e a")[0].innerHTML;a.query("#item-map-contents span \x3e a").attr("href",b.url+"?token\x3d"+this.serverToken).removeAttr("onclick");a.query("#item-map-contents span \x3e a")[0].innerHTML=c;esri.request({url:this.item.url,content:{f:"json",token:this.serverToken}}).then(e,
g);this.checkServiceDirStatus(this.item.url).then(a.hitch(this,function(b){b&&!b.enabled&&a.create("label",{innerHTML:" "+this.i18n.serviceDirDisabled},a.query("#item-map-contents span \x3e a")[0],"after")}))})):this.util.getJson(this.item.url,e,g)}}else c="Map Service;Image Service;Geodata Service;Globe Service;Geometry Service;Geocoding Service;Network Analysis Service;Geoprocessing Service;Workflow Manager Service".split(";"),"Feature Service"===this.item.type?(c=a.hitch(this,function(c){if(c&&
!c.code&&!c.messageCode){a.empty("item-map-contents");var d=-1<a.indexOf(b.typeKeywords,"Hosted Service")&&(this.util.isHostedServiceItem(b)||arcgisonline.sharing.util.portalSupportsHostedServices()),e=this._isExportEnabled(c.capabilities),g=c.layers?c.layers:[c],n=c.tables?c.tables:[];0<g.length&&(a.attr(this.mapContentsSpan,"innerHTML",this.i18n.mapLayers),a.forEach(g,a.hitch(this,function(a){this._setupLayerLinks(d,e,!1,a)})));0<n.length&&(!g||0===g.length?a.attr(this.mapContentsSpan,"innerHTML",
this.i18n.mapTables):(a.create("br",null,"item-map-contents"),a.create("br",null,"item-map-contents"),a.create("span",{"class":"esriItemProperties",innerHTML:this.i18n.mapTables},"item-map-contents")),a.forEach(n,a.hitch(this,function(a){this._setupLayerLinks(d,e,!0,a)})));this.updateExportLayersMenu(g.concat(n),c);if(d&&this.canShowOpenWithFullEditingControl(c.capabilities?c.capabilities.split(","):[]))c=new f.MenuItem({label:this.i18n.openViewerFullEditingRole,onClick:a.partial(this.openServiceWithFullEditingControl,
this.item.id)}),this.updateFeatureServiceOpenMenu(c,2)}}),this._getFeatureServiceInfo().then(c,c)):this._isPortal&&-1<a.indexOf(c,this.item.type)&&this.checkServiceDirStatus(this.item.url).then(a.hitch(this,function(b){var c=a.query("#item-map-contents span \x3e a"),d=a.query("#item-rest-url \x3e a"),e=this.util.onFederatedServer(this.item.url);b&&!b.enabled&&(c&&c[0]&&a.create("label",{innerHTML:" "+this.i18n.serviceDirDisabled},c[0],"after"),d&&d[0]&&a.create("label",{innerHTML:" "+this.i18n.serviceDirDisabled},
d[0],"after"));e&&this.currentUser&&(c&&c[0]&&a.attr(c[0],"href",a.attr(c[0],"href")+"?token\x3d"+this.currentUser.token),d&&d[0]&&a.attr(d[0],"href",a.attr(d[0],"href")+"?token\x3d"+this.currentUser.token))})),this.enableEditButton();a.style(this.tools.domNode,"visibility","visible")},_setupLayerLinks:function(b,c,d,e){var g=!0,h;if(d)g=-1<a.indexOf(this.item.typeKeywords,"Involved Lookup"),g=!(g&&"Review"===e.name);else if(this.itemData&&this.itemData.layers){g=!1;for(d=0;d<this.itemData.layers.length;d++)if(this.itemData.layers[d].id===
e.id){g=!0;break}}g&&(g=this.util.getToken()?this.token:"",h=a.create("span",{className:"esriItemLinks "},"item-map-contents"),d=this.item.url+(e&&0>this.item.url.indexOf("/"+e.id)?"/"+e.id:""),b&&(d+="public"!==this.item.access||this.item.itemControl&&-1<this.item.itemControl.indexOf("admin")?g:""),a.create("a",{href:d,innerHTML:e.name,title:e.name,target:"_blank"},h),g=a.create("span",{id:"layer-actions-"+e.id,className:"calciteContextMenu ",style:{"vertical-align":"middle"}},h),a.connect(g,"onclick",
a.hitch(this,this.openNonOwnerLayerMenu,e,b,c)),this._isPortal&&this.checkServiceDirStatus(this.item.url).then(a.hitch(this,function(b){b&&!b.enabled&&a.create("label",{innerHTML:" "+this.i18n.serviceDirDisabled},h,"last")})))},_setScaleRanges:function(){var b;if(!this.item.numViews&&"Feature Service"===this.item.type&&-1<a.indexOf(this.item.typeKeywords,"Hosted Service"))return a.promise.all(a.map(this.adminServiceInfo.layers||[],a.hitch(this,function(a){return this._setScaleRange(this.item.url+
"/"+a.id)})));b=new a.Deferred;b.resolve(!0);return b},_setScaleRange:function(b){var c=new esri.layers.FeatureLayer(b),d,e=this,g;return c.addPlugin("esri/plugins/FeatureLayerStatistics").then(function(){return c.statisticsPlugin.getSuggestedScaleRange().then(function(c){d=b.replace("/rest/","/rest/admin/");e._isPortal&&!e._isSDSFeatureService&&(d=b.replace("/rest/","/admin/").replace("/FeatureServer",".MapServer"));g={updateDefinition:a.json.stringify({maxScale:c.maxScale||0,minScale:c.relaxedMinScale||
0})};return e.util.request({url:e._encodeServiceName(d)+"/updateDefinition",content:g},{usePost:!0})})})},checkOfflineModeSupport:function(b){f.byId("item-offline-map-edit-input").get("checked")&&arcgisonline.map.mapUtil.supportsOffline(this.getDataContent).then(a.hitch(this,function(a){if(!a){var b=esriGeowConfig.self.helpMap.m["120000899"],b=esri.substitute({docStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca href\x3d"'+(esriGeowConfig.self.helpBase+(b?b:""))+'" target\x3d"_blank"\x3e',docEnd:"\x3c/a\x3e\x3c/span\x3e"},
this.i18n.unableToOfflineWebMap);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.notice,message:b})}f.byId("item-offline-map-edit-input").set("checked",a)}))},_isExportEnabled:function(a){return a&&-1<a.indexOf("Extract")},_getFeatureServiceInfo:function(){var a={addToken:(this.util.isHostedService(this.item.url)||this.util.isAgolService(this.item.url))&&!1!==esriGeowConfig.isMultiTenant};return this.util.request({url:this.item.url},a)},_setupCommentRSSLink:function(){if(this.item&&
!0===this.item.commentsEnabled){var b=arcgisonline.sharing.util.isPortal()?esriGeowConfig.restBaseUrl:esriGeowConfig.restBaseUrl.replace(window.location.host,esriGeowConfig.self.portalHostname),b=b+("content/items/"+this.item.id+"/comments?f\x3drss");a.attr(this.commentsRSSLink,"href",b);a.attr(this.commentsRSS,"src",this.util.relativeToExplicitUrl("images/rss.jpg"));this._toggleCommentRSSVisibility()}},_toggleCommentRSSVisibility:function(){this.item&&"public"===this.item.access&&!0===this.item.commentsEnabled?
a.style(this.commentsRSSLink,"display","inline-block"):a.style(this.commentsRSSLink,"display","none")},_toggleCommentVisibility:function(){this.item&&(a.query(".commentsEnabled").forEach(!1===this.item.commentsEnabled?esri.hide:esri.show),a.query(".commentsDisabled").forEach(!1===this.item.commentsEnabled?esri.show:esri.hide))},_getAppCollectorProperties:function(){if(this._isAppCollector){var b=this._applicationProperties=this.getDataContent&&this.getDataContent.applicationProperties||{},c=b.viewing,
d=b.editing,e=c&&c.search||{enabled:!0,disablePlaceFinder:!1,layers:[],hintText:this.i18n.findPlace},g=[],h;c&&(this._opRouting.set("checked",b.viewing.routing&&b.viewing.routing.enabled),this._opMeasure.set("checked",b.viewing.measure&&b.viewing.measure.enabled),this._opBasemap.set("checked",b.viewing.basemapGallery&&b.viewing.basemapGallery.enabled));d?(this._opTracking.set("checked",d.locationTracking&&d.locationTracking.enabled),this._opTrackingSelect.set("disabled",!this._opTracking.get("checked")),
d.locationTracking.info&&this._opTrackingSelect.set("value",d.locationTracking.info.updateInterval||300)):a.query(".opTracking").forEach(esri.hide);esriGeowConfig.findFeaturesWebMapEnabled&&(this._searchProps=e,this._opFindLocations.set("checked",this._searchProps.enabled?!0:!1),this._opByLayer.set("checked",this._searchProps.layers&&this._searchProps.layers.length?!0:!1),a.query(".byLayerDiv",this.domNode)[this._opByLayer.get("checked")?"removeClass":"addClass"]("hide"),this._opByAddress.set("checked",
!1===this._searchProps.disablePlaceFinder),a.query(".opFindLocationsDiv",this.domNode).addClass(this._searchProps.enabled?"":"hide"),a.attr(this._opFindLocationsLink,"innerHTML",this._searchProps.enabled?this.i18n.customRoles.contract:this.i18n.customRoles.expand),this._opFindLocationsHintText.set("value",this._searchProps&&this._searchProps.hintText||"",!1),this._searchLayers=a.map(this._searchProps.layers||[],a.hitch(this,function(b,c){esri._isDefined(b.subLayer)&&(b.subLayer=isNaN(parseInt(b.subLayer,
10))?null:parseInt(b.subLayer,10));h=b.id+(esri._isDefined(b.subLayer)?"#"+b.subLayer:"");return{id:h,layer:h,exactMatch:b.field.exactMatch?"true":"false",field:a.mixin(b.field,{value:b.field.name,label:b.field.alias||b.field.name})}})));a.query(".opSetting").map(f.byNode).forEach(a.hitch(this,function(a){!0===a.get("checked")&&"opFindLocations"!==a.name&&(esriGeowConfig.findFeaturesWebMapEnabled||!esriGeowConfig.findFeaturesWebMapEnabled&&"opByAddress"!==a.name&&"opByLayer"!==a.name)&&g.push(a.get("label"))}));
a.attr(this._opCollectorReadOnly,"innerHTML",g.join(", "))}},_setAppCollectorProperties:function(){var b=this._applicationProperties,c,d=b.editing;c=a.mixin(b.viewing||{},{routing:{enabled:this._opRouting.get("checked")},measure:{enabled:this._opMeasure.get("checked")},basemapGallery:{enabled:this._opBasemap.get("checked")}});b=a.mixin(b,{viewing:c});d&&(d.locationTracking=a.mixin(d.locationTracking||{},{enabled:this._opTracking.get("checked")}),d.locationTracking&&(d.locationTracking.info=a.mixin(d.locationTracking.info||
{},{updateInterval:this._opTrackingSelect.get("value")})),b=a.mixin(b,{editing:d}));this._fieldsGridStore&&(b.viewing=b.viewing||{},b.viewing.search=this._getFindLocationJson());this.getDataContent.applicationProperties=b},_updateThumbnail:function(b){var c=new a.Deferred,d=esri.urlToObject(document.URL),d=d.query&&d.query.jobid||null;if((!b.thumbnail||d)&&-1!==b.url.indexOf("/FeatureServer")){var e=function(d){b.thumbnail=d;f.byId("item-form-thumbnailURL").set("value",d);a.byId("item-thumbnail").innerHTML=
'\x3ca id\x3d"item-thumbnail-a"\x3e\x3cimg src\x3d\''+d+"' alt\x3d'Thumbnail' style\x3d'max-width:200px;max-height:133px'/\x3e\x3c/a\x3e";a.byId("item-thumbnail-text").innerHTML='\x3ca href\x3d"JavaScript:void(0);" onclick\x3d"JavaScript:dijit.byId(\'item-properties\').editItemThumbnail();"\x3e'+this.i18n.clickToChangeThumbnail+"\x3c/a\x3e";var e=esriGeowConfig.restBaseUrl+"content/users/"+(this.isAdmin||this._roleCanViewItems&&this._roleCanUpdateItems||this._isOwnershipShared?b.owner:this.util.getUser().email),
e=e+(b.ownerFolder?"/"+b.ownerFolder:""),e=e+("/items/"+b.id+"/update");this.util.request({url:e,content:{thumbnailURL:d}},{usePost:!0}).then(a.hitch(function(){c.callback()}),a.hitch(function(){c.callback()}))},g=function(a){c.errback(a)};!b.extent||0===b.extent.length?(d=esriGeowConfig.restBaseUrl+"content/items/"+b.id,this.util.getJson(d,a.hitch(this,function(c){b.extent=c.extent;if(!b.extent||0===b.extent.length)b.extent=[[-180,-90],[180,90]];arcgisonline.map.thumbnail.buildThumbnailURLFromFSItem(b,
null,[]).then(a.hitch(this,e),a.hitch(this,g))}),a.hitch(this,function(){b.extent=[[-180,-90],[180,90]];arcgisonline.map.thumbnail.buildThumbnailURLFromFSItem(b,null,[]).then(a.hitch(this,e),a.hitch(this,g))}))):arcgisonline.map.thumbnail.buildThumbnailURLFromFSItem(b,null,[]).then(a.hitch(this,e),a.hitch(this,g))}else c.callback();return c},checkJobStatus:function(b,c){var d=a.hitch(this,function(d){if("completed"===d.status){var g=esri.urlToObject(document.URL);d=g.query&&g.query.jobid||null;c&&
!d?(this.fillItemInfo(),this.updateSvcNodes(!1)):this._updateThumbnail(this.item).then(a.hitch(this,function(){this.updateSvcNodes(!1);window.location=esriGeowConfig.baseUrl+"item.html?id\x3d"+b.id+(g.query&&g.query.showManageTiles?"\x26showManageTiles\x3dtrue":"")}),a.hitch(this,function(){this.updateSvcNodes(!1);window.location=esriGeowConfig.baseUrl+"item.html?id\x3d"+b.id+(g.query&&g.query.showManageTiles?"\x26showManageTiles\x3dtrue":"")}))}else if("failed"===d.status){this.updateSvcNodes(!0,
!0);var h=d.statusMessage;try{h&&a.json.parse(d.statusMessage)}catch(f){}h&&(h.message&&-1<h.message.indexOf("Could not open filegdb."))&&(h.message=this.i18n.error.couldNotOpenFileGDB);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.error.error,message:h.message||d.statusMessage})}else this.updateSvcNodes(!0),setTimeout(a.hitch(this,"checkJobStatus",b,!0),3E3)});this.content.itemStatus(b,d,d)},doExportShapefile:function(a){if(a||this.selectedLayer)this._exportDlg.showShapefile(this.item,
a||this.selectedLayer)},doExportCsv:function(a){if(a||this.selectedLayer)this._exportDlg.showCSV(this.item,a||this.selectedLayer)},doExportFgdb:function(a){if(a||this.selectedLayer)this._exportDlg.showFileGDB(this.item,a||this.selectedLayer)},doExportGeoJson:function(a){if(a||this.selectedLayer)this._exportDlg.showGeoJson(this.item,a||this.selectedLayer)},doExportFeatureCollection:function(a){if(a||this.selectedLayer)this._exportDlg.showFeatureCollection(this.item,a||this.selectedLayer)},openServiceUrl:function(){if(this.selectedLayer){this.util.getUser();
var a=this.item.url+"/"+this.selectedLayer.id;esri.isDefined(this.selectedLayer.id)&&-1<this.item.url.indexOf("/"+this.selectedLayer.id,this.item.url.length-this.selectedLayer.id.length+1)&&(a=this.item.url);this.util.isHostedServiceItem(this.item)?a+="public"!==this.item.access||this.item.itemControl&&-1<this.item.itemControl.indexOf("admin")?this.token:"":this._isPortal&&this.serverToken?a+="?token\x3d"+this.serverToken:this._isPortal&&(this.util.onFederatedServer(this.item.url)&&this.currentUser)&&
(a+="?token\x3d"+this.currentUser.token);window.open(a,"_blank")}},enableAttachments:function(){if(this.selectedLayer){var b=this.item.url.replace("/rest/","/rest/admin/");this._isPortal&&!this._isSDSFeatureService&&(b=this.item.url.replace("/rest/","/admin/").replace("/FeatureServer",".MapServer"));var b=this._encodeServiceName(b)+"/"+this.selectedLayer.id+"/updateDefinition",c={updateDefinition:a.json.stringify({hasAttachments:!0})};this.util.request({url:b,content:c},{usePost:!0}).then(a.hitch(this,
function(a){this._onItemLoad(this.item)}))}},disableAttachments:function(){if(this.selectedLayer){var b=arcgisonline.sharing.dijit.dialog.DeleteWarningDlg.prototype.statics.getInstance();b.showMsgTitleButton(this.i18n.disableAttachmentsMessage,this.i18n.disableAttachments,this.i18n.yesLabel,a.hitch(this,this.reallyDisableAttachments));b.renameCancelButton(this.i18n.noLabel)}},reallyDisableAttachments:function(){if(this.selectedLayer){var b=this.item.url.replace("/rest/","/rest/admin/");this._isPortal&&
!this._isSDSFeatureService&&(b=this.item.url.replace("/rest/","/admin/").replace("/FeatureServer",".MapServer"));var b=this._encodeServiceName(b)+"/"+this.selectedLayer.id+"/updateDefinition",c={updateDefinition:a.json.stringify({hasAttachments:!1})};this.util.request({url:b,content:c},{usePost:!0}).then(a.hitch(this,function(a){this._onItemLoad(this.item)}))}},showTimeSettings:function(){if(this.selectedLayer){var b=new f.Dialog({style:{width:"450px"}}),c=document.createDocumentFragment(),d=new arcgisonline.sharing.dijit.dialog.LayerTimeSettings({fields:this._layerDateFields,
timeInfo:this.adminServiceInfo.layers[this.selectedLayer.id].timeInfo||{}},a.create("div",{"class":"esriLayerTimeSettings",style:"max-width:100%;width:auto;"},c)),e=a.create("div",{"class":"esriFloatTrailing esriTimeSettingsButtons"},c),g=new f.form.Button({"class":"calcite primary",label:this.i18n.ok,type:"button"},a.create("button",{},e)),e=new f.form.Button({"class":"calcite cancel",label:this.i18n.cancel,type:"button"},a.create("button",{},e)),h=a.connect(e,"onClick",a.hitch(this,function(){a.disconnect(h);
b.hide()})),k=a.connect(g,"onClick",a.hitch(this,function(){d.set("disabled",!0);var c=d.get("value");if(c.timeInfo&&c.timeInfo.startTimeField&&c.timeInfo.startTimeField===c.timeInfo.endTimeField)d.set("disabled",!1),this._showError(this.i18n.error.sameTimeField);else{var e={updateDefinition:a.json.stringify(c)},g=this._encodeServiceName(this.item.url.replace("/rest/","/rest/admin/"))+"/"+this.selectedLayer.id+"/updateDefinition";this._isPortal&&this._isSDSFeatureService&&(g=this._encodeServiceName(this.item.adminUrl)+
"/"+this.selectedLayer.id+"/updateDefinition");this.util.request({url:g,content:e},{usePost:!0}).then(a.hitch(this,function(d){a.mixin(this.adminServiceInfo.layers[this.selectedLayer.id],c);a.disconnect(k);b.hide();return d}),a.hitch(this,function(a){d.set("disabled",!1);return this._showError(a)}))}})),l=a.connect(b,"hide",a.hitch(this,function(){a.disconnect(l);d.destroyRecursive()}));b.set("title",this.i18n.timeSettings);b.setContent(c);b.show()}},showUsageDlg:function(){var b=new f.Dialog,c=a.connect(b,
"hide",a.hitch(this,function(){a.disconnect(c);b.destroyRecursive()})),d=this._registeredAppInfo||this._fetchRegisteredAppInfo();a.when(d,a.hitch(this,function(a){b.set("title",esri.substitute(this.item,this.i18n.appTitleUsage));b.setContent((new arcgisonline.sharing.dijit.dialog.UsageApp({appId:a&&a.client_id,itemId:this.item.id,listed:this.item.listed})).domNode);b.show()}))},showCreateAppDlg:function(){var b=-1<a.indexOf(this.item.typeKeywords,"Web AppBuilder for ArcGIS"),c=new arcgisonline.sharing.dijit.dialog.ConfirmDialog({title:this.i18n.createNewApp,
buttonOk:this.i18n.ok,buttonCancel:this.i18n.cancel,style:{width:"550px",height:"auto"}}),d=new arcgisonline.sharing.dijit.dialog.ItemPropertiesDlg({typeInfo:b?"wab":"configapp",message:this.i18n.createAppTitle,showFolders:!0,showFile:!1,showUrl:!1,item:a.mixin(this.item,{tags:""})}),e,g;c.setContent(d.domNode);c.okButton.set("label",this.i18n.done);c.show();e=a.topic.subscribe("/dlg/onOk",a.hitch(this,function(e){a.topic.publish("/esri/disable",!0,this.i18n.addingItem);d._validate().then(a.hitch(this,
function(e){g=d.get("item");b?c.hide().then(a.hitch(this,function(){this.redirectToAppBuilder(g)})):this.createItemUtil.createTemplatedApplication(g,this.item,d._portal).then(a.hitch(this,function(b){c.hide().then(a.hitch(this,function(){window.location=b.configureUrl}))}),a.hitch(this,function(b){a.topic.publish("/esri/disable",!1);return this._showError(b)}))}),a.hitch(this,function(b){a.topic.publish("/esri/disable",!1);return this._showError(b)}))}));a.topic.subscribe("/dlg/onCancel",a.hitch(this,
function(){e.remove();e=null}))},redirectToAppBuilder:function(b){b.folderId&&"/"!==b.folderId&&(b.folder=b.folderId);var c=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/apps/webappbuilder/index.html?",c=c+a.objectToQuery({title:b.title,tags:b.tags,summary:b.description,folder:b.folder});window.location="https:"===window.location.protocol?arcgisonline.sharing.util.getSecureUrl(c):arcgisonline.sharing.util.getHttpUrl(c)},_addApp:function(b){var c=
esriGeowConfig.restBaseUrl+"content/users/"+this.util.getUser().email,c=c+("/"+(b.folderId?b.folderId+"/":""));return this.util.request({url:c+"addItem",content:b},{usePost:!0}).then(a.hitch(this,function(d){var e=b.url.indexOf("?"),g=-1!==e?b.url.substr(e,b.url.length):"",g=g+(g&&g.length?"\x26":"?"),g=g+("appid\x3d"+d.id);b.url=b.url.substr(0,-1!==e?e:b.url.length)+g;b.id=d.id;return this.util.request({url:c+"items/"+d.id+"/update",content:{url:b.url}},{usePost:!0}).then(a.hitch(this,function(a){return b}))}))},
openNonOwnerLayerMenu:function(b,c,d,e){this.selectedLayer=b;e.preventDefault=e.stopPropagation=function(){};f.byId("layerMenu")._openMyself(e);b&&(c&&d&&this.currentUser?(a.style("layerMenu-exportShapefile","display",""),a.style("layerMenu-exportData","display",""),a.style("layerMenu-exportFgdb","display",""),a.style("layerMenu-exportGeoJson","display",""),this._isCustomRole&&!this._roleCanCreateItem&&(a.style("layerMenu-exportShapefile","display","none"),a.style("layerMenu-exportData","display",
"none"),a.style("layerMenu-exportFgdb","display","none"),a.style("layerMenu-exportGeoJson","display","none"),a.style("layerMenu-exportFeatureCollection","display","none"))):(a.style("layerMenu-exportShapefile","display","none"),a.style("layerMenu-exportData","display","none"),a.style("layerMenu-exportFgdb","display","none"),a.style("layerMenu-exportGeoJson","display","none"),a.style("layerMenu-exportFeatureCollection","display","none")),a.style("layerMenu-enableAttachments","display","none"),a.style("layerMenu-disableAttachments",
"display","none"),a.style("layerMenu-timeSettings","display","none"));this._isPortal&&(a.style("layerMenu-exportGeoJson","display","none"),a.style("layerMenu-exportFeatureCollection","display","none"))},viewMetadata:function(){this._metadataUrl=esriGeowConfig.restBaseUrl+"content/items/"+this.item.id+"/info/metadata/metadata.xml";this.openMetadataFormat(this.formatDefault)},openMetadataFormat:function(a){var c=arcgisonline.sharing.util.getUser();arcgisonline.sharing.util.openPage(this._metadataUrl+
"?format\x3d"+a+"\x26output\x3dhtml"+(c&&c.token?"\x26token\x3d"+c.token:""),!1)},openMetadataMenu:function(a){a.preventDefault=a.stopPropagation=function(){};f.byId("metadataMenu")._openMyself({target:f.byId("item-metadata-button").domNode})},openPublishTileLayer:function(b){var c=new arcgisonline.sharing.dijit.dialog.ConfirmDialog({title:this.i18n.publishTileDialogTitle,buttonOk:this.i18n.ok,buttonCancel:this.i18n.cancel,style:{width:"650px",height:"auto"}});this._publishTilesDlg=new arcgisonline.sharing.dijit.dialog.PublishTileServiceDlg({message:this.i18n.serviceDetailsDesc,
showFolders:!0,item:this.item,type:b});c.setContent(this._publishTilesDlg.domNode);c.show();a.connect(c.okButton,"onClick",a.hitch(this,function(){a.topic.publish("/esri/disable",!0,this.i18n.publishingTileService);this._publishTilesDlg._validate().then(a.hitch(this,function(){this._publishTilesDlg.publishTileService().then(a.hitch(this,function(d){c.hide().then(a.hitch(this,function(){var a=d&&d.id;a&&(window.location="item.html?id\x3d"+a+("tiles"===b?"\x26showManageTiles\x3dtrue":""))}))}))}))}))},
openPublishFromFeaturesMenu:function(a){a.preventDefault=a.stopPropagation=function(){};f.byId("publishFromFeaturesMenu")._openMyself({target:f.byId("item-publish-tile-service-button").domNode})},openLayerMenu:function(b,c){this.selectedLayer=b;c.preventDefault=c.stopPropagation=function(){};f.byId("layerMenu")._openMyself(c);if(b){!this._isPortal&&b.hasAttachments&&!0===b.hasAttachments?(a.style("layerMenu-enableAttachments","display","none"),a.style("layerMenu-disableAttachments","display","")):
this._isPortal?this._isPortal&&(this._isSDSFeatureService?b.hasAttachments&&!0===b.hasAttachments?(a.style("layerMenu-enableAttachments","display","none"),a.style("layerMenu-disableAttachments","display","")):(a.style("layerMenu-enableAttachments","display",""),a.style("layerMenu-disableAttachments","display","none")):(a.style("layerMenu-enableAttachments","display","none"),a.style("layerMenu-disableAttachments","display","none"))):(a.style("layerMenu-enableAttachments","display",""),a.style("layerMenu-disableAttachments",
"display","none"));this._layerDateFields=a.filter(b.fields,a.hitch(this,function(a){return"esriFieldTypeDate"===a.type}));!this._layerDateFields||!this._layerDateFields.length||this._isPortal&&!this._isSDSFeatureService?a.style("layerMenu-timeSettings","display","none"):a.style("layerMenu-timeSettings","display","");if(!this._isCustomRole&&esriGeowConfig.userRole.isAdmin()||this.currentUser&&this.item.owner===this.currentUser.email||this._isOwnershipShared)a.style("layerMenu-reviewAddresses","display",
-1<a.indexOf(this.item.typeKeywords,"Involved Lookup")?"":"none");if(this._isCustomRole&&!this._roleCanCreateItem||this._isOwnershipShared&&!this._isExportEnabled(b.capabilities))a.style("layerMenu-exportShapefile","display","none"),a.style("layerMenu-exportData","display","none"),a.style("layerMenu-exportFgdb","display","none"),a.style("layerMenu-exportGeoJson","display","none"),a.style("layerMenu-exportFeatureCollection","display","none");if(this.item.owner!==this.currentUser.email&&!this._isOwnershipShared&&
(!this.itemUser||!esriGeowConfig.userRole||!esriGeowConfig.userRole.isAdmin()&&!this._roleCanUpdateItems))a.style("layerMenu-enableAttachments","display","none"),a.style("layerMenu-disableAttachments","display","none"),a.style("layerMenu-timeSettings","display","none")}},getAGSFeatureServiceLayers:function(){a.attr(this.mapContentsSpan,"innerHTML",this.i18n.mapLayers);a.empty("item-map-contents");a.style(this.mapContentsSpan,"display","");a.style("item-map-contents","display","");var b=a.hitch(this,
function(b){this.adminServiceInfo=b;this._isSDSFeatureService&&(this.adminServiceInfo.capabilities&&-1<this.adminServiceInfo.capabilities.indexOf("Sync"))&&a.query(".portalSync").style("display","");this._isSDSFeatureService&&a.query(".portalEdits").style("display","");var c=this.item.url||this.item.sourceUrl,d=-1<a.indexOf(this.item.typeKeywords,"Involved Lookup");esri.request({url:this.item.url,content:{f:"json",token:this.serverToken}}).then(a.hitch(this,function(b){this.serviceInfo=b;esriGeowConfig.publishTilesFromFeaturesEnabled&&
(this._isSDSFeatureService&&-1===a.indexOf(this.item.typeKeywords,"Table")&&-1===a.indexOf(this.item.typeKeywords,"webmap_2.1"))&&this._getRelatedItems("Service2Service","forward").then(a.hitch(this,function(a){this._isCustomRole&&!this._roleCanPublishTiles||"admin"!==this.item.itemControl?f.byId("item-publish-tile-service-button").set("style",{display:"none"}):(f.byId("item-publish-tile-service-button").set("style",{display:""}),a&&0<a.length&&f.byId("item-publish-tile-service-button").set("disabled",
!0))}));var e=this.adminServiceInfo.layers||b.layers,m=this.adminServiceInfo.tables||b.tables;b=[];m=a.filter(m,a.hitch(this,function(a){return"Table"===a.type&&!d&&"Review"!==a.name}));e&&0<e.length&&(b=b.concat(e),a.forEach(e,a.hitch(this,function(b){var d=c+"/"+b.id+"?token\x3d"+this.serverToken,e=a.create("span",{className:"esriItemLinks"},"item-map-contents");a.create("a",{href:d,innerHTML:b.name,title:b.name,target:"_blank"},e);d=a.create("span",{id:"layer-actions-"+b.id,innerHTML:'\x26nbsp;\x3cimg src\x3d"'+
this.util.relativeToExplicitUrl("js/arcgisonline/css/images/"+(esriGeowConfig.isRightToLeft?"rtlarrow.png":"Context_menu11.png"))+'" alt/\x3e',className:"calciteContextMenu ",style:{display:"inline-block","vertical-align":"middle"}},e);a.connect(d,"onclick",a.hitch(this,this.openLayerMenu,b));this._isPortal&&this.checkServiceDirStatus(this.item.url).then(a.hitch(this,function(b){b&&!b.enabled&&a.create("label",{innerHTML:" "+this.i18n.serviceDirDisabled},e,"last")}))})));m&&0<m.length&&(b=b.concat(m),
!e||0===e.length?a.attr(this.mapContentsSpan,"innerHTML",this.i18n.mapTables):(a.create("br",null,"item-map-contents"),a.create("br",null,"item-map-contents"),a.create("span",{"class":"esriItemProperties",innerHTML:this.i18n.mapTables},"item-map-contents")),a.forEach(m,a.hitch(this,function(b){var d=c+"/"+b.id+"?token\x3d"+this.serverToken,e=a.create("span",{className:"esriItemLinks"},"item-map-contents");a.create("a",{href:d,innerHTML:b.name,title:b.name,target:"_blank"},e);d=a.create("span",{id:"layer-actions-"+
b.id,innerHTML:'\x26nbsp;\x3cimg src\x3d"'+this.util.relativeToExplicitUrl("js/arcgisonline/css/images/"+(esriGeowConfig.isRightToLeft?"rtlarrow.png":"Context_menu11.png"))+'" alt/\x3e',className:"calciteContextMenu ",style:{display:"inline-block","vertical-align":"middle"}},e);a.connect(d,"onclick",a.hitch(this,this.openLayerMenu,b));this._isPortal&&this.checkServiceDirStatus(this.item.url).then(a.hitch(this,function(b){b&&!b.enabled&&a.create("label",{innerHTML:" "+this.i18n.serviceDirDisabled},
e,"last")}))})));if(!this._isPortal||this._isPortal&&-1===a.indexOf(this.item.typeKeywords,"providerBDS")){a.query(".hostedFeaturesOnly").style("display","block");this.updateExportLayersMenu(e,this._isSDSFeatureService?this.adminServiceInfo:this.serviceInfo);"Feature Service"===this.item.type&&-1<a.indexOf(this.item.typeKeywords,"Hosted Service")&&this._showGeocodeCountDlg();for(e=0;e<b.length;e++);b=this._isSDSFeatureService?this.adminServiceInfo.capabilities.split(","):this.serviceInfo.capabilities.split(",");
for(e=0;e<b.length;e++)b[e]&&(b[e]=a.trim(b[e]));this.canShowOpenWithFullEditingControl(b)?(e=new f.MenuItem({label:this.i18n.openViewerFullEditingRole,onClick:a.partial(this.openServiceWithFullEditingControl,this.item.id)}),this.updateFeatureServiceOpenMenu(e,2)):(this._openMenu&&(this._openMenu.destroyRecursive(),this._openMenu=null),this.updateOpenMenu());this._syncEnabled=-1<a.indexOf(b,"Sync");a.attr(a.byId("item-editSync"),"innerHTML",this._syncEnabled?this.i18n.editFeaturesEnabled:this.i18n.disabledLabel);
this._exportEnabled=-1<a.indexOf(b,"Extract");a.attr(a.byId("item-exportData"),"innerHTML",this._exportEnabled?this.i18n.configEnableExport:this.i18n.disabledLabel);-1<a.indexOf(b,"Editing")?-1<a.indexOf(b,"Create")&&-1<a.indexOf(b,"Update")&&-1<a.indexOf(b,"Delete")&&this.serviceInfo.allowGeometryUpdates?a.attr(a.byId("item-editFeatures"),"innerHTML",this.i18n.editFeaturesAll):-1<a.indexOf(b,"Update")&&!this.serviceInfo.allowGeometryUpdates?a.attr(a.byId("item-editFeatures"),"innerHTML",this.i18n.editFeaturesUpdate):
-1<a.indexOf(b,"Create")&&this.serviceInfo.allowGeometryUpdates?a.attr(a.byId("item-editFeatures"),"innerHTML",this.i18n.editFeaturesAdd):a.attr(a.byId("item-editFeatures"),"innerHTML",this.i18n.editFeaturesAll):a.attr(a.byId("item-editFeatures"),"innerHTML",this.i18n.disabledLabel);var n;if(this._isSDSFeatureService)n=this.adminServiceInfo.editorTrackingInfo;else for(e=0;e<this.adminServiceInfo.extensions.length;e++)if(b=this.adminServiceInfo.extensions[e],"FeatureServer"===b.typeName){n=b.editorTrackingInfo;
break}n&&n.enableEditorTracking?(e=n.enableOwnershipAccessControl&&!n.allowOthersToUpdate&&!n.allowOthersToDelete&&n.allowOthersToQuery,b=n.enableOwnershipAccessControl&&!n.allowOthersToUpdate&&!n.allowOthersToDelete&&!n.allowOthersToQuery,n.enableEditorTracking?(n=this.i18n.trackEditsDesc,e?n+="\x3cbr/\x3e"+this.i18n.trackEditsRestricted:b&&(n+="\x3cbr/\x3e"+this.i18n.trackEditsView),a.attr(a.byId("item-trackEdits"),"innerHTML",n)):a.attr(a.byId("item-trackEdits"),"innerHTML",this.i18n.disabledLabel)):
a.attr(a.byId("item-trackEdits"),"innerHTML",this.i18n.disabledLabel)}this.enableEditButton()}))}),c=a.hitch(this,function(a){this.enableEditButton()}),d=this._encodeServiceName(this.item.adminUrl);esri.request({url:d,content:{f:"json",token:this.adminServerToken}}).then(b,c)},canShowOpenWithFullEditingControl:function(b){var c=this.currentUser?this.item.url&&-1<this.item.url.indexOf(this.currentUser.orgId):!1;b=b&&-1<a.indexOf(b,"Editing");return this.currentUser&&(this._roleCanEditWithFullControl&&
(this.itemUser||c)&&b||this._isOwnershipShared||this._roleCanEditWithFullControl&&this.item.itemControl&&-1<this.item.itemControl.indexOf("admin")||this.item.owner===this.currentUser.username&&(!this._isCustomRole||this._roleCanEditFeatures)||this.isAdmin)},_getSourceDataItem:function(){var b=new a.Deferred;this._getRelatedItems("Service2Data","forward").then(a.hitch(this,function(a){a&&0<a.length&&(this.serviceDefinitionID=a[0].id,this.serviceDefinitionType=a[0].type);b.resolve()}),a.hitch(this,
function(a){b.resolve()}));return b},_createSpanLink:function(b){var c=esriGeowConfig.baseUrl+"item.html?id\x3d";b&&(b.id&&b.title)&&(a.create("span",{innerHTML:b.title},"item-map-contents","next"),b=c+b.id,a.create("a",{href:b,innerHTML:b,title:b,target:"_blank"},a.create("span",{className:"esriItemLinks",style:"margin: 0 1.5em 0.5em 1.5em"},"item-map-contents")))},getWorkforceContent:function(b){b=b||{};var c=b.workerWebMapId,d=b.dispatcherWebMapId,e=b.dispatchers,g=b.assignments,h=b.workers,k=
b.tracks;a.empty("item-map-contents");a.style(this.mapContentsSpan,"display","");a.style("item-map-contents","display","");a.attr(this.mapContentsSpan,"innerHTML",this.i18n.projectContents);esri.hide(this._commentsSection);esri.hide(f.byId("item-usage-button").domNode);this._createSpanLink({id:d,title:this.i18n.dispatcherMap});this._createSpanLink({id:c,title:this.i18n.mobileWorkerMap});this._createSpanLink(a.mixin(g,{id:g.serviceItemId,title:this.i18n.assignments}));this._createSpanLink(a.mixin(e,
{id:e.serviceItemId,title:this.i18n.dispatchers}));this._createSpanLink(a.mixin(h,{id:h.serviceItemId,title:this.i18n.workers}));this._createSpanLink(a.mixin(k,{id:k.serviceItemId,title:this.i18n.workerTracks}));b&&(d||c)&&a.query(".mapOnly",this.domNode).style("display","")},getFormContent:function(){this._getRelatedItems("Survey2Service","forward").then(a.hitch(this,function(b){if(b=b&&b.length?b[0]:null)esri.hide(a.byId("item-metadata-button-span")),a.empty("item-map-contents"),a.style(this.mapContentsSpan,
"display",""),a.style("item-map-contents","display",""),a.attr(this.mapContentsSpan,"innerHTML",this.i18n.mapLayers),this._createSpanLink({id:b.id,title:b.title}),a.query(".mapOnly",this.domNode).style("display","")}),a.hitch(this,function(a){this._showError(a)}))},getFeatureServiceLayers:function(){a.empty("item-map-contents");a.style(this.mapContentsSpan,"display","");a.style("item-map-contents","display","");var b={url:this.item.url.replace("/rest/","/rest/admin/")},c=-1<a.indexOf(this.item.typeKeywords,
"Involved Lookup");9>a.isIE&&(b.url+="?ts\x3d"+(new Date).getTime());this.util.request(b).then(a.hitch(this,function(b){this.adminServiceInfo=b;var e=this.item.url||this.item.sourceUrl;this._getSourceDataItem().then(a.hitch(this,function(){this.serviceDefinitionType&&"Service Definition"===this.serviceDefinitionType||this._setScaleRanges()}));esriGeowConfig.publishTilesFromFeaturesEnabled&&(-1===a.indexOf(this.item.typeKeywords,"Table")&&-1===a.indexOf(this.item.typeKeywords,"webmap_2.1"))&&this._getRelatedItems("Service2Service",
"forward").then(a.hitch(this,function(a){!this._roleCanPublishTiles||"admin"!==this.item.itemControl?f.byId("item-publish-tile-service-button").set("style",{display:"none"}):(f.byId("item-publish-tile-service-button").set("style",{display:""}),a&&0<a.length&&f.byId("item-publish-tile-service-button").set("disabled",!0))}));b=a.filter(this.adminServiceInfo.layers,a.hitch(this,function(a){return"Table"!==a.type}));var g=a.filter(this.adminServiceInfo.layers,a.hitch(this,function(a){return"Table"===
a.type&&!c&&"Review"!==a.name}));b&&0<b.length&&(a.attr(this.mapContentsSpan,"innerHTML",this.i18n.mapLayers),a.forEach(b,a.hitch(this,function(b){var c=e+"/"+b.id,d;this.util.isHostedServiceItem({url:c})&&(c+="public"!==this.item.access||this.item.itemControl&&-1<this.item.itemControl.indexOf("admin")?this.token:"");d=a.create("span",{className:"esriItemLinks"},"item-map-contents");a.create("a",{href:c,innerHTML:b.name,title:b.name,target:"_blank"},d);c=a.create("span",{id:"layer-actions-"+b.id,
innerHTML:'\x26nbsp;\x3cimg src\x3d"'+this.util.relativeToExplicitUrl("js/arcgisonline/css/images/"+(esriGeowConfig.isRightToLeft?"rtlarrow.png":"Context_menu11.png"))+'" alt/\x3e',className:"calciteContextMenu ",style:{display:"inline-block","vertical-align":"middle"}},d);a.connect(c,"onclick",a.hitch(this,this.openLayerMenu,b))})));g&&0<g.length&&(!b||0===b.length?a.attr(this.mapContentsSpan,"innerHTML",this.i18n.mapTables):(a.create("br",null,"item-map-contents"),a.create("br",null,"item-map-contents"),
a.create("span",{"class":"esriItemProperties",innerHTML:this.i18n.mapTables},"item-map-contents")),a.forEach(g,a.hitch(this,function(b){var c=e+"/"+b.id,d;this.util.isHostedServiceItem({url:c})&&(c+="public"!==this.item.access||this.item.itemControl&&this.item.itemControl.indexOf("admin")?this.token:"");d=a.create("span",{className:"esriItemLinks"},"item-map-contents");a.create("a",{href:c,innerHTML:b.name,title:b.name,target:"_blank"},d);c=a.create("span",{id:"layer-actions-"+b.id,innerHTML:'\x26nbsp;\x3cimg src\x3d"'+
this.util.relativeToExplicitUrl("js/arcgisonline/css/images/"+(esriGeowConfig.isRightToLeft?"rtlarrow.png":"Context_menu11.png"))+'" alt/\x3e',className:"calciteContextMenu ",style:{display:"inline-block","vertical-align":"middle"}},d);a.connect(c,"onclick",a.hitch(this,this.openLayerMenu,b))})));a.query(".hostedFeaturesOnly").style("display","block");this.updateExportLayersMenu(this.adminServiceInfo.layers,this.adminServiceInfo);"Feature Service"===this.item.type&&-1<a.indexOf(this.item.typeKeywords,
"Hosted Service")&&this._showGeocodeCountDlg();b=!1;var h;for(h=0;h<this.adminServiceInfo.layers.length;h++)!1===this.adminServiceInfo.layers[h].allowGeometryUpdates&&(b=!0);g=this.adminServiceInfo.capabilities.split(",");for(h=0;h<g.length;h++)g[h]&&(g[h]=a.trim(g[h]));this.canShowOpenWithFullEditingControl(g)?(h=new f.MenuItem({label:this.i18n.openViewerFullEditingRole,onClick:a.partial(this.openServiceWithFullEditingControl,this.item.id)}),this.updateFeatureServiceOpenMenu(h,2)):(this._openMenu&&
(this._openMenu.destroyRecursive(),this._openMenu=null),this.updateOpenMenu());this._syncEnabled=this.adminServiceInfo.syncEnabled||-1<a.indexOf(g,"Sync");a.attr(a.byId("item-editSync"),"innerHTML",this._syncEnabled?this.i18n.editFeaturesEnabled:this.i18n.disabledLabel);this._exportEnabled=-1<a.indexOf(g,"Extract");a.attr(a.byId("item-exportData"),"innerHTML",this._exportEnabled?this.i18n.configEnableExport:this.i18n.disabledLabel);-1<a.indexOf(g,"Editing")?-1<a.indexOf(g,"Create")&&-1<a.indexOf(g,
"Update")&&-1<a.indexOf(g,"Delete")&&this.adminServiceInfo.allowGeometryUpdates&&!b?a.attr(a.byId("item-editFeatures"),"innerHTML",this.i18n.editFeaturesAll):-1<a.indexOf(g,"Update")&&!this.adminServiceInfo.allowGeometryUpdates&&b?a.attr(a.byId("item-editFeatures"),"innerHTML",this.i18n.editFeaturesUpdate):-1<a.indexOf(g,"Create")&&this.adminServiceInfo.allowGeometryUpdates?a.attr(a.byId("item-editFeatures"),"innerHTML",this.i18n.editFeaturesAdd):a.attr(a.byId("item-editFeatures"),"innerHTML",this.i18n.editFeaturesAll):
a.attr(a.byId("item-editFeatures"),"innerHTML",this.i18n.disabledLabel);(h=this.adminServiceInfo.editorTrackingInfo)&&h.enableEditorTracking?(b=h.enableOwnershipAccessControl&&!h.allowOthersToUpdate&&!h.allowOthersToDelete&&h.allowOthersToQuery,g=h.enableOwnershipAccessControl&&!h.allowOthersToUpdate&&!h.allowOthersToDelete&&!h.allowOthersToQuery,h.enableEditorTracking?(h=this.i18n.trackEditsDesc,b?h+="\x3cbr/\x3e"+this.i18n.trackEditsRestricted:g&&(h+="\x3cbr/\x3e"+this.i18n.trackEditsView),a.attr(a.byId("item-trackEdits"),
"innerHTML",h)):a.attr(a.byId("item-trackEdits"),"innerHTML",this.i18n.disabledLabel)):a.attr(a.byId("item-trackEdits"),"innerHTML",this.i18n.disabledLabel);this.enableEditButton()}),a.hitch(this,function(a){this._jobId?this.reloadPage():this.enableEditButton()}))},openServiceWithFullEditingControl:function(a){var c=esriGeowConfig.baseUrl+"webmap/viewer.html?layers\x3d"+a+"\x26isAdmin\x3dtrue";arcgisonline.map.storage.getMapCookie(function(a){a&&!0===a.c?arcgisonline.sharing.dijit.dialog.OpenMapDlg.prototype.statics.getInstance().show(c,
a):document.location=c})},openLayerWithReview:function(){window.location=esriGeowConfig.baseUrl+"webmap/viewer.html?layers\x3d"+this.item.id+"\x26review\x3dtrue"},_queryGeocodeCounts:function(b){var c=this.item.url||this.item.sourceUrl,d=[],e={where:"1\x3d1",returnCountOnly:!0,token:this.util.getToken()};d.push(this.util.request({url:c+"/"+b[0].id+"/query",content:e}));b&&1<b.length&&(b=c+"/"+b[1].id+"/query",d.push(this.util.request({url:b,content:e})));return a.promise.all(d).then(a.hitch(this,
function(a){var b=a&&a.length&&a[0].count||0;return{successful:b,total:b+(a&&a.length&&1<a.length&&a[1].count||0)}}))},_getFederatedServers:function(){var b=new a.Deferred,c=arcgisonline.sharing.util.getUser();!esriGeowConfig.federatedServers&&c?this.util.request({url:esriGeowConfig.restBaseUrl+"portals/"+esriGeowConfig.self.id+"/servers"}).then(a.hitch(this,function(a){esriGeowConfig.federatedServers=a.servers;b.resolve(a)}),a.hitch(this,function(a){console.log("cannot load federated servers",a);
esriGeowConfig.federatedServers=[];b.resolve([])})):b.resolve(esriGeowConfig.federatedServers);return b},_getItemAdminUrl:function(b){var c,d=new a.Deferred;this._hostedServer&&this._hostedServer.url&&this._hostedServer.adminUrl?(c=this.convertUrlToAdminUrl(b.url),d.resolve(c)):this._getFederatedServers().then(a.hitch(this,function(e){(this._hostedServer=(e=a.filter(e,function(a){return!0===a.isHosted}))&&e.length&&e[0])&&this._hostedServer.url&&this._hostedServer.adminUrl?(c=this.convertUrlToAdminUrl(b.url),
d.resolve(c)):d.resolve(b.url)}));return d},convertUrlToAdminUrl:function(b){var c=this.getUrlWithoutScheme(this._hostedServer.url),d=this.getUrlWithoutScheme(this._hostedServer.adminUrl);a.clone(b);b=b.replace(c,d);b=this._isSDSFeatureService?b.replace("/rest/","/rest/admin/"):b.replace("/rest/","/admin/").replace("/FeatureServer",".MapServer").replace("/MapServer",".MapServer").replace("/VectorTileServer",".VectorTileServer");return this.alterSchemeToMatch(b,this._hostedServer.adminUrl)},alterSchemeToMatch:function(a,
c){if(esri.isDefined(c)){if(0===c.indexOf("https:"))return a.indexOf(":6080")&&(a=a.replace(":6080",":6443")),a.replace("http:","https:");if(0===c.indexOf("http:"))return a.indexOf(":6443")&&(a=a.replace(":6443",":6080")),a.replace("https:","http:")}return a},getUrlWithoutScheme:function(a){if(esri.isDefined(a)){if(0===a.indexOf("http://"))return a.substring(7);if(0===a.indexOf("https://"))return a.substring(8)}return a},getServerToken:function(b){if(b.url&&!this.serverToken&&!this.adminServerToken){var c=
b.url.substring(0,b.url.indexOf("/rest/services"));this._getServerToken(c).then(a.hitch(this,function(c){c&&c.token&&(this.serverToken=c.token,c=a.query("#item-map-contents span \x3e a")[0].innerHTML,a.query("#item-map-contents span \x3e a").attr("href",b.url+"?token\x3d"+this.serverToken).removeAttr("onclick"),a.query("#item-map-contents span \x3e a")[0].innerHTML=c,this._updateThumbnail(this.item),-1<a.indexOf(this.item.typeKeywords,"providerSDS")?this._isSDSFeatureService=!0:this._isSDSFeatureService=
!1,this._getItemAdminUrl(this.item).then(a.hitch(this,function(b){this.item.adminUrl=b;this._getServerToken(b).then(a.hitch(this,function(c){this.adminServerToken=c.token;this._isSDSFeatureService||a.query(".enableExport",this.domNode).style("display","none");this.checkAGSMapServerCapabilities(b);this.checkAGSSvc(this.item)}))})))}))}},checkAGSSvc:function(b){this.checkAGSSvcStatus(b.adminUrl);this.checkServiceDirStatus(b.url,b.adminUrl).then(a.hitch(this,function(b){b&&!b.enabled&&a.create("label",
{innerHTML:" "+this.i18n.serviceDirDisabled},a.query("#item-map-contents span \x3e a")[0],"after")}))},checkServiceDirStatus:function(b,c){var d=new a.Deferred;if(esriGeowConfig.federatedServers){for(var e=0,g=!1,h;e<esriGeowConfig.federatedServers.length;e++)if(h=esriGeowConfig.federatedServers[e],b&&(b.startsWith(h.url)||b.startsWith(h.adminUrl))||c&&(c.startsWith(h.url)||c.startsWith(h.adminUrl))){g=!0;break}g?this.util.request({url:h.adminUrl+"/admin/system/handlers/rest/servicesdirectory"},{useProxy:!0}).then(a.hitch(this,
function(a){a&&a.enabled&&"false"!==a.enabled?d.resolve({enabled:!0}):d.resolve({enabled:!1})}),a.hitch(this,function(a){d.resolve({enabled:!0})})):d.resolve({enabled:!0})}else d.resolve({enabled:!0});return d},_getServerToken:function(a){a={serverUrl:a};return this.util.request({url:this.util.getSecureUrl(esriGeowConfig.restBaseUrl)+"generateToken",content:a},{usePost:!0})},checkSceneStatus:function(b){if(this._isPortal){var c=b.url;this.disableEditButton();this.util.request({url:b.url}).then(a.hitch(this,
function(a){a&&(!a.code&&!a.message)&&(this.serviceInfo=a,this._isPortal&&this.buildSceneCache()?this.doBuildSceneCache(c):(this.enableEditButton(),this.updateSvcNodes(!1)))}))}},checkStatus:function(b){a.style(this.mapContentsSpan,"display","none");a.style("item-map-contents","display","none");this.disableEditButton();if(this._isPortal)this.updateSvcNodes(!1),this.getServerToken(b);else{b=b.url.split("/");var c=b.splice(b.length-2,2);b.splice(a.indexOf(b,"rest"),1,"rest/admin");this.checkSvcStatus(b.join("/")+
"/"+c.join("/")+"/status")}},checkAGSMapServerCapabilities:function(b){esri.request({url:this._hostedServer.adminUrl+"/admin/services/types/MapServer",content:{f:"json",token:this.adminServerToken}}).then(a.hitch(this,function(b){if(b&&b.ExtensionTypes)for(var d,e=0;e<b.ExtensionTypes.length;e++)(d=b.ExtensionTypes[e])&&(d.Name&&"FeatureServer"===d.Name&&d.Info&&d.Info.AllWebCapabilities&&-1<d.Info.AllWebCapabilities.indexOf("Sync"))&&a.query(".portalSync").style("display","")}))},_checkAGSFeatureServiceAdminUrl:function(b){if(a.has("ie")||
a.has("trident")){var c=b.split("admin/services/Hosted/")[1],c=-1<c.indexOf(".")?c.split(".")[0]:c.split("/")[0];b=b.replace(c,encodeURIComponent(c))}return esri.request({url:b,content:{f:"json",token:this.adminServerToken}})},_encodeServiceName:function(b){if(a.has("ie")||a.has("trident")){var c=b.indexOf("admin/services/Hosted/"),d=this._isPortal&&!this._isSDSFeatureService?b.indexOf(".MapServer")||svcUr.indexOf(".VectorTileServer"):b.indexOf("/FeatureServer");0<c&&(b=b.substring(0,c+22)+encodeURIComponent(b.substring(c+
22,d))+b.substring(d))}return b},checkAGSSvcStatus:function(b,c){b=this._encodeServiceName(b);esri.request({url:b+"/status",content:{f:"json",token:this.adminServerToken}}).then(a.hitch(this,function(d){this._isSDSFeatureService&&d.status&&"publishing"!==d.status.toLowerCase()||!this._isSDSFeatureService&&d.realTimeState&&"publishing"!==d.realTimeState.toLowerCase()?(this.enableEditButton(),this.updateSvcNodes(!1),c?(this.enableEditButton(),this.fillItemInfo()):(this._updateThumbnail(this.item),this.getAGSFeatureServiceLayers())):
400<d.code?(this.enableEditButton(),this.updateSvcNodes(!0),arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.error.error,message:d.details[0]})):"failed"===d.status&&d.statusMessage?(this.enableEditButton(),this.updateSvcNodes(!0),arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.error.error,message:d.statusMessage})):(this.updateSvcNodes(!0),setTimeout(a.hitch(this,"checkAGSSvcStatus",b,!0),3E3))}),
a.hitch(this,function(a){this.updateSvcNodes(!1);this._showError(a)}))},checkSvcStatus:function(b,c){var d=a.hitch(this,function(d){d.status&&"Publishing"!==d.status?(this.enableEditButton(),this.updateSvcNodes(!1),c?(this.enableEditButton(),this.fillItemInfo()):(this._updateThumbnail(this.item),this.getFeatureServiceLayers())):400<d.code?(this.enableEditButton(),this.updateSvcNodes(!0),arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.error.error,
message:d.details[0]})):(this.updateSvcNodes(!0),setTimeout(a.hitch(this,"checkSvcStatus",b,!0),3E3))});this.util.getJson(b,d,a.hitch(this,function(a){this.updateSvcNodes(!1);this._showError(a)}))},setupManageTiles:function(b){this._currentTileScales=this._calculateTileData(b);var c=0,d=0;a.forEach(this._currentTileScales,function(a){c+=a.created;d+=a.expected},this);var e=a.number.round(100*(c/d),2)||0,e=100<e?100:e;a.byId("item-percentTiles").innerHTML=a.string.substitute(this.i18n.percentTilesAvailable,
{percent:a.number.format(e)});if(this.currentUser&&(this.item.owner===this.currentUser.username||this.isAdmin||this._roleCanViewItems&&this._roleCanUpdate))if(a.byId("manageTilesSpan")&&a.destroy(a.byId("manageTilesSpan")),e=a.create("span",{id:"manageTilesSpan",className:"esriItemLinks readOnly",innerHTML:" "},a.byId("item-percentTiles")),e=a.create("a",{href:"#",innerHTML:"\x26nbsp;"+this.i18n.managingTiles},e),a.connect(e,"onclick",a.hitch(this,function(){var a=arcgisonline.sharing.dijit.dialog.ManageTilesDlg.prototype.statics.getInstance();
this._isPortal&&a.setServerTokens(this._hostedServer,this.serverToken,this.adminServerToken);if(this.serviceDefinitionID){var c=this._isTilePackage(this.serviceDefinitionType);this._isPortal?a.show(this.item,b,c):a.show(this.item,this._currentTileStatus,c)}else this._isPortal?a.showNoSource(this.item,b):a.showNoSource(this.item,this._currentTileStatus)})),e=esri.urlToObject(document.URL),e.query&&e.query.showManageTiles)if(e=arcgisonline.sharing.dijit.dialog.ManageTilesDlg.prototype.statics.getInstance(),
this._isPortal&&e.setServerTokens(this._hostedServer,this.serverToken,this.adminServerToken),this.serviceDefinitionID){var g=this._isTilePackage(this.serviceDefinitionType);this._isPortal?e.show(this.item,b,g):e.show(this.item,this._currentTileStatus,g)}else this._isPortal?e.showNoSource(this.item,b):e.showNoSource(this.item,this._currentTileStatus)},checkTileStatus:function(b){var c=a.hitch(this,function(c){if(!c||!("Error"==c.name&&"Unknown runtime error"==c.message)){this.serviceInfo.tileInfo&&
(this.serviceInfo.tileInfo.lods&&0<this.serviceInfo.tileInfo.lods.length)&&(c.minScale||(c.minScale=this.serviceInfo.tileInfo.lods[0].scale,this._isPortal&&(c.minScale=c.properties.minScale)),c.maxScale||(c.maxScale=this.serviceInfo.tileInfo.lods[this.serviceInfo.tileInfo.lods.length-1].scale,this._isPortal&&(c.maxScale=c.properties.maxScale)));this._currentTileStatus=c;if("Vector Tile Service"===this.item.type)a.query(".manageTiles-flag",this.domNode).style("display","none"),this._currentTileScales=
this._calculateTileData(this.serviceInfo);else if(this._isPortal){var d=this.item.url.indexOf("/services/")+10,h=this.item.url.indexOf("/"+this._currentTileStatus.serviceName+"/")+1,d=this.item.url.substring(d,h),h=("https:"===location.protocol?this._hostedServer.url.replace("http:","https:").replace(":6080",":6443"):this._hostedServer.url.replace("https:","http:").replace(":6443",":6080"))+"/rest/services/System/ReportingTools/GPServer/ReportCacheStatus/execute";esri.request({url:h,content:{service_url:d+
this._currentTileStatus.serviceName+":"+this._currentTileStatus.type,report_mode:"esriCacheStatus",f:"json",token:this.serverToken}}).then(a.hitch(this,function(a){a=a.results[0];a.serviceName=this._currentTileStatus.serviceName;a.type=this._currentTileStatus.type;a.lodInfos=a.value.lodInfos;a.cacheExecutionStatus=a.value.cacheExecutionStatus;a.minScale=parseFloat(this._currentTileStatus.minScale);a.maxScale=parseFloat(this._currentTileStatus.maxScale);this.setupManageTiles(a)}))}else this.setupManageTiles(c);
c.minScale&&c.maxScale&&(d=a.number.format(Math.round(c.minScale),{pattern:"#,###,###,##0"}),h=a.number.format(Math.round(c.maxScale),{pattern:"#,###,###,##0"}),a.byId("item-scaleRange").innerHTML="1:"+d+"\x26nbsp;\x26nbsp;"+this.i18n.to+"\x26nbsp; 1:"+h);this.serviceDefinitionID&&"Vector Tile Service"!==this.item.type?(d=c.exportTilesAllowed||this._isPortal&&"true"===c.properties.exportTilesAllowed)?(a.attr(a.byId("item-exportTiles"),"innerHTML",this.i18n.offlineModeEnabled),f.byId("item-exportTiles-enable").set("checked",
d)):a.attr(a.byId("item-exportTiles"),"innerHTML",this.i18n.disabledLabel):a.query(".exportTiles-flag",this.domNode).style("display","none");a.query(".hostedTilesOnly",this.domNode).style("display","block");this.buildCache(c.cacheExecutionStatus)&&(!this._isPortal&&"Vector Tile Service"!==this.item.type)&&this.tilePackageMinMaxScaleFix(c.minScale,c.maxScale).then(a.hitch(this,function(a){this.doBuildCache(c)}));"PROCESSING"!==c.cacheExecutionStatus&&"SUBMITTED"!==c.cacheExecutionStatus?this.cacheBuilt?
(this.fillItemInfo(),this.cacheBuilt=!1):(this._basicStandby.hide(),b&&this.fillItemInfo()):(this._isTilePackage(this.serviceDefinitionType)?a.byId("standbyText").innerHTML=this.i18n.publishingTiles:a.byId("standbyText").innerHTML=this.i18n.buildingTiles,this._basicStandby.show(),setTimeout(a.hitch(this,"checkTileStatus",!0),3E3))}}),d;this._isPortal?(d=this.item.url,-1<d.indexOf("/VectorTileServer")?(d=this.item.url,this.util.request({url:d}).then(c,c)):(d=d.replace("/rest/","/admin/"),d=d.replace("/MapServer",
".MapServer"),this._getItemAdminUrl(this.item).then(a.hitch(this,function(b){this.item.adminUrl=b;this.adminServerToken?esri.request({url:this.item.adminUrl,content:{f:"json",token:this.adminServerToken}}).then(c,c):this._getServerToken(this.item.adminUrl).then(a.hitch(this,function(a){this.adminServerToken=a.token;esri.request({url:this.item.adminUrl,content:{f:"json",token:this.adminServerToken}}).then(c,c)}))})))):(d=this.item.url.replace("/rest/","/rest/admin/"),this.util.getJson(d,c,c));this.enableEditButton()},
tilePackageMinMaxScaleFix:function(a,c){var d={minScale:a,maxScale:c,sourceItemId:this.serviceDefinitionID},e=this.item.url.replace("/rest/","/rest/admin/")+"/edit";return this.util.request({url:e,content:d},{usePost:!0})},buildSceneCache:function(){var a=esri.urlToObject(document.URL);return a.query&&a.query.buildCache&&!this.cacheBuilt&&this.currentUser&&(this.item.owner===this.currentUser.username||this.isAdmin||this._roleCanViewItems&&this._roleCanUpdateItems)},doBuildSceneCache:function(b){a.attr(a.byId("standbyText"),
"innerHTML",this.i18n.buildingCache);this._basicStandby.show();this._isPortal&&this._getItemAdminUrl(this.item).then(a.hitch(this,function(b){this._getServerToken(this.item.url).then(a.hitch(this,function(b){this.serverToken=b.token;var c=("https:"===location.protocol?this._hostedServer.url.replace("http:","https:").replace(":6080",":6443"):this._hostedServer.url.replace("https:","http:").replace(":6443",":6080"))+"/rest/services/System/SceneCachingControllers/GPServer/Manage%20Scene%20Cache/submitJob";
b={service_url:this.item.url,num_of_caching_service_instances:1,layer:a.json.stringify({}),update_mode:"RECREATE_ALL_NODES",update_extent:"DEFAULT",area_of_interest:a.json.stringify({displayFieldName:"",geometryType:"esriGeometryPolygon",spatialReference:{wkid:54051,latestWkid:54051},fields:[{name:"OID",type:"esriFieldTypeOID",alias:"OID"},{name:"updateGeom_Length",type:"esriFieldTypeDouble",alias:"updateGeom_Length"},{name:"updateGeom_Area",type:"esriFieldTypeDouble",alias:"updateGeom_Area"}],features:[],
exceededTransferLimit:!1}),f:"json",token:this.serverToken};esri.request({url:c,content:b}).then(a.hitch(this,function(b){b&&(!b.code&&!b.message)&&(this._jobId=b.jobId);window.history&&window.history.replaceState&&window.history.replaceState(null,null,esriGeowConfig.baseUrl+"item.html?id\x3d"+this.item.id);var d=setInterval(a.hitch(this,function(){var b=c.replace("submitJob","jobs/")+this._jobId;esri.request({url:b,content:{f:"json",token:this.serverToken}}).then(a.hitch(this,function(b){"esriJobFailed"===
b.jobStatus&&console.log("scene cache request failed",b);if("esriJobSuccess"===b.jobStatus||"esriJobFailed"===b.jobStatus)clearInterval(d),10>a.isIE&&(window.location=esriGeowConfig.baseUrl+"item.html?id\x3d"+this.item.id),this._jobId=null,this.cacheBuilt=!0,this._onItemLoad(this.item)}))}),1E4)}),a.hitch(this,function(a){console.log("scene cache request failed",a);window.location=esriGeowConfig.baseUrl+"item.html?id\x3d"+this.item.id}))}))}))},buildCache:function(a){var c=esri.urlToObject(document.URL);
return c.query&&c.query.buildCache&&!this.cacheBuilt&&this.currentUser&&(this.item.owner===this.currentUser.username||this.isAdmin||this._roleCanViewItems&&this._roleCanUpdateItems)&&"NONE"===a&&this.serviceInfo.tileInfo&&this.serviceInfo.tileInfo.lods&&0<this.serviceInfo.tileInfo.lods.length},doBuildCache:function(b){this._isTilePackage(this.serviceDefinitionType)?a.byId("standbyText").innerHTML=this.i18n.publishingTiles:a.byId("standbyText").innerHTML=this.i18n.buildingTiles;this._basicStandby.show();
for(var c,d=[],e=0;e<this.serviceInfo.tileInfo.lods.length;e++)c=this.serviceInfo.tileInfo.lods[e],c.scale<=b.minScale&&c.scale>=b.maxScale&&d.push(this.serviceInfo.tileInfo.lods[e].level);c=this.item.url.replace("/rest/","/rest/admin/")+"/updateTiles";if(9>=a.isIE){var e=c.indexOf("admin/services/"),g=c.indexOf("/MapServer");c=c.substring(0,e+15)+encodeURIComponent(c.substring(e+15,g))+c.substring(g)}b={levels:d.join(","),extent:b.fullExtent.xmin+","+b.fullExtent.ymin+","+b.fullExtent.xmax+","+b.fullExtent.ymax};
this.util.request({url:c,content:b},{usePost:!0}).then(a.hitch(this,function(b){window.history&&window.history.replaceState&&window.history.replaceState(null,null,esriGeowConfig.baseUrl+"item.html?id\x3d"+this.item.id);setTimeout(a.hitch(this,function(){10>a.isIE&&(window.location=esriGeowConfig.baseUrl+"item.html?id\x3d"+this.item.id);this.cacheBuilt=!0;this._onItemLoad(this.item)}),1E4)}))},_calculateTileData:function(a){var c,d=[];for(c=0;c<this.serviceInfo.tileInfo.lods.length;c++){var e=this.serviceInfo.tileInfo.lods[c];
if(e.scale<=a.minScale&&e.scale>=a.maxScale){var g=arcgisonline.sharing.dijit.dialog.ManageTilesDlg.util.calculateExpectedTiles(this.serviceInfo.tileInfo,this.serviceInfo.fullExtent,e);g||(g=1);d.push({id:e.level,created:0,expected:g,scale:e.scale})}}if(a.lodInfos)for(c=0;c<a.lodInfos.length;c++){e=a.lodInfos[c];for(g=0;g<d.length;g++)if(d[g]&&d[g].id===e.levelID){d[g].created=e.tileCount;d[g].expected=e.expectedTileCount;break}}return d},getSelectedMinScale:function(){var a=this._currentTileStatus.minScale;
this.fromScaleRange.item&&(a=1===this.fromScaleRange.item.name.length?this.fromScaleRange.item.scale[0]:this.fromScaleRange.item.scale);return a},getSelectedMaxScale:function(){var a=this._currentTileStatus.maxScale;this.toScaleRange.item&&(a=1===this.toScaleRange.item.name.length?this.toScaleRange.item.scale[0]:this.toScaleRange.item.scale);return a},updateSvcNodes:function(b,c){f.byId("item-open-button").set("disabled",b);f.byId("item-delete-button").set("disabled",this.item["protected"]||b&&!c);
f.byId("item-update-button").set("disabled",b);if(b)c?this._basicStandby.hide():this._basicStandby.show(),"Feature Service"===this.item.type&&-1<a.indexOf(this.item.typeKeywords,"Hosted Service")&&(a.style(this.mapContentsSpan,"display","none"),a.style("item-map-contents","display","none")),a.query("#item-map-contents span \x3e a").attr("href","#").attr("onclick","return false;");else{this._basicStandby.hide();var d=a.query("#item-map-contents span \x3e a");d&&0<d.length&&(d=d[0].innerHTML,a.query("#item-map-contents span \x3e a").attr("href",
this.item.url+this.token).removeAttr("onclick"),a.query("#item-map-contents span \x3e a")[0].innerHTML=d)}},onItemLoad:function(a){},loadItemOwner:function(b,c){var d=b.owner;!this.currentUser||d!==this.currentUser.email||this._isOwnershipShared?this.community.getProfile(d,a.hitch(this,this.onItemOwnerProfile,b),a.hitch(this,this.onItemOwnerProfileError,b)):(this.isAdmin=!1,this.loadItem(b))},onItemOwnerProfileError:function(a,c,d){this.isAdmin=!1;this.loadItem(a)},onItemOwnerProfile:function(a,c,
d){c&&c.orgId&&this.currentUser&&c.orgId===this.currentUser.accountId?(this.itemUser=c,this.loadItem(a)):this._isOwnershipShared?(this.isAdmin=!1,this.itemUser=c):(this.isAdmin=!1,this.item||this.loadItem(a))},_setCustomRoleButtonVisibility:function(){this._isCustomRole&&(!this._roleCanShareToGroup&&(!this._roleCanShareToOrg&&!this._roleCanShareToPublic&&!this._roleCanConsumeListings)&&a.style(f.byId("item-share-button").domNode,"display","none"),this._isOwnershipShared||(this.itemUser?(this._roleCanUpdateItems||
(a.style(f.byId("item-edit-button").domNode,"display","none"),a.style(f.byId("item-moveto-button").domNode,"display","none"),a.style(f.byId("item-attach-button").domNode,"display","none"),a.style(f.byId("item-update-button").domNode,"display","none"),a.style(f.byId("item-publish-button").domNode,"display","none"),a.style(f.byId("item-publish-tile-service-button").domNode,"display","none")),this._roleCanDeleteItems||a.style(f.byId("item-delete-button").domNode,"display","none"),this._roleCanReassignItems||
a.style(f.byId("item-reassign-button").domNode,"display","none"),this._roleCanViewItems||a.style(f.byId("item-usage-button").domNode,"display","none"),this._roleCanCreateItem||(a.style(f.byId("item-attach-button").domNode,"display","none"),a.style(f.byId("item-update-button").domNode,"display","none"),a.style(f.byId("item-publish-button").domNode,"display","none"),a.style(f.byId("item-publish-tile-service-button").domNode,"display","none"),a.style(f.byId("item-export-layers-button").domNode,"display",
"none")),(!this._roleCanPublishFeatures||!this._roleCanPublishScenes)&&a.style(f.byId("item-publish-button").domNode,"display","none"),this._roleCanPublishTiles||a.style(f.byId("item-publish-tile-service-button").domNode,"display","none")):this.currentUser.email===this.item.owner&&((!this._roleCanPublishFeatures||!this._roleCanPublishScenes)&&a.style(f.byId("item-publish-button").domNode,"display","none"),this._roleCanPublishTiles||a.style(f.byId("item-publish-tile-service-button").domNode,"display",
"none"),this._roleCanCreateItem||(a.style(f.byId("item-edit-button").domNode,"display","none"),a.style(f.byId("item-delete-button").domNode,"display","none"),a.style(f.byId("item-moveto-button").domNode,"display","none"),a.style(f.byId("item-export-layers-button").domNode,"display","none"),a.style(f.byId("item-attach-button").domNode,"display","none"),a.style(f.byId("item-update-button").domNode,"display","none")))))},loadItem:function(b,c){this.disableEditButton();var d=a.create,e=a.query;this.item=
b;this.item.folderId=b.folderId||b.ownerFolder;this.itemID=b.id;var g=esriGeowConfig.userRole&&esriGeowConfig.userRole.isBasedOnAdmin(),h=esriGeowConfig.userRole&&esriGeowConfig.userRole.canUpdateOrgItems();(this._isOwnershipShared=this.currentUser&&this.item.owner!==this.currentUser.email&&(!g||g&&!h)&&("update"===this.item.itemControl||"admin"===this.item.itemControl))&&!this.itemUser&&this.loadItemOwner(this.item);this._premiumNodeIcon||(this._premiumNodeIcon=this.content._getPremiumItemNode(this.item))&&
a.place(this._premiumNodeIcon,this._premiumNode,"first");this.isAdmin&&this.itemUser||this._roleCanViewUsers&&this.itemUser&&!this._isOwnershipShared?this.util.loadUserTags(this.itemUser.username).then(a.hitch(this,function(a){this._tags.set("knownTags",a);this._canEnableEdit=!0}),a.hitch(this,function(a){this._canEnableEdit=!0})):this.util.loadUserTags(this.currentUser&&this.currentUser.username).then(a.hitch(this,function(a){this._tags.set("knownTags",a);this._canEnableEdit=!0}),a.hitch(this,function(a){this._canEnableEdit=
!0}));this.getComments();(this.isAdmin||this._roleCanUpdateItems||this.currentUser&&this.currentUser.username===this.item.owner)&&this.item.properties&&(this.item.properties.jobUrl&&this.item.properties.jobId)&&this._checkItemJobStatus();this.rating=new arcgisonline.sharing.dijit.ItemRating({item:this.item,numStars:5},this.ratingNode);a.connect(this.rating,"onRatingUpdate",this,function(a){this.rating.item.numRatings=a.numRatings;this.rating.item.avgRating=a.avgRating;this.setRatingsCountLabel(a.numRatings)});
this._showMarketplaceSection();this._showFavoritesButton();this._showAdvancedSection();(this.util.isProApp(this.item)||"Native Application Installer"===this.item.type)&&a.style(f.byId("item-share-button").domNode,"display","none");this.enableButtons();(-1<this.item.owner.indexOf("esri")&&-1!==a.indexOf(this.item.typeKeywords,"Configurable")&&this.item.url&&0===this.item.url.indexOf("/")||-1!==a.indexOf(this.item.typeKeywords,"Web AppBuilder for ArcGIS")||"Native Application"===this.item.type||"Native Application Installer"===
this.item.type||"Native Application Template"===this.item.type)&&this._showScreenshotSection();(!this._isCustomRole||this._roleCanCreateItem)&&(this.currentUser&&(-1<a.indexOf(this.item.typeKeywords,"createAppWithoutMap")||-1<a.indexOf(this.item.typeKeywords,"Web AppBuilder for ArcGIS")&&this.currentUser&&this.currentUser.accountId))&&a.query(".createApp").style("display","inline");var k=function(){d("span",{innerHTML:this.item.snippet?this.util.htmlEncode(this.item.snippet):""},a.byId("item-summary"),
"only");d("span",{innerHTML:this.item.accessInformation?this.util.htmlEncode(this.item.accessInformation):""},a.byId("item-copyright"),"only");d("span",{id:"item-description-span",innerHTML:this.item.description?this.item.description:""},a.byId("item-description"),"only");this.item.licenseInfo&&!1===/^(<br.*\/>)+$/.test(this.item.licenseInfo)?d("span",{id:"item-licenseInfo-span",innerHTML:this.item.licenseInfo?this.item.licenseInfo:""},a.byId("item-licenseInfo"),"only"):a.style(this._itemAccessSection,
"display","none");this.newComment.value="";var b=this.item.extent;a.byId("item-extent-top").innerHTML="";b&&2==b.length&&2==b[0].length&&2==b[1].length?(a.byId("item-extent-top").innerHTML=a.number.format(Math.round(100*b[1][1])/100,this.numberPattern),a.byId("item-extent-left").innerHTML=a.number.format(Math.round(100*b[0][0])/100,this.numberPattern),a.byId("item-extent-right").innerHTML=a.number.format(Math.round(100*b[1][0])/100,this.numberPattern),a.byId("item-extent-bottom").innerHTML=a.number.format(Math.round(100*
b[0][1])/100,this.numberPattern),a.style(a.byId("item-description-extent-available"),"display","block")):a.style(a.byId("item-description-extent-unavailable"),"display","block")};if(this.currentUser&&(this.isAdmin||this._roleCanViewUsers&&this.itemUser||this.item.owner===this.currentUser.email)){g=function(b,c){this.userGroups=b.groups;this.getExtraInfo();(!this._isCustomRole||this._roleCanCreateItem)&&a.connect(this,"_onExtraInfo",a.hitch(this,"enableButtons",!0));a.connect(this,"_onExtraInfo",this,
k)};this.isAdmin&&this.itemUser||this._roleCanViewUsers&&this.itemUser&&!this._isOwnershipShared?(this.community.getUserGroups(a.hitch(this,function(a,b){this.adminGroups=a.groups})),this.community.getUserGroupsByUser(this.itemUser.username,a.hitch(this,g))):this.community.getUserGroups(a.hitch(this,g));a.style(this.tools.domNode,"display","block");(this.isAdmin||this._roleCanReassignItems&&this.itemUser||esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin()&&this.currentUser.username===this.item.owner)&&
f.byId("item-reassign-button").set("style",{display:"inline-block"});if(this.isAdmin||this._roleCanViewItems&&this.itemUser||this.currentUser.username===this.item.owner)if(esriGeowConfig.findFeaturesWebMapEnabled&&"Web Map"===this.item.type||"Web Map"===this.item.type&&0<=a.indexOf(this.item.typeKeywords,"Collector"))this._isAppCollector=!0,e(".operationsCollector",this.domNode).style("display","");this._showMetadataUI();e(".ownerOnly",this.domNode).style("display","");!this._isPortal&&(esriGeowConfig.userRole&&
(esriGeowConfig.userRole.isBasedOnAdmin()||esriGeowConfig.userRole.isBasedOnPublisher()))&&e(".usageOnly",this.domNode).style("display","inline-block");this._canPublish().then(function(a){e(".publishOnly",this.domNode).style("display",a?"inline-block":"none")});this._showRegisterSection();-1!==a.indexOf(this.item.typeKeywords,"Registered App")?(a.query(".registeredApp").forEach(esri.show),a.query(".unRegisteredApp").forEach(esri.hide)):(a.query(".registeredApp").forEach(esri.hide),a.query(".unRegisteredApp").forEach(esri.show),
a.addClass(this._itemRegistrationSection,"readOnly"));a.style(a.byId("item-share-toolbar"),"display","inline");a.style(a.byId("item-owner-toolbar"),"display","inline")}else{e(".ownerOnly",this.domNode).style("display","none");if(this._isOwnershipShared){e(".notSharedOwner",this.domNode).style("display","none");e(".sharedOwner",this.domNode).style("display","");if(esriGeowConfig.findFeaturesWebMapEnabled&&"Web Map"===this.item.type||"Web Map"===this.item.type&&0<=a.indexOf(this.item.typeKeywords,"Collector"))this._isAppCollector=
!0,e(".operationsCollector",this.domNode).style("display","");this._isPortal||e(".usageOnly",this.domNode).style("display","inline-block");this._showMetadataUI();this.enableButtons(!0)}"public"===this.item.access&&this.currentUser||"org"===this.item.access&&this.currentUser&&this.currentUser.accountId||this.item.listed&&this.currentUser&&esriGeowConfig.userRole&&(esriGeowConfig.userRole.isAdmin()||this._roleCanConsumeListings)?(g=function(b,c){(this.userGroups=b.groups)&&0<this.userGroups.length&&
a.style(a.byId("item-share-toolbar"),"display","inline")},this.community.getUserGroups(a.hitch(this,g))):(a.style(a.byId("item-share-toolbar"),"display","none"),a.style(f.byId("item-share-button"),"display","none"));-1<a.indexOf(this.item.typeKeywords,"Metadata")&&a.style(a.byId("item-metadata-button-span"),"display","")}this._checkItemsResources(this.item).then(a.hitch(this,function(){this.updateOpenMenu();this.item.hasResources&&a.style(a.byId("item-update-button-div"),"display","")}));"Feature Service"==
this.item.type?(g=function(a){this.itemData=a?a:null;this.loadItem_Part2(b,this.item.type,k)},arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"content/items/"+this.item.id+"/data",a.hitch(this,g),a.hitch(this,g))):this.loadItem_Part2(b,this.item.type,k)},loadItem_Part2:function(b,c,d){var e=a.create,g=a.query;this.getThumbnail();this.isFile(this.item.name,c.toLowerCase(),this.item.url).then(a.hitch(this,function(b){b&&a.style(a.byId("item-update-button-div"),"display","")}));if("Web Map"==
this.item.type||"Web Scene"==this.item.type)"Web Map"===this.item.type&&(g(".mapOnly",this.domNode).style("display","block"),esriGeowConfig.userRole&&g(".orgMapOnly",this.domNode).style("display","")),this.content.getItemData(this.itemID,a.hitch(this,this.handle_getData),a.hitch(this,this.handle_getDataError));else if("Map Service"==this.item.type||"Image Service"==this.item.type||"Feature Service"==this.item.type||"Scene Service"===this.item.type||"Vector Tile Service"===this.item.type||"Stream Service"===
this.item.type)g(".mapOnly",this.domNode).style("display","block"),this.item&&(a.empty("item-map-contents"),a.create("span",{innerHTML:this.item.title},"item-map-contents","only"),c=g=this.item.url,this.util.isHostedServiceItem(this.item)?(esriGeowConfig.allSSL&&(g=g.replace("http://","https://")),c=g+("public"!==this.item.access||this.item.itemControl&&-1<this.item.itemControl.indexOf("admin")?this.token:"")):-1!==a.indexOf(this.item.typeKeywords,"Service Proxy")&&(this.item&&this.item.sharing&&
"public"===this.item.sharing.access)&&(c=g+"?f\x3dpjson"),a.create("a",{href:c,innerHTML:g,title:g,target:"_blank"},a.create("span",{style:{marginLeft:"1.5em"}},"item-map-contents")));else if("Document Link"===this.item.type||"Native Application"===this.item.type||"Native Application Template"===this.item.type||"Native Application Installer"===this.item.type)g(".application",this.domNode).style("display",""),a.create("a",{href:this.item.url||"",innerHTML:this.item.url||"",title:this.item.url||"",
target:"_blank"},"item-url","only");else if("Web Mapping Application"==this.item.type||"Mobile Application"==this.item.type||"Desktop Application"===this.item.type||"Application"===this.item.type){g("Application"!==this.item.type?".appOnly":".application",this.domNode).style("display","");this.content.getApplicationCode(this.item,a.hitch(this,this.handle_codeAttachment));var f=c="";"Desktop Application"===this.item.type&&(a.create("a",{href:this.item.url||"",innerHTML:this.item.url||"",title:this.item.url||
"",target:"_blank"},"item-url","only"),g(".codeAttachment",this.domNode).style("display","none"));"Application"!==this.item.type&&("Desktop Application"!==this.item.type&&this.content.getItemData(this.itemID,a.hitch(this,"handle_getConfig"),a.hitch(this,"handle_getConfig")),0<=a.indexOf(this.item.typeKeywords,"Ready To Use")||0<=a.indexOf(this.item.typeKeywords,"Ready to Use")?c=this.i18n.readyToUse:0<=a.indexOf(this.item.typeKeywords,"selfConfigured")?(c=this.i18n.selfConfigurable,esri.hide(this.configureAppButton.domNode)):
0<=a.indexOf(this.item.typeKeywords,"Configurable")?(c=this.i18n.configurable,esri.hide(this.configureAppButton.domNode)):0<=a.indexOf(this.item.typeKeywords,"Code Sample")&&(c=this.i18n.codeSample),0<=a.indexOf(this.item.typeKeywords,"Windows Mobile")?f=this.i18n.mobile:0<=a.indexOf(this.item.typeKeywords,"ArcGIS for iPhone")?f=this.i18n.ios:0<=a.indexOf(this.item.typeKeywords,"ArcGIS for Windows Phone")?f=this.i18n.windowsPhone:0<=a.indexOf(this.item.typeKeywords,"ArcGIS for Android")?f=this.i18n.Android:
0<=a.indexOf(this.item.typeKeywords,"JavaScript")?f=this.i18n.JavaScript:0<=a.indexOf(this.item.typeKeywords,"Flex")?f=this.i18n.Flex:0<=a.indexOf(this.item.typeKeywords,"Silverlight")?f=this.i18n.Silverlight:0<=a.indexOf(this.item.typeKeywords,"Web ADF")?f=this.i18n.WebADF:0<=a.indexOf(this.item.typeKeywords,"Other")?f=this.i18n.other:0<=a.indexOf(this.item.typeKeywords,"Java")?f="Java":0<=a.indexOf(this.item.typeKeywords,"Qt")?f="Qt":0<=a.indexOf(this.item.typeKeywords,".NET\u2013Windows Desktop")?
f=".NET\u2013Windows Desktop":0<=a.indexOf(this.item.typeKeywords,"WPF")?f="WPF":0<=a.indexOf(this.item.typeKeywords,"OS X")&&(f="OS X"),a.attr("item-purpose","innerHTML",c),a.attr("item-api","innerHTML",f),"Mobile Application"===this.item.type?a.attr(this._apiLabel,"innerHTML",this.i18n.sdk):"Desktop Application"===this.item.type&&a.attr(this._apiLabel,"innerHTML",this.i18n.platform));if(null!==this.item.url||"Application"===this.item.type)a.create("a",{href:this.item.url||"",innerHTML:this.item.url||
"",title:this.item.url||"",target:"_blank"},"item-url","only")}else if("WMS"===this.item.type)g(".urlOnly",this.domNode).style("display",""),e("a",{href:this.item.url+(-1<this.item.url.indexOf("?")?"\x26":"?")+"SERVICE\x3dWMS\x26REQUEST\x3dGetCapabilities",innerHTML:this.item.url,target:"_blank"},"item-rest-url","only"),a.byId("item-rest-url-title").innerHTML="REST Connection";else if("KML"===this.item.type){if((c=f=this.item.url||esriGeowConfig.restBaseUrl+"content/items/"+this.item.id+"/data")&&
-1<c.indexOf("/content/items/"+this.item.id+"/data")&&(this.util.isPortal()||!this.util.isPortal()&&(-1<c.indexOf(esriGeowConfig.self.customBaseUrl)||-1<c.indexOf(esriGeowConfig.self.portalHostname))))c=esriGeowConfig&&esriGeowConfig.allSSL?c.replace(/^http:\/\//i,"https://"):c,f=esriGeowConfig&&esriGeowConfig.allSSL?f.replace(/^http:\/\//i,"https://"):f,c+=this.token;g(".urlOnly",this.domNode).style("display","");e("a",{href:c,innerHTML:f,target:"_blank"},"item-rest-url","only");a.byId("item-rest-url-title").innerHTML=
"KML Document"}else"Operations Dashboard Extension"===this.item.type?(a.attr("item-rest-url-title","innerHTML",this.i18n.opDashboardUrl),e("a",{href:this.item.url,innerHTML:this.item.url,target:"_blank"},"item-rest-url","only"),g(".urlOnly",this.domNode).style("display","")):esri.isDefined(this.item.url)&&"kml"!==this.item.type.toLowerCase()&&"desktop application template"!==this.item.type.toLowerCase()&&"geoprocessing sample"!==this.item.type.toLowerCase()?(g(".urlOnly",this.domNode).style("display",
""),e("a",{href:this.item.url,innerHTML:this.item.url,target:"_blank"},"item-rest-url","only")):("CSV"===this.item.type||"Image"===this.item.type||"PDF"===this.item.type||"Microsoft Excel"===this.item.type||"Microsoft PowerPoint"===this.item.type||"Microsoft Powerpoint"===this.item.type||"Microsoft Word"===this.item.type||"iWork Pages"===this.item.type||"iWork Keynote"===this.item.type||"iWork Numbers"===this.item.type||"Visio Document"===this.item.type)&&"public"===this.item.access?(g(".urlOnly",
this.domNode).style("display",""),g=esriGeowConfig.restBaseUrl+"content/items/"+this.item.id+"/data",a.attr("item-rest-url-title","innerHTML",this.item.type+" "+this.i18n.url),a.create("a",{href:g,innerHTML:g,title:g,target:"_blank"},"item-rest-url","only")):"Workforce Project"===this.item.type?this.content.getItemData(this.itemID,a.hitch(this,"getWorkforceContent"),a.hitch(this,this.handle_getDataError)):"Form"===this.item.type&&this.getFormContent();a.byId("groupsTitle2").innerHTML=this.item.title;
this.setCommentCountLabel(this.item.numComments);this.setRatingsCountLabel(this.item.numRatings);this.setViewsCountLabel(this.item.numViews,this.item.type,this.item.itemType);this.content._getItemImageUrl(this.item,!0);a.byId("item-icon").innerHTML=this._getTypeIcon(this.item);this.item.url&&this.currentUser&&(this.item.owner==this.currentUser.email||this.isAdmin||this._roleCanViewItems||this._isOwnershipShared)&&-1<a.indexOf(this.item.typeKeywords,"Hosted Service")&&(this.util.isHostedServiceItem(this.item)||
arcgisonline.sharing.util.portalSupportsHostedServices())?a.byId("item-type").innerHTML=arcgisonline.sharing.geow.Content.changeTypename(this.item,!0)+this.i18n.startBracket+this.i18n.hostedService+this.i18n.endBracket:a.byId("item-type").innerHTML=arcgisonline.sharing.geow.Content.changeTypename(this.item,!0);g=a.byId("item-owner");g=e("span",{"class":"esriItemOwner"},g,"only");g=a.create("a",{innerHTML:b.owner,"class":"linkNoHref",owner:b.owner,alt:this.i18n.viewProfile,title:this.i18n.viewProfile},
g);a.connect(g,"onclick",this,function(b){var c=a.attr(b.currentTarget,"owner"),d=arcgisonline.sharing.dijit.ProfilePopup.prototype.statics.getInstance();null!==d&&a.hitch(d,d.showProfile,c,b.currentTarget).call()});"Feature Collection"==this.item.type?(c=a.byId("item-source-url"),f=a.byId("item-source"),a.attr(f,"innerHTML",this.i18n.source+" "+this.item.type)):-1<a.indexOf(this.item.typeKeywords,"ArcGIS Server")?(c=a.byId("item-source-url"),f=a.byId("item-source"),a.attr(c,"innerHTML",this.item.type),
a.connect(c,"onclick",a.hitch(this,function(a){a.preventDefault();a=this.item.url;this.util.isHostedServiceItem(this.item)?a+="public"!==this.item.access||this.item.itemControl&&-1<this.item.itemControl.indexOf("admin")?this.token:"":this._isPortal&&this.serverToken&&(a+="?token\x3d"+this.serverToken);window.open(a,"_blank")})),esri.show(f)):esri.hide(a.byId("item-source"));a.attr(g,{"class":"linkNoHref",owner:b.owner});var k=e("span",{"class":"esriItemTags"}),l=a.isArray(this.item.tags)?this.item.tags:
this.item.tags.split(","),m;a.forEach(l,function(a,b){m=a?this.util.htmlEncode(a):"";e("a",{href:"search.html?t\x3dcontent\x26q\x3dtags:"+m,innerHTML:m},k);b<l.length-1&&k.appendChild(document.createTextNode(", "))},this);a.place(k,a.byId("item-tags"),"only");b=new Date(this.item.modified);a.byId("item-modified").innerHTML=a.date.locale.format(b,{selector:"date",formatLength:"long"});b=this.item.size;1024>=b?a.byId("item-size").innerHTML="1 KB":1048576>b?a.byId("item-size").innerHTML=a.number.format(b/
1024,{pattern:"#,###,###,##0"})+" KB":a.byId("item-size").innerHTML=a.number.format(b/1048576,{pattern:"#,###,###,##0"})+" MB";a.hitch(this,d)();if(esriGeowConfig.showSocialMediaLinks&&this.util.canSharePublic()&&(!this._isCustomRole||this._isCustomRole&&this._roleCanShareToPublic))"http:"==location.protocol&&esriGeowConfig.bitlyUrl&&0<esriGeowConfig.bitlyUrl.length?this._loadSocialNetworkBadges():"https:"==location.protocol&&(esriGeowConfig.bitlyUrlSSL&&0<esriGeowConfig.bitlyUrlSSL.length)&&this._loadSocialNetworkBadges();
this._onItemLoad(this.item)},_showMetadataUI:function(){esriGeowConfig.metadataEnabled&&(this._metadataEnabled&&(this.isAdmin||this.currentUser.username===this.item.owner||this._roleCanUpdateItems&&this.itemUser||this._isOwnershipShared)&&this.initializeMetadata(),-1<a.indexOf(this.item.typeKeywords,"Metadata")&&a.style(a.byId("item-metadata-button-span"),"display",""))},_getServiceInfo:function(b){var c=new a.Deferred;b=this.serviceInfo||this.util.request({url:b},{addToken:!1}).addBoth(a.hitch(this,
function(a){this.serviceInfo=a}));a.when(b,a.hitch(this,function(a){c.resolve(a)}));return c},_getTypeIcon:function(b){var c=this.content._getItemIconUrl(b);b=(-1<a.indexOf(b.typeKeywords,"ArcGIS Server")||"Feature Collection"==b.type?this.i18n.source+" ":"")+("GeoJson"===b.type?"GeoJSON":b.type);var d="";c&&(d='\x3cimg src\x3d"'+c+'" alt\x3d"'+b+'" title\x3d"'+b+'"style\x3d"vertical-align:middle;"/\x3e\x26nbsp;');return d},_isFavorite:function(b){return this._searchItems('(group:"'+this.currentUser.favGroupId+
'" AND id:"'+b+'")').then(a.hitch(this,function(a){return a}))},_searchItems:function(a){return this.util.request({url:esriGeowConfig.restBaseUrl+"search",content:{q:a,f:"json"}})},_loadSocialNetworkBadges:function(){this.util.getSocialNetworkBadges(this.item,a.hitch(this,function(b){a.empty(this._connectContainer);for(var c in b)a.place(b[c],this._connectContainer)}))},fillItemInfo:function(){var b=function(a,b){window.location=400==a.code?"error.html?id\x3d"+this.itemID+"\x26c\x3dInvalidItem":"error.html?id\x3d"+
this.itemID};window.location.search&&(this.itemID=a.queryToObject(window.location.search.slice(1)).id)&&(this.isAdmin||this._roleCanViewUsers&&!this._isOwnershipShared?this.content.getItem(this.itemID,a.hitch(this,"loadItemOwner"),a.hitch(this,b)):this.content.getItem(this.itemID,a.hitch(this,"loadItem"),a.hitch(this,b)))},setRatingsCountLabel:function(b){var c="",d=a.number.format(b,{pattern:"#,###,###,##0"});0<=b&&(c=d+" "+(1==b?this.i18n.rating:this.i18n.ratings));a.query(".ratingCount",this.domNode).attr("innerHTML",
c)},setViewsCountLabel:function(b,c,d){d="";var e=a.number.format(b,{pattern:"#,###,###,##0"});"Explorer Map"===c||"Map Document"===c||"Globe Document"===c||"Scene Document"===c||"Layer Package"===c||"Map Package"===c||"Desktop Add In"===c||"Windows Mobile Package"===c||"Layer"===c||"Explorer Layer"===c||"Explorer Add In"===c||"Published Map"===c||"Desktop Application Template"===c||"Map Template"===c||"Geoprocessing Sample"===c||"Code Sample"===c||"Workflow Manager Package"===c||"CSV"===c||"Shapefile"===
c||"ArcPad Package"===c||"Operations Dashboard Addin"===c||"File Geodatabase"===c?0<=b&&(d=", "+e+" "+(1==b?this.i18n.downloadMsg:this.i18n.downloads)):0<=b&&(d=", "+e+" "+(1==b?this.i18n.view:this.i18n.views));a.query(".viewCount",this.domNode).attr("innerHTML",d)},enableButtons:function(a){a&&(this.attachCodeButton.set("disabled",!1),this.configureAppButton.set("disabled",!1),a=esri.urlToObject(document.URL),a.query&&a.query.showAppUsage&&(-1<this.item.type.indexOf("Application")?this.showUsageDlg():
this.showUsage_onClick()));this.registeredInfoButton.set("disabled",!1)},attachCode_onClick:function(b){null==this.attachCodeDialog&&(this.attachCodeDialog=arcgisonline.sharing.dijit.dialog.AttachCodeDlg.prototype.statics.getInstance(),this.attachCodeDialog.sharing=this.item.sharing,a.connect(this.attachCodeDialog,"onUpload",this,this.handle_codeAttachment),this.attachCodeDialog.item=this.item);this.attachCodeDialog.show(this.codeAttachment)},configureApp_onClick:function(b){-1<a.indexOf(this.item.typeKeywords,
"selfConfigured")?-1<this.item.url.indexOf("?")?(this.item.url+="\x26edit\x3dtrue",-1==this.item.url.indexOf("appid\x3d")?-1==this.item.url.indexOf("folderid\x3d")?window.location=this.item.url+"\x26appid\x3d"+this.item.id+(this.item.folderId?"\x26folderid\x3d"+this.item.folderId:""):window.location=this.item.url+"\x26appid\x3d"+this.item.id:window.location=this.item.url+(this.item.folderId?"\x26folderid\x3d"+this.item.folderId:"")):window.location=this.item.url+"?edit\x3dtrue\x26appid\x3d"+this.item.id+
(this.item.folderId?"\x26folderid\x3d"+this.item.folderId:""):window.location=esriGeowConfig.baseUrl+"webmap/configureApp.html?appid\x3d"+this.item.id+(this.item.folderId?"\x26folderid\x3d"+this.item.folderId:"")},publishItem_onClick:function(b){b=a.mixin({},this.item);this._isPublished?this._showNoPublishDlg():("File Geodatabase"===this.item.type||"CSV"===this.item.type||"GeoJson"===b.type||"Shapefile"===b.type||"Service Definition"===b.type||"Tile Package"===b.type||"Vector Tile Package"===b.type||
"Scene Package"===b.type||"Feature Collection"===b.type)&&this._showAddItemDlg(b)},publishTileService_onClick:function(a){this.openPublishTileLayer("tiles")},showUsage_onClick:function(a){a=/(\/(MapServer|GeocodeServer|GPServer|GeometryServer|ImageServer|NAServer|FeatureServer|GeoDataServer|GlobeServer|MobileServer|WMServer)).*/ig;a=this.item.url&&this.item.url.replace(a,"").replace(/^.*\//,"").replace(/\?.*$/,"");var c="Feature Service"===this.item.type?"features":"Map Service"===this.item.type?
"tiles":"views";this._usageDialog=(new f.Dialog).placeAt(document.body);this._usageDialog.set({title:this.i18n.itemUsage,content:new this.usageDlg({itemId:this.item.id,listed:this.item.listed,name:a,title:this.item.title,stype:c})});this._usageDialog.show()},_showAddItemDlg:function(a){this._formDialog=(new f.Dialog({"class":"esriAddItemDlg"})).placeAt(document.body);this._formDialog.set({title:this.i18n.addItemDlgTitle,content:new this.addItemDlg({overrideUser:this.itemUser,item:a,folder:a.folderId||
null,allowPublish:!0,dialog:this._formDialog})});this._formDialog.show()},showRegisterInfo_onClick:function(){var b=this._registerFrm,c=this._registeredAppInfo||this._fetchRegisteredAppInfo();a.when(c,a.hitch(this,function(c){b=this._registerFrm||(this._registerFrm=new this.registerDlg({},a.create("div",{"class":"esriRegisterApp"},this._registration)));b.set("registeredAppInfo",this._registeredAppInfo);esri.hide(this.registeredInfoButton.domNode);a.query(".registration").forEach(esri.show)}))},showRegisterEditDlg_onClick:function(b){var c=
this._registeredAppInfo||this._fetchRegisteredAppInfo();a.when(c,a.hitch(this,function(a){this.showRegisterDlg_onClick(b,!0)}))},showRegisterDlg_onClick:function(b,c){function d(a){k.set("disabled",a);m.set("disabled",a);n.set("disabled",a);p.set("disabled",a)}var e=this._registeredAppInfo||{itemId:this.item.id,appType:"browser",redirect_uris:[]};a.indexOf(this.item.typeKeywords,"Registered App");var g=(new f.Dialog({className:"esriItem",style:{width:"620px"}})).placeAt(document.body),h=document.createDocumentFragment(),
k=new this.registerDlg({id:this.item.id},a.create("div",{"class":"esriRegisterApp"},h)),l=a.create("div",{"class":"esriFloatTrailing esriTrailingMargin05 esriRegisterButtons"},h),m=new f.form.Button({label:this.i18n.registerRefresh,type:"button",style:{display:"none"}},a.create("span",{},l)),n=new f.form.Button({"class":"calcite primary",label:this.i18n.register,type:"button"},a.create("span",{},l)),p=new f.form.Button({"class":"calcite cancel",label:this.i18n.cancel,type:"button"},a.create("span",
{},l)),l=esriGeowConfig&&esriGeowConfig.self&&esriGeowConfig.self.helpMap.m["120000969"],s=a.create("a",{className:"esriHelpIcon",title:this.i18n.help,href:esriGeowConfig.self.helpBase+(l?l:""),target:"_blank"}),t=[a.connect(p,"onClick",a.hitch(this,function(){g.hide()})),a.connect(n,"onClick",a.hitch(this,function(){if(!this._registeredAppInfo||c)if(d(!0),e=a.mixin(e,k.get("value")),!e||!e.appType||!e.redirect_uris||!e.redirect_uris.length)this._showError(this.i18n.error.registerAppNoUris),d(!1);
else{e.redirect_uris=a.json.stringify(e.redirect_uris);var b=esriGeowConfig.restBaseUrl.replace("http://","https://")+"oauth2/"+(c?"apps/"+e.client_id+"/update":"registerApp");this.util.request({url:b,content:!c?e:{redirect_uris:e.redirect_uris}},{usePost:!0}).then(a.hitch(this,function(b){this._registeredAppInfo=b;a.query(".unRegisteredApp").forEach(esri.hide);esri.hide(this.registeredInfoButton.domNode);esri.show(this._registration);a.removeClass(this._itemRegistrationSection,"readOnly");g.hide();
this.showRegisterInfo_onClick();this._showMarketplaceSection()}),a.hitch(this,function(a){d(!1);return this._showError(a)}))}else g.hide()})),a.on(g,"hide",a.hitch(this,function(){a.forEach(t,a.disconnect);g.destroyRecursive()})),a.connect(m,"onClick",a.hitch(this,function(){this._showRefreshAppSecretDlg(k)}))],l=a.query(".dijitDialogTitleBar .dijitDialogCloseIcon",g.domNode);a.place(s,l[0],"before");g.setContent(h);a.hitch(this,function(b,e){this._registeredAppInfo&&k.set("registeredAppInfo",this._registeredAppInfo);
c&&(k.set("editMode",!0),a.style(m.domNode,"display","inline-block"));n.set("label",this._registeredAppInfo?this.i18n.update:this.i18n.register);g.set("title",this._registeredAppInfo?this.i18n.registerAppInfo:this.i18n.registerApp);d(!1);g.show()})()},_showRefreshAppSecretDlg:function(b){var c={title:this.i18n.registerRefresh,message:"\x3cp\x3e"+this.i18n.resetSecretMessage+"\x3c/p\x3e",choiceOneTitle:this.i18n.yesLabel,choiceTwoTitle:this.i18n.noLabel,choiceOneHandler:a.hitch(this,function(){this._refreshAppSecret().then(a.hitch(this,
function(a){this._registeredAppInfo=a;b.set("registeredAppInfo",this._registeredAppInfo)}))}),choiceTwoHandler:a.hitch(this,function(){this._choiceDlg.hide()})};this._choiceDlg.show(c)},_refreshAppSecret:function(){var b=esriGeowConfig.restBaseUrl.replace("http://","https://")+"oauth2/apps/"+this._registeredAppInfo.client_id+"/resetSecret";return this.util.request({url:b},{usePost:!0}).then(null,a.hitch(this,function(a){return this._showError(a)}))},_fetchRegisteredAppInfo:function(){var b=esriGeowConfig.restBaseUrl.replace("http://",
"https://")+"content/users/"+this.item.owner,b=b+("/"+(this.item.folderId||"")+"/items/"+this.item.id+"/registeredAppInfo");return this.util.request({url:b}).then(a.hitch(this,function(a){return this._registeredAppInfo=a}),a.hitch(this,function(a){return this._showError(a)}))},_unregisterApp:function(){var b=esriGeowConfig.restBaseUrl.replace("http://","https://")+"oauth2/apps/"+this._registeredAppInfo.client_id+"/unregister";return this.util.request({url:b},{usePost:!0}).then(null,a.hitch(this,function(a){return this._showError(a)}))},
unregisterApp:function(){var b,c={title:this.i18n.unRegisterApp,message:"\x3cp\x3e"+this.i18n.unRegisterAppMessage+"\x3c/p\x3e",choiceOneTitle:this.i18n.yesLabel,choiceTwoTitle:this.i18n.noLabel,choiceOneHandler:a.hitch(this,function(){b=this._registeredAppInfo?this._unregisterApp():this._fetchRegisteredAppInfo().then(a.hitch(this,"_unregisterApp"));this._unRegisterApp.set("disabled",!0);return b.then(a.hitch(this,function(b){this._unRegisterApp.set("disabled",!1);this._registeredAppInfo=null;this.item.typeKeywords.splice(a.indexOf(this.item.typeKeywords,
"Registered App"),1);a.query(".registeredApp").forEach(esri.hide);a.query(".unRegisteredApp").forEach(esri.show);esri.hide(this._unRegisterApp.domNode);esri.hide(this.registerEditButton.domNode);a.addClass(this._itemRegistrationSection,"readOnly");return b}))}),choiceTwoHandler:a.hitch(this,function(){this._choiceDlg.hide()})};this._choiceDlg.show(c)},viewListing_onClick:function(){this.isAdmin||this.currentUser&&this.currentUser.username===this.item.owner||-1===a.indexOf(this.item.typeKeywords,"Child Listing")?
window.location=esriGeowConfig.marketplaceUrl+"/listing.html?id\x3d"+this.item.id:this._fetchPurchases(this.item.id).then(a.hitch(this,function(a){a=a&&a.length?a[0].listing:{};window.location=esriGeowConfig.marketplaceUrl+"/listing.html?id\x3d"+(a&&a.itemId||this.item.id)}))},unlist_onClick:function(){var b=esriGeowConfig.restBaseUrl+"content/users/"+(this.isAdmin?this.item.owner:this.util.getUser().email),b=b+"/"+(this.item.folderId||"")+"/items/"+this.item.id,c,d,e,g=this.util.request({url:b+"/unlist",
content:{f:"json"}},{usePost:!0}).then(a.hitch(this,function(){return this.item}));a.forEach(["Child Listing","Parent Listing"],a.hitch(this,function(b){if(c=a.indexOf(this.item.typeKeywords,b))e=!0,this.item.typeKeywords.splice(c,1)}));e&&(d={typeKeywords:this.item.typeKeywords.join(", ")},g=g.then(a.hitch(this,function(c){return this.util.request({url:b+"/update",content:a.mixin({f:"json"},d)},{usePost:!0})})));return g.then(a.hitch(this,function(a){this.item.listed=!1;this._showMarketplaceSection()}))},
createListing_onClick:function(){"private"===this.item.access?window.location=esriGeowConfig.marketplaceUrl+"/listing.html?itemId\x3d"+this.item.id:this._showError({message:this.i18n.error.createListingShared})},_fetchPublishParameters:function(b){var c=esriGeowConfig.restBaseUrl+"content/items/"+b.id+"/info/publishParameters.json";b.relatedItem&&"CSV"===b.relatedItem.type?b=this.util.request({url:c}).then(a.hitch(this,function(a){return a})):(b=new a.Deferred,b.resolve(!1));return b},_showRateLimitDlg:function(){var b=
new f.Dialog({}),c=a.doc.createDocumentFragment(),d=new arcgisonline.sharing.dijit.dialog.RateLimiting({serviceProxyParams:this.item.serviceProxyParams||null},a.create("div",{},c)),e=a.create("div",{"class":"esriFloatTrailing esriTimeSettingsButtons"},d.domNode),g=new f.form.Button({"class":"calcite primary",label:this.i18n.ok,type:"button"},a.create("button",{},e)),e=new f.form.Button({"class":"calcite cancel",label:this.i18n.cancel,type:"button"},a.create("button",{},e)),h=a.connect(e,"onClick",
a.hitch(this,function(){a.disconnect(h);b.hide()})),k=a.connect(g,"onClick",a.hitch(this,function(){d.set("disabled",!0);var c=esriGeowConfig.restBaseUrl+"content/users/"+(this.isAdmin||this._roleCanViewItems&&this._roleCanUpdateItems||this._isOwnershipShared?this.item.owner:this.util.getUser().email),e=null,g=d.isValid(),c=c+"/"+(this.item.folderId||"")+"/items/"+this.item.id;if(!0!==g)this._showError(g),d.set("disabled",!1);else return e=d.get("value"),this.util.request({url:c+"/update",content:{serviceProxyParams:a.json.stringify(e)}},
{usePost:!0}).then(a.hitch(this,function(){this.item.serviceProxyParams=e;a.disconnect(k);b.hide()}),a.hitch(this,function(a){this._showError(a);d.set("disabled",!1)}))})),l=a.connect(b,"hide",a.hitch(this,function(){a.disconnect(l);d.destroyRecursive()}));b.set("title",this.i18n.rateLimitingTitle);b.setContent(c);b.show()},_showGeocodeCountDlg:function(){var b=a.indexOf(this.item.typeKeywords,"showUnmatchedAddresses"),c=this.adminServiceInfo.layers||this.serviceInfo.layers||[],d=-1<a.indexOf(this.item.typeKeywords,
"Involved Lookup"),e=esriGeowConfig.restBaseUrl+"content/users/"+(this.isAdmin||this._roleCanViewItems&&this._roleCanUpdateItems||this._isOwnershipShared?this.item.owner:this.util.getUser().email),e=e+"/"+(this.item.folderId||"")+"/items/"+this.item.id,g=a.hitch(this,function(){if((!this._isCustomRole||this._roleCanUpdateItems)&&-1<b)this.item.typeKeywords.splice(b,1),this.util.request({url:e+"/update",content:{typeKeywords:this.item.typeKeywords.join(",")}},{usePost:!0})});if(d&&(!this._isCustomRole&&
esriGeowConfig.userRole.isAdmin()||this.currentUser&&this.item.owner===this.currentUser.email)){var f={title:this.i18n.geocodePanel.geocodePanelTitle,choiceOneTitle:this.i18n.yesLabel,choiceTwoTitle:this.i18n.noLabel,choiceOneHandler:a.hitch(this,function(){this._choiceDlg.hide();this.openLayerWithReview()}),choiceTwoHandler:a.hitch(this,function(){this._choiceDlg.hide()})};this._isPortal&&(c=c.concat(this.adminServiceInfo.tables||this.serviceInfo.tables||[]));this._queryGeocodeCounts(c).then(a.hitch(this,
function(c){-1<b&&(f.message=esri.substitute(c,c.successful!==c.total?this.i18n.invalidGeocodeMsg:this.i18n.validGeocodeMsg),this._choiceDlg.show(f),g(),a.style("layerMenu-reviewAddresses","display",""))}))}else g()},_showNoPublishDlg:function(){var b=a.doc.createDocumentFragment(),c=a.create("p",{"class":"esriAGOServicesDlg esriItemLinks",style:{width:"400px"},innerHTML:this.i18n.error.noPublishMsg},b,"first");a.create("br",null,c);a.create("br",null,c);var d=a.create("ul",null,c);a.forEach(this._isPublished||
[],a.hitch(this,function(b){b=a.mixin(b,{itemUrl:"item.html?id\x3d"+b.id});b.type="Map Service"===b.type?"Tile Layer":"Feature Layer";a.create("li",{innerHTML:esri.substitute(b,this.i18n.relatedPublishedItem)},d)}));this._pubDialog=(new f.Dialog).placeAt(document.body);this._pubDialog.set({title:this.i18n.error.noPublishTitle,content:b});this._pubDialog.show()},showCreateApp_onClick:function(a){this._usageDialog=(new f.Dialog).placeAt(document.body);this._usageDialog.set({title:this.i18n.itemUsage,
content:new this.usageDlg({name:this.item.title,stype:"Feature Service"===this.item.type?"features":"tiles"})});this._usageDialog.show()},_handle_summaryOnFocus:function(a){a=f.byId("item-summary-edit-input");a.getValue()===this._helperSummary&&a.set("value","");a.focus()},_handle_summaryOnBlur:function(a){a=f.byId("item-summary-edit-input");""===a.getValue()&&a.set("value",this._helperSummary)},handle_codeAttachment:function(b){var c,d=b.relatedItems&&0<b.relatedItems.length?b.relatedItems:[b];(b=
a.filter(d,function(a){return esri._isDefined(a.url)}))&&b.length&&b[0].id?(c=b[0],a.query(".toolbar .codeAttachment").style("display","none")):c=d[0];if(c&&c.id&&c.name&&-1===a.indexOf(this.item.typeKeywords,"Web AppBuilder")||(this.isAdmin||this.currentUser&&this.item.owner==this.currentUser.email)&&c&&c.id&&c.name&&-1<a.indexOf(this.item.typeKeywords,"Web AppBuilder")||!0===esriGeowConfig.webAppBuilderDownload&&(this.isAdmin||this.currentUser&&this.item.owner==this.currentUser.email)&&c&&c.id&&
c.name&&-1<a.indexOf(this.item.typeKeywords,"Web AppBuilder")||-1<a.indexOf(this.item.typeKeywords,"Web AppBuilder for ArcGIS")&&c&&c.id&&c.name){this.codeAttachment=c;a.byId("esriAttachButtonLabel").innerHTML=this.i18n.updateCode;d=c.title||c.name;a.create("span",{innerHTML:d+"\x26nbsp;\x26nbsp;",title:d},"item-attachment","only");45<d.length&&a.create("br",{},"item-attachment");d=c.url||esriGeowConfig.restBaseUrl+"content/items/"+c.id+"/data";if("public"!==this.item.access||-1<a.indexOf(this.item.typeKeywords,
"Web AppBuilder")||-1<a.indexOf(this.item.typeKeywords,"Web AppBuilder for ArcGIS"))d+=this.token;a.create("a",{innerHTML:this.i18n.downloadUpper,target:c.url?"_blank":"_self",href:d},"item-attachment");if(esriGeowConfig.userRole&&esriGeowConfig.userRole.isBasedOnAdmin()||this._roleCanDeleteItems||this.currentUser&&(null!==this.currentUser&&this.item.owner==this.currentUser.email)&&(!b||!b.length))a.create("span",{innerHTML:"\x26nbsp;\x26nbsp;"},"item-attachment"),a.create("a",{innerHTML:this.i18n.remove,
href:"#",onclick:a.hitch(this,function(b){b.preventDefault();arcgisonline.sharing.dijit.dialog.DeleteWarningDlg.prototype.statics.getInstance().showMsgTitleButton(this.i18n.removeAttachmentMsg,this.i18n.removeAttachmentTitle,this.i18n.removeAttachmentButton,a.hitch(this,"deleteAttachment",c))})},"item-attachment");if(null===c.numViews||void 0===c.numViews)c.numViews=0;this.setViewsCountLabel(this.item.numViews,this.item.type);a.query(".viewCount",this.domNode).attr("innerHTML",a.query(".viewCount",
this.domNode).attr("innerHTML")+", "+c.numViews+" "+(1==c.numViews?this.i18n.downloadMsg:this.i18n.downloads))}else a.byId("item-attachment").innerHTML=this.i18n.none,this.setViewsCountLabel(this.item.numViews,this.item.type);this.attachCodeDialog&&this.attachCodeDialog.hide()},deleteAttachment:function(b){this.content.deleteItem(a.mixin(b,{folderId:this.item&&this.item.folderId}),a.hitch(this,this.handle_codeAttachment),a.hitch(this,this.handle_codeAttachment));this.codeAttachment=null;a.byId("esriAttachButtonLabel").innerHTML=
this.i18n.attachCode},handle_getDataError:function(b,c){a.byId("item-map-contents").innerHTML=this.i18n.noMapConfig},handle_getData:function(b,c){this.getDataContent=b;if("Web Scene"!==this.item.type){var d=a.byId("item-map-contents");a.empty(d);if(b.operationalLayers)for(var e=b.operationalLayers.length-1;0<=e;e--){var g=b.operationalLayers[e],g=a.mixin(g,g.wmtsInfo||{});g.url?(a.create("span",{innerHTML:g.title+":"},d),a.create("a",{href:g.url,innerHTML:g.url,title:g.url,target:"_blank"},a.create("span",
{style:{marginLeft:"1.5em"}},d))):a.create("span",{innerHTML:g.title},d)}b.baseMap&&b.baseMap.baseMapLayers&&a.forEach(b.baseMap.baseMapLayers,function(c){c=a.mixin(c,c.wmtsInfo||{});a.create("span",{innerHTML:(b.baseMap.title||c.title)+(c.url?":":"")},d);c.url&&0<c.url.length?a.create("a",{href:c.url,innerHTML:c.url,title:c.url,target:"_blank"},a.create("span",{style:{marginLeft:"1.5em"}},d)):null!=c.type&&0==c.type.indexOf("BingMaps")?"BingMapsAerial"==c.type?a.create("a",{href:"http://www.esri.com/software/arcgis/arcgisonline/bing-maps.html",
innerHTML:"http://www.esri.com/software/arcgis/arcgisonline/bing-maps.html",title:this.i18n.bingAerial,target:"_blank"},a.create("span",{style:{marginLeft:"1.5em"}},d)):"BingMapsRoad"==c.type?a.create("a",{href:"http://www.esri.com/software/arcgis/arcgisonline/bing-maps.html",innerHTML:"http://www.esri.com/software/arcgis/arcgisonline/bing-maps.html",title:this.i18n.bingRoad,target:"_blank"},a.create("span",{style:{marginLeft:"1.5em"}},d)):a.create("a",{href:"http://www.esri.com/software/arcgis/arcgisonline/bing-maps.html",
innerHTML:"http://www.esri.com/software/arcgis/arcgisonline/bing-maps.html",title:this.i18n.bingAreaLabels,target:"_blank"},a.create("span",{style:{marginLeft:"1.5em"}},d)):null!=c.type&&"OpenStreetMap"==c.type&&a.create("a",{href:"http://www.openstreetmap.org/",innerHTML:"http://www.openstreetmap.org/",title:this.i18n.osm,target:"_blank"},a.create("span",{style:{marginLeft:"1.5em"}},d))},this);this._getAppCollectorProperties()}},handle_getConfig:function(b){if(-1<a.indexOf(this.item.typeKeywords,
"selfConfigured"))a.style(this.configureAppButton.domNode,"display","inline-block");else if(a.isObject(b))if(b.configurationSettings)b=a.json.stringify(b),f.byId("item-form-text").set("value",b);else if(b.source&&(this.isAdmin||this._roleCanUpdateItems||this.currentUser&&this.currentUser.username===this.item.owner||this._isOwnershipShared))return this.util.request({url:esriGeowConfig.restBaseUrl+"content/items/"+b.source+"/data"}).then(a.hitch(this,function(b){(b&&b.configurationSettings||-1<a.indexOf(this.item.typeKeywords,
"selfConfigured"))&&a.style(this.configureAppButton.domNode,"display","inline-block")}))},handle_getComments:function(b){b=b&&b.comments;a.forEach(b,"item.comment \x3d unescape(item.comment);");this.loadComments(b,!0)},handle_publishComment:function(){this.getComments();this.publishCommentButton.set("disabled",!1);this.newComment.value="";this.newComment.disabled=!1},setOddItemClass:function(){a.query(".esriItemComment").removeClass("odd");a.query(".esriItemComment:nth-child(odd)").addClass("odd")},
setCommentCountLabel:function(b){a.query(".commentCount",this.domNode).forEach(function(a){a.innerHTML=b})},loadComments:function(b,c){c&&a.empty(this.comments);this.item.numComments=b.length;this.setCommentCountLabel(b.length||0);b.sort(function(a,b){return a.created==b.created?0:a.created<b.created?1:-1});a.forEach(b,a.hitch(this,function(b,c){a.place(this.renderComment(b),this.comments)}));this.setOddItemClass()},getComments:function(){if(this.item&&this.item.commentsEnabled)if(this.content.getComments(this.itemID,
a.hitch(this,this.handle_getComments),a.hitch(this,this.handle_getComments)),this.currentUser)a.style(this.addCommentPane,"display","block");else{a.style(this.signInPane,"display","block");var b=a.query("a",this.signInPane)[0],c="";-1==esriGeowConfig.signin.indexOf("http")&&(c=esriGeowConfig.baseUrl,!1!==esriGeowConfig.useSSL&&(c=c.replace("http:","https:")));a.attr(b,"href",c+esriGeowConfig.signin+"?returnUrl\x3d"+window.location.href);this.newComment.disabled=!0;this.publishCommentButton.set("disabled",
!0)}},publishComment:function(){var b=escape(a.trim(this.newComment.value));0<b.length&&(this.publishCommentButton.set("disabled",!0),this.newComment.disabled=!0,this.content.addComment(this.itemID,b,a.hitch(this,this.handle_publishComment)))},setDeleteProtection:function(){var b=esriGeowConfig.restBaseUrl+"content/users/"+(this.isAdmin||this._roleCanViewItems&&this._roleCanUpdateItems?this.item.owner:this.currentUser.email),c=this.item["protected"],d=f.byId("item-delete-protection-edit-input").get("checked"),
e=[];if(c===d)return c=new a.Deferred,c.resolve(this.item),c;e.push(this.util.request({url:b+(this.item.folderId?"/"+this.item.folderId:"")+"/items/"+this.item.id+(d?"/protect":"/unprotect")},{usePost:!0}));return this._getRelatedItems("Listed2Provisioned","forward").then(a.hitch(this,function(c){e=e.concat(a.map(c,a.hitch(this,function(c){return this._fetchItem(c.id).then(a.hitch(this,function(a){return this.util.request({url:b+(a.ownerFolder?"/"+a.ownerFolder:"")+"/items/"+a.id+(d?"/protect":"/unprotect")},
{usePost:!0})}))})));return(new a.DeferredList(e)).then(a.hitch(this,function(a){this.item["protected"]=d;return this.item}))}))},_fetchItem:function(a){return this.util.request({url:esriGeowConfig.restBaseUrl+"content/items/"+a})},_getRelatedItems:function(b,c){var d=new a.Deferred;this._fetchRelatedItems(b,c,a.hitch(this,function(a){d.resolve(a)}),a.hitch(this,function(a){d.reject(a)}));return d},_fetchRelatedItems:function(b,c,d,e){this._relatedItems||(this._relatedItems={});var g=this._relatedItems[b+
"_"+c];if(g&&g.isRequesting)setTimeout(a.hitch(this,"_fetchRelatedItems",b,c,d,e),75);else{var f=esriGeowConfig.restBaseUrl+"content/items/"+this.item.id+"/relatedItems",f=g||this.util.request({url:f,content:{relationshipType:b,direction:c}}).then(a.hitch(this,function(a){return g=this._relatedItems[b+"_"+c]=a&&a.relatedItems||[]}));this._relatedItems[b+"_"+c]=this._relatedItems[b+"_"+c]||{isRequesting:!0};return a.when(f,d,e)}},_fetchPurchases:function(b){var c=[];return this.util.request({url:esriGeowConfig.restBaseUrl+
"portals/self/purchases"}).then(a.hitch(this,function(d){c=c.concat(d.purchases);c=c.concat(d.trials);return a.filter(c,function(a){return a&&a.provision&&a.provision.provisionedItemId===b})}))},setViewOnly:function(){if("Web Map"===this.item.type||"Operation View"===this.item.type){var b=-1<a.indexOf(this.item.typeKeywords,"useOnly"),c=!1===f.byId("item-view-only-edit-input").get("checked"),d=a.isArray(this.item.typeKeywords)?this.item.typeKeywords:this.item.typeKeywords.split(",");b!==c&&(c?d.push("useOnly"):
(b=a.indexOf(d,"useOnly"),-1<b&&d.splice(b,1)),this.item.typeKeywords=d)}},setOfflineMode:function(){if("Web Map"===this.item.type&&this.currentUser&&esriGeowConfig.userRole){var b=-1<a.indexOf(this.item.typeKeywords,"Offline"),c=f.byId("item-offline-map-edit-input").get("checked"),d=a.isArray(this.item.typeKeywords)?this.item.typeKeywords:this.item.typeKeywords.split(",");b!==c&&(c?d.push("Offline"):(b=a.indexOf(d,"Offline"),-1<b&&d.splice(b,1)),this.item.typeKeywords=d)}},_createFieldsGrid:function(){if(!esriGeowConfig.findFeaturesWebMapEnabled||
!this._fieldsGrid&&this.getDataContent){if(esriGeowConfig.findFeaturesWebMapEnabled){var b=this.getDataContent.operationalLayers||[],c=/\/((MapServer|FeatureServer)\/([0-9]+)$).*/ig,d=/\/((MapServer)).*/ig,e=!1,g,h=[],k=[],l=[],m=a.hitch(this,function(b,c,d){var e=b.id+(d?"#"+c.id:""),g={esriFieldTypeSmallInteger:1,esriFieldTypeInteger:1,esriFieldTypeString:1};this._findFields[e]=[];c&&(-1<c.capabilities.indexOf("Query")&&"Feature Layer"===c.type)&&(a.forEach(c.fields||[],a.hitch(this,function(a){a&&
(!0===a.type in g&&!a.domain)&&this._findFields[e].push({label:a.alias||a.name,value:a.name,name:a.name,type:a.type})})),this._findFields[e]&&this._findFields[e].length&&(b={label:d?c.name:b.title||c.name,value:e,layer:d?c:b},d&&(b.subLayer=parseInt(c.id,10)),l.push(b)))});this._findFields={};this._findLayers={};a.forEach(b,a.hitch(this,function(b){if((e=b.url&&b.url.match(d))&&!b.url.match(c))k.push(this._getMapServerLayers(b.url).then(a.hitch(this,function(c){c&&(c.capabilities&&-1<c.capabilities.indexOf("Query"))&&
h.push(this.util.request({url:b.url+"/layers"},{addToken:!1}).then(a.hitch(this,function(c){a.forEach(c.layers,a.hitch(this,function(a){return m(b,a,!0)}))}),a.hitch(this,function(a){return null})))}),a.hitch(this,function(a){return null})));else if(b.url&&(b.url.match(c)||e)){var f=new a.Deferred;k.push(f);f.resolve(!0);g=this.util.request({url:b.url},{addToken:!1}).then(a.hitch(this,m,b),a.hitch(this,function(a){return null}));h.push(g)}}));return a.promise.all(k).then(a.hitch(this,function(b){return a.promise.all(h).then(a.hitch(this,
function(b){if(l&&l.length){var c=[dgrid.editor({autoSave:!0,field:"layer",label:this.i18n.shareCheckDlg.titleLayer,editorArgs:{className:"layerEditor",options:l,maxHeight:150,style:"width:150px;max-width:150px;text-overflow:ellipsis;"}},f.form.Select),{field:"field",label:this.i18n.tableStatisticsDlg.field,renderCell:a.hitch(this,function(b,c,d){c=new f.form.Select({className:"fieldEditor",value:b.field.value,options:a.clone(this._findFields[b.layer]),maxHeight:150,style:"width:150px;max-width:150px;overflow:hidden;"},
d);a.on(c,"change",a.hitch(this,function(b,c){c!==b.field.name&&a.forEach(this._findFields[b.layer],a.hitch(this,function(d){d.name===c&&(a.query(".exactMatchEditor",a.byId("fieldsGrid1-row-"+b.id)).forEach(a.hitch(this,function(a){a=f.registry.byNode(a);"esriFieldTypeInteger"===d.type||"esriFieldTypeSmallInteger"===d.type?(a.set("disabled",!0),a.set("value","true")):a.set("disabled",!1)})),b=a.mixin(b,{field:d}),this._isAppPropertiesChanged=!0)}))},b));return c.domNode})},{field:"exactMatch",label:this.i18n.condition,
renderCell:a.hitch(this,function(b,c,d){c=new f.form.Select({disabled:"esriFieldTypeInteger"===b.field.type||"esriFieldTypeSmallInteger"===b.field.type,className:"exactMatchEditor",value:b.exactMatch,options:[{label:this.i18n.equals,value:"true"},{label:this.i18n.contains,value:"false"}],maxHeight:150,style:"width:150px;max-width:150px;overflow:hidden;"},d);a.on(c,"change",a.hitch(this,function(b,c){a.mixin(b,{exactMatch:c});this._isAppPropertiesChanged=!0},b));return c.domNode})},{field:"_item",
label:"  ",formatter:a.hitch(this,function(a){return'\x3ca href\x3d"#"\x3e\x3cimg class\x3d"deleteLayer" style\x3d"height:20px;width:20px;" src\x3d"images/delete_20x20.png"/\x3e\x3c/a\x3e'})}];this._layerOptions=a.clone(l);this._fieldsGridStore=new a.store.Observable(new a.store.Memory({idProperty:"id",data:this._searchLayers||[]}));a.style(this._opFindLocationsGrid,"display",this._fieldsGridStore.data&&this._fieldsGridStore.data.length?"":"none");this._fieldsGridStore.data&&this._fieldsGridStore.data.length===
this._layerOptions.length&&f.byId("addFieldBtn").set("disabled",!0);b=this._fieldsGridStore.query({});b.observe(a.hitch(this,function(b,c,d){this._isAppPropertiesChanged=!0;a.style(this._opFindLocationsGrid,"display",this._fieldsGridStore.data&&this._fieldsGridStore.data.length?"":"none")}));this._fieldsGrid=new (a.declare([dgrid.Grid,dgrid.OnDemandGrid,dgrid.extensions.DijitRegistry]))({store:this._fieldsGridStore,columns:c,highlightDuration:0,maintainOddEven:!1,id:"fieldsGrid1",showLoadingMessage:!1,
showHeader:!0,selectionMode:"none"},this._opFindLocationsGrid);this._fieldsGrid.startup();this._fieldsGrid.on("dgrid-datachange",a.hitch(this,function(b){var c=b.cell.column.field,d;this._isAppPropertiesChanged=!0;if("layer"===c){var c=this._fieldsGridStore.query({layer:b.value}),e=this._fieldsGrid.row(b);c&&c.length?(this._showError({message:this.i18n.error.oneSearchFieldPerLayer}),d=b.cell.element.widget,d.set("value",b.oldValue)):(a.query(".fieldEditor",e.element).forEach(a.hitch(this,function(a){d=
f.registry.byNode(a);d.set("options",this._findFields[b.value]);d.reset()})),e.data=a.mixin(e.data,{field:this._findFields[b.value][0]}))}}));this._fieldsGrid.on(".dgrid-cell:click",a.hitch(this,function(b){b.preventDefault();var c=this._fieldsGrid.row(b);a.hasClass(b.target,"deleteLayer")&&(this._fieldsGridStore.remove(c.data.id),this._fieldsGridStore.data&&this._fieldsGridStore.data.length<=this._layerOptions.length&&f.byId("addFieldBtn").set("disabled",!1))}));a.on(f.byId("addFieldBtn"),"click",
a.hitch(this,function(b){b.preventDefault();b=this._isFindLayerSelected(this._fieldsGridStore.data);var c=this._findFields[b[0].value][0];b={layer:b[0].value,field:c,exactMatch:c&&-1<c.type.indexOf("Integer")?"true":"false"};this._fieldsGridStore.add(a.mixin({},b));this._fieldsGridStore.data&&this._fieldsGridStore.data.length===this._layerOptions.length&&f.byId("addFieldBtn").set("disabled",!0)}));a.on(this._opByLayer,"click",a.hitch(this,function(b){a.query(".byLayerDiv",this.domNode)[this._opByLayer.get("checked")?
"removeClass":"addClass"]("hide")}));a.aspect.before(this._fieldsGrid,"removeRow",a.hitch(this,function(b){a.query(".dijit, .dijitSelect, .fieldEditor",b).forEach(function(a){f.registry.byNode(a).destroyRecursive()})}))}else a.query(".opFindLocations",this.domNode).forEach(esri.hide)}))}))}a.query(".opFindLocations",this.domNode).addClass("hide")}},_isFindLayerSelected:function(b){return a.filter(this._layerOptions,a.hitch(this,function(c){return!a.some(b,a.hitch(this,function(a){return a.layer===
c.value}))}))},_getMapLayerUrl:function(a){return this.util.request({url:a},{addToken:!1})},_getMapServerLayers:function(a){return this.util.request({url:a},{addToken:!1})},_getFindLocationJson:function(){var b={enabled:this._opFindLocations.get("checked"),disablePlaceFinder:!this._opByAddress.get("checked"),hintText:this._opFindLocationsHintText.get("value")||null,layers:[]},c,d,e,g={};this._fieldsGridStore&&this._opByLayer.get("checked")&&this._fieldsGridStore.query({}).forEach(a.hitch(this,function(a){g[a.layer]||
(c=a.field,e=a.layer.split("#"),d={id:e[0],field:{name:c.name,exactMatch:"true"===a.exactMatch,type:c.type}},1<e.length&&(d.subLayer=parseInt(e[e.length-1],10)),b.layers.push(d),g[a.layer]=!0)}));return b},handle_deleteComment:function(b,c){if(!0==b.success){this.item.numComments--;var d=a.animateProperty({node:"comment-"+b.commentId,properties:{height:0},easing:a.fx.easing.quadOut,onEnd:function(a){a=this.node;a.parentNode.removeChild(a);delete a}});a.connect(d,"onEnd",this,this.setOddItemClass);
a.connect(d,"onEnd",this,a.partial(this.setCommentCountLabel,this.item.numComments));d.play()}else a.publish("globalMessage",[{message:this.i18n.unableRemoveComment,type:"error",duration:3E3}]),this.getComments()},renderComment:function(b){var c=a.create("div",{id:"comment-"+b.id,"class":"esriItemComment",style:{overflow:"hidden"}}),d=a.create("a",{href:"#",innerHTML:b.owner,owner:b.owner,alt:this.i18n.viewProfile,title:this.i18n.viewProfile},a.create("span",{"class":"esriFloatLeading esriTrailingMargin1 esriItemOwner"},
c));a.create("span",{innerHTML:" ("+this.util.toFullDateString(b.created)+")"},c);a.connect(d,"onclick",this,function(b){b.preventDefault();var c=a.attr(b.currentTarget,"owner"),d=arcgisonline.sharing.dijit.ProfilePopup.prototype.statics.getInstance();null!==d&&a.hitch(d,d.showProfile,c,b.currentTarget).call()});a.attr(d,{"class":"linkNoHref",owner:b.owner});(this.isAdmin||this._roleCanUpdateItems||this.currentUser&&null!=this.currentUser&&this.currentUser.email==b.owner)&&a.create("a",{href:"#",
onclick:a.hitch(this.content,a.partial(this.content.deleteComment,this.itemID,b.id,a.hitch(this,this.handle_deleteComment),a.hitch(this,this.handle_deleteComment))),innerHTML:this.i18n.deleteLabel.toLowerCase()},a.create("span",{"class":"esriItemLinks esriFloatTrailing"},c));b=this.util.htmlEncode(b.comment);for(d=b.indexOf("http");-1<d;){var e=b.substring(d,d+8);if(-1<e.indexOf("http://")||-1<e.indexOf("https://")){if(e=!0,6<d&&"href\x3d"==b.substring(d-6,d-1).toLowerCase()&&(e=!1,d=d+b.toLowerCase().substring("/a",
d).length+1),e){e=b.indexOf(" ",d);-1==e&&(e=b.length);var g=b.substring(d,e),f="\x3cspan class\x3d'esriItemLinks'\x3e\x3ca href\x3d'"+g+"' target\x3d'_blank'\x3e"+g+"\x3c/a\x3e\x3c/span\x3e";b=b.substring(0,d)+f+b.substring(e,b.length);d=d+f.length-g.length+5}}else d+=1;d=b.indexOf("http",d)}a.create("p",{innerHTML:b},c);return c},getThumbnail:function(){var b,c=this._thumbnail||this._getThumbnailUrl(this.item),d=new a.Deferred;a.when(c,a.hitch(this,function(c){this._cleanUpThumbnailClickConnect();
this._thumbnail=c;a.attr("item-thumbnail","innerHTML",'\x3ca id\x3d"item-thumbnail-a"\x3e\x3cspan style\x3d"width:200px;height:133px;background-image:url('+c+');background-repeat:no-repeat;display:inline-block;"\x3e\x3c/span\x3e\x3c/a\x3e');a.byId("item-thumbnail-text").innerHTML='\x3ca href\x3d"JavaScript:void(0);" onclick\x3d"JavaScript:dijit.byId(\'item-properties\').editItemThumbnail();"\x3e'+this.i18n.clickToChangeThumbnail+"\x3c/a\x3e";b=this.util.getGalleryMainLinkInfo(this.item);a.attr("item-thumbnail-a",
{href:b.href,title:b.tip,alt:b.tip,target:b.target});b.onclick&&(this._thumbOnClickConnect=a.connect(a.byId("item-thumbnail-a"),"onclick",b.onclick));d.resolve(!0)}));return d},_getExportCall:function(a,c,d){a=arcgisonline.map.main.buildExportCall(a,c,"4326",null,"200,133",null,"json",null,d||null);return this.util.request({url:a},{addToken:!1})},_getThumbnailUrl:function(b){var c,d=this.util.relativeToExplicitUrl("images/transparent.gif");c=b.url;var e=b.type.toLowerCase(),g=b.extent,f="-180,-90,180,90";
if(!b)return c=new a.Deferred,c.resolve(this.util.relativeToExplicitUrl("images/transparent.gif")),c;if(b.thumbnail)return c=new a.Deferred,c.resolve(esriGeowConfig.restBaseUrl+"content/items/"+b.id+"/info/"+b.thumbnail+this.token),c;g&&(2===g.length&&2===g[0].length&&2===g[1].length)&&(f=Math.round(1E3*g[0][0])/1E3+","+Math.round(1E3*g[0][1])/1E3+","+Math.round(1E3*g[1][0])/1E3+","+Math.round(1E3*g[1][1])/1E3);"image service"==e?c=this._getServiceInfo(c).then(a.hitch(this,function(a){return this._getExportCall(this.item.url,
f,a)})):"feature service"==e?c=arcgisonline.map.thumbnail.buildThumbnailURLFromFSItem(b,null,this.itemData?this.itemData.layers:null).then(a.hitch(this,function(a){return a}),a.hitch(this,function(a){return d})):"kml"==e?c=arcgisonline.map.thumbnail.buildThumbnailURLFromKMLItem(b).then(a.hitch(this,function(a){return a}),a.hitch(this,function(a){return d})):"map service"==e?c=this._getExportCall(b.url,f,null):"web mapping application"==e?(c=new a.Deferred,c.resolve(this.util.getStaticImagesUrl()+
"/webapp.png")):"mobile application"==e?(c=new a.Deferred,c.resolve(this.util.getStaticImagesUrl()+"/mobileapp.png")):"image"===e?(e=esriGeowConfig.restBaseUrl+"content/items/"+b.id+"/data"+this.token,2097134<b.size&&(e=this.util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/image-thumb.png")),c=new a.Deferred,c.resolve(e)):"workforce project"===e?(c=new a.Deferred,c.resolve(this.util.getStaticImagesUrl()+"/workforceproject.png")):"web scene"===e||"scene service"===e?(c=new a.Deferred,
c.resolve(this.util.getStaticImagesUrl()+"/scene.png")):(c=new a.Deferred,c.resolve(this.util.getStaticImagesUrl()+"/desktopapp.png"));return c},_onExtraInfo:function(){},getExtraInfo:function(){var b=function(b,d){var e=function(b,c){this.item=a.mixin(this.item,b.item);this.item.access=b.sharing.access;this.item.sharing=b.sharing;this._onExtraInfo();a.attr(a.byId("item-shared-title"),"innerHTML","");a.attr(a.byId("item-groups"),"innerHTML","");if(0===b.sharing.groups.length&&"private"==b.sharing.access)a.byId("item-groups-text")&&
a.destroy("item-groups-text"),a.byId("item-shared-title-text")&&a.destroy("item-shared-title-text"),a.attr(a.byId("item-shared-title"),"innerHTML",this.i18n.itemNotShared);else{a.byId("item-shared-title-text")&&a.destroy("item-shared-title-text");var d="",e="";"public"==b.sharing.access?(d+=this.i18n.everyone,e=", "):"org"===b.sharing.access&&(d+=this.i18n.organization,e=", ");for(var f=0;f<b.sharing.groups.length;f++){for(var g=b.sharing.groups[f],h="",k="",r=!1,q=0;q<this.userGroups.length;q++)if(this.userGroups[q].id==
g){r=!0;h=this.userGroups[q].title;k=this.userGroups[q].owner;break}if(!r&&this.adminGroups&&this.adminGroups.length)for(q=0;q<this.adminGroups.length;q++)if(this.adminGroups[q].id==g){r=!0;h=this.adminGroups[q].title;k=this.adminGroups[q].owner;break}r&&(d+=e+'\x3cspan class\x3d"esriItemShared"\x3e\x3ca href\x3d"group.html?owner\x3d'+k+"\x26title\x3d"+encodeURIComponent(h)+'" alt\x3d"'+this.i18n.groupDetails+'" title\x3d"'+this.i18n.groupDetails+'"\x3e'+h+"\x3c/a\x3e\x3c/span\x3e",e=", ")}a.byId("item-shared-title-text")&&
a.destroy("item-shared-title-text");a.attr(a.byId("item-groups"),"innerHTML",d)}};this.userFolders=b.folders;this.userItems=b.items;if(void 0!==this.item.folderId){var f=this.util.getUser(),h=esriGeowConfig.restBaseUrl+"content/users/";this.isAdmin||(this._roleCanViewItems||this._isOwnershipShared)&&this.itemUser?(f=this.itemUser,h+=f.username):h+=this.itemUser?this.itemUser.username:f.email;h=null!==this.item.folderId?h+("/"+this.item.folderId+"/items/"+this.item.id):h+("/items/"+this.item.id);this.util.getJson(h,
a.hitch(this,e));this.updateMoveToMenu()}else{f=null;for(h=0;h<this.userItems.length;h++)if(this.userItems[h].id==this.item.id){f="";break}if(null!=f)this.item.folderTitle="/",this.item.folderId=null,f=this.util.getUser(),h=esriGeowConfig.restBaseUrl+"content/users/",this.isAdmin||(this._roleCanViewItems||this._isOwnershipShared)&&this.itemUser?(f=this.itemUser,h+=f.username):h+=f.email,h+="/items/"+this.item.id,this.util.getJson(h,a.hitch(this,e)),this.updateMoveToMenu();else{var k=function(b,c){for(var d=
0;d<b.items.length;d++)if(b.items[d].id==this.item.id){this.item.folderTitle=b.currentFolder.title;this.item.folderId=b.currentFolder.id;var d=this.util.getUser(),f=esriGeowConfig.restBaseUrl+"content/users/";this.isAdmin||(this._roleCanViewItems||this._isOwnershipShared)&&this.itemUser?(d=this.itemUser,f+=d.username):f+=d.email;f+="/"+this.item.folderId+"/items/"+this.item.id;this.util.getJson(f,a.hitch(this,e));this.updateMoveToMenu();break}};a.forEach(this.userFolders,function(b,c){var d=this.util.getUser(),
e=esriGeowConfig.restBaseUrl+"content/users/";this.isAdmin&&this.itemUser||(this._roleCanViewItems||this._isOwnershipShared)&&this.itemUser?(d=this.itemUser,e+=d.username):e+=d.email;e+="/"+b.id;this.util.getJson(e,a.hitch(this,k))},this)}}};this.userFolders?a.hitch(this,b,{folders:this.userFolders,items:this.userItems})():this.isAdmin&&this.itemUser||this._roleCanViewUsers&&this._roleCanViewItems&&this._roleCanUpdateItems&&this.itemUser&&!this._isOwnershipShared?this.folder.getFoldersByUser(this.itemUser.username,
a.hitch(this,b)):this.folder.getFolders(a.hitch(this,b))},updateOpenMenu:function(){var b=this.util.getItemOpenLinkObjects(this.item,"Vector Tile Service"===this.item.type?this.isAdmin||this._roleCanUpdateItems||this.currentUser&&this.currentUser.username===this.item.owner||this._isOwnershipShared:this.currentUser&&this.currentUser.username===this.item.owner),c=this._openMenu&&this._openMenu.getChildren()||[],d=a.hitch(this,function(a){a.destroy()});if(null==this._openMenu)this._openMenu=new f.Menu({id:"item-open-menu"}),
f.byId("item-open-button").dropDown=this._openMenu;else if(c.length){0<b.length?(a.forEach(this._openConnects,a.disconnect),a.forEach(this._openMenu.getChildren(),d),a.forEach(b,a.hitch(this,function(b){var c=new f.MenuItem({label:b.label,"class":b.label.replace(/\s+/g,"")});this._openConnects.push(a.connect(c,"onClick",b.onClick));this._openMenu.addChild(c)})),f.byId("item-open-button").set("disabled",!1)):f.byId("item-open-button").set("disabled",!0);return}0<b.length?(f.byId("item-open-button").set("disabled",
!1),a.forEach(b,a.hitch(this,function(b){var c=new f.MenuItem({label:b.label,"class":b.label.replace(/\s+/g,"")});this._openConnects.push(a.connect(c,"onClick",b.onClick));this._openMenu.addChild(c)}))):f.byId("item-open-button").set("disabled",!0)},_checkItemsResources:function(b){var c=new a.Deferred,d=esriGeowConfig.restBaseUrl+"content/items/"+b.id+"/resources/styles/root.json";b&&"Vector Tile Service"===b.type&&!esri.isDefined(b.hasResource)?this.util.request({url:d}).then(a.hitch(this,function(a){b.hasResources=
!0;c.resolve(b)}),a.hitch(this,function(a){b.hasResources=!1;c.resolve(b)})):c.resolve(b);return c},updateFeatureServiceOpenMenu:function(b,c){var d;null===f.byId("item-open-menu")?(d=new f.Menu({id:"item-open-menu"}),f.byId("item-open-button").dropDown=d):(d=f.byId("item-open-menu"),d.destroyDescendants());var e=this.util.getItemOpenLinkObjects(this.item,this.isAdmin||this._roleCanUpdateItems||this.currentUser&&this.currentUser.username===this.item.owner);if(0<e.length){f.byId("item-open-button").set("disabled",
!1);var g=0;a.forEach(e,function(e){-1!==g&&g===c?(d.addChild(b),g=-1):-1!==g&&g++;var k=new f.MenuItem({label:e.label});a.connect(k,"onClick",e.onClick);d.addChild(k)});-1!==g&&d.addChild(b)}else f.byId("item-open-button").set("disabled",!0)},updateMoveToMenu:function(){var b;null==f.byId("item-moveto-menu")&&(b=new f.Menu({id:"item-moveto-menu"}),f.byId("item-moveto-button").dropDown=b);if(0<this.userFolders.length){b=f.byId("item-moveto-menu");a.forEach(b.getChildren(),"item.destroyRecursive();",
this);if(null!=this.item.folderId){var c=this.util.getUser();this.isAdmin||this._roleCanReassignItems&&this.itemUser?(c=this.itemUser,c=new f.MenuItem({label:c.username})):c=new f.MenuItem({label:c.email});a.connect(c,"onClick",a.hitch(this,"moveItem",{id:null,title:"/"}));b.addChild(c)}a.forEach(this.userFolders,function(c,e){if(this.item.folderId!=c.id){var g=new f.MenuItem({label:c.title});a.connect(g,"onClick",a.hitch(this,"moveItem",{id:c.id,title:c.title}));b.addChild(g)}},this);this._isCustomRole&&
this.itemUser?f.byId("item-moveto-button").set("disabled",!0):f.byId("item-moveto-button").set("disabled",!1)}else this.isAdmin||esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin()||this._roleCanReassignItems?(f.byId("item-moveto-button").set("disabled",!0),this.account.getAccountUsers(this.currentUser.accountId,{start:1,num:1},a.hitch(this,function(a){a&&(!a.code&&!a.message)&&(1<a.total?f.byId("item-reassign-button").set("disabled",!1):f.byId("item-reassign-button").set("disabled",!0))}),
a.hitch(this,function(a){console.log(a);f.byId("item-moveto-button").set("disabled",!0)}))):f.byId("item-moveto-button").set("disabled",!0)},updateExportLayersMenu:function(b,c){!this.item.relatedItem&&(-1<a.indexOf(this.item.typeKeywords,"Hosted Service")&&(this.currentUser&&(!this._isCustomRole||this._roleCanCreateItem)||this.isAdmin||this.currentUser&&this.currentUser.username===this.item.owner&&(!this._isCustomRole||this._roleCanCreateItem)))&&this.isUpdateableService(this.item).then(a.hitch(this,
function(b){!0===b&&(this._isUpdateableService=!0,c&&!c.syncEnabled&&(f.byId("item-update-button").set("label",this.i18n.overwrite),a.style(a.byId("item-update-button-div"),"display","")))}));if(-1<a.indexOf(this.item.typeKeywords,"Hosted Service")&&this.currentUser&&(this._isExportEnabled(c.capabilities)&&(!this._isCustomRole||this._roleCanCreateItem||this._isOwnershipShared)||this.isAdmin||this.currentUser.username===this.item.owner&&(!this._isCustomRole||this._roleCanCreateItem))){a.style("item-export-toolbar",
"display","");a.style(f.byId("item-export-layers-button").domNode,"display","");var d=f.byId("item-export-layers-menu");d||(d=new f.Menu({id:"item-export-layers-menu"}),f.byId("item-export-layers-button").dropDown=d,d.addChild(new f.MenuItem({label:this.i18n.exportToShapefile,iconClass:"iconExportData",onClick:a.hitch(this,"doExportShapefile",b)})),d.addChild(new f.MenuItem({label:this.i18n.exportToCSVFile,iconClass:"iconExportFile",onClick:a.hitch(this,"doExportCsv",b)})),d.addChild(new f.MenuItem({label:this.i18n.exportToFgdb,
iconClass:"iconExportFile",onClick:a.hitch(this,"doExportFgdb",b)})),d.addChild(new f.MenuItem({label:this.i18n.exportToFeatureCollection,iconClass:"iconExportFile",onClick:a.hitch(this,"doExportFeatureCollection",b)})),d.addChild(new f.MenuItem({label:this.i18n.exportToGeoJson,iconClass:"iconExportFile",onClick:a.hitch(this,"doExportGeoJson",b)})))}},disableSaveButtons:function(){f.byId("item-save-button").set("disabled",!0);f.byId("item-save-button2").set("disabled",!0);f.byId("item-close-button").set("disabled",
!0);f.byId("item-close-button2").set("disabled",!0)},enableSaveButtons:function(){f.byId("item-save-button").set("disabled",!1);f.byId("item-save-button2").set("disabled",!1);f.byId("item-close-button").set("disabled",!1);f.byId("item-close-button2").set("disabled",!1)},saveItem:function(){this._checkIfExists().then(a.hitch(this,function(){var b=a.hitch(this,function(){a.query("#page-border").style("cursor","default");this.saveItem2();this.enableSaveButtons()});this.mustUpdateTileService()&&(this.isAdmin||
this._roleCanUpdateItems||this.currentUser&&this.currentUser.username===this.item.owner||this._isOwnershipShared)?(a.query("#page-border").style("cursor","wait"),this.disableSaveButtons(),this.editTileService().then(b,b)):this.mustUpdateEditorTrackingInfo()&&(this.isAdmin||this._roleCanUpdateItems&&this.itemUser||this.currentUser&&this.currentUser.username===this.item.owner||this._isOwnershipShared)?(a.query("#page-border").style("cursor","wait"),this.disableSaveButtons(),this._isUpdateableService&&
(this.adminEditingInfo.syncEnabled?a.style(a.byId("item-update-button-div"),"display","none"):(f.byId("item-update-button").set("label",this.i18n.overwrite),a.style(a.byId("item-update-button-div"),"display",""))),this.editFeatureService(a.hitch(this,b))):this.saveItem2()}))},saveItem2:function(){this._isPortal&&(this.serverToken&&this.adminServerToken)&&(this.adminServerToken=this.serverToken=null);var b=a.trim(f.byId("item-title-edit-input").getValue());if(0==b.length)b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),
b.show({title:this.i18n.error.error,message:this.i18n.error.needTitle});else if(-1<b.indexOf("\x3c")||-1<b.indexOf("\x3e"))b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),b.show({title:this.i18n.error.error,message:this.i18n.error.badCharacter});else if(f.byId("item-title-edit-input").set("value",b),b=this._tags.get("tags"),!b||0==b.length)b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),b.show({title:this.i18n.error.error,message:this.i18n.error.needTags});
else{var c=this._serviceInfoPane&&this._serviceInfoPane.get("userInfo");if(!0===this._svcCredentialError&&c&&(c.username||c.password))return this._showError(this.i18n.error.invalidCredentials);if(c&&c.username&&c.password){if(esriGeowConfig.restBaseUrl=esriGeowConfig.restBaseUrl.replace("http:/","https:/"),0===window.location.protocol.indexOf("http:")&&!esri._canDoXOXHR(esriGeowConfig.restBaseUrl))return this._showReloadDlg()}else this._serviceInfoPane&&this._serviceInfoPane.set("disabled",!0);var d=
this.item.type?this.item.type.toLowerCase():"";a.style(a.byId("item-owner-toolbar"),"display","none");a.style(a.byId("item-edit-toolbar"),"display","none");a.style(a.byId("item-save-buttons"),"display","none");a.style(a.byId("item-wait-toolbar"),"display","block");this.item.title=f.byId("item-title-edit-input").getValue();this.item.description=f.byId("item-description-edit").getValue();this.item.licenseInfo=f.byId("item-licenseInfo-edit").getValue();this.item.snippet=f.byId("item-summary-edit-input").getValue()===
this._helperSummary?"":f.byId("item-summary-edit-input").getValue();this.item.tags=this._tags.get("tags");b=f.byId("item-url-edit-input").getValue();if(!this.item.originalUrl||this.item.originalUrl&&0<this.item.originalUrl.length&&b!==this.item.originalUrl)this.item.url=b;if("Web Mapping Application"===this.item.type||"Mobile Application"===this.item.type||"Desktop Application"===this.item.type)b={purpose:this._appPurposeSelect.get("value"),api:null},"Web Mapping Application"===this.item.type?b.api=
this._webAppApiSelect.get("value")||"Other":"Mobile Application"===this.item.type?b.api=this._mobileAppApiSelect.get("value")||"iOS":"Desktop Application"===this.item.type&&(b.api=this._platformAppApiSelect.get("value")||"Java"),a.attr("item-purpose","innerHTML","selfConfigured"===b.purpose?this.i18n.selfConfigurable:b.purpose),a.attr("item-api","innerHTML",b.api),"Mobile"==b.api?b.api="Windows Mobile":"iOS"==b.api?b.api="ArcGIS for iPhone":"Android"==b.api?b.api="ArcGIS for Android":"Windows Phone"==
b.api&&(b.api="ArcGIS for Windows Phone"),this.item.typeKeywords=this.setItemPlatform(this.item,b);this.item.accessInformation=f.byId("item-copyright-edit-input").getValue();null!=this.newExtent&&(this.item.extent=this.newExtent,this.waitingForThumbnail&&(this.waitingForThumbnail=!1));this.setViewOnly();this.setOfflineMode();var b="",e=this.item.extent;e&&(2==e.length&&2==e[0].length&&2==e[1].length)&&(b=""+this.item.extent[0][0]+", "+this.item.extent[0][1]+", "+this.item.extent[1][0]+", "+this.item.extent[1][1]);
var g=a.create;f.byId("item-form-title").set("value",this.item.title);f.byId("item-form-type").set("value",this.item.type);f.byId("item-form-tags").set("value",this.item.tags);f.byId("item-form-description").set("value",this.item.description);f.byId("item-form-snippet").set("value",this.item.snippet);f.byId("item-form-accessInformation").set("value",this.item.accessInformation);f.byId("item-form-licenseInfo").set("value",this.item.licenseInfo);f.byId("item-form-extent").set("value",b);f.byId("item-form-url").set("value",
this.item.sourceUrl||this.item.url);f.byId("item-form-type-keywords").set("value",this._cleanTypekeywords(this.item.typeKeywords.join(",")));f.byId("item-form-item").set("value",this.item.item);this.item.listed&&this.item.listingProperties&&f.byId("item-form-listingProperties").set("value",a.json.stringify(this.item.listingProperties));g("span",{innerHTML:this.item.title},"groupsTitle2","only");g("span",{id:"item-description-span",innerHTML:this.item.description},"item-description","only");g("span",
{id:"item-licenseInfo-span",innerHTML:this.item.licenseInfo&&!1===/^(<br.*\/>)+$/.test(this.item.licenseInfo)?this.item.licenseInfo:""},"item-licenseInfo","only");(!this.item.licenseInfo||!0===/^(<br.*\/>)+$/.test(this.item.licenseInfo))&&a.style(this._itemAccessSection,"display","none");g("span",{innerHTML:this.util.htmlEncode(this.item.snippet)},"item-summary","only");var h=g("span",{"class":"esriItemTags"}),k=this.item.tags.split(","),l;a.forEach(k,function(a,b){l=a?this.util.htmlEncode(a):"";
g("a",{href:"search.html?t\x3dcontent\x26q\x3dtags:"+l,innerHTML:l},h);b<k.length-1&&h.appendChild(document.createTextNode(", "))},this);a.place(h,a.byId("item-tags"),"only");g("span",{innerHTML:this.util.htmlEncode(this.item.accessInformation)},"item-copyright","only");g("a",{innerHTML:this.item.url||"",href:this.item.url||"",title:this.item.url||"",target:"_blank"},"item-url","only");var m=a.byId("item-thumbnail-file").value,b=this.util.relativeToExplicitUrl("images/transparent.gif");null!=m&&0<
m.length?(e=m.lastIndexOf("\\"),-1<e&&(m=m.substring(e+1,m.length)),m=this._escapeFilename(m),a.byId("item-thumbnail").innerHTML='\x3ca id\x3d"item-thumbnail-a"\x3e\x3cspan style\x3d"width:200px;height:133px;background-image:url('+b+');background-repeat:no-repeat;display:inline-block;"/\x3e\x3c/a\x3e',a.byId("item-thumbnail-text").innerHTML='\x3ca href\x3d"JavaScript:void(0);" onclick\x3d"JavaScript:dijit.byId(\'item-properties\').editItemThumbnail();"\x3e\x3c/a\x3e'):!this.util.isHostedServiceItem(this.item)&&
("map service"==d||"image service"==d||"feature service"==d)&&(!this.item.thumbnail||0==this.item.thumbnail.length||null!=this.newExtent&&-1<this.item.thumbnail.indexOf("thumbnail/ago_downloaded."))?(a.byId("item-thumbnail").innerHTML='\x3ca id\x3d"item-thumbnail-a"\x3e\x3cspan style\x3d"width:200px;height:133px;background-image:url('+b+');background-repeat:no-repeat;display:inline-block;"/\x3e\x3c/a\x3e',a.byId("item-thumbnail-text").innerHTML='\x3ca href\x3d"JavaScript:void(0);" onclick\x3d"JavaScript:dijit.byId(\'item-properties\').editItemThumbnail();"\x3e\x3c/a\x3e'):
"web map"==d&&(!this.item.thumbnail||0===this.item.thumbnail.length||null!=this.newExtent&&-1<this.item.thumbnail.indexOf("thumbnail/ago_downloaded."))?(a.byId("item-thumbnail").innerHTML='\x3ca id\x3d"item-thumbnail-a"\x3e\x3cspan style\x3d"width:200px;height:133px;background-image:url('+b+');background-repeat:no-repeat;display:inline-block;"/\x3e\x3c/a\x3e',a.byId("item-thumbnail-text").innerHTML='\x3ca href\x3d"JavaScript:void(0);" onclick\x3d"JavaScript:dijit.byId(\'item-properties\').editItemThumbnail();"\x3e\x3c/a\x3e'):
-1<a.byId("item-thumbnail").innerHTML.indexOf("item-thumbnail-update.png")&&this.getThumbnail();var n=a.hitch(this,function(b){var c=b.code,d=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();a.style(a.byId("item-wait-toolbar"),"display","none");a.style(a.byId("item-save-buttons"),"display","");500===c?d.show(this.i18n.error.invalidCredentials):d.show({title:this.i18n.error.error,message:b.message||this.i18n.error.saveUnsuccessful})}),p=a.hitch(this,function(b,d){if(b.success){a.byId("item-thumbnail-file").value=
"";this.isAdmin||this._roleCanViewUsers&&this.itemUser&&!this._isOwnershipShared?this.util.loadUserTags(this.itemUser.username).then(a.hitch(this,function(a){this._tags.set("knownTags",a)})):this.util.loadUserTags(this.currentUser.username).then(a.hitch(this,function(a){this._tags.set("knownTags",a)}));this.item.modified=(new Date).getTime();var e=new Date(this.item.modified);a.byId("item-modified").innerHTML=a.date.locale.format(e,{selector:"date",formatLength:"long"});if(null!=m&&0<m.length)this.item.thumbnail=
"thumbnail/"+m,e="ms\x3d"+(new Date).getUTCMilliseconds(),e=0===this.token.length?"?"+e:"\x26"+e,a.byId("item-thumbnail").innerHTML='\x3ca id\x3d"item-thumbnail-a"\x3e\x3cimg src\x3d\''+esriGeowConfig.restBaseUrl+"content/items/"+this.item.id+"/info/"+this.item.thumbnail+this.token+e+"' alt\x3d'Thumbnail' style\x3d'max-width:200px;max-height:133px'/\x3e\x3c/a\x3e",a.byId("item-thumbnail-text").innerHTML='\x3ca href\x3d"JavaScript:void(0);" onclick\x3d"JavaScript:dijit.byId(\'item-properties\').editItemThumbnail();"\x3e'+
this.i18n.clickToChangeThumbnail+"\x3c/a\x3e";else{var g=f.byId("item-form-thumbnailURL").getValue();if(0<g.length){var e="\x26ms\x3d"+(new Date).getUTCMilliseconds(),h=esriGeowConfig.restBaseUrl+"content/items/"+this.item.id+"/info/thumbnail/ago_downloaded.png"+this.token+e;this.testImageHandler&&a.disconnect(this.testImageHandler);this.testImageHandler=a.connect(a.byId(this.id+"_testImage"),"onload",a.hitch(this,function(){a.byId("item-thumbnail").innerHTML='\x3ca id\x3d"item-thumbnail-a"\x3e\x3cimg src\x3d\''+
h+"' alt\x3d'Thumbnail' width\x3d'200' height\x3d'133'/\x3e\x3c/a\x3e";a.byId("item-thumbnail-text").innerHTML='\x3ca href\x3d"JavaScript:void(0);" onclick\x3d"JavaScript:dijit.byId(\'item-properties\').editItemThumbnail();"\x3e'+this.i18n.clickToChangeThumbnail+"\x3c/a\x3e";f.byId("item-form-thumbnailURL").set("value","")}));var k=setTimeout(a.hitch(this,function(){clearTimeout(k);k=null;a.byId("item-thumbnail").innerHTML='\x3ca id\x3d"item-thumbnail-a"\x3e\x3cimg src\x3d\''+g+"' alt\x3d'Thumbnail' width\x3d'200' height\x3d'133'/\x3e\x3c/a\x3e"}),
5E3);a.byId(this.id+"_testImage").src=h}else this.getThumbnail()}a.style(a.byId("item-extent-button-div1"),"display","none");a.style(a.byId("item-extent-button-div2"),"display","none");a.style(a.byId("item-title-edit"),"display","none");a.style(a.byId("item-thumbnail-text"),"display","none");a.byId("item-thumbnail-a")&&-1<a.byId("item-thumbnail-a").innerHTML.indexOf("item-thumbnail.png")&&(a.byId("item-thumbnail").innerHTML='\x3ca id\x3d"item-thumbnail-a"\x3e\x3cimg src\x3d\''+this.util.relativeToExplicitUrl("images/transparent.gif")+
"' alt\x3d'Thumbnail' width\x3d'200' height\x3d'133'/\x3e\x3c/a\x3e");a.style(a.byId("item-description-edit-div"),"display","none");a.style(a.byId("item-description"),"display","block");a.style(a.byId("item-licenseInfo-edit-div"),"display","none");a.style(a.byId("item-licenseInfo"),"display","block");a.style(a.byId("item-summary-edit"),"display","none");a.style(a.byId("item-summary"),"display","block");a.style(a.byId("item-tags-edit"),"display","none");a.style(a.byId("item-tags"),"display","block");
a.style(a.byId("item-copyright-edit"),"display","none");a.style(a.byId("item-copyright"),"display","block");a.style(a.byId("item-wait-toolbar"),"display","none");a.style(a.byId("item-edit-toolbar"),"display","none");a.style(a.byId("item-save-buttons"),"display","none");a.style(a.byId("item-owner-toolbar"),"display","block");a.query(".hostedTilesCol").style("width","140px");a.query(".hostedFeaturesCol").style("width","140px");this._showServiceEditFields(!1);a.query(".editOnly",this.domNode).style("display",
"none");a.query(".readOnly",this.domNode).style("display","");a.query(".registerSection").forEach(esri.hide);this._showMetadataUI();this._showRegisterSection();this._showMarketplaceSection();this._showAdvancedSection();this._showFavoritesButton();(this.util.isProApp(this.item)||"Native Application Installer"===this.item.type)&&a.style(f.byId("item-share-button").domNode,"display","none");esri.show(this._commentsSection);esri.hide(a.byId("item-configuration"));this._getAppCollectorProperties();this._serviceInfoPane&&
(this._serviceInfoPane.set("disabled",!1),c&&(c.username&&c.password&&!this.item.sourceUrl)&&(e=this.item.url.substr(this.item.url.lastIndexOf("/")+1,this.item.url.length),this.item.sourceUrl=this.item.url,this.item.url=window.location.protocol+"//utilitydevext.arcgis.com/sharing/rest/services/"+b.id+"/"+e,a.query("#item-map-contents span \x3e a").attr("href",this.item.url+this.token).removeAttr("onclick"),a.query("#item-map-contents span \x3e a").attr("title",this.item.url),a.query("#item-map-contents span \x3e a")[0].innerHTML=
this.item.url));this._onItemLoad(this.item)}else{a.style(a.byId("item-wait-toolbar"),"display","none");this.cancelEditItem();this.currentUser=this.util.getUser();this.isAdmin=esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin();this.fillItemInfo();var e=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),l=b.error,n=["SB_0001","SB_0002","SB_0003","SB_0004"],p=["SB_0005","SB_0006","SB_0007"];l&&-1!==a.indexOf(n,l.messageCode)?arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg.prototype.statics.getInstance().show(esriGeowConfig.self.subscriptionInfo):
l&&-1!==a.indexOf(p,l.messageCode)?arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg.prototype.statics.getInstance().showOther(l.messageCode):b.error&&b.error.message&&-1<b.error.message.indexOf("file exceeds the max size")?e.show({title:this.i18n.error.error,message:l.message}):e.show({title:this.i18n.error.error,message:l.message||this.i18n.error.saveUnsuccessful})}});this.setDeleteProtection().then(a.hitch(this,function(){var b=this._roleCanUpdateItems&&this.currentUser.email!==this.item.owner||
this._isOwnershipShared;if("map service"==d||"image service"==d||"feature service"==d)(!this.item.thumbnail||0===this.item.thumbnail.length)&&this.setThumbnailURLForService(),this.util.isHostedServiceItem(this.item)&&a.query("#item-form-url").orphan(),this.isAdmin||b?this.content.updateItemByUser(this.item,a.byId("item-form"),p,n):this.content.updateItem(this.item,a.byId("item-form"),p,n);else if("web map"==d)if(!this.item.thumbnail||0===this.item.thumbnail.length||null!=this.newExtent&&-1<this.item.thumbnail.indexOf("thumbnail/ago_downloaded.")){var c=
a.hitch(this,function(c,d){this._isAppPropertiesChanged&&(this._setAppCollectorProperties(),f.byId("item-form-text").set("value",a.json.stringify(this.getDataContent)),f.byId("item-form-overwrite").set("value","true"));this.isAdmin||b?this.content.updateItemByUser(this.item,a.byId("item-form"),p):this.content.updateItem(this.item,a.byId("item-form"),p)});this.setThumbnailURLForWebMap(c)}else this._isAppPropertiesChanged&&(this._setAppCollectorProperties(),f.byId("item-form-text").set("value",a.json.stringify(this.getDataContent)),
f.byId("item-form-overwrite").set("value","true")),this.isAdmin||b?this.content.updateItemByUser(this.item,a.byId("item-form"),p):this.content.updateItem(this.item,a.byId("item-form"),p);else{if("web mapping application"===d||"mobile application"===d)if(this._isConfigUpdated||this._isAppPropertiesChanged)f.byId("item-form-text").set("value",f.byId("item-form-text").get("value")),f.byId("item-form-overwrite").set("value","true");this.isAdmin||b?this.content.updateItemByUser(this.item,a.byId("item-form"),
p):this.content.updateItem(this.item,a.byId("item-form"),p)}}))}},_cleanTypekeywords:function(b){b=a.isArray(b)?b:b.split(",");for(var c=0;c<b.length;c++)if(!b[c]||""===b[c]||","===b[c])b.splice(c,1),c--;return b.join(",")},_showServiceEditFields:function(b){var c=-1<a.indexOf(this.item.typeKeywords,"Hosted Service")&&(this.util.isHostedServiceItem(this.item)||this.util.portalSupportsHostedServices());if(("Map Service"==this.item.type||"Image Service"==this.item.type||"Feature Service"==this.item.type||
"Stream Service"===this.item.type||"Scene Service"===this.item.type||"Vector Tile Service"===this.item.type)&&!c&&-1===a.indexOf(this.item.typeKeywords,"Service Proxy"))a.query(".serviceEdit",this.domNode).style("display",b?"":"none"),b||this.loadItem(this.item)},_showRegisterSection:function(){var b=this.item.type?this.item.type.toLowerCase():"",c=!1,d=arcgisonline.sharing.util.getHomeAppContext(),d=this.item.url&&-1<this.item.url.toLowerCase().indexOf((window.location.host+d).toLowerCase());this.currentUser&&
(this.currentUser.accountId&&-1!==b.indexOf("application",b.length-11))&&(c=!0);this.item.type&&("Web Mapping Application"===this.item.type&&d)&&(c=this.item.appProxies&&this.item.appProxies.length?!c?!1:!0:!1);a.query(".registerSection").forEach(c?esri.show:esri.hide)},_showMarketplaceSection:function(){a.query(".marketplaceSection").forEach(esri.hide);esri.hide(this.createListingButton.domNode);esri.hide(this.viewListingButton.domNode);esri.hide(this.unlistItemButton.domNode);esri.hide(this.marketplaceInfo);
var b=!1,c=this.item.type?this.item.type.toLowerCase():"",d=this.currentUser&&this.currentUser.accountId,e=this._roleCanManageMarketplace,e=(this.isAdmin||e||esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin())&&this.currentUser.username===this.item.owner;if(d&&!this._isPortal&&(!this.item.type||!("Web Mapping Application"===this.item.type&&this.item.url&&(-1<this.item.url.toLowerCase().indexOf(esriGeowConfig.portalHostname.toLowerCase())||-1<this.item.url.toLowerCase().indexOf(window.location.hostname.toLowerCase()))))){if(this.item.listed){b=
!0;if(-1===a.indexOf(this.item.typeKeywords,"Child Listing")||-1<a.indexOf(this.item.typeKeywords,"Child Listing")&&esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin())a.style(this.viewListingButton.domNode,"display",""),b=!0;e&&(a.style(this.unlistItemButton.domNode,"display",""),b=!0)}else e&&esriGeowConfig.self.canListApps&&!this._registeredAppInfo&&-1!==c.indexOf("application",c.length-11)&&-1===a.indexOf(this.item.typeKeywords,"Registered App")?(b=!0,esri.show(this.marketplaceInfo)):this._showCreateListing().then(a.hitch(this,
function(b){b&&(esri.show(this.createListingButton.domNode),a.query(".marketplaceSection").forEach(esri.show))}));b&&a.query(".marketplaceSection").forEach(esri.show)}},_showAdvancedSection:function(){a.query(".advancedSection").forEach(esri.hide);var b=!1;this.currentUser&&this.currentUser.accountId&&(-1<a.indexOf(this.item.typeKeywords,"Service Proxy")&&(b=!0),b&&a.query(".advancedSection").forEach(esri.show))},_showCreateListing:function(){var b=this._roleCanManageMarketplace,b=esriGeowConfig.userRole&&
esriGeowConfig.userRole.isAdmin()||b;this.item.listed||!esriGeowConfig.self||!b?(b=new a.Deferred,b.resolve(!1)):esriGeowConfig.self.canListApps&&(this._registeredAppInfo||-1!==a.indexOf(this.item.typeKeywords,"Registered App"))?(b=new a.Deferred,b.resolve(!0)):esriGeowConfig.self.canListData?b=this._isServiceListable():(b=new a.Deferred,b.resolve(!1));return b},_isServiceListable:function(){var b=esriGeowConfig.restBaseUrl+"portals/isServerRegistered",c=this.item.type?this.item.type.toLowerCase():
"",d=this.util.parseUrl(this.item.url);"web map"===c?(b=new a.Deferred,b.resolve(!0)):"feature service"===c||"map service"===c||"image service"===c?this.util.isHostedServiceItem(this.item)?(b=new a.Deferred,b.resolve(!0)):b=this.util.request({url:b,content:{serverUrl:d.protocol+"://"+d.host}}).then(a.hitch(this,function(a){return a.registered})):(b=new a.Deferred,b.resolve(!1));return b},_showScreenshotSection:function(){var b=a.byId("screenshots"),c=this.item,d=[];a.empty(b);c.screenshots&&c.screenshots.length?
(a.forEach(c.screenshots,a.hitch(this,function(a){d.push('\x3cimg class\x3d"shot" src\x3d"'+esriGeowConfig.restBaseUrl+"content/items/"+this.item.id+"/info/"+a+this.token+'" /\x3e')})),a.place(d.join(""),b,"first"),esri.show(this._screenshotSection)):esri.hide(this._screenshotSection)},_showFavoritesButton:function(){if(this.currentUser){var b=this.item.access,c=this.currentUser.username===this.item.owner,d=esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin(),e=esriGeowConfig.userRole&&esriGeowConfig.userRole.isCustom();
(!e||e&&esriGeowConfig.userRole.canShareItemToGroup())&&("public"===b||"org"===b||"public"!==b&&(this.isAdmin||c)||this.item.listed&&d)&&this._isFavorite(this.item.id).then(a.hitch(this,function(b){a.style(this._favoritesNode,{display:""});a.style(b&&b.total?this._favon:this._favoff,{display:""})}))}},mustUpdateEditorTrackingInfo:function(){var a=!1;if(this.adminServiceInfo){var a=!0,c=this.enableEditing.get("checked"),d=this.enableGeometryUpdate.get("checked"),e=this.disableGeometryUpdate.get("checked"),
f=this.allowAddOnly.get("checked"),h=this.enableTracking.get("checked"),k=this.enableRestrictedEdits.get("checked")||this.enableViewEdits.get("checked"),l=this.enableSync.get("checked")||this._syncEnabled;arcgisonline.sharing.util.isPortal()&&(l=this.enableSync.get("checked"));var m=this.enableExport.get("checked");h!==this.adminEditingInfo.trackingEnabled?!1===h?this.adminEditingInfo.mustDropEditFieldsInfo=!0:this.adminEditingInfo.mustAddEditFieldsInfo=!0:(this.adminEditingInfo.mustDropEditFieldsInfo=
!1,this.adminEditingInfo.mustAddEditFieldsInfo=!1);this.adminEditingInfo.mustUpdateAllowGeometryUpdates=this.adminEditingInfo.updateAttributesOnly!==e?!0:!1;this.adminEditingInfo.editingEnabled=c;this.adminEditingInfo.trackingEnabled=h;this.adminEditingInfo.ownershipAccessControlEnabled=k;this.adminEditingInfo.syncEnabled=l;this.adminEditingInfo.exportEnabled=m;d?(this.adminEditingInfo.fullFeatureEditing=!0,this.adminEditingInfo.updateAttributesOnly=!1,this.adminEditingInfo.allowAddOnly=!1):e?(this.adminEditingInfo.fullFeatureEditing=
!1,this.adminEditingInfo.updateAttributesOnly=!0,this.adminEditingInfo.allowAddOnly=!1):f?(this.adminEditingInfo.fullFeatureEditing=!1,this.adminEditingInfo.updateAttributesOnly=!1,this.adminEditingInfo.allowAddOnly=!0):(this.adminEditingInfo.fullFeatureEditing=!0,this.adminEditingInfo.updateAttributesOnly=!1,this.adminEditingInfo.allowAddOnly=!1)}return a},_editAGSCapabilities:function(b,c){var d={},e=new a.Deferred;a.some(this.adminServiceInfo&&this.adminServiceInfo.extensions,function(a){return a.typeName&&
"FeatureServer"===a.typeName?(d=a,!0):!1});this._isSDSFeatureService?(this.adminServiceInfo.capabilities=c.capabilities,this.adminServiceInfo.allowGeometryUpdates=c.allowGeometryUpdates||this.adminEditingInfo.allowAddOnly||this.adminEditingInfo.fullFeatureEditing):(d.capabilities=c.capabilities,d.properties.allowGeometryUpdates=c.allowGeometryUpdates||this.adminEditingInfo.allowAddOnly||this.adminEditingInfo.fullFeatureEditing);var f;f=this._isSDSFeatureService?{updateDefinition:a.json.stringify(c)}:
{token:this.adminServerToken,service:a.json.stringify(this.adminServiceInfo)};this.util.request({url:this._encodeServiceName(this.item.adminUrl)+(this._isSDSFeatureService?"/updateDefinition":"/edit"),content:f},{timeout:6E4,usePost:!0}).then(a.hitch(this,function(b){this.serviceInfo.capabilities=c.capabilities;this.serviceInfo.allowGeometryUpdates=this._isSDSFeatureService?this.adminServiceInfo.allowGeometryUpdates:d.properties.allowGeometryUpdates;for(var f=c.capabilities.split(","),g=0;g<f.length;g++)f[g]&&
(f[g]=a.trim(f[g]));-1<a.indexOf(f,"Editing")?-1<a.indexOf(f,"Create")&&-1<a.indexOf(f,"Update")&&-1<a.indexOf(f,"Delete")&&this.serviceInfo.allowGeometryUpdates?a.attr(a.byId("item-editFeatures"),"innerHTML",this.i18n.editFeaturesAll):-1<a.indexOf(f,"Update")&&!this.serviceInfo.allowGeometryUpdates?a.attr(a.byId("item-editFeatures"),"innerHTML",this.i18n.editFeaturesUpdate):-1<a.indexOf(f,"Create")&&this.serviceInfo.allowGeometryUpdates?a.attr(a.byId("item-editFeatures"),"innerHTML",this.i18n.editFeaturesAdd):
a.attr(a.byId("item-editFeatures"),"innerHTML",this.i18n.editFeaturesAll):a.attr(a.byId("item-editFeatures"),"innerHTML",this.i18n.disabledLabel);e.resolve(b)}),a.hitch(this,function(a){console.log("error updating admin service definition",a);e.resolve(a)}));return e},editFeatureService:function(b){var c={};this.adminEditingInfo.editingEnabled?this.adminEditingInfo.fullFeatureEditing?(c={hasStaticData:!1,capabilities:"Query,Editing,Create,Update,Delete"},this.adminEditingInfo.mustUpdateAllowGeometryUpdates&&
(c.allowGeometryUpdates=!0)):this.adminEditingInfo.updateAttributesOnly?(c={hasStaticData:!1,capabilities:"Query,Editing,Update"},this.adminEditingInfo.mustUpdateAllowGeometryUpdates&&(c.allowGeometryUpdates=!1)):this.adminEditingInfo.allowAddOnly&&(c={hasStaticData:!1,capabilities:"Query,Editing,Create"},this.adminEditingInfo.mustUpdateAllowGeometryUpdates&&(c.allowGeometryUpdates=!0)):c={capabilities:"Query",hasStaticData:!0};c.capabilities+=this.adminEditingInfo.syncEnabled?",Sync":"";c.capabilities+=
this.adminEditingInfo.exportEnabled?",Extract":"";var d={};d.enableEditorTracking=this.adminEditingInfo.trackingEnabled;(d.enableOwnershipAccessControl=this.adminEditingInfo.ownershipAccessControlEnabled)?(d.allowOthersToUpdate=!1,d.allowOthersToDelete=!1,d.allowOthersToQuery=d.enableEditorTracking&&!this.enableViewEdits.get("checked")):(d.allowOthersToUpdate=!0,d.allowOthersToDelete=!0,d.allowOthersToQuery=!0);c.editorTrackingInfo=d;this._isPortal?this._isPortal&&-1===a.indexOf(this.item.typeKeywords,
"providerBDS")&&this._editAGSCapabilities(this.item,c).addBoth(a.hitch(this,function(a){b&&b()})):(c={updateDefinition:a.json.stringify(c)},d=this.item.url.replace("/rest/","/rest/admin/")+"/updateDefinition",this.util.request({url:this._encodeServiceName(d),content:c},{usePost:!0}).then(a.hitch(this,function(a){this.editFeatureServiceLayers(b)}),a.hitch(this,function(a){b&&b()})))},_enableSync:function(){var b;if(!1===this.enableSync.get("disabled")&&this.adminEditingInfo.syncEnabled){b={updateDefinition:a.json.stringify({syncEnabled:!0})};
var c=this.item.url.replace("/rest/","/rest/admin/")+"/updateDefinition";b=this.util.request({url:this._encodeServiceName(c),content:b},{usePost:!0})}else b=new a.Deferred,b.resolve();return b},editFeatureServiceLayers:function(b){var c=this.getEditFields(),d={usePost:!0},e=this.item.url.replace("/rest/","/rest/admin/"),f=[];a.forEach(this.adminServiceInfo.layers,a.hitch(this,function(b){var k;k={};b=e+"/"+b.id;this.adminEditingInfo.mustAddEditFieldsInfo&&this.adminEditingInfo.trackingEnabled&&(k.editFieldsInfo=
c,b+="/addToDefinition",k={addToDefinition:a.json.stringify(k)},k=this.util.request({url:b,content:k},d),f.push(k))}));(new a.DeferredList(f)).then(a.hitch(this,function(a){b&&b(a)}))},layerHasTrackingFields:function(a){for(var c=!1,d=!1,e=!1,f=!1,h=0;h<a.fields.length;h++){var k=a.fields[h];k.name&&k.type&&("creator"===k.name.toLowerCase()&&"esriFieldTypeString"===k.type&&(c=!0),"creationdate"===k.name.toLowerCase()&&"esriFieldTypeDate"===k.type&&(d=!0),"editor"===k.name.toLowerCase()&&"esriFieldTypeString"===
k.type&&(e=!0),"editdate"===k.name.toLowerCase()&&"esriFieldTypeDate"===k.type&&(f=!0))}return c&&d&&e&&f},getEditFields:function(){return{creationDateField:"",creatorField:"",editDateField:"",editorField:""}},getTrackingFields:function(){return[{name:"Creator",type:"esriFieldTypeString",alias:"Creator",sqlType:"sqlTypeOther",length:50,nullable:!0,editable:!1,domain:null},{name:"CreationDate",type:"esriFieldTypeDate",alias:"CreationDate",sqlType:"sqlTypeOther",length:8,nullable:!0,editable:!1,domain:null},
{name:"Editor",type:"esriFieldTypeString",alias:"Editor",sqlType:"sqlTypeOther",length:50,nullable:!0,editable:!0,domain:null},{name:"EditDate",type:"esriFieldTypeDate",alias:"EditDate",sqlType:"sqlTypeOther",length:8,nullable:!0,editable:!1,domain:null}]},mustUpdateTileService:function(){var a=!1;if((this.util.isHostedServiceItem(this.item)||this._isPortal)&&"Map Service"===this.item.type&&this.serviceInfo&&this._currentTileStatus&&(this._isPortal||this.serviceDefinitionID)&&!this._isTilePackage(this.serviceDefinitionType)){var c=
this.getSelectedMinScale(),d=this.getSelectedMaxScale();if(c!==this._currentTileStatus.minScale||d!==this._currentTileStatus.maxScale)a=!0}if((this.util.isHostedServiceItem(this.item)||this._isPortal)&&"Map Service"===this.item.type&&this.serviceInfo&&this._currentTileStatus&&(this._isPortal||this.serviceDefinitionID))if(f.byId("item-exportTiles-enable").get("checked")!==(this._currentTileStatus.exportTilesAllowed||this._isPortal&&"true"===this._currentTileStatus.properties.exportTilesAllowed))a=
!0;return a},editTileService:function(){var b=this.getSelectedMinScale(),c=this.getSelectedMaxScale(),d=this._isPortal?this.item.adminUrl+"/edit":this.item.url.replace("/rest/","/rest/admin/")+"/edit",e=f.byId("item-exportTiles-enable").get("checked");if(this._isPortal)return this._currentTileStatus.minScale=""+b,this._currentTileStatus.maxScale=""+c,this._currentTileStatus.properties.minScale=""+b,this._currentTileStatus.properties.maxScale=""+c,e?(this._currentTileStatus.properties.exportTilesAllowed=
e,this._currentTileStatus.properties.maxExportTilesCount=1E5):this._currentTileStatus.properties.exportTilesAllowed=!1,esri.request({url:d,content:{f:"json",token:this.adminServerToken,service:a.toJson(this._currentTileStatus)}},{usePost:!0});b={minScale:b,maxScale:c,sourceItemId:this.serviceDefinitionID};e?(b.exportTilesAllowed=e,b.maxExportTilesCount=1E5):b.exportTilesAllowed=!1;return this.util.request({url:d,content:b},{usePost:!0})},setItemPlatform:function(b,c){for(var d=[],e=0;e<b.typeKeywords.length;e++){var f=
b.typeKeywords[e];0>a.indexOf("Ready To Use;Ready to Use;Configurable;selfConfigured;Code Sample;Windows Mobile;ArcGIS for iPhone;ArcGIS for Windows Phone;ArcGIS for Android;JavaScript;Flex;Silverlight;Web ADF;Other;Java;OS X;.NET\u2013Windows Desktop;Qt;WPF".split(";"),f)&&d.push(f)}d.push(c.api);d.push(c.purpose);"selfConfigured"===c.purpose?d.push("Configurable"):c.purpose===this.i18n.readyToUse&&(-1<a.indexOf(b.typeKeywords,"selfConfigured")&&d.push("selfConfigured"),-1<a.indexOf(b.typeKeywords,
"Configurable")&&d.push("Configurable"));return d},getItemPlatform:function(b){var c=null,d=null;0<=a.indexOf(b.typeKeywords,"Ready To Use")||0<=a.indexOf(b.typeKeywords,"Ready to Use")?c=this.i18n.readyToUse:0<=a.indexOf(b.typeKeywords,"selfConfigured")?c="selfConfigured":0<=a.indexOf(b.typeKeywords,"Configurable")?c=this.i18n.configurable:0<=a.indexOf(b.typeKeywords,"Code Sample")&&(c=this.i18n.codeSample);0<=a.indexOf(b.typeKeywords,"Windows Mobile")?d=this.i18n.mobile:0<=a.indexOf(b.typeKeywords,
"ArcGIS for iPhone")?d=this.i18n.ios:0<=a.indexOf(b.typeKeywords,"ArcGIS for Windows Phone")?d=this.i18n.windowsPhone:0<=a.indexOf(b.typeKeywords,"ArcGIS for Android")?d=this.i18n.Android:0<=a.indexOf(b.typeKeywords,"JavaScript")?d=this.i18n.JavaScript:0<=a.indexOf(b.typeKeywords,"Flex")?d=this.i18n.Flex:0<=a.indexOf(b.typeKeywords,"Silverlight")?d=this.i18n.Silverlight:0<=a.indexOf(b.typeKeywords,"Web ADF")?d=this.i18n.WebADF:0<=a.indexOf(b.typeKeywords,"Other")?d=this.i18n.other:0<=a.indexOf(this.item.typeKeywords,
"Java")?d="Java":0<=a.indexOf(this.item.typeKeywords,"Qt")?d="Qt":0<=a.indexOf(this.item.typeKeywords,".NET\u2013Windows Desktop")?d=".NET\u2013Windows Desktop":0<=a.indexOf(this.item.typeKeywords,"WPF")?d="WPF":0<=a.indexOf(this.item.typeKeywords,"OS X")&&(d="OS X");return{purpose:c,api:d}},editItem:function(b){a.style(a.byId("item-owner-toolbar"),"display","none");a.style(a.byId("item-metadata-button-span"),"display","none");esri.hide(this._commentsSection);a.style(this._favoritesNode,{display:"none"});
a.query(".hostedTilesCol").style("width","98px");a.query(".hostedFeaturesCol").style("width","98px");this.item&&"Web Map"===this.item.type&&this._createFieldsGrid();!f.byId("item-description-edit")&&9>a.isIE?(a.style(a.byId("item-wait-toolbar"),"display","block"),setTimeout(a.hitch(this,"editItemPart2"),100)):this.editItemPart2()},editItemPart2:function(){this._tags.set("tags",this.item.tags);a.byId("item-thumbnail-a")&&(a.removeAttr("item-thumbnail-a","href"),a.removeAttr("item-thumbnail-a","title"),
a.removeAttr("item-thumbnail-a","alt"),a.removeAttr("item-thumbnail-a","target"));this._cleanUpThumbnailClickConnect();a.style(a.byId("item-extent-button-div1"),"display","block");a.style(a.byId("item-extent-button-div2"),"display","block");f.byId("item-title-edit-input").set("value",this.item.title);a.style(a.byId("item-thumbnail-text"),"display","block");if(a.byId("item-thumbnail-a")){if(-1<a.byId("item-thumbnail-a").innerHTML.indexOf("transparent.gif")){var b=this.item.type.toLowerCase()||"";if(this.util.isHostedServiceItem(this.item)||
!("map service"==b||"image service"==b||"feature service"==b))a.byId("item-thumbnail-a").innerHTML="\x3cimg src\x3d'"+this.util.relativeToExplicitUrl("images/item-thumbnail.png")+"' alt\x3d'Thumbnail' width\x3d'200' height\x3d'133'/\x3e"}this._thumbEditOnClickConnect=a.connect(a.byId("item-thumbnail-a"),"onclick",this,"editItemThumbnail")}var c=f.byId("item-description-edit");if(null==c){b=a.doc.createElement("div");b.style.width="99%";a.byId("item-description-edit-div").appendChild(b);c=new f.Editor({id:"item-description-edit",
plugins:["bold","italic","underline","foreColor","hiliteColor","|","justifyLeft","justifyCenter","justifyRight","justifyFull","|","insertOrderedList","insertUnorderedList","indent","outdent","|","createEsriLink","unlink","insertImage","removeFormat","|","undo","redo","|","viewsource",{name:"dijit._editor.plugins.FontChoice",command:"fontName",custom:"Arial;Courier New;Garamond;Tahoma;Times New Roman;Verdana".split(";")},{name:"dijit._editor.plugins.FontChoice",command:"fontSize",custom:["2","3","4",
"5","6"]}],style:"border: 1px solid #CCCCCC !important; font-family:Verdana; font-size:13px;",height:"300px"},b);c.startup();this._applyEditorFixes(c);a.style(a.byId("item-description-edit-div"),"display","block");b=a.byId("item-description-span").innerHTML;if(9==a.isIE)for(;-1<b.toLowerCase().indexOf("\x3cspan\x3e\x3c/span\x3e");)b=b.replace(/<span><\/span>/gi,"");c.set("value",b);setTimeout(a.hitch(this,"saveOrigDescription"),1500)}else a.style(a.byId("item-description-edit-div"),"display","block"),
c.set("value",a.byId("item-description-span").innerHTML),this.saveOrigDescription();a.style(a.byId("item-description"),"display","none");c=f.byId("item-licenseInfo-edit");if(null==c){b=a.doc.createElement("div");b.style.width="99%";a.byId("item-licenseInfo-edit-div").appendChild(b);c=new f.Editor({id:"item-licenseInfo-edit",plugins:["bold","italic","underline","foreColor","hiliteColor","|","justifyLeft","justifyCenter","justifyRight","justifyFull","|","insertOrderedList","insertUnorderedList","indent",
"outdent","createEsriLink","unlink","insertImage","removeFormat","|","undo","redo","|","viewsource",{name:"dijit._editor.plugins.FontChoice",command:"fontName",custom:"Arial;Courier New;Garamond;Tahoma;Times New Roman;Verdana".split(";")},{name:"dijit._editor.plugins.FontChoice",command:"fontSize",custom:["2","3","4","5","6"]}],style:"border: 1px solid #CCCCCC !important; font-family:Verdana; font-size:13px;",height:"140px"},b);c.startup();this._applyEditorFixes(c);a.style(a.byId("item-licenseInfo-edit-div"),
"display","block");setTimeout(a.hitch(this,"saveOrigLicenseInfo"),1500);b=a.byId("item-licenseInfo-span")?a.byId("item-licenseInfo-span").innerHTML:"";if(9==a.isIE&&b)for(;-1<b.toLowerCase().indexOf("\x3cspan\x3e\x3c/span\x3e");)b=b.replace(/<span><\/span>/gi,"");c.set("value",b)}else a.style(a.byId("item-licenseInfo-edit-div"),"display","block"),c.set("value",a.byId("item-licenseInfo-span")?a.byId("item-licenseInfo-span").innerHTML:""),this.saveOrigLicenseInfo();a.style(this._itemAccessSection,"display",
"");if("Web Mapping Application"===this.item.type||"Mobile Application"===this.item.type||"Desktop Application"===this.item.type)b=this.getItemPlatform(this.item),this._appPurposeSelect.set("disabled",!1),null!==b.purpose&&this._appPurposeSelect.set("value",b.purpose),"Mobile Application"===this.item.type?(this._mobileAppApiSelect.set("value",b.api),this._mobileAppApiSelect.set("disabled",!1),a.style(this._mobileAppApiSelect.domNode,"display","")):"Desktop Application"===this.item.type?(this._platformAppApiSelect.set("value",
b.api||"ArcGIS for iPhone"),this._platformAppApiSelect.set("disabled",!1),a.style(this._platformAppApiSelect.domNode,"display",""),a.attr(this._apiEditLabel,"innerHTML",this.i18n.platform||"Java")):(this._webAppApiSelect.set("value",b.api||"Other"),this._webAppApiSelect.set("disabled",!1),a.style(this._webAppApiSelect.domNode,"display",""));this._currentTileStatus&&this._currentTileScales&&this.setTileRanges();!this._isPortal&&this.adminServiceInfo?this.setEditingSettings():this._isPortal&&(this.adminServiceInfo&&
this.serviceInfo)&&this.setAGSEditingSettings();if(this.util.isArcGISServer(this.item&&(this.item.sourceUrl||this.item.url)))this._serviceInfoPane=this._serviceInfoPane||new arcgisonline.sharing.dijit.ServiceInfo({},this._serviceInfoPaneDiv),a.query(".esriUsernameLbl",this._serviceInfoPane.domNode).attr("innerHTML",this.i18n.username),a.query(".esriPasswordLbl",this._serviceInfoPane.domNode).attr("innerHTML",this.i18n.password),-1!==a.indexOf(this.item.typeKeywords,"Service Proxy")&&esri.show(this._serviceInfoPane.domNode);
this._showServiceEditFields(!0);"Web Mapping Application"===this.item.type&&-1<a.indexOf(this.item.typeKeywords,"Configurable")&&a.style(a.byId("item-configuration"),"display","block");f.byId("item-summary-edit-input").set("value",null!==this.item.snippet&&0<this.item.snippet.length?this.item.snippet:this._helperSummary);f.byId("item-url-edit-input").set("value",this.item.originalUrl||this.item.url);f.byId("item-copyright-edit-input").set("value",this.item.accessInformation);a.style(a.byId("item-wait-toolbar"),
"display","none");a.style(a.byId("item-edit-toolbar"),"display","block");a.style(a.byId("item-save-buttons"),"display","block");f.byId("item-title-edit-input").set("tabIndex",1);f.byId("item-summary-edit-input").set("tabIndex",2);a.attr(f.byId("item-description-edit"),"tabIndex",3);a.attr(f.byId("item-licenseInfo-edit"),"tabIndex",4);this._tags.set("tabIndex",5);f.byId("item-copyright-edit-input").set("tabIndex",6);f.byId("item-extent-button2").set("tabIndex",7);a.query(".readOnly",this.domNode).style("display",
"none");a.query(".editOnly",this.domNode).style("display","");this._currentTileStatus&&this._currentTileScales&&this.checkTileServiceDefinitionType();a.byId("item-title-edit-input").focus();a.style(this.scaleNote,"display","none")},onEnableTrackingChange:function(a){this.enableTracking.get("checked")?(this.enableRestrictedEdits.set("disabled",!1),this.enableViewEdits.set("disabled",!1)):(this.enableRestrictedEdits.set("checked",!1),this.enableRestrictedEdits.set("disabled",!0),this.enableViewEdits.set("checked",
!1),this.enableViewEdits.set("disabled",!0))},onRestrictedEditChange:function(a){a=a&&a.target&&a.target.id||"item-restrict-edits";var c="item-restrict-edits"===a;!0===f.byId(a).get("checked")&&(this.enableRestrictedEdits.set("checked",c),this.enableViewEdits.set("checked",!c))},onEnableEditingChange:function(){var a=this.enableEditing.get("checked");this.enableGeometryUpdate.set("disabled",!a);this.disableGeometryUpdate.set("disabled",!a);this.allowAddOnly.set("disabled",!a)},setAGSEditingSettings:function(){if(this.adminServiceInfo&&
this.serviceInfo){var b=this._isSDSFeatureService?this.adminServiceInfo.capabilities.split(","):this.serviceInfo.capabilities.split(","),c,d,e;for(e=0;e<b.length;e++)b[e]&&(b[e]=a.trim(b[e]));this.adminEditingInfo={};-1<a.indexOf(b,"Editing")?(this.enableEditing.set("checked",!0),this.adminEditingInfo.editingEnabled=!0,-1<a.indexOf(b,"Create")&&-1<a.indexOf(b,"Update")&&-1<a.indexOf(b,"Delete")&&this.serviceInfo.allowGeometryUpdates?(this.enableGeometryUpdate.set("checked",!0),this.adminEditingInfo.fullFeatureEditing=
!0,this.adminEditingInfo.updateAttributesOnly=!1,this.adminEditingInfo.allowAddOnly=!1):a.indexOf(b,"Update")&&!this.serviceInfo.allowGeometryUpdates?(this.disableGeometryUpdate.set("checked",!0),this.adminEditingInfo.fullFeatureEditing=!1,this.adminEditingInfo.updateAttributesOnly=!0,this.adminEditingInfo.allowAddOnly=!1):-1<a.indexOf(b,"Create")&&this.serviceInfo.allowGeometryUpdates?(this.allowAddOnly.set("checked",!0),this.adminEditingInfo.fullFeatureEditing=!1,this.adminEditingInfo.updateAttributesOnly=
!1,this.adminEditingInfo.allowAddOnly=!0):(this.enableGeometryUpdate.set("checked",!0),this.adminEditingInfo.fullFeatureEditing=!0,this.adminEditingInfo.updateAttributesOnly=!1,this.adminEditingInfo.allowAddOnly=!1)):(this.adminEditingInfo.editingEnabled=!1,this.adminServiceInfo.allowGeometryUpdates?this.enableGeometryUpdate.set("checked",!0):this.disableGeometryUpdate.set("checked",!0),this.enableEditing.set("checked",!1));this.serviceInfo.syncEnabled||-1<a.indexOf(b,"Sync")?this.enableSync.set("checked",
!0):this.enableSync.set("checked",!1);-1<a.indexOf(b,"Extract")?this.enableExport.set("checked",!0):this.enableExport.set("checked",!1);if(this._isSDSFeatureService)if(this.adminServiceInfo.editorTrackingInfo){if(b=this.adminServiceInfo.editorTrackingInfo)c=b.enableOwnershipAccessControl&&!b.allowOthersToUpdate&&!b.allowOthersToDelete&&b.allowOthersToQuery,d=b.enableOwnershipAccessControl&&!b.allowOthersToUpdate&&!b.allowOthersToDelete&&!b.allowOthersToQuery,this.enableRestrictedEdits.set("checked",
c),this.enableViewEdits.set("checked",b.enableEditorTracking&&d),this.adminEditingInfo.ownershipAccessControlEnabled=c||d,b.enableEditorTracking?(this.adminEditingInfo.trackingEnabled=!0,this.enableTracking.set("checked",!0),this.enableRestrictedEdits.set("disabled",!1),this.enableViewEdits.set("disabled",!1)):(this.adminEditingInfo.trackingEnabled=!1,this.enableTracking.set("checked",!1),this.enableRestrictedEdits.set("disabled",!0),this.enableViewEdits.set("disabled",!0))}else this.adminEditingInfo.trackingEnabled=
!1,this.enableTracking.set("checked",!1),this.enableRestrictedEdits.set("disabled",!0),this.enableViewEdits.set("disabled",!0);else for(e=0;e<this.adminServiceInfo.extensions.length;e++)if(b=this.adminServiceInfo.extensions[e],"FeatureServer"===b.typeName)if(b.editorTrackingInfo){if(b=b.editorTrackingInfo)c=b.enableOwnershipAccessControl&&!b.allowOthersToUpdate&&!b.allowOthersToDelete&&b.allowOthersToQuery,d=b.enableOwnershipAccessControl&&!b.allowOthersToUpdate&&!b.allowOthersToDelete&&!b.allowOthersToQuery,
this.enableRestrictedEdits.set("checked",c),this.enableViewEdits.set("checked",b.enableEditorTracking&&d),this.adminEditingInfo.ownershipAccessControlEnabled=c||d,b.enableEditorTracking?(this.adminEditingInfo.trackingEnabled=!0,this.enableTracking.set("checked",!0),this.enableRestrictedEdits.set("disabled",!1),this.enableViewEdits.set("disabled",!1)):(this.adminEditingInfo.trackingEnabled=!1,this.enableTracking.set("checked",!1),this.enableRestrictedEdits.set("disabled",!0),this.enableViewEdits.set("disabled",
!0))}else this.adminEditingInfo.trackingEnabled=!1,this.enableTracking.set("checked",!1),this.enableRestrictedEdits.set("disabled",!0),this.enableViewEdits.set("disabled",!0)}else this.adminEditingInfo={}},setEditingSettings:function(){if(this.adminServiceInfo){var b=this.adminServiceInfo.capabilities.split(","),c;for(c=0;c<b.length;c++)b[c]&&(b[c]=a.trim(b[c]));this.adminEditingInfo={};var d=!1;for(c=0;c<this.adminServiceInfo.layers.length;c++)!1===this.adminServiceInfo.layers[c].allowGeometryUpdates&&
(d=!0);-1<a.indexOf(b,"Editing")?(this.enableEditing.set("checked",!0),this.adminEditingInfo.editingEnabled=!0,-1<a.indexOf(b,"Create")&&-1<a.indexOf(b,"Update")&&-1<a.indexOf(b,"Delete")&&this.adminServiceInfo.allowGeometryUpdates&&!d?(this.enableGeometryUpdate.set("checked",!0),this.adminEditingInfo.fullFeatureEditing=!0,this.adminEditingInfo.updateAttributesOnly=!1,this.adminEditingInfo.allowAddOnly=!1):a.indexOf(b,"Update")&&!this.adminServiceInfo.allowGeometryUpdates&&d?(this.disableGeometryUpdate.set("checked",
!0),this.adminEditingInfo.fullFeatureEditing=!1,this.adminEditingInfo.updateAttributesOnly=!0,this.adminEditingInfo.allowAddOnly=!1):-1<a.indexOf(b,"Create")&&this.adminServiceInfo.allowGeometryUpdates?(this.allowAddOnly.set("checked",!0),this.adminEditingInfo.fullFeatureEditing=!1,this.adminEditingInfo.updateAttributesOnly=!1,this.adminEditingInfo.allowAddOnly=!0):(this.enableGeometryUpdate.set("checked",!0),this.adminEditingInfo.fullFeatureEditing=!0,this.adminEditingInfo.updateAttributesOnly=!1,
this.adminEditingInfo.allowAddOnly=!1)):(this.adminEditingInfo.editingEnabled=!1,!this.adminServiceInfo.allowGeometryUpdates&&d?this.disableGeometryUpdate.set("checked",!0):this.enableGeometryUpdate.set("checked",!0),this.enableEditing.set("checked",!1));this.adminServiceInfo.syncEnabled?(this.enableSync.set("checked",!0),this.enableSync.set("disabled",!0)):this.enableSync.set("checked",!1);-1<a.indexOf(b,"Extract")?this.enableExport.set("checked",!0):this.enableExport.set("checked",!1);if(this.adminServiceInfo.editorTrackingInfo){if(b=
this.adminServiceInfo.editorTrackingInfo)c=b.enableOwnershipAccessControl&&!b.allowOthersToUpdate&&!b.allowOthersToDelete&&b.allowOthersToQuery,d=b.enableOwnershipAccessControl&&!b.allowOthersToUpdate&&!b.allowOthersToDelete&&!b.allowOthersToQuery,this.enableRestrictedEdits.set("checked",c),this.enableViewEdits.set("checked",b.enableEditorTracking&&d),this.adminEditingInfo.ownershipAccessControlEnabled=c||d,b.enableEditorTracking?(this.adminEditingInfo.trackingEnabled=!0,this.enableTracking.set("checked",
!0),this.enableRestrictedEdits.set("disabled",!1),this.enableViewEdits.set("disabled",!1)):(this.adminEditingInfo.trackingEnabled=!1,this.enableTracking.set("checked",!1),this.enableRestrictedEdits.set("disabled",!0),this.enableViewEdits.set("disabled",!0))}else this.adminEditingInfo.trackingEnabled=!1,this.enableTracking.set("checked",!1),this.enableRestrictedEdits.set("disabled",!0),this.enableViewEdits.set("disabled",!0)}else this.adminEditingInfo={}},setTileRanges:function(){this.fromScaleRange.set("store",
new a.data.ItemFileReadStore({data:this.getMinTileRangeData()}));this.toScaleRange.set("store",new a.data.ItemFileReadStore({data:this.getMaxTileRangeData()}));var b="1:"+a.number.format(Math.round(this._currentTileStatus.minScale),{pattern:"#,###,###,##0"}),c="1:"+a.number.format(Math.round(this._currentTileStatus.maxScale),{pattern:"#,###,###,##0"});this.fromScaleRange.set("value",b);this.toScaleRange.set("value",c);a.connect(this.fromScaleRange,"onChange",a.hitch(this,function(b){this.fromScaleRange.item&&
(1===this.fromScaleRange.item.name.length?this.fromScaleRange.item.scale[0]>this._currentTileStatus.minScale?a.style(this.scaleNote,"display","inline"):a.style(this.scaleNote,"display","none"):this.fromScaleRange.item.scale>this._currentTileStatus.minScale?a.style(this.scaleNote,"display","inline"):a.style(this.scaleNote,"display","none"))}));a.connect(this.toScaleRange,"onChange",a.hitch(this,function(b){this.toScaleRange.item&&(1===this.toScaleRange.item.name.length?this.toScaleRange.item.scale[0]<
this._currentTileStatus.maxScale?a.style(this.scaleNote,"display","inline"):a.style(this.scaleNote,"display","none"):this.toScaleRange.item.scale<this._currentTileStatus.maxScale?a.style(this.scaleNote,"display","inline"):a.style(this.scaleNote,"display","none"))}))},getServiceDefinitionID:function(){var b=new a.Deferred;this.serviceDefinitionID?b.resolve():this._getRelatedItems("Service2Data","forward").then(a.hitch(this,function(c){c&&0<c.length?(this.serviceDefinitionID=c[0].id,this.serviceDefinitionType=
c[0].type,b.resolve()):this._getRelatedItems("Service2Service","reverse").then(a.hitch(this,function(a){a&&0<a.length&&(this.serviceDefinitionID=a[0].id,this.serviceDefinitionType=a[0].type);b.resolve()}),a.hitch(this,function(a){b.resolve()}))}),a.hitch(this,function(a){b.resolve()}));return b},checkTileServiceDefinitionType:function(){if(!esri.isDefined(this.serviceDefinitionID)||this._isTilePackage(this.serviceDefinitionType))a.style(a.byId("item-scaleRangeEdit"),"display","none"),a.style(a.byId("item-scaleRange"),
"display","")},_isTilePackage:function(a){return esri.isDefined(a)&&("Tile Package"===a||"Vector Tile Package"===a)},getMaxTileRangeData:function(){var b=this._currentTileStatus.minScale,c;for(c=this._currentTileScales.length-1;-1<c;c--)if(0<this._currentTileScales[c].created){b=this._currentTileScales[c].scale;break}var d=[];for(c=this.serviceInfo.tileInfo.lods.length-1;-1<c;c--){var e=this.serviceInfo.tileInfo.lods[c];if(e.scale<=b)d.push({id:e.level,scale:e.scale,name:"1:"+a.number.format(Math.round(e.scale),
{pattern:"#,###,###,##0"})});else break}return{identifier:"id",label:"name",items:d}},getMinTileRangeData:function(){var b=this._currentTileStatus.maxScale,c;for(c=0;c<this._currentTileScales.length;c++)if(0<this._currentTileScales[c].created){b=this._currentTileScales[c].scale;break}var d=[];for(c=0;c<this.serviceInfo.tileInfo.lods.length;c++){var e=this.serviceInfo.tileInfo.lods[c];if(e.scale>=b)d.push({id:e.level,scale:e.scale,name:"1:"+a.number.format(Math.round(e.scale),{pattern:"#,###,###,##0"})});
else break}return{identifier:"id",label:"name",items:d}},saveOrigDescription:function(a){this.origDescription=f.byId("item-description-edit").getValue()},saveOrigLicenseInfo:function(a){this.origLicenseInfo=f.byId("item-licenseInfo-edit").getValue()},cancelEditItem:function(b){this._isPortal&&(this.serverToken&&this.adminServerToken)&&(this.adminServerToken=this.serverToken=null);a.style(a.byId("item-thumbnail-text"),"display","none");a.byId("item-thumbnail-a")&&(-1<a.byId("item-thumbnail-a").innerHTML.indexOf("item-thumbnail.png")?
a.byId("item-thumbnail").innerHTML='\x3ca id\x3d"item-thumbnail-a"\x3e\x3cimg src\x3d\''+this.util.relativeToExplicitUrl("images/transparent.gif")+"' alt\x3d'Thumbnail' width\x3d'200' height\x3d'133'/\x3e\x3c/a\x3e":this.getThumbnail());a.byId("item-thumbnail-a")&&(this._cleanUpThumbnailClickConnect(),b=this.util.getGalleryMainLinkInfo(this.item),a.attr("item-thumbnail-a",{href:b.href,title:b.tip,alt:b.tip,target:b.target}),b.onclick&&(this._thumbOnClickConnect=a.connect(a.byId("item-thumbnail-a"),
"onclick",b.onclick)));a.style(a.byId("item-save-buttons"),"display","none");a.style(a.byId("item-extent-button-div1"),"display","none");a.style(a.byId("item-extent-button-div2"),"display","none");(b=this.item.extent)&&2==b.length&&2==b[0].length&&2==b[1].length?(a.byId("item-extent-top").innerHTML=Math.round(100*b[1][1])/100,a.byId("item-extent-left").innerHTML=Math.round(100*b[0][0])/100,a.byId("item-extent-right").innerHTML=Math.round(100*b[1][0])/100,a.byId("item-extent-bottom").innerHTML=Math.round(100*
b[0][1])/100,a.style(a.byId("item-description-extent-unavailable"),"display","none"),a.style(a.byId("item-description-extent-available"),"display","block")):(a.byId("item-extent-top").innerHTML="",a.byId("item-extent-left").innerHTML="",a.byId("item-extent-right").innerHTML="",a.byId("item-extent-bottom").innerHTML="",this.newExtent=null,a.style(a.byId("item-description-extent-unavailable"),"display","block"),a.style(a.byId("item-description-extent-available"),"display","none"));f.byId("item-description-edit").set("value",
a.byId("item-description-span").innerHTML);f.byId("item-licenseInfo-edit").set("value",a.byId("item-licenseInfo-span")?a.byId("item-licenseInfo-span").innerHTML:"");f.byId("item-delete-protection-edit-input").set("checked",this.item["protected"]);a.query(".hostedTilesCol").style("width","140px");a.query(".hostedFeaturesCol").style("width","140px");this._showServiceEditFields(!1);a.query(".editOnly",this.domNode).style("display","none");a.query(".readOnly",this.domNode).style("display","");a.query(".registerSection").forEach(esri.hide);
esri.show(this._commentsSection);esri.hide(a.byId("item-configuration"));this._showMetadataUI();this._showRegisterSection();this._showMarketplaceSection();this._showAdvancedSection();this._showFavoritesButton();this._setCustomRoleButtonVisibility();(this.util.isProApp(this.item)||"Native Application Installer"===this.item.type)&&a.style(f.byId("item-share-button").domNode,"display","none")},itemPropertiesChanged:function(){if("block"==a.byId("item-edit-toolbar").style.display){if(f.byId("item-title-edit-input").getValue()!=
this.item.title||this._tags.get("tags")!=this.item.tags||null!=f.byId("item-description-edit")&&this.origDescription!=f.byId("item-description-edit").getValue()||null!=f.byId("item-licenseInfo-edit")&&this.origLicenseInfo!=f.byId("item-licenseInfo-edit").getValue())return!0;var b="";this.item.snippet&&"null"!=this.item.snippet&&(b=this.item.snippet);if(b!=f.byId("item-summary-edit-input").getValue())return!0;b="";this.item.accessInformation&&"null"!=this.item.accessInformation&&(b=this.item.accessInformation);
if(b!=f.byId("item-copyright-edit-input").getValue()||""!==a.byId("item-thumbnail-file").value)return!0}return!1},onPageUnload:function(){if(this.firstPageUnloadCall&&(this.firstPageUnloadCall=!1,setTimeout(a.hitch(this,"resetFirstPageUnloadCall"),1500),this.itemPropertiesChanged()))return"If you exit this page without saving your edits your edits will be lost."},resetFirstPageUnloadCall:function(a){this.firstPageUnloadCall=!0},setThumbnailURLForService:function(){var b=this.item.extent,c="",c=b&&
2==b.length&&2==b[0].length&&2==b[1].length?Math.round(1E3*b[0][0])/1E3+","+Math.round(1E3*b[0][1])/1E3+","+Math.round(1E3*b[1][0])/1E3+","+Math.round(1E3*b[1][1])/1E3:"-180,-90,180,90",b=this.item.type?this.item.type.toLowerCase():"";if("image service"==b)if(null==this.serviceInfo){var b=a.hitch(this,function(a,b){this.serviceInfo=a;var d=arcgisonline.map.main.buildExportCall(this.item.url,c,"4326",null,"200,133",null,"image",null,this.serviceInfo);f.byId("item-form-thumbnailURL").set("value",d)}),
d=a.hitch(this,function(a,b){var d=arcgisonline.map.main.buildExportCall(this.item.url,c,"4326",null,"200,133",null,"image",null,NULL);f.byId("item-form-thumbnailURL").set("value",d)});arcgisonline.sharing.util.getJson(this.item.url,b,d)}else b=arcgisonline.map.main.buildExportCall(this.item.url,c,"4326",null,"200,133",null,"image",null,this.serviceInfo),f.byId("item-form-thumbnailURL").set("value",b);else"feature service"!=b&&(b=arcgisonline.map.main.buildExportCall(this.item.url,c,"4326",null,"200,133",
null,"image",null,null),f.byId("item-form-thumbnailURL").set("value",b))},setThumbnailURLForWebMap:function(b){var c=function(c,g){this.getDataContent=c;arcgisonline.map.thumbnail.buildThumbnailURLFromWebMap(a.clone(c),this.item.extent,function(a){f.byId("item-form-thumbnailURL").set("value",a);b()},d)},d=function(a,c){f.byId("item-form-thumbnailURL").set("value","");b()};this.getDataContent?a.hitch(this,c,this.getDataContent)():arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"content/items/"+
this.item.id+"/data",a.hitch(this,c),a.hitch(this,d))},shareItem:function(a){a=arcgisonline.sharing.dijit.dialog.SharingDlg.prototype.statics.getInstance();var c=[this.item];(this.isAdmin||this._roleCanUpdateItems&&this._roleCanShare)&&this.itemUser?a.showAdmin(c,this.userGroups,this.itemUser,this.adminGroups):this.currentUser&&this.item.owner===this.currentUser.email?a.show(c,this.userGroups,null):this.currentUser&&("public"===this.item.access||"shared"===this.item.access||"org"===this.item.access&&
this.currentUser.accountId)?a.showGroups(c,this.userGroups):a.show(c,this.userGroups,null)},reassignItem:function(b){arcgisonline.sharing.dijit.dialog.AccountMoveToDlg.prototype.statics.getInstance().show(this.itemUser?this.itemUser:this.currentUser,[this.item],null===this.item.folderId?null:this.item.folderTitle,a.hitch(this,this.reloadPage),a.hitch(this,function(b){b=b&&b.messageCode&&this.i18n.errors[b.messageCode]?{message:this.i18n.errors[b.messageCode]}:b;this._showError(a.mixin(this.i18n.errors.genericError,
b.message?b:{}))}))},reloadPage:function(){window.location="item.html?id\x3d"+this.item.id},deleteItem:function(b){arcgisonline.sharing.dijit.dialog.DeleteWarningDlg.prototype.statics.getInstance().show(1,this.i18n.item,a.hitch(this,"reallyDeleteItem"))},reallyDeleteItem:function(a){if(this.isAdmin||this._roleCanDeleteItems&&this.currentUser.email!==this.item.owner){var c=this.item.owner;this.content.deleteItemByUser(this.item,function(){window.location="content.html?user\x3d"+c})}else this.content.deleteItem(this.item,
function(){window.location="content.html"})},moveItem:function(b){var c=a.hitch(this,function(a,c){this.util.getUser();null==b.id?(this.item.folderTitle="/",this.item.folderId=null):(this.item.folderTitle=b.title,this.item.folderId=b.id);this.updateMoveToMenu()}),d=a.hitch(this,function(a,b){var c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();a.message&&-1<a.message.indexOf("already exists")?c.show({title:this.i18n.error.error,message:this.i18n.error.cantMoveItemExists}):
(c.show({title:this.i18n.error.error,message:this.i18n.error.cantMoveItem}),console.log(a.message))}),e={folder:b.id};null==b.id&&(e={folder:"/"});this.isAdmin||this._roleCanReassignItems&&this.currentUser.email!==this.item.owner?this.content.moveItemByUser(this.item,e,c,d):this.content.moveItem(this.item,e,c,d)},initializeMetadata:function(){this._metadata||(this._metadata={isLoading:!1});a.style(a.byId("item-metadata-button-span"),"display","")},loadMetadata:function(b){this._metadata?-1<a.indexOf(this.item.typeKeywords,
"Metadata")?this.openMetadataMenu(b):this.loadMetadataEditor():this.viewMetadata()},loadMetadataEditor:function(){this._metadata&&!this._metadata.isLoading&&(this._metadata.isLoading=!0,window.require(["arcgisonline/metadata"],a.hitch(this,function(){window.require("esri/dijit/metadata/context/GxeContext esri/dijit/metadata/arcgis/portal/PortalItemContext esri/dijit/metadata/arcgis/portal/PortalItemAdaptor esri/dijit/metadata/editor/EditorDialog esri/dijit/metadata/editor/Editor dojo/domReady!".split(" "),
a.hitch(this,function(b,c,d,e){if(!this._metadata.gxeContext){var f=this.i18n.metadataISO1913932,h,k={};this._metadataFormats&&0<this._metadataFormats.length&&(h=this._metadataFormats[0],h===this.formatFGDC?f=this.i18n.metadataFGDC:h===this.formatINSPIRE?f=this.i18n.metadataINSPIRE:h===this.formatISO19139?f=this.i18n.metadataISO19139:h===this.formatISO19115&&(f=this.i18n.metadataISO19115));k.allowedTypeKeys=["arcgis"];k.defaultArcGISStyle=f;esriGeowConfig.extentService?k.basemapUrl=esriGeowConfig.extentService:
k.basemap="hybrid";this._configureGeocoders(k);this._metadata.gxeContext=new b(k)}this._metadata.portalItemContext||(this._metadata.portalItemContext=new c({isForPortalItemPage:!0,allowEditMetadata:!0,allowPushToItem:!0,autoPullItem:!0,portalItem:this.item,portal:esriGeowConfig.self,restBaseUrl:esriGeowConfig.restBaseUrl,token:this.util.getToken(),originalXml:null}));this._metadata.portalItemAdaptor||(this._metadata.portalItemAdaptor=new d({portalItemContext:this._metadata.portalItemContext}),this._metadata.adaptorChangeHandle||
(this._metadata.adaptorChangeHandle=a.hitch(this,function(){setTimeout(a.hitch(this,function(){this.fillItemInfo()}),500)})),this._metadata.adaptorSaveHandle||(this._metadata.adaptorSaveHandle=this._metadata.portalItemAdaptor.on("metadata-save",this._metadata.adaptorChangeHandle)),this._metadata.adaptorDeleteHandle||(this._metadata.adaptorDeleteHandle=this._metadata.portalItemAdaptor.on("metadata-delete",this._metadata.adaptorChangeHandle)));this._metadata.portalItemAdaptor.readXml("text").then(a.hitch(this,
function(b){"string"!==typeof b&&(b=null);null!==b&&(b=a.trim(b),0===b.length&&(b=null));this._metadata.portalItemContext.originalXml=b;this._metadata.editor||(this._metadata.editor=new e({title:this.item.title,gxeAdaptor:this._metadata.portalItemAdaptor,gxeContext:this._metadata.gxeContext}));this._metadata.editor.show();this._metadata.isLoading=!1}))}))})))},_configureGeocoders:function(b){for(var c=esriGeowConfig.self?a.clone(esriGeowConfig.self.helperServices.geocode):[],d=0;d<c.length;d++)if(this.util.isEsriWorldGeocoder(c[d].url)){c[d].suggest=
!0;c[d].placefinding=!0;c[d].batch=!0;c[d].name=this.i18n.esriWorldGeocoder;c[d].singleLineFieldName="SingleLine";break}c=a.filter(c,function(a){return a&&a.placefinding&&a.singleLineFieldName});0<c.length&&(b.arcgisGeocoder=!1,b.geocoders=c)},_cleanUpThumbnailClickConnect:function(){this._thumbOnClickConnect&&(a.disconnect(this._thumbOnClickConnect),this._thumbOnClickConnect=null)},updateItem:function(b){b=this.item.type?this.item.type.toLowerCase():"";this.isFile(this.item.name,b,this.item.url).then(a.hitch(this,
function(a){a=arcgisonline.sharing.dijit.dialog.UpdateItemDlg.prototype.statics.getInstance();this.isAdmin||this._roleCanUpdateItems&&this.currentUser.email!==this.item.owner?a.show(this.item,this.currentUser):a.show(this.item)}))},isUpdateableService:function(b){var c=b.type,d={Shapefile:1,"File Geodatabase":1,GeoJson:1},e;if(!this._isPortal&&"Feature Service"===c)return this._getRelatedItems("Service2Data","forward").then(a.hitch(this,function(c){if(c&&c.length&&c[0].owner===this.item.owner){e=
c[0];b.relatedItem=e;if(e.type in d)return!0;if("CSV"===e.type&&-1===a.indexOf(this.item.typeKeywords,"Involved Lookup"))return this._fetchPublishParameters(b).then(a.hitch(this,function(a){return a?!0:!1}))}else return!1}));c=new a.Deferred;c.resolve(!1);return c},isFile:function(b,c,d){var e=new a.Deferred;e.resolve(esri.isDefined(b)&&("cityengine web scene"===c||"kml"===c&&esri.isDefined(d)&&-1<d.indexOf("rest/content/items/"+this.item.id+"/data")||"code attachment"===c||"operations dashboard add in"===
c||"geojson"===c||"shapefile"===c||"file geodatabase"===c||"csv"===c||"service definition"===c||"map document"===c||"map package"===c||"mobile map package"===c||"tile package"===c||"scene package"===c||"vector tile package"===c||"arcpad package"===c||"explorer map"===c||"globe document"===c||"scene document"===c||"published map"===c||"map template"===c||"windows mobile package"===c||"layer"===c||"layer package"===c||"explorer layer"===c||"geoprocessing package"===c||"geoprocessing sample"===c||"locator package"===
c||"workflow manager package"===c||"desktop application template"===c||"code sample"===c||"desktop add in"===c||"explorer add in"===c||"microsoft word"===c||"microsoft excel"===c||"iwork pages"===c||"iwork keynote"===c||"iwork numbers"===c||"pdf"===c||"image"===c||"visio document"===c||"desktop application"===c||"task file"===c||"project package"===c||"project template"===c||"basemap package"===c||"mobile basemap package"===c||"rule package"===c||"microsoft powerpoint"===c||"layout"===c||"pro map"===
c||"cad drawing"===c||"desktop style"===c||"raster function template"===c||"csv collection"===c||"native application installer"===c||"native application template"===c));return e},updateExtent:function(b){this.newExtent=b;a.byId("item-extent-top").innerHTML=a.number.format(Math.round(100*b[1][1])/100,this.numberPattern);a.byId("item-extent-left").innerHTML=a.number.format(Math.round(100*b[0][0])/100,this.numberPattern);a.byId("item-extent-right").innerHTML=a.number.format(Math.round(100*b[1][0])/100,
this.numberPattern);a.byId("item-extent-bottom").innerHTML=a.number.format(Math.round(100*b[0][1])/100,this.numberPattern);a.style(a.byId("item-description-extent-unavailable"),"display","none");a.style(a.byId("item-description-extent-available"),"display","block");b=this.item.type.toLowerCase()||"";if("map service"==b||"image service"==b||"kml"==b){if(!this.item.thumbnail||0==this.item.thumbnail.length||-1<this.item.thumbnail.indexOf("thumbnail/ago_downloaded.")||-1<this.item.thumbnail.indexOf("/arcgisoutput/")||
-1<this.item.thumbnail.indexOf("/PrintingTools_GPServer/")){var c=function(b){f.byId("item-form-thumbnailURL").set("value",b);a.byId("item-thumbnail").innerHTML='\x3ca id\x3d"item-thumbnail-a"\x3e\x3cspan style\x3d"width:200px;height:133px;background-image:url('+b+');background-repeat:no-repeat;display:inline-block;"/\x3e\x3c/a\x3e';a.byId("item-thumbnail-text").innerHTML='\x3ca href\x3d"JavaScript:void(0);" onclick\x3d"JavaScript:dijit.byId(\'item-properties\').editItemThumbnail();"\x3e'+this.i18n.clickToChangeThumbnail+
"\x3c/a\x3e";this.item.thumbnail=b;this.enableSaveButtons();if(!1===this.waitingForThumbnail){var c=esriGeowConfig.restBaseUrl+"content/users/"+item.owner,c=c+(null!=this.item.folderId?"/"+this.item.folderId:""),c=c+("/items/"+this.item.id+"/update");arcgisonline.sharing.util.postJson({thumbnailURL:b},c)}this.waitingForThumbnail=!1},d=a.hitch(this,function(){a.byId("item-thumbnail").innerHTML='\x3ca id\x3d"item-thumbnail-a"\x3e\x3cspan style\x3d"width:200px;height:133px;background-image:url('+this.util.relativeToExplicitUrl("images/transparent.gif")+
');background-repeat:no-repeat;display:inline-block;"/\x3e\x3c/a\x3e';a.byId("item-thumbnail-text").innerHTML='\x3ca href\x3d"JavaScript:void(0);" onclick\x3d"JavaScript:dijit.byId(\'item-properties\').editItemThumbnail();"\x3e'+this.i18n.clickToChangeThumbnail+"\x3c/a\x3e";this.waitingForThumbnail=!1;this.enableSaveButtons()}),e=Math.round(1E3*this.newExtent[0][0])/1E3+","+Math.round(1E3*this.newExtent[0][1])/1E3+","+Math.round(1E3*this.newExtent[1][0])/1E3+","+Math.round(1E3*this.newExtent[1][1])/
1E3;this.disableSaveButtons();if("image service"==b)if(null==this.serviceInfo){b=a.hitch(this,function(b,f){this.serviceInfo=b;var g=arcgisonline.map.main.buildExportCall(this.item.url,e,"4326",null,"200,133",null,"json",null,b);arcgisonline.sharing.util.request({url:g},{addToken:!1}).then(a.hitch(this,function(b){a.hitch(this,c,b.href)()}),d)});var g=a.hitch(this,function(b,f){var g=arcgisonline.map.main.buildExportCall(this.item.url,e,"4326",null,"200,133",null,"json",null,null);arcgisonline.sharing.util.getJson(g,
a.hitch(this,function(b){a.hitch(this,c,b.href)()}),d)});arcgisonline.sharing.util.request({url:this.item.url},{addToken:!1}).then(b,g)}else b=arcgisonline.map.main.buildExportCall(this.item.url,e,"4326",null,"200,133",null,"json",null,this.serviceInfo),arcgisonline.sharing.util.request({url:b},{addToken:!1}).then(a.hitch(this,function(b){a.hitch(this,c,b.href)()}),d);else"feature service"==b?(this.waitingForThumbnail=!0,this.enableSaveButtons(),arcgisonline.map.thumbnail.buildThumbnailURLFromFSItem(this.item,
this.newExtent).then(a.hitch(this,c),d)):"kml"==b?arcgisonline.map.thumbnail.buildThumbnailURLFromKMLItem(this.item,this.newExtent).then(a.hitch(this,c),d):(b=arcgisonline.map.main.buildExportCall(this.item.url,e,"4326",null,"200,133",null,"json",null,null),arcgisonline.sharing.util.request({url:b},{addToken:!1}).then(a.hitch(this,function(b){a.hitch(this,c,b.href)()}),d))}}else if("web map"==b&&(!this.item.thumbnail||0===this.item.thumbnail.length||-1<this.item.thumbnail.indexOf("thumbnail/ago_downloaded.")))a.byId("item-thumbnail").innerHTML=
'\x3ca id\x3d"item-thumbnail-a" onclick\x3d"JavaScript:dijit.byId(\'item-properties\').editItemThumbnail();"\x3e\x3cimg src\x3d\''+this.util.relativeToExplicitUrl("images/item-thumbnail-update.png")+"' alt\x3d'Thumbnail' width\x3d'200' height\x3d'133'/\x3e\x3c/a\x3e",a.byId("item-thumbnail-text").innerHTML='\x3ca href\x3d"JavaScript:void(0);" onclick\x3d"JavaScript:dijit.byId(\'item-properties\').editItemThumbnail();"\x3e'+this.i18n.clickToChangeThumbnail+"\x3c/a\x3e"},editExtent:function(a){a=arcgisonline.sharing.dijit.dialog.ExtentDlg.prototype.statics.getInstance();
null!=this.newExtent?a.show(this.newExtent):a.show(this.item.extent)},thumbnailCancel:function(b){a.style(a.byId("item-thumbnail-dialog"),"display","none");a.byId("item-thumbnail-dialog").innerHTML=a.byId("item-thumbnail-dialog").innerHTML;a.connect(a.byId("item-thumbnail-close"),"onclick",this,"thumbnailCancel");a.connect(a.byId("item-thumbnail-cancel"),"onclick",this,"thumbnailCancel");a.connect(a.byId("item-thumbnail-ok"),"onclick",this,"thumbnailOk")},thumbnailOk:function(b){b=a.byId("item-thumbnail-file").value;
var c=b.lastIndexOf(".");b=b.substring(c+1,b.length).toLowerCase();"png"!=b&&"gif"!=b&&"jpg"!=b&&"jpeg"!=b?arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.error.error,message:this.i18n.error.badImageType}):(""!==a.byId("item-thumbnail-file").value&&(a.byId("item-thumbnail").innerHTML='\x3ca id\x3d"item-thumbnail-a" onclick\x3d"JavaScript:dijit.byId(\'item-properties\').editItemThumbnail();"\x3e\x3cimg src\x3d\''+this.util.relativeToExplicitUrl("images/item-thumbnail-update.png")+
"' alt\x3d'Thumbnail' width\x3d'200' height\x3d'133'/\x3e\x3c/a\x3e",a.byId("item-thumbnail-text").innerHTML='\x3ca href\x3d"JavaScript:void(0);" onclick\x3d"JavaScript:dijit.byId(\'item-properties\').editItemThumbnail();"\x3e'+this.i18n.clickToChangeThumbnail+"\x3c/a\x3e",this._thumbnail=null),a.style(a.byId("item-thumbnail-dialog"),"display","none"))},_applyEditorFixes:function(b){9>a.isIE&&(b.destroy=function(){a.forEach(b._plugins,function(a){try{a&&a.destroy&&a.destroy()}catch(b){}});b._plugins=
[];b.toolbar&&(b.toolbar.destroyRecursive(),delete b.toolbar)})},_canPublish:function(){var b="CSV;Shapefile;Service Definition;Feature Collection;File Geodatabase;GeoJson".split(";"),c=["Service Definition","Tile Package"],d=["Scene Package"],e=["Vector Tile Package"],f=esri.isDefined(esriGeowConfig.self)&&!1===esriGeowConfig.self.supportsHostedServices,h=f?!1:esriGeowConfig.userRole&&this._roleCanPublishTiles,k=f?!1:esriGeowConfig.userRole&&this._roleCanPublishFeatures,f=f?!1:esriGeowConfig.userRole&&
this._roleCanPublishScenes,l=this.item.type||"unknown",m=new a.Deferred;if("Service Definition"===l&&(-1!==a.indexOf(this.item.typeKeywords,"Server")||-1!==a.indexOf(this.item.typeKeywords,"SDS"))||(("Scene Package"===l||"Vector Tile Package"===l)&&!this._isPortal&&!esriGeowConfig.publishPackagesOnline||!h)||this._isCustomRole&&this.itemUser&&(!this._roleCanUpdate||!this._roleCanCreateItem||!k&&-1!==a.indexOf(b,l)||!f&&-1!==a.indexOf(d,l)||!h&&-1!==a.indexOf(c,l)))return m.resolve(!1),m;if(k&&-1!==
a.indexOf(b,l)||f&&-1!==a.indexOf(d,l)||-1!==a.indexOf(e,l)||h&&-1!==a.indexOf(c,l))return this._checkIfPublished();m.resolve(!1);return m},_checkIfPublished:function(){var b=this.item;return this._getRelatedItems("Service2Data","reverse").then(a.hitch(this,function(a){if(a&&a.length&&(this._isPublished=a,"Feature Service"===a[0].type||"Scene Service"===a[0].type||"Vector Tile Service"===a[0].type))b.relatedService=a[0];return!0}),function(a){return!0})},_escapeFilename:function(a){try{return a=a.replace(/ /g,
"_").replace(/\//g,"_").replace(/\\/g,"_"),a=encodeURIComponent(a).replace("+","_").replace("%","_"),a=a.substring(0,Math.min(a.length,128))}catch(c){return a}},_checkIfExists:function(){var b={"Web Mapping Application":1,"Web Map":1},c=new a.Deferred,d,e=esriGeowConfig.restBaseUrl+"search",g=f.byId("item-title-edit-input").getValue(),h={q:"+type:"+this.item.type+" +owner:"+this.item.owner+" +title:"+g};this.item.title!==g&&this.item.type in b?this.util.request({url:e,content:h},{}).then(a.hitch(this,
function(b){(d=a.filter(b&&b.results||[],a.hitch(this,function(a){return a.title===g&&a.type===this.item.type})))&&d.length?(this._showError({message:a.string.substitute(this.i18n.AddItemFromLayerDlg.error.itemTitleExists,[g])}),c.reject()):c.resolve(!0)})):c.resolve(!0);return c},onShareUpdate:function(b){if(b&&this.currentUser&&(this.isAdmin||this._roleCanViewUsers&&this.itemUser&&!this._isOwnershipShared||this.item.owner===this.currentUser.email)){if(b&&a.isArray(b)&&!1===b[0].success&&b[0].error){if(b[0].error&&
"item not provisioned"===b[0].error.message){this._showError({message:this.i18n.error.noShareListedItem});return}return this._showError(b[0].error)}this.item.access=b;if("Web Map"===this.item.type||"Web Scene"===this.item.type)arcgisonline.sharing.utilShare.checkWebMapContent({webMapId:this.item.id,webMapItemCard:this.item,webMapConfig:this.getDataContent?this.getDataContent:null});else if("Web Mapping Application"===this.item.type)arcgisonline.sharing.utilShare.checkWebAppContent({webAppId:this.item.id,
webAppItemCard:this.item});else if("CSV"===this.item.type||"Image"===this.item.type||"PDF"===this.item.type||"Microsoft Excel"===this.item.type||"Microsoft PowerPoint"===this.item.type||"Microsoft Powerpoint"===this.item.type||"Microsoft Word"===this.item.type||"iWork Pages"===this.item.type||"iWork Keynote"===this.item.type||"iWork Numbers"===this.item.type||"Visio Document"===this.item.type)"public"===this.item.access?(a.query(".urlOnly",this.domNode).style("display",""),b=esriGeowConfig.restBaseUrl+
"content/items/"+this.item.id+"/data",a.attr("item-rest-url-title","innerHTML",this.item.type+" "+this.i18n.url),a.create("a",{href:b,innerHTML:b,title:b,target:"_blank"},"item-rest-url","only")):a.query(".urlOnly",this.domNode).style("display","none");this._toggleCommentRSSVisibility();this.getExtraInfo()}else if(b&&400===b.code)return b.message?"item not provisioned"===b.message?this._showError({message:this.i18n.error.noShareListedItem}):"data licensed items can only be shared by the item administrators."===
b.message?this._showError({message:this.i18n.error.noShareLicensedData}):this._showError(b):this._showError(b)},onNotShareUpdate:function(a){this._showError({message:this.i18n.error.cantShareGroup})},_showError:function(b,c){if(!c||!c.canceled){b=b.error||b||{};b.code=b.code||0;b=this.i18n&&this.i18n.errors&&this.i18n.errors[b.code]||b;b.details=b.details&&a.isArray(b.details)&&b.details.length?a.filter(b.details,"return item !\x3d\x3d null"):null;b.details&&b.details.length&&(b.details=b.details.join("\x3cbr /\x3e"),
b.message=b.message?b.message+"\x3cbr /\x3e"+b.details:b.details);var d=a.mixin(a.mixin({},this.i18n.errors.genericError),b);this._errorDlg.show(d)}},_showReloadDlg:function(){this._reload=!0;if(window.location&&-1===window.location.protocol.indexOf("https:")){var b={title:this.i18n.reloadTitle,message:"\x3cp\x3e"+this.i18n.reloadMessage+"\x3c/p\x3e",choiceOneTitle:this.i18n.yesLabel,choiceTwoTitle:this.i18n.noLabel,choiceOneHandler:a.hitch(this,function(){window.location=window.location.href.replace("http:",
"https:")}),choiceTwoHandler:a.hitch(this,function(){this._choiceDlg.hide()})};this._choiceDlg.show(b);return!1}},nothing:function(a){},_checkItemJobStatus:function(){this.item&&(this.item.properties&&this.item.properties.jobId&&this.item.properties.jobUrl&&"GPServer"===this.item.properties.jobType&&"processing"===this.item.properties.jobStatus)&&this._setGPCheckStatusJob()},_setGPCheckStatusJob:function(){var b=this.item.properties.jobUrl.split("/jobs/"),c=b[0];this._jobId=b[1];b=arcgisonline.sharing.util.getToken();
this._gpTask=new esri.tasks.Geoprocessor(c+"?token\x3d"+b);this._gpTask.setUpdateDelay(3E3);this._gpTask.checkJobStatus(this._jobId,a.hitch(this,this.showLoading),a.hitch(this,this.showLoading))},checkGpJobStatus:function(a,c,d){a.checkJobStatus(c,d)},showLoading:function(b){b&&("esriJobSucceeded"===b.jobStatus||"esriJobFailed"===b.jobStatus||"esriJobCancelled"===b.jobStatus||"esriJobTimedOut"===b.jobStatus||"esriJobDeleted"===b.jobStatus)||500===b.code?(this._basicStandby.hide(),this._gpTimeout&&
clearTimeout(this._gpTimeoutId),this._jobId=this._gpTask=null,this.item.properties.jobStatus="completed",this._clearJobUrl()):(this._basicStandby.show(),this._gpTimeoutId=setTimeout(a.hitch(this,this.checkGpJobStatus,this._gpTask,this._jobId,a.hitch(this,this.showLoading),a.hitch(this,this.showLoading)),3E3))},_clearJobUrl:function(){var b,c;b=esriGeowConfig.restBaseUrl+"content/users/"+(this.isAdmin?this.item.owner:this.util.getUser().email);b=b+"/"+(this.item.folderId||"")+"/items/"+this.item.id;
c={properties:a.toJson(this.item.properties)};esri.request({url:b+"/update",content:a.mixin({f:"json"},c)},{usePost:!0})},disableEditButton:function(){f.byId("item-edit-button").set("disabled",!0)},enableEditButton:function(){this._canEnableEdit?f.byId("item-edit-button").set("disabled",!1):this._canEnableEditInterval=setInterval(a.hitch(this,function(){this._canEnableEdit&&(clearInterval(this._canEnableEditInterval),this._canEnableEditInterval=null,f.byId("item-edit-button").set("disabled",!1))}),
100)}})});