// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/Group",["dijit","dojo","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/form/TextBox,dijit/form/Button,dijit/form/CheckBox,dijit/Editor,dijit/_editor/plugins/FontChoice,dijit/_editor/plugins/TextColor,dijit/_editor/plugins/ViewSource,dojo/Deferred,dojo/fx,dojo/store/Memory,arcgisonline/sharing/util,arcgisonline/sharing/geow/Account,arcgisonline/sharing/geow/Community,arcgisonline/sharing/geow/Group,arcgisonline/sharing/dijit/ComboBox,arcgisonline/sharing/dijit/LinkDialog,arcgisonline/sharing/dijit/ProfilePopup,arcgisonline/sharing/dijit/SearchResultsSimple,arcgisonline/sharing/dijit/Sorter,arcgisonline/sharing/dijit/SearchFilters,arcgisonline/sharing/dijit/dialog/MembershipRequestsDlg,arcgisonline/sharing/dijit/dialog/TagsDlg,arcgisonline/sharing/dijit/dialog/InviteUsersDlg,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/dialog/JoinGroupDlg,arcgisonline/sharing/dijit/dialog/SelectAccountUserDlg,arcgisonline/sharing/dijit/dialog/SelectEnterpriseGroupDlg,arcgisonline/sharing/dijit/dialog/ShareGroupDlg,arcgisonline/sharing/dijit/dialog/SubscriptionStatusDlg,esri/dijit/Tags"],
function(h,a,k){a.provide("arcgisonline.sharing.dijit.Group");a.require("dijit._Widget");a.require("dijit._Templated");a.require("dijit.form.TextBox");a.require("dijit.form.Button");a.require("dijit.form.CheckBox");a.require("dijit.Editor");a.require("dijit._editor.plugins.FontChoice");a.require("dijit._editor.plugins.TextColor");a.require("dijit._editor.plugins.ViewSource");a.require("dojo.Deferred");a.require("dojo.fx");a.require("dojo.store.Memory");a.require("arcgisonline.sharing.util");a.require("arcgisonline.sharing.geow.Account");
a.require("arcgisonline.sharing.geow.Community");a.require("arcgisonline.sharing.geow.Group");a.require("arcgisonline.sharing.dijit.ComboBox");a.require("arcgisonline.sharing.dijit.LinkDialog");a.require("arcgisonline.sharing.dijit.ProfilePopup");a.require("arcgisonline.sharing.dijit.SearchResultsSimple");a.require("arcgisonline.sharing.dijit.Sorter");a.require("arcgisonline.sharing.dijit.SearchFilters");a.require("arcgisonline.sharing.dijit.dialog.MembershipRequestsDlg");a.require("arcgisonline.sharing.dijit.dialog.TagsDlg");
a.require("arcgisonline.sharing.dijit.dialog.InviteUsersDlg");a.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");a.require("arcgisonline.sharing.dijit.dialog.JoinGroupDlg");a.require("arcgisonline.sharing.dijit.dialog.SelectAccountUserDlg");a.require("arcgisonline.sharing.dijit.dialog.SelectEnterpriseGroupDlg");a.require("arcgisonline.sharing.dijit.dialog.ShareGroupDlg");a.require("arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg");a.require("esri.dijit.Tags");a.declare("arcgisonline.sharing.dijit.Group",
[h._Widget,h._Templated],{account:arcgisonline.sharing.geow.Account,community:arcgisonline.sharing.geow.Community,_util:arcgisonline.sharing.util,widgetsInTemplate:!0,templateString:'\x3cdiv data-dojo-type\x3d"dijit.layout.ContentPane" data-dojo-attach-point\x3d"containerNode" class\x3d"groupDijit"\x3e\r\n\r\n  \x3cform data-dojo-attach-point\x3d"_form" enctype\x3d"multipart/form-data" action\x3d"" method\x3d"post" onSubmit\x3d"return false;"\x3e\r\n    \x3cinput data-dojo-attach-point\x3d"_form_groupId" name\x3d"id" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n    \x3cinput data-dojo-attach-point\x3d"_form_groupTitle" name\x3d"title" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n    \x3cinput data-dojo-attach-point\x3d"_form_groupTags" name\x3d"tags" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n    \x3cinput data-dojo-attach-point\x3d"_form_groupDescription" name\x3d"description" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n    \x3cinput data-dojo-attach-point\x3d"_form_groupSummary" name\x3d"snippet" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n    \x3cinput data-dojo-attach-point\x3d"_form_groupPhone" name\x3d"phone" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n    \x3cinput data-dojo-attach-point\x3d"_form_groupAccess" name\x3d"access" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n    \x3cinput data-dojo-attach-point\x3d"_form_groupIsInvitationOnly" name\x3d"isInvitationOnly" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n    \x3cinput data-dojo-attach-point\x3d"_form_groupIsViewOnly" name\x3d"isViewOnly" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n    \x3cinput data-dojo-attach-point\x3d"_form_groupIsOpenData" name\x3d"isOpenData" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n    \x3cinput data-dojo-attach-point\x3d"_form_groupCapabilities" name\x3d"capabilities" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n    \x3cinput data-dojo-attach-point\x3d"_form_groupSortField" name\x3d"sortField" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n    \x3cinput data-dojo-attach-point\x3d"_form_groupSortOrder" name\x3d"sortOrder" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n    \x3cinput data-dojo-attach-point\x3d"_form_groupProvider" name\x3d"provider" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n    \x3cinput data-dojo-attach-point\x3d"_form_groupProviderGroupName" name\x3d"providerGroupName" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n    \x3cinput id\x3d"clearEmptyFields" name\x3d"clearEmptyFields" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d"true"/\x3e\r\n\r\n    \x3cdiv style\x3d"width: 100%; margin:2em 0; display:none;" data-dojo-attach-point\x3d"_menuButtons"\x3e\r\n      \x3cspan id\x3d"editButtonSpan" class\x3d"ownerOnly"\x3e\x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-props\x3d"iconClass:\'esriEditGroupIcon\'" data-dojo-attach-event\x3d"onClick:startEdit" data-dojo-attach-point\x3d"_editButton" class\x3d"readOnly calcite narrow transparent"\x3e${i18n.edit}\x3c/button\x3e\x3c/span\x3e\r\n      \x3cbutton id\x3d"_upperSave" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-attach-event\x3d"onClick:saveEdit" class\x3d"editOnly calcite blue"\x3e${i18n.save}\x3c/button\x3e\r\n      \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-attach-event\x3d"onClick:cancelEdit" class\x3d"editOnly calcite transparent"\x3e${i18n.cancel}\x3c/button\x3e\r\n      \x3cspan id\x3d"inviteButtonSpan" class\x3d"ownerOnly"\x3e\x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-props\x3d"iconClass:\'esriJoinGroupIcon\'" data-dojo-attach-point\x3d"_inviteButton" data-dojo-attach-event\x3d"onClick:_handleInviteGroupButtonClick" class\x3d"readOnly calcite narrow transparent"\x3e${i18n.inviteUsers}\x3c/button\x3e\x3c/span\x3e\r\n      \x3cspan id\x3d"membershipRequestSpan" class\x3d"ownerOnly"\x3e\x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-props\x3d"iconClass:\'esriMembershipRequestIcon\'" data-dojo-attach-event\x3d"onClick:_handleMemberRequestsButtonClick" class\x3d"readOnly calcite narrow transparent" data-dojo-attach-point\x3d"_membershipRequestButton" style\x3d"display:none;"\x3e${i18n.membershipRequests}\x3c/button\x3e\x3c/span\x3e\r\n      \x3cspan id\x3d"reassignButtonSpan" class\x3d"ownerOnly"\x3e\x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-props\x3d"iconClass:\'esriReassignIcon\'" data-dojo-attach-event\x3d"onClick:reassignGroup" class\x3d"readOnly calcite narrow transparent" data-dojo-attach-point\x3d"_changeOwnerButton"\x3e${i18n.changeOwner}\x3c/button\x3e\x3c/span\x3e\r\n      \x3cspan id\x3d"deleteButtonSpan" class\x3d"ownerOnly"\x3e\x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-props\x3d"iconClass:\'esriDeleteGroupIcon\'" data-dojo-attach-point\x3d"_deleteButton" data-dojo-attach-event\x3d"onClick:deleteGroup" class\x3d"readOnly calcite narrow transparent"\x3e${i18n.deleteGroup}\x3c/button\x3e\x3c/span\x3e\r\n      \x3cspan id\x3d"shareByOwnerSpan" class\x3d"ownerOnly"\x3e\x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-props\x3d"iconClass:\'esriGroupLinkIcon\'" data-dojo-attach-event\x3d"onClick:shareGroup" data-dojo-attach-point\x3d"_shareByOwnerButton" class\x3d"readOnly calcite narrow transparent"\x3e${i18n.share}\x3c/button\x3e\x3c/span\x3e\r\n      \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" style\x3d"display:none;" class\x3d"group_buttons calcite narrow transparent" data-dojo-attach-event\x3d"onClick:joinGroup" data-dojo-attach-point\x3d"_joinGroupButton" data-dojo-props\x3d"iconClass:\'esriJoinGroupIcon\'"\x3e${i18n.joinThisGroup}\x3c/button\x3e\r\n      \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" style\x3d"display:none;" class\x3d"group_buttons calcite narrow transparent" data-dojo-attach-event\x3d"onClick:confirmLeaveGroup" data-dojo-attach-point\x3d"_leaveGroupButton" data-dojo-props\x3d"iconClass:\'esriLeaveGroupIcon\'"\x3e${i18n.leaveThisGroup}\x3c/button\x3e\r\n      \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" style\x3d"display:none;" class\x3d"group_buttons calcite narrow transparent" data-dojo-attach-event\x3d"onClick:shareGroup" data-dojo-attach-point\x3d"_shareByOtherButton" data-dojo-props\x3d"iconClass:\'esriGroupLinkIcon\'"\x3e${i18n.share}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n\r\n\r\n    \x3cdiv\x3e\r\n     \x3cdiv style\x3d"clear:both;margin-top: 2em; padding-left: 10px;" class\x3d"alpha"\x3e\r\n\r\n      \x3cdiv class\x3d"alpha" data-dojo-attach-point\x3d"_thumbnailDiv" style\x3d"display:none;"\x3e\r\n        \x3cimg src\x3d"" data-dojo-attach-point\x3d"_thumbnailEdit" align\x3d"center" class\x3d"groupThumbnail esriFloatLeading" style\x3d"display:none;" /\x3e\x3cbr/\x3e\r\n        \x3cspan class\x3d"editOnly esriFloatLeading group-change-thumb" data-dojo-attach-point\x3d"_changeThumbLabel"\x3e${i18n.clickChangeThumbnail}\x3c/span\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cspan class\x3d"editOnly esriFloatLeading"\x3e\r\n        \x3cspan style\x3d"display:block;"\x3e${i18n.nameLabel}\x3c/span\x3e\r\n        \x3cinput data-dojo-type\x3d"dijit.form.TextBox" maxlength\x3d"250" data-dojo-attach-point\x3d"_edit_title"  class\x3d"alpha groupTextBox"/\x3e\r\n      \x3c/span\x3e\r\n\r\n      \x3cp class\x3d"readOnly" style\x3d"width:80%; margin: 0px 0px 10px 0px;"\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"_summary"\x3e\x3c/span\x3e\r\n        \x3cspan class\x3d"esriItemLinks"\x3e\r\n          \x3ca href\x3d"#" data-dojo-attach-point\x3d"_toggleDescriptionLabel" data-dojo-attach-event\x3d"onclick:toggleDescription"\x3e\r\n            \x3cimg alt\x3d"${i18n.showMoreLabel}" title\x3d"${i18n.showMoreLabel}" data-dojo-attach-point\x3d"_toggleDown" /\x3e\r\n            \x3cimg style\x3d"display:none;" alt\x3d"${i18n.showLessLabel}" title\x3d"${i18n.showLessLabel}" data-dojo-attach-point\x3d"_toggleUp" /\x3e\r\n          \x3c/a\x3e\r\n        \x3c/span\x3e\r\n      \x3c/p\x3e\r\n\r\n      \x3cp class\x3d"readOnly" style\x3d"width:80%;"\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"_description" style\x3d"display:none;width:80%;" class\x3d"esriItemLinks"\x3e\x3c/span\x3e\r\n      \x3c/p\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_connectContainer" class\x3d"readOnly socialNetworkBadges esriFloatTrailing esriTrailingMargin3"\x3e\x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriFloatLeading" style\x3d"clear:both; width: 80%;"\x3e\r\n      \x3cspan class\x3d"readOnly section"\x3e${i18n.groupContent}\x3c/span\x3e\r\n      \x3cdiv class\x3d"readOnly" data-dojo-attach-point\x3d"_groupContentPane" data-dojo-type\x3d"dijit.layout.ContentPane"\x3e\r\n        \x3cdiv\x3e\r\n          \x3cspan data-dojo-attach-point\x3d"_searchQueryLabel" \x3e\x3c/span\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"filtersWidget" style\x3d"width:20%;" data-dojo-type\x3d"arcgisonline.sharing.dijit.SearchFilters" class\x3d"grid_3 alpha esriFloatLeading"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"grid_9 omega" style\x3d"float: right; width: 75%;"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_sorter" data-dojo-type\x3d"arcgisonline.sharing.dijit.Sorter"\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-type\x3d"arcgisonline.sharing.dijit.SearchResultsSimple" jsId\x3d"searchResults" doAjax\x3d"false" data-dojo-attach-point\x3d"_searchResults" defaultSortField\x3d"\'modified\'" style\x3d"margin-top: 10px;"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cp class\x3d" alpha editOnly"\x3e\r\n        \x3cspan style\x3d"display:block;"\x3e${i18n.summaryLabel}\x3c/span\x3e\r\n        \x3ctextarea style\x3d"max-height:3em;min-height:3em;height:3em;min-width:100%;max-width:100%;width:100%;resize:none;" class\x3d"groupTextBox" data-dojo-attach-point\x3d"_edit_summary"\x3e\x3c/textarea\x3e\r\n      \x3c/p\x3e\r\n\r\n      \x3cdiv class\x3d"alpha editOnly"\x3e\r\n        \x3cspan style\x3d"display:block;"\x3e${i18n.descriptionLabel}\x3c/span\x3e\r\n        \x3cdiv data-dojo-type\x3d"dijit.Editor" data-dojo-attach-point\x3d"_edit_description" style\x3d"width:100%; min-height:300px; border:1px solid #bbb;"\r\n          plugins\x3d"[\'bold\', \'italic\', \'underline\', \'foreColor\', \'hiliteColor\',\r\n          \'|\', \'justifyLeft\', \'justifyCenter\', \'justifyRight\', \'justifyFull\',\r\n          \'|\', \'insertOrderedList\', \'insertUnorderedList\', \'indent\', \'outdent\',\r\n          \'|\', \'createEsriLink\', \'unlink\', \'insertImage\',\r\n          \'|\', \'undo\', \'redo\', \'|\', \'viewsource\', {\r\n           name: \'dijit._editor.plugins.FontChoice\',\r\n            command: \'fontName\',\r\n            custom: [\'Arial\', \'Courier New\', \'Garamond\', \'Tahoma\', \'Times New Roman\', \'Verdana\']\r\n           },\r\n           {\r\n            name: \'dijit._editor.plugins.FontChoice\',\r\n            command: \'fontSize\',\r\n            custom: [\'2\', \'3\', \'4\', \'5\', \'6\']\r\n           }\r\n          ]"\r\n        \x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"alpha editOnly"\x3e\r\n        \x3cbr/\x3e\r\n        \x3cspan style\x3d"display:block;"\x3e${i18n.tagsLabel}\x3c/span\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_edit_tags" data-dojo-type\x3d"esri/dijit/Tags" data-dojo-props\x3d"minWidth:\'700px\',maxWidth:\'100%\'"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv style\x3d"clear:both;"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"grid_4 esriFloatTrailing readOnly" style\x3d"width: 16%;"\x3e\r\n      \x3cspan class\x3d"section"\x3e${i18n.groupDetails}\x3c/span\x3e\r\n      \x3ctable cellspacing\x3d"5"\x3e\r\n        \x3ctbody\x3e\r\n          \x3ctr\x3e\r\n            \x3c!-- the ownerLabel must wrap into next line if it\'s long --\x3e\r\n            \x3ctd valign\x3d"top"\x3e${i18n.ownerLabel}\r\n              \x3cspan class\x3d"esriItemLinks" data-dojo-attach-point\x3d"_ownerLabel"\x3e\x3c/span\x3e\r\n            \x3c/td\x3e\r\n          \x3c/tr\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd valign\x3d"top"\x3e${i18n.statusLabel}\r\n              \x3cspan data-dojo-attach-point\x3d"_statusLabel"\x3e\x3c/span\x3e\r\n            \x3c/td\x3e\r\n          \x3c/tr\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd valign\x3d"top"\x3e${i18n.contributorsLabel}\r\n              \x3cspan class\x3d"esriItemLinks" data-dojo-attach-point\x3d"_contributorLabel"\x3e\x3c/span\x3e\r\n            \x3c/td\x3e\r\n          \x3c/tr\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd valign\x3d"top"\x3e${i18n.tagsLabel}\r\n              \x3cspan class\x3d"dim" data-dojo-attach-point\x3d"_tags"\x3e\x3c/span\x3e\r\n            \x3c/td\x3e\r\n          \x3c/tr\x3e\r\n          \x3c!--\x3ctr\x3e--\x3e\r\n            \x3c!--\x3ctd\x3e--\x3e\r\n              \x3c!--\x3cspan style\x3d"margin-left: 0.8em; display:block;" class\x3d"dim" data-dojo-attach-point\x3d"_tags"\x3e\x3c/span\x3e--\x3e\r\n            \x3c!--\x3c/td\x3e--\x3e\r\n          \x3c!--\x3c/tr\x3e--\x3e\r\n        \x3c/tbody\x3e\r\n      \x3c/table\x3e\r\n\r\n      \x3cspan class\x3d"section" data-dojo-attach-point\x3d"_membersLabel"\x3e\x3c/span\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_userList" class\x3d"esriItemLinks" style\x3d"padding: 0.5em; line-height: 1.5em; overflow: auto; height: 200px;"\x3e\r\n      \x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"grid_4 esriFloatLeading editOnly group-status"\x3e\r\n      \x3cspan style\x3d"display:block;"\x3e${i18n.statusLabel}\x3c/span\x3e\r\n      \x3cdiv id\x3d"edit-private_div" style\x3d"margin-top: 1em;"\x3e\r\n        \x3cinput data-dojo-type\x3d"dijit.form.RadioButton" data-dojo-attach-point\x3d"_edit_private" id\x3d"_edit_private" name\x3d"_edit_privacy" data-dojo-attach-event\x3d"onClick:onPrivateSelected"/\x3e\r\n        \x3clabel for\x3d"_edit_private"\x3e${i18n.privatemsg} \x3cspan class\x3d"dim"\x3e${i18n.privateInfo}\x3c/span\x3e\x3c/label\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"edit-account_div" style\x3d"margin-top: 1em;"\x3e\r\n        \x3cinput data-dojo-type\x3d"dijit.form.RadioButton" data-dojo-attach-point\x3d"_edit_account" id\x3d"_edit_account" name\x3d"_edit_privacy" data-dojo-attach-event\x3d"onClick:onNotPublicSelected"/\x3e\r\n        \x3clabel for\x3d"_edit_account"\x3e${i18n.organization} \x3cspan class\x3d"dim"\x3e${i18n.orgGrpMsg}\x3c/span\x3e\x3c/label\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"edit-public_div" style\x3d"margin-top: 1em;"\x3e\r\n        \x3cinput data-dojo-type\x3d"dijit.form.RadioButton" data-dojo-attach-point\x3d"_edit_public" id\x3d"_edit_public" name\x3d"_edit_privacy" data-dojo-attach-event\x3d"onClick:onPublicSelected"/\x3e\r\n        \x3clabel for\x3d"_edit_public"\x3e${i18n.publicLabel} \x3cspan class\x3d"dim"\x3e${i18n.publicGrpInfo}\x3c/span\x3e\x3c/label\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"margin-top: 1em;display:none;" id\x3d"allowSharedOwnershipDiv"\x3e\r\n        \x3cinput data-dojo-type\x3d"dijit.form.CheckBox" data-dojo-attach-point\x3d"_edit_allowSharedOwnership" id\x3d"_edit_allowSharedOwnership"/\x3e\r\n        \x3clabel for\x3d"_edit_allowSharedOwnership"\x3e${i18n.sharedOwnershipLabel}\x26nbsp;\x3cspan class\x3d"orgSettingTooltip" id\x3d"_edit_allowSharedOwnershipTip"\x3e${i18n.sharedOwnershipUpdateLabel}\x3c/span\x3e\x26nbsp;${i18n.sharedOwnershipLabel2}\x3c/label\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"margin-top: 1em;" id\x3d"allowOpenDataDiv"\x3e\r\n        \x3cinput data-dojo-type\x3d"dijit.form.CheckBox" data-dojo-attach-point\x3d"_edit_allowOpenData" id\x3d"_edit_allowOpenData"/\x3e\r\n        \x3clabel for\x3d"_edit_allowOpenData"\x3e${i18n.openDataLabel}\x3c/label\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"margin-top: 1em;" id\x3d"allowApplyDiv"\x3e\r\n        \x3cinput data-dojo-type\x3d"dijit.form.CheckBox" data-dojo-attach-point\x3d"_edit_allowApply" id\x3d"_edit_allowApply"/\x3e\r\n        \x3clabel for\x3d"_edit_allowApply"\x3e${i18n.usersApply}\x3c/label\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"margin-top:1em;display:none;" id\x3d"enterpriseGroupDiv"\x3e\r\n        \x3clabel\x3e${i18n.enterpriseGroups.usersLabel}\x3c/label\x3e\x3cbr/\x3e\r\n        \x3cdiv style\x3d"margin-top: 1em;"\x3e\r\n          \x3cinput data-dojo-type\x3d"dijit.form.RadioButton" data-dojo-attach-point\x3d"_enterprise_invite" id\x3d"_enterprise_invite"data-dojo-attach-event\x3d"onClick:onEnterpriseInviteSelected"/\x3e\r\n          \x3clabel for\x3d"_enterprise_invite"\x3e${i18n.enterpriseGroups.inviteOnlyLabel}\x3c/label\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"enterpriseApplyDiv" style\x3d"margin-top: 1em;"\x3e\r\n          \x3cinput data-dojo-type\x3d"dijit.form.RadioButton" data-dojo-attach-point\x3d"_enterprise_apply" id\x3d"_enterprise_apply" data-dojo-attach-event\x3d"onClick:onEnterpriseApplySelected"/\x3e\r\n          \x3clabel for\x3d"_enterprise_apply"\x3e${i18n.enterpriseGroups.applyLabel}\x3c/label\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv style\x3d"margin-top: 1em;"\x3e\r\n          \x3cinput data-dojo-type\x3d"dijit.form.RadioButton" data-dojo-attach-point\x3d"_enterprise_group" id\x3d"_enterprise_group" data-dojo-attach-event\x3d"onClick:onEnterpriseGroupSelected"/\x3e\r\n          \x3clabel for\x3d"_enterprise_group"\x3e${i18n.enterpriseGroups.enterpriseLabel}\x3c/label\x3e\r\n          \x3cspan data-dojo-attach-point\x3d"_enterprise_group_name" class\x3d"readOnly"\x3e${i18n.enterpriseGroups.noneSelected}\x3c/span\x3e\x3cbr/\x3e\r\n          \x3cspan data-dojo-attach-point\x3d"_enterprise_group_select" class\x3d"editOnly esriLeadingMargin2"\x3e\r\n            \x3cinput data-dojo-attach-point\x3d"_enterprise_group_input" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"text"/\x3e\r\n            \x3cbutton data-dojo-attach-point\x3d"_enterpriseGroupSelectBtn" data-dojo-type\x3d"dijit.form.Button" data-dojo-attach-event\x3d"onClick:onSelectEnterpriseGroup" class\x3d"calcite light small"\x3e${i18n.enterpriseGroups.selectLabel}\x3c/button\x3e\r\n          \x3c/span\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cbr/\x3e\x3cbr/\x3e\r\n      \x3cdiv id\x3d"edit-view-only"\x3e\r\n        \x3cspan style\x3d"display:block;"\x3e${i18n.contributorsLabel}\x3c/span\x3e\r\n        \x3cdiv id\x3d"edit-all-members_div" style\x3d"margin-top:1em;"\x3e\r\n          \x3cinput data-dojo-type\x3d"dijit.form.RadioButton" data-dojo-attach-point\x3d"_edit_all_members" id\x3d"_edit_all_members" name\x3d"_edit_contributors"/\x3e\r\n          \x3clabel for\x3d"_edit_all_members"\x3e${i18n.allMembersContribute}\x3c/label\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"edit-admins-only_div" style\x3d"margin-top:1em;"\x3e\r\n          \x3cinput data-dojo-type\x3d"dijit.form.RadioButton" data-dojo-attach-point\x3d"_edit_only_admins" id\x3d"_edit_only_admins" name\x3d"_edit_contributors"/\x3e\r\n          \x3clabel for\x3d"_edit_only_admins"\x3e${i18n.onlyAdminContribute}\x3c/label\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cbr/\x3e\x3cbr/\x3e\r\n      \x3cdiv style\x3d"margin-bottom:1em;"\x3e${i18n.sortBy}\x3c/div\x3e\r\n      \x3cdiv style\x3d"display:inline-block; margin:0;" data-dojo-type\x3d"arcgisonline.sharing.dijit.ComboBox" data-dojo-attach-point\x3d"_edit_sortField" id\x3d"_edit_sortField"\x3e\x3c/div\x3e\r\n      \x3cdiv id\x3d"sortOrderContainer" style\x3d"display:inline-block; margin:0;"\x3e\r\n        \x3cinput data-dojo-type\x3d"dijit.form.CheckBox" data-dojo-attach-point\x3d"_edit_sortOrder" id\x3d"_edit_sortOrder"/\x3e\r\n        \x3clabel for\x3d"_edit_sortOrder"\x3e${i18n.ascending}\x3c/label\x3e\r\n      \x3c/div\x3e\r\n      \x3cbr /\x3e\r\n      \x3cdiv style\x3d"margin-top: 10px;"\x3e\r\n        \x3cbutton id\x3d"_lowerSave" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-attach-event\x3d"onClick:saveEdit" class\x3d"editOnly calcite blue"\x3e${i18n.save}\x3c/button\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-attach-event\x3d"onClick:cancelEdit" class\x3d"editOnly calcite transparent"\x3e${i18n.cancel}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-type\x3d"arcgisonline.sharing.dijit.SearchResultsPaging" class\x3d"readOnly" searchResults\x3d"searchResults" style\x3d"float: none; clear:both; width: 100%; text-align:center;"\x3e\x3c/div\x3e\r\n\r\n    \x3cdiv style\x3d"clear: both;"\x3e\x3c/div\x3e\r\n\r\n    \x3c!--\x3cdiv data-dojo-attach-point\x3d"thumbnailDialogNode" title\x3d"Upload Thumbnail" style\x3d"width: 450px;"\x3e can\'t do --\x3e\r\n    \x3cdiv id\x3d"group-thumbnail-dialog" class\x3d"dijitDialog thumbnailDialog"\x3e\r\n       \x3cdiv id\x3d"group-thumbnail-header"\x3e\r\n        \x3cdiv style\x3d"background:none;padding-top:2px;" class\x3d"dijitDialogTitle dijitDialogTitleBar"\x3e${i18n.uploadThumbnail}\x3c/div\x3e\r\n        \x3cdiv id\x3d"group-thumbnail-close" title\x3d"${i18n.close}" class\x3d"dijitDialogCloseIcon"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"group-thumbnail-content"\x3e\r\n        \x3cp\x3e\x3cspan\x3e\x3clabel\x3e${i18n.specifyImage}\x3c/label\x3e\x3c/span\x3e\x3c/p\x3e\r\n        \x3cdiv\x3e\r\n         \x3cspan style\x3d"margin-top:6px;"\x3e\x3clabel for\x3d"group-thumbnail-file"\x3e${i18n.imageLabel}\x3c/label\x3e\x3c/span\x3e\r\n         \x3cinput type\x3d"hidden" name\x3d"MAX_FILE_SIZE" value\x3d"1024000"\x3e\r\n         \x3cinput type\x3d"file" id\x3d"group-thumbnail-file" name\x3d"thumbnail" size\x3d"44" data-dojo-attach-point\x3d"thumbnailPath"\x3e\r\n        \x3c/div\x3e\r\n        \x3cp style\x3d"margin-top: 1.5em;"\x3e\x3cspan\x3e${i18n.forBestImageMsg}\x3c/span\x3e\x3c/p\x3e\r\n        \x3cdiv style\x3d"margin-top: 1.5em;"\x3e\r\n          \x3cbutton id\x3d"group-thumbnail-cancel" class\x3d"esriFloatTrailing jevent calcite transparent" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n          \x3cbutton id\x3d"group-thumbnail-ok" class\x3d"esriFloatTrailing jevent calcite blue" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.ok}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv style\x3d"clear:both; width:100%;"\x3e\x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n  \x3c/form\x3e\r\n  \x3cinput data-dojo-attach-point\x3d"_groupIdTextBox" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n\x3c/div\x3e\r\n',
group:null,groupId:null,groupUsers:null,_user:null,_queryStringParams:null,isNewGroup:!1,_groupIdTextBox:null,_userMembership:null,_isSharedOwnership:!1,_organization:null,_isAdmin:!1,_groupUser:null,_isPortal:!1,_enterpriseProvider:"enterprise",_enterpriseGroup:null,_title:null,_thumbnail:null,_summary:null,_description:null,_ownerLabel:null,_statusLabel:null,_tags:null,_membershipRequestButton:null,_userList:null,_toggleDescriptionLabel:null,_toggleDown:null,_toggleUp:null,thumbnailPath:null,_searchResults:null,
_sorter:null,_joinGroupButton:null,_leaveGroupButton:null,_membersLabel:null,_changeThumbLabel:null,_searchQueryLabel:null,_changeOwnerButton:null,_shareByOwnerButton:null,_shareByOtherButton:null,_edit_title:null,_edit_summary:null,_edit_description:null,_edit_public:null,_edit_account:null,_edit_private:null,_edit_tags:null,_edit_allowApply:null,_edit_allowOpenData:null,_edit_all_members:null,_edit_only_admins:null,_edit_sortField:null,_edit_sortFieldStore:null,_edit_sortOrder:null,_form:null,_form_groupId:null,
_form_groupTitle:null,_form_groupTags:null,_form_groupDescription:null,_form_groupSummary:null,_form_groupPhone:null,_form_groupIsPublic:null,_form_groupIsInvitationOnly:null,_form_groupIsViewOnly:null,_form_groupIsOpenData:null,_form_groupSortField:null,_form_groupSortOrder:null,_connectContainer:null,editConnects:[],_onApplicationAcceptConnect:null,_onApplicationDeclineConnect:null,accountAdminRole:"account_admin",defaultTextTitle:null,defaultTextDescription:null,defaultTextTags:null,defaultImgThumbnail:"images/group-no-image.png",
maxGroupsDefault:512,token:null,i18n:null,constructor:function(){this.token=""},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.mixin({},a.i18n.getLocalization("arcgisonline","arcgisonline").common);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").GroupWidget);this.defaultTextTitle=this.i18n.defaultTextTitle;this.defaultTextDescription=this.i18n.defaultTextDescription;this.defaultTextTags=this.i18n.defaultTextTags;this.defaultImgThumbnail=this._util.relativeToExplicitUrl(this.defaultImgThumbnail);
this._thumbnail=a.byId("groupThumbnail")},postCreate:function(){this.loadConnections();a.query(".editOnly",this.domNode).style("display","none");a.query(".ownerOnly",this.domNode).style("display","none");a.subscribe("onGroupLeave",this,a.hitch(this,function(){this.refreshGroup(this.group.id)}));a.subscribe("enterprise-group-selected",a.hitch(this,function(b){b=b.rolename;a.attr(this._enterprise_group_name,"innerHTML",b);this._enterprise_group_input.set("value",b)}));this._toggleDown&&a.attr(this._toggleDown,
"src",this._util.relativeToExplicitUrl("js/jsapi/dijit/themes/tundra/images/doubleArrowDown.png"));this._toggleUp&&a.attr(this._toggleUp,"src",this._util.relativeToExplicitUrl("js/jsapi/dijit/themes/tundra/images/doubleArrowUp.png"));this._user=this._util.getUser()},startup:function(){var b=this._util.getToken();b&&(this.token="?token\x3d"+b);this._thumbnail.src=this.defaultImgThumbnail;this._queryStringParams=a.queryToObject(window.location.search.slice(1));if(this._queryStringParams.id)this.groupId=
decodeURIComponent(this._queryStringParams.id),this._groupIdTextBox.set("value",this.groupId),this.refreshGroup(this.groupId);else if(this._queryStringParams.groupid)this.groupId=decodeURIComponent(this._queryStringParams.groupid).split(" ")[0].split(":")[1],this._groupIdTextBox.set("value",this.groupId),this.refreshGroup(this.groupId);else if(this._queryStringParams.owner&&this._queryStringParams.title){var b=this._queryStringParams.owner,c=decodeURIComponent(this._queryStringParams.title);if(!b||
!c)window.location="error.html?c\x3dInvalidGroup";c=c.replace(/\\/g,"\\\\").replace(/"/g,'\\"');b=esriGeowConfig.restBaseUrl+'community/groups?q\x3downer:"'+b+'" title:"'+encodeURIComponent(c)+'"\x26num\x3d100';this._util.getJson(b,a.hitch(this,this._handleGetGroupId))}else this._util.requireAuthentication(),this.isNewGroup=!0,this._user&&this._user.accountId?this.account.getSelf(a.hitch(this,this._handleGetOrganization),a.hitch(this,this._handleGetOrganization)):(a.query(".ownerOnly",this.domNode).style("display",
""),this._user&&this.startEdit());b=[{name:"modified",label:this.i18n.date,reverse:!0},{name:"numviews",label:this.i18n.views,reverse:!0},{name:"avgrating",label:this.i18n.rating,reverse:!0},{name:"owner",label:this.i18n.owner},{name:"title",label:this.i18n.title}];if(this._queryStringParams.q)b.push({name:null,label:this.i18n.relevance});else if(!this._queryStringParams.sortField||null===this._queryStringParams.sortField)this._sorter.sortField="modified",this._sorter.sortOrder="desc",this._sorter._redraw();
this._sorter.set("fields",b.reverse());this._searchResults.set("defaultSortField","modified");a.connect(this._searchResults,"onDisplayResults",this,this._updateNoResultsMessage);a.connect(this._searchResults,"afterDisplayResults",this,this._onAfterDisplayResults);a.connect(this._searchResults,"onQueryResult",a.hitch(this,function(b){this._queryStringParams&&this._queryStringParams.q&&(a.attr(this._searchQueryLabel,"innerHTML",b.total+(1===b.total?this.i18n.resultLabel:this.i18n.resultsLabel)+this.i18n.forLabel+
' "'+this._queryStringParams.q+'"'),b=a.create("a",{onclick:a.hitch(this,this._clearQuery),href:"#"},this._searchQueryLabel),a.create("img",{src:this._util.relativeToExplicitUrl("images/delete_20x20.png"),alt:this.i18n.clearQuery,title:this.i18n.clearQuery,style:{verticalAlign:"middle"}},b))}))},_clearQuery:function(b){this._searchResults.goToSearch(a.mixin(this._queryStringParams,{q:null,start:1}),{useCurrentPageLocation:!0});a.stopEvent(b)},_unload:function(a){var c=this.i18n.error.unsavedChanges;
return a.returnValue=c},_onAfterDisplayResults:function(){if(this.group.userMembership&&this.group.userMembership.memberType){var b=this.group.userMembership.memberType;("owner"===b||"admin"===b||this._isAdmin||this._roleCanUpdate&&this._groupUser)&&a.query(".unshare").style("display","")}},_updateNoResultsMessage:function(a){0===a&&(a="\x3cspan\x3e\x3cspan style\x3d'font-weight:bold;'\x3e"+this.i18n.whyNotSee+"\x3c/span\x3e\x3cbr/\x3e\x3cul class\x3d'noSearchResults'\x3e",this._searchResults._queryStringParams.q||
this._searchResults._queryStringParams.focus?(a+="\x3cli\x3e"+this.i18n.spelledCorrectly+"\x3c/li\x3e",a+="\x3cli\x3e"+this.i18n.tryDifferentWords+"\x3c/li\x3e",a+="\x3cli\x3e"+this.i18n.tryGeneralWords+"\x3c/li\x3e"):null!==this._userMembership&&"none"!==this._userMembership.memberType?a+="\x3cli\x3e"+this.i18n.NotSharedYet+"\x3c/li\x3e":this.group.isInvitationOnly?(a+="\x3cli\x3e"+this.i18n.onlyMembersSeeItems+"\x3c/li\x3e",a+="\x3cli\x3e"+this.i18n.NoItemsShared+"\x3c/li\x3e"):(a+="\x3cli\x3e"+
this.i18n.onlyMembersRequest+"\x3c/li\x3e",a+="\x3cli\x3e"+this.i18n.NoItemsSharedByGroup+"\x3c/li\x3e"),this._searchResults.set("noResultsMessage","\x3cp class\x3d'esriItemLinks'\x3e"+(a+"\x3c/ul\x3e\x3c/span\x3e")+"\x3c/p\x3e"))},_handleGetGroupId:function(a,c){if(0<a.results.length){var d=!1,e,g;for(g=0;g<a.results.length;g++)if(e=a.results[g],this._queryStringParams.title.toLowerCase()===e.title.toLowerCase()){this.groupId=a.results[g].id;this._groupIdTextBox.set("value",this.groupId);this.refreshGroup(this.groupId);
d=!0;break}if(!d&&0<a.results.length)for(g=0;g<a.results.length;g++)if(e=a.results[g],this._queryStringParams.title.toLowerCase().replace(/\+/g," ")===e.title.toLowerCase()){this.groupId=a.results[g].id;this._groupIdTextBox.set("value",this.groupId);this.refreshGroup(this.groupId);d=!0;break}d||(window.location="error.html?c\x3dInvalidGroup")}else this._user?window.location="error.html?c\x3dInvalidGroup":(d=esriGeowConfig.baseUrl,!1!==esriGeowConfig.useSSL&&(d=d.replace("http:","https:")),window.location=
d+esriGeowConfig.signin+"?returnUrl\x3d"+escape(window.location)+"\x26error\x3d403")},_handleGetGroup:function(b,c){b&&(this.group=b,this._user&&this._user.accountId?this.account.getSelf(a.hitch(this,this._handleGetAccount),a.hitch(this,this._handleGetAccount)):(this._isAdmin=!1,this.initializeGroup()))},_setRoleFlags:function(){this._isPortal=this._organization&&this._organization.isPortal;this._roleCanView=(this._isCustomRole=esriGeowConfig.userRole&&esriGeowConfig.userRole.isCustom())&&esriGeowConfig.userRole.canViewOrgGroups();
this._roleCanUpdate=this._isCustomRole&&esriGeowConfig.userRole.canUpdateOrgGroups();this._roleCanDelete=this._isCustomRole&&esriGeowConfig.userRole.canDeleteOrgGroups();this._roleCanReassign=this._isCustomRole&&esriGeowConfig.userRole.canReassignOrgGroups();this._roleCanAssignToGroups=this._isCustomRole&&esriGeowConfig.userRole.canAssignUsersToOrgGroups();this._roleCanShareGroupToOrg=this._isCustomRole&&esriGeowConfig.userRole.canShareGroupToOrg();this._roleCanShareGroupToPublic=this._isCustomRole&&
esriGeowConfig.userRole.canShareGroupToPublic();this._roleCanShareItems=this._isCustomRole&&(esriGeowConfig.userRole.canShareItemToGroup()||esriGeowConfig.userRole.canShareItemToOrg()||esriGeowConfig.userRole.canShareItemToPublic());this._roleCanCreate=this._isCustomRole&&esriGeowConfig.userRole.canCreateGroup();this._roleCanJoinOrgGroup=this._isCustomRole&&esriGeowConfig.userRole.canJoinOrgGroup();this._roleCanJoinNonOrgGroup=this._isCustomRole&&esriGeowConfig.userRole.canJoinNonOrgGroup();this._roleCanDesignateOpenData=
this._isCustomRole&&esriGeowConfig.userRole.canDesignateOpenDataGroups();this._roleCanManageEnterpriseGroups=this._isCustomRole&&esriGeowConfig.userRole.canManageEnterpriseGroups();this._isPortal&&(this._portalAdminUrl=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))+"/portaladmin/",this._portalAdminSecurityConfigUrl=this._portalAdminUrl+"security/config",this._supportsEnterpriseGroups=!1)},_creatingNewGroup:function(){a.query(".ownerOnly",this.domNode).style("display",
"");this.startEdit()},_checkEnterpriseGroupStore:function(){var b=new a.Deferred;this._util.request({url:this._portalAdminSecurityConfigUrl}).then(a.hitch(this,function(a){a&&(a.groupStoreConfig&&a.groupStoreConfig.type)&&(a=a.groupStoreConfig.type.toLowerCase(),"builtin"!==a&&"saml"!==a&&(this._supportsEnterpriseGroups=!0));b.resolve()}),a.hitch(this,function(a){b.resolve()}));return b},_handleGetOrganization:function(b,c){b&&b.id===this._user.accountId?(this._organization=b,this._setRoleFlags(),
this._isPortal&&esriGeowConfig.userRole&&(esriGeowConfig.userRole.isAdmin()||this._roleCanManageEnterpriseGroups)?this._checkEnterpriseGroupStore().then(a.hitch(this,function(){this._creatingNewGroup()})):this._creatingNewGroup()):this._creatingNewGroup()},_handleGetAccount:function(b,c){b&&b.id===this._user.accountId?(this._organization=b,this._setRoleFlags(),this._isPortal&&esriGeowConfig.userRole&&(esriGeowConfig.userRole.isAdmin()||this._roleCanManageEnterpriseGroups)?this._checkEnterpriseGroupStore().then(a.hitch(this,
function(){esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin()||this._isCustomRole?this.community.getProfile(this.group.owner,a.hitch(this,this._handleGetGroupOwner),a.hitch(this,this._handleGetGroupOwner)):(this._isAdmin=!1,this.initializeGroup())})):esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin()||this._isCustomRole?this.community.getProfile(this.group.owner,a.hitch(this,this._handleGetGroupOwner),a.hitch(this,this._handleGetGroupOwner)):(this._isAdmin=!1,this.initializeGroup())):
(this._isAdmin=!1,this.initializeGroup())},_handleGetGroupOwner:function(a,c){a?a.error?this._isAdmin=!1:a&&a.orgId&&a.orgId===this._user.accountId&&this._user.email!==a.username?(this._isAdmin=!this._isCustomRole,this._groupUser=a):this._isAdmin=!1:this._isAdmin=!1;this.initializeGroup()},initializeGroup:function(){this.loadGroup(this.group);this._util.isPortal()&&this.group.provider&&this.group.providerGroupName?this._configureEnterpriseGroupMembership():arcgisonline.sharing.geow.Group.getGroupUsers(this.group.id,
a.hitch(this,this._handleGetGroupUsers));this._closeEdit();esriGeowConfig.showSocialMediaLinks&&(this._util.canSharePublic()&&(!this._isCustomRole||this._roleCanShareGroupToPublic))&&this._loadSocialNetworkBadges()},_configureEnterpriseGroupMembership:function(){var b=10>=a.isIE;a.attr(this._membersLabel,"innerHTML",this.i18n.membersLabel);a.empty(this._userList);a.create("span",{innerHTML:this.i18n.portalEnterpriseGroupLabel,style:{display:b?"":"block"}},this._userList);b?(a.create("br",null,this._userList),
a.create("br",null,this._userList)):a.create("br",this._userList);a.create("span",{innerHTML:this.group.providerGroupName,style:{display:b?"":"block",marginTop:"1em"}},this._userList)},_handleGetGroupUsers:function(b,c){if(b){this.groupUsers=b.users;this.loadGroupUsers(b.users);var d=b.users.length+1+" ",d=1!==b.users.length+1?d+this.i18n.membersLabel:d+this.i18n.memberLabel;a.attr(this._membersLabel,"innerHTML",d);if(!0===this._isAdmin||this._roleCanUpdate&&this._groupUser){for(var d=!1,e=0;e<b.users.length;e++)if(this._user.email===
b.users[e]){d=!0;break}d?(a.style(this._joinGroupButton.domNode,"display","none"),a.style(this._leaveGroupButton.domNode,"display","")):(a.style(this._leaveGroupButton.domNode,"display","none"),"private"!==this.group.access&&!this.group.isInvitationOnly&&(!this._isCustomRole||this._isAdmin&&this._groupUser||this._roleCanJoinOrgGroup||this._roleCanJoinNonOrgGroup)?a.style(this._joinGroupButton.domNode,"display",""):a.style(this._joinGroupButton.domNode,"display","none"));if(!this._isCustomRole||this._roleCanShareGroupToPublic||
this._roleCanShareItems)this._user.email===this.group.owner?(a.style(a.byId("shareByOwnerSpan"),"display",""),a.style(this._shareByOtherButton.domNode,"display","none")):(a.style(a.byId("shareByOwnerSpan"),"display","none"),a.style(this._shareByOtherButton.domNode,"display",""))}}},_handleGetApplications:function(b,c){b&&b.applications&&0<b.applications.length&&a.attr(this._membershipRequestButton,"label",this.i18n.membershipRequests+" ("+b.applications.length+")")},_handleMemberRequestsButtonClick:function(a){(a=
arcgisonline.sharing.dijit.dialog.MembershipRequestsDlg.prototype.statics.getInstance())&&a.show(this.groupId)},_handleInviteGroupButtonClick:function(b){b=arcgisonline.sharing.dijit.dialog.InviteUsersDlg.prototype.statics.getInstance();b.show(this.groupId,this.group,this._isSharedOwnership);var c=this.connect(b,"onAddNow",a.hitch(this,function(){a.disconnect(c);arcgisonline.sharing.geow.Group.getGroupUsers(this.group.id,a.hitch(this,this._handleGetGroupUsers))}))},loadGroup:function(b){this._editButton.set("disabled",
!0);null!==this._onApplicationAcceptConnect&&(a.unsubscribe(this._onApplicationAcceptConnect),this._onApplicationAcceptConnect=null);null!==this._onApplicationDeclineConnect&&(a.unsubscribe(this._onApplicationDeclineConnect),this._onApplicationDeclineConnect=null);var c=a.attr,d=a.create,e=a.clone(this._searchResults._queryStringParams),g={t:"content",f:"group:"+b.id,q:e.q};if((!e.q||null===e.q)&&(!e.sortField||null===e.sortField))g.sortField=this.group.sortField?this.group.sortField:"modified",g.sortOrder=
this.group.sortOrder?this.group.sortOrder:"desc";esri.isDefined(this._queryStringParams.sortField)||(this._sorter.sortField=this.group.sortField?this.group.sortField:"modified",this._sorter.sortOrder=this.group.sortOrder?this.group.sortOrder:"desc",this._sorter._redraw());if(this.group.userMembership&&this.group.userMembership.memberType){var f=this.group.userMembership.memberType;if("owner"===f||"admin"===f||this._isAdmin||this._roleCanUpdate&&this._groupUser)this._searchResults._unshareHandler=
a.hitch(this,this.unshareItem)}a.forEach(this.group.capabilities||[],a.hitch(this,function(a){a&&"updateitemcontrol"===a.toLowerCase()&&(this._isSharedOwnership=!0)}));this._searchResults.doQuery(a.mixin(e,g));this._userMembership=b.userMembership||null;null!==this._user?(this._canDisplayJoinLeave=this._determineIfUserCanJoinLeave(),this._canDisplayShare=this._determineIfUserCanShare(),"owner"===b.userMembership.memberType||this._isAdmin||this._roleCanUpdate&&this._groupUser?(a.query(".ownerOnly",
this.domNode).style("display",""),this._isAdmin||this._roleCanReassign||"owner"===b.userMembership.memberType&&esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin()?a.style(a.byId("reassignButtonSpan"),"display",""):a.style(a.byId("reassignButtonSpan"),"display","none"),this._isCustomRole&&(this._groupUser?(this._roleCanDelete||a.style(a.byId("deleteButtonSpan"),"display","none"),a.style(a.byId("membershipRequestSpan"),"display","none"),this._roleCanAssignToGroups||a.style(a.byId("inviteButtonSpan"),
"display","none")):this._roleCanCreate||(a.style(a.byId("editButtonSpan"),"display","none"),a.style(a.byId("deleteButtonSpan"),"display","none"),a.style(a.byId("inviteButtonSpan"),"display","none"),a.style(a.byId("membershipRequestSpan"),"display","none")),this._roleCanReassign?a.style(a.byId("reassignButtonSpan"),"display",""):a.style(a.byId("reassignButtonSpan"),"display","none"),this._canDisplayShare?a.style(a.byId("shareByOwnerSpan"),"display",""):a.style(a.byId("shareByOwnerSpan"),"display",
"none"),a.style(this._shareByOtherButton.domNode,"display","none"),this._canDisplayJoinLeave||(a.style(this._joinGroupButton.domNode,"display","none"),a.style(this._leaveGroupButton.domNode,"display","none")))):this._isCustomRole&&this._groupUser?(this._roleCanAssignToGroups&&a.style(a.byId("inviteButtonSpan"),"display",""),this._roleCanReassign?a.style(a.byId("reassignButtonSpan"),"display",""):a.style(a.byId("reassignButtonSpan"),"display","none"),this._roleCanDelete||a.style(a.byId("deleteButtonSpan"),
"display","none"),this._canDisplayShare?(a.style(a.byId("shareByOwnerSpan"),"display","none"),a.style(this._shareByOtherButton.domNode,"display","")):(a.style(a.byId("shareByOwnerSpan"),"display","none"),a.style(this._shareByOtherButton.domNode,"display","none"))):this._isCustomRole&&a.style(a.byId("deleteButtonSpan"),"display","none"),b.userMembership.applications&&0<b.userMembership.applications?(c(this._membershipRequestButton,"label",this.i18n.membershipRequests+" ("+b.userMembership.applications+
")"),a.style(a.byId("membershipRequestSpan"),"display","")):(c(this._membershipRequestButton,"label",this.i18n.membershipRequests),this._isAdmin&&arcgisonline.sharing.geow.Group.getApplications(b.id,a.hitch(this,this._handleGetApplications))),"none"===b.userMembership.memberType&&("public"===b.access||"org"===b.access)&&!b.isInvitationOnly?(this._canDisplayJoinLeave?a.style(this._joinGroupButton.domNode,"display",""):a.style(this._joinGroupButton.domNode,"display","none"),this._canDisplayShare&&!this._isAdmin&&
(!this._roleCanUpdate||!this._groupUser)?a.style(this._shareByOtherButton.domNode,"display",""):a.style(this._shareByOtherButton.domNode,"display","none")):"none"!==b.userMembership.memberType&&"owner"!==b.userMembership.memberType?(this._canDisplayJoinLeave?a.style(this._leaveGroupButton.domNode,"display",""):a.style(this._leaveGroupButton.domNode,"display","none"),this._canDisplayShare&&!this._isAdmin&&(!this._roleCanUpdate||!this._groupUser)?a.style(this._shareByOtherButton.domNode,"display",""):
a.style(this._shareByOtherButton.domNode,"display","none")):"none"===b.userMembership.memberType&&("public"===b.access&&b.isInvitationOnly)&&(this._canDisplayShare&&!this._isAdmin&&(!this._roleCanUpdate||!this._groupUser)?a.style(this._shareByOtherButton.domNode,"display",""):a.style(this._shareByOtherButton.domNode,"display","none"))):"public"===b.access&&!b.isInvitationOnly?(a.style(this._joinGroupButton.domNode,"display",""),a.style(this._shareByOtherButton.domNode,"display","")):"public"===b.access&&
b.isInvitationOnly&&a.style(this._shareByOtherButton.domNode,"display","");null!==b.thumbnail&&(c(this._thumbnail,"src",esriGeowConfig.restBaseUrl+"community/groups/"+b.id+"/info/"+b.thumbnail+this.token),c(this._thumbnailEdit,"src",esriGeowConfig.restBaseUrl+"community/groups/"+b.id+"/info/"+b.thumbnail+this.token));c("groupsTitle2","innerHTML",b.title);d("span",{innerHTML:null!==b.snippet&&0!==a.trim(b.snippet).length?b.snippet:this.i18n.defaultSummary},this._summary,"only");d("span",{innerHTML:null===
b.description||0===a.trim(b.description).length||"\x3cbr /\x3e"===a.trim(b.description)?this.i18n.defaultDescription:b.description},this._description,"only");d("a",{innerHTML:b.owner,owner:b.owner,"class":"linkNoHref",onclick:a.hitch(this,this._showProfile)},this._ownerLabel,"only");"public"==b.access?(c(this._statusLabel,"innerHTML",this.i18n.accessPublic),!this._isPortal&&(!0===b.isOpenData&&esriGeowConfig.openDataConfigEnabled)&&c(this._statusLabel,"innerHTML",c(this._statusLabel,"innerHTML")+
" "+this.i18n.accessOpenData)):"org"===b.access?c(this._statusLabel,"innerHTML",this.i18n.accessAccount):c(this._statusLabel,"innerHTML",this.i18n.accessPrivate);this._isSharedOwnership&&c(this._statusLabel,"innerHTML",c(this._statusLabel,"innerHTML")+"\x3cspan\x3e"+this.i18n.sharedOwnership+"\x3c/span\x3e");b.isViewOnly?c(this._contributorLabel,"innerHTML",this.i18n.onlyAdminContribute):c(this._contributorLabel,"innerHTML",this.i18n.allMembersContribute);var h=d("span",{"class":"esriItemTags"});
a.forEach(b.tags,function(a,c){a=this._util.htmlEncode(a);d("a",{href:"search.html?t\x3dgroups\x26q\x3dtags:"+a,innerHTML:a},h);c<b.tags.length-1&&h.appendChild(document.createTextNode(", "))},this);a.place(h,this._tags,"only");this._edit_tags.set("tabIndex",4);(this._isAdmin||this._roleCanUpdate)&&this._groupUser?this._util.loadUserTags(this._groupUser.username).then(a.hitch(this,function(a){this._edit_tags.set("knownTags",a);this._editButton.set("disabled",!1)})):this._user&&this._user.username&&
this._util.loadUserTags(this._user.username).then(a.hitch(this,function(a){this._edit_tags.set("knownTags",a);this._editButton.set("disabled",!1)}));this._onApplicationAcceptConnect=a.subscribe("onApplicationAccept",this,function(){this.refreshGroup(this.groupId)});this._onApplicationDeclineConnect=a.subscribe("onApplicationDecline",this,function(){this.refreshGroup(this.groupId)})},_showProfile:function(b){var c=a.attr(b.currentTarget,"owner"),d=arcgisonline.sharing.dijit.ProfilePopup.prototype.statics.getInstance();
null!==d&&a.hitch(d,d.showProfile,c,b.currentTarget).call()},loadGroupUsers:function(b){a.empty(this._userList);a.create("a",{innerHTML:this.group.owner,owner:this.group.owner,"class":"linkNoHref",onclick:a.hitch(this,this._showProfile)},a.create("span",{style:{display:"block"}},this._userList));a.forEach(b,function(b){var d=a.create("span",{style:{display:"block"}},this._userList);a.create("a",{innerHTML:b,owner:b,"class":"linkNoHref",onclick:a.hitch(this,this._showProfile)},d);if(this.group.userMembership&&
"owner"===this.group.userMembership.memberType||this._isAdmin||this._roleCanAssignToGroups&&this._groupUser)b=a.create("a",{onclick:a.hitch(this,this._removeUser,b),href:"#"},d),a.create("img",{src:this._util.relativeToExplicitUrl("images/delete_20x20.png"),alt:this.i18n.removeUserFromGroup,title:this.i18n.removeUserFromGroup,style:{verticalAlign:"middle"}},b)},this)},_removeUser:function(b,c){arcgisonline.sharing.geow.Group.removeFromGroup(this.groupId,b);a.stopEvent(c)},loadConnections:function(){this._edit_title.set("tabIndex",
1);this._edit_summary.setAttribute("tabIndex",2);a.attr(this._edit_description.domNode,"tabIndex",3)},toggleDescription:function(b){b.preventDefault();"none"===a.style(this._description,"display")?(a.style(this._description,"display","block"),a.style(this._toggleDown,"display","none"),a.style(this._toggleUp,"display","")):(a.style(this._description,"display","none"),a.style(this._toggleUp,"display","none"),a.style(this._toggleDown,"display",""))},refreshGroup:function(b){this.community.getGroup(b,
a.hitch(this,this._handleGetGroup))},reassignGroup:function(b){b={id:this._user.accountId,currentUser:this.group.owner,title:this.i18n.changeOwner,message:this.i18n.selectNewGroupOwner};this._isPortal&&(this.group.provider&&this.group.provider===this._enterpriseProvider&&this.group.providerGroupName)&&(b.provider=this.group.provider,b.groupId=this.group.id);this._isSharedOwnership&&(b.adminOnly=!0);arcgisonline.sharing.dijit.dialog.SelectAccountUserDlg.prototype.statics.getInstance().show(b,a.hitch(this,
this.changeGroupOwner))},_retrieveMaxGroupsFromErrorMessage:function(a){var c=/'(\d*)?'/,d,e;try{if(null!==(e=c.exec(a))){if(d=parseInt(e[e.length-1],10),!esri.isDefined(d)||isNaN(d))d=this.maxGroupsDefault}else d=this.maxGroupsDefault}catch(g){d=this.maxGroupsDefault}return d},changeGroupOwner:function(b){this.community.reassignGroup(this.group,b,a.hitch(this,function(a,b){window.location=esriGeowConfig.baseUrl+"group.html?id\x3d"+this.group.id}),a.hitch(this,function(a){var d=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),
e=this.i18n.error.cantReassignGroup;a&&a.messageCode&&"COM_1065"===a.messageCode?(a=this._retrieveMaxGroupsFromErrorMessage(a.message),e=esri.substitute({name:b,numGroups:a},this.i18n.error.groupMaxOtherUser),d.show({title:this.i18n.error.errorReassignGroup,message:this.i18n.error.cantCreateGroup+" "+e})):a&&a.messageCode&&"COM_1076"===a.messageCode?d.show({title:this.i18n.error.errorReassignGroup,message:esri.substitute({name:b},this.i18n.error.errorReassignGroupOpenData)}):d.show({title:this.i18n.error.errorReassignGroup,
message:e})}))},deleteGroup:function(b){this.group.userMembership&&"owner"===this.group.userMembership.memberType||this._isAdmin||this._roleCanDelete&&this._groupUser?(b=arcgisonline.sharing.dijit.dialog.DeleteWarningDlg.prototype.statics.getInstance(),b.show(1,this.i18n.deleteGroupType,a.hitch(this,"reallyDeleteGroup"))):(b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),b.show({title:this.i18n.deleteGroup,message:this.i18n.permissionToDelete}));return!1},reallyDeleteGroup:function(b){this.community.deleteGroup(this.group,
function(){window.location="groups.html"},a.hitch(this,function(a){arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorTitle,message:this.i18n.error.removeItemsBeforeDelete})}))},shareGroup:function(){arcgisonline.sharing.dijit.dialog.ShareGroupDlg.prototype.statics.getInstance().show(this.group,this._user,this._groupUser,this._isAdmin)},unshareItem:function(b,c){arcgisonline.sharing.dijit.dialog.DeleteWarningDlg.prototype.statics.getInstance().showMsgTitleButton(this.i18n.removeItemFromGroup,
this.i18n.removeItem,this.i18n.yesLabel,a.hitch(this,this.reallyUnshareItem,b,c))},reallyUnshareItem:function(b,c){a.style(c,"display","none");this._util.request({url:esriGeowConfig.restBaseUrl+"content/users/"+this._user.username+"/unshareItems",content:{items:b,groups:this.group.id}},{usePost:!0}).then(a.hitch(this,function(b){b.results&&b.results[0]&&!0===b.results[0].success&&b.results[0].notUnsharedFrom&&0===b.results[0].notUnsharedFrom.length?a.destroy(c):(a.style(c,"display",""),arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorTitle,
message:this.i18n.error.unableToRemoveItem}),console.log(b))}))},startEdit:function(){this._onOnloadConnect=a.connect(window,"onbeforeunload",this,"_unload");this._openEdit();if(this.isNewGroup){this._util.loadUserTags(this._user.username).then(a.hitch(this,function(a){this._edit_tags.set("knownTags",a)}));a.connect(this._edit_title,"onFocus",this,this._title_onFocus);a.connect(this._edit_description,"onFocus",this,this._description_onFocus);a.addClass(this._edit_title,"dim");a.addClass(this._edit_description,
"dim");this._edit_title.set("value",this.defaultTextTitle);this._edit_description.set("value",this.defaultTextDescription);if(this._isAdmin||esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin())esri.show(a.byId("allowSharedOwnershipDiv")),this._createTooltip("_edit_allowSharedOwnershipTip",this.i18n.sharedOwnershipTip);this._organization&&!1===this._organization.canSharePublic&&!this._isAdmin&&(!esriGeowConfig.userRole||!esriGeowConfig.userRole.isAdmin())?(a.style(a.byId("edit-public_div"),
"display","none"),this._edit_account.set("checked",!0),a.style(a.byId("allowOpenDataDiv"),"display","none"),this._edit_allowOpenData.set("checked",!1)):(this._edit_public.set("checked",!0),!this._isPortal&&this._user.accountId&&esriGeowConfig.openDataConfigEnabled&&esriGeowConfig.self.portalProperties&&esriGeowConfig.self.portalProperties.openData&&!0===esriGeowConfig.self.portalProperties.openData.enabled&&(esriGeowConfig.userRole.isAdmin()||this._roleCanDesignateOpenData)?a.style(a.byId("allowOpenDataDiv"),
"display",""):a.style(a.byId("allowOpenDataDiv"),"display","none"));this._edit_allowApply.set("checked",!0);this._isCustomRole&&(this._roleCanShareGroupToPublic||(a.style(a.byId("edit-public_div"),"display","none"),this._edit_account.set("checked",!0)),this._roleCanShareGroupToOrg||(a.style(a.byId("edit-account_div"),"display","none"),this._edit_private.set("checked",!0)),!this._roleCanShareGroupToPublic&&!this._roleCanShareGroupToOrg&&(a.style(a.byId("allowApplyDiv"),"display","none"),a.style(a.byId("_edit_private").parentNode,
"display","none")));this._isPortal&&this._supportsEnterpriseGroups&&(a.style(a.byId("allowApplyDiv"),"display","none"),a.style(a.byId("enterpriseGroupDiv"),"display",""),this._edit_allowApply.get("checked")?this._enterprise_apply.set("checked",!0):this._enterprise_invite.set("checked",!0),a.style(this._enterprise_group_select,"display",""),this._enterpriseGroupSelectBtn.set("disabled",!0));this._user.accountId||(a.style(this._edit_public.domNode,"display","none"),this._edit_public.set("checked",!0),
a.style(a.byId("allowOpenDataDiv"),"display","none"),this._edit_allowOpenData.set("checked",!1));this._edit_all_members.set("checked",!0);this.group&&this.group.sortField?this._edit_sortField.set("value",this.i18n.sortFields[this.group.sortField]):this._edit_sortField.set("value",this.i18n.sortFields.title);this._edit_sortOrder.set("checked",!(this.group&&this.group.sortOrder&&"desc"===this.group.sortOrder));this._thumbnailEdit.src=this._util.relativeToExplicitUrl("images/group-thumbnail.png");a.style(this._changeThumbLabel,
"display","none");this._isCustomRole&&!this._roleCanCreate&&(h.byId("_upperSave").set("disabled",!0),h.byId("_lowerSave").set("disabled",!0))}else this._edit_title.set("value",this.group.title||""),this._edit_summary.value=this.group.snippet||"",this._edit_description.set("value",this.group.description||""),this._edit_tags.set("tags",this.group.tags),this._edit_allowApply.set("checked",!this.group.isInvitationOnly),this._isSharedOwnership&&(esri.show(a.byId("allowSharedOwnershipDiv")),this._edit_allowSharedOwnership.set("checked",
!0),this._edit_allowSharedOwnership.set("disabled",!0),this._createTooltip("_edit_allowSharedOwnershipTip",this.i18n.sharedOwnershipTip)),"public"===this.group.access?(this._edit_public.set("checked",!0),this._user.accountId||(a.style(this._edit_public.domNode,"display","none"),a.style(a.byId("allowOpenDataDiv"),"display","none"),this._edit_allowOpenData.set("checked",!1)),!this._isPortal&&this._user.accountId&&esriGeowConfig.openDataConfigEnabled&&esriGeowConfig.self.portalProperties&&esriGeowConfig.self.portalProperties.openData&&
!0===esriGeowConfig.self.portalProperties.openData.enabled&&(esriGeowConfig.userRole.isAdmin()||this._roleCanDesignateOpenData)?a.style(a.byId("allowOpenDataDiv"),"display",""):a.style(a.byId("allowOpenDataDiv"),"display","none"),this._edit_allowOpenData.set("checked",esri.isDefined(this.group.isOpenData)?this.group.isOpenData:!1)):("org"===this.group.access?this._edit_account.set("checked",!0):(this._edit_private.set("checked",!0),a.style(a.byId("allowApplyDiv"),"display","none")),a.style(a.byId("allowOpenDataDiv"),
"display","none"),this._edit_allowOpenData.set("checked",!1)),this._isCustomRole&&(this._roleCanShareGroupToPublic||a.style(a.byId("edit-public_div"),"display","none"),this._roleCanShareGroupToOrg||a.style(a.byId("edit-account_div"),"display","none"),!this._roleCanShareGroupToPublic&&!this._roleCanShareGroupToOrg&&(a.style(a.byId("allowApplyDiv"),"display","none"),this._edit_private.set("checked",!0),a.style(a.byId("_edit_private").parentNode,"display","none")),this._roleCanDesignateOpenData||a.style(a.byId("allowOpenDataDiv"),
"display","none")),this._isPortal&&this._supportsEnterpriseGroups&&(a.style(a.byId("allowApplyDiv"),"display","none"),a.style(a.byId("enterpriseGroupDiv"),"display",""),this.group.provider&&this.group.providerGroupName?(this._enterprise_group.set("checked",!0),this._enterpriseGroupSelectBtn.set("disabled",!1),a.attr(this._enterprise_group_name,"innerHTML",this.group.providerGroupName),!esriGeowConfig.userRole||!esriGeowConfig.userRole.isAdmin()&&!this._roleCanManageEnterpriseGroups?a.style(this._enterprise_group_select,
"display","none"):a.style(this._enterprise_group_select,"display","")):(this._edit_allowApply.get("checked")?this._enterprise_apply.set("checked",!0):this._enterprise_invite.set("checked",!0),this._enterpriseGroupSelectBtn.set("disabled",!0))),this._isPortal&&(this.group.provider&&this.group.providerGroupName)&&a.style(a.byId("allowApplyDiv"),"display","none"),this.group.isViewOnly?this._edit_only_admins.set("checked",!0):this._edit_all_members.set("checked",!0),this.group.sortField?this._edit_sortField.set("value",
this.i18n.sortFields[this.group.sortField]):this._edit_sortField.set("value",this.i18n.sortFields.title),this._edit_sortOrder.set("checked",!(this.group.sortOrder&&"desc"===this.group.sortOrder)),this.group.thumbnail||(this._thumbnailEdit.src=this._util.relativeToExplicitUrl("images/group-thumbnail.png"))},onSelectEnterpriseGroup:function(){var a=this._enterprise_group_input.get("value");arcgisonline.sharing.dijit.dialog.SelectEnterpriseGroupDlg.prototype.statics.getInstance().show(a)},saveEdit:function(){if(this.validate()){if(this._util.removeHTMLTags(this._edit_description.getValue())===
this.defaultTextDescription)this._form_groupDescription.set("value","");else{var b=this._edit_description.getValue();b&&(b=b.replace(/"'/g,'"').replace(/'"/g,'"'));this._form_groupDescription.set("value",b)}b=a.trim(this._edit_title.get("value"));if(0===b.length)b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),b.show({title:this.i18n.groupTitle,message:this.i18n.error.provideName});else if(-1<b.indexOf("\x3c")||-1<b.indexOf("\x3e")||-1<b.indexOf("%"))b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),
b.show({title:this.i18n.groupTitle,message:this.i18n.error.specialCharactersError});else{this._form_groupTitle.set("value",b);b="private";this._edit_public.get("checked")?(b="public",esriGeowConfig.userRole&&(esriGeowConfig.userRole.isAdmin()||this._roleCanDesignateOpenData)?this._form_groupIsOpenData.set("value",this._edit_allowOpenData.get("checked")?"true":"false"):this._form_groupIsOpenData.set("value","false")):(this._edit_account.checked&&(b="org"),this._form_groupIsOpenData.set("value","false"));
var c=this._edit_allowApply.get("checked");this._isPortal&&this._supportsEnterpriseGroups?(c=this._enterprise_apply.get("checked"),this._enterprise_group.get("checked")?esriGeowConfig.userRole&&(esriGeowConfig.userRole.isAdmin()||this._roleCanManageEnterpriseGroups)?(this._form_groupProvider.set("value",this._enterpriseProvider),this._form_groupProviderGroupName.set("value",this._enterprise_group_input.get("value"))):(this._form_groupProvider.set("value",this.group.provider),this._form_groupProviderGroupName.set("value",
this.group.providerGroupName)):(this._form_groupProvider.set("value",""),this._form_groupProviderGroupName.set("value",""))):this._isPortal&&(this.group&&this.group.provider&&this.group.providerGroupName)&&(this._form_groupProvider.set("value",this.group.provider),this._form_groupProviderGroupName.set("value",this.group.providerGroupName),c=!this.group.isInvitationOnly);var d=this._form_groupProviderGroupName.get("value");this._form_groupTags.set("value",this._edit_tags.get("tags"));this._form_groupSummary.set("value",
this._edit_summary.value);this._form_groupAccess.set("value",b);this._form_groupIsInvitationOnly.set("value",c?"false":"true");this._form_groupIsViewOnly.set("value",this._edit_only_admins.get("checked")?"true":"false");this._form_groupCapabilities.set("value",this._edit_allowSharedOwnership.get("checked")?"updateitemcontrol":"");b="title";c=this._edit_sortField.get("value");c===this.i18n.sortFields.title?b="title":c===this.i18n.sortFields.owner?b="owner":c===this.i18n.sortFields.avgrating?b="avgrating":
c===this.i18n.sortFields.numviews?b="numviews":c===this.i18n.sortFields.modified?b="modified":"name"===this.group.sortField&&0===c.length&&(b="name");this._form_groupSortField.set("value",b);this._form_groupSortOrder.set("value",this._edit_sortOrder.get("checked")?"asc":"desc");a.disconnect(this._onOnloadConnect);a.style(this._thumbnailDiv,"display","none");a.style(this._thumbnailEdit,"display","none");this.isNewGroup?this._isPortal&&this._supportsEnterpriseGroups&&esri.isDefined(d)&&this._enterprise_group.get("checked")?
arcgisonline.sharing.dijit.dialog.SelectEnterpriseGroupDlg.prototype.statics.getInstance()._searchEnterpriseGroups(d,10).then(a.hitch(this,function(b){b&&b.groups&&0<b.groups.length&&b.groups[0]&&this._enterpriseGroupMatches(b.groups[0].rolename,d)?(this._form_groupProviderGroupName.set("value",b.groups[0].rolename),this.community.createGroup(this._form,a.hitch(this,this._handleCreateGroup),a.hitch(this,this._handleCreateGroup))):arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.invalidEnterpriseGroupTitle,
message:this.i18n.enterpriseGroups.invalidEnterpriseGroup})}),a.hitch(this,function(a){arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorTitle,message:this.i18n.enterpriseGroups.searchEnterpriseGroupFailure})})):this.community.createGroup(this._form,a.hitch(this,this._handleCreateGroup),a.hitch(this,this._handleCreateGroup)):(this._form_groupId.set("value",this.groupId),this._checkForOtherGroupBySameName().then(a.hitch(this,function(b){b?arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.error.errorUpdatingGroup,
message:this.i18n.error.cantUpdateGroup+" "+esri.substitute({name:this._form_groupTitle.get("value")},this.i18n.error.nonUniqueName)}):this._isPortal&&this._supportsEnterpriseGroups&&esri.isDefined(d)&&this._enterprise_group.get("checked")?arcgisonline.sharing.dijit.dialog.SelectEnterpriseGroupDlg.prototype.statics.getInstance()._searchEnterpriseGroups(d,10).then(a.hitch(this,function(b){b&&b.groups&&0<b.groups.length&&b.groups[0]&&this._enterpriseGroupMatches(b.groups[0].rolename,d)?(this._form_groupProviderGroupName.set("value",
b.groups[0].rolename),this.community.updateGroup(this.groupId,this._form,a.hitch(this,this._handleUpdateGroup),a.hitch(this,this._handleUpdateGroup))):arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.invalidEnterpriseGroupTitle,message:this.i18n.enterpriseGroups.invalidEnterpriseGroup})}),a.hitch(this,function(a){arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorTitle,message:this.i18n.enterpriseGroups.searchEnterpriseGroupFailure})})):
this.community.updateGroup(this.groupId,this._form,a.hitch(this,this._handleUpdateGroup),a.hitch(this,this._handleUpdateGroup))})))}}},_enterpriseGroupMatches:function(a,c){return esri.isDefined(a)&&esri.isDefined(c)&&a.toLowerCase()===c.toLowerCase()},_checkForOtherGroupBySameName:function(){var b=new a.Deferred,c=this._form_groupTitle.get("value"),d=!1;this.community.searchGroups('title:"'+c+'" owner:'+this.group.owner+" -id:"+this.group.id,a.hitch(this,function(a){a&&(0<a.results.length&&a.results[0]&&
a.results[0].title&&a.results[0].title===c)&&(d=!0);b.resolve(d)}),a.hitch(this,function(a){b.resolve(d)}));return b},validate:function(){var b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),c=a.trim(this._edit_title.get("value"));return this._edit_title.get("value")===this.defaultTextTitle||0===c.length?(b.show({title:this.i18n.groupTitle,message:this.i18n.error.provideName}),!1):250<this._edit_summary.value.length?(b.show({title:this.i18n.groupTitle,message:a.string.substitute(this.i18n.summaryInvalidMsg,
{length:this._edit_summary.value.length})}),!1):0===this._edit_tags.get("tags").length?(b.show({title:this.i18n.groupTitle,message:this.i18n.enterTags}),!1):!this.isNewGroup&&!0===this._edit_private.get("checked")&&arcgisonline.sharing.util.groupUsedInOrgSettings(this.group.id)?(b.show({title:this.i18n.groupTitle,message:arcgisonline.sharing.util.isPortal()?this.i18n.error.usedInPortalSettings:this.i18n.error.usedInOrgSettings}),!1):!0},_handleCreateGroup:function(b,c){if(b.success)window.location=
"group.html?id\x3d"+b.group.id;else{var d=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),e=["SB_0001","SB_0002","SB_0003","SB_0004"],g=["SB_0005","SB_0006","SB_0007"];b&&-1!==a.indexOf(e,b.messageCode)?arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg.prototype.statics.getInstance().show(esriGeowConfig.self.subscriptionInfo):b&&-1!==a.indexOf(g,b.messageCode)?arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg.prototype.statics.getInstance().showOther(b.messageCode):
b&&b.message&&-1<b.message.indexOf("file exceeds the max size")?(d.show({title:this.i18n.addThumbnailError,message:b.message}),setTimeout(a.hitch(this,function(){window.location="group.html?owner\x3d"+encodeURIComponent(this._user.email)+"\x26title\x3d"+encodeURIComponent(this._form_groupTitle.getValue())}),3E3)):b&&b.messageCode&&"COM_0044"===b.messageCode?b.details&&b.details[0]&&-1<b.details[0].indexOf("open data")?d.show({title:this.i18n.error.errorCreatingGroup,message:this.i18n.error.cantEnableOpenData}):
(e=esri.substitute({name:this._form_groupTitle.get("value")},this.i18n.error.nonUniqueName),d.show({title:this.i18n.error.errorCreatingGroup,message:this.i18n.error.cantCreateGroup+" "+e})):b&&b.messageCode&&"COM_1064"===b.messageCode?(e=this._retrieveMaxGroupsFromErrorMessage(b.message),e=esri.substitute({numGroups:e},this.i18n.error.groupMax),d.show({title:this.i18n.error.errorCreatingGroup,message:this.i18n.error.cantCreateGroup+" "+e})):(console.log(b.message+"  "+b.details),d.show({title:this.i18n.error.errorCreatingGroup,
message:this.i18n.error.cantCreateGroup}))}},_handleUpdateGroup:function(b,c){if(b.success){var d=encodeURIComponent(this._form_groupTitle.getValue()),e=esri.urlToObject(window.location.href);if(e.query.title&&d!==e.query.title){e.query.title=d;var d=e.path,g="?",f;for(f in e.query)e.query.hasOwnProperty(f)&&(d+=g+f+"\x3d"+e.query[f],g="\x26");document.location=d}else this.refreshGroup(this.groupId)}else e=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),f=b.error||b,d=
["SB_0001","SB_0002","SB_0003","SB_0004"],g=["SB_0005","SB_0006","SB_0007"],f&&-1!==a.indexOf(d,f.messageCode)?arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg.prototype.statics.getInstance().show(esriGeowConfig.self.subscriptionInfo):f&&-1!==a.indexOf(g,f.message)?arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg.prototype.statics.getInstance().showOther(f.messageCode):f&&f.message&&-1<f.message.indexOf("file exceeds the max size")?e.show({title:this.i18n.addThumbnailError,message:f.message}):
f&&f.code&&f.messageCode&&f.details&&f.details[0]&&"COM_0047"===f.messageCode&&-1<f.details[0].indexOf("open data")?e.show({title:this.i18n.error.errorUpdatingGroup,message:this.i18n.error.cantEnableOpenData}):f&&f.code&&f.messageCode&&"COM_0061"===f.messageCode?e.show({title:this.i18n.error.errorUpdatingGroup,message:this.i18n.error.removeUsersBeforeLinking}):e.show({title:this.i18n.error.errorUpdatingGroup,message:f.message+"  "+f.details}),null!==this.group.thumbnail&&a.attr(this._thumbnail,"src",
esriGeowConfig.restBaseUrl+"community/groups/"+this.group.id+"/info/"+this.group.thumbnail+this.token)},cancelEdit:function(){a.disconnect(this._onOnloadConnect);this._form.reset();a.style(this._thumbnailDiv,"display","none");a.style(this._thumbnailEdit,"display","none");this.isNewGroup?window.location="groups.html":this._closeEdit()},_openEdit:function(){this._edit_description._started||this._edit_description.startup();this._groupButtonsView=a.query(".group_buttons").filter(function(b){return"none"!==
a.style(b,"display")});a.style(this._menuButtons,"display","none");a.query(".group_buttons").style("display","none");a.query(".readOnly",this.domNode).style("display","none");a.query(".editOnly",this.domNode).style("display","");a.addClass(this._thumbnailEdit,"linkNoHref");a.style(this._thumbnailDiv,"display","");a.style(this._thumbnailEdit,"display","");this._organization&&(!1===this._organization.canSharePublic&&!this._isAdmin&&(!esriGeowConfig.userRole||!esriGeowConfig.userRole.isAdmin()))&&a.style(a.byId("edit-public_div"),
"display","none");this._edit_sortFieldStore||(this._edit_sortFieldStore=new a.store.Memory({data:[{id:"title",name:this.i18n.sortFields.title},{id:"owner",name:this.i18n.sortFields.owner},{id:"avgrating",name:this.i18n.sortFields.avgrating},{id:"numviews",name:this.i18n.sortFields.numviews},{id:"modified",name:this.i18n.sortFields.modified}]}),this._edit_sortField.set("store",this._edit_sortFieldStore));a.addClass(this._edit_sortField.domNode,"shortComboBox");(!this._user.accountId||""===this._user.accountId)&&
a.style(a.byId("edit-account_div"),"display","none");if(!this._user.accountId&&(this.isNewGroup||this.group&&"private"!==this.group.access))this._edit_private.set("disabled",!0),this._edit_account.set("disabled",!0),this.group&&"org"!==this.group.access&&this._edit_public.set("disabled",!0),a.style(a.byId("edit-private_div"),"display","none");this._isPortal&&this._supportsEnterpriseGroups&&(this._enterprise_group_input.set("placeholder",this.i18n.enterpriseGroups.namePlaceholder),this.group&&(this.group.provider&&
this.group.providerGroupName)&&this._enterprise_group_input.set("value",this.group.providerGroupName));this.editConnects.push(a.connect(this._thumbnailEdit,"onclick",this,"_showThumbnailDialog"));this.editConnects.push(a.connect(a.byId("group-thumbnail-close"),"onclick",this,"_thumbnailCancel"));this.editConnects.push(a.connect(a.byId("group-thumbnail-ok"),"onclick",this,"_thumbnailOk"));this.editConnects.push(a.connect(a.byId("group-thumbnail-cancel"),"onclick",this,"_thumbnailCancel"))},_determineIfUserCanJoinLeave:function(){return!this._isCustomRole||
this._isAdmin&&this._groupUser||this._roleCanJoinOrgGroup&&this._groupUser||(this._roleCanJoinOrgGroup||this._roleCanJoinNonOrgGroup)&&!this._groupUser},_determineIfUserCanShare:function(){return!this._isCustomRole||this._roleCanShareGroupToPublic},_closeEdit:function(){this.thumbnailPath.value="";a.forEach(this.editConnects,function(b){a.disconnect(b)});this.editConnects=[];a.removeClass(this._thumbnailEdit,"linkNoHref");a.query(".editOnly",this.domNode).style("display","none");a.query(".readOnly",
this.domNode).style("display","");esri.isDefined(this._canDisplayJoinLeave)||(this._canDisplayJoinLeave=this._determineIfUserCanJoinLeave());esri.isDefined(this._canDisplayShare)||(this._canDisplayShare=this._determineIfUserCanShare());this._isCustomRole&&!this._groupUser&&(this._roleCanCreate||(a.style(a.byId("editButtonSpan"),"display","none"),a.style(a.byId("deleteButtonSpan"),"display","none"),a.style(a.byId("inviteButtonSpan"),"display","none"),a.style(a.byId("membershipRequestSpan"),"display",
"none")),this._canDisplayShare?a.style(a.byId("shareByOwnerSpan"),"display",""):a.style(a.byId("shareByOwnerSpan"),"display","none"),a.style(this._shareByOtherButton.domNode,"display","none"),this._canDisplayJoinLeave||(a.style(this._joinGroupButton.domNode,"display","none"),a.style(this._leaveGroupButton.domNode,"display","none")));a.style(this._menuButtons,"display","");a.forEach(this._groupButtonsView,function(b){a.style(b,"display","")});this.group.provider===this._enterpriseProvider&&(a.style(a.byId("inviteButtonSpan"),
"display","none"),a.style(a.byId("membershipRequestSpan"),"display","none"),a.style(this._joinGroupButton.domNode,"display","none"),a.style(this._leaveGroupButton.domNode,"display","none"))},_showThumbnailDialog:function(b){var c=a.position(this._thumbnailDiv);a.style(a.byId("group-thumbnail-dialog"),"top",Math.round(c.y-20)+"px");a.style(a.byId("group-thumbnail-dialog"),"left",(esriGeowConfig.isRightToLeft?Math.round(c.x)+c.w-a.style("group-thumbnail-dialog","width"):Math.round(c.x))+"px");a.style(a.byId("group-thumbnail-dialog"),
"display","block");b.stopPropagation()},_thumbnailOk:function(){var b=a.byId("group-thumbnail-file").value,c=b.lastIndexOf("."),b=b.substring(c+1,b.length).toLowerCase();"png"!=b&&"gif"!=b&&"jpg"!=b&&"jpeg"!=b?arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorLabel,message:this.i18n.error.notSupportedImageType}):(""!==a.byId("group-thumbnail-file").value&&(this._thumbnail.src=this._util.relativeToExplicitUrl("images/group-thumbnail-update.png"),
this._thumbnailEdit.src=this._util.relativeToExplicitUrl("images/group-thumbnail-update.png")),a.style(a.byId("group-thumbnail-dialog"),"display","none"))},_thumbnailCancel:function(b){a.style(a.byId("group-thumbnail-dialog"),"display","none");a.forEach(this.editConnects,function(b){a.disconnect(b)});this.editConnects=[];a.byId("group-thumbnail-dialog").innerHTML=a.byId("group-thumbnail-dialog").innerHTML;this.editConnects.push(a.connect(this._thumbnailEdit,"onclick",this,"_showThumbnailDialog"));
this.editConnects.push(a.connect(a.byId("group-thumbnail-close"),"onclick",this,"_thumbnailCancel"));this.editConnects.push(a.connect(a.byId("group-thumbnail-ok"),"onclick",this,"_thumbnailOk"));this.editConnects.push(a.connect(a.byId("group-thumbnail-cancel"),"onclick",this,"_thumbnailCancel"))},_title_onFocus:function(b){this._edit_title.getValue()===this.defaultTextTitle&&(this._edit_title.set("value",""),a.removeClass(this._edit_title,"dim"));this._edit_title.focus()},_description_onFocus:function(b){this._util.removeHTMLTags(this._edit_description.getValue())===
this.defaultTextDescription&&(this._edit_description.set("value",""),a.removeClass(this._edit_description,"dim"));this._edit_description.focus()},_loadSocialNetworkBadges:function(){this._util.getSocialNetworkBadges(this.group,a.hitch(this,function(b){a.empty(this._connectContainer);for(var c in b)b.hasOwnProperty(c)&&a.place(b[c],this._connectContainer)}))},_createTooltip:function(a,c,d,e){return new h.Tooltip({label:'\x3cdiv style\x3d"max-width:'+(e||300)+'px;"\x3e'+c+"\x3c/div\x3e",connectId:[a],
id:"tooltip_"+a,showDelay:d||200})},joinGroup:function(b){null!==this._user?(b=arcgisonline.sharing.dijit.dialog.JoinGroupDlg.prototype.statics.getInstance(),this._isAdmin?b.show(this.groupId,a.hitch(this,function(b,d){arcgisonline.sharing.geow.Group.getApplications(this.group.id,a.hitch(this,this._handleGetApplications))})):b.show(this.groupId)):this._util.requireAuthentication()},confirmLeaveGroup:function(b){arcgisonline.sharing.dijit.dialog.DeleteWarningDlg.prototype.statics.getInstance().showMsgTitleButton(this.i18n.leaveGroupConfirm,
this.i18n.leaveGroup,this.i18n.leaveGroup,a.hitch(this,this.leaveGroup,b))},leaveGroup:function(b){this.community.leaveGroup(this.group,a.hitch(this,this.updateAfterLeave))},updateAfterLeave:function(){"public"===this.group.access||"org"===this.group.access?(a.style(this._leaveGroupButton.domNode,"display","none"),("public"===this.group.access||"org"===this.group.access)&&!this.group.isInvitationOnly&&(!this._isCustomRole||this._isAdmin&&this._groupUser||this._roleCanJoinOrgGroup||this._roleCanJoinNonOrgGroup)?
a.style(this._joinGroupButton.domNode,"display","block"):a.style(this._joinGroupButton.domNode,"display","none"),this.refreshGroup(this.groupId)):window.location="groups.html"},onPrivateSelected:function(b){h.getEnclosingWidget(b.target).checked&&(this._isPortal&&this._supportsEnterpriseGroups?(a.style(a.byId("enterpriseApplyDiv"),"display","none"),this._enterprise_apply.get("checked")&&this._enterprise_invite.set("checked",!0)):a.style(a.byId("allowApplyDiv"),"display","none"),a.style(a.byId("allowOpenDataDiv"),
"display","none"))},onNotPublicSelected:function(b){h.getEnclosingWidget(b.target).checked&&(this._isPortal&&this._supportsEnterpriseGroups?a.style(a.byId("enterpriseApplyDiv"),"display",""):this._isPortal&&this.group&&this.group.provider&&this.group.providerGroupName?a.style(a.byId("allowApplyDiv"),"display","none"):a.style(a.byId("allowApplyDiv"),"display",""),a.style(a.byId("allowOpenDataDiv"),"display","none"))},onPublicSelected:function(b){h.getEnclosingWidget(b.target).checked&&(this._isPortal&&
this._supportsEnterpriseGroups?a.style(a.byId("enterpriseApplyDiv"),"display",""):this._isPortal&&this.group&&this.group.provider&&this.group.providerGroupName?a.style(a.byId("allowApplyDiv"),"display","none"):a.style(a.byId("allowApplyDiv"),"display",""),!this._isPortal&&esriGeowConfig.userRole&&(esriGeowConfig.userRole.isAdmin()||this._roleCanDesignateOpenData)&&esriGeowConfig.openDataConfigEnabled?a.style(a.byId("allowOpenDataDiv"),"display",""):a.style(a.byId("allowOpenDataDiv"),"display","none"))},
onEnterpriseInviteSelected:function(a){this._enterpriseGroupSelectBtn.set("disabled",!0)},onEnterpriseApplySelected:function(a){this._enterpriseGroupSelectBtn.set("disabled",!0)},onEnterpriseGroupSelected:function(a){this._enterpriseGroupSelectBtn.set("disabled",!1)}})});