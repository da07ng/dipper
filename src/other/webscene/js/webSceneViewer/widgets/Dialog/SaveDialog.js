// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
require({cache:{"url:webSceneViewer/widgets/Dialog/templates/SaveDialog.html":'\x3cdiv class\x3d"dijitDialog saveDialog" role\x3d"dialog" aria-labelledby\x3d"${id}_title"\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"titleBar" class\x3d"dijitDialogTitleBar"\x3e\r\n    \x3cspan data-dojo-attach-point\x3d"titleNode" class\x3d"dijitDialogTitle" id\x3d"${id}_title" role\x3d"heading" level\x3d"1"\x3e\x3c/span\x3e\r\n    \x3cspan data-dojo-attach-point\x3d"closeButtonNode" class\x3d"dijitDialogCloseIcon" data-dojo-attach-event\x3d"ondijitclick: onCancel" title\x3d"${buttonCancel}" role\x3d"button" tabindex\x3d"0"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"closeText" class\x3d"closeText" title\x3d"${buttonCancel}"\x3ex\x3c/span\x3e\r\n    \x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitDialogPaneContent"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"ownerNode" class\x3d"ownershipText" \x3eowned by ...\x3c/div\x3e\r\n    \x3cdiv class\x3d"dijitDialogPaneContentArea"\x3e\r\n      \x3cdiv class\x3d"saveDialogContentNode"\x3e\r\n        \x3cdiv class\x3d"scenePropertiesNode"\x3e\r\n          \x3clabel for\x3d"${id}_thumbnailBox" data-dojo-attach-point\x3d"labelThumbnail" class\x3d"thumbnailLabel"\x3e\x3c/label\x3e\r\n          \x3ctable\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd colspan\x3d2 rowspan\x3d4\x3e\r\n                \x3cdiv class\x3d"thumbnailContainer"\x3e\r\n                  \x3cimg class\x3d"scenePropertiesInput thumbnail" data-dojo-attach-point\x3d"thumbnailBox" id\x3d"${id}_thumbnailBox" data-dojo-props\x3d"required: true"\x3e\r\n                  \x3cbutton class\x3d"thumbnailUpdateButton" data-dojo-type\x3d"dijit/form/Button" type\x3d"button" data-dojo-attach-event\x3d"click: _thumbnailUpdateClickHandler" data-dojo-attach-point\x3d"buttonThumbnailUpdate" data-dojo-props\x3d"iconClass:\'iconRefresh\', showLabel:false"\x3e\x3c/button\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\x3clabel for\x3d"${id}_titleTextBox" data-dojo-attach-point\x3d"labelTitle"\x3e\x3c/label\x3e\x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd\x3e\x3cinput class\x3d"scenePropertiesInput marginBelow" data-dojo-attach-point\x3d"titleTextBox" data-dojo-type\x3d"dijit/form/ValidationTextBox" id\x3d"${id}_titleTextBox" data-dojo-props\x3d"required: true, trim: false, maxLength: 100" \x3e\x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd\x3e\x3clabel for\x3d"${id}_descriptionTextBox" data-dojo-attach-point\x3d"labelDescription"\x3e\x3c/label\x3e\x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd\x3e\x3cinput class\x3d"scenePropertiesInput" data-dojo-attach-point\x3d"descriptionTextBox" data-dojo-type\x3d"dijit/form/ValidationTextBox" id\x3d"${id}_descriptionTextBox" data-dojo-props\x3d"required: false, maxLength: 250"\x3e\x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/table\x3e\r\n          \x3cbr\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"labelTags" class\x3d"tagsLabel"\x3e\x3c/label\x3e\r\n          \x3cdiv class\x3d"dijitInline"  data-dojo-attach-point\x3d"tagsWidgetDiv" id\x3d"${id}_tagsTextBox"\x3e\x3c/div\x3e\r\n          \x3cbr\x3e\r\n          \x3cbr\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"labelLocation" class\x3d"locationLabel"\x3e\x3c/label\x3e\r\n          \x3cdiv class\x3d"locationToggleContainer" data-dojo-attach-point\x3d"locationToggleContainer"\x3e\r\n            \x3cdiv class\x3d"locationToggle"  data-dojo-attach-point\x3d"locationToggle"\x3e\r\n              \x3cdiv class\x3d"otherLocationDiv"  data-dojo-attach-point\x3d"otherLocationButton"\x3e\x3c/div\x3e\r\n              \x3cdiv class\x3d"myLocationDiv" data-dojo-attach-point\x3d"myLocationButton"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"locationHint" data-dojo-attach-point\x3d"hintLocation"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cbr\x3e\r\n          \x3cbr\x3e\r\n        \x3c/div\x3e\r\n        \x3cbr\x3e\r\n        \x3cinput data-dojo-attach-point\x3d"saveInitialStateCheckBox" data-dojo-type\x3d"dijit/form/CheckBox" id\x3d"${id}_saveInitialStateCheckBox"\x3e\r\n        \x3clabel for\x3d"${id}_saveInitialStateCheckBox" data-dojo-attach-point\x3d"labelSaveInitialState"\x3e\x3c/label\x3e\r\n        \x3cbr\x3e\r\n        \x3cbr\x3e\r\n        \x3cinput data-dojo-attach-point\x3d"saveAsCheckBox" data-dojo-type\x3d"dijit/form/CheckBox" id\x3d"${id}_saveAsCheckBox"\x3e\r\n        \x3clabel for\x3d"${id}_saveAsCheckBox" data-dojo-attach-point\x3d"labelSaveAs"\x3e\x3c/label\x3e\r\n        \x3cbr\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"dijitDialogPaneActionBar"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" type\x3d"submit" data-dojo-attach-event\x3d"click: _saveButtonClickHandler" data-dojo-attach-point\x3d"buttonSave"\x3e\x3c/button\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" type\x3d"button" data-dojo-attach-event\x3d"click: onCancel" title\x3d"${buttonCancel}" data-dojo-attach-point\x3d"buttonCancel"\x3e\x3c/button\x3e\r\n      \x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n'}});
define("esri/core/declare dojo/dom-class dojo/on dojo/Deferred dojo/keys dojo/string dijit/Dialog dijit/_WidgetsInTemplateMixin dojo/text!./templates/SaveDialog.html dojo/i18n!../../editor/nls/editor esri/views/3d/support/canvas3dUtils esri/widgets/Tags dijit/form/Form dijit/form/TextBox dijit/form/ValidationTextBox dijit/form/Button dijit/form/CheckBox dijit/form/Textarea".split(" "),function(l,c,h,m,d,k,n,p,q,b,r,s,t,u,v,w,x,y){return l([n,p],{templateString:q,view:void 0,thumbnailFileObject:void 0,
portal:void 0,saveInMyContent:void 0,oldSaveInMyContent:void 0,_setPortalAttr:function(a){this._set("portal",a);a&&a.getPortalUser().getTags().then(function(a){this._tagsWidget.set("knownTags",a)}.bind(this),function(a){console.error(a)})},constructor:function(){this._titleDuplicated=!1},destroy:function(){this.buttonThumbnailUpdate.destroy();this.titleTextBox.destroy();this.descriptionTextBox.destroy();this.saveAsCheckBox.destroy();this.saveInitialStateCheckBox.destroy();this._tagsWidget.destroy();
this.inherited(arguments)},show:function(a,e){this._saving=!1;this.myUserName=a.myUserName;this.websceneOwner=a.webScene.portalItemProperties.owner?a.webScene.portalItemProperties.owner:a.myUserName;this.webScene=a.webScene;var f=a.myUserName===this.websceneOwner,g=f||(a.webScene.portalItemProperties?this._canEditScene(a.webScene.portalItemProperties.itemControl):!0),d=this.portal?this.portal.userHasEditingPrivileges():!0;f||!g?this.saveInMyContent=!0:!f&&(g&&!d)&&(this.saveInMyContent=!1);this.view=
e;this._websceneTitle=g?a.webScene.portalItemProperties.title:k.substitute(b.sceneProperties.copyTitle,{scenetitle:a.webScene.portalItemProperties.title,sceneauthor:a.webScene.portalItemProperties.owner});if(a.webScene.portalItemProperties&&a.webScene.portalItemProperties._thumbnailFileObject)this.thumbnailFileObject=a.webScene.portalItemProperties._thumbnailFileObject,this.thumbnailBox.src=this.thumbnailFileObject.dataURI;else if(a.webScene.portalItemProperties.thumbnailUrl){var h=a.webScene.portalItemProperties.thumbnailUrl;
try{if("public"!==a.webScene.portalItemProperties.access&&-1===h.indexOf("token\x3d")&&this.portal&&this.portal.isSignedIn()){var l=this.portal.getPortalUser().credential.token;a.webScene.portalItemProperties.thumbnailUrl+="?token\x3d"+l}}catch(m){}this.thumbnailBox.src=a.webScene.portalItemProperties.thumbnailUrl;this.thumbnailFileObject=void 0}else this._requestThumbnail(e).then(function(a){this.thumbnailFileObject=a;this.thumbnailBox.src=a.dataURI}.bind(this));void 0===this.saveInMyContent?(c.remove(this.locationToggleContainer,
"bold"),c.remove(this.hintLocation,"hide"),c.remove(this.otherLocationButton,"selected"),c.remove(this.myLocationButton,"selected")):this.saveInMyContent?(c.remove(this.otherLocationButton,"selected"),c.add(this.myLocationButton,"selected"),this.hintLocation.textContent=b.saveDialog.copyScene):(c.add(this.otherLocationButton,"selected"),c.remove(this.myLocationButton,"selected"),this.hintLocation.textContent=b.saveDialog.overwriteScene);this.myLocationButton.textContent=b.saveDialog.myContent;!f&&
g?(d||c.add(this.locationToggleContainer,"singleSelectShared"),this.otherLocationButton.textContent=a.webScene.portalItemProperties?k.substitute(b.saveDialog.otherContent,{sceneowner:a.webScene.portalItemProperties.owner}):""):c.add(this.locationToggleContainer,"singleSelect");this.ownerNode.innerHTML=f?b.saveDialog.ownerMe:k.substitute(b.saveDialog.owner,{ownerName:this.websceneOwner});this.titleTextBox.set("value",this._websceneTitle);this.descriptionTextBox.set("value",a.webScene.portalItemProperties.snippet);
this._tagsWidget.set("value",a.webScene.portalItemProperties.tags);this.saveAsCheckBox.set("checked",a.isNewWebScene||this.saveInMyContent&&!f&&g);this.saveAsCheckBox.set("disabled",a.isNewWebScene||!f&&g);this.saveInitialStateCheckBox.set("checked",!0);this.saveInitialStateCheckBox.set("disabled",a.isNewWebScene);this.checkDuplicateTitle();this.inherited(arguments);this._adjustLocationToggleWidth();this._smoothBlendInOut(!0)},postCreate:function(){this.set("title",b.buttons.saveScene);this.inherited(arguments);
this.labelThumbnail.textContent=b.sceneProperties.thumbnail;this.labelTitle.textContent=b.sceneProperties.title;this.labelDescription.textContent=b.sceneProperties.summary;this.labelTags.textContent=b.sceneProperties.tags;this.labelLocation.textContent=b.saveDialog.location;this.hintLocation.textContent=b.saveDialog.choseLocation;this.own(h(this.myLocationButton,"click",function(){this._saveLocationToggleClicked(!0)}.bind(this)));this.own(h(this.otherLocationButton,"click",function(){this._saveLocationToggleClicked(!1)}.bind(this)));
this.labelSaveInitialState.textContent=b.saveDialog.saveInitialState;this.labelSaveAs.textContent=b.saveDialog.saveAs;this.titleTextBox.set("placeholder",b.sceneProperties.placeholderEnterTitle);this.titleTextBox.invalidMessage=b.saveDialog.invalidTitle;this.titleTextBox.validator=function(a){return this._validateTitle(a)}.bind(this);this.descriptionTextBox.set("placeholder",b.sceneProperties.placeholderEnterSummary);this.descriptionTextBox.invalidMessage=b.saveDialog.invalidSummary;this.descriptionTextBox.validator=
function(a){return this._validateTitle(a)}.bind(this);this._tagsWidget=new s({minWidth:"403px",maxWidth:"403px",required:!0});this._tagsWidget.placeAt(this.tagsWidgetDiv);this._tagsWidget.startup();this.labelTags.setAttribute("for",this._tagsWidget._inputTextBox.id);this.buttonSave.set("innerHTML",b.buttons.save);this.buttonCancel.set("innerHTML",b.buttons.cancel);this.titleTextBox.on("change",this.checkDuplicateTitle.bind(this));var a;this.titleTextBox.on("keypress",function(b){b.charOrCode===d.TAB||
(b.charOrCode===d.ENTER||b.charOrCode===d.ESCAPE||b.charOrCode===d.SHIFT||b.charOrCode===d.CTRL||b.charOrCode===d.META||b.charOrdCode===d.ALT)||(void 0!==a&&clearTimeout(a),this.buttonSave.set("disabled",!0),a=setTimeout(this.checkDuplicateTitle.bind(this),1E3))}.bind(this));this.saveAsCheckBox.on("change",this.checkDuplicateTitle.bind(this))},checkDuplicateTitle:function(){var a=this.titleTextBox.get("value"),c=this.saveAsCheckBox.get("checked");this.portal?null==a||0===a.length?(this._titleDuplicated=
!1,this._lastValidatedTitle=a):this._lastValidatedTitle===a?this.buttonSave.set("disabled",!1):(a=a.trim(),this._lastValidatedTitle=null,!c&&this._websceneTitle===a?this._titleDuplicated=!1:(this.buttonSave.set("disabled",!0),c=JSON.stringify(a),c="owner:"+this.portal.getPortalUser().username+" title:"+c+' type:"Web Scene"',this.portal.queryItems({q:c}).then(function(c){this.buttonSave.set("disabled",!1);this._lastValidatedTitle=a;if(c&&1<=c.total){this._titleDuplicated=!1;for(var e=0;e<c.results.length;e++)if(c.results[e]&&
c.results[e].title&&c.results[e].title.toLowerCase()===a.toLowerCase()){this._titleDuplicated=!0;break}this._titleDuplicated&&(this.titleTextBox.focus(),this.titleTextBox.displayMessage(b.saveDialog.websceneTitleExists))}else this._titleDuplicated=!1}.bind(this),function(a){this._titleDuplicated=!1;this.buttonSave.set("disabled",!1);console.error(a)}.bind(this)))):(this.buttonSave.set("disabled",!1),this._titleDuplicated=!1,this._lastValidatedTitle=a)},_saveButtonClickHandler:function(){if(!this._saving){if(!this.titleTextBox.isValid())return this.titleTextBox.focus(),
this.titleTextBox.displayMessage(this.titleTextBox.invalidMessage),!1;if(!this._tagsWidget.isValid())return this._tagsWidget.focus(),this._tagsWidget._displayMessage(this._tagsWidget.i18n.required),!1;if(!this.descriptionTextBox.isValid())return this.descriptionTextBox.focus(),this.descriptionTextBox.displayMessage(this.descriptionTextBox.invalidMessage),!1;if(this._titleDuplicated)return this.titleTextBox.focus(),this.titleTextBox.displayMessage(b.saveDialog.websceneTitleExists),!1;if(void 0===this.saveInMyContent)return c.add(this.locationToggleContainer,
"bold"),!1;this._saving=!0;this.emit("save",{title:this.titleTextBox.get("value").trim(),snippet:this.descriptionTextBox.get("value"),tags:this._tagsWidget.get("value"),saveAsNewWebScene:this.saveAsCheckBox.get("checked"),saveInitialState:this.saveInitialStateCheckBox.get("checked"),thumbnailFileObject:this.thumbnailFileObject,owner:this.saveInMyContent?this.myUserName:this.websceneOwner});this.oldSaveInMyContent=this.saveInMyContent;this._smoothBlendInOut(!1)}},_thumbnailUpdateClickHandler:function(){this._requestThumbnail(this.view).then(function(a){this.thumbnailFileObject=
a;this.thumbnailBox.src=a.dataURI}.bind(this))},onCancel:function(){this.inherited(arguments);this.emit("cancel-save");this.saveInMyContent=this.oldSaveInMyContent;this._smoothBlendInOut(!1)},_requestThumbnail:function(a){var b=new m;a.takeScreenshot({format:"jpeg",quality:80,width:200,height:133}).then(function(a){b.resolve({data:r.dataURItoBlob(a.dataURL),identifier:"thumbnail",name:"thumbnail",dataURI:a.dataURL})},b.reject);return b},_validateTitle:function(a){return-1!==a.indexOf("\x3e")||-1!==
a.indexOf("\x3c")?!1:!0},_saveLocationToggleClicked:function(a){this.hintLocation.textContent=a?b.saveDialog.copyScene:b.saveDialog.overwriteScene;this.saveInMyContent=a;this.saveAsCheckBox.set("checked",a);this.saveAsCheckBox.set("disabled",!0);c.remove(this.locationToggleContainer,"bold");a?(this._websceneTitle=k.substitute(b.sceneProperties.copyTitle,{scenetitle:this.titleTextBox.get("value"),sceneauthor:this.webScene.portalItemProperties.owner}),c.remove(this.otherLocationButton,"selected"),c.add(this.myLocationButton,
"selected")):(this._websceneTitle=this.webScene.portalItemProperties.title,c.add(this.otherLocationButton,"selected"),c.remove(this.myLocationButton,"selected"));this.titleTextBox.set("value",this._websceneTitle)},_adjustLocationToggleWidth:function(){this.otherLocationButton.clientWidth>this.myLocationButton.clientWidth?this.myLocationButton.style.width=this.otherLocationButton.clientWidth-14+"px":this.otherLocationButton.style.width=this.myLocationButton.clientWidth-14+"px"},_canEditScene:function(a){return"update"===
a||"admin"===a},_smoothBlendInOut:function(a){var b=document.getElementsByClassName("dijitDialogUnderlay _underlay");0!==b.length&&(b=b[0],a?c.add(b,"on"):c.remove(b,"on"))}})});