// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define(["../../../core/Accessor","../../../core/HandleRegistry","./cssUtils","./Container","./RenderContext"],function(f,g,h,e,k){return f.createSubclass({classMetadata:{properties:{clipVisible:{}}},constructor:function(){this._handles=new g},getDefaults:function(a){return{context:new k,root:new e,wrapper:new e({stage:this,parent:this,surface:a.container})}},initialize:function(){this._handles.add(this.watch("clipVisible",this.rerender.bind(this)))},destroy:function(){this.stop();this._handles.destroy();
this._handles=null},_rerender:!1,clipVisible:!0,_stateSetter:function(a,b){b&&this._handles.remove("version");a&&this._handles.add(a.watch("version",this.rerender.bind(this)),"version");return a},rerender:function(){this._rerender||(this._rerender=!0,this._running&&this.task.isPaused()&&this.task.resume())},run:function(){this._running||(this.wrapper.addChild(this.root),this.task=this.scheduler.addFrameTask({render:this._render.bind(this)}),this._running=!0)},stop:function(){this._running&&(this.wrapper.removeChild(this.root),
this.task.remove(),this.task=null,this._running=!1)},addChild:function(a){return this.root.addChild(a)},addChildAt:function(a,b){return this.root.addChildAt(a,b)},removeChild:function(a){return this.root.removeChild(a)},removeChildAt:function(a){return this.root.removeChildAt(a)},contains:function(a){return this.root.contains(a)},getChildIndex:function(a){return this.root.getChildIndex(a)},getChildAt:function(a){return this.root.getChildAt(a)},setChildIndex:function(a,b){return this.root.setChildIndex(a,
b)},requestChildRender:function(a){this.rerender()},_render:function(){if(this._rerender){var a=this.context,b=this.state,c=this.wrapper,d=this.root;this._rerender=!1;a.setViewTransform(b.transformNoRotation);c.reflow(a);c.render(a);d.render(a);c=d.surface.style;d=b.screenCenter;c["transform-origin"]=d[0]+"px "+d[1]+"px 0";c[h.transformStyleName]="translateZ(0) rotateZ("+b.rotation+"deg)";b=this.clipVisible&&b.clipRect;c.clip=b?"rect("+b.top+"px, "+b.right+"px, "+b.bottom+"px,"+b.left+"px)":null;
a.reset();this._rerender||this.task.pause()}}})});