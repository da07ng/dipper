// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/util",["dijit","dojo","dojox","dojo/require!arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/dialog/SubscriptionStatusDlg,dojo/request/xhr,arcgisonline/sharing/dijit/dialog/ConfirmDialog,esri/IdentityManager,dojo/cookie"],function(n,f,p){f.provide("arcgisonline.sharing.util");f.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");f.require("arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg");f.require("dojo.request.xhr");f.require("arcgisonline.sharing.dijit.dialog.ConfirmDialog");
f.require("esri.IdentityManager");f.require("dojo.cookie");arcgisonline.sharing.util={i18n:f.mixin({},f.i18n.getLocalization("arcgisonline","arcgisonline")),getSocialNetworkBadges:function(a,b){var e={},c=f.create,d=arcgisonline.sharing.util.socialNetworkTitle(a.title),g=unescape(window.location.href);if(!1===a.isOrganization||!0===a.isOrganization)g=arcgisonline.sharing.util.urlToObject(window.location.href).path+"?id\x3d"+a.id;esriGeowConfig.self&&esriGeowConfig.self.customBaseUrl&&!arcgisonline.sharing.util.isPortal()&&
-1<g.indexOf(esriGeowConfig.self.customBaseUrl)&&(g=g.replace(location.host,esriGeowConfig.self.portalHostname));var h=c("span",{"class":"esriItemLinks"}),k=encodeURI("socialnetwork.html?t\x3d"+d+"\x26n\x3dfb\x26u\x3d"+g),l=esri.i18nBundle.itemLinks.shareFacebook,m=c("a",{target:"_blank",onclick:f.partial(this._checkShare,a,"Facebook"),href:k,alt:l,title:l},h);c("span",{"class":"badge facebookBadge dijitInline"},m);k=c("a",{target:"_blank",onclick:f.partial(this._checkShare,a,"Facebook"),href:k,alt:l,
title:l},h);c("span",{innerHTML:esri.i18nBundle.itemLinks.facebook},k);e.facebook=h;h=c("span",{"class":"esriItemLinks"});k=encodeURI("socialnetwork.html?t\x3d"+d+"\x26n\x3dtw\x26u\x3d"+g);l=esri.i18nBundle.itemLinks.shareTwitter;m=c("a",{target:"_blank",onclick:f.partial(this._checkShare,a,"Twitter"),href:k,alt:l,title:l},h);c("span",{"class":"badge twitterBadge dijitInline"},m);k=c("a",{target:"_blank",onclick:f.partial(this._checkShare,a,"Twitter"),href:k,alt:l,title:l},h);c("span",{innerHTML:esri.i18nBundle.itemLinks.twitter},
k);e.twitter=h;b(e)},socialNetworkTitle:function(a){100<a.length&&(a=a.substring(0,97)+"...");return encodeURIComponent(a.replace(/ /g,"+"))},shortenUrl:function(a,b,e){var c=esriGeowConfig.bitlyUrl;"https:"==location.protocol&&(c=esriGeowConfig.bitlyUrlSSL);c+="\x26longUrl\x3d"+escape(a)+"\x26format\x3djson";f.io.script.get({url:c,callbackParamName:"callback",load:function(a,c){a&&200==a.status_code&&a.data&&a.data.url&&0<a.data.url.length?b(a.data.url):e&&e(a,c)},error:function(a,b){e&&e(a,b)}})},
_checkShare:function(a,b,e){b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();if(a.access&&"public"!==a.access)b.show({title:esri.i18nBundle.itemLinks.shareItem,message:esri.substitute({appTitle:esriGeowConfig.portalName||"ArcGIS.com"},esri.i18nBundle.itemLinks.shareItemMsg)});else if(!1===a.isPublic&&(!1===a.isOrganization||!0===a.isOrganization))b.show({title:esri.i18nBundle.itemLinks.shareGroup,message:esri.substitute({appTitle:esriGeowConfig.portalName||"ArcGIS.com"},
esri.i18nBundle.itemLinks.shareGroupMsg)})},checkSession:function(){var a=this.getCookie("esri_auth"),b=null;a&&(b=a);if(b&&(!b.error||""==b.error))esriGeowConfig.userInfo=f.mixin(esriGeowConfig.userInfo||{},b)},isLoggedIn:function(){return null==this.getUser()?!1:!0},isSilverlightInstalled:function(){if(esriGeowConfig.isSilverlightInstalled)return esriGeowConfig.isSilverlightInstalled;esriGeowConfig.isSilverlightInstalled=!1;if(f.isIE)try{new ActiveXObject("AgControl.AgControl"),esriGeowConfig.isSilverlightInstalled=
!0}catch(a){console.log("Silverlight plug-in not found in IE browser.")}else navigator.plugins["Silverlight Plug-In"]&&(esriGeowConfig.isSilverlightInstalled=!0);return esriGeowConfig.isSilverlightInstalled},couldHaveArcGISDesktop:function(){return-1!=navigator.userAgent.indexOf("Windows")&&-1==navigator.userAgent.indexOf("Windows Phone")?!0:!1},requireAuthentication:function(){if(!0===this.isLoggedIn())return!0;var a="";-1==esriGeowConfig.signin.indexOf("http")&&(a=esriGeowConfig.baseUrl,!1!==esriGeowConfig.useSSL&&
(a=arcgisonline.sharing.util.getSecureUrl(a)));a+=esriGeowConfig.signin;window.location!==a&&(a+="?returnUrl\x3d"+escape(window.location));window.location=a+"\x26error\x3d403";return!1},htmlHasText:function(a){if(a&&0<a.length){a=f.trim(a);for(var b=!1,e=0;e<a.length;e++){var c=a.charAt(e);if("\x3c"==c)b=!0;else if("\x3e"==c)b=!1;else if(!b&&""!==c)return!0}}return!1},endsWith:function(a,b){return null==a||null==b?!1:a.toLowerCase().lastIndexOf(b.toLowerCase())==a.length-b.length},toFullDateString:function(a){a=
new Date(parseFloat(a));return f.date.locale.format(a,{selector:"date",formatLength:"long"})},capitalize:function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()},getItemDetailsLinkInfo:function(a){var b=null,e=null,c=null;esri.isDefined(a.isInvitationOnly)?(b=esriGeowConfig.baseUrl+"group.html?owner\x3d"+a.owner+"\x26title\x3d"+encodeURIComponent(a.title),e=esri.i18nBundle.itemLinks.details,c=esri.i18nBundle.itemLinks.viewGroupDetails):(b=esriGeowConfig.baseUrl+"item.html?id\x3d"+a.id,
e=esri.i18nBundle.itemLinks.details,c=esri.i18nBundle.itemLinks.viewDetails);return null!==b&&null!==e?{link:b,label:e,tip:c}:null},_isOperationsViewSupportedBrowser:function(){var a=navigator.userAgent.toLowerCase();if(a.match(/iphone/i)||a.match(/ipod/i)||-1<a.indexOf("android")&&-1<a.indexOf("mobile")||-1<a.indexOf("windows phone")||f.has("bb"))return!1;var b;return void 0!==f.has("chrome")?(b=f.has("chrome"),!isNaN(b)&&19<=b):void 0!==f.has("ff")?4<=f.has("ff"):void 0!==f.has("ie")?9<=f.has("ie"):
void 0!==f.has("trident")?5<=f.has("trident"):void 0!==f.has("safari")?(b=parseFloat(a.split("version/")[1]),a=parseFloat(a.split("crios/")[1]),isNaN(b)&&isNaN(a)||!isNaN(b)&&5.1>b||!isNaN(a)&&31>a?!1:!0):!1},_isPremiumService:function(a){return a.owner&&-1<a.owner.toLowerCase().indexOf("esri")&&(-1<f.indexOf(a.typeKeywords,"Requires Subscription")||-1<f.indexOf(a.typeKeywords,"Requires Credits"))},getGalleryMainLinkInfo:function(a){var b=a.type?a.type:"",e="",c="",d="",g=null,c=this.getUser(),e=
!1,e=null;esriGeowConfig.portalHostname&&(e=esriGeowConfig.portalHostname);e&&(d=e.split("."),1<d.length&&(e=d[d.length-2]+"."+d[d.length-1]));if("Web Map"==b)e=!c&&this._isPremiumService(a),c='JavaScript:arcgisonline.map.mapUtil.openMap("'+a.id+'",'+e+")",d=esri.substitute({appTitle:""},esri.i18nBundle.itemLinks.openViewer),e=esri.i18nBundle.itemLinks.open;else if("CityEngine Web Scene"===b)b=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/apps/CEWebViewer/viewer.html?3dWebScene\x3d"+
a.id,c="JavaScript:void(0)",g=f.hitch(arcgisonline.sharing.util,"openPage",b),d=esri.i18nBundle.itemLinks.viewApp,e=esri.i18nBundle.itemLinks.open;else if("Web Scene"===b&&esriGeowConfig.sceneViewerEnabled)b=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/home/webscene/viewer.html?webscene\x3d"+a.id,c="JavaScript:void(0)",g=f.hitch(arcgisonline.sharing.util,"openPage",b,!0),d=esri.i18nBundle.itemLinks.openSceneViewer,e=esri.i18nBundle.itemLinks.open;
else if("Scene Service"===b&&esriGeowConfig.sceneViewerEnabled)b=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/home/webscene/viewer.html?layers\x3d"+a.id,c="JavaScript:void(0)",g=f.hitch(arcgisonline.sharing.util,"openPageAndCount",a.id,b,!0),d=esri.i18nBundle.itemLinks.addToSceneViewer,e=esri.i18nBundle.itemLinks.open;else if("Operation View"===b){b=window.location;g=arcgisonline.sharing.util.isPortal();b=b.protocol+"//"+(g?esriGeowConfig.self.portalHostname:
b.host);c=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/apps/dashboard/index.html#/"+a.id;if(this.couldHaveArcGISDesktop())g=f.partial(arcgisonline.sharing.util.openPageAndCount,a.id,b+(g?"/apps/dashboard-win/":"/opsdashboard/")+"OperationsDashboard.application?open\x3d"+a.id);else if(this._isOperationsViewSupportedBrowser())g=f.hitch(arcgisonline.sharing.util,"openPageAndCount",a.id,c,!1);else return null;c="JavaScript:void(0)";d=esri.i18nBundle.itemLinks.openOperationView;
e=esri.i18nBundle.itemLinks.open}else if("Map Service"==b||"Feature Service"==b||"Image Service"==b||"KML"==b||"Feature Collection"==b||"Stream Service"==b||"Vector Tile Service"===b)d=a&&a.extraUrlParams?!0:!1,e=!c&&this._isPremiumService(a),c='JavaScript:arcgisonline.map.mapUtil.addToMap("'+a.id+'",'+e+","+d+")",e=esri.i18nBundle.itemLinks.open,d=esri.substitute({appTitle:esriGeowConfig.portalName||"ArcGIS.com"},esri.i18nBundle.itemLinks.addToViewer),esriGeowConfig.sceneViewerEnabled&&("Image Service"===
b&&-1<f.indexOf(a.typeKeywords,"Elevation 3D Layer"))&&(c=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/home/webscene/viewer.html?layers\x3d"+a.id,d=esri.i18nBundle.itemLinks.addToSceneViewer,e=esri.i18nBundle.itemLinks.open);else if("WMS"==b)c=a.noWebMercator?'JavaScript:arcgisonline.map.mapUtil.openOnGCSMap("'+a.id+'")':'JavaScript:arcgisonline.map.mapUtil.addToMap("'+a.id+'")',e=esri.i18nBundle.itemLinks.open,d=esri.substitute({appTitle:esriGeowConfig.portalName||
"ArcGIS.com"},esri.i18nBundle.itemLinks.addToViewer);else if(this.couldHaveArcGISDesktop()&&("Globe Service"==b||"Workflow Manager Service"==b))c="JavaScript:void(0)",g=f.hitch(arcgisonline.sharing.util,"openPageAndCount",a.id,a.url+"?f\x3dlyr\x26v\x3d9.3"),e=esri.i18nBundle.itemLinks.open,d=esri.i18nBundle.itemLinks.openDesktop;else if(this.couldHaveArcGISDesktop()&&("Map Package"==b||"Basemap Package"===b||"Mobile Map Package"==b||"Mobile Basemap Package"===b||"Layer Package"==b||"Pro Map"==b||
"Layout"==b||-1<f.indexOf(a.typeKeywords,"lyrx")))a&&a.name.indexOf(".mmpk")&&a.name.indexOf(".bpk")&&-1===a.name.indexOf(".bpkx")&&-1===a.name.indexOf(".lpkx")&&-1===a.name.indexOf(".mpkx")&&-1===a.name.indexOf(".lyrx")&&-1===a.name.indexOf(".mapx")&&-1===a.name.indexOf(".pagx")?(c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemPkgPath(a)),e=esri.i18nBundle.itemLinks.open,d=esri.i18nBundle.itemLinks.openDesktop):(c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a)),
e=esri.i18nBundle.itemLinks.open,d=esri.i18nBundle.itemLinks.downloadArchive);else if(this.couldHaveArcGISDesktop()&&("Geoprocessing Package"==b||"Locator Package"==b||"Tile Package"==b||"Vector Tile Package"==b))c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemPkgPath(a)),e=esri.i18nBundle.itemLinks.open,d="Task File"!==b?esri.i18nBundle.itemLinks.openDesktop:esri.i18nBundle.itemLinks.openProfessional;else if(this.couldHaveArcGISDesktop()&&("Map Document"==b||"Published Map"==
b||"Globe Document"==b||"Scene Document"==b||"Layer"==b))c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a)),e=esri.i18nBundle.itemLinks.open,d=esri.i18nBundle.itemLinks.openDesktop;else if(this.couldHaveArcGISDesktop()&&"Desktop Add In"==b)c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a)),e=esri.i18nBundle.itemLinks.open,d=esri.i18nBundle.itemLinks.openDesktop;else if(this.isSilverlightInstalled()&&("Explorer Map"==b||"Explorer Layer"==
b||"Explorer Add In"==b))c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a)),e=esri.i18nBundle.itemLinks.open,d=esri.i18nBundle.itemLinks.openExplorer;else if("File Geodatabase"===b||"CSV Collection"===b||"KML Collection"===b||"Rule Package"===b||"GeoJson"===b||"Shapefile"===b||"CSV"===b||"Map Template"===b||"Code Sample"===b||"Geoprocessing Sample"===b||"Service Definition"===b||"Workflow Manager Package"===b||"Windows Viewer Add-in"===b||"ArcPad Package"===b||"Operations Dashboard Addin"===
b||"CAD Drawing"===b||"Microsoft Word"===b||"Raster function template"===b||"Microsoft PowerPoint"===b||"Microsoft Powerpoint"===b||"Microsoft Excel"===b||"iWork Pages"===b||"iWork Keynote"===b||"iWork Numbers"===b||"Image"===b||"Visio Document"===b||"PDF"===b||"Desktop Application"===b||"Task File"===b||"Project Package"===b||"Project Template"===b||"Desktop Style"===b||"Native Application Installer"===b)c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a)),e=esri.i18nBundle.itemLinks.open,
d=esri.i18nBundle.itemLinks.downloadArchive;else if(("Web Mapping Application"==b||"Application"==b||"Native Application"===b||"Native Application Template"===b)&&-1===f.indexOf(a.typeKeywords,"Web AppBuilder for ArcGIS"))if(b=arcgisonline.sharing.util.isHostedTemplateItem(a.url),a.url&&0<a.url.length){if(esriGeowConfig.urlKey&&(-1<a.url.indexOf(esriGeowConfig.urlKey)||e&&-1<a.url.indexOf(e)))a.originalUrl=a.originalUrl||f.clone(a.url),a.url=esriGeowConfig.allSSL?a.url.replace("http:","https:"):a.url;
a.access&&"public"!==a.access&&(b&&!arcgisonline.sharing.util.isPortal())&&(g=arcgisonline.sharing.util.parseUrl(a.url),a.url=a.url.replace(g.host,window.location.hostname));arcgisonline.sharing.util.isPortal()&&(a.url&&0===a.url.indexOf("/"))&&(g=esriGeowConfig.self.portalHostname.substring(esriGeowConfig.self.portalHostname.indexOf("/")),-1===a.url.indexOf(g)&&(a.url=g+a.url));c="JavaScript:void(0)";g=f.hitch(arcgisonline.sharing.util,"openPageAndCount",a.id,a.url);d=esri.i18nBundle.itemLinks.viewApp;
e=esri.i18nBundle.itemLinks.open}else c=esriGeowConfig.baseUrl+"item.html?id\x3d"+a.id,e=esri.i18nBundle.itemLinks.details,d=esri.i18nBundle.itemLinks.viewDetails;else if("Desktop Application Template"==b)-1<f.indexOf(a.typeKeywords,"desktopApplicationTemplateUrl")&&a.url&&0<a.url.length?(c="JavaScript:void(0)",g=f.hitch(arcgisonline.sharing.util,"openPageAndCount",a.id,a.url),d=esri.i18nBundle.itemLinks.viewApp,e=esri.i18nBundle.itemLinks.open):(c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",
a,this.getItemDataPath(a)),e=esri.i18nBundle.itemLinks.open,d=esri.i18nBundle.itemLinks.downloadArchive);else if("Mobile Application"==b)if(a.url&&0<a.url.length){if(esriGeowConfig.urlKey&&(-1<a.url.indexOf(esriGeowConfig.urlKey)||e&&-1<a.url.indexOf(e)))a.originalUrl=a.originalUrl||f.clone(a.url),a.url=esriGeowConfig.allSSL?a.url.replace("http:","https:"):a.url;c="JavaScript:void(0)";g=f.hitch(arcgisonline.sharing.util,"openPageAndCount",a.id,a.url);e=esri.i18nBundle.itemLinks.open;d=esri.i18nBundle.itemLinks.getApp}else c=
esriGeowConfig.baseUrl+"item.html?id\x3d"+a.id,e=esri.i18nBundle.itemLinks.details,d=esri.i18nBundle.itemLinks.viewDetails;else"Windows Mobile Package"==b?(c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a)),e=esri.i18nBundle.itemLinks.open,d=esri.i18nBundle.itemLinks.download):"Document Link"===b?(c="JavaScript:void(0)",g=f.hitch(arcgisonline.sharing.util,"openPageAndCount",a.id,a.url),e=d=esri.i18nBundle.itemLinks.open):"Form"===b&&c&&c.accountId?(c="arcgis-survey123://id\x3d"+
a.id+"\x26username\x3d"+c.username,d=esri.i18nBundle.itemLinks.openInSurvey123,e=esri.i18nBundle.itemLinks.open):"Workforce Project"===b?(c=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/apps/workforce/projects/"+a.id+"/dispatch/assignments",d=esri.i18nBundle.itemLinks.openWorkforce,e=esri.i18nBundle.itemLinks.open):(c=esriGeowConfig.baseUrl+"item.html?id\x3d"+a.id,e=esri.i18nBundle.itemLinks.details,d=esri.i18nBundle.itemLinks.viewDetails);return{label:e,
href:c,target:"",tip:d,onclick:g}},getHomePageGalleryLinkInfo:function(a){var b=a.type?a.type:"",e="",c="",d="",g=null,e=this.getUser(),c=!1,c=null;esriGeowConfig.portalHostname&&(c=esriGeowConfig.portalHostname);c&&(d=c.split("."),1<d.length&&(c=d[d.length-2]+"."+d[d.length-1]));if("Web Map"==b)var d=esriGeowConfig.baseUrl+"webmap/viewer.html?webmap\x3d"+a.id,h=esriGeowConfig.baseUrl+"signin.html?returnUrl\x3d"+encodeURIComponent(d),c=(c=!e&&this._isPremiumService(a))?h:d,d=esri.substitute({appTitle:""},
esri.i18nBundle.itemLinks.openViewer),e=esri.i18nBundle.itemLinks.open;else if("CityEngine Web Scene"===b)c=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/apps/CEWebViewer/viewer.html?3dWebScene\x3d"+a.id,d=esri.i18nBundle.itemLinks.viewApp,e=esri.i18nBundle.itemLinks.open;else if("Web Scene"===b&&esriGeowConfig.sceneViewerEnabled)c=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/home/webscene/viewer.html?webscene\x3d"+
a.id,d=esri.i18nBundle.itemLinks.openSceneViewer,e=esri.i18nBundle.itemLinks.open;else if("Scene Service"===b&&esriGeowConfig.sceneViewerEnabled)c=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/home/webscene/viewer.html?layers\x3d"+a.id,d=esri.i18nBundle.itemLinks.addToSceneViewer,e=esri.i18nBundle.itemLinks.open;else if("Operation View"===b){e=window.location;b=arcgisonline.sharing.util.isPortal();e=e.protocol+"//"+(b?esriGeowConfig.self.portalHostname:
e.host);c=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/apps/dashboard/index.html#/"+a.id;if(this.couldHaveArcGISDesktop())c=e+(b?"/apps/dashboard-win/":"/opsdashboard/")+"OperationsDashboard.application?open\x3d"+a.id;else if(!this._isOperationsViewSupportedBrowser())return null;d=esri.i18nBundle.itemLinks.openOperationView;e=esri.i18nBundle.itemLinks.open}else if("Map Service"==b||"Feature Service"==b||"Image Service"==b||"KML"==b||"Stream Service"==
b||"Vector Tile Service"===b)d=esriGeowConfig.baseUrl+"webmap/viewer.html?layers\x3d"+a.id,h=esriGeowConfig.baseUrl+"signin.html?returnUrl\x3d"+encodeURIComponent(d),c=(c=!e&&this._isPremiumService(a))?h:d,e=esri.i18nBundle.itemLinks.open,d=esri.substitute({appTitle:esriGeowConfig.portalName||"ArcGIS.com"},esri.i18nBundle.itemLinks.addToNewViewer),esriGeowConfig.sceneViewerEnabled&&("Image Service"===b&&-1<f.indexOf(a.typeKeywords,"Elevation 3D Layer"))&&(c=window.location.protocol+"//"+window.location.host+
arcgisonline.sharing.util.getHomeAppContext()+"/home/webscene/viewer.html?layers\x3d"+a.id,d=esri.i18nBundle.itemLinks.addToSceneViewer,e=esri.i18nBundle.itemLinks.open);else if("WMS"==b)c=esriGeowConfig.baseUrl+"webmap/viewer.html?layers\x3d"+a.id,e=esri.i18nBundle.itemLinks.open,d=esri.substitute({appTitle:esriGeowConfig.portalName||"ArcGIS.com"},esri.i18nBundle.itemLinks.addToNewViewer);else if(this.couldHaveArcGISDesktop()&&("Globe Service"==b||"Workflow Manager Service"==b))c="JavaScript:void(0)",
g=f.hitch(arcgisonline.sharing.util,"openPageAndCount",a.id,a.url+"?f\x3dlyr\x26v\x3d9.3"),e=esri.i18nBundle.itemLinks.open,d=esri.i18nBundle.itemLinks.openDesktop;else if(this.couldHaveArcGISDesktop()&&("Map Package"==b||"Mobile Map Package"==b||"Basemap Package"===b||"Mobile Basemap Package"===b||"Layer Package"==b||"Pro Map"==b||"Layout"==b||-1<f.indexOf(a.typeKeywords,"lyrx")))a&&-1===a.name.indexOf(".bpkx")&&-1===a.name.indexOf(".mmpk")&&-1===a.name.indexOf(".bpk")&&-1===a.name.indexOf(".lpkx")&&
-1===a.name.indexOf(".mpkx")&&-1===a.name.indexOf(".lyrx")&&-1===a.name.indexOf(".mapx")&&-1===a.name.indexOf(".pagx")?(c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemPkgPath(a)),e=esri.i18nBundle.itemLinks.open,d=esri.i18nBundle.itemLinks.openDesktop):(c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a)),e=esri.i18nBundle.itemLinks.open,d=esri.i18nBundle.itemLinks.downloadArchive);else if(this.couldHaveArcGISDesktop()&&("Geoprocessing Package"==
b||"Locator Package"==b||"Tile Package"==b||"Vector Tile Package"==b))c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemPkgPath(a)),e=esri.i18nBundle.itemLinks.open,d="Task File"!==b?esri.i18nBundle.itemLinks.openDesktop:esri.i18nBundle.itemLinks.openProfessional;else if(this.couldHaveArcGISDesktop()&&("Map Document"==b||"Published Map"==b||"Globe Document"==b||"Scene Document"==b||"Layer"==b))c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a)),e=esri.i18nBundle.itemLinks.open,
d=esri.i18nBundle.itemLinks.openDesktop;else if(this.couldHaveArcGISDesktop()&&"Desktop Add In"==b)c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a)),e=esri.i18nBundle.itemLinks.open,d=esri.i18nBundle.itemLinks.openDesktop;else if(this.isSilverlightInstalled()&&("Explorer Map"==b||"Explorer Layer"==b||"Explorer Add In"==b))c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a)),e=esri.i18nBundle.itemLinks.open,d=esri.substitute({appTitle:""},
esri.i18nBundle.itemLinks.openViewer);else if("File Geodatabase"===b||"CSV Collection"===b||"KML Collection"===b||"Rule Package"===b||"GeoJson"===b||"Shapefile"===b||"CSV"===b||"Map Template"===b||"Code Sample"===b||"Geoprocessing Sample"===b||"Service Definition"===b||"Workflow Manager Package"===b||"Windows Viewer Add-in"===b||"ArcPad Package"===b||"Operations Dashboard Addin"===b||"Microsoft Word"===b||"CAD Drawing"===b||"Raster function template"===b||"Microsoft PowerPoint"===b||"Microsoft Powerpoint"===
b||"Microsoft Excel"===b||"iWork Pages"===b||"iWork Keynote"===b||"iWork Numbers"===b||"Image"===b||"Visio Document"===b||"PDF"===b||"Desktop Application"===b||"Task File"===b||"Project Package"===b||"Project Template"===b||"Desktop Style"===b||"Native Application Installer"===b)c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a)),e=esri.i18nBundle.itemLinks.open,d=esri.i18nBundle.itemLinks.downloadArchive;else if("Desktop Application Template"==b)-1<f.indexOf(a.typeKeywords,
"desktopApplicationTemplateUrl")&&a.url&&0<a.url.length?(c="JavaScript:void(0)",g=f.hitch(arcgisonline.sharing.util,"openPageAndCount",a.id,a.url),e=d=esri.i18nBundle.itemLinks.open):(c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a)),e=esri.i18nBundle.itemLinks.open,d=esri.i18nBundle.itemLinks.downloadArchive);else if("Web Mapping Application"==b&&-1===f.indexOf(a.typeKeywords,"Web AppBuilder for ArcGIS"))if(b=arcgisonline.sharing.util.isHostedTemplateItem(a.url),a.url&&
0<a.url.length){if(esriGeowConfig.urlKey&&(-1<a.url.indexOf(esriGeowConfig.urlKey)||c&&-1<a.url.indexOf(c)))a.url=esriGeowConfig.allSSL?a.url.replace("http:","https:"):a.url;a.access&&"public"!==a.access&&(b&&!arcgisonline.sharing.util.isPortal())&&(g=arcgisonline.sharing.util.parseUrl(a.url),a.url=a.url.replace(g.host,window.location.hostname));c="JavaScript:void(0)";g=f.hitch(arcgisonline.sharing.util,"openPageAndCount",a.id,a.url);d=esri.i18nBundle.itemLinks.viewApp;e=esri.i18nBundle.itemLinks.open}else c=
esriGeowConfig.baseUrl+"item.html?id\x3d"+a.id,e=esri.i18nBundle.itemLinks.details,d=esri.i18nBundle.itemLinks.viewDetails;else if("Mobile Application"==b)if(a.url&&0<a.url.length){if(esriGeowConfig.urlKey&&(-1<a.url.indexOf(esriGeowConfig.urlKey)||c&&-1<a.url.indexOf(c)))a.url=esriGeowConfig.allSSL?a.url.replace("http:","https:"):a.url;c="JavaScript:void(0)";g=f.hitch(arcgisonline.sharing.util,"openPageAndCount",a.id,a.url);e=esri.i18nBundle.itemLinks.open;d=esri.i18nBundle.itemLinks.getApp}else c=
esriGeowConfig.baseUrl+"item.html?id\x3d"+a.id,e=esri.i18nBundle.itemLinks.details,d=esri.i18nBundle.itemLinks.viewDetails;else"Windows Mobile Package"==b?(c="JavaScript:void(0)",g=f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a)),e=esri.i18nBundle.itemLinks.open,d=esri.i18nBundle.itemLinks.download):"Document Link"===b?(c="JavaScript:void(0)",g=f.hitch(arcgisonline.sharing.util,"openPageAndCount",a.id,a.url),e=d=esri.i18nBundle.itemLinks.open):"Form"===b&&e&&e.accountId?(c="arcgis-survey123://id\x3d"+
a.id+"\x26username\x3d"+e.username,d=esri.i18nBundle.itemLinks.openSurvey123,e=esri.i18nBundle.itemLinks.open):"Workforce Project"===b?(c=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/apps/workforce/projects/"+a.id+"/dispatch/assignments",d=esri.i18nBundle.itemLinks.openWorkforce,e=esri.i18nBundle.itemLinks.open):(c=esriGeowConfig.baseUrl+"item.html?id\x3d"+a.id,e=esri.i18nBundle.itemLinks.details,d=esri.i18nBundle.itemLinks.viewDetails);return{label:e,
href:c,target:"",tip:d,onclick:g}},getItemOpenLinkObjects:function(a,b){var e=this.isSilverlightInstalled(),c=[],d=a.type?a.type:"",g=this.getUser(),h=!1;if("Web Map"==d&&-1==f.indexOf(a.typeKeywords,"ArcGIS Online")&&e&&esriGeowConfig.explorerOnline)c.push({label:esri.substitute({appTitle:""},esri.i18nBundle.itemLinks.openViewer),onClick:f.partial(arcgisonline.map.mapUtil.openMap,a.id,h)}),this.couldHaveArcGISDesktop()&&c.push({label:esri.i18nBundle.itemLinks.openDesktop,onClick:f.hitch(this,"_fetchItemData",
a,this.getItemPkgPath(a))});else if("Web Map"==d)h=!g&&this._isPremiumService(a),c.push({label:esri.substitute({appTitle:""},esri.i18nBundle.itemLinks.openViewer),onClick:f.partial(arcgisonline.map.mapUtil.openMap,a.id,h)}),this.couldHaveArcGISDesktop()&&c.push({label:esri.i18nBundle.itemLinks.openDesktop,onClick:f.hitch(this,"_fetchItemData",a,this.getItemPkgPath(a))}),d=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/apps/presentation/index.html?webmap\x3d"+
a.id,-1<f.indexOf(a.typeKeywords,"Presentation Map")?(c.push({label:esri.i18nBundle.aboutPanel.viewPresentation,onClick:f.partial(arcgisonline.sharing.util.openPage,d)}),b&&c.push({label:esri.i18nBundle.aboutPanel.editPresentation,onClick:f.partial(arcgisonline.sharing.util.openPage,d+"\x26builder",!0)})):b&&c.push({label:esri.i18nBundle.aboutPanel.createPresentation,onClick:f.partial(arcgisonline.sharing.util.openPage,d+"\x26builder",!0)});else if("Map Service"==d||"Vector Tile Service"===d)h=!g&&
this._isPremiumService(a),c.push({label:esri.substitute({appTitle:esriGeowConfig.portalName||"ArcGIS.com"},esri.i18nBundle.itemLinks.addToViewer),onClick:f.partial(arcgisonline.map.mapUtil.addToMap,a.id,h)}),c.push({label:esri.substitute({appTitle:esriGeowConfig.portalName||"ArcGIS.com"},esri.i18nBundle.itemLinks.addToNewViewer),onClick:f.partial(arcgisonline.map.mapUtil.openOnMap,a.id,h)}),"Vector Tile Service"!==d?(esriGeowConfig.sceneViewerEnabled&&c.push({label:esri.i18nBundle.itemLinks.addToSceneViewer,
onClick:f.partial(arcgisonline.sharing.util.openPageAndCount,a.id,window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/home/webscene/viewer.html?layers\x3d"+a.id,!0)}),this.couldHaveArcGISDesktop()&&!arcgisonline.sharing.util.isHostedServiceItem(a)&&(-1<f.indexOf(a.typeKeywords,"Hosted Service")&&arcgisonline.sharing.util.portalSupportsHostedServices()?c.push({label:esri.i18nBundle.itemLinks.openDesktop,onClick:f.hitch(this,"_fetchItemData",a,this.getPItemPath(a))}):
!arcgisonline.sharing.util.isPortal()&&arcgisonline.sharing.util.onAGOLFederatedServer(a.url)||arcgisonline.sharing.util.isPortal()&&arcgisonline.sharing.util.onFederatedServer(a.url)?c.push({label:esri.i18nBundle.itemLinks.openDesktop,onClick:f.hitch(this,"_fetchItemData",a,this.getPItemPath(a))}):a.url&&-1!==a.url.indexOf(".arcgis.com/")&&-1!==a.url.indexOf("//landscape")?c.push({label:esri.i18nBundle.itemLinks.openDesktop,onClick:f.hitch(this,"_fetchItemData",a,this.getPItemPath(a))}):c.push({label:esri.i18nBundle.itemLinks.openDesktop,
onClick:f.partial(arcgisonline.sharing.util.openPageAndCount,a.id,a.url+"?f\x3dlyr\x26v\x3d9.3")})),this.couldHaveArcGISDesktop()&&arcgisonline.sharing.util.isHostedServiceItem(a)&&c.push({label:esri.i18nBundle.itemLinks.openDesktop,onClick:f.hitch(this,"_fetchItemData",a,this.getPItemPath(a))})):(d=a.access&&"public"!==a.access&&g&&g.token?"\x26token\x3d"+g.token:"",g=(a&&a.hasResources?esriGeowConfig.restBaseUrl+"content/items/"+a.id:a.url)+"/resources/styles/root.json?f\x3dpjson",esri.isDefined(a.hasResources)&&
(b&&(a&&a.hasResources)&&c.push({label:esri.i18nBundle.itemLinks.downloadStyle,onClick:f.partial(arcgisonline.sharing.util.openPage,g+"\x26download\x3dtrue"+d,!0)}),(b&&a&&a.hasResources||a.url&&-1<a.url.indexOf("/VectorTileServer"))&&c.push({label:esri.i18nBundle.itemLinks.viewStyle,onClick:f.partial(arcgisonline.sharing.util.openPage,g+d,!1)})));else if(this.couldHaveArcGISDesktop()&&("Globe Service"==d||"Workflow Manager Service"==d))c.push({label:esri.i18nBundle.itemLinks.openDesktop,onClick:f.partial(arcgisonline.sharing.util.openPageAndCount,
a.id,a.url+"?f\x3dlyr\x26v\x3d9.3")});else if("Image Service"==d||"Feature Service"==d||"KML"==d||"Feature Collection"==d||"Stream Service"==d){e=a&&a.extraUrlParams?!0:!1;h=!g&&this._isPremiumService(a);if("Image Service"!==d||"Image Service"===d&&-1===f.indexOf(a.typeKeywords,"Elevation 3D Layer"))c.push({label:esri.substitute({appTitle:esriGeowConfig.portalName||"ArcGIS.com"},esri.i18nBundle.itemLinks.addToViewer),onClick:f.partial(arcgisonline.map.mapUtil.addToMap,a.id,h,e)}),c.push({label:esri.substitute({appTitle:esriGeowConfig.portalName||
"ArcGIS.com"},esri.i18nBundle.itemLinks.addToNewViewer),onClick:f.partial(arcgisonline.map.mapUtil.openOnMap,a.id,h,e)});if("KML"==d)this.couldHaveArcGISDesktop()&&c.push({label:esri.i18nBundle.itemLinks.openDesktop,onClick:f.hitch(this,"_fetchItemData",a,this.getPItemPath(a))}),c.push({label:esri.i18nBundle.itemLinks.download,onClick:f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a))});else if("Image Service"===d||"Feature Service"===d)esriGeowConfig.sceneViewerEnabled&&(-1===f.indexOf(a.typeKeywords,
"Table")&&("Feature Service"===d&&-1===f.indexOf(a.typeKeywords,"HasOnlyMultipatchGeometries")||"Image Service"===d&&-1<f.indexOf(a.typeKeywords,"Elevation 3D Layer")))&&c.push({label:esri.i18nBundle.itemLinks.addToSceneViewer,onClick:f.partial(arcgisonline.sharing.util.openPageAndCount,a.id,window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/home/webscene/viewer.html?layers\x3d"+a.id,!0)}),this.couldHaveArcGISDesktop()&&"Image Service"===d&&(a.url&&
-1!==a.url.indexOf(".arcgis.com/")||!arcgisonline.sharing.util.isPortal()&&arcgisonline.sharing.util.onAGOLFederatedServer(a.url)||arcgisonline.sharing.util.isPortal()&&arcgisonline.sharing.util.onFederatedServer(a.url)?c.push({label:esri.i18nBundle.itemLinks.openDesktop,onClick:f.hitch(this,"_fetchItemData",a,this.getPItemPath(a))}):c.push({label:esri.i18nBundle.itemLinks.openDesktop,onClick:f.partial(arcgisonline.sharing.util.openPageAndCount,a.id,a.url+"?f\x3dlyr\x26v\x3d9.3")})),this.couldHaveArcGISDesktop()&&
"Feature Service"===d&&this.couldHaveArcGISDesktop()&&c.push({label:esri.i18nBundle.itemLinks.openDesktop,onClick:f.hitch(this,"_fetchItemData",a,this.getPItemPath(a))})}else if("Geoprocessing Service"===d&&this.couldHaveArcGISDesktop())c.push({label:esri.i18nBundle.itemLinks.openDesktop,onClick:f.hitch(this,"_fetchItemData",a,this.getPItemPath(a))});else if("WMS"==d)a.noWebMercator?c.push({label:esri.substitute({appTitle:esriGeowConfig.portalName||"ArcGIS.com"},esri.i18nBundle.itemLinks.addToNewViewer),
onClick:f.partial(arcgisonline.map.mapUtil.openOnGCSMap,a.id)}):(c.push({label:esri.substitute({appTitle:esriGeowConfig.portalName||"ArcGIS.com"},esri.i18nBundle.itemLinks.addToViewer),onClick:f.partial(arcgisonline.map.mapUtil.addToMap,a.id)}),c.push({label:esri.substitute({appTitle:esriGeowConfig.portalName||"ArcGIS.com"},esri.i18nBundle.itemLinks.addToNewViewer),onClick:f.partial(arcgisonline.map.mapUtil.openOnMap,a.id)})),this.couldHaveArcGISDesktop()&&c.push({label:esri.i18nBundle.itemLinks.openDesktop,
onClick:f.hitch(this,"_fetchItemData",a,this.getPItemPath(a))});else if("File Geodatabase"===d||"CSV Collection"===d||"KML Collection"===d||"Rule Package"==d||"CSV"==d||"GeoJson"===d||"Shapefile"==d||"Service Definition"==d||"ArcPad Package"===d||"Operations Dashboard Addin"===d)c.push({label:esri.i18nBundle.itemLinks.download,onClick:f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a))});else if("Map Package"==d||"Mobile Map Package"===d||"Basemap Package"===d||"Mobile Basemap Package"===d||
"Layer Package"==d||"Pro Map"==d||"Layout"==d||-1<f.indexOf(a.typeKeywords,"lyrx"))this.couldHaveArcGISDesktop()&&a&&(-1===a.name.indexOf(".bpkx")&&-1===a.name.indexOf(".mmpk")&&-1===a.name.indexOf(".bpk")&&-1===a.name.indexOf(".lpkx")&&-1===a.name.indexOf(".mpkx")&&-1===a.name.indexOf(".lyrx")&&-1===a.name.indexOf(".mapx")&&-1===a.name.indexOf(".pagx"))&&c.push({label:esri.i18nBundle.itemLinks.openDesktop,onClick:f.hitch(this,"_fetchItemData",a,this.getItemPkgPath(a))}),c.push({label:esri.i18nBundle.itemLinks.download,
onClick:f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a))});else if("Geoprocessing Package"==d||"Locator Package"==d||"Tile Package"==d||"Vector Tile Package"==d||"Project Package"===d||"Project Template"===d)this.couldHaveArcGISDesktop()&&("Task File"!==d&&"Project Package"!==d&&"Project Template"!==d)&&c.push({label:"Task File"!==d?esri.i18nBundle.itemLinks.openDesktop:esri.i18nBundle.itemLinks.openProfessional,onClick:f.hitch(this,"_fetchItemData",a,this.getItemPkgPath(a))}),c.push({label:esri.i18nBundle.itemLinks.download,
onClick:f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a))});else if("Scene Package"==d)c.push({label:esri.i18nBundle.itemLinks.download,onClick:f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a))});else if(this.couldHaveArcGISDesktop()&&("Map Document"==d||"Published Map"==d||"Globe Document"==d||"Scene Document"==d||"Layer"==d))c.push({label:esri.i18nBundle.itemLinks.openDesktop,onClick:f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a))});else if(this.couldHaveArcGISDesktop()&&
"Desktop Add In"==d)c.push({label:esri.i18nBundle.itemLinks.openDesktop,onClick:f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a))});else if("Explorer Layer"==d||"Explorer Add In"==d||"Explorer Map"==d)c.push({label:esri.i18nBundle.itemLinks.openExplorer,onClick:f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a))});else if("Map Template"===d||"Code Sample"===d||"Geoprocessing Sample"===d||"Workflow Manager Package"===d||"Windows Viewer Add In"===d||"Microsoft Word"===d||"CAD Drawing"===
d||"Raster function template"===d||"Microsoft PowerPoint"===d||"Microsoft Powerpoint"===d||"Microsoft Excel"===d||"iWork Pages"===d||"iWork Keynote"===d||"iWork Numbers"===d||"Image"===d||"Visio Document"===d||"PDF"===d||"Desktop Application"===d||"Task File"===d||"Desktop Style"===d||"Native Application Installer"===d)c.push({label:"PDF"!==d?esri.i18nBundle.itemLinks.download:esri.i18nBundle.itemLinks.open,onClick:f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a))});else if("Desktop Application Template"===
d){if((d=-1<f.indexOf(a.typeKeywords,"desktopApplicationTemplateUrl"))&&a.url&&a.url.length)d=!0,c.push({label:esri.i18nBundle.itemLinks.open,onClick:f.partial(arcgisonline.sharing.util.openPageAndCount,a.id,a.url)});d||c.push({label:esri.i18nBundle.itemLinks.download,onClick:f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a))})}else if("Web Mapping Application"==d&&-1===f.indexOf(a.typeKeywords,"Web AppBuilder for ArcGIS")||"Mobile Application"==d||"Application"==d||"Native Application"===d||
"Native Application Template"===d)arcgisonline.sharing.util.isHostedTemplateItem(a.url),g=esri.i18nBundle.itemLinks.viewApp,"Mobile Application"==d&&(g=esri.i18nBundle.itemLinks.getApp),a.url&&0<a.url.length&&c.push({label:g,onClick:f.partial(arcgisonline.sharing.util.openPageAndCount,a.id,a.url)}),-1<f.indexOf(a.typeKeywords,"Web AppBuilder")&&b&&(d=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/apps/webappbuilder/index.html?id\x3d"+a.id,d="https:"===
window.location.protocol?arcgisonline.sharing.util.getSecureUrl(d):arcgisonline.sharing.util.getHttpUrl(d),c.push({label:esri.i18nBundle.itemLinks.editApp,onClick:f.partial(arcgisonline.sharing.util.openPage,d,!0)}));else if("Windows Mobile Package"==d)c.push({label:esri.i18nBundle.itemLinks.download,onClick:f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a))});else if("CityEngine Web Scene"==d)g=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+
"/apps/CEWebViewer/viewer.html?3dWebScene\x3d"+a.id,c.push({label:esri.i18nBundle.itemLinks.viewApp,onClick:f.partial(arcgisonline.sharing.util.openPage,g)}),c.push({label:esri.i18nBundle.itemLinks.download,onClick:f.hitch(this,"_fetchItemData",a,this.getItemDataPath(a))});else if("Web Scene"===d&&esriGeowConfig.sceneViewerEnabled)g=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/home/webscene/viewer.html?webscene\x3d"+a.id,c.push({label:esri.i18nBundle.itemLinks.openSceneViewer,
onClick:f.partial(arcgisonline.sharing.util.openPage,g,!0)});else if("Scene Service"===d&&esriGeowConfig.sceneViewerEnabled)g=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/home/webscene/viewer.html?layers\x3d"+a.id,c.push({label:esri.i18nBundle.itemLinks.addToSceneViewer,onClick:f.partial(arcgisonline.sharing.util.openPageAndCount,a.id,g,!0)});else if("Operation View"===d){var g=window.location,d=arcgisonline.sharing.util.isPortal(),g=g.protocol+
"//"+(d?esriGeowConfig.self.portalHostname:g.host),h=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/apps/dashboard/index.html#/"+a.id,e=-1<f.indexOf(a.typeKeywords,"TabletLayout"),k=this.couldHaveArcGISDesktop(),l=this._isOperationsViewSupportedBrowser();k&&c.push({label:e&&l?esri.i18nBundle.itemLinks.openOperationViewDesktop:esri.i18nBundle.itemLinks.openOperationView,onClick:f.partial(arcgisonline.sharing.util.openPage,g+(d?"/apps/dashboard-win/":
"/opsdashboard/")+"OperationsDashboard.application?open\x3d"+a.id)});e&&l&&c.push({label:!k?esri.i18nBundle.itemLinks.openOperationView:esri.i18nBundle.itemLinks.openOperationViewUrl,onClick:f.partial(arcgisonline.sharing.util.openPage,h,!1)})}else"Document Link"===d?c.push({label:esri.i18nBundle.itemLinks.open,onClick:f.partial(arcgisonline.sharing.util.openPageAndCount,a.id,a.url)}):"Form"===d&&g&&g.accountId?c.push({label:esri.i18nBundle.itemLinks.openSurvey123,onClick:f.partial(arcgisonline.sharing.util.openPage,
"arcgis-survey123://id\x3d"+a.id+"\x26username\x3d"+g.username,!0)}):"Workforce Project"===d&&(d=window.location.protocol+"//"+window.location.host+arcgisonline.sharing.util.getHomeAppContext()+"/apps/workforce/projects/"+a.id+"/dispatch/assignments",c.push({label:esri.i18nBundle.itemLinks.openWorkforce,onClick:f.partial(arcgisonline.sharing.util.openPage,d,!0)}));return c},getGroupLinks:function(a){var b=f.create,e=b("span",{"class":"esriItemLinks",style:"white-space: nowrap"});b("a",{href:esriGeowConfig.baseUrl+
"group.html?id\x3d"+a.id,innerHTML:esri.i18nBundle.itemLinks.details,title:esri.i18nBundle.itemLinks.viewGroupDetails,alt:esri.i18nBundle.itemLinks.viewGroupDetails},e);return e},getItemDataPath:function(a){var b=arcgisonline.sharing.util.getToken(),b=b?"?token\x3d"+b:"",e=esriGeowConfig.restBaseUrl+"content/items/"+a.id+"/data";return"KML"==a.type&&a.url&&-1===a.url.indexOf(e)?a.url:e+b},getItemPkgPath:function(a){var b=arcgisonline.sharing.util.getToken();return esriGeowConfig.restBaseUrl+"content/items/"+
a.id+"/item.pkinfo"+(b?"?token\x3d"+b:"")},getPItemPath:function(a){var b=arcgisonline.sharing.util.getToken();return esriGeowConfig.restBaseUrl+"content/items/"+a.id+"/item.pitem"+(b?"?token\x3d"+b:"")},getItemZipPath:function(a){var b=arcgisonline.sharing.util.getToken();return esriGeowConfig.restBaseUrl+"content/items/"+a.id+"/data?f\x3dzip"+(b?"\x26token\x3d"+b:"")},getUser:function(){this.checkSession();return""===esriGeowConfig.userInfo?null:esriGeowConfig.userInfo},meetsPasswordStrength:function(a){return 8<=
a.length&&a.match("^.*(?\x3d.*\\d)(?\x3d.*[a-zA-Z]).*$")},meetsPasswordPolicyStrength:function(a,b){var e={meetsRequirements:function(){return this.minLength&&this.minLetter&&this.minUpper&&this.minLower&&this.minDigit&&this.minOther},minLength:!0,minLetter:!0,minUpper:!0,minLower:!0,minDigit:!0,minOther:!0};if(b&&0<b.length){a.minLength&&(e.minLength=b.length>=a.minLength);if(a.minLetter){var c=b.match(/[A-Za-z]/g);e.minLetter=!!(c&&c.length>=a.minLetter)}a.minUpper&&(c=b.match(/[A-Z]/g),e.minUpper=
!!(c&&c.length>=a.minUpper));a.minLower&&(c=b.match(/[a-z]/g),e.minLower=!!(c&&c.length>=a.minLower));a.minDigit&&(c=b.match(/[0-9]/g),e.minDigit=!!(c&&c.length>=a.minDigit));a.minOther&&(c=b.match(/[\\!"#\$%&'\(\)\*\+,-\./:;<=>\?@\[\]\^_`\{\|}~]/g),e.minOther=!!(c&&c.length>=a.minOther))}else a.minLength&&(e.minLength=!1),a.minLetter&&(e.minLetter=!1),a.minUpper&&(e.minUpper=!1),a.minLower&&(e.minLower=!1),a.minDigit&&(e.minDigit=!1),a.minOther&&(e.minOther=!1);return e},userPreferences:function(a,
b,e){var c=f.cookie(b||"esri_prefs");if(a)c&&(a=f.mixin(f.json.parse(c),a)),f.cookie(b||"esri_prefs",f.json.stringify(a),{path:"/",expires:1E4}),a.contentMode&&e&&this.getUser()?(c=f.create,e=c("form",{method:"POST"},f.body()),c("input",{type:"hidden",name:"preferredView",value:a.contentMode},e),c("input",{type:"hidden",name:"clearEmptyFields",value:"false"},e),arcgisonline.sharing.geow.Community.updateProfile(e,function(c){f.publish("esri/userPreferences"+(b||"user_prefs"),[a])})):f.publish("esri/userPreferences"+
(b||"user_prefs"),[a]);else return e="contentModePrefs"===b?esriGeowConfig.userInfo&&esriGeowConfig.userInfo.preferredView:null,null!=c?f.json.parse(c):e?{contentMode:e}:{}},getToken:function(){return!1===this.isLoggedIn()?"":esriGeowConfig.userInfo.token},callPage:function(a){window.location=arcgisonline.sharing.util.replaceSSL(esriGeowConfig.baseUrl+a)},openPageAndCount:function(a,b,e){a=esriGeowConfig.restBaseUrl+"content/items/"+a+"/data";var c=arcgisonline.sharing.util.getToken(),d={f:"json"};
null!=c&&""!==c&&(d.token=c);esri.request({url:a,content:d,callbackParamName:"callback"});arcgisonline.sharing.util.openPage(b,"boolean"===typeof e?e:!1)},openPage:function(a,b){b?window.location=a:window.open(a)},fix:function(a){null!=a&&(1==a.length&&null!=a[0]&&0<a[0].length)&&(a=a[0]);return a.replace(/&lt;/g,"\x3c")},stripHTML:function(a){return!a?a:-1<a.indexOf("\x3c")&&-1<a.indexOf("\x3e")?a.replace(/<(?:.|\s)*?>/g,""):a},urlToObject:function(a){a=esri.urlToObject(a);a.query=a.query||{};for(var b in a.query)a.query.hasOwnProperty(b)&&
(a.query[b]=a.query[b].replace(/(&lt;|&gt;|<|>|%3C|%3E)/g,""));return a},linkifyText:function(a){a=a.split(" ");for(var b=0;b<a.length;b++)if(0===a[b].indexOf("http://")||0===a[b].indexOf("https://"))a[b]="\x3ca href\x3d'"+a[b]+"' target\x3d'_blank'\x3e"+a[b]+"\x3c/a\x3e";return a.join(" ")},removeHTMLTags:function(a){if(null==a)return"";a=a.replace(/&(lt|gt);/g,function(a,e){return"lt"==e?"\x3c":"\x3e"});return a.replace(/<\/?[^>]+(>|$)/g,"")},getSnippet:function(a,b){if(null==a||0===a.length)b=
arcgisonline.sharing.util.removeHTMLTags(b),a=180<b.length?b.substring(0,180)+" ...":b;return a},trimTags:function(a){for(;-1<a.indexOf("  ");)a=a.replace(/  /g," ");for(;-1<a.indexOf(",,");)a=a.replace(/,,/g,",");return a=f.trim(a.replace(/, ,/,",").replace(/^,/,"").replace(/,$/,""))},postProcessUri:function(a){a=0<=a.indexOf("?")?a+"\x26f\x3djson":a+"?f\x3djson";var b=this.getToken();null!=b&&""!==b&&(a=a+"\x26token\x3d"+b);return this.useSSL(a)},replaceSSL:function(a){return!1===esriGeowConfig.useSSL?
a:a.replace("http://","https://")},useSSL:function(a){return"https:"===window.location.protocol||esriGeowConfig.self&&!0===esriGeowConfig.self.allSSL?a.replace("http:","https:"):a},errorHandler:function(a,b,e,c){if(-1<e.indexOf(esriGeowConfig.restBaseUrl)&&a.code&&498==a.code||403==a.code||400==a.code&&"Invalid account"==a.message)if(403==a.code&&!0===this.isLoggedIn())e&&-1<e.indexOf("/invitations/")&&c?c(a,b):0>window.location.href.indexOf(esriGeowConfig.baseUrl+"error.html")&&("Request not made over ssl"==
a.message?window.location=esriGeowConfig.baseUrl+"error.html?c\x3dSSLRequired":arcgisonline.sharing.util.checkSubscriptionStatus(a)&&(window.location=esriGeowConfig.baseUrl+"error.html?c\x3dAccessDeniedResource"));else{if((403!==a.code||arcgisonline.sharing.util.checkSubscriptionStatus(a))&&!(403===a.code&&!1===esriGeowConfig.isMultiTenant&&-1<f.indexOf(["COM_0056","COM_0057"],a.messageCode))){esriGeowConfig.userInfo=null;f.cookie("esri_auth",null,{expires:-1,path:"/",domain:document.domain});f.cookie("esri_auth",
null,{expires:-1,path:"/",domain:".arcgis.com"});arcgisonline.sharing.util&&(arcgisonline.sharing.util._cookies&&arcgisonline.sharing.util._cookies.esri_auth)&&delete arcgisonline.sharing.util._cookies.esri_auth;b="";-1==esriGeowConfig.signin.indexOf("http")&&(b=esriGeowConfig.baseUrl,!1!==esriGeowConfig.useSSL&&(b=b.replace("http:","https:")));b+=esriGeowConfig.signin;e="";c=b+("?error\x3d"+a.code);if(0>window.location.href.indexOf(c))-1<window.location.href.indexOf(esriGeowConfig.webmapViewerPath)&&
arcgisonline.map.main.map&&arcgisonline.map.main.mapInitialized?(arcgisonline.map.storage.saveMapInCookie(null,!1),e="\x26returnUrl\x3d"+encodeURIComponent(esriGeowConfig.baseUrl+esriGeowConfig.webmapViewerPath+"?useExisting\x3d1")):e="\x26returnUrl\x3d"+encodeURIComponent(window.location);else{var d=f.queryToObject(window.location.search.slice(1)).returnUrl;d&&(e="\x26returnUrl\x3d"+encodeURIComponent(d))}c+=e;0>window.location.href.indexOf(c)?window.location=c:"User not part of this account"===
a.message&&(window.location=b+"?error\x3d400"+e)}}else c?c(a,b):console.log(a.message)},checkSubscriptionStatus:function(a){return-1!==f.indexOf(["SB_0001","SB_0002","SB_0003","SB_0004"],a.messageCode)?(arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg.prototype.statics.getInstance().show(esriGeowConfig.self.subscriptionInfo),!1):-1!==f.indexOf(["SB_0005","SB_0006","SB_0007"],a.messageCode)?(arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg.prototype.statics.getInstance().showOther(a.messageCode),
!1):!0},checkError:function(a){var b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();if(-1!==f.indexOf("COM_0044 COM_0047 CONT_0046 CONT_0047 COM_1043 COM_1044 COM_1045 COM_1046".split(" "),a.messageCode)){var e=f.mixin({},f.i18n.getLocalization("arcgisonline","arcgisonline").common);a=e&&e.errors&&e.errors[a.messageCode]?{message:e.errors[a.messageCode]}:a;a=f.mixin(f.mixin({},e.errors.genericError),a);esriGeowConfig.hideDefaultCheckErrorMessage||b.show(a);return!1}return!0},
handler:function(a,b,e,c,d){a.error&&""!==a.error?arcgisonline.sharing.util.errorHandler(a.error,b,e,d):c&&c(a,b)},getJson:function(a,b,e){return arcgisonline.sharing.util._requestWithAppHandlers({url:a},{},b,e)},getJsonWithContent:function(a,b,e,c){return arcgisonline.sharing.util._requestWithAppHandlers({url:a,content:b},{},e,c)},postJson:function(a,b,e,c){return arcgisonline.sharing.util._requestWithAppHandlers({url:b,content:a},{usePost:!0},e,c)},postJsonCheckProxy:function(a,b,e,c){return"http:"===
window.location.protocol&&-1<b.indexOf("https://")?arcgisonline.sharing.util._requestWithAppHandlers({url:b,content:a},{usePost:!0,useProxy:!0},e,c):arcgisonline.sharing.util._requestWithAppHandlers({url:b,content:a},{usePost:!0},e,c)},postForm:function(a,b,e,c){return arcgisonline.sharing.util._requestWithAppHandlers({url:b,form:a},{usePost:!0},e,c)},_requestWithAppHandlers:function(a,b,e,c){var d=arcgisonline.sharing.util.request(a,b);d.then(function(b,f){arcgisonline.sharing.util.handler(b||{},
d.ioArgs,a.url,e,c);return b},function(b,e){arcgisonline.sharing.util.errorHandler(b||{},d.ioArgs,a.url,c);throw b;});return d},request:function(a,b){var e=a.url,c=a.content||{},d=arcgisonline.sharing.util.getToken(),g;b=b||{};var h=arcgisonline.sharing.util.urlToObject(e).query||{};!c.f&&!h.f&&(c=f.mixin(c,{f:"json"}));d&&!c.token&&!1!==b.addToken?c.token=d:!1===b.addToken&&delete c.token;a=f.mixin({},{url:!1===b.addSSL?e:arcgisonline.sharing.util.useSSL(e),content:c,form:a.form,callbackParamName:a.form?
a.callbackParamName||null:a.callbackParamName||"callback",timeout:b&&b.timeout||0});g=esri.request(a,b);g.addErrback(function(a){"IdentityManagerBase.1"===a.code&&(a.code=a.httpCode);arcgisonline.sharing.util.checkSoftwareAuthError(a,g);arcgisonline.sharing.util.checkSubscriptionStatus(a)||(g.canceled=!0);arcgisonline.sharing.util.isUnlicensed(a)&&(g.canceled=!0,-1===window.location.href.indexOf("unlicensed.html")&&(window.location=esriGeowConfig.baseUrl+"unlicensed.html"));arcgisonline.sharing.util.isInvalidUser(a)&&
(g.canceled=!0,arcgisonline.sharing.geow.Geow.signout(esriGeowConfig.baseUrl+"index.html"));arcgisonline.sharing.util.checkError(a)||(g.canceled=!0);throw a;});return g},_fetchItemData:function(a,b){var e=this.getUser(),c=this.getItemDataPath(a);"admin"===a.itemControl||e&&e.email===a.owner?this.openPage(b,!0):this._canAccessUrl(c).then(f.hitch(this,function(){this.openPage(b,!0)}),f.hitch(this,function(a){a&&403===a.status?this._showError({title:this.i18n.viewer.error.noPermissionTitle,message:this.i18n.errorWidget.accessDeniedResource}):
this.openPage(b,!0)}))},_canAccessUrl:function(a){var b=new f.Deferred;f.xhr("HEAD",{url:a,handleAs:"text",headers:{"X-Requested-With":null},withCredentials:this.isPortal()?!0:!1}).then(function(a){b.resolve(!0)},function(a){b.reject(a)});return b},_showError:function(a){var b=new arcgisonline.sharing.dijit.dialog.ConfirmDialog({showCancel:!1,style:{width:"375px",height:"auto"}}),e=a||{};e.code=a.code||0;e=f.mixin({},this.i18n.common.errors.genericError,this.i18n.common.errors[a.code]||a);b.show(e).then(f.hitch(this,
function(){b.hide()}))},checkSoftwareAuthError:function(a,b){var e=["COM_0056","COM_0057"];!1===esriGeowConfig.isMultiTenant&&(a.code&&403===a.code&&a.messageCode&&-1!==f.indexOf(e,a.messageCode)&&-1===window.location.href.indexOf("error.html"))&&(b.canceled=!0,"COM_0056"===a.messageCode?window.location=esriGeowConfig.baseUrl+"error.html?c\x3dPortalCreateAccount":"COM_0057"===a.messageCode&&(window.location=esriGeowConfig.baseUrl+"error.html?c\x3dPortalSignIn"))},isUnlicensed:function(a){return!1===
esriGeowConfig.isMultiTenant&&a.code&&503===a.code&&a.messageCode&&"GWM_0006"===a.messageCode},isInvalidUser:function(a){return!1===esriGeowConfig.isMultiTenant&&a.code&&404===a.code&&a.messageCode&&"POR_205244"===a.messageCode},isNode:function(a){return"object"===typeof Node?a instanceof Node:a&&"object"===typeof a&&"number"===typeof a.nodeType&&"string"===typeof a.nodeName},isElement:function(a){return"object"===typeof HTMLElement?a instanceof HTMLElement:a&&"object"===typeof a&&1===a.nodeType&&
"string"===typeof a.nodeName},isHostedService:function(a){if(!a)return!1;var b=(new f._Url(esriGeowConfig.restBaseUrl)).authority,e=!1===esriGeowConfig.isMultiTenant,c=-1!==a.indexOf(".arcgis.com/"),d=-1!==a.indexOf("//services")||-1!==a.indexOf("//tiles")||-1!==a.indexOf("//features");a=esri.isDefined(esriGeowConfig.self)&&esriGeowConfig.self.supportsHostedServices&&-1!==a.indexOf(b)&&!e;return c&&d||!c&&a},isHostedServiceItem:function(a){return arcgisonline.sharing.util.isHostedService(a.item)||
arcgisonline.sharing.util.isHostedService(a.url)},isHostedTemplateItem:function(a){a=a?a.split("?")[0]:"";return(a=a.match(/http.+(arcgis.com\/apps)\/?/ig))&&a.length?!0:!1},isAgolService:function(a){return!a?!1:-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/")},supportsHttps:function(a){if(!a)return!1;var b=!1;f.forEach(esriGeowConfig.httpsDomains,function(e){if(-1<a.indexOf("."+e+"/")||-1<a.indexOf("/"+e+"/"))b=!0});!b&&-1<a.indexOf(esriGeowConfig.self.portalHostname)&&
(b=!0);return b},isArcGISServer:function(a){var b=/http.+\/(arcgis\/rest\/services|arcgis\/services)\/?/ig,e=/(\/(MapServer|GeocodeServer|GPServer|GeometryServer|ImageServer|NAServer|FeatureServer|GeoDataServer|GlobeServer|MobileServer)).*/ig;return(a=(a=a&&a.split("?")[0])&&a.replace(b,"").match(e))&&a.length?a[0].split("/")[1]:null},getStaticImagesUrl:function(){var a=esriGeowConfig.staticImagesUrl||esriGeowConfig.self.staticImagesUrl;return(esriGeowConfig.allSSL||"https:"===location.protocol)&&
a?a.replace("http:","https:"):a},getRedSphereUrl:function(){return arcgisonline.sharing.util.getStaticImagesUrl()+"/Symbols/Basic/RedSphere.png"},doNothing:function(){},parseUrl:function(a){var b=document.createElement("a");b.href=a;for(var e=b.protocol.replace(":",""),c=b.hostname||window.location.host,d=b.port,f=b.search,h={},k=b.search.replace(/^\?/,"").split("\x26"),l=k.length,m=0,n;m<l;m++)k[m]&&(n=k[m].split("\x3d"),h[n[0]]=n[1]);return{source:a,protocol:e,host:c,port:d,query:f,params:h,file:(b.pathname.match(/\/([^\/?#]+)$/i)||
[,""])[1],hash:b.hash.replace("#",""),path:b.pathname.replace(/^([^\/])/,"/$1"),relative:(b.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:b.pathname.replace(/^\//,"").split("/")}},ellipse:function(a,b){a&&(a.length>b&&0<b-4)&&(a=a.substring(0,b-4)+"...");return a},appendTags:function(a,b){var e=a.get("value");b=e?b.split(",").concat(e.split(",")):b.split(",");a.set("value",arcgisonline.sharing.util.getUniqueArray(b).join(","));f.style(a.domNode,"color","#000000")},getUniqueArray:function(a){var b=
{};return f.filter(a,function(a){return b[a]?!1:b[a]=!0})},relativeToExplicitUrl:function(a){esriGeowConfig.cdnServerUrl=f.baseUrl.substring(0,f.baseUrl.indexOf("/js/"));return esriGeowConfig.cdnServerUrl.lastIndexOf("/")===esriGeowConfig.cdnServerUrl.length-1?esriGeowConfig.cdnServerUrl+a:esriGeowConfig.cdnServerUrl+"/"+a},getCookie:function(a){var b=this._cookies&&this._cookies[a]||null;if(!b){if((b=(b=f.cookie(a))?f.json.parse(b):-1)&&b.role)b.role=b.role?b.role.replace("org_","account_"):b.role;
b&&(this._cookies||(this._cookies={}),this._cookies[a]=b)}return-1===b||esriGeowConfig.ignoreCookie?null:b},canSharePublic:function(){return esriGeowConfig.self&&(!0===esriGeowConfig.self.canSharePublic||!1===esriGeowConfig.self.canSharePublic)?esriGeowConfig.self.canSharePublic:!0},getSecureUrl:function(a){a||(a=esriGeowConfig.baseUrl);if(!esriGeowConfig.self||!esriGeowConfig.self.portalMode||"singletenant"!==esriGeowConfig.self.portalMode||!esriGeowConfig.self.httpsPort)return a.replace("http:",
"https:");location.port?(a=a.replace(location.port,esriGeowConfig.self.httpsPort),arcgisonline.sharing.util.isPortal()&&(a=a.replace(esriGeowConfig.self.httpPort,esriGeowConfig.self.httpsPort))):a=a.replace(location.hostname,location.hostname+":"+esriGeowConfig.self.httpsPort);a=a.replace("http:","https:");console.log("Secure URL \x3d\x3d\x3d\x3e  ",a);return arcgisonline.sharing.util.cleanPorts(a)},htmlEncode:function(a){return!a?a:a.replace(/&/g,"\x26amp;").replace(/>/g,"\x26gt;").replace(/</g,
"\x26lt;").replace(/"/g,"\x26quot;")},getHttpUrl:function(a){a||(a=esriGeowConfig.baseUrl);if(!esriGeowConfig.self||!esriGeowConfig.self.portalMode||"singletenant"!==esriGeowConfig.self.portalMode||!esriGeowConfig.self.httpPort)return a.replace("https:","http:");location.port?(a=a.replace(location.port,esriGeowConfig.self.httpPort),arcgisonline.sharing.util.isPortal()&&(a=a.replace(esriGeowConfig.self.httpsPort,esriGeowConfig.self.httpPort))):a=a.replace(location.hostname,location.hostname+":"+esriGeowConfig.self.httpPort);
a=a.replace("https:","http:");console.log("HTTP URL \x3d\x3d\x3d\x3e  ",a);return arcgisonline.sharing.util.cleanPorts(a)},cleanPorts:function(a){return a.replace(/\:80\//,"/").replace(/\:443\//,"/")},usePortalSSL:function(){return(!1===esriGeowConfig.isMultiTenant||arcgisonline.sharing.util.isPortal())&&esriGeowConfig.self&&esriGeowConfig.self.portalHostname&&!esriGeowConfig.self.portalHostname.match(/:7080\//)&&80!==esriGeowConfig.self.httpPort&&443!==esriGeowConfig.self.httpsPort&&"https:"===location.protocol},
onAGOLFederatedServer:function(a){for(var b=!1,e=0;e<esriGeowConfig.httpsDomains.length;e++)if(a&&-1<a.indexOf(esriGeowConfig.httpsDomains[e])){b=!0;break}return b},onFederatedServer:function(a){var b=!1;a&&(0<a.length&&esriGeowConfig.federatedServers&&0<esriGeowConfig.federatedServers.length)&&(b=f.some(esriGeowConfig.federatedServers,f.hitch(this,function(b){return-1<a.indexOf(b.url)||-1<a.indexOf(b.adminUrl)})));return b},isPortal:function(){return esri.isDefined(esriGeowConfig.self)&&esriGeowConfig.self.isPortal},
portalSupportsHostedServices:function(){return arcgisonline.sharing.util.isPortal()&&esriGeowConfig.self.supportsHostedServices},getHomeAppContext:function(){if(arcgisonline.sharing.util.isPortal()){var a=window.location.pathname,b=a.indexOf("/home");if(0<b)return a.substring(0,b)}return""},normalizeOrgRole:function(a){return a?a.replace("org_","account_"):a},checkForIAA:function(){var a=new f.Deferred,b=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))+"/portaladmin";f.xhrGet({url:b,
handleAs:"json",content:{f:"json",ts:(new Date).getTime()}}).then(f.hitch(this,function(b){var c=arcgisonline.sharing.util.getUser();b&&b.status&&"error"===b.status&&b.code&&503===b.code?a.resolve({hasIAA:!0}):b&&(!b.error&&!c||b.error&&b.error.code&&(!c&&499!==b.error.code||c&&498!==b.error.code))?-1===window.location.href.indexOf("createadmin.html")?window.location=arcgisonline.sharing.util.getSecureUrl("https://"+esriGeowConfig.self.portalHostname+"/home/createadmin.html"):a.resolve({hasIAA:!1}):
a.resolve({hasIAA:!0})}),f.hitch(this,function(b){499!==b.status?-1===window.location.href.indexOf("createadmin.html")?window.location=arcgisonline.sharing.util.getSecureUrl("https://"+esriGeowConfig.self.portalHostname+"/home/createadmin.html"):a.resolve({hasIAA:!1}):a.resolve({hasIAA:!0})}));return a},getBridgeUrl:function(a,b){var e=esriGeowConfig.bridgeUrl+"?url\x3d"+encodeURIComponent(a);return b.expires?e+"\x26exp\x3d"+Math.ceil((new Date(b.expires)-new Date)/1E3):e},getUserDisplayName:function(a){var b=
a&&a.fullName||"";a=a.firstName||b;-1<b.indexOf("_")?a=b.split("_")[0]:-1<b.indexOf(",")?a=b.split(",").slice(1).join(" "):-1<b.indexOf(" ")&&(a=b.split(" ")[0]);return a.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")},isProApp:function(a){return a&&"ArcGIS Pro"===a.title&&"esri_apps"===a.owner&&a.tags&&-1<f.indexOf(a.tags,"pro")},findProListing:function(){var a=new f.Deferred,b=!1,e=!1,c;arcgisonline.sharing.util.request({url:esriGeowConfig.restBaseUrl+"portals/self/purchases"}).then(f.hitch(this,
function(d){d.purchases?(f.forEach(d.purchases,f.hitch(this,function(a){if(!e&&(a.listing&&"ArcGIS Pro"===a.listing.title&&"esri_apps"===a.listing.owner&&"licenseByUser"===a.listing.licenseBy)&&(b=f.some(a.listing.tags,f.hitch(this,function(a){return a&&"pro"===a.toLowerCase()}))))c=a,e=!0})),a.resolve(e?c:null)):a.resolve(null)}),f.hitch(this,function(b){a.reject(b)}));return a},findLicenseByUserProducts:function(){var a=new f.Deferred,b=[{owner:"esri_apps",tag:"navigator"},{owner:"esri_apps",tag:"appstudiostandard"}],
e=!1,c=!1,d,g,h;arcgisonline.sharing.util.request({url:esriGeowConfig.restBaseUrl+"portals/self/purchases"}).then(f.hitch(this,function(k){k.purchases?(d={pro:null,products:null},f.forEach(k.purchases,f.hitch(this,function(a){if(a.listing&&"licenseByUser"===a.listing.licenseBy)if(e=!0,"ArcGIS Pro"===a.listing.title&&"esri_apps"===a.listing.owner){if(c=f.some(a.listing.tags,f.hitch(this,function(a){return a&&"pro"===a.toLowerCase()})))d.pro=a}else for(h=0;h<b.length;h++)if(g=b[h],a.listing.owner===
g.owner&&f.some(a.listing.tags,f.hitch(this,function(a){return a&&a.toLowerCase()===g.tag.toLowerCase()}))){d.products?d.products.push(a):d.products=[a];break}})),a.resolve(e?d:null)):a.resolve(null)}),f.hitch(this,function(b){a.reject(b)}));return a},isEsriWorldGeocoder:function(a){var b=arcgisonline.sharing.util.isEsriWorldGeocoderNoProxy(a);a=arcgisonline.sharing.util.isEsriWorldGeocoderThroughProxy(a);return b||a},isEsriWorldGeocoderNoProxy:function(a){return a&&!!a.match(/(arcgis.com\/arcgis\/rest\/services\/world\/geocodeserver).*/ig)},
isEsriWorldGeocoderThroughProxy:function(a){return a&&!!a.match(/(\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/ig)},filterBatchGeocoders:function(a,b){return f.filter(a,f.hitch(this,function(a){var c=arcgisonline.sharing.util.isEsriWorldGeocoderNoProxy(a.url),d=arcgisonline.sharing.util.isEsriWorldGeocoderThroughProxy(a.url);if((c||d)&&!esri.isDefined(a.name))a.name=esri.i18nBundle.common.esriWorldGeocoder;return c&&(arcgisonline.sharing.util.isPortal()||b)?!1:c||d||!!a.batch}))},
downloadWebMappingApp:function(a){var b="Mobile Application"!==a.type?"WMA2Code":"MobileApp2Code",e=esriGeowConfig.restBaseUrl+"content/items/"+a.id+"/relatedItems",b=a.relatedItems||arcgisonline.sharing.util.request({url:e,content:{relationshipType:b}}).then(f.hitch(this,function(b){a.relatedItems=b&&b.relatedItems||[];return a.relatedItems}));return f.when(b,f.hitch(this,function(a){var b=a||[],e=f.filter(b,function(a){return a&&null!==a.url});a=e&&e.length?e[0]:b&&0<b.length?b[0]:a;if(a.id)var h=
a.url||arcgisonline.sharing.util.getItemDataPath(a);a.url?window.open(h):window.location=h;n.byId("share-map-stack")&&n.byId("share-map-stack").selectChild(n.byId("share-map-application-help"))}),f.hitch(this,function(a){console.log(a)}))},loadUserTags:function(a){var b=new f.Deferred;a?arcgisonline.sharing.util.request({url:esriGeowConfig.restBaseUrl+"community/users/"+a+"/tags",content:{ts:(new Date).getTime()}}).then(f.hitch(this,function(a){var c=[];a&&a.tags&&(c=a.tags);b.resolve(c)}),f.hitch(this,
function(a){b.resolve([])})):b.resolve([]);return b},isValidEmailAddress:function(a){if(window.RegExp){var b=/^.+\@(\[?)[a-zA-Z0-9\-\.]+\.([a-zA-Z]{2,20}|[0-9]{1,3})(\]?)$/;return!/(@.*@)|(\.\.)|(@\.)|(\.@)|(^\.)/.test(a)&&b.test(a)?!0:!1}return-1===a.indexOf("@")||-1===a.indexOf(".")?!1:!0},groupUsedInOrgSettings:function(a){return(a=a?"id:"+a:null)&&esriGeowConfig.self&&(-1<esriGeowConfig.self.basemapGalleryGroupQuery.indexOf(a)||-1<esriGeowConfig.self.colorSetsGroupQuery.indexOf(a)||-1<esriGeowConfig.self.featuredGroupsId.indexOf(a)||
-1<esriGeowConfig.self.featuredItemsGroupQuery.indexOf(a)||-1<esriGeowConfig.self.galleryTemplatesGroupQuery.indexOf(a)||-1<esriGeowConfig.self.homePageFeaturedContent.indexOf(a)||-1<esriGeowConfig.self.layerTemplatesGroupQuery.indexOf(a)||-1<esriGeowConfig.self.livingAtlasGroupQuery.indexOf(a)||-1<esriGeowConfig.self.stylesGroupQuery.indexOf(a)||-1<esriGeowConfig.self.symbolSetsGroupQuery.indexOf(a)||-1<esriGeowConfig.self.templatesGroupQuery.indexOf(a))}}});