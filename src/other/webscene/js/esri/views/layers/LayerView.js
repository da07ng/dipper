// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define(["../../core/declare","dojo/_base/lang","../../core/Accessor","../../core/Evented","../../core/Promise"],function(d,e,f,g,h){var k=0;return d([f,g,h],{declaredClass:"esri.views.layers.LayerView",classMetadata:{properties:{refreshTimer:{readOnly:!0,dependsOn:["suspended","layer.refreshInterval"]},suspended:{dependsOn:["view","visible","loaded","layer.visible","parent.suspended"],readOnly:!0},updating:{dependsOn:["suspended"]}}},constructor:function(){this.id=Date.now().toString(16)+"-layerview-"+
k++;this._layerHandles=[];this.watch("suspended",this._suspendedWatcher.bind(this))},initialize:function(){this.addResolvingPromise(this.layer);this.then(e.hitch(this,function(a){this.loaded=!0}))},destroy:function(){this.layer=this.parent=null},layer:null,_layerSetter:function(a){var b=this._layerHandles;b.forEach(function(a){a.remove()});b.length=0;a&&b.push(a.on("refresh",this.refresh.bind(this)));return a},loaded:!1,parent:null,_refreshTimerGetter:function(a){var b=this.suspended,c=this.get("layer.refreshInterval")||
0;a&&(clearTimeout(a),a=null);!b&&c&&(a=setTimeout(this.refresh.bind(this),6E4*c));return a},suspended:!0,_suspendedGetter:function(){return!this.canResume()},_updating:!1,_updatingGetter:function(){return!(!this._updating||this.suspended)},_updatingSetter:function(a){this._updating=!!a},visible:!0,refresh:function(){},canResume:function(){return!this.get("parent.suspended")&&this.view&&this.view.ready&&this.layer&&this.layer.loaded&&(this.hasOwnProperty("visible")?this.visible:this.layer.visible)||
!1},_suspendedWatcher:function(a){a?this.emit("suspend"):this.emit("resume")}})});