// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
require({cache:{"url:arcgisonline/sharing/dijit/dialog/templates/FederateServerDlg.html":'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv class\x3d"${baseClass}" data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"_federateServerDialog"\r\n       id\x3d"federate-server-dialog" title\x3d"${i18n.federateServerDialogTitle}"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_federateServerDesc"\x3e${i18n.federateArcGISServer}\x3c/div\x3e\x3cbr/\x3e\r\n\r\n    \x3cdiv class\x3d"esriAlignLeading valignTop"\x3e\r\n      \x3ctable class\x3d"esriFloatLeading" border\x3d"0" cellpadding\x3d"0" cellspacing\x3d"0" width\x3d"98%"\x3e\r\n        \x3ctbody\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd class\x3d"inputLabel valignTop"\x3e\x3clabel\x3e${i18n.urlLabel}\x3c/label\x3e\x3c/td\x3e\r\n            \x3ctd class\x3d"valignTop"\x3e\r\n              \x3cdiv data-dojo-attach-point\x3d"_urlInput" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim: true" style\x3d"width:100%;"\x3e\x3c/div\x3e\x3cbr/\x3e\r\n              \x3cdiv class\x3d"esriAlignLeading example"\x3e${i18n.urlInputPlaceHolder}\x3c/div\x3e\x3cbr/\x3e\r\n            \x3c/td\x3e\r\n          \x3c/tr\x3e\r\n        \x3c/tbody\x3e\r\n      \x3c/table\x3e\r\n      \x3cbr style\x3d"clear:both;"/\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriAlignLeading valignTop" style\x3d"clear:both;"\x3e\r\n      \x3ctable class\x3d"esriFloatLeading" border\x3d"0" cellpadding\x3d"0" cellspacing\x3d"0" width\x3d"98%"\x3e\r\n        \x3ctbody\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd class\x3d"inputLabel valignTop"\x3e\x3clabel\x3e${i18n.adminUrlLabel}\x3c/label\x3e\x3c/td\x3e\r\n            \x3ctd class\x3d"valignTop"\x3e\r\n              \x3cdiv data-dojo-attach-point\x3d"_adminUrlInput" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim: true" style\x3d"width:100%;"\x3e\x3c/div\x3e\x3cbr/\x3e\r\n              \x3cdiv class\x3d"esriAlignLeading example"\x3e${i18n.adminUrlInputPlaceHolder}\x3c/div\x3e\x3cbr/\x3e\r\n            \x3c/td\x3e\r\n          \x3c/tr\x3e\r\n        \x3c/tbody\x3e\r\n      \x3c/table\x3e\r\n      \x3cbr style\x3d"clear:both;"/\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_credentials" class\x3d"${baseClass} credentials esriAlignLeading valignTop" style\x3d"clear:both;"\x3e\x3c/div\x3e\r\n    \x3cbr style\x3d"clear:both;"/\x3e\r\n    \x3cdiv class\x3d"esriAlignTrailing"\x3e\r\n      \x3cspan style\x3d"display:none;" data-dojo-attach-point\x3d"_federatingMsgSpan"\x3e${i18n.addingServer}\x3c/span\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_okBtn" data-dojo-type\x3d"dijit/form/Button" type\x3d"button" class\x3d"primary"\x3e${i18n.addServer}\x3c/button\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_cancelBtn" data-dojo-type\x3d"dijit/form/Button" type\x3d"button" class\x3d"cancel"\x3e${i18n.cancel}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n'}});
define("arcgisonline/sharing/dijit/dialog/FederateServerDlg","require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/topic dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/sniff dojo/on dijit/a11yclick dojo/keys dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/Dialog dijit/form/Button dijit/form/TextBox esri/lang arcgisonline/sharing/util arcgisonline/sharing/dijit/ServiceInfo arcgisonline/sharing/dijit/dialog/GeneralDlg dojo/i18n!arcgisonline/nls/arcgisonline dojo/text!arcgisonline/sharing/dijit/dialog/templates/FederateServerDlg.html".split(" "),
function(n,p,f,D,q,r,s,E,t,F,u,k,v,w,x,y,z,G,H,I,g,l,J,A,m,B){var h=p("arcgisonline.sharing.dijit.dialog.FederateServerDlg",[x,y,z],{declaredClass:"arcgisonline.sharing.dijit.dialog.FederateServerDlg",baseClass:"esriFederateServerDlg",basePath:n.toUrl("arcgisonline/sharing/dijit/dialog"),templateString:B,widgetsInTemplate:!0,_serverInfo:null,_currentServers:[],_getServersPath:"/portaladmin/federation/servers",_registerServerPath:"/portaladmin/federation/servers/federate",postMixInProperties:function(){this.inherited(arguments);
this.i18n=f.mixin({},m.common);f.mixin(this.i18n,m.federateServerDlg)},postCreate:function(){this.inherited(arguments);this._generalDlg=A.prototype.statics.getInstance();this._setupConnections()},show:function(){this._clear();this._getCurrentServers();this._federateServerDialog.show()},hide:function(){this._federateServerDialog.hide()},_setupConnections:function(){this.own(k(this._okBtn,f.hitch(this,this._okClick)),k(this._cancelBtn,f.hitch(this,this._cancelClick)));this._cancelEscFunction()},_cancelEscFunction:function(){this.own(u(this._federateServerDialog.containerNode,
"keypress",f.hitch(this,function(b){b.keyCode==v.ESCAPE&&(b.preventDefault(),b.stopPropagation())})))},_validInfo:function(b,a,e,c){return this._isURL(b)&&this._isURL(a)&&g.isDefined(e)&&0<e.length&&g.isDefined(c)&&0<c.length},_isURL:function(b){return g.isDefined(b)&&0<b.length&&-1<b.indexOf("http")&&-1<b.indexOf("://")},_isNotRegistered:function(b,a){for(var e=!0,c=0;c<this._currentServers.length;c++){var d=this._currentServers[c];if(d.url===b||d.adminUrl===a||d.url===a||d.adminUrl===b){e=!1;break}}return e},
_setRegistering:function(b){this._okBtn.set("disabled",b);s.set(this._okBtn,"label",b?this.i18n.addingServer:this.i18n.addServer)},_stripTrailingSlash:function(b){if(g.isDefined(b)){var a=b.indexOf("/",b.length-1);if(-1!==a)return b.substring(0,a)}return b},_cleanUrl:function(b){var a=b.match(/^http.+(arcgis)$/ig),a=a&&0<a.length?a[0]:null;null===a&&(a=this._stripTrailingSlash(b));return a},_publishServerRegistered:function(b,a,e,c,d){var C=(new q(a)).authority;r.publish("federate-server-register",
{id:b,url:a,name:C,adminUrl:e,username:c,password:d,isHosted:!1})},_registerServer:function(b,a,e,c){var d=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))+this._registerServerPath;return l.request({url:d,content:{url:b,adminUrl:a,username:e,password:c,culture:dojo.locale}},{usePost:!0})},_okClick:function(b){var a=this,e=a._cleanUrl(a._urlInput.get("value")),c=a._cleanUrl(a._adminUrlInput.get("value")),d=a._serviceInfoPane.get("userInfo")||{};a._validInfo(e,c,d.username,
d.password)?a._isNotRegistered(e,c)?(a._setRegistering(!0),this._registerServer(e,c,d.username,d.password).then(function(b){a._setRegistering(!1);b.code&&b.message?a._generalDlg.show({title:a.i18n.errorTitle,message:b.message}):(a._publishServerRegistered(b.serverId,e,c,d.username,d.password),a.hide())},function(b){a._setRegistering(!1);b&&b.message?a._generalDlg.show({title:a.i18n.errorTitle,message:b.message}):b?a._generalDlg.show({title:a.i18n.errorTitle,message:b}):a._generalDlg.show({title:a.i18n.errorTitle,
message:a.i18n.errors.registration})})):a._generalDlg.show({title:a.i18n.errorTitle,message:a.i18n.errors.serverAlreadyRegistered}):a._generalDlg.show({title:a.i18n.notice,message:a.i18n.enterInformation})},_cancelClick:function(b){b&&b.preventDefault();this.hide()},_getCurrentServers:function(){var b=this,a=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"));l.request({url:a+b._getServersPath}).then(function(a){b._currentServers=a&&a.servers?a.servers:[]})},_clear:function(){!this._serviceInfoPane&&
!this._credentialConnect&&(this._serviceInfoPane=new arcgisonline.sharing.dijit.ServiceInfo({},this._credentials));w(".credentials").style("display","");this._serviceInfoPane._username.set("value","");this._serviceInfoPane._password.set("value","");t.set(this._federatingMsgSpan,"display","none");this._okBtn.set("label",this.i18n.addServer);this._serverInfo={};this._currentServers=[];this._urlInput.set("disabled",!1);this._urlInput.set("value","");this._adminUrlInput.set("disabled",!1);this._adminUrlInput.set("value",
"");this._setRegistering(!1)}});h.prototype.statics={_instance:null,getInstance:function(){null==this._instance&&(this._instance=new h);return this._instance}};return h});