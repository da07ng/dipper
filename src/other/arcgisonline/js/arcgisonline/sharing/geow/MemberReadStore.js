// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/geow/MemberReadStore",["dijit","dojo","dojox","dojo/require!dojox/data/QueryReadStore,arcgisonline/sharing/geow/Content"],function(k,a,h){a.provide("arcgisonline.sharing.geow.MemberReadStore");a.require("dojox.data.QueryReadStore");a.require("arcgisonline.sharing.geow.Content");a.declare("arcgisonline.sharing.geow.MemberReadStore",h.data.QueryReadStore,{_fetchItems:function(c,h,k){var g=c.serverQuery||c.query||{};g.start=c.start||0;g.start++;c.count&&(g.num=c.count);arcgisonline.sharing.util.getJson(this.url,
a.hitch(this,function(b){this._items=[];var f=null,e="";if(b.users){e="groupMembers";this._total=b.users.length+b.admins.length;a.publish("onMemberCount",[this._total]);var d={name:b.owner,memberType:"owner",requestType:e,groupowner:b.owner||"",groupadmins:b.admins||[]};this._items.push({i:d,r:this});a.forEach(b.admins,function(a,c){a!=b.owner&&(d={name:a,memberType:"admin",requestType:e,groupowner:b.owner||"",groupadmins:b.admins||[]},this._items.push({i:d,r:this}))},this);a.forEach(b.users,function(a,
c){d={name:a,memberType:"member",requestType:e,groupowner:b.owner||"",groupadmins:b.admins||[]};this._items.push({i:d,r:this})},this)}else f=b.applications,e="groupApplications",a.publish("onAppCount",[b.applications.length]),this._total=f.length,a.forEach(f,function(a,c){this._items.push({i:{name:a.username,fullname:a.fullname,requestType:e,groupowner:b.owner||"",groupadmins:b.admins||[],received:a.received||-1},r:this})},this);this._itemsByIdentity={};this._identifier="name";for(i=0;i<this._items.length;++i)d=
this._items[i].i,f=d.name,this._itemsByIdentity.name||(this._itemsByIdentity[f]=d);h(this._items,c,this._total);this.lastRequestHash=(new Date).getTime()+"-"+String(Math.random()).substring(2);this._lastServerQuery=a.mixin({},g)}))}})});