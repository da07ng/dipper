// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("../../core/declare dojo/_base/lang dojox/gfx dojox/gfx/matrix ./math/common ./math/mat2d ./math/vec2 ./Projector ../../geometry/Polygon ../../symbols/MarkerSymbol ../../symbols/SimpleMarkerSymbol ../../symbols/support/gfxUtils ../../core/screenUtils ../../core/Accessor".split(" "),function(w,x,y,s,z,q,t,A,B,C,r,u,D,E){var F=0,v=-1!==y.renderer.toLowerCase().indexOf("svg");r.fromJSON({type:"simplemarkersymbol",style:"square",size:20,xoffset:0,yoffset:0,angle:0});var G={picturemarkersymbol:"image",
picturefillsymbol:"path",simplefillsymbol:"path",simplelinesymbol:"path",cartographiclinesymbol:"path",textsymbol:"text"},H={square:1,cross:1,x:1,diamond:1,target:1};return w(E,{declaredClass:"esri.views.2d.VectorGroup",constructor:function(a){this.id="vecgp"+F++;this._transform=q.create();this._projector=new A;this.vectors=[];this.adding=[];this.removing=[];this.updating=[]},applyState:function(a){if(this.transform){var c=q.invert(this._transform,this.transform);q.multiply(c,a.transform,c);this.surface.setTransform({xx:c[0],
yx:c[1],xy:c[2],yy:c[3],dx:c[4],dy:c[5]})}},requestVectorDraw:function(a){},addVector:function(a){return this.addVectorAt(a,this.vectors.length)},addVectorAt:function(a,c){c=Math.min(this.vectors.length,c);this.vectors.splice(c,0,a);a.set({parent:this,view:this.view});return a},removeVector:function(a){if(!this.vectors)return a;var c=this.vectors.indexOf(a);-1<c&&(a=this.vectors.splice(c,1)[0],a.set({parent:null,view:null}),this._removeShape(a));return a},draw:function(){this._updateTransform();this.surface.openBatch();
var a,c,b;c=0;for(b=this.vectors.length;c<b;c++)(a=this.vectors[c])&&this.drawVector(a);this.surface.closeBatch()},drawVector:function(a,c){var b=a.graphic,d=a.extent,e=a.shape,h,g,f,k=a.projectedGeometry;if(b.visible&&d&&(h=this._intersects(this._map,d,b.geometry._originOnly))&&(g=a.symbol)){if(a.resolution!==this.resolution||!a.offsets||a.offsets.join(",")!==h.join(",")?a.offsets=h:f=!0,!e||c||!f){f=b.geometry.type;d=a.bgShape;a.resolution=this.resolution;if("point"===f)this._isInvalidShape(g,e)&&
this._removeShape(a),e=a.shape=this._drawPoint(this.surface,k||b.geometry,g,a,h,null,b),this._stylePoint(a.shape,g,null,b);else if("multipoint"===f)this._drawMarkers(b,g,h,null),this._symbolizeMarkers(b,g,null);else{f=g;var m;if((f=g.isInstanceOf(C)&&g?null:g)&&null===f)m=this._bgGroup;d&&!m&&this._removeBgShape(a);f&&(!m&&this._isInvalidShape(f,e)&&this._removeShape(a,!1),e=this._drawShape(k||b.geometry,h,m||this.surface,m?d:a.shape),this._styleShape(e,f,null,b,a),a[m?"bgShape":"shape"]=e)}e.getNode().vector=
a}}else e&&this._removeShape(a)},_intersects:function(a,c,b){return[0]},_isInvalidShape:function(a,c){var b=c&&c.shape&&c.shape.type,d=a&&a.type,e=a&&a.style;d&&(e=G[d]||e);H[e]&&(e="path");return!(!b||!(e&&b!==e))},_removeShape:function(a,c){var b=a.shape,d=b&&b.getNode();b&&(b.removeShape(),b.destroy());a.shape=a.offsets=null;!1!==c&&this._removeBgShape(a);d&&(d.e_graphic=null)},_removeBgShape:function(a){var c=a.bgShape,b=c&&c.getNode();c&&(c.removeShape(),c.destroy());a.bgShape=null;b&&(b.e_graphic=
null)},_drawPoint:function(a,c,b,d,e,h,g){var f=b.type;c=t.fromValues(c.x,c.y);var k=t.transformMat2d(c,c,this.transform),m=Math.round(k[0]),n=Math.round(k[1]),p=d.shape,l;c=[];g=h&&h.rotationInfo?h.getRotationAngle(g):null;d=(h=!!d.size)?D.pt2px(d.size[0]):null;g&&c.push(s.rotategAt(g,k));(0!==b.xoffset||0!==b.yoffset)&&c.push(s.translate(b.xoffset,-b.yoffset));0!==b.angle&&c.push(s.rotategAt(b.angle,k));if("simplemarkersymbol"===f)switch(l=b.style,f=Math.round,d=h?d:b.size,l){case r.STYLE_SQUARE:case r.STYLE_CROSS:case r.STYLE_X:case r.STYLE_DIAMOND:b=
isNaN(d)?16:d/2;l=this._drawPath(a,p,this._smsToPath(r,l,m,n,f(m-b),f(m+b),f(n-b),f(n+b)));break;case r.STYLE_TARGET:k=b._targetWidth/2;d=b._targetHeight/2;l=this._drawPath(a,p,this._smsToPath(r,l,m,n,f(m-k),f(m+k),f(n-d),f(n+d),b._spikeSize));break;case r.STYLE_PATH:l=this._drawPath(a,p,b.path,!0);b=l.getBoundingBox();a=this._getScaleMatrix(b,d);(1!==a.xx||1!==a.yy)&&c.push(s.scaleAt(a.xx,a.yy,k));c.push(s.translate(-(b.x+b.width/2)+m,-(b.y+b.height/2)+n));break;default:b=isNaN(d)?16:d/2,l=this._drawCircle(a,
p,{cx:m,cy:n,r:b})}else"shieldlabelsymbol"===f?(l=b.width,k=b.height,p=a.createGroup(),l=a.createImage({x:m-l/2,y:n-k/2,width:l,height:k,src:b.url}),p.add(l),null!=b.font&&(n+=0.2*b.getHeight(),a=a.createText({type:"text",text:b.text,x:m,y:n,align:"middle",decoration:b.decoration,rotated:b.rotated,kerning:b.kerning}),a.setFont(b.font),a.setFill(b.color),p.add(a)),l=p):"picturemarkersymbol"===f?(l=h?d:b.width,k=h?d:b.height,l=this._drawImage(a,p,{x:m-l/2,y:n-k/2,width:l,height:k,src:b.url})):"textsymbol"===
f&&(l=this._drawText(a,p,{type:"text",text:b.text,x:m,y:n,align:b.getSVGAlign(),decoration:b.decoration||b.font&&b.font.decoration,rotated:b.rotated,kerning:b.kerning}),v&&(a=l.getNode(),m=b.getSVGBaseline(),b=b.getSVGBaselineShift(),a&&(a.setAttribute("dominant-baseline",m),b&&a.setAttribute("baseline-shift",b))));l.setTransform(s.multiply(c));l._wrapOffsets=e;return l},_drawShape:function(a,c,b,d){var e=a.type,h=this._projector,g=[],f,k;"extent"===e&&(a=B.fromExtent(a),e=a.type);if("polyline"===
e||"polygon"===e){f=0;for(k=c.length;f<k;f++)g=g.concat(h.toScreenPath(a,c[f]));d=this._drawPath(b,d,g);this._rendererLimits&&("polyline"===e?this._clipPolyline(d,a):this._clipPolygon(d,a))}return d},_drawRect:function(a,c,b){return c?c.setShape(b):a.createRect(b)},_drawImage:function(a,c,b){return c?c.setShape(b):a.createImage(b)},_drawCircle:function(a,c,b){return c?c.setShape(b):a.createCircle(b)},_drawPath:function(a,c,b,d){b=d?b:b.join(" ");return c?c.setShape(b):a.createPath(b)},_smsToPath:function(a,
c,b,d,e,h,g,f,k){switch(c){case a.STYLE_SQUARE:return["M",e+","+g,h+","+g,h+","+f,e+","+f,"Z"];case a.STYLE_CROSS:return["M",b+","+g,b+","+f,"M",e+","+d,h+","+d];case a.STYLE_X:return["M",e+","+g,h+","+f,"M",e+","+f,h+","+g];case a.STYLE_DIAMOND:return["M",b+","+g,h+","+d,b+","+f,e+","+d,"Z"];case a.STYLE_TARGET:return["M",e+","+g,h+","+g,h+","+f,e+","+f,e+","+g,"M",e-k+","+d,e+","+d,"M",b+","+(g-k),b+","+g,"M",h+k+","+d,h+","+d,"M",b+","+(f+k),b+","+f]}},_stylePoint:function(a,c,b,d){var e=c.type;
if(!("shieldlabelsymbol"===e||"picturemarkersymbol"===e)){var h,g=b&&b.colorInfo;"textsymbol"===e?a.setFont(c.font).setFill(u.getFill(c)):(h=u.getStroke(c),c=u.getFill(c),"simplemarkersymbol"===e&&a.setFill(g?b.getColor(d):c).setStroke(h))}},_styleShape:function(a,c,b,d,e){var h=u.getStroke(c),g=u.getFill(c);c=c.type;var f,k;b=b&&b.proportionalSymbolInfo?b.getSize(d):null;e.color&&"picturefillsymbol"!==c&&(e=e.color,-1!==c.indexOf("linesymbol")?f=e:g&&g.toCss&&(k=e));a.setStroke(null==b&&!f?h:x.mixin({},
h,b&&{width:b},f&&{color:f})).setFill(k||g);v&&a.rawNode.setAttribute("vector-effect","non-scaling-stroke")},_updateTransform:function(){var a=this.transform=this.transform||q.create(),c=this.resolution,b=t.fromValues(0.5*this.view.width,0.5*this.view.height),d=t.fromValues(1/c,-1/c),e=t.fromValues(-this.x,-this.y),h=z.toRadian(this.view.rotation);q.identity(a);q.translate(a,a,b);q.scale(a,a,d);q.translate(a,a,e);q.rotate(a,a,h);a[4]=Math.round(a[4]);a[5]=Math.round(a[5]);this._projector.set({resolution:c,
transform:a})}})});