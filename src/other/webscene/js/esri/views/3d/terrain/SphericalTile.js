// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("./TileBase ./TileGeometryFactory ./TerrainConst ../support/ObjectPool ../support/mathUtils ../support/earthUtils ../lib/glMatrix".split(" "),function(k,p,q,r,n,d,s){var f=s.vec3d,g=d.earthRadius,h=f.create(),m=function(a,e,c,b){c=g+c;var l=Math.cos(a);b[0]=Math.cos(e)*l*c;b[1]=Math.sin(e)*l*c;b[2]=Math.sin(a)*c};d=function(a,e,c){k.call(this);this.tileUp=f.create();this.obb=Array(8);for(var b=0;8>b;b++)this.obb[b]=f.create();void 0!==a&&this.init(a,e,c)};d.prototype=new k;d.prototype.constructor=
d;d.prototype.init=function(a,e,c){k.prototype.init.call(this,a,e,c);e=a[0];c.tilingScheme.getExtent(e,a[1],a[2],this.extent,this.extentWGS84Rad);a=this.extentWGS84Rad[0];var b=this.extentWGS84Rad[1];c=this.extentWGS84Rad[2];var l=this.extentWGS84Rad[3],d=n.lerp(b,l,0.5),h=n.lerp(a,c,0.5);e=0===e?0:Math.min(Math.abs(b),Math.abs(l));this.edgeLen=(c-a)*Math.cos(e)*g;m(d,h,0,this.centerAtSeaLevel);f.set(this.centerAtSeaLevel,this.tileUp);f.normalize(this.tileUp);this.updateRadiusAndCenter();this._updateOBB()};
d.prototype.isVisible=function(a,e){if(!this.intersectsClippingArea)return!1;if(9<this.lij[0])for(var c=this.obb,b=0;6>b;b++){for(var d=0;8>d&&!(0>a[b][0]*c[d][0]+a[b][1]*c[d][1]+a[b][2]*c[d][2]+a[b][3]);d++);if(8===d)return!1}else if(c=this.radius,b=this.center,a[0][0]*b[0]+a[0][1]*b[1]+a[0][2]*b[2]+a[0][3]>c||a[1][0]*b[0]+a[1][1]*b[1]+a[1][2]*b[2]+a[1][3]>c||a[2][0]*b[0]+a[2][1]*b[1]+a[2][2]*b[2]+a[2][3]>c||a[3][0]*b[0]+a[3][1]*b[1]+a[3][2]*b[2]+a[3][3]>c||a[4][0]*b[0]+a[4][1]*b[1]+a[4][2]*b[2]+
a[4][3]>c||a[5][0]*b[0]+a[5][1]*b[1]+a[5][2]*b[2]+a[5][3]>c)return!1;return!0};d.prototype.updateElevationBounds=function(){k.prototype.updateElevationBounds.call(this);this._updateOBB()};d.prototype.updateRadiusAndCenter=function(){k.prototype.updateRadiusAndCenter.call(this);var a=this._isPole(this.lij[1],this.lij[0]);0<a&&(f.set3(0,0,0,h),2===a?f.set3(this.center[0],this.center[1],this.center[2]-g,h):1===a&&f.set3(this.center[0],this.center[1],this.center[2]+g,h),this.radius=Math.max(this.radius,
Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2])))};d.prototype._numSubdivisionsAtLevel=[128,64,32,16,16,8,8,4];d.prototype.createGeometry=function(a,e,c){var b=this._isPole(this.lij[1],this.lij[0]);a.needsUpdate=!1;return p.createSphericalGlobeTile(a.numVertsPerRow,this.extent,this.extentWGS84Rad,a.samplerData,e,b,c)};d.prototype._updateOBB=function(){for(var a=this.extentWGS84Rad,e=this.obb,c=0,c=0;2>c;c++){var b=this.elevationBounds[c],d=4*c;m(a[1],a[0],b,e[d++]);m(a[3],a[0],b,e[d++]);m(a[3],a[2],b,e[d++]);
m(a[1],a[2],b,e[d++])}a=this._isPole(this.lij[1],this.lij[0]);2===a?(f.set3(0,0,g,e[1]),f.set3(0,0,g,e[2]),f.set3(0,0,g,e[5]),f.set3(0,0,g,e[6])):1===a&&(f.set3(0,0,-g,e[1]),f.set3(0,0,-g,e[2]),f.set3(0,0,-g,e[5]),f.set3(0,0,-g,e[6]))};d.prototype._isPole=function(a,d){var c=0;a===(1<<d)-1&&(c+=1);0===a&&(c+=2);return c};d.prototype.elevationStartsAtLevel=q.Spherical.ELEVATION_STARTS_AT_LEVEL;r.on(d,400);return d});