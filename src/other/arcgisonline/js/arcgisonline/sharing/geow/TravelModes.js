// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/geow/TravelModes","require dojo/_base/declare dojo/Deferred dojo/_base/lang dojo/json arcgisonline/sharing/geow/Account arcgisonline/sharing/util".split(" "),function(h,k,e,l,g,m,f){return k(null,{declaredClass:"arcgisonline.geow.TravelModes",basePath:h.toUrl("arcgisonline/sharing/geow"),_travelModes:null,_travelModesFile:"travelmodes.json",_tmListingServiceURL_dev:"//logisticsdev.arcgis.com/arcgis/rest/services/World/Utilities/GPServer",_tmListingServiceURL_qa:"//logisticsqa.arcgis.com/arcgis/rest/services/World/Utilities/GPServer",
_tmListingServiceURL:"//logistics.arcgis.com/arcgis/rest/services/World/Utilities/GPServer",getTravelModes:function(){var d=new e;this._travelModes?d.resolve(this._travelModes):m.getSelf(l.hitch(this,function(b){var a=this._tmListingServiceURL,c=this;b.helperServices&&b.helperServices.routingUtilities&&b.helperServices.routingUtilities.url?a=b.helperServices.routingUtilities.url:"devext.arcgis.com"===b.portalHostname?a=c._tmListingServiceURL_dev:"qaext.arcgis.com"===b.portalHostname&&(a=c._tmListingServiceURL_qa);
a+=("/"===a[a.length-1]?"":"/")+"GetTravelModes/execute";f.request({url:a,content:{f:"json"}},{usePost:!0}).then(function(a){var b={};if(a&&a.results&&a.results[0]&&a.results[0].value&&a.results[0].value.features)for(var e=0;e<a.results[0].value.features.length;e++)if(a.results[0].value.features[e].attributes){var f=g.parse(a.results[0].value.features[e].attributes.TravelMode);b[f.id]=f}c._travelModes=b;d.resolve(b)},function(a){c._travelModes=null;d.reject(a)})}));return d.promise},uploadTravelMode:function(d,
b){var a=new e,c=this;d&&b?this.getTravelModes().then(function(e){esriGeowConfig.userInfo&&esriGeowConfig.userInfo.accountId?(e[d]=b,c._storeTravelModes(e).then(a.resolve,a.reject)):(this._travelModes=null,a.reject())},a.reject):a.reject();return a.promise},deleteTravelMode:function(d){var b=new e,a=this;d?this.getTravelModes().then(function(c){esriGeowConfig.userInfo&&esriGeowConfig.userInfo.accountId?(delete c[d],Object.keys(c).length?a._storeTravelModes(c).then(b.resolve,b.reject):a._deleteTravelModesFile().then(b.resolve,
b.reject)):(a._travelModes=null,b.reject())},b.reject):b.reject();return b.promise},reset:function(){return this._deleteTravelModesFile()},_storeTravelModes:function(d){var b=esriGeowConfig.restBaseUrl+"portals/"+esriGeowConfig.userInfo.accountId+"/addResource",a=this,c=new e;f.request({url:b,content:{access:"org",key:this._travelModesFile,text:g.stringify(d)}},{usePost:!0}).then(function(b){b.success?(a._travelModes=d,c.resolve(a._travelModes)):(a._travelModes=null,c.reject(b))},function(b){a._travelModes=
null;c.reject(b)});return c.promise},_deleteTravelModesFile:function(){var d=esriGeowConfig.restBaseUrl+"portals/"+esriGeowConfig.userInfo.accountId+"/removeresource",b=this,a=new e;f.request({url:d,content:{key:this._travelModesFile}},{usePost:!0}).then(function(c){c.success?(b._travelModes=null,b.getTravelModes().then(a.resolve,a.reject)):(b._travelModes=null,a.reject(c))},function(c){b._travelModes=null;a.reject(c)});return a.promise}})});