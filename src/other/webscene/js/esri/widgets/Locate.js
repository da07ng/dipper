// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/widgets/Locate/templates/Locate.html":'\x3cdiv class\x3d"${css.root}" role\x3d"presentation"\x3e\r\n  \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_containerNode" class\x3d"${css.container}"\x3e\r\n    \x3cspan aria-hidden\x3d"true" data-dojo-attach-point\x3d"_iconNode" class\x3d"${css.icon} ${css.locate}"\x3e\x3c/span\x3e\r\n    \x3cspan data-dojo-attach-point\x3d"_textNode" class\x3d"${css.text}"\x3e${_i18n.title}\x3c/span\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("require dojo/_base/lang ./Widget dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./Locate/templates/Locate.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-attr ../config ../core/declare ../geometry/support/webMercatorUtils ../geometry/Point ../geometry/SpatialReference ../Graphic ../layers/GraphicsLayer ../symbols/PictureMarkerSymbol ../tasks/support/ProjectParameters".split(" "),function(m,n,p,q,r,s,f,t,u,d,e,g,v,w,x,y,h,z,A,B){return v([p,r],{declaredClass:"esri.widgets.Locate",
templateString:t,options:{view:null,visible:!0,highlightLocation:!0,symbol:new A(m.toUrl("./images/sdk_gps_location.png"),28,28),popupTemplate:null,scale:null,useTracking:!1,clearOnTrackingStop:!1,setScale:!0,centerAt:!0,timeout:15E3,graphicsLayer:null,geolocationOptions:{maximumAge:0,timeout:15E3,enableHighAccuracy:!0}},constructor:function(a,b){var c=n.mixin({},this.options,a);this.domNode=b;this._i18n=u.widgets.locate;navigator.geolocation||(c.visible=!1,console.log(this.declaredClass+"::navigator.geolocation unsupported."));
this.set(c);this.css={root:"esri-locate",container:"esri-container",visible:"esri-visible",text:"esri-icon-font-fallback-text",icon:"esri-icon",locate:"esri-locate esri-icon-locate",loading:"esri-rotating esri-icon-loading-indicator",tracking:"esriTracking esri-icon-pause"}},postCreate:function(){this.inherited(arguments);this.own(s(this._containerNode,q,this.locate.bind(this)))},startup:function(){this.inherited(arguments);this.view?this.view.then(this._init.bind(this)):console.log(this.declaredClass+
"::view required")},destroy:function(){if(this.graphicsLayer&&this.get("view")){var a=this.view.map;a&&a.remove(this.graphicsLayer)}this._stopWatchingPosition();this.inherited(arguments)},clear:function(){var a=this.get("highlightGraphic"),b=this.get("graphicsLayer");a&&b&&b.remove(a);this.set("highlightGraphic",null)},locate:function(){this.useTracking&&this.set("tracking",!this.tracking);return this._locate()},_setTitle:function(){this.useTracking?this.tracking?(e.set(this._iconNode,"title",this._i18n.stopTracking),
e.set(this._textNode,"textContent",this._i18n.stopTracking)):(e.set(this._iconNode,"title",this._i18n.tracking),e.set(this._textNode,"textContent",this._i18n.tracking)):(e.set(this._iconNode,"title",this._i18n.title),e.set(this._textNode,"textContent",this._i18n.title))},_stopWatchingPosition:function(){this.watchId&&(navigator.geolocation.clearWatch(this.watchId),this.set("watchId",null));this._clearCurrentLocationVars()},_stopTracking:function(){d.remove(this._iconNode,this.css.tracking);d.add(this._iconNode,
this.css.locate);this._stopWatchingPosition();this.clearOnTrackingStop&&this.clear();this._hideLoading()},_startTracking:function(){d.add(this._iconNode,this.css.tracking);d.remove(this._iconNode,this.css.locate);this._stopWatchingPosition();var a=navigator.geolocation.watchPosition(function(a){this._setPosition(a).then(function(a){this._locateEvent(a)}.bind(this),function(a){a||(a=Error(this.declaredClass+"::Error setting the position."));this._locateError(a)}.bind(this))}.bind(this),function(a){a||
(a=Error(this.declaredClass+"::Could not get tracking position."));this._locateError(a)}.bind(this),this.get("geolocationOptions"));this.set("watchId",a)},_clearCurrentLocationVars:function(){this._scale=this._position=this._graphic=null},_getCurrentPosition:function(){var a=new f;this._clearCurrentLocationVars();var b=setTimeout(function(){clearTimeout(b);a.reject(Error(this.declaredClass+"::time expired getting position."))}.bind(this),this.get("timeout"));navigator.geolocation.getCurrentPosition(function(c){clearTimeout(b);
this._setPosition(c).then(function(b){a.resolve(b)}.bind(this),function(b){b||(b=Error(this.declaredClass+"::Error setting position."));a.reject(b)}.bind(this))}.bind(this),function(b){b||(b=Error(this.declaredClass+"::Could not get current position."));a.reject(b)}.bind(this),this.get("geolocationOptions"));return a.promise},_locate:function(){var a=new f;this._showLoading();if(navigator.geolocation)this.useTracking?this.tracking?(this._startTracking(),a.resolve({tracking:!0})):(this._stopTracking(),
a.resolve({tracking:!1})):this._getCurrentPosition().then(function(b){this._locateEvent(b);a.resolve(b)}.bind(this),function(b){b||(b=Error(this.declaredClass+"::Could not get current position."));this._locateError(b);a.reject(b)}.bind(this));else{var b=Error(this.declaredClass+"::geolocation unsupported");this._locateError(b);a.reject(b)}this._setTitle();return a.promise},_projectPoint:function(a){var b=new f,c=this.view.map.spatialReference;c.isWebMercator()?(a=w.geographicToWebMercator(a),b.resolve(a)):
g.geometryService&&4326!==c.wkid?(a=new B({geometries:[a],outSR:c}),g.geometryService.project(a).then(function(a){a&&a.length?b.resolve(a[0]):b.reject(Error(this.declaredClass+"::Point was not projected."))}.bind(this),function(a){a||(a=Error(this.declaredClass+"::please specify a geometry service on esri/config to project."));b.reject(a)})):b.resolve(a);return b.promise},_getScale:function(a){a=a&&a.coords&&a.coords.accuracy;return this.get("scale")||a||5E4},_createPoint:function(a){var b;a&&a.coords&&
(b=new x([a.coords.longitude,a.coords.latitude],new y({wkid:4326})));return b},_animatePoint:function(a,b,c,k){var d=new f;this._graphic=k=this._createGraphic(a,b);var l={graphic:k,scale:c,position:b};b={};this.setScale&&(b.scale=c);this.centerAt?(b.center=a,this.view.animateTo(b).then(function(){d.resolve(l)}.bind(this),function(a){a||(a=Error(this.declaredClass+"::Could not center."));d.reject(a)}.bind(this))):d.resolve(l);return d.promise},_setPosition:function(a){var b=new f,c,d;this._clearCurrentLocationVars();
this._position=a;if(c=this._createPoint(a))this._graphic=d=this._createGraphic(c,a);var e=this._getScale(a);this._scale=e;c?this._projectPoint(c).then(function(c){this._animatePoint(c,a,e,d).then(b.resolve,b.reject)}.bind(this),function(a){a||(a=Error(this.declaredClass+"::Error projecting point."));b.reject(a)}.bind(this)):(c=Error(this.declaredClass+"::Invalid point"),b.reject(c));return b.promise},_createGraphic:function(a,b){var c;a&&(c={position:b},c=new h(a,this.get("symbol"),c,this.get("popupTemplate")));
return c},_locateEvent:function(a){if(a.graphic){var b=h.fromJSON(a.graphic.toJSON()),c=this.get("highlightGraphic"),d=this.get("graphicsLayer");c?c.set({geometry:b.geometry,attributes:b.attributes,popupTemplate:b.popupTemplate,symbol:b.symbol}):(c=b,this.get("highlightLocation")&&d&&d.add(c));this.set("highlightGraphic",c)}this._hideLoading();this.emit("locate",a)},_locateError:function(a){this._hideLoading();this.emit("locate",{graphic:this._graphic,scale:this._scale,position:this._position,error:a})},
_showLoading:function(){this.get("useTracking")||d.add(this._iconNode,this.css.loading)},_hideLoading:function(){this.get("useTracking")||d.remove(this._iconNode,this.css.loading)},_init:function(){this._visible();this._setTitle();var a=this.get("graphicsLayer");if(!a&&(a=new z,this.set("graphicsLayer",a),this.get("view"))){var b=this.view.map;b&&b.add(a)}this.get("tracking")&&this.get("useTracking")&&this._locate();this.set("loaded",!0);this.emit("load")},_visible:function(){d.toggle(this._containerNode,
this.css.visible,this.get("visible"))},_setTrackingAttr:function(a){this._set("tracking",a);this._created&&this._locate()},_setUseTrackingAttr:function(a){this._set("useTracking",a);this._created&&(this.get("tracking")&&!this.get("useTracking")&&this._stopTracking(),this._setTitle())},_setVisibleAttr:function(a){this._set("visible",a);this._created&&this._visible()}})});