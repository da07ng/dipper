// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/SiteHeader",["dijit","dojo","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/layout/BorderContainer,arcgisonline/sharing/util,arcgisonline/sharing/geow/Account,arcgisonline/sharing/geow/Geow,arcgisonline/sharing/geow/Community,arcgisonline/sharing/dijit/Search,arcgisonline/sharing/dijit/TextMenu,arcgisonline/sharing/dijit/dialog/SimpleDlg,dojo/topic,dojo/has"],function(f,a,h){a.provide("arcgisonline.sharing.dijit.SiteHeader");a.require("dijit._Widget");
a.require("dijit._Templated");a.require("dijit.layout.BorderContainer");a.require("arcgisonline.sharing.util");a.require("arcgisonline.sharing.geow.Account");a.require("arcgisonline.sharing.geow.Geow");a.require("arcgisonline.sharing.geow.Community");a.require("arcgisonline.sharing.dijit.Search");a.require("arcgisonline.sharing.dijit.TextMenu");a.require("arcgisonline.sharing.dijit.dialog.SimpleDlg");a.require("dojo.topic");a.require("dojo.has");var g=function(b){var c=a.query(".js-logged-in-navigation"),
d=a.query(".js-logged-in-navigation .dropdown-menu")[0];a.query(".js-logged-in-navigation-button");a:{for(b=(b.target||b.srcElement).parentNode;null!=b;){if(b==d){d=!0;break a}b=b.parentNode}d=!1}d||(c.removeClass("is-active"),c=document.body,d=g,c.removeEventListener?c.removeEventListener("click",d,!1):c.detachEvent&&c.detachEvent("onclick",d))};a.declare("arcgisonline.sharing.dijit.SiteHeader",[f._Widget,f._Templated],{util:arcgisonline.sharing.util,geow:arcgisonline.sharing.geow.Geow,acct:arcgisonline.sharing.geow.Account,
allSSL:!1,isPrivateOrg:!1,isPublicOrg:!1,isLoggedIn:!1,isIndexPage:!1,isSignInPage:!1,isSignUpPage:!1,isJoinPage:!1,isSetupPage:!1,isIEPage:!1,isItemDetailsPage:!1,isNewUserPage:!1,isTroubleshootPage:!1,isGalleryPage:!1,isGroupsPage:!1,isContentPage:!1,isOrgPage:!1,contentMode:null,modeLabelNode:null,webLabel:"",webDescription:"",desktopLabel:"",desktopDescription:"",modeQueryParam:null,prefsName:esriGeowConfig.contentModeCookieName,displayedPortalNonSSLNotice:!1,_tabs:null,_searchWidgetNode:null,
_searchWidget:null,_accountControlsNode:null,_navNode:null,_signInOutLink:null,_organizationLink:null,_profileLink:null,_notificationsLink:null,_myAccountLink:null,_resourceCenterLink:null,_helpMenuNode:null,_modeFilterNode:null,widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent siteHeader top-nav" id\x3d"header" dojoAttachPoint\x3d"containerNode"\x3e\r\n  \x3cdiv class\x3d"grid-container container clearfix"\x3e\r\n\r\n    \x3c!-- Logo --\x3e\r\n    \x3ca id\x3d"site-logo" class\x3d"js-top-nav-link top-nav-title anon pubUser site_logo" href\x3d"../features/"\x3e${!i18n.arcGIS}\x3c/a\x3e\r\n\r\n    \x3c!-- Top Navigation --\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_tabs" class\x3d"top-nav-list"\x3e\r\n      \x3ca id\x3d"siteHeader-home" class\x3d"js-top-nav-link top-nav-link organization first" href\x3d"./index.html"\x3e${i18n.home_link}\x3c/a\x3e\r\n      \x3ca id\x3d"siteHeader-features" class\x3d"js-top-nav-link top-nav-link anon pubUser" href\x3d"../features/features.html"\x3e${i18n.features}\x3c/a\x3e\r\n      \x3ca id\x3d"siteHeader-plans" class\x3d"js-top-nav-link top-nav-link anon pubUser" href\x3d"../features/plans/pricing.html"\x3e${i18n.plans}\x3c/a\x3e\r\n      \x3ca id\x3d"siteHeader-gallery" class\x3d"js-top-nav-link top-nav-link anon pubUser organization orgUser" href\x3d"./gallery.html"\x3e${i18n.gallery}\x3c/a\x3e\r\n      \x3ca id\x3d"siteHeader-map" class\x3d"js-top-nav-link top-nav-link anon pubUser organization orgUser" href\x3d"./webmap/viewer.html?useExisting\x3d1"\x3e${i18n.map}\x3c/a\x3e\r\n      \x3ca id\x3d"sceneViewer" class\x3d"js-top-nav-link top-nav-link" href\x3d"webscene/viewer.html"\x3e${i18n.scene}\x3c/a\x3e\r\n      \x3ca id\x3d"siteHeader-groups" class\x3d"js-top-nav-link top-nav-link pubUser organization orgUser" href\x3d"./groups.html"\x3e${i18n.groups}\x3c/a\x3e\r\n      \x3ca id\x3d"siteHeader-help" class\x3d"js-top-nav-link top-nav-link help anon" href\x3d"./support.html"\x3e${i18n.help}\x3c/a\x3e\r\n      \x3ca id\x3d"siteHeader-myContent" class\x3d"js-top-nav-link top-nav-link pubUser orgUser" href\x3d"./content.html"\x3e${i18n.myContent}\x3c/a\x3e\r\n      \x3ca id\x3d"siteHeader-myOrganization" class\x3d"js-top-nav-link top-nav-link orgUser" href\x3d"./organization.html"\x3e${i18n.myAccount}\x3c/a\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3c!-- Search --\x3e\r\n    \x3cdiv id\x3d"header-search" dojoAttachPoint\x3d"_searchWidgetNode" class\x3d"right column-4 gutter-left-1 gutter-right-0 inline-block top-nav-search"\x3e\x3c/div\x3e\r\n\r\n    \x3c!-- Sign In --\x3e\r\n    \x3cdiv id\x3d"logged-out-navigation" class\x3d"inline-block right gutter-right-2 gutter-left-0 hide"\x3e\r\n      \x3ca id\x3d"login-link" class\x3d"top-nav-link icon-ui-user link-gray" href\x3d"signin.html"\x3e${i18n.signIn}\x3c/a\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3c!-- User Menu --\x3e\r\n    \x3cdiv class\x3d"dropdown js-logged-in-navigation logged-in-navigation right hide" id\x3d"logged-in-navigation"\x3e\r\n      \x3ca href\x3d"#" class\x3d"top-nav-link dropdown-btn top-nav-username text-ellipsis" tabindex\x3d"0" dojoAttachEvent\x3d"onclick:_handleUserDropdown"\x3e\r\n        \x3cimg id\x3d"profileImgSmall" width\x3d"16" height\x3d"16" alt\x3d""\x3e\r\n        \x3cspan id\x3d"username"\x3e\x3c/span\x3e\r\n      \x3c/a\x3e\r\n      \x3cdiv class\x3d"dropdown-menu dropdown-right"\x3e\r\n        \x3ca id\x3d"profileLink" class\x3d"dropdown-link" dojoAttachEvent\x3d"onclick:_handleLinkClick, ontouchstart:_handleLinkClick" href\x3d"./user.html"\x3e\r\n          \x3cimg id\x3d"dropdown-image" width\x3d"32" height\x3d"32" class\x3d"gutter-right-half gutter-left-0 left"\x3e\r\n          ${i18n.myProfile}\x3cbr/\x3e\r\n          \x3cspan dojoAttachPoint\x3d"_userProfileLink" class\x3d"text-ellipsis dropdown-username"\x3e\x3c/span\x3e\r\n        \x3c/a\x3e\r\n        \x3ca class\x3d"dropdown-link dropdown-link-external hide" id\x3d"esri-community" dojoAttachEvent\x3d"onclick:goEsriCommunity, ontouchstart:goEsriCommunity"\x3e\r\n          \x3cspan class\x3d"icon-ui-link-external dropdown-link-external-icon"\x3e\x3c/span\x3e ${i18n.esriCommunity}\r\n        \x3c/a\x3e\r\n        \x3ca class\x3d"dropdown-link dropdown-link-external hide" id\x3d"my-esri" dojoAttachEvent\x3d"onclick:goMyEsri, ontouchstart:goMyEsri"\x3e\r\n          \x3cspan class\x3d"icon-ui-link-external dropdown-link-external-icon"\x3e\x3c/span\x3e ${i18n.myEsri}\r\n        \x3c/a\x3e\r\n        \x3ca class\x3d"dropdown-link hide dropdown-link-external" id\x3d"training" dojoAttachEvent\x3d"onclick:goTraining, ontouchstart:goTraining"\x3e\r\n          \x3cspan class\x3d"icon-ui-link-external dropdown-link-external-icon"\x3e\x3c/span\x3e ${i18n.training}\r\n        \x3c/a\x3e\r\n        \x3ca class\x3d"dropdown-link hide" id\x3d"trial-download" dojoAttachEvent\x3d"onclick:goTrialDownload, ontouchstart:goTrialDownload"\x3e${i18n.trialDownload}\x3c/a\x3e\r\n        \x3ca class\x3d"dropdown-link" target\x3d"_blank" id\x3d"help-link" href\x3d"./support.html"\x3e${i18n.support}\x3c/a\x3e\r\n        \x3ca class\x3d"dropdown-link hide" id\x3d"admin-guide" dojoAttachEvent\x3d"onclick:_handleLinkClick, ontouchstart:_handleLinkClick" href\x3d"./adminguide.html"\x3e${i18n.adminGuide}\x3c/a\x3e\r\n        \x3ca class\x3d"dropdown-link" id\x3d"logout-link" dojoAttachEvent\x3d"onclick:logOut, ontouchstart:logOut"\x3e${i18n.signOut}\x3c/a\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3c!-- Notifications --\x3e\r\n    \x3cdiv id\x3d"header_notifications" class\x3d"header-notifications user organization right gutter-right-1 gutter-left-0 hide"\x3e\r\n      \x3cdiv id\x3d"notifications_box" class\x3d"hide"\x3e\r\n        \x3cspan id\x3d"notifications" class\x3d"label label-red link-white"\x3e0\x3c/span\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
postMixInProperties:function(){this.inherited(arguments);this.geow.checkSharedCookie();this.i18n=a.mixin({},a.i18n.getLocalization("arcgisonline","arcgisonline").common);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").siteHeader);this.webLabel=this.i18n.webOnly;this.webDescription=this.i18n.webDesc;this.desktopLabel=this.i18n.allContent;this.desktopDescription=this.i18n.allDesc},postCreate:function(){var b=window.location.pathname.toLowerCase();this.isIndexPage=-1!==b.indexOf("index.html")||
-1===b.indexOf(".html");this.isSignInPage=-1!==b.indexOf(esriGeowConfig.signin);this.isSignUpPage=-1!==b.indexOf(esriGeowConfig.signup);this.isJoinPage=-1!==b.indexOf(esriGeowConfig.join);this.isSetupPage=-1!==b.indexOf(esriGeowConfig.setup);this.isIEPage=-1!==b.indexOf("ie6.html");this.isItemDetailsPage=-1!==b.indexOf("item.html");this.isNewUserPage=-1!==b.indexOf("newuser.html");this.isTroubleshootPage=-1!==b.indexOf("troubleshoot.html");this.isGalleryPage=-1!==b.indexOf("gallery.html");this.isGroupsPage=
-1!==b.indexOf("groups.html");this.isContentPage=-1!==b.indexOf("content.html");this.isOrgPage=-1!==b.indexOf("organization.html");this._account=arcgisonline.sharing.geow.Account;7>a.isIE&&!this.isIEPage&&(window.location="ie6.html");7<=a.has("trident")&&a.addClass(document.body,"ie11_edge");null!==this._searchWidgetNode&&!this.isIEPage&&(this._searchWidget=(new arcgisonline.sharing.dijit.Search({})).placeAt(this._searchWidgetNode));a.subscribe("onSignOut",a.hitch(this,function(a){arcgisonline.sharing.util&&
(arcgisonline.sharing.util._cookies&&arcgisonline.sharing.util._cookies.esri_auth)&&delete arcgisonline.sharing.util._cookies.esri_auth}));this.updateLinks();a.attr("page-border","onClick","")},_loadFilterMode:function(){var b=a.queryToObject(window.location.search.slice(1)),c=this.util.userPreferences(null,this.prefsName),d="Web";b.content&&"all"===b.content.toLowerCase()?(d="GIS",this.util.userPreferences({contentMode:d},this.prefsName,!0)):b.content&&"web"===b.content.toLowerCase()?this.util.userPreferences({contentMode:d},
this.prefsName,!0):c&&c.contentMode&&(d=c.contentMode);this.contentMode=d},_setActivePage:function(){this.isIndexPage?a.addClass("siteHeader-home","is-active"):this.isGalleryPage?a.addClass("siteHeader-gallery","is-active"):this.isGroupsPage?a.addClass("siteHeader-groups","is-active"):this.isContentPage?a.addClass("siteHeader-myContent","is-active"):this.isOrgPage&&a.addClass("siteHeader-myOrganization","is-active")},_handleModeMenuClick:function(b){a.subscribe("esri/userPreferences"+this.prefsName,
a.hitch(this,function(){var b=window.location.search&&a.queryToObject(window.location.search.slice(1));b&&b.start&&(b.start=null);var d=window.location.href.substring(0,window.location.href.indexOf(window.location.search));window.location.href=d+(b?"?"+a.objectToQuery(b):"")}));"Web"===b?(this.contentMode="Web",this.util.userPreferences({contentMode:this.contentMode},this.prefsName,!0),a.attr(this.modeLabelNode,{innerHTML:this.i18n.show+": "+this.webLabel,alt:this.webDescription,title:this.webDescription})):
(this.contentMode="GIS",this.util.userPreferences({contentMode:this.contentMode},this.prefsName,!0),a.attr(this.modeLabelNode,{innerHTML:this.i18n.show+": "+this.desktopLabel,alt:this.desktopDescription,title:this.desktopDescription}))},startup:function(){this.inherited(arguments);esri.config.defaults.io.corsEnabledServers.push("http://"+location.host);esri.config.defaults.io.corsEnabledServers.push("https://"+location.host);esri.config.defaults.io.proxyUrl=esriGeowConfig.proxyServer;a.query(".js-top-nav-link",
this.domNode).addClass("hide");this._setActivePage();return this._fetchSelf()},_fetchSelf:function(){var b=new a.Deferred;this._account.getSelf(a.hitch(this,function(c){this._finishStartup(c);b.resolve(c);a.topic.publish("OnFetchSelf",c)}),a.hitch(this,function(a){this._finishStartup();throw a;}));return b},_finishStartup:function(b){this.geow.setCookies(b||{});if(b&&!b.code&&!b.message){var c,d;b.httpsPort&&(esriGeowConfig.httpsPort=b.httpsPort,d=esri.config.defaults.io.corsEnabledServers.pop());
b.httpPort&&(esriGeowConfig.httpPort=b.httpPort,c=esri.config.defaults.io.corsEnabledServers.pop());c&&esri.config.defaults.io.corsEnabledServers.push(arcgisonline.sharing.util.getHttpUrl("http://"+location.host).replace(/:80$/,""));d&&esri.config.defaults.io.corsEnabledServers.push(arcgisonline.sharing.util.getSecureUrl("http://"+location.host).replace(/:443$/,""));if(b.authorizedCrossOriginDomains&&0<b.authorizedCrossOriginDomains.length)for(var e=0;e<b.authorizedCrossOriginDomains.length;e++)c=
b.authorizedCrossOriginDomains[e],esri.isDefined(c)&&0<c.length&&esri.config.defaults.io.corsEnabledServers.push({host:c,withCredentials:!0});(this.isLoggedIn=this.util.isLoggedIn())?this.loggedIn():this.loggedOut();this._loadFilterMode();b.isPortal&&(arcgisonline.sharing.util._cookies&&-1===arcgisonline.sharing.util._cookies.esri_auth)&&delete arcgisonline.sharing.util._cookies.esri_auth;c=arcgisonline.sharing.util.getUser();b.culture&&!c&&(b.culture=b.culture.toLowerCase(),a.cookie("arcgisLocale",
b.culture),-1!==b.culture.indexOf("ar")?esriGeowConfig.isRightToLeft=!0:esriGeowConfig.isRightToLeft=!1,console.log("cookie set",a.cookie("arcgisLocale")),a.locale!==b.culture&&window.location.reload());if(c&&(esri.isDefined(c.auth_tier)&&"web"===c.auth_tier)&&(a.style(a.byId("logout-link"),"display","none"),c.username=c.username||c.email,e=a.locale,b.user&&b.user.culture?e=b.user.culture:b.culture&&(e=b.culture),c&&c.culture.toLowerCase()!==e.toLowerCase())){9>a.isIE&&(d=new Date,c.expires=new Date(d.setSeconds(d.getSeconds()+
Number(7200))));if(!c.culture||c.culture&&c.culture.toLowerCase()!==e.toLowerCase())c.culture=e.toLowerCase(),arcgisonline.sharing.geow.Geow.setAuthCookie(c);window.location.reload()}b.allSSL&&(this.allSSL=esriGeowConfig.allSSL=b.allSSL);esri.isDefined(esriGeowConfig.allSSL)&&(esriGeowConfig.allSSL&&"http:"===location.protocol)&&(window.location=arcgisonline.sharing.util.getSecureUrl(location.href));b.helpBase&&(esriGeowConfig.help=b.helpBase,esriGeowConfig.helpBase=b.helpBase,e=esriGeowConfig.self&&
esriGeowConfig.self.helpBase||"support.html",this.util.isPortal()&&(e=location.protocol+"//"+b.portalHostname.split("/")[0]+b.helpBase),a.attr(a.byId("siteHeader-help"),"href",e),a.attr(a.byId("help-link"),"href",e));b.helpMap&&b.helpMap.m&&(esriGeowConfig.helpMap=b.helpMap.m);b.portalHostname&&(esriGeowConfig.portalHostname=b.portalHostname);b.urlKey&&(esriGeowConfig.urlKey=b.urlKey);b.staticImagesUrl&&(esriGeowConfig.staticImagesUrl=b.staticImagesUrl);b.id&&b.access&&(e=esriGeowConfig.baseUrl,"private"===
b.access?(this.isPrivateOrg=!0,e=arcgisonline.sharing.util.getSecureUrl()+esriGeowConfig.signin,a.create("a",{innerHTML:this.i18n.signOut,href:e,onclick:a.hitch(this,this.logOut)},this._signInOutLink,"only")):"public"===b.access&&this.isLoggedIn&&(this.isPublicOrg=!0,e+="index.html",e=this.allSSL||arcgisonline.sharing.util.usePortalSSL()?arcgisonline.sharing.util.getSecureUrl(e):arcgisonline.sharing.util.getHttpUrl(e),a.create("a",{innerHTML:this.i18n.signOut,href:e,onclick:a.hitch(this,this.logOut)},
this._signInOutLink,"only")));e=!1===esriGeowConfig.isMultiTenant;if(!e&&(d=window.location.host,d!==b.portalHostname&&(-1!==d.indexOf(b.customBaseUrl)&&!b.access&&!b.name)&&(window.location=window.location.href.replace(d,b.portalHostname)),c&&("account_admin"===c.role||"org_admin"===c.role)&&b.id&&!b.urlKey&&!this.isSetupPage))window.location=esriGeowConfig.baseUrl+"setup.html";e?(b.access&&("private"===b.access&&!this.isLoggedIn)&&(!this.isSignInPage&&!this.isTroubleshootPage&&!this.isJoinPage&&
!this.isSignUpPage)&&(window.location=arcgisonline.sharing.util.getSecureUrl()+esriGeowConfig.signin+"?returnUrl\x3d"+encodeURIComponent(window.location)),this.switchHeaderGraphic(),b.isPortal&&"singletenant"===b.portalMode&&(arcgisonline.sharing.util.getUser()||a.cookie("esri_auth_guest")&&"7443"!==location.port&&a.addClass(a.byId("logged-out-navigation"),"hide"),("7080"===location.port||"7443"===location.port)&&arcgisonline.sharing.util.checkForIAA().then(a.hitch(this,function(c){if(c&&c.hasIAA&&
(b.portalHostname.match(/:7080\//)&&("http:"===location.protocol&&-1===location.href.indexOf("error.html"))&&(window.location=arcgisonline.sharing.util.getHttpUrl(esriGeowConfig.baseUrl)+"error.html?c\x3dWebAdaptorRequired"),!b.portalHostname.match(/:7080\//)&&80!==esriGeowConfig.httpPort&&443!==esriGeowConfig.httpsPort&&"http:"===location.protocol&&-1===location.href.indexOf("error.html"))){c=new a._Url(location.href);var d=c.path.indexOf("/home/"),d=c.path.substring(d+6);c=esri.isDefined(c.query)?
"?"+c.query:"";window.location=arcgisonline.sharing.util.getHttpUrl("http://"+b.portalHostname)+"/home/"+d+c}})))):!b.id&&b.urlKey&&!this.isLoggedIn?!this.isSignInPage&&!this.isTroubleshootPage&&!this.isJoinPage?window.location=esriGeowConfig.baseUrl.replace("http:","https:")+esriGeowConfig.signin+"?returnUrl\x3d"+encodeURIComponent(window.location):this.switchHeaderGraphic():b.id&&(b.urlKey&&!this.isLoggedIn)&&this.switchHeaderGraphic()}c=esriGeowConfig.baseUrl;if(this.isSignInPage){if(esriGeowConfig.urlKey&&
window.location.hostname!==esriGeowConfig.portalHostname){if(a.query("#signInForm #left").style("display","none"),a.query("#signInForm #leftAgo").style("display","none"),a.query("#signInForm #rightAgo").addClass("rightAgoSolo"),(e=a.query("#signInForm #right"))&&0<e.length)e=e[0],a.removeClass(e,"esriFloatTrailing"),a.addClass(e,"esriFloatLeading"),esriGeowConfig.isRightToLeft?a.style(e,"paddingRight","30%"):a.style(e,"paddingLeft","30%")}else e||(e=a.create("a",{href:a.attr("site-logo","href")}),
a.attr("site-logo","href",e.href.replace("https:","http:")));document.referrer&&-1<document.referrer.indexOf("http://")&&(c=c.replace("https:","http:"))}!this.util.isPortal()&&this.isSetupPage&&(a.query('a[page\x3d"user.html"]').forEach(a.hitch(this,function(b){a.addClass(b,"disabled")})),a.addClass(a.byId("header"),"setupWorkflow"));!this.util.isPortal()&&this.isSignInPage&&a.addClass(a.byId("header"),"hideSignInButton");!this.util.isPortal()&&this.isLoggedIn&&a.attr(a.byId("site-logo"),"href","index.html");
this.util.isPortal()&&(a.byId("siteHeader-features")&&a.style(a.byId("siteHeader-features"),"display","none"),a.byId("siteHeader-plan")&&a.style(a.byId("siteHeader-plan"),"display","none"),a.attr(a.byId("site-logo"),"innerHTML",this.i18n.home_link),a.attr(a.byId("site-logo"),"href","index.html"));c=this.util.getUser();esriGeowConfig.restrictOrganizationPageToAdmin&&(c&&c.accountId&&c.role&&"account_admin"!==c.role)&&a.style(a.byId("siteHeader-myOrganization"),"display","none");esriGeowConfig.userRole&&
(esriGeowConfig.userRole.isCustom()&&!esriGeowConfig.userRole.canCreateItem())&&a.style(a.byId("siteHeader-myContent"),"display","none");a.byId("esri-community-img-icon")||a.create("img",{id:"esri-community-img-icon",src:this.util.relativeToExplicitUrl("js/arcgisonline/css/images/LinkToOtherApp16.png")},a.byId("esri-community-img"));a.byId("my-esri-img-icon")||a.create("img",{id:"my-esri-img-icon",src:this.util.relativeToExplicitUrl("js/arcgisonline/css/images/LinkToOtherApp16.png")},a.byId("my-esri-img"));
!this.util.isPortal()&&(c&&"both"===c.userType)&&(a.removeClass(a.byId("esri-community"),"hide"),a.removeClass(a.byId("my-esri"),"hide"));this.util.isPortal()||(a.removeClass(a.byId("training"),"hide"),a.byId("training-img-icon")||a.create("img",{id:"training-img-icon",src:this.util.relativeToExplicitUrl("js/arcgisonline/css/images/LinkToOtherApp16.png")},a.byId("training-img")));!this.util.isPortal()&&(esriGeowConfig.self&&esriGeowConfig.self.subscriptionInfo&&("Trial"===esriGeowConfig.self.subscriptionInfo.type||
"Trial Press"===esriGeowConfig.self.subscriptionInfo.type))&&a.removeClass(a.byId("trial-download"),"hide")},updateEsriAccessLinks:function(b){!this.util.isPortal()&&b&&"both"===b?(a.removeClass(a.byId("esri-community"),"hide"),a.removeClass(a.byId("my-esri"),"hide")):(a.addClass(a.byId("esri-community"),"hide"),a.addClass(a.byId("my-esri"),"hide"))},handleItemEnter:function(b){a.hasClass(b.currentTarget.id,"selected")||a.addClass(b.currentTarget.id,"hover")},handleItemLeave:function(b){a.hasClass(b.currentTarget.id,
"selected")||a.removeClass(b.currentTarget.id,"hover")},openPage:function(a){document.location=a},openPageNewWindow:function(a){window.open(a,"_blank")},updateLinks:function(){},adjustNavBar:function(){var b=this.util.getUser();a.query(".js-top-nav-link",this.domNode).addClass("hide").on("click",a.hitch(this,"_handleLinkClick"));esriGeowConfig.sceneViewerEnabled&&a.query("#sceneViewer",this.domNode).removeClass("hide");esriGeowConfig.self&&esriGeowConfig.self.urlKey||this.util.isPortal()?(a.query(".organization",
this.domNode).removeClass("hide"),b&&(a.query(".orgUser",this.domNode).removeClass("hide"),a.query(".help",this.domNode).addClass("hide"),a.attr(a.byId("site-logo"),"href","index.html"))):(a.query(".anon",this.domNode).removeClass("hide"),b&&(a.query(".pubUser",this.domNode).removeClass("hide"),a.query(".help",this.domNode).addClass("hide")));9>a.has("ie")&&a.query(".helpNav",this.domNode).style({display:"none"})},loggedOut:function(){var b="";a.removeClass(a.byId("logged-out-navigation"),"hide");
a.addClass(a.byId("logged-in-navigation"),"hide");this.adjustNavBar();if(-1===esriGeowConfig.signin.indexOf("http")&&(b=esriGeowConfig.baseUrl,this.allSSL||!1!==esriGeowConfig.useSSL))if(b=b.replace("http:","https:"),!1===esriGeowConfig.isMultiTenant||esriGeowConfig.self&&esriGeowConfig.self.portalMode&&"singletenant"===esriGeowConfig.self.portalMode)b=arcgisonline.sharing.util.getSecureUrl();if(this.isNewUserPage)a.create("span",{style:{color:"#BBBBBB",marginLeft:"18px"},innerHTML:this.i18n.signIn},
this._signInOutLink,"only");else{var c=a.create("a",{href:"#",innerHTML:this.i18n.signIn},this._signInOutLink,"only");this.isItemDetailsPage?a.attr(c,"href",b+esriGeowConfig.signin+"?returnUrl\x3d"+document.location.href):a.attr(c,"href",b+esriGeowConfig.signin+"?")}a.query(".menu-logged-in",this.domNode).addClass("hide");arcgisonline.sharing.util.isPortal()||a.attr(a.byId("login-link"),"href",esriGeowConfig.baseUrl+esriGeowConfig.signin)},loggedIn:function(){var b=this.util.getUser();if(null===b)this.loggedOut();
else{var c=this.util.getUserDisplayName(b);a.attr(a.byId("username"),"innerHTML",c);a.attr(a.byId("username"),"title",b.fullName);a.attr(this._userProfileLink,"innerHTML",b.username);a.attr("profileLink","title",b.fullName);a.addClass(a.byId("logged-out-navigation"),"hide");a.removeClass(a.byId("logged-in-navigation"),"hide");this.util.isPortal()&&"account_admin"===b.role?a.removeClass(a.byId("admin-guide"),"hide"):a.addClass(a.byId("admin-guide"),"hide");c=this.allSSL||arcgisonline.sharing.util.usePortalSSL()?
arcgisonline.sharing.util.getSecureUrl(esriGeowConfig.restBaseUrl):esriGeowConfig.restBaseUrl;c=esriGeowConfig.userInfo.thumbnail?c+"community/users/"+esriGeowConfig.userInfo.username+"/info/"+esriGeowConfig.userInfo.thumbnail+"?token\x3d"+esriGeowConfig.userInfo.token:this.util.relativeToExplicitUrl("js/arcgisonline/css/images/no-user-thumb.jpg");a.attr("dropdown-image","src",c);a.attr("profileImgSmall","src",c);b.accountId&&null!==b.accountId&&(void 0===esriGeowConfig.isMultiTenant||!0===esriGeowConfig.isMultiTenant)&&
!esriGeowConfig.portalName&&this.switchHeaderGraphic();this.adjustNavBar();a.subscribe("onNotificationCount",this,"notificationCountHandler");arcgisonline.sharing.geow.Community.getNotificationsCount()}},logOut:function(){a.cookie("esri_webmap","",{expires:-1,path:"/"});var b=arcgisonline.sharing.util.getHttpUrl()+"index.html";this.isPrivateOrg&&(b=arcgisonline.sharing.util.getSecureUrl()+esriGeowConfig.signin);this.isPublicOrg&&(b=(this.allSSL||arcgisonline.sharing.util.usePortalSSL()?arcgisonline.sharing.util.getSecureUrl():
arcgisonline.sharing.util.getHttpUrl())+"index.html");this.geow.signout(b)},notificationCountHandler:function(b){var c=0;0<b&&(c=b);a.create("a",{title:this.i18n.notifications,innerHTML:c,href:"#",onclick:a.hitch(this,arcgisonline.sharing.geow.Community.getNotifications)},a.byId("notifications"),"only");0===b?a.addClass(a.byId("notifications_box"),"hide"):1<=b&&a.removeClass(a.byId("notifications_box"),"hide")},switchHeaderGraphic:function(){var b=a.query(".siteHeader div.mainSearch"),c=a.query(".siteHeader ul.mainTabs li a"),
d,e=a.baseUrl.substring(0,a.baseUrl.indexOf("/js"));for(d=0;d<b.length;d++)a.style(b[d],{background:esriGeowConfig.isRightToLeft?"url('"+e+"/js/arcgisojs/arcgisonlineanization-global-nav-rtl-"+(-1!==a.locale.indexOf("-")?a.locale.split("-")[0]:a.locale)+".png') no-repeat scroll 0 0 transparent":"url('"+e+"/js/arcgisonlinejs/arcgisonlinetion-global-nav"+("en"!==a.locale.split("-")[0]?"-"+a.locale:"")+".png') no-repeat 100% 0"}),a.addClass(b[d],"esriOrg");for(d=0;d<c.length;d++)a.style(c[d],{backgroundImage:esriGeowConfig.isRightToLeft?
"url('"+e+"/js/arcgisonline/css/js/arcgisonlineglobal-nav-rtl-"+(-1!==a.locale.indexOf("-")?a.locale.split("-")[0]:a.locale)+".png')":"url('"+e+"/js/arcgisonline/css/images/organization-global-nav"+("en"!==a.locale.split("-")[0]?"-"+a.locale:"")+".png')"}),a.addClass(c[d],"esriOrg")},goEsriCommunity:function(a){a.preventDefault();this.openPageNewWindow(esriGeowConfig.esriCommunityLink)},goMyEsri:function(a){a.preventDefault();this.openPageNewWindow(esriGeowConfig.myEsriLink)},goTraining:function(a){a.preventDefault();
a={administrator:"//www.esri.com/training/main/arcgis-online-administrators",publisher:"//www.esri.com/training/main/arcgis-online-publishers",user:"//www.esri.com/training/main/arcgis-online-users","public":"//www.esri.com/training/main/arcgis-online-training",custom:"//www.esri.com/training/main/arcgis-online-training"};var c=esriGeowConfig.userRole,d;c?c.isAdmin()||c.isBasedOnAdmin()?d=a.administrator:c.isPublisher()||c.isBasedOnPublisher()?d=a.publisher:c.isUser()||c.isBasedOnUser()?d=a.user:
c.isCustom()&&(d=a.custom):d=a["public"];this.openPageNewWindow(d)},goTrialDownload:function(a){a.preventDefault();a=(esriGeowConfig.self&&esriGeowConfig.self.user&&esriGeowConfig.self.user.culture||esriGeowConfig.self&&esriGeowConfig.self.culture||dojoConfig.locale||"en").toLowerCase();a=esriGeowConfig.learnArcGIS+"/"+(a in{"pt-br":1,"pt-pt":1,"zh-cn":1,"zh-hk":1,"zh-tw":1}?a:a.split("-")[0].toLowerCase())+"/trial";this.openPageNewWindow(a)},_handleLinkClick:function(b){if(b.currentTarget&&a.attr(b.currentTarget,
"href")){b.preventDefault();var c=a.attr(b.currentTarget,"href"),d=arcgisonline.sharing.util.usePortalSSL(),d=this.allSSL||d?arcgisonline.sharing.util.getSecureUrl():arcgisonline.sharing.util.getHttpUrl(),e=esriGeowConfig.self&&esriGeowConfig.self.helpBase||"support.html";arcgisonline.sharing.util.isPortal()?-1<c.indexOf("/support.html")?(b.preventDefault(),this.openPageNewWindow(e)):-1<c.indexOf("/adminguide.html")?(b.preventDefault(),arcgisonline.sharing.util.openPage(e.replace("/website/","/admin/"))):
("7443"===location.port&&(d=arcgisonline.sharing.util.getSecureUrl()),arcgisonline.sharing.util.openPage(d+c,!0)):(b="support.html"===c?e:c&&-1===c.indexOf("http")?d+c:c,arcgisonline.sharing.util.openPage(b,!0))}return!1},_handleUserDropdown:function(b){var c=a.query(".js-logged-in-navigation",this.domNode);a.hasClass(c[0],"is-active")||(c.addClass("is-active"),a.stopEvent(b),b=document.body,c=g,b.addEventListener?b.addEventListener("click",c,!1):b.attachEvent&&b.attachEvent("onclick",c))}})});