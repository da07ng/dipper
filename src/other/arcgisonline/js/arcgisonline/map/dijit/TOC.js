// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/map/dijit/TOC",["dijit","dojo","dojox","dojo/i18n!esri/nls/jsapi","dojo/require!dijit/form/CheckBox,dijit/_Widget,dijit/_Templated,dijit/Menu,dijit/TooltipDialog,arcgisonline/map/dijit/toc/analysis,arcgisonline/map/dijit/toc/dnd,arcgisonline/map/dijit/toc/filterEdits,arcgisonline/map/dijit/toc/html,arcgisonline/map/dijit/toc/image,arcgisonline/map/dijit/toc/legend,arcgisonline/map/dijit/toc/options,arcgisonline/map/dijit/toc/scale,arcgisonline/sharing/dijit/dialog/RenameDlg,arcgisonline/sharing/dijit/dialog/AddItemFromLayerDlg,esri/symbols/jsonUtils,dojo/topic,dojo/aspect,dojo/promise/all,dojo/has,esri/layers/FeatureLayer,esri/dijit/VisibleScaleRangeSlider"],
function(f,a,O){a.provide("arcgisonline.map.dijit.TOC");a.require("dijit.form.CheckBox");a.require("dijit._Widget");a.require("dijit._Templated");a.require("dijit.Menu");a.require("dijit.TooltipDialog");a.require("arcgisonline.map.dijit.toc.analysis");a.require("arcgisonline.map.dijit.toc.dnd");a.require("arcgisonline.map.dijit.toc.filterEdits");a.require("arcgisonline.map.dijit.toc.html");a.require("arcgisonline.map.dijit.toc.image");a.require("arcgisonline.map.dijit.toc.legend");a.require("arcgisonline.map.dijit.toc.options");
a.require("arcgisonline.map.dijit.toc.scale");a.require("arcgisonline.sharing.dijit.dialog.RenameDlg");a.require("arcgisonline.sharing.dijit.dialog.AddItemFromLayerDlg");a.require("esri.symbols.jsonUtils");a.require("dojo.topic");a.require("dojo.aspect");a.require("dojo.promise.all");a.require("dojo.has");a.require("esri.layers.FeatureLayer");a.require("esri.dijit.VisibleScaleRangeSlider");a.requireLocalization("esri","jsapi");a.declare("arcgisonline.map.dijit.TOC",[f._Widget,f._Templated],{widgetsInTemplate:!0,
templateString:'\x3cdiv dojoType\x3d"dijit.layout.BorderContainer" region\x3d"top"\x3e\r\n  \x3cdiv id\x3d"tocContentHeader" class\x3d"panel panel_left" dojoType\x3d"dijit.layout.ContentPane" region\x3d"top"\x3e\r\n    \x3cdiv id\x3d"tocContentButtons" class\x3d"viewerPanelButtons"\x3e\r\n      \x3cdiv class\x3d"esriFloatLeading"\x3e\r\n        \x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" id\x3d"webmap-details-content-about" iconclass\x3d"esriDetailsAboutIcon" title\x3d"${i18n.about}"\x3e\x3c/button\x3e\r\n        \x3cbutton dojotype\x3d"dijit.form.ToggleButton" id\x3d"webmap-details-content" iconclass\x3d"esriDetailsContentsIcon" title\x3d"${i18n.showContents}"\x3e\x3c/button\x3e\r\n        \x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" id\x3d"webmap-details-content-legend" iconclass\x3d"esriDetailsLegendIcon" title\x3d"${i18n.showLegend}"\x3e\x3c/button\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"esriFloatTrailing" style\x3d"display:inline; padding-top:5px;"\x3e\r\n        \x3ca href\x3d"JavaScript:void(0);" dojoAttachPoint\x3d"_closeBtn" title\x3d"${i18n.close}" class\x3d"panel panel_close panel_collapse"\x3e\x3cimg src\x3d"images/close.gif" border\x3d"0"/\x3e\x3c/a\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\x3c!-- style\x3d"border-bottom: #333 thin solid;"--\x3e\r\n    \x3cdiv id\x3d"tocContentTitle" class\x3d"panelSubHeader panel_title panel_subtitle"\x3e\r\n      ${i18n.tocPanelTitle}\r\n    \x3c/div\x3e\r\n        \r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"tocContentPane" dojoType\x3d"dijit.layout.ContentPane" region\x3d"center" style\x3d"overflow-x:hidden;overflow-y:auto;position:relative;" class\x3d"scrollPane"\x3e\r\n    \x3cdiv id\x3d"toc-main" dojoType\x3d"dojo.dnd.Source" dojoAttachPoint\x3d"_dndSourceNode" skipForm\x3d"true"\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr/\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_statusDiv"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"tocContentFooter" dojoType\x3d"dijit.layout.ContentPane" region\x3d"bottom" style\x3d"height:40px; padding: 0 5px 0 5px; display:none;"\x3e\r\n    \x3cdiv class\x3d"footer" id\x3d"contentSiteFooter" dojotype\x3d"arcgisonline.sharing.dijit.SiteFooterMap" style\x3d"white-space:normal;"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"layerMenu" dojoType\x3d"dijit.Menu" refocus\x3d"false" style\x3d"display: none;"\x3e\r\n    \x3cdiv id\x3d"layerMenu.zoomTo" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconZoomTo"\x3e\r\n      ${i18n.zoomTo}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.layerTransp" dojoType\x3d"dijit.PopupMenuItem" iconclass\x3d"iconOpacity"\x3e\r\n      \x3cspan\x3e${i18n.transparency}\x3c/span\x3e\r\n      \x3cdiv id\x3d"layerMenu.layerTransparencyDlg" dojoType\x3d"dijit.TooltipDialog" title\x3d"${i18n.transparency}"\x3e\r\n        \x3cspan class\x3d"esriLeadingMargin05"\x3e${i18n.layerTransparency}\x3c/span\x3e\r\n        \x3cdiv id\x3d"layerMenu.opacitySlider" class\x3d"transparencySlider" dojoType\x3d"dijit.form.HorizontalSlider" style\x3d"width: 200px;margin: 6px 15px 3px 15px;" showbuttons\x3d"true" value\x3d"0" minimum\x3d"0" maximum\x3d"100" discretevalues\x3d"101" intermediatechanges\x3d"true"\x3e\r\n          \x3cdiv dojoType\x3d"dijit.form.HorizontalRuleLabels" container\x3d"topDecoration" labels\x3d"${i18n.opaque},${i18n.transparent}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv dojoType\x3d"dijit.form.HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\r\n          \x3c/div\x3e\r\n          \x3col dojoType\x3d"dijit.form.HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"height: 1em; font-size: 0.75em; color: darkblue;"\x3e\r\n            \x3cli\x3e\r\n              ${i18n.zeroPercent}\r\n            \x3c/li\x3e\r\n            \x3cli\x3e\r\n              ${i18n.fiftyPercent}\r\n            \x3c/li\x3e\r\n            \x3cli\x3e\r\n              ${i18n.oneHundredPercent}\r\n            \x3c/li\x3e\r\n          \x3c/ol\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.scale" dojoType\x3d"dijit.PopupMenuItem" iconclass\x3d"iconScale"\x3e\r\n      \x3cspan\x3e${i18n.setVisibilityRange}\x3c/span\x3e\r\n      \x3cdiv id\x3d"layerMenu.layerScaleDlg" dojoType\x3d"dijit.TooltipDialog" title\x3d"${i18n.rendererCommon.visibleRangeTooltip}"\x3e\r\n        \x3cspan class\x3d"esriLeadingMargin05"\x3e${i18n.rendererCommon.visibleRange}\x3c/span\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"tocLayerScaleSuggest" data-dojo-attach-event\x3d"onClick:onClickTocScaleSuggest" class\x3d"esriFloatTrailing suggestLabel"\x3e\r\n          \x26nbsp;${i18n.rendererCommon.suggest}\x26nbsp;\r\n        \x3c/div\x3e\r\n        \x3cdiv style\x3d"clear:both;padding: 10px; width:300px;"\x3e\r\n          \x3cdiv id\x3d"tocLayerScaleSlider"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriLeadingMargin05" id\x3d"layerMenu.scaleCurrent"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.moveSeparator" dojoType\x3d"dijit.MenuSeparator"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.moveUp" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconMoveUp"\x3e\r\n      ${i18n.moveUp}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.moveDown" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconMoveDown"\x3e\r\n      ${i18n.moveDown}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.rename" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconRename"\x3e\r\n      ${i18n.rename}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.remove" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconRemove"\x3e\r\n      ${i18n.remove}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.copy" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconCopy"\x3e\r\n      ${i18n.copy}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.enableShowLegend" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconEnableShowLegend"\x3e\r\n      ${i18n.enableShowLegend}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.disableShowLegend" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconDisableShowLegend"\x3e\r\n      ${i18n.disableShowLegend}\r\n    \x3c/div\x3e\r\n    \x3c!--\x3cdiv id\x3d"layerMenu.legendSeparator" dojoType\x3d"dijit.MenuSeparator"\x3e\r\n    \x3c/div\x3e--\x3e\r\n    \x3cdiv id\x3d"layerMenu.filterSeparator" dojoType\x3d"dijit.MenuSeparator"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.filterEdits" dojoType\x3d"dijit.PopupMenuItem" iconclass\x3d"iconFilterEdits"\x3e\r\n      \x3cspan\x3e${i18n.filterEdits}\x3c/span\x3e\r\n      \x3cdiv id\x3d"layerMenu.filterEditsDlg" dojoType\x3d"dijit.TooltipDialog"\x3e\r\n\t\t\t  \x3ctable\x3e\r\n\t\t\t  \t\x3ctbody\x3e\r\n\t\t\t  \t\t\x3ctr\x3e\r\n\t\t\t  \t\t\t\x3ctd nowrap\x3e\r\n\t\t\t\t      \t\x3cspan id\x3d"layerMenu.filterEditsText1"\x3e\x3c/span\x3e\r\n\t\t\t\t        \x3cselect id\x3d"layerMenu.filterEditsUserOptions" dojoType\x3d"dijit.form.FilteringSelect" style\x3d"width:100px;"\x3e\r\n\t\t\t\t        \x3c/select\x3e\r\n\t\t\t\t        \x3cspan id\x3d"layerMenu.filterEditsText2"\x3e\x3c/span\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\x3cdiv id\x3d"layerMenu.filterEditsTimeOptionsDiv" style\x3d"display:none;"\x3e\r\n\t\t\t\t\t        \x3cselect id\x3d"layerMenu.filterEditsTimeOptions" dojoType\x3d"dijit.form.FilteringSelect" style\x3d"width:100px;"\x3e\r\n\t\t\t\t\t        \x3c/select\x3e\r\n\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.showAllEdits" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconShowAllEdits"\x3e\r\n      ${i18n.showAllEdits}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.editsSeparator"  dojoType\x3d"dijit.MenuSeparator"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.enablePopup" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconEnablePopup"\x3e\r\n      ${i18n.enablePopup}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.removePopup" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconRemovePopup"\x3e\r\n      ${i18n.removePopup}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.configPopup" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconConfigurePopup"\x3e\r\n      ${i18n.configurePopup}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.editRenderer" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconEditRenderer"\x3e\r\n      ${i18n.changeSymbols}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.smartMappingRenderer" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconEditRenderer"\x3e\r\n      ${i18n.changeStyle}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.editLabels" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconEditLabels"\x3e\r\n      ${i18n.createLabels}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.editRenderingRule" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconEditRenderer"\x3e\r\n      \x3cspan\x3e${i18n.changeImageDisplay}\x3c/span\x3e  \r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.editMosaicRule" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconImageOrder"\x3e\r\n      \x3cspan\x3e${i18n.changeImageDisplayOrder}\x3c/span\x3e     \r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.editImageProperties" dojoType\x3d"dijit.PopupMenuItem" iconclass\x3d"iconImageQuality"\x3e\r\n      \x3cspan\x3e${i18n.setImageQuality}\x3c/span\x3e\r\n      \x3cdiv id\x3d"layerMenu.editImagePropertiesDlg" dojoType\x3d"dijit.TooltipDialog"\x3e\r\n        \x3cdiv\x3e\r\n          \x3cdiv id\x3d"layerMenu.performanceQualitySlider" class\x3d"performanceQualitySlider" dojoType\x3d"dijit.form.HorizontalSlider" style\x3d"width: 200px;margin: 3px 25px 3px 25px;" showbuttons\x3d"true" value\x3d"80" minimum\x3d"0" maximum\x3d"100" discretevalues\x3d"3" intermediatechanges\x3d"false"\x3e\r\n            \x3cdiv dojoType\x3d"dijit.form.HorizontalRuleLabels" container\x3d"topDecoration" labels\x3d"${i18n.imagePerformance}, ${i18n.imageQuality}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n            \x3c/div\x3e        \r\n            \x3cdiv dojoType\x3d"dijit.form.HorizontalRule" container\x3d"bottomDecoration" count\x3d"3" style\x3d"height: 5px;"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e \r\n        \x3c/div\x3e\r\n      \x3c/div\x3e      \r\n    \x3c/div\x3e    \r\n    \x3cdiv id\x3d"layerMenu.enableEditing" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconEnableEditing"\x3e\r\n      ${i18n.enableEditing}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.disableEditing" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconDisableEditing"\x3e\r\n      ${i18n.disableEditing}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.popupSeparator" dojoType\x3d"dijit.MenuSeparator"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.performAnalysis" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconPerformAnalysis"\x3e\r\n      ${i18n.performAnalysis}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.performAnalysisPopup" dojoType\x3d"dijit.PopupMenuItem" iconclass\x3d"iconPerformAnalysis"\x3e\r\n      \x3cspan\x3e${i18n.performAnalysis}\x3c/span\x3e\r\n      \x3cdiv id\x3d"layerMenu.performAnalysisDlg" dojoType\x3d"dijit.Menu"\x3e\r\n        \x3cdiv dojoType\x3d"dijit.MenuItem" dojoAttachPoint\x3d"_lyrpointMenu"  style\x3d"display:none"\x3e\r\n          ${i18n.points}\r\n        \x3c/div\x3e\r\n        \x3cdiv dojoType\x3d"dijit.MenuItem" dojoAttachPoint\x3d"_lyrlineMenu" style\x3d"display:none"\x3e\r\n          ${i18n.lines}\r\n        \x3c/div\x3e\r\n        \x3cdiv dojoType\x3d"dijit.MenuItem" dojoAttachPoint\x3d"_lyrareaMenu" style\x3d"display:none" \x3e\r\n          ${i18n.areas}\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e      \r\n    \x3c/div\x3e           \r\n    \x3cdiv id\x3d"layerMenu.reviewGeocode" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconReviewGeocode"\x3e\r\n      ${i18n.reviewGeocode}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.streaming" dojoType\x3d"dijit.PopupMenuItem" iconclass\x3d"iconStreaming"\x3e\r\n      \x3cspan\x3e${i18n.streamingControls}\x3c/span\x3e\r\n      \x3cdiv id\x3d"layerMenu.streamingDlg" dojoType\x3d"dijit.TooltipDialog"\x3e\r\n        \x3cdiv\x3e\r\n          \x3ctable\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd nowrap\x3e\r\n                  \x3cspan class\x3d"esriItemLinks" style\x3d"white-space:nowrap;"\x3e\x3cA id\x3d"layerMenu.startStopStream" href\x3d"JavaScript:void(0);"\x3e${i18n.stopStreaming}\x3c/A\x3e\x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd\x3e\r\n                  \x3cspan class\x3d"esriItemLinks" id\x3d"layerMenu.spatialFilterStreamEnabled" style\x3d"white-space:nowrap;"\x3e\x3cA id\x3d"layerMenu.spatialFilterStream" href\x3d"JavaScript:void(0);"\x3e${i18n.limitObservations}\x3c/A\x3e\x3c/span\x3e\r\n                  \x3cspan class\x3d"esriItemLinks" id\x3d"layerMenu.spatialFilterStreamDisabled" style\x3d"white-space:nowrap;"\x3e${i18n.limitObservations}\x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd\x3e\r\n                  \x3cspan class\x3d"esriItemLinks" id\x3d"layerMenu.clearStreamDivEnabled" style\x3d"white-space:nowrap;"\x3e\x3cA id\x3d"layerMenu.clearStream" href\x3d"JavaScript:void(0);"\x3e${i18n.clearObservations}\x3c/A\x3e\x3c/span\x3e\r\n                  \x3cspan class\x3d"esriItemLinks" id\x3d"layerMenu.clearStreamDivDisabled" style\x3d"white-space:nowrap;"\x3e${i18n.clearObservations}\x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.analysisSeparator" dojoType\x3d"dijit.MenuSeparator"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.showAttrTable" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconShowAttributeTable"\x3e\r\n      ${i18n.showTable}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.hideAttrTable" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconHideAttributeTable"\x3e\r\n      ${i18n.hideTable}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.filter" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconFilter"\x3e\r\n      ${i18n.filter}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.multidimensionalFilter" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconMultidimensionalFilter"\x3e\r\n      ${i18n.multidimensionalFilter}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.refreshInterval" dojoType\x3d"dijit.PopupMenuItem" iconclass\x3d"iconRefreshInterval"\x3e\r\n      \x3cspan\x3e${i18n.refreshInterval}\x3c/span\x3e\r\n       \x3cdiv id\x3d"layerMenu.refreshIntervalDlg" dojoType\x3d"dijit.TooltipDialog"\x3e\r\n        \x3ctable cellspacing\x3d"5"\x3e\r\n          \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd nowrap\x3e\r\n                \x3cdiv dojoAttachPoint\x3d"layerMenuRefreshIntervalEnabled" dojoType\x3d"dijit.form.CheckBox" type\x3d"checkbox" checked\x3d"false"\x3e\x3c/div\x3e\r\n                \x3cspan id\x3d"layerMenu.refreshIntervalText1"\x3e\x3c/span\x3e\r\n                \x3cdiv dojoAttachPoint\x3d"layerMenuRefreshIntervalMinutes" dojotype\x3d"dijit.form.NumberTextBox" constraints\x3d\'{min:0,max:1440,pattern:"#0.#"}\' intermediateChanges\x3d"true" style\x3d"width:50px; padding:2px;"\x3e\x3c/div\x3e\r\n                \x3cspan id\x3d"layerMenu.refreshIntervalText2"\x3e\x3c/span\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.enableTime" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconEnableTime"\x3e\r\n      ${i18n.enableTimeAnimation}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.disableTime" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconDisableTime"\x3e\r\n      ${i18n.disableTimeAnimation}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.enableDimension" dojoType\x3d"dijit.MenuItem" iconClass\x3d"iconDimensionAnimation"\x3e\r\n      ${i18n.enableMapDimension}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.disableDimension" dojoType\x3d"dijit.MenuItem" iconClass\x3d"iconDimensionAnimation"\x3e\r\n      ${i18n.disableMapDimension}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.routeToAll" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconRouteToAll"\x3e\r\n      ${i18n.routeToAllFeatures}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.attrTableSeparator" dojoType\x3d"dijit.MenuSeparator"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.layerInfo" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconDescription"\x3e\r\n      ${i18n.description}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.saveProps" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconSave"\x3e\r\n      ${i18n.saveItemProperties}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"layerMenu.saveAsItem" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconSave"\x3e\r\n      ${i18n.saveItemProperties}\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"subLayerMenu" dojoType\x3d"dijit.Menu" refocus\x3d"false" style\x3d"display: none;"\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.scale" dojoType\x3d"dijit.PopupMenuItem" iconclass\x3d"iconScale"\x3e\r\n      \x3cspan\x3e${i18n.setVisibilityRange}\x3c/span\x3e\r\n      \x3cdiv id\x3d"subLayerMenu.layerScaleDlg" dojoType\x3d"dijit.TooltipDialog" title\x3d"${i18n.rendererCommon.visibleRangeTooltip}"\x3e\r\n        \x3cspan class\x3d"esriLeadingMargin05"\x3e${i18n.rendererCommon.visibleRange}\x3c/span\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"tocSubLayerScaleSuggest" data-dojo-attach-event\x3d"onClick:onClickTocScaleSuggest" class\x3d"esriFloatTrailing suggestLabel"\x3e\r\n          \x26nbsp;${i18n.rendererCommon.suggest}\x26nbsp;\r\n        \x3c/div\x3e\r\n        \x3cdiv style\x3d"clear:both;padding: 10px; width:300px;"\x3e\r\n          \x3cdiv id\x3d"tocSubLayerScaleSlider"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriLeadingMargin05" id\x3d"subLayerMenu.scaleCurrent"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.scaleSeparator" dojoType\x3d"dijit.MenuSeparator"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.moveUp" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconMoveUp"\x3e\r\n      ${i18n.moveUp}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.moveDown" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconMoveDown"\x3e\r\n      ${i18n.moveDown}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.rename" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconRename"\x3e\r\n      ${i18n.rename}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.remove" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconRemove"\x3e\r\n      ${i18n.remove}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.removeSeparator" dojoType\x3d"dijit.MenuSeparator"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.enablePopup" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconEnablePopup"\x3e\r\n      ${i18n.enablePopup}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.removePopup" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconRemovePopup"\x3e\r\n      ${i18n.removePopup}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.configPopup" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconConfigurePopup"\x3e\r\n      ${i18n.configurePopup}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.editRenderer" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconEditRenderer"\x3e\r\n      ${i18n.changeSymbols}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.smartMappingRenderer" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconEditRenderer"\x3e\r\n      ${i18n.changeStyle}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.editLabels" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconEditLabels"\x3e\r\n      ${i18n.createLabels}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.popupSeparator" dojoType\x3d"dijit.MenuSeparator"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.enableShowLegend" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconEnableShowLegend"\x3e\r\n      ${i18n.enableShowLegend}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.disableShowLegend" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconDisableShowLegend"\x3e\r\n      ${i18n.disableShowLegend}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.legendSeparator" dojoType\x3d"dijit.MenuSeparator"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.performAnalysis" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconPerformAnalysis"\x3e\r\n      ${i18n.performAnalysis}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.performAnalysisPopup" dojoType\x3d"dijit.PopupMenuItem" iconclass\x3d"iconPerformAnalysis"\x3e\r\n      \x3cspan\x3e${i18n.performAnalysis}\x3c/span\x3e\r\n      \x3cdiv id\x3d"subLayerMenu.performAnalysisDlg" dojoType\x3d"dijit.Menu"\x3e\r\n        \x3cdiv dojoType\x3d"dijit.MenuItem" dojoAttachPoint\x3d"_subpointMenu"\x3e\r\n          ${i18n.points}\r\n        \x3c/div\x3e\r\n        \x3cdiv dojoType\x3d"dijit.MenuItem" dojoAttachPoint\x3d"_sublineMenu"\x3e\r\n          ${i18n.lines}\r\n        \x3c/div\x3e\r\n        \x3cdiv dojoType\x3d"dijit.MenuItem" dojoAttachPoint\x3d"_subareaMenu"\x3e\r\n          ${i18n.areas}\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e     \r\n    \x3cdiv id\x3d"subLayerMenu.analysisSeparator" dojoType\x3d"dijit.MenuSeparator"\x3e\r\n    \x3c/div\x3e    \r\n    \x3cdiv id\x3d"subLayerMenu.showAttrTable" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconShowAttributeTable"\x3e\r\n      ${i18n.showTable}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.hideAttrTable" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconHideAttributeTable"\x3e\r\n      ${i18n.hideTable}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.filter" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconFilter"\x3e\r\n      ${i18n.filter}\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.attrTableSeparator" dojoType\x3d"dijit.MenuSeparator"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"subLayerMenu.layerInfo" dojoType\x3d"dijit.MenuItem" iconclass\x3d"iconDescription"\x3e\r\n      ${i18n.description}\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
role:arcgisonline.map.role,i18n:null,container:null,mapLayers:null,mapTables:null,menuLayerPos:0,menuSubLayerPos:-1,menuOpen:!1,clickTimer:null,timerParameterList:null,_eventConnections:[],basemapGalleryItems:null,_kmlNetworkFlayers:[],_isKmlNetworkLinkFolder:null,_kmlFcollbycurfolder:null,_kmlAnalysisLayer:null,analysisObj:arcgisonline.map.dijit.toc.analysis,constructor:function(a,d){null!=a&&(a.containerNode&&(this.container=a.containerNode),this._canPerformAnalysis=this.analysisObj.canPerformAnalysis())},
postMixInProperties:function(){this.inherited(arguments);this.i18n={};this.i18n=a.i18n.getLocalization("arcgisonline","arcgisonline").common;this.i18n.QueryLayerDlg=a.i18n.getLocalization("arcgisonline","arcgisonline").QueryLayerDlg;this.i18n.FilterDlg=a.i18n.getLocalization("arcgisonline","arcgisonline").FilterDlg;this.i18n.AddItemFromLayerDlg=a.i18n.getLocalization("arcgisonline","arcgisonline").AddItemFromLayerDlg;this.i18n.rendererCommon=a.i18n.getLocalization("arcgisonline","arcgisonline").rendererCommon;
a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").tocPanel);a.mixin(this.i18n,a.i18n.getLocalization("esri","jsapi").common)},postCreate:function(){this.container.addChild(f.byId("tocPanel"));isEmbedded||a.style(a.byId("tocContentFooter"),"display","");this.loadConnections()},loadConnections:function(){a.connect(f.byId("leftContentPanel"),"resize",this,"adjustHeight");a.connect(f.byId("layerMenu"),"onClose",this,"onMenuClose");a.connect(f.byId("subLayerMenu"),"onClose",this,
"onMenuClose");a.connect(f.byId("layerMenu.zoomTo"),"onClick",this,"zoomTo");a.connect(f.byId("layerMenu.opacitySlider"),"onChange",this,"setLayerOpacity");a.connect(f.byId("layerMenu.layerTransparencyDlg"),"onOpen",this,"layerTransp");a.connect(f.byId("layerMenu.layerScaleDlg"),"onOpen",a.hitch(this,"layerScale",null));a.connect(f.byId("layerMenu.moveUp"),"onClick",this,"moveUp");a.connect(f.byId("layerMenu.moveDown"),"onClick",this,"moveDown");a.connect(f.byId("layerMenu.remove"),"onClick",this,
"remove");a.connect(f.byId("layerMenu.rename"),"onClick",this,"rename");a.connect(f.byId("layerMenu.copy"),"onClick",this,"copy");a.connect(a.byId("layerMenu.startStopStream"),"onclick",this,"startStopStream");a.connect(a.byId("layerMenu.spatialFilterStream"),"onclick",this,"spatialFilterStream");a.connect(a.byId("layerMenu.clearStream"),"onclick",this,"clearStream");a.connect(f.byId("layerMenu.filterEditsDlg"),"onOpen",this,"filterEdits");a.connect(f.byId("layerMenu.showAllEdits"),"onClick",this,
"showAllEdits");a.connect(f.byId("layerMenu.enablePopup"),"onClick",this,"enablePopup");a.connect(f.byId("layerMenu.removePopup"),"onClick",this,"removePopup");a.connect(f.byId("layerMenu.configPopup"),"onClick",this,"configurePopup");a.connect(f.byId("layerMenu.enableTime"),"onClick",this,"enableTime");a.connect(f.byId("layerMenu.disableTime"),"onClick",this,"disableTime");a.connect(f.byId("layerMenu.enableDimension"),"onClick",this,"enableDimension");a.connect(f.byId("layerMenu.disableDimension"),
"onClick",this,"disableDimension");a.connect(f.byId("layerMenu.routeToAll"),"onClick",this,"routeToAll");a.connect(f.byId("layerMenu.performAnalysis"),"onClick",this,"configureAnalysis");a.connect(this._lyrpointMenu,"onClick",a.hitch(this,"configureAnalysis",{analysisType:"esriGeometryPoint"}));a.connect(this._lyrlineMenu,"onClick",a.hitch(this,"configureAnalysis",{analysisType:"esriGeometryPolyline"}));a.connect(this._lyrareaMenu,"onClick",a.hitch(this,"configureAnalysis",{analysisType:"esriGeometryPolygon"}));
a.connect(f.byId("layerMenu.editRenderer"),"onClick",this,"editRenderer");a.connect(f.byId("layerMenu.smartMappingRenderer"),"onClick",a.hitch(this,"smartMappingRenderer",null));a.connect(f.byId("layerMenu.editLabels"),"onClick",this,"editLabels");a.connect(f.byId("layerMenu.editRenderingRule"),"onClick",this,"editRenderingRule");a.connect(f.byId("layerMenu.editMosaicRule"),"onClick",this,"editMosaicRule");a.connect(f.byId("layerMenu.editImagePropertiesDlg"),"onOpen",this,"editImageProperties");a.connect(f.byId("layerMenu.editImagePropertiesDlg"),
"onClose",arcgisonline.map.dijit.toc.image,"onEditImagePropertiesClose");a.connect(f.byId("layerMenu.performanceQualitySlider"),"onChange",this,"onPerformanceQualitySlider");a.connect(f.byId("layerMenu.enableEditing"),"onClick",this,"enableEditing");a.connect(f.byId("layerMenu.disableEditing"),"onClick",this,"disableEditing");a.connect(f.byId("layerMenu.enableShowLegend"),"onClick",this,"enableShowLegend");a.connect(f.byId("layerMenu.disableShowLegend"),"onClick",this,"disableShowLegend");a.connect(f.byId("layerMenu.reviewGeocode"),
"onClick",this,"reviewGeocode");a.connect(f.byId("layerMenu.saveProps"),"onClick",this,"saveProps");a.connect(f.byId("layerMenu.saveAsItem"),"onClick",this,"saveAsItem");a.connect(f.byId("layerMenu.layerInfo"),"onClick",this,"showLayerDescription");a.connect(f.byId("layerMenu.showAttrTable"),"onClick",a.hitch(this,"showAttributeTable",null));a.connect(f.byId("layerMenu.hideAttrTable"),"onClick",a.hitch(this,"hideAttributeTable",null));a.connect(f.byId("layerMenu.filter"),"onClick",a.hitch(this,"filter",
null));a.connect(f.byId("layerMenu.multidimensionalFilter"),"onClick",this,"multidimensionalFilter");a.connect(f.byId("layerMenu.refreshIntervalDlg"),"onOpen",this,"onOpenRefreshInterval");a.connect(f.byId("layerMenu.streamingDlg"),"onOpen",a.hitch(this,"onOpenDlg",a.byId("layerMenu.streamingDlg")));a.connect(f.byId("subLayerMenu.layerScaleDlg"),"onOpen",this,"layerScale");a.connect(f.byId("subLayerMenu.moveUp"),"onClick",this,"moveUp");a.connect(f.byId("subLayerMenu.moveDown"),"onClick",this,"moveDown");
a.connect(f.byId("subLayerMenu.remove"),"onClick",this,"removeSubLayer");a.connect(f.byId("subLayerMenu.rename"),"onClick",this,"rename");a.connect(f.byId("subLayerMenu.layerInfo"),"onClick",this,"showSubLayerDescription");a.connect(f.byId("subLayerMenu.enablePopup"),"onClick",this,"enablePopup");a.connect(f.byId("subLayerMenu.removePopup"),"onClick",this,"removePopup");a.connect(f.byId("subLayerMenu.configPopup"),"onClick",this,"configurePopup");a.connect(f.byId("subLayerMenu.performAnalysis"),"onClick",
this,"configureAnalysis");a.connect(this._subpointMenu,"onClick",a.hitch(this,"configureAnalysis",{analysisType:"esriGeometryPoint"}));a.connect(this._sublineMenu,"onClick",a.hitch(this,"configureAnalysis",{analysisType:"esriGeometryPolyline"}));a.connect(this._subareaMenu,"onClick",a.hitch(this,"configureAnalysis",{analysisType:"esriGeometryPolygon"}));a.connect(f.byId("subLayerMenu.editRenderer"),"onClick",this,"editRenderer");a.connect(f.byId("subLayerMenu.smartMappingRenderer"),"onClick",a.hitch(this,
"smartMappingRenderer",null));a.connect(f.byId("subLayerMenu.editLabels"),"onClick",this,"editLabels");a.connect(f.byId("subLayerMenu.enableShowLegend"),"onClick",this,"enableShowLegend");a.connect(f.byId("subLayerMenu.disableShowLegend"),"onClick",this,"disableShowLegend");a.connect(f.byId("subLayerMenu.showAttrTable"),"onClick",a.hitch(this,"showAttributeTable",null));a.connect(f.byId("subLayerMenu.hideAttrTable"),"onClick",a.hitch(this,"hideAttributeTable",null));a.connect(f.byId("subLayerMenu.filter"),
"onClick",a.hitch(this,"filter",null));a.connect(f.byId("webmap-details-content-about"),"onClick",this,"openAboutStack");a.connect(f.byId("webmap-details-content-legend"),"onClick",this,"openLegendStack");this.layerScaleSlider=new esri.dijit.VisibleScaleRangeSlider({map:arcgisonline.map.main.map,region:esriGeowConfig.self.region},"tocLayerScaleSlider");this.layerScaleSlider.startup();this.layerScaleSlider.on("scale-range-change",a.hitch(this,function(){arcgisonline.map.dijit.toc.scale.updateScale(this.menuLayerPos,
this.menuSubLayerPos,this.layerScaleSlider.minScale,this.layerScaleSlider.maxScale)}));this.subLayerScaleSlider=new esri.dijit.VisibleScaleRangeSlider({map:arcgisonline.map.main.map,region:esriGeowConfig.self.region},"tocSubLayerScaleSlider");this.subLayerScaleSlider.startup();this.subLayerScaleSlider.on("scale-range-change",a.hitch(this,function(){arcgisonline.map.dijit.toc.scale.updateScale(this.menuLayerPos,this.menuSubLayerPos,this.subLayerScaleSlider.minScale,this.subLayerScaleSlider.maxScale)}));
a.subscribe("onLayerUpdate",null,a.hitch(this,function(a){"reopen"==a?this.refreshTOCAndReopen():this.loadTOC()}));f.byId("webmap-details-content").set("checked",!0);arcgisonline.map.dijit.toc.dnd.setup(this._dndSourceNode);a.connect(this._closeBtn,"onclick",this,"onClose")},onClose:function(a){a.preventDefault();arcgisonline.map.leftPanel.hideLeftContentPanel()},destroy:function(){this.inherited(arguments);a.forEach(this._eventConnections,a.disconnect);for(key in arcgisonline.map.dijit.toc.legend.rendererLegendRefreshHandlers)a.disconnect(arcgisonline.map.dijit.toc.legend.rendererLegendRefreshHandlers[key]);
arcgisonline.map.dijit.toc.legend.rendererLegendRefreshHandlers=[];this.analysisObj.destroy()},onMenuClose:function(){f.popup.close(f.byId("layerMenu.layerTransparencyDlg"));f.popup.close(f.byId("layerMenu.layerScaleDlg"));f.popup.close(f.byId("layerMenu.filterEditsDlg"));f.popup.close(f.byId("layerMenu.refreshIntervalDlg"));f.popup.close(f.byId("layerMenu.editImagePropertiesDlg"));f.popup.close(f.byId("layerMenu.editImagePropertiesDlg"));f.popup.close(f.byId("layerMenu.performAnalysisDlg"));f.popup.close(f.byId("subLayerMenu.performAnalysisDlg"));
this.menuOpen&&(this._kmlNetworkMenuId&&(this._kmlNetworkMenuId=null),this.menuOpen=!1)},loadTOC:function(){if(a.byId("toc-main")){a.query(".toc_toggle_legend").forEach(function(a){(a=f.byId(a.id))&&a.destroy()});this.mapLayers=arcgisonline.map.main.mapLayers;this.mapTables=arcgisonline.map.main.mapTables;var b="",d,c=this.analysisObj.getRunningJobs();this.hasAnySubLayers=!1;a.forEach(this.mapLayers,function(a){if("base"!==a.type&&"labels"!==a.type&&(a.layer&&a.layer.dynamicLayerInfos&&a.layer.dynamicLayerInfos.length||
a.layer&&a.layer.layerInfos&&a.layer.layerInfos.length||a.layer&&a.layer.folders||a.layers&&"mapNotes"!=a.type))this.hasAnySubLayers=!0},this);if(esri.isDefined(c))for(d in c)c.hasOwnProperty(d)&&c[d]&&(b+=this.analysisObj.buildAnalysisJobNode(c[d]));for(d=this.mapLayers.length-1;0<=d;d--)if(c=this.mapLayers[d],"user"==c.type||"mapNotes"==c.type)if(!c.layer||c.layer&&!(c.layer instanceof esri.layers.FeatureLayer&&c.layer.mode===esri.layers.FeatureLayer.MODE_SELECTION))b+=arcgisonline.map.dijit.toc.html.buildLayerTOCItem(d);
b+=arcgisonline.map.dijit.toc.html.buildBaseLayerTOCItem();for(d=this.mapTables.length-1;0<=d;d--)c=this.mapTables[d],b+=arcgisonline.map.dijit.toc.html.buildTableTOCItem(d);a.byId("toc-main").innerHTML=b;for(d=arcgisonline.map.main.mapLayers.length-1;0<=d;d--)if(b=arcgisonline.map.main.mapLayers[d],"mapNotes"!==b.type){arcgisonline.map.dijit.toc.options.showTocTools(b.id);break}arcgisonline.map.dijit.toc.dnd.sync();for(d=this.mapLayers.length-1;0<=d;d--)this.mapLayers[d]&&arcgisonline.map.dijit.toc.html.buildKMLNetworkLinkItems(d,
this.mapLayers[d].layer,null,this._kmlNetworkFlayers);arcgisonline.map.dijit.toc.scale.checkLayersInMapScale();setTimeout(function(){f.byId("tocPanel")&&f.byId("tocPanel").adjustHeight()},100)}},refreshTOCAndReopen:function(){var b=[];a.query(".toc_toggle_layer").forEach(function(c){("block"===a.style(c,"display")||""===a.style(c,"display")||"inline"===a.style(c,"display"))&&b.push(c.id)});a.query(".toc_toggle_group").forEach(function(c){("block"===a.style(c,"display")||""===a.style(c,"display")||
"inline"===a.style(c,"display"))&&b.push(c.id)});var d=[];a.query(".toc_toggle_legend").forEach(function(b){("block"===a.style(b,"display")||""===a.style(b,"display")||"inline"===a.style(b,"display"))&&d.push(b.id)});var c,e=arcgisonline.sharing.util.urlToObject(document.URL)||{};a.query(".toc_tools").forEach(function(b){esri.isTouchEnabled||e.query.useClick?"none"!==a.style(b,"display")&&(c=b.id):"hidden"!==a.style(b,"visibility")&&(c=b.id)});arcgisonline.map.main.map.infoWindow.clearFeatures();
arcgisonline.map.main.map.infoWindow.hide();this.loadTOC();a.forEach(b,function(b){(b=a.byId(b))&&a.style(b,"display","")});var g=[];a.forEach(d,function(b){var c=a.byId(b);if(c){for(var d=c.parentNode;!(-1<d.id.indexOf("_sub")||"toc-main"===d.id);)d=d.parentNode;var e="",h;if(-1<d.id.indexOf("_sub")){h=d.id.split("_");h.pop();var f="";a.forEach(h,function(a){e+=f+a;f="_"});h=parseInt(b.substring(e.length+1,b.length-7))}else e=c.id.substring(0,c.id.indexOf("_legend"));b=arcgisonline.map.main.getParameterListById(e);
for(var m=d=0;m<arcgisonline.map.main.mapLayers.length;m++)if(arcgisonline.map.main.mapLayers[m].id===e){d=m;break}var t;if(b.layers)for(m=0;m<b.layers.length;m++){if(b.layers[m].id===h){t=m;break}}else if(b.layer.dynamicLayerInfos)for(m=0;m<b.layer.dynamicLayerInfos.length;m++){if(b.layer.dynamicLayerInfos[m].id===h){t=m;break}}else if(b.layer.layerInfos)for(m=0;m<b.layer.layerInfos.length;m++)if(b.layer.layerInfos[m].id===h){t=m;break}-1==a.indexOf(g,e)&&(arcgisonline.map.dijit.toc.legend.requestLegend(d,
t),g.push(e));c&&(a.style(c,"display",""),arcgisonline.map.dijit.toc.options.updateLegendTool(b,h,"hide"))}},this);if(c){e=arcgisonline.sharing.util.urlToObject(document.URL)||{};a.query(".toc_tools").forEach(function(b){esri.isTouchEnabled||e.query.useClick?a.style(b,"display","none"):a.style(b,"visibility","hidden")});var h=a.byId(c);esri.isTouchEnabled||e.query.useClick?h&&a.style(h,"display",""):h&&a.style(h,"visibility","visible")}leftPanel&&leftPanel.clearLists()},onLayerClick:function(b){var d=
this.mapLayers[b],c=d.layer instanceof esri.layers.ArcGISImageServiceLayer,e=d.layer instanceof esri.layers.ArcGISImageServiceVectorLayer,g=a.byId(d.id+"_sub");if(g)"none"===a.style(g,"display")?(a.style(g,"display","block"),(b=a.byId(d.id+"_groupArrow"))&&a.removeClass(b,"iconGroupClosed"),b&&a.addClass(b,"iconGroupOpen"),d.layer&&d.layer.folders?a.forEach(d.layer.folders,function(b){var c=d.id+"_"+b.id;a.byId(c+"_group")&&"none"==a.style(a.byId(c+"_group"),"display")&&(a.style(a.byId(c+"_group"),
"display","block"),a.removeClass(a.byId(c+"_groupArrow"),"iconGroupClosed"),a.addClass(a.byId(c+"_groupArrow"),"iconGroupOpen"));a.byId(c+"_netLink")&&"none"==a.style(a.byId(c+"_netLink"),"display")&&(a.style(a.byId(c+"_netLink"),"display","block"),a.removeClass(a.byId(c+"_groupArrow"),"iconGroupClosed"),a.addClass(a.byId(c+"_groupArrow"),"iconGroupOpen"));if(b.networkLinkIds&&0<b.networkLinkIds.length){var g=d.layer;a.forEach(b.networkLinkIds,function(c){var d=g.id+"_"+b.id+"_netLink"+c;if((c=g.getFeature({type:"NetworkLink",
id:c}))&&c.declaredClass&&c.loaded)for(var e=0;e<c.folders.length;e++){var f=c.folders[e],k=f.id;f.subFolderIds&&0<f.subFolderIds.length?(a.byId(d+"_netLink")&&"none"==a.style(a.byId(d+"_netLink"),"display")&&(a.style(a.byId(d+"_netLink"),"display","block"),a.removeClass(a.byId(d+"_groupArrow"),"iconGroupClosed"),a.addClass(a.byId(d+"_groupArrow"),"iconGroupOpen")),a.byId(d+"_"+k+"_group")&&"none"==a.style(a.byId(d+"_"+k+"_group"),"display")&&(a.style(a.byId(d+"_"+k+"_group"),"display","block"),a.removeClass(a.byId(d+
"_"+k+"_groupArrow"),"iconGroupClosed"),a.addClass(a.byId(d+"_"+k+"_groupArrow"),"iconGroupOpen"))):f.networkLinkIds&&0<f.networkLinkIds.length&&(a.byId(d+"_"+k+"_group")&&"none"==a.style(a.byId(d+"_"+k+"_group"),"display"))&&(a.style(a.byId(d+"_"+k+"_group"),"display","block"),a.removeClass(a.byId(d+"_"+k+"_groupArrow"),"iconGroupClosed"),a.addClass(a.byId(d+"_"+k+"_groupArrow"),"iconGroupOpen"))}})}}):d.layer&&arcgisonline.map.main.hasDynamicLayers(d)?a.forEach(d.layer.dynamicLayerInfos,function(b){b=
d.id+"_"+b.id;a.byId(b+"_group")&&"none"==a.style(a.byId(b+"_group"),"display")&&(a.style(a.byId(b+"_group"),"display","block"),a.removeClass(a.byId(b+"_groupArrow"),"iconGroupClosed"),a.addClass(a.byId(b+"_groupArrow"),"iconGroupOpen"))}):d.layer&&a.forEach(d.layer.layerInfos,function(b){b=d.id+"_"+(esri.isDefined(b.id)?b.id:b.name);a.byId(b+"_group")&&"none"==a.style(a.byId(b+"_group"),"display")&&(a.style(a.byId(b+"_group"),"display","block"),a.removeClass(a.byId(b+"_groupArrow"),"iconGroupClosed"),
a.addClass(a.byId(b+"_groupArrow"),"iconGroupOpen"))})):(a.style(g,"display","none"),a.removeClass(a.byId(d.id+"_groupArrow"),"iconGroupOpen"),a.addClass(a.byId(d.id+"_groupArrow"),"iconGroupClosed"));else if(d.layer&&(d.layer.renderer||10.2<=d.layer.version&&(c||e)))!a.byId(d.id+"_legend")||0==a.byId(d.id+"_legend").innerHTML.length?arcgisonline.map.dijit.toc.legend.requestLegend(b,-1):a.byId(d.id+"_legend")&&"none"==a.style(a.byId(d.id+"_legend"),"display")?arcgisonline.map.dijit.toc.legend.displayLegend(b,
-1):a.byId(d.id+"_legend")&&a.style(a.byId(d.id+"_legend"),"display","none"),arcgisonline.map.dijit.toc.options.updateLegendTool(d);this.adjustHeight()},onSubLayerClick:function(b,d){var c=this.mapLayers[b],e=null,g;if(c.layers)g=c.layers[-1<d?d:0].id;else if(c.layer instanceof esri.layers.GeoRSSLayer)g=c.layer.getFeatureLayers()[-1<d?d:0].id;else if(c.layer.folders){var h=c.layer.folders[d];g=h.id;e=h.subLayerIds}else arcgisonline.map.main.hasDynamicLayers(c)?(h=c.layer.dynamicLayerInfos[d],g=h.id):
(h=c.layer.layerInfos[d],g=h.id,e=h.subLayerIds);null==e&&(null==a.byId(c.id+"_"+g+"_legend")||0==a.byId(c.id+"_"+g+"_legend").innerHTML.length?(!c.legendInfo||c.legendInfo&&c.legendInfo.layers&&0<c.legendInfo.layers.length)&&arcgisonline.map.dijit.toc.legend.requestLegend(b,d,a.hitch(this,function(a,b){arcgisonline.map.dijit.toc.options.updateLegendTool(a,b)},c,g)):a.byId(c.id+"_"+g+"_legend")&&"\x26nbsp;"==a.byId(c.id+"_"+g+"_legend").innerHTML||(a.byId(c.id+"_"+g+"_legend")&&"none"==a.style(a.byId(c.id+
"_"+g+"_legend"),"display")?(arcgisonline.map.dijit.toc.legend.displayLegend(b,d),arcgisonline.map.dijit.toc.options.updateLegendTool(c,g)):a.byId(c.id+"_"+g+"_legend")&&(a.style(a.byId(c.id+"_"+g+"_legend"),"display","none"),arcgisonline.map.dijit.toc.options.updateLegendTool(c,g))));this.adjustHeight()},onSubGroupLayerClick:function(b,d,c){b=this.mapLayers[b];b.layer.folders?tocSubInfoId=!c&&0!==c||-1===c?b.id+"_"+b.layer.folders[d].id:-2==c?d:d+"_"+c:arcgisonline.map.main.hasDynamicLayers(b)?tocSubInfoId=
b.id+"_"+b.layer.dynamicLayerInfos[d].id:(d=b.layer.layerInfos[d],tocSubInfoId=b.id+"_"+(esri.isDefined(d.id)?d.id:d.name));a.byId(tocSubInfoId+"_group")&&"none"==a.style(a.byId(tocSubInfoId+"_group"),"display")?(a.style(a.byId(tocSubInfoId+"_group"),"display","block"),a.removeClass(a.byId(tocSubInfoId+"_groupArrow"),"iconGroupClosed"),a.addClass(a.byId(tocSubInfoId+"_groupArrow"),"iconGroupOpen")):a.byId(tocSubInfoId+"_group")&&(a.style(a.byId(tocSubInfoId+"_group"),"display","none"),a.removeClass(a.byId(tocSubInfoId+
"_groupArrow"),"iconGroupOpen"),a.addClass(a.byId(tocSubInfoId+"_groupArrow"),"iconGroupClosed"));b.layer.folders&&(a.byId(tocSubInfoId+"_netLink")&&"none"==a.style(a.byId(tocSubInfoId+"_netLink"),"display")?(a.style(a.byId(tocSubInfoId+"_netLink"),"display","block"),a.removeClass(a.byId(tocSubInfoId+"_groupArrow"),"iconGroupClosed"),a.addClass(a.byId(tocSubInfoId+"_groupArrow"),"iconGroupOpen")):a.byId(tocSubInfoId+"_netLink")&&(a.style(a.byId(tocSubInfoId+"_netLink"),"display","none"),a.removeClass(a.byId(tocSubInfoId+
"_groupArrow"),"iconGroupOpen"),a.addClass(a.byId(tocSubInfoId+"_groupArrow"),"iconGroupClosed")));this.adjustHeight()},onLayerCheckClick:function(b,d){var c=this.mapLayers[b];if(a.byId(c.id+"_checkbox").checked)c.hadError=!1,c.layers?(c.visibility=!0,a.forEach(c.layers,function(a,b){(null==c.visibleLayers||""!=c.visibleLayers&&-1<(","+c.visibleLayers+",").indexOf(","+b+","))&&a.show()},this)):c.layer.show(),d.ctrlKey&&a.forEach(this.mapLayers,function(b){if(("user"===b.type||"mapNotes"===b.type)&&
b.id!=c.id){if(b.layers)b.visibility=!0,a.forEach(b.layers,function(a,c){(!b.visibleLayers||-1<(","+b.visibleLayers+",").indexOf(","+c+","))&&a.show()},this);else{var d;d=b.layer instanceof esri.layers.WMSLayer?0==b.visibleLayers.length?[]:b.visibleLayers.split(","):this.getLayersList(b);(!d||0<d.length)&&b.layer.show()}a.byId(b.id+"_checkbox").checked=!0;arcgisonline.map.main.switchFlsForMS(b)}},this);else{var e=arcgisonline.map.main.map.infoWindow;e.hide();e.clearFeatures();c.layers?(c.visibility=
!1,a.forEach(c.layers,function(a){a.clearSelection();a.hide()},this)):c.layer.hide();d.ctrlKey&&a.forEach(this.mapLayers,function(b){if("user"===b.type||"mapNotes"===b.type)b.layers?(b.visibility=!1,a.forEach(b.layers,function(a){a.clearSelection();a.hide()},this)):b.layer.hide(),a.byId(b.id+"_checkbox").checked=!1,arcgisonline.map.main.switchFlsForMS(b)},this)}c.visibilityChanged=!0;arcgisonline.map.main.switchFlsForMS(c);arcgisonline.map.table.checkTable();a.publish("onLayerVisibilityChange")},
onSubLayerCheckClick:function(b,d,c,e,g){b=this.mapLayers[b];if(b.layer&&b.layer.folders)if(!c&&0!==c||-1===c){c=b.layer.folders[d];var h=c.visible?!1:!0;b.layer.setFolderVisibility(c,h);if(g.ctrlKey){g=b.layer.folders;for(e=0;e<g.length;e++)e!=d&&(c.parentFolderId==g[e].parentFolderId&&c.level==g[e].level)&&(b.layer.setFolderVisibility(g[e],h),a.byId(b.id+"_"+g[e].id+"_checkbox").checked=h)}}else{if(e&&-1<e.indexOf("_netLink")){b=b.layer;for(h=g=0;-1<h;){var f;g=e.indexOf("_netLink",g+1);h=e.indexOf("_",
g+2);f=-1===h?e.substring(g+8):e.substring(g+8,h);b=b.getFeature({type:"NetworkLink",id:parseInt(f)})}b=b.getFeature({type:"NetworkLink",id:c})}else b=b.layer.getFeature({type:"NetworkLink",id:c});d||0===d?(c=b.getFeature({type:"Folder",id:d}),b.setFolderVisibility(c,!c.visible)):b.setVisibility(!b.visible)}else if(b.layers||b.layer instanceof esri.layers.GeoRSSLayer)e=b.layers||b.layer.getFeatureLayers(),c=e[d],g=null,""===b.visibleLayers?g=[]:esri.isDefined(b.visibleLayers)&&(g=a.map(b.visibleLayers.split(","),
function(a){return parseInt(a)})),c.visible?(g||(g=a.map(e,function(a,b){return b})),g=a.filter(g,function(a){return a!=d}),c.hide()):b.visibility?(g?-1==a.indexOf(g,d)&&g.push(d):(g=[],g.push(d)),c.show()):g?-1<a.indexOf(g,d)?g=a.filter(g,function(a){return a!=d}):g.push(d):(g=a.map(e,function(a,b){return b}),g=a.filter(g,function(a){return a!=d})),b.itemId?b.visibleLayers=g?g.toString():"":g&&g.length<e.length?b.visibleLayers=g.toString():delete b.visibleLayers,arcgisonline.map.table.checkTable(),
a.publish("onLayerVisibilityChange"),b.layers&&(b.visibleLayersChanged=!0);else{var n=b.layer.layerInfos[d],s=n.id;b.layer instanceof esri.layers.WMSLayer?(s=n.name,-1<c&&(n=n.subLayers[c],s=n.name)):arcgisonline.map.main.hasDynamicLayers(b)&&(n=b.itemLayers[d],s=n.id);var l="";if(esri.isDefined(b.visibleLayers)){l=b.visibleLayers;c=0==l.length?[]:l.split(",");l=a.indexOf(c,s);-1<l?c.splice(l,1):c.push(""+s);if(g.ctrlKey){h=b.layer.layerInfos;arcgisonline.map.main.hasDynamicLayers(b)&&(h=b.itemLayers);
for(e=0;e<h.length;e++)if(f=h[e].id,b.layer instanceof esri.layers.WMSLayer&&(f=h[e].name),e!=d&&(n.parentLayerId==h[e].parentLayerId&&n.level==h[e].level||b.layer instanceof esri.layers.WMSLayer))-1<l?(g=a.indexOf(c,f),-1<g&&(c.splice(g,1),a.byId(b.id+"_"+f+"_checkbox").checked=!1)):(g=a.indexOf(c,f),-1==g&&(c.push(f),a.byId(b.id+"_"+f+"_checkbox").checked=!0))}if(b.layer instanceof esri.layers.WMSLayer){g=[];for(e=0;e<b.layer.layerInfos.length;e++)n=b.layer.layerInfos[e],a.some(c,function(a){return a===
n.name})&&g.push(n.name);c=g}else c=a.map(c,function(a){return parseInt(a)}),c=c.sort(function(a,b){return a-b});l=c.toString()}else{var q="",h=b.layer.layerInfos;arcgisonline.map.main.hasDynamicLayers(b)&&(h=b.itemLayers);for(e=0;e<h.length;e++)if(f=h[e].id,b.layer instanceof esri.layers.WMSLayer&&(f=h[e].name),e!=d)if(g.ctrlKey&&(n.parentLayerId==h[e].parentLayerId&&n.level==h[e].level||b.layer instanceof esri.layers.WMSLayer))!0===n.defaultVisibility||!esri.isDefined(n.defaultVisibility)?a.byId(b.id+
"_"+f+"_checkbox").checked=!1:(l+=q+f,q=",",a.byId(b.id+"_"+f+"_checkbox").checked=!0);else{if(!0==h[e].defaultVisibility||!esri.isDefined(h[e].defaultVisibility))l+=q+f,q=","}else e==d&&(!0==h[e].defaultVisibility||!esri.isDefined(h[e].defaultVisibility)?a.removeClass(a.byId(b.id+"_"+s),"visible"):(-1<c&&(f=h[e].subLayers[c].name),l+=q+f,q=",",a.addClass(a.byId(b.id+"_"+s),"visible")));b.layer instanceof esri.layers.WMSLayer||(b.visibleLayersChanged=!0)}b.visibleLayers=l;e=function(b){clearTimeout(this.clickTimer);
if(b.layers)a.forEach(b.layers,function(c,d){a.indexOf(b.visibleLayers,d)?c.show():c.hide()});else if(0<b.layer.layerInfos.length){var c;c=b.layer instanceof esri.layers.WMSLayer?0==b.visibleLayers.length?[]:b.visibleLayers.split(","):this.getLayersList(b);b.layer.setVisibleLayers(c);!b.layer.visible&&a.byId(b.id+"_checkbox").checked&&b.layer.show()}arcgisonline.map.main.switchFlsForMS(b);arcgisonline.map.table.checkTable();a.publish("onLayerVisibilityChange");b.layer instanceof esri.layers.WMSLayer||
(b.visibleLayersChanged=!0)};null==this.clickTimer?this.timerParameterList=b:this.timerParameterList.id==b.id?clearTimeout(this.clickTimer):(clearTimeout(this.clickTimer),a.partial(this,e,this.timerParameterList),this.timerParameterList=b);this.clickTimer=setTimeout(a.hitch(this,e,b),1E3)}},onLayerMenuClick:function(b){var d=arcgisonline.sharing.util.getUser(),c;if("string"===typeof b){var e=b;c=arcgisonline.map.main.getParameterListById(b);b=-1;a.forEach(this.mapLayers,function(a,c){a.id===e&&(b=
c)})}else c=this.mapLayers[b];this.menuLayerPos=b;this.menuSubLayerPos=-1;this.menuOpen=!0;this._isKmlNetworkLinkFolder=this.isTable=!1;this._kmlAnalysisLayer=this._kmlFcollbycurfolder=null;var g="base"===c.type||"labels"===c.type,h=arcgisonline.map.popup.hasPopup(c),k=c.layer instanceof esri.layers.KMLLayer,n=this.mapLayers[b+1]&&this.mapLayers[b+1].layer instanceof esri.layers.KMLLayer,s=this.mapLayers[b-1]&&this.mapLayers[b-1].layer instanceof esri.layers.KMLLayer,l=arcgisonline.map.featColl.isFeatureCollection(c),
q="mapNotes"===c.type,p=c.layer instanceof esri.layers.FeatureLayer&&!(c.layer instanceof esri.layers.StreamLayer);p&&c.layer.url&&c.layer.url.toLowerCase().indexOf("/mapserver/");var m=c.layer instanceof esri.layers.StreamLayer,t=c.layer instanceof esri.layers.CSVLayer,u=c.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer,x=c.layer instanceof esri.layers.ArcGISTiledMapServiceLayer,y=c.layer instanceof esri.layers.VectorTileLayer,r=c.layer instanceof esri.layers.ArcGISImageServiceLayer,v=
c.layer instanceof esri.layers.ArcGISImageServiceVectorLayer,w=c.layer instanceof esri.layers.WMSLayer,k=c.layer instanceof esri.layers.KMLLayer,z=c.layer instanceof esri.layers.GeoRSSLayer,L=arcgisonline.map.main.hasDynamicLayers(c)&&c.thematicGroup;z&&c.layer.getFeatureLayers();var A=c.layer instanceof esri.layers.WebTiledLayer,M=c.layer instanceof esri.virtualearth.VETiledLayer,N=c.layer instanceof esri.layers.OpenStreetMapLayer,H=c.serviceInfo?c.serviceInfo.currentVersion:null;c.itemId&&(!c.itemCard&&
!c._itemNotAccessible)&&arcgisonline.sharing.util.request({url:esriGeowConfig.restBaseUrl+"content/items/"+c.itemId},{disableIdentityLookup:!0}).then(a.hitch(this,function(b){if(b.id===c.itemId&&(c.itemOwner=b.owner,c.itemCard=b,"base"!=c.type&&c.itemCard&&-1<a.indexOf(c.itemCard.typeKeywords,"Involved Lookup")))if((b=arcgisonline.sharing.util.getUser())&&c.itemOwner===b.email)D=!0,a.style(a.byId("layerMenu.reviewGeocode"),"display",10>a.isIE?"inline":"");else if(b&&c.url&&c.itemCard&&("update"===
c.itemCard.itemControl||"admin"===c.itemCard.itemControl))-1<a.indexOf(c.itemCard.typeKeywords,"Hosted Service")&&a.style(a.byId("layerMenu.reviewGeocode"),"display",10>a.isIE?"inline":"")}),a.hitch(this,function(){c._itemNotAccessible=!0}));var D=!1;d&&(c.itemId&&c.itemCard&&c.itemCard.owner===d.email)&&(D=!0);var I=c&&c.layer&&c.layer.timeInfo&&c.layer.timeInfo.timeExtent,J=c&&c.layer&&c.layer.useMapTime,E=!1,C=c&&c.layer&&c.layer.useMapDimensionValue,F=arcgisonline.map.multiDimensions&&arcgisonline.map.multiDimensions.mdSlider?
arcgisonline.map.multiDimensions.mdSlider.dimension:arcgisonline.map.multiDimensions.getDefaultDimension();arcgisonline.map.multiDimensions&&F&&c&&(c.layer&&c.layer.hasMultidimensions&&c.multidimensionalInfo)&&a.some(c.multidimensionalInfo.variables,function(b){a.some(b.dimensions,function(a){if(a.name===F)return E=!0})});C=C&&c.layer.activeMapDimensions&&c.layer.activeMapDimensions.length&&0<=c.layer.activeMapDimensions.indexOf(F);a.style(a.byId("layerMenu.zoomTo"),"display",10>a.isIE?"inline":"");
a.style(a.byId("layerMenu.layerTransp"),"display",10>a.isIE?"inline":"");a.style(a.byId("layerMenu.moveSeparator"),"display","none");a.style(a.byId("layerMenu.moveUp"),"display","none");a.style(a.byId("layerMenu.moveDown"),"display","none");a.style(a.byId("layerMenu.rename"),"display","none");a.style(a.byId("layerMenu.remove"),"display","none");a.style(a.byId("layerMenu.editsSeparator"),"display","");a.style(a.byId("layerMenu.scale"),"display","none");a.style(a.byId("layerMenu.streaming"),"display",
"none");a.style(a.byId("layerMenu.filterEdits"),"display","none");a.style(a.byId("layerMenu.showAllEdits"),"display","none");a.style(a.byId("layerMenu.enablePopup"),"display","none");a.style(a.byId("layerMenu.removePopup"),"display","none");a.style(a.byId("layerMenu.configPopup"),"display","none");a.style(a.byId("layerMenu.enableTime"),"display","none");a.style(a.byId("layerMenu.disableTime"),"display","none");a.style(a.byId("layerMenu.enableDimension"),"display","none");a.style(a.byId("layerMenu.disableDimension"),
"display","none");a.style(a.byId("layerMenu.routeToAll"),"display","none");a.style(a.byId("layerMenu.editRenderer"),"display","none");a.style(a.byId("layerMenu.smartMappingRenderer"),"display","none");a.style(a.byId("layerMenu.enableDimension"),"display","none");a.style(a.byId("layerMenu.disableDimension"),"display","none");a.style(a.byId("layerMenu.multidimensionalFilter"),"display","none");a.style(a.byId("layerMenu.editLabels"),"display","none");a.style(a.byId("layerMenu.editRenderingRule"),"display",
"none");a.style(a.byId("layerMenu.editMosaicRule"),"display","none");a.style(a.byId("layerMenu.editImageProperties"),"display","none");a.style(a.byId("layerMenu.enableEditing"),"display","none");a.style(a.byId("layerMenu.disableEditing"),"display","none");a.style(a.byId("layerMenu.enableShowLegend"),"display","none");a.style(a.byId("layerMenu.disableShowLegend"),"display","none");a.style(a.byId("layerMenu.reviewGeocode"),"display","none");a.style(a.byId("layerMenu.saveProps"),"display","none");a.style(a.byId("layerMenu.saveAsItem"),
"display","none");a.style(a.byId("layerMenu.performAnalysis"),"display","none");a.style(a.byId("layerMenu.performAnalysisPopup"),"display","none");a.style(a.byId("layerMenu.analysisSeparator"),"display","none");c.itemId&&c.itemCard?f.byId("layerMenu.layerInfo").set("label",this.i18n.showItemDetails):f.byId("layerMenu.layerInfo").set("label",this.i18n.description);this.role.isAllowed("toc_menu_labels")&&(c.layer&&c.layer.labelingInfo&&arcgisonline.map.labels.hasLayer(c.layer)?f.byId("layerMenu.editLabels").set("label",
this.i18n.manageLabels):f.byId("layerMenu.editLabels").set("label",this.i18n.createLabels));a.style(a.byId("layerMenu.popupSeparator"),"display","none");a.style(a.byId("layerMenu.filterSeparator"),"display","none");a.style(a.byId("layerMenu.showAttrTable"),"display","none");a.style(a.byId("layerMenu.hideAttrTable"),"display","none");a.style(a.byId("layerMenu.filter"),"display","none");a.style(a.byId("layerMenu.multidimensionalFilter"),"display","none");a.style(a.byId("layerMenu.refreshInterval"),
"display","none");a.style(a.byId("layerMenu.attrTableSeparator"),"display","none");a.style(a.byId("layerMenu.copy"),"display","none");var G=!1,K=!1;c.layer&&(c.layer.capabilities?G=-1<c.layer.capabilities.toLowerCase().indexOf("catalog"):c.layer.fields&&0<c.layer.fields.length&&(G=!0),c.layer.hasMultidimensions&&(K=c.layer.hasMultidimensions));d=f.byId("layerMenu");a.forEach(d.getChildren(),function(d){if("dijit.MenuSeparator"!==d.declaredClass)if(-1<d.id.indexOf("layerMenu.scale")&&arcgisonline.map.dijit.toc.options.canShowScale(c))a.style(a.byId("layerMenu.scale"),
"display",10>a.isIE?"inline":"");else if(-1<d.id.indexOf("layerMenu.zoomTo")&&m)a.style(a.byId("layerMenu.zoomTo"),"display",10>a.isIE?"inline":"none");else if(-1<d.id.indexOf("layerMenu.rename")&&this.role.isAllowed("toc_menu_rename"))a.style(a.byId("layerMenu.rename"),"display",""),a.style(a.byId("layerMenu.moveSeparator"),"display","");else if(-1<d.id.indexOf("layerMenu.moveUp")&&this.role.isAllowed("toc_menu_move"))a.style(a.byId("layerMenu.moveUp"),"display",""),a.style(a.byId("layerMenu.moveSeparator"),
"display",""),"base"===c.type||k||n||"mapNotes"===c.type&&!arcgisonline.map.dijit.toc.dnd.isOneAbove(b,"mapNotes",null)||"user"===c.type&&!arcgisonline.map.dijit.toc.dnd.isOneAbove(b,"user",c.subType)?d.set("disabled",!0):d.set("disabled",!1);else if(-1<d.id.indexOf("layerMenu.moveDown")&&this.role.isAllowed("toc_menu_move"))a.style(a.byId("layerMenu.moveDown"),"display",""),a.style(a.byId("layerMenu.moveSeparator"),"display",""),"base"===c.type||k||s||"mapNotes"===c.type&&!arcgisonline.map.dijit.toc.dnd.isOneBelow(b,
"mapNotes")||"user"===c.type&&!arcgisonline.map.dijit.toc.dnd.isOneBelow(b,"user",c.subType)?d.set("disabled",!0):d.set("disabled",!1);else if(-1<d.id.indexOf("layerMenu.streaming")&&m)a.style(a.byId("layerMenu.streaming"),"display",""),a.style(a.byId("layerMenu.analysisSeparator"),"display",""),c.layer.socket?(a.byId("layerMenu.startStopStream").innerHTML=this.i18n.stopStreaming,a.style(a.byId("layerMenu.spatialFilterStreamEnabled"),"display",""),a.style(a.byId("layerMenu.spatialFilterStreamDisabled"),
"display","none"),a.style(a.byId("layerMenu.clearStreamDivEnabled"),"display",""),a.style(a.byId("layerMenu.clearStreamDivDisabled"),"display","none")):(a.byId("layerMenu.startStopStream").innerHTML=this.i18n.startStreaming,a.style(a.byId("layerMenu.spatialFilterStreamEnabled"),"display","none"),a.style(a.byId("layerMenu.spatialFilterStreamDisabled"),"display",""),a.style(a.byId("layerMenu.clearStreamDivEnabled"),"display","none"),a.style(a.byId("layerMenu.clearStreamDivDisabled"),"display","")),
c.layer.getFilter()&&c.layer.getFilter().geometry?(a.byId("layerMenu.spatialFilterStream").innerHTML=this.i18n.showAllObservations,a.byId("layerMenu.spatialFilterStreamDisabled").innerHTML=this.i18n.showAllObservations):(a.byId("layerMenu.spatialFilterStream").innerHTML=this.i18n.limitObservations,a.byId("layerMenu.spatialFilterStreamDisabled").innerHTML=this.i18n.limitObservations);else if(-1<d.id.indexOf("layerMenu.filterEdits")&&(p||m))arcgisonline.map.editTracking.hasEditTracking(c)&&(arcgisonline.map.dijit.toc.filterEdits.filterEditsUserOptions&&
c.id!==arcgisonline.map.dijit.toc.filterEdits.filterEditsLayerId&&arcgisonline.map.dijit.toc.filterEdits._clearFilterEdits(),arcgisonline.map.dijit.toc.filterEdits.filterEditsLayerId=c.id,null===c.featureCount||void 0===c.featureCount?arcgisonline.map.editTracking.getFeatureCount(c,function(){0<c.featureCount&&c.featureCount<arcgisonline.map.editTracking.maxFeatureCount&&(a.style(a.byId("layerMenu.filterEdits"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.filterSeparator"),"display",
10>a.isIE?"inline":""))}):0<c.featureCount&&c.featureCount<arcgisonline.map.editTracking.maxFeatureCount&&(a.style(a.byId("layerMenu.filterEdits"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.filterSeparator"),"display",10>a.isIE?"inline":"")));else if(-1<d.id.indexOf("layerMenu.showAllEdits")&&p&&this.isShowAllEdits())a.style(a.byId("layerMenu.showAllEdits"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.filterSeparator"),"display",10>a.isIE?"inline":"");else if(-1<d.id.indexOf("layerMenu.configPopup")&&
this.role.isAllowed("toc_menu_popup")&&(p||m||L||(r||v)&&!g))a.style(a.byId("layerMenu.configPopup"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.popupSeparator"),"display",10>a.isIE?"inline":"");else if(-1<d.id.indexOf("layerMenu.enablePopup")&&this.role.isAllowed("toc_menu_popup")&&!h&&(p||m||(r||v)&&!g))a.style(a.byId("layerMenu.enablePopup"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.popupSeparator"),"display",10>a.isIE?"inline":"");else if(-1<d.id.indexOf("layerMenu.removePopup")&&
this.role.isAllowed("toc_menu_popup")&&h&&(p||m||(r||v)&&!g))a.style(a.byId("layerMenu.removePopup"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.popupSeparator"),"display",10>a.isIE?"inline":"");else if(-1<d.id.indexOf("layerMenu.remove")&&this.role.isAllowed("toc_menu_remove"))a.style(a.byId("layerMenu.remove"),"display",""),a.style(a.byId("layerMenu.moveSeparator"),"display",""),"base"==c.type?d.set("disabled",!0):d.set("disabled",!1);else if(-1<d.id.indexOf("layerMenu.copy")&&this.role.isAllowed("toc_menu_copy")){if("user"===
c.type&&!k&&!z&&!t&&!A&&(!l||!c.url)||"mapNotes"===c.type)a.style(a.byId("layerMenu.copy"),"display",10>a.isIE?"inline":"")}else if(-1<d.id.indexOf("layerMenu.reviewGeocode")&&"base"!=c.type&&c.itemCard&&-1<a.indexOf(c.itemCard.typeKeywords,"Involved Lookup")){var e=arcgisonline.sharing.util.getUser();if(D)a.style(a.byId("layerMenu.reviewGeocode"),"display",10>a.isIE?"inline":"");else if(e&&c.url&&c.itemCard&&("update"===c.itemCard.itemControl||"admin"===c.itemCard.itemControl))c.itemCard&&-1<a.indexOf(c.itemCard.typeKeywords,
"Hosted Service")&&a.style(a.byId("layerMenu.reviewGeocode"),"display",10>a.isIE?"inline":"")}else if(-1<d.id.indexOf("layerMenu.editRenderer")&&arcgisonline.map.dijit.toc.options.canShowStyle(c))e=arcgisonline.sharing.util.urlToObject(document.URL),e.query&&e.query.oldSymbols&&(a.style(a.byId("layerMenu.editRenderer"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.popupSeparator"),"display",10>a.isIE?"inline":""));else if(-1<d.id.indexOf("layerMenu.editLabels")&&this.role.isAllowed("toc_menu_labels"))c.layer&&
l||t?(a.style(a.byId("layerMenu.editLabels"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.popupSeparator"),"display",10>a.isIE?"inline":"")):p&&(a.style(a.byId("layerMenu.editLabels"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.popupSeparator"),"display",10>a.isIE?"inline":""));else if(-1<d.id.indexOf("layerMenu.editRenderingRule"))c.layer&&(r&&!g)&&a.style(a.byId("layerMenu.editRenderingRule"),"display",10>a.isIE?"inline":"");else if(-1<d.id.indexOf("layerMenu.editMosaicRule")){if(c.layer&&
(r||v)&&G&&!g)a.style(a.byId("layerMenu.editMosaicRule"),"display",10>a.isIE?"inline":"")}else if(-1<d.id.indexOf("layerMenu.editImageProperties"))c.layer&&(r&&!g)&&(a.style(a.byId("layerMenu.editImageProperties"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.popupSeparator"),"display",10>a.isIE?"inline":""));else if(-1<d.id.indexOf("layerMenu.enableEditing")&&this.role.isAllowed("toc_menu_editing")&&(l||p))if(l){if(e=arcgisonline.sharing.util.getUser(),!c.itemId||c.itemId&&c.itemCard&&
e&&c.itemCard.owner===e.email)if(c.layer&&!c.layer.isEditable()||c.layers&&c.layers[0]&&!c.layers[0].isEditable())a.style(a.byId("layerMenu.enableEditing"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.popupSeparator"),"display",10>a.isIE?"inline":"")}else!c.layer.isEditable()&&(c.serviceInfo&&c.serviceInfo._origCapabilities)&&(a.style(a.byId("layerMenu.enableEditing"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.popupSeparator"),"display",10>a.isIE?"inline":""));else if(-1<
d.id.indexOf("layerMenu.disableEditing")&&this.role.isAllowed("toc_menu_editing")&&(l||p)){if((c.layer&&c.layer.isEditable()||c.layers&&c.layers[0]&&c.layers[0].isEditable())&&!arcgisonline.map.main.hasFullEditingControl(c))a.style(a.byId("layerMenu.disableEditing"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.popupSeparator"),"display",10>a.isIE?"inline":"")}else if(-1<d.id.indexOf("layerMenu.enableShowLegend")&&this.role.isAllowed("toc_menu_legend")&&(!g&&!1===c.showLegend||g&&!0!==
c.showLegend)&&!w&&!(r&&10.2>H)&&!A&&!y)a.style(a.byId("layerMenu.enableShowLegend"),"display",10>a.isIE?"inline":"");else if(-1<d.id.indexOf("layerMenu.disableShowLegend")&&this.role.isAllowed("toc_menu_legend")&&(!g&&!1!==c.showLegend||g&&!0===c.showLegend)&&!w&&!(r&&10.2>H)&&!A&&!y)a.style(a.byId("layerMenu.disableShowLegend"),"display",10>a.isIE?"inline":"");else if(-1<d.id.indexOf("layerMenu.multidimensionalFilter")&&(r||v)&&K&&!g)a.style(a.byId("layerMenu.multidimensionalFilter"),"display",
10>a.isIE?"inline":""),a.style(a.byId("layerMenu.attrTableSeparator"),"display",10>a.isIE?"inline":"");else if(-1<d.id.indexOf("layerMenu.refreshInterval")&&this.role.isAllowed("toc_menu_refreshInterval")&&(p||r||w||u||x||A||k||z||t)&&!l)a.style(a.byId("layerMenu.refreshInterval"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.attrTableSeparator"),"display",10>a.isIE?"inline":"");else if(-1<d.id.indexOf("layerMenu.enableTime")&&I&&!J&&!m)a.style(a.byId("layerMenu.enableTime"),"display",
10>a.isIE?"inline":"");else if(-1<d.id.indexOf("layerMenu.disableTime")&&I&&J&&!m)a.style(a.byId("layerMenu.disableTime"),"display",10>a.isIE?"inline":"");else if(-1<d.id.indexOf("layerMenu.enableDimension")&&!C&&E)a.style(a.byId("layerMenu.enableDimension"),"display",10>a.isIE?"inline":"");else if(-1<d.id.indexOf("layerMenu.disableDimension")&&C&&E)a.style(a.byId("layerMenu.disableDimension"),"display",10>a.isIE?"inline":"");else if(-1<d.id.indexOf("layerMenu.routeToAll")&&arcgisonline.map.role.canShowDirections()&&
(p||q||z)){if((e=arcgisonline.sharing.util.getUser())&&e.accountId&&esriGeowConfig.self.helperServices.route&&esriGeowConfig.self.helperServices.route.url){var B=100;c.layer&&"esriGeometryPoint"==c.layer.geometryType?B=c.layer.graphics.length:c.layer&&c.layer instanceof esri.layers.GeoRSSLayer?(e=c.layer.getFeatureLayers(),a.forEach(e,function(a){"esriGeometryPoint"==a.geometryType&&(B=a.graphics.length)})):a.forEach(c.layers,function(a){"esriGeometryPoint"==a.geometryType&&!arcgisonline.map.main.isTextLayer(a)&&
(B=a.graphics.length)});if(9>a.isIE&&20>=B||!(9>a.isIE)&&50>=B)a.style(a.byId("layerMenu.routeToAll"),"display",10>a.isIE?"inline":"")}}else if(-1<d.id.indexOf("layerMenu.saveProps")&&"base"!=c.type&&c.itemId){if((e=arcgisonline.sharing.util.getUser())&&(p&&!t||m||u||x||r||w||l))e=function(b,e){e&&(d.set("disabled",b?!0:!1),a.style(a.byId("layerMenu.saveProps"),"display",10>a.isIE?"inline":""));c.itemCard&&f.byId("layerMenu.layerInfo").set("label",this.i18n.showItemDetails)},this._checkUploadLink(c,
a.hitch(this,e))}else-1<d.id.indexOf("layerMenu.saveAsItem")&&this.role.isAllowed("toc_menu_saveProps")&&"base"!=c.type&&!c.itemId&&(u||x||y||r||p&&!t||m||l||q)?(e=arcgisonline.sharing.util.getUser())&&a.style(a.byId("layerMenu.saveAsItem"),"display",10>a.isIE?"inline":""):-1<d.id.indexOf("layerMenu.layerInfo")&&(isEmbedded&&isEmbedded.hideExternalLinks?a.style(a.byId("layerMenu.layerInfo"),"display","none"):l&&!c.itemId||M||N||z||A||t?d.set("disabled",!0):(k?c.itemId&&c.itemCard?f.byId("layerMenu.layerInfo").set("label",
this.i18n.description):f.byId("layerMenu.layerInfo").set("label",this.i18n.download):(f.byId("layerMenu.layerInfo").set("label",this.i18n.description),e=arcgisonline.sharing.util.getUser(),c.itemId&&c.itemCard?f.byId("layerMenu.layerInfo").set("label",this.i18n.showItemDetails):c.itemId&&(!e||!(p&&!t||m||u||x||y||r||w||l))&&arcgisonline.map.mapUtil.checkFSItemAccess(c,a.hitch(this,function(){c.itemCard&&f.byId("layerMenu.layerInfo").set("label",this.i18n.showItemDetails)}))),d.set("disabled",!1)))},
this);"none"===a.style(a.byId("layerMenu.saveProps"),"display")&&("none"===a.style(a.byId("layerMenu.saveAsItem"),"display")&&"none"===a.style(a.byId("layerMenu.layerInfo"),"display"))&&a.style(a.byId("layerMenu.attrTableSeparator"),"display","none");d={target:a.byId(c.id+"_menu")};d.preventDefault=d.stopPropagation=function(){};f.byId("layerMenu")._openMyself(d)},onSubKMLNetLinkFolderClick:function(b,d,c){b=this._kmlNetworkFlayers[b+"_"+d+"_"+c];this.menuLayerPos=c;this.menuSubLayerPos=b.folder.id;
this._isKmlNetworkLinkFolder=this.menuOpen=!0;this._kmlFcollbycurfolder=b.kmlFcollbycurfolder;this._kmlAnalysisLayer=b.link;this._kmlAnalysisLayer.title=b.folder.name;this._kmlAnalysisLayer.name=this._kmlAnalysisLayer.title;this._kmlNetworkMenuId=b.baseId+"_"+b.folder.id+"_menu";a.style(a.byId("subLayerMenu.analysisSeparator"),"display","none");a.style(a.byId("subLayerMenu.scale"),"display","none");a.style(a.byId("subLayerMenu.scaleSeparator"),"display","none");a.style(a.byId("subLayerMenu.moveUp"),
"display","none");a.style(a.byId("subLayerMenu.moveDown"),"display","none");a.style(a.byId("subLayerMenu.rename"),"display","none");a.style(a.byId("subLayerMenu.remove"),"display","none");a.style(a.byId("subLayerMenu.removeSeparator"),"display","none");a.style(a.byId("subLayerMenu.enablePopup"),"display","none");a.style(a.byId("subLayerMenu.removePopup"),"display","none");a.style(a.byId("subLayerMenu.configPopup"),"display","none");a.style(a.byId("subLayerMenu.editRenderer"),"display","none");a.style(a.byId("subLayerMenu.smartMappingRenderer"),
"display","none");a.style(a.byId("subLayerMenu.editLabels"),"display","none");a.style(a.byId("subLayerMenu.enableShowLegend"),"display","none");a.style(a.byId("subLayerMenu.disableShowLegend"),"display","none");a.style(a.byId("subLayerMenu.popupSeparator"),"display","none");a.style(a.byId("subLayerMenu.showAttrTable"),"display","none");a.style(a.byId("subLayerMenu.hideAttrTable"),"display","none");a.style(a.byId("subLayerMenu.filter"),"display","none");a.style(a.byId("subLayerMenu.attrTableSeparator"),
"display","none");a.style(a.byId("subLayerMenu.performAnalysis"),"display","none");a.style(a.byId("subLayerMenu.performAnalysisPopup"),"display","none");a.style(a.byId("subLayerMenu.analysisSeparator"),"display","none");a.style(a.byId("subLayerMenu.layerInfo"),"display","none");a.style(a.byId("subLayerMenu.legendSeparator"),"display","none");f.byId("subLayerMenu");a.addClass(a.byId(b.baseId+"_"+b.folder.id+"_menu"),"calciteContextMenuSelected");c={target:a.byId(b.baseId+"_"+b.folder.id+"_menu"),obj:b};
c.preventDefault=c.stopPropagation=function(){};f.byId("subLayerMenu")._openMyself(c)},onSubLayerMenuClick:function(b,d){var c;if("string"===typeof b){var e=b;c=arcgisonline.map.main.getParameterListById(b);b=-1;a.forEach(this.mapLayers,function(a,c){a.id===e&&(b=c)});var g=d;c.layers?a.forEach(c.layers,function(a,b){a.id==g&&(d=b)}):a.forEach(c.layer.dynamicLayerInfos||c.layer.layerInfos,function(a,b){a.id==g&&(d=b)})}else c=this.mapLayers[b];var h=arcgisonline.map.featColl.isFeatureCollection(c),
k=null,n=!1,s=null,l=null,q=null;this._isKmlNetworkLinkFolder=!1;this._kmlAnalysisLayer=this._kmlFcollbycurfolder=null;var p=c.layer&&c.layer instanceof esri.layers.KMLLayer&&c.layer.folders;if(h)k=c.layers[d];else if(c.layer instanceof esri.layers.GeoRSSLayer)k=c.layer.getFeatureLayers()[d];else if(arcgisonline.map.main.hasDynamicLayers(c))k=c.layer.dynamicLayerInfos[d],esri.isDefined(k.source.mapLayerId)&&a.forEach(c.layer.layerInfos,function(a,b){a.id==k.source.mapLayerId&&(s=a.id,arcgisonline.map.main.getLayerInfo(c,
a.id).then(function(a){l=a.type}))},this),n=!0;else if(p){if(k=q=c.layer.folders[d],q=(this._kmlFcollbycurfolder=c.layer.getFeatureCollection(q.id))&&0<this._kmlFcollbycurfolder.length)this._kmlAnalysisLayer=c.layer}else k=c.layer.layerInfos[d];this.menuLayerPos=b;this.menuSubLayerPos=d;this.menuOpen=!0;this.isTable=!1;var m=h?!1:k&&k.subLayerIds&&0<k.subLayerIds.length,t=c.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer,u=t&&c.layer.supportsDynamicLayers,x=c.layer instanceof esri.layers.ArcGISTiledMapServiceLayer,
y=arcgisonline.sharing.util.isHostedService(c.url),r=c.layer instanceof esri.layers.GeoRSSLayer,n=arcgisonline.map.main.hasDynamicLayers(c);x&&(y&&!this.role.isAllowed("toc_menu_popup")&&!this.role.isAllowed("toc_menu_legend"))&&(a.removeClass(a.byId(c.id+"_"+k.id+"_menu"),"calciteContextMenu"),a.style(a.byId(c.id+"_"+k.id+"_menu"),"display","none"));var v=arcgisonline.map.popup.hasPopup(c,h||r?d:k.id);p&&(v=!1);a.style(a.byId("subLayerMenu.scale"),"display","none");a.style(a.byId("subLayerMenu.scaleSeparator"),
"display","none");a.style(a.byId("subLayerMenu.moveUp"),"display","none");a.style(a.byId("subLayerMenu.moveDown"),"display","none");a.style(a.byId("subLayerMenu.rename"),"display","none");a.style(a.byId("subLayerMenu.remove"),"display","none");a.style(a.byId("subLayerMenu.removeSeparator"),"display","none");a.style(a.byId("subLayerMenu.enablePopup"),"display","none");a.style(a.byId("subLayerMenu.removePopup"),"display","none");a.style(a.byId("subLayerMenu.configPopup"),"display","none");a.style(a.byId("subLayerMenu.editRenderer"),
"display","none");a.style(a.byId("subLayerMenu.smartMappingRenderer"),"display","none");a.style(a.byId("subLayerMenu.editLabels"),"display","none");a.style(a.byId("subLayerMenu.enableShowLegend"),"display","none");a.style(a.byId("subLayerMenu.disableShowLegend"),"display","none");a.style(a.byId("subLayerMenu.popupSeparator"),"display","none");a.style(a.byId("subLayerMenu.showAttrTable"),"display","none");a.style(a.byId("subLayerMenu.hideAttrTable"),"display","none");a.style(a.byId("subLayerMenu.filter"),
"display","none");a.style(a.byId("subLayerMenu.attrTableSeparator"),"display","none");a.style(a.byId("subLayerMenu.layerInfo"),"display",10>a.isIE?"inline":"");a.style(a.byId("subLayerMenu.performAnalysis"),"display","none");a.style(a.byId("subLayerMenu.performAnalysisPopup"),"display","none");a.style(a.byId("subLayerMenu.analysisSeparator"),"display","none");(t||p)&&!this.role.isAllowed("toc_menu_move")&&!this.role.isAllowed("toc_menu_rename")&&!this.role.isAllowed("toc_menu_remove")?a.style(a.byId("subLayerMenu.legendSeparator"),
"display","none"):h||x?a.style(a.byId("subLayerMenu.legendSeparator"),"display","none"):a.style(a.byId("subLayerMenu.legendSeparator"),"display","");arcgisonline.map.main.getLayerInfoForQuery(c,esri.isDefined(s)?s:k.id,k.subLayerIds).then(a.hitch(this,function(b){if(c.layer instanceof esri.layers.ArcGISTiledMapServiceLayer&&c.itemLayers||!(esri.isDefined(s)&&s!==b.id||!esri.isDefined(s)&&k.id!==b.id)){var d=b.url&&-1<b.url.toLowerCase().indexOf("/mapserver")&&-1==b.url.toLowerCase().indexOf("/featureserver"),
e=b.capabilities&&b.capabilities.toLowerCase(),d=e&&(!d&&-1<e.indexOf("query")||d&&-1<e.indexOf("query")&&-1<e.indexOf("data"));if(b&&("Feature Layer"===b.type&&(d||!e&&c.identify))&&this.role.isAllowed("toc_menu_popup"))v?a.style(a.byId("subLayerMenu.removePopup"),"display",10>a.isIE?"inline":""):a.style(a.byId("subLayerMenu.enablePopup"),"display",10>a.isIE?"inline":""),a.style(a.byId("subLayerMenu.configPopup"),"display",10>a.isIE?"inline":""),a.style(a.byId("subLayerMenu.popupSeparator"),"display",
10>a.isIE?"inline":"");b&&(u&&!n)&&(l=b.type,"Feature Layer"==l&&(b=arcgisonline.sharing.util.urlToObject(document.URL),b.query&&b.query.oldSymbols&&a.style(a.byId("subLayerMenu.editRenderer"),"display",10>a.isIE?"inline":"")))}}),function(){});this.role.isAllowed("toc_menu_labels")&&(c.layers&&k.labelingInfo&&arcgisonline.map.labels.hasLayer(k)?f.byId("subLayerMenu.editLabels").set("label",this.i18n.manageLabels):f.byId("subLayerMenu.editLabels").set("label",this.i18n.createLabels));var w=!1;if(q)w=
!0;else if(h||r)w=!0;q=f.byId("subLayerMenu");a.forEach(q.getChildren(),function(b,e){if("dijit.MenuSeparator"!==b.declaredClass)if(-1<b.id.indexOf("subLayerMenu.scale")&&this.role.isAllowed("toc_menu_visibilityRange")&&(h||r||u)&&!p)a.style(a.byId("subLayerMenu.scale"),"display",10>a.isIE?"inline":""),a.style(a.byId("subLayerMenu.scaleSeparator"),"display",10>a.isIE?"inline":"");else if(-1<b.id.indexOf("subLayerMenu.configPopup")&&this.role.isAllowed("toc_menu_popup")&&!m&&w&&!p)a.style(a.byId("subLayerMenu.configPopup"),
"display",10>a.isIE?"inline":""),a.style(a.byId("subLayerMenu.popupSeparator"),"display",10>a.isIE?"inline":"");else if(-1<b.id.indexOf("subLayerMenu.enablePopup")&&this.role.isAllowed("toc_menu_popup")&&!v&&!m&&(w||x)&&!p)c.itemId&&x&&y&&!c.queryServiceUrl?arcgisonline.map.main.getServiceToServiceFS(c,function(){},function(){a.style(a.byId("subLayerMenu.enablePopup"),"display",10>a.isIE?"inline":"");a.style(a.byId("subLayerMenu.popupSeparator"),"display",10>a.isIE?"inline":"")}):(a.style(a.byId("subLayerMenu.enablePopup"),
"display",10>a.isIE?"inline":""),a.style(a.byId("subLayerMenu.popupSeparator"),"display",10>a.isIE?"inline":""));else if(-1<b.id.indexOf("subLayerMenu.removePopup")&&this.role.isAllowed("toc_menu_popup")&&v)a.style(a.byId("subLayerMenu.removePopup"),"display",10>a.isIE?"inline":""),a.style(a.byId("subLayerMenu.popupSeparator"),"display",10>a.isIE?"inline":"");else if("subLayerMenu.moveUp"===b.id&&this.role.isAllowed("toc_menu_move")&&u){if(0<d){b.set("disabled",!1);var g=function(c){a.forEach(c,function(a){a.subLayerIds&&
(a.subLayerIds.length&&a.subLayerIds[0]===k.id)&&b.set("disabled",!0)})};c.itemLayers?g(c.itemLayers):arcgisonline.map.main.hasDynamicLayers(c)?g(c.layer.dynamicLayerInfos):g(c.layer.layerInfos)}else b.set("disabled",!0);a.style(a.byId("subLayerMenu.moveUp"),"display",10>a.isIE?"inline":"")}else if("subLayerMenu.moveDown"===b.id&&this.role.isAllowed("toc_menu_move")&&u)a.style(a.byId("subLayerMenu.moveDown"),"display",10>a.isIE?"inline":""),b.set("disabled",!1),g=function(c){if(c[c.length-1].id===
k.id)b.set("disabled",!0);else{var d=0;a.forEach(c,function(a){a.subLayerIds&&(a.subLayerIds.length&&a.subLayerIds[a.subLayerIds.length-1]===k.id)&&b.set("disabled",!0);-1===a.parentLayerId&&(d=a.id)});d===k.id&&b.set("disabled",!0)}},arcgisonline.map.main.hasDynamicLayers(c)?g(c.layer.dynamicLayerInfos):g(c.layer.layerInfos);else if("subLayerMenu.rename"===b.id&&this.role.isAllowed("toc_menu_rename")&&u)a.style(a.byId("subLayerMenu.rename"),"display",10>a.isIE?"inline":""),a.style(a.byId("subLayerMenu.removeSeparator"),
"display",10>a.isIE?"inline":"");else if("subLayerMenu.remove"===b.id&&this.role.isAllowed("toc_menu_remove")&&(h&&!c.itemId||u))a.style(a.byId("subLayerMenu.remove"),"display",10>a.isIE?"inline":""),a.style(a.byId("subLayerMenu.removeSeparator"),"display",10>a.isIE?"inline":"");else if(-1<b.id.indexOf("subLayerMenu.editRenderer")){if(g=arcgisonline.sharing.util.urlToObject(document.URL),g.query&&g.query.oldSymbols&&(h&&c.layers||r||u&&"Feature Layer"===l&&!m))a.style(a.byId("subLayerMenu.editRenderer"),
"display",10>a.isIE?"inline":"")}else if(-1<b.id.indexOf("subLayerMenu.editLabels")&&this.role.isAllowed("toc_menu_labels"))h&&a.style(a.byId("subLayerMenu.editLabels"),"display",10>a.isIE?"inline":"");else if(-1<b.id.indexOf("subLayerMenu.enableShowLegend")&&this.role.isAllowed("toc_menu_legend"))if(h)g=c.layers[d],c.layers&&!1===g.__showLegend?a.style(a.byId("subLayerMenu.enableShowLegend"),"display",10>a.isIE?"inline":""):!c.layers&&!1===c.showLegend&&a.style(a.byId("subLayerMenu.enableShowLegend"),
"display",10>a.isIE?"inline":"");else if(r)g=c.layer.getFeatureLayers()[d],!1===g.__showLegend&&a.style(a.byId("subLayerMenu.enableShowLegend"),"display",10>a.isIE?"inline":"");else{if(c.itemLayers)for(g=0;g<c.itemLayers.length;g++){var f=c.itemLayers[g];if(f.id===k.id){!1===f.showLegend&&a.style(a.byId("subLayerMenu.enableShowLegend"),"display",10>a.isIE?"inline":"");break}}}else if(-1<b.id.indexOf("subLayerMenu.disableShowLegend")&&this.role.isAllowed("toc_menu_legend"))if(h)g=c.layers[d],c.layers&&
!1!==g.__showLegend?a.style(a.byId("subLayerMenu.disableShowLegend"),"display",10>a.isIE?"inline":""):!c.layers&&!1!==c.showLegend&&(a.style(a.byId("subLayerMenu.disableShowLegend"),"display",10>a.isIE?"inline":""),a.style(a.byId("subLayerMenu.legendSeparator"),"display",10>a.isIE?"inline":""));else if(r)g=c.layer.getFeatureLayers()[d],!1!==g.__showLegend&&a.style(a.byId("subLayerMenu.disableShowLegend"),"display",10>a.isIE?"inline":"");else if(c.itemLayers){for(var n=!1,g=0;g<c.itemLayers.length;g++)if(f=
c.itemLayers[g],f.id===k.id){!1!==f.showLegend&&a.style(a.byId("subLayerMenu.disableShowLegend"),"display",10>a.isIE?"inline":"");n=!0;break}n||a.style(a.byId("subLayerMenu.disableShowLegend"),"display",10>a.isIE?"inline":"")}else p||a.style(a.byId("subLayerMenu.disableShowLegend"),"display",10>a.isIE?"inline":"");else-1<b.id.indexOf("subLayerMenu.layerInfo")&&(h||r||y||p)?(a.style(a.byId("subLayerMenu.layerInfo"),"display","none"),y?!c.itemLayers&&!c.queryServiceUrl?"none"===a.style(a.byId("subLayerMenu.performAnalysis"),
"display")&&a.style(a.byId("subLayerMenu.legendSeparator"),"display","none"):(n=!1,a.forEach(c.itemLayers,function(a){a.id===k.id&&(n=!0)}),n||a.style(a.byId("subLayerMenu.legendSeparator"),"display","none")):p&&a.style(a.byId("subLayerMenu.legendSeparator"),"display","none")):b.set("disabled",!1)},this);a.addClass(a.byId(c.id+"_"+k.id+"_menu"),"calciteContextMenuSelected");t={target:a.byId(c.id+"_"+k.id+"_menu")};t.preventDefault=t.stopPropagation=function(){};var z=!1;a.forEach(q.getChildren(),
function(b,c){"none"!==a.style(b.domNode,"display")&&(z=!0)});z||(a.byId(c.id+"_"+k.id+"_toolSeparator")&&a.style(a.byId(c.id+"_"+k.id+"_toolSeparator"),"display","none"),a.style(a.byId(c.id+"_"+k.id+"_menu"),"display","none"));"none"!==a.style(a.byId(c.id+"_"+k.id+"_menu"),"display")&&z&&f.byId("subLayerMenu")._openMyself(t)},onTableMenuClick:function(b){arcgisonline.sharing.util.getUser();var d;if("string"===typeof b){var c=b;b=-1;a.forEach(this.mapTables,function(a,e){a.id===c&&(b=e,d=a)})}else d=
this.mapTables[b];this.menuLayerPos=b;var e=arcgisonline.map.popup.hasPopup(d);this.menuSubLayerPos=-1;this.isTable=this.menuOpen=!0;a.style(a.byId("layerMenu.zoomTo"),"display","none");a.style(a.byId("layerMenu.layerTransp"),"display","none");a.style(a.byId("layerMenu.moveSeparator"),"display","none");a.style(a.byId("layerMenu.moveUp"),"display","none");a.style(a.byId("layerMenu.moveDown"),"display","none");a.style(a.byId("layerMenu.rename"),"display","none");a.style(a.byId("layerMenu.remove"),"display",
"none");a.style(a.byId("layerMenu.editsSeparator"),"display","none");a.style(a.byId("layerMenu.scale"),"display","none");a.style(a.byId("layerMenu.streaming"),"display","none");a.style(a.byId("layerMenu.filterEdits"),"display","none");a.style(a.byId("layerMenu.showAllEdits"),"display","none");a.style(a.byId("layerMenu.enablePopup"),"display","none");a.style(a.byId("layerMenu.removePopup"),"display","none");a.style(a.byId("layerMenu.configPopup"),"display","none");a.style(a.byId("layerMenu.enableTime"),
"display","none");a.style(a.byId("layerMenu.disableTime"),"display","none");a.style(a.byId("layerMenu.routeToAll"),"display","none");a.style(a.byId("layerMenu.editRenderer"),"display","none");a.style(a.byId("layerMenu.smartMappingRenderer"),"display","none");a.style(a.byId("layerMenu.editLabels"),"display","none");a.style(a.byId("layerMenu.editRenderingRule"),"display","none");a.style(a.byId("layerMenu.multidimensionalFilter"),"display","none");a.style(a.byId("layerMenu.enableDimension"),"display",
"none");a.style(a.byId("layerMenu.disableDimension"),"display","none");a.style(a.byId("layerMenu.editMosaicRule"),"display","none");a.style(a.byId("layerMenu.editImageProperties"),"display","none");a.style(a.byId("layerMenu.enableEditing"),"display","none");a.style(a.byId("layerMenu.disableEditing"),"display","none");a.style(a.byId("layerMenu.enableShowLegend"),"display","none");a.style(a.byId("layerMenu.disableShowLegend"),"display","none");a.style(a.byId("layerMenu.reviewGeocode"),"display","none");
a.style(a.byId("layerMenu.saveProps"),"display","none");a.style(a.byId("layerMenu.saveAsItem"),"display","none");a.style(a.byId("layerMenu.performAnalysis"),"display","none");a.style(a.byId("layerMenu.performAnalysisPopup"),"display","none");a.style(a.byId("layerMenu.analysisSeparator"),"display","none");d.itemId&&d.itemCard?f.byId("layerMenu.layerInfo").set("label",this.i18n.showItemDetails):f.byId("layerMenu.layerInfo").set("label",this.i18n.description);a.style(a.byId("layerMenu.popupSeparator"),
"display","none");a.style(a.byId("layerMenu.filterSeparator"),"display","none");a.style(a.byId("layerMenu.showAttrTable"),"display","none");a.style(a.byId("layerMenu.hideAttrTable"),"display","none");a.style(a.byId("layerMenu.filter"),"display","none");a.style(a.byId("layerMenu.refreshInterval"),"display","none");a.style(a.byId("layerMenu.attrTableSeparator"),"display","none");a.style(a.byId("layerMenu.copy"),"display","none");var g=f.byId("layerMenu");a.forEach(g.getChildren(),function(b){"dijit.MenuSeparator"!==
b.declaredClass&&(-1<b.id.indexOf("layerMenu.rename")&&this.role.isAllowed("toc_menu_rename")?(a.style(a.byId("layerMenu.rename"),"display",""),a.style(a.byId("layerMenu.editsSeparator"),"display","")):-1<b.id.indexOf("layerMenu.removePopup")&&this.role.isAllowed("toc_menu_popup")&&e?(a.style(a.byId("layerMenu.removePopup"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.popupSeparator"),"display",10>a.isIE?"inline":"")):-1<b.id.indexOf("layerMenu.remove")&&this.role.isAllowed("toc_menu_remove")?
(a.style(a.byId("layerMenu.remove"),"display",""),a.style(a.byId("layerMenu.editsSeparator"),"display",""),b.set("disabled",!1)):-1<b.id.indexOf("layerMenu.configPopup")&&this.role.isAllowed("toc_menu_popup")?(a.style(a.byId("layerMenu.configPopup"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.popupSeparator"),"display",10>a.isIE?"inline":"")):-1<b.id.indexOf("layerMenu.enablePopup")&&this.role.isAllowed("toc_menu_popup")&&!e?(a.style(a.byId("layerMenu.enablePopup"),"display",10>a.isIE?
"inline":""),a.style(a.byId("layerMenu.popupSeparator"),"display",10>a.isIE?"inline":"")):-1<b.id.indexOf("layerMenu.enableEditing")&&this.role.isAllowed("toc_menu_editing")?!d.layer.isEditable()&&(d.serviceInfo&&d.serviceInfo._origCapabilities)&&(a.style(a.byId("layerMenu.enableEditing"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.popupSeparator"),"display",10>a.isIE?"inline":"")):-1<b.id.indexOf("layerMenu.disableEditing")&&this.role.isAllowed("toc_menu_editing")&&(d.layer&&d.layer.isEditable())&&
(a.style(a.byId("layerMenu.disableEditing"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.popupSeparator"),"display",10>a.isIE?"inline":"")))},this);g={target:a.byId(d.id+"_menu")};g.preventDefault=g.stopPropagation=function(){};f.byId("layerMenu")._openMyself(g)},onSubTableMenuClick:function(b,d){arcgisonline.sharing.util.getUser();var c,e;if("string"===typeof b){var g=b;b=-1;a.forEach(this.mapLayers,function(a,d){a.id===g&&(b=d,c=a)})}else c=this.mapLayers[b];this.menuLayerPos=b;var h=
arcgisonline.map.featColl.isFeatureCollection(c),k=arcgisonline.map.popup.hasPopup(c,d),n=c.layers?c.layers.length:0;a.forEach(c.tables,function(a,b){a.id===d&&(this.menuSubLayerPos=b+n,e=a)},this);this.menuOpen=!0;a.style(a.byId("subLayerMenu.scale"),"display","none");a.style(a.byId("subLayerMenu.scaleSeparator"),"display","none");a.style(a.byId("subLayerMenu.moveUp"),"display","none");a.style(a.byId("subLayerMenu.moveDown"),"display","none");a.style(a.byId("subLayerMenu.rename"),"display","none");
a.style(a.byId("subLayerMenu.remove"),"display","none");a.style(a.byId("subLayerMenu.removeSeparator"),"display","none");a.style(a.byId("subLayerMenu.enablePopup"),"display","none");a.style(a.byId("subLayerMenu.removePopup"),"display","none");a.style(a.byId("subLayerMenu.configPopup"),"display","none");a.style(a.byId("subLayerMenu.editRenderer"),"display","none");a.style(a.byId("subLayerMenu.smartMappingRenderer"),"display","none");a.style(a.byId("subLayerMenu.editLabels"),"display","none");a.style(a.byId("subLayerMenu.enableShowLegend"),
"display","none");a.style(a.byId("subLayerMenu.disableShowLegend"),"display","none");a.style(a.byId("subLayerMenu.popupSeparator"),"display","none");a.style(a.byId("subLayerMenu.showAttrTable"),"display","none");a.style(a.byId("subLayerMenu.hideAttrTable"),"display","none");a.style(a.byId("subLayerMenu.filter"),"display","none");a.style(a.byId("subLayerMenu.attrTableSeparator"),"display","none");a.style(a.byId("subLayerMenu.layerInfo"),"display","none");a.style(a.byId("subLayerMenu.performAnalysis"),
"display","none");a.style(a.byId("subLayerMenu.performAnalysisPopup"),"display","none");a.style(a.byId("subLayerMenu.analysisSeparator"),"display","none");a.style(a.byId("subLayerMenu.legendSeparator"),"display","none");var s=f.byId("subLayerMenu");a.forEach(s.getChildren(),function(b){"dijit.MenuSeparator"!==b.declaredClass&&(-1<b.id.indexOf("subLayerMenu.removePopup")&&this.role.isAllowed("toc_menu_popup")&&k?a.style(a.byId("subLayerMenu.removePopup"),"display",10>a.isIE?"inline":""):-1<b.id.indexOf("subLayerMenu.remove")&&
this.role.isAllowed("toc_menu_remove")&&h&&!c.itemId?(a.style(a.byId("subLayerMenu.remove"),"display",""),a.style(a.byId("subLayerMenu.removeSeparator"),"display",""),b.set("disabled",!1)):-1<b.id.indexOf("subLayerMenu.configPopup")&&this.role.isAllowed("toc_menu_popup")?a.style(a.byId("subLayerMenu.configPopup"),"display",10>a.isIE?"inline":""):-1<b.id.indexOf("subLayerMenu.enablePopup")&&this.role.isAllowed("toc_menu_popup")&&!k?a.style(a.byId("subLayerMenu.enablePopup"),"display",10>a.isIE?"inline":
""):-1<b.id.indexOf("subLayerMenu.enableEditing")&&this.role.isAllowed("toc_menu_editing")?!e.isEditable()&&(c.serviceInfo&&c.serviceInfo._origCapabilities)&&a.style(a.byId("subLayerMenu.enableEditing"),"display",10>a.isIE?"inline":""):-1<b.id.indexOf("layerMenu.disableEditing")&&this.role.isAllowed("toc_menu_editing")&&e&&e.isEditable()&&a.style(a.byId("subLayerMenu.disableEditing"),"display",10>a.isIE?"inline":""))},this);a.addClass(a.byId(c.id+"_"+d+"_menu"),"calciteContextMenuSelected");var l=
{target:a.byId(c.id+"_"+d+"_menu")};l.preventDefault=l.stopPropagation=function(){};var q=!1;a.forEach(s.getChildren(),function(b,c){"none"!==a.style(b.domNode,"display")&&(q=!0)});q||(a.byId(c.id+"_"+d+"_toolSeparator")&&a.style(a.byId(c.id+"_"+d+"_toolSeparator"),"display","none"),a.style(a.byId(c.id+"_"+d+"_menu"),"display","none"));"none"!==a.style(a.byId(c.id+"_"+d+"_menu"),"display")&&q&&f.byId("subLayerMenu")._openMyself(l)},onOpenDlg:function(b){esriGeowConfig.isRightToLeft?a.addClass(b,"dijitTooltipDialog dijitTooltipABRight dijitTooltipLeft"):
a.addClass(b,"dijitTooltipDialog dijitTooltipABLeft dijitTooltipRight");a.forEach(a.query(".dijitTooltipConnector"),function(b){a.style(b,"top","6px")})},zoomTo:function(){var b=this.mapLayers[this.menuLayerPos],d=function(c){c&&(arcgisonline.map.main.sameSpatialReference(arcgisonline.map.main.map.spatialReference,c.spatialReference)?arcgisonline.map.main.zoomMapConsiderScale(b,c,!0):arcgisonline.map.main.projectToMapSpatialReference(c,a.hitch(this,function(a,d){a&&(0<a.length&&a[0]&&"extent"==a[0].type)&&
(c=a[0],arcgisonline.map.main.zoomMapConsiderScale(b,c,!0))})))};if(arcgisonline.map.featColl.isFeatureCollection(b))d(arcgisonline.map.featColl.getFullExtent(b));else if(b.layer instanceof esri.layers.FeatureLayer&&(arcgisonline.sharing.util.isHostedService(b.url)||b.serviceInfo&&b.serviceInfo.advancedQueryCapabilities&&b.serviceInfo.advancedQueryCapabilities.supportsReturningQueryExtent)){var c=new esri.tasks.QueryTask(b.url),e=new esri.tasks.Query,g=b.layer.getDefinitionExpression();e.where=g?
g:"1\x3d1";e.outSpatialReference=arcgisonline.map.main.map.spatialReference;c.executeForExtent(e,a.hitch(this,function(a,c){a.extent&&a.extent instanceof esri.geometry.Extent?d(a.extent):a.extent?d(new esri.geometry.Extent(a.extent)):(console.log("no features match where clause"),d(b.layer.fullExtent))}),a.hitch(this,function(a){console.log("could not get extent of feature layer that has supportsReturningQueryExtent.",a);d(b.layer.fullExtent)}))}else d(b.layer.fullExtent)},moveUp:function(){var b=
this.mapLayers[this.menuLayerPos];if(-1<this.menuSubLayerPos)arcgisonline.map.dynLayer.moveUpLayer(b,this.menuSubLayerPos),this.refreshTOCAndReopen();else{if("mapNotes"===b.type){for(var d=-1,c=this.menuLayerPos+1;c<this.mapLayers.length;c++)if("mapNotes"===this.mapLayers[c].type){d=c;break}if(-1<d){for(var e=-1,c=0;c<arcgisonline.map.main.map.graphicsLayerIds.length;c++)if(-1<arcgisonline.map.main.map.graphicsLayerIds[c].indexOf(this.mapLayers[d].id)){e=c;break}-1<e&&a.forEach(b.layers,function(a){arcgisonline.map.main.map.reorderLayer(a.id,
e+3)},this);c=this.mapLayers[d];this.mapLayers[d]=this.mapLayers[this.menuLayerPos];this.mapLayers[this.menuLayerPos]=c}}else{var g=1;this.mapLayers[this.menuLayerPos+1].layers?g=this.mapLayers[this.menuLayerPos+1].layers.length:this.mapLayers[this.menuLayerPos+1].layer instanceof esri.layers.GeoRSSLayer&&(g=this.mapLayers[this.menuLayerPos+1].layer.getFeatureLayers().length);c=this.mapLayers[this.menuLayerPos+1];this.mapLayers[this.menuLayerPos+1]=this.mapLayers[this.menuLayerPos];this.mapLayers[this.menuLayerPos]=
c;var f=!1;b.layers?(d=a.indexOf(arcgisonline.map.main.map.graphicsLayerIds,b.layers[b.layers.length-1].id),-1<d&&a.forEach(b.layers,function(a,b){arcgisonline.map.main.map.reorderLayer(a.id,d+g);arcgisonline.map.labels.hasLayer(a)&&(f=!0)},this)):b.layer instanceof esri.layers.GeoRSSLayer?(b=b.layer.getFeatureLayers(),d=a.indexOf(arcgisonline.map.main.map.graphicsLayerIds,b[b.length-1].id),-1<d&&a.forEach(b,function(a,b){arcgisonline.map.main.map.reorderLayer(a.id,d+g);arcgisonline.map.labels.hasLayer(a)&&
(f=!0)},this)):(d=a.indexOf(arcgisonline.map.main.map.layerIds,b.id),-1<d?arcgisonline.map.main.map.reorderLayer(b.id,d+g):(d=a.indexOf(arcgisonline.map.main.map.graphicsLayerIds,b.id),-1<d&&arcgisonline.map.main.map.reorderLayer(b.id,d+g)),arcgisonline.map.labels.hasLayer(b.layer)&&(f=!0));f&&arcgisonline.map.labels.orderLayers()}this.loadTOC()}arcgisonline.map.main.markMapAsChangedIfOwner("moveUp")},moveDown:function(){var b=this.mapLayers[this.menuLayerPos];if(-1<this.menuSubLayerPos)arcgisonline.map.dynLayer.moveDownLayer(b,
this.menuSubLayerPos),this.refreshTOCAndReopen();else{if("mapNotes"===b.type){for(var d=-1,c=this.menuLayerPos-1;0<c;c--)if("mapNotes"===this.mapLayers[c].type){d=c;break}if(-1<d){for(var e=-1,c=0;c<arcgisonline.map.main.map.graphicsLayerIds.length;c++)if(-1<arcgisonline.map.main.map.graphicsLayerIds[c].indexOf(this.mapLayers[d].id)){e=c;break}-1<e&&a.forEach(b.layers,function(a,b){arcgisonline.map.main.map.reorderLayer(a.id,e+b)},this);c=this.mapLayers[d];this.mapLayers[d]=this.mapLayers[this.menuLayerPos];
this.mapLayers[this.menuLayerPos]=c}}else{var g=1;this.mapLayers[this.menuLayerPos-1].layers?g=this.mapLayers[this.menuLayerPos-1].layers.length:this.mapLayers[this.menuLayerPos-1].layer instanceof esri.layers.GeoRSSLayer&&(g=this.mapLayers[this.menuLayerPos-1].layer.getFeatureLayers().length);c=this.mapLayers[this.menuLayerPos-1];this.mapLayers[this.menuLayerPos-1]=this.mapLayers[this.menuLayerPos];this.mapLayers[this.menuLayerPos]=c;var f=!1;b.layers?(d=a.indexOf(arcgisonline.map.main.map.graphicsLayerIds,
b.layers[0].id),0<d&&a.forEach(b.layers,function(a,b){arcgisonline.map.main.map.reorderLayer(a.id,d-(g-b));arcgisonline.map.labels.hasLayer(a)&&(f=!0)},this)):b.layer instanceof esri.layers.GeoRSSLayer?(b=b.layer.getFeatureLayers(),d=a.indexOf(arcgisonline.map.main.map.graphicsLayerIds,b[0].id),0<d&&a.forEach(b,function(a,b){arcgisonline.map.main.map.reorderLayer(a.id,d-(g-b));arcgisonline.map.labels.hasLayer(a)&&(f=!0)},this)):(d=a.indexOf(arcgisonline.map.main.map.layerIds,b.id),0<d?arcgisonline.map.main.map.reorderLayer(b.id,
d-g):(d=a.indexOf(arcgisonline.map.main.map.graphicsLayerIds,b.id),0<d&&arcgisonline.map.main.map.reorderLayer(b.id,d-g)),arcgisonline.map.labels.hasLayer(b.layer)&&(f=!0));f&&arcgisonline.map.labels.orderLayers()}this.loadTOC()}arcgisonline.map.main.markMapAsChangedIfOwner("moveDown")},rename:function(){var a=this.isTable?this.mapTables[this.menuLayerPos]:this.mapLayers[this.menuLayerPos];arcgisonline.sharing.dijit.dialog.RenameDlg.prototype.statics.getInstance().show(a,this.menuSubLayerPos)},remove:function(){if(this.isTable){var b=
this.mapTables[this.menuLayerPos];arcgisonline.map.table.isTableVisible(b.id)&&this.hideAttributeTable();b=this.mapTables.splice(this.menuLayerPos,1)[0];delete b.layer}else b=this.mapLayers[this.menuLayerPos],arcgisonline.map.table.isTableVisible(b.id)&&this.hideAttributeTable(),b=this.mapLayers.splice(this.menuLayerPos,1)[0],arcgisonline.map.popup.removePopupLayers(b),arcgisonline.map.main.recreateFLsForMS(b,esri.layers.FeatureLayer.MODE_ONDEMAND),b.layers?a.forEach(b.layers,function(a){arcgisonline.map.main.map.removeLayer(a);
arcgisonline.map.labels.removeLabelsForLayer(a)},this):b.layer&&(arcgisonline.map.main.map.removeLayer(b.layer),arcgisonline.map.labels.removeLabelsForLayer(b.layer),delete b.layer),arcgisonline.map.main.map.infoWindow.clearFeatures(),arcgisonline.map.main.map.infoWindow.hide();this.loadTOC();leftPanel&&leftPanel.clearLists();arcgisonline.map.main.markMapAsChanged("remove")},removeSubLayer:function(){var b=arcgisonline.map.main.mapLayers[this.menuLayerPos];if(b.layers||b.tables){var d=b.layers;b.tables&&
(d=d.concat(b.tables));var c=d[this.menuSubLayerPos];if(c)if(1==d.length)this.remove();else{if("Table"===c.type)b.tables.splice(this.menuSubLayerPos-(b.layers?b.layers.length:0),1),b.tables.length||delete b.tables;else if(b.layers.splice(this.menuSubLayerPos,1),arcgisonline.map.main.map.removeLayer(c),esri.isDefined(b.visibleLayers))if(""===b.visibleLayers)b.visibleLayers=[];else{var d=b.visibleLayers.split(","),e=[];a.forEach(d,function(a){a=parseInt(a);a<this.menuSubLayerPos?e.push(a):a>this.menuSubLayerPos&&
e.push(a-1)},this);!b.itemId&&e.length==b.layers.length?delete b.visibleLayers:b.visibleLayers=e.toString()}!b.tables&&(b.layers&&1===b.layers.length)&&(b.layer=b.layers[0],delete b.layers);this.refreshTOCAndReopen();arcgisonline.map.main.markMapAsChanged("removeSubLayer")}}else arcgisonline.map.dynLayer.removeDynamicLayer(b,this.menuSubLayerPos),b.itemLayers.length?this.refreshTOCAndReopen():this.remove(),arcgisonline.map.main.markMapAsChanged("removeSubLayer")},copy:function(){arcgisonline.map.copy.copyLayer(this.isTable?
this.mapTables[this.menuLayerPos]:this.mapLayers[this.menuLayerPos])},startStopStream:function(){var b=this.mapLayers[this.menuLayerPos];b.layer.socket?(b.layer.suspend(),b.layer.clear(),b.layer.disconnect(),a.byId("layerMenu.startStopStream").innerHTML=this.i18n.startStreaming,a.style(a.byId("layerMenu.clearStreamDivEnabled"),"display","none"),a.style(a.byId("layerMenu.clearStreamDivDisabled"),"display",""),a.style(a.byId("layerMenu.spatialFilterStreamEnabled"),"display","none"),a.style(a.byId("layerMenu.spatialFilterStreamDisabled"),
"display","")):(b.layer.connect(),b.layer.resume(),a.byId("layerMenu.startStopStream").innerHTML=this.i18n.stopStreaming,a.style(a.byId("layerMenu.clearStreamDivEnabled"),"display",""),a.style(a.byId("layerMenu.clearStreamDivDisabled"),"display","none"),a.style(a.byId("layerMenu.spatialFilterStreamEnabled"),"display",""),a.style(a.byId("layerMenu.spatialFilterStreamDisabled"),"display","none"))},spatialFilterStream:function(){var b=this.mapLayers[this.menuLayerPos];if(b.layer.getFilter()&&b.layer.getFilter().geometry)b.layer.setFilter({geometry:null}),
b.layerDefinition.definitionGeometry&&(delete b.layerDefinition.definitionGeometry,esri.isEmpty(b.layerDefinition)&&delete b.layerDefinition),b.spatialFilterChanged=!0,a.byId("layerMenu.spatialFilterStream").innerHTML=this.i18n.limitObservations,a.byId("layerMenu.spatialFilterStreamDisabled").innerHTML=this.i18n.limitObservations;else{var d=new esri.geometry.Extent(arcgisonline.map.main.map.extent.toJson());b.layer.setFilter({geometry:d});b.layerDefinition=b.layerDefinition||{};b.layerDefinition.definitionGeometry=
d.toJson();b.spatialFilterChanged=!0;a.byId("layerMenu.spatialFilterStream").innerHTML=this.i18n.showAllObservations;a.byId("layerMenu.spatialFilterStreamDisabled").innerHTML=this.i18n.showAllObservations}},clearStream:function(){this.mapLayers[this.menuLayerPos].layer.clear()},saveAsItem:function(){var a=arcgisonline.map.main.mapLayers[this.menuLayerPos],d=(new f.Dialog).placeAt(document.body),c=new arcgisonline.sharing.dijit.dialog.AddItemFromLayerDlg({dialog:d});d.set({title:this.i18n.AddItemFromLayerDlg.title,
content:c});d.show();c.start(a)},layerTransp:function(){this.onOpenDlg(a.byId("layerMenu.layerTransparencyDlg"));var b=this.mapLayers[this.menuLayerPos],d=f.byId("layerMenu.opacitySlider");if(b.layers&&0<b.layers.length)d.set("value",100*(1-(b.layers[0].opacity||0===b.layers[0].opacity?b.layers[0].opacity:1)));else if(b.layer&&"esri.layers.KMLLayer"==b.layer.declaredClass){var c=function(a,b){for(var d=0;d<a.length;d++){var f=a[d];if("esri.layers.FeatureLayer"==f.declaredClass||"esri.layers.MapImageLayer"==
f.declaredClass){b.set("value",100*(1-(f.opacity||0===f.opacity?f.opacity:1)));return}}for(d=0;d<a.length;d++)if(f=a[d],"esri.layers.KMLLayer"==f.declaredClass){c(f.getLayers(),b);break}};c(b.layer.getLayers(),d)}else b.layer&&d.set("value",100*(1-(b.layer.opacity||0===b.layer.opacity?b.layer.opacity:1)))},setLayerOpacity:function(b){b=a.number.round(1-b/100,2);var d=this.mapLayers[this.menuLayerPos],c=0;d.layers?a.forEach(d.layers,function(a){c=a.opacity;a.setOpacity(b)},this):d.layer&&"esri.layers.KMLLayer"==
d.layer.declaredClass?(c=d.layer.opacity,d.layer.setOpacity(b)):d.layer&&"base"==d.type?(c=d.layer.opacity,a.forEach(this.mapLayers,function(a){("base"==a.type||"labels"==a.type)&&a.layer.setOpacity(b)})):(c=d.layer.opacity,d.layer.setOpacity(b));b!=c&&arcgisonline.map.main.markMapAsChangedIfOwner("setLayerOpacity");d.opacityChanged=!0},layerScale:function(){this.onOpenDlg(a.byId("layerMenu.layerScaleDlg"));var b=arcgisonline.map.main.mapLayers[this.menuLayerPos],d=arcgisonline.map.dijit.toc.scale.layerScale(this.menuLayerPos,
this.menuSubLayerPos,this.layerScaleSlider,this.subLayerScaleSlider);-1==this.menuSubLayerPos?(b=b.layer instanceof esri.layers.StreamLayer,d instanceof esri.layers.FeatureLayer&&!b?(a.style(this.tocLayerScaleSuggest,"display",""),a.byId("tocLayerScaleSuggestTool")&&a.style(a.byId("tocLayerScaleSuggestTool"),"display","")):(a.style(this.tocLayerScaleSuggest,"display","none"),a.byId("tocLayerScaleSuggestTool")&&a.style(a.byId("tocLayerScaleSuggestTool"),"display","none"))):d instanceof esri.layers.FeatureLayer||
-1<this.menuSubLayerPos&&b.layer?(a.style(this.tocSubLayerScaleSuggest,"display",""),a.byId("tocLayerScaleSuggestTool")&&a.style(a.byId("tocLayerScaleSuggestTool"),"display","")):(a.style(this.tocSubLayerScaleSuggest,"display","none"),a.byId("tocLayerScaleSuggestTool")&&a.style(a.byId("tocLayerScaleSuggestTool"),"display","none"))},onClickTocScaleSuggest:function(){arcgisonline.map.dijit.toc.scale.onClickTocScaleSuggest(this.menuLayerPos,this.menuSubLayerPos,this.layerScaleSlider,this.subLayerScaleSlider)},
isShowAllEdits:function(){return arcgisonline.map.dijit.toc.filterEdits.isShowAllEdits(this.mapLayers[this.menuLayerPos])},showAllEdits:function(){arcgisonline.map.dijit.toc.filterEdits.showAllEdits(this.mapLayers[this.menuLayerPos])},filterEdits:function(){arcgisonline.map.dijit.toc.filterEdits.filterEdits(this.mapLayers[this.menuLayerPos])},editRenderingRule:function(){arcgisonline.map.leftPanel.openLeftRenderingRulePanel(this.mapLayers[this.menuLayerPos])},editMosaicRule:function(){arcgisonline.map.leftPanel.openLeftMosaicRulePanel(this.mapLayers[this.menuLayerPos])},
editImageProperties:function(){arcgisonline.map.dijit.toc.image.editImageProperties(this.mapLayers[this.menuLayerPos])},onPerformanceQualitySlider:function(a){arcgisonline.map.dijit.toc.image.onPerformanceQualitySlider(a,this.mapLayers[this.menuLayerPos])},multidimensionalFilter:function(){arcgisonline.map.leftPanel.openLeftMultidimensionalFilterPanel(this.mapLayers[this.menuLayerPos])},showLayerDescription:function(){var a=this.isTable?this.mapTables[this.menuLayerPos]:this.mapLayers[this.menuLayerPos];
a.itemId&&a.itemCard?window.open("../item.html?id\x3d"+a.itemId):a.layer instanceof esri.layers.WMSLayer?window.open(a.url+(-1<a.url.indexOf("?")?"\x26":"?")+"SERVICE\x3dWMS\x26REQUEST\x3dGetCapabilities"):"base"===a.type?this._showBasemapDescription():this._openServiceUrl()},_showBasemapDescription:function(){var b=this.mapLayers[this.menuLayerPos];if(this.basemapGalleryItems){for(var d=!1,c=0;c<this.basemapGalleryItems.length;c++)if(this.basemapGalleryItems[c].title==b.title){window.open("../item.html?id\x3d"+
this.basemapGalleryItems[c].id);d=!0;break}d||this._openServiceUrl()}else{var e=function(a,c){if(a.results&&0<a.results.length){this.basemapGalleryItems=a.results;for(var d=!1,e=0;e<this.basemapGalleryItems.length;e++)if(this.basemapGalleryItems[e].title==b.title){window.open("../item.html?id\x3d"+this.basemapGalleryItems[e].id);d=!0;break}d||this._openServiceUrl()}else this._openServiceUrl()},d=function(b,c){b&&0<b.total?arcgisonline.sharing.geow.Content.search(esriGeowConfig.restBaseUrl+"search",
{q:"group:"+b.results[0].id+' AND (type:"web map" -type:"web mapping application")',num:"50"},a.hitch(this,e),a.hitch(this,e)):this._openServiceUrl()};arcgisonline.sharing.geow.Community.searchGroups(esriGeowConfig.basemapGalleryGroupQuery,a.hitch(this,d),a.hitch(this,d))}},_openServiceUrl:function(){var a=(this.isTable?this.mapTables[this.menuLayerPos]:this.mapLayers[this.menuLayerPos]).url;if(arcgisonline.sharing.util.isHostedService(a)){var d=arcgisonline.sharing.util.getToken();d&&(a+="?token\x3d"+
d)}window.open(a)},showSubLayerDescription:function(){var a=this.mapLayers[this.menuLayerPos];window.open(a.url+"/"+a.layer.layerInfos[this.menuSubLayerPos].id)},showAttributeTable:function(b,d){arcgisonline.map.dijit.toc.options.closeToolTipDialogs();var c;if(b){c=arcgisonline.map.main.getParameterListById(b);var e=-1;if(b&&esri.isDefined(d))if(c=arcgisonline.map.main.getParameterListById(b),c.layers||c.tables){var g=c.layers;c.tables&&(g=g.concat(c.tables));a.forEach(g,function(a,b){a.id==d&&(e=
b)})}else c.layer&&a.forEach(c.layer.dynamicLayerInfos||c.layer.layerInfos,function(a,b){a.id==d&&(e=b)});arcgisonline.map.table.toc_showAttributeTable(c,e)}else c=this.isTable?this.mapTables[this.menuLayerPos]:this.mapLayers[this.menuLayerPos],arcgisonline.map.table.toc_showAttributeTable(c,this.menuSubLayerPos)},hideAttributeTable:function(b,d){arcgisonline.map.dijit.toc.options.closeToolTipDialogs();var c;if(b){c=arcgisonline.map.main.getParameterListById(b);var e=-1;if(b&&esri.isDefined(d))if(c=
arcgisonline.map.main.getParameterListById(b),c.layers||c.tables){var g=c.layers;c.tables&&(g=g.concat(c.tables));a.forEach(g,function(a,b){a.id==d&&(e=b)})}else a.forEach(c.layer.dynamicLayerInfos||c.layer.layerInfos,function(a,b){a.id==d&&(e=b)});arcgisonline.map.table.toc_hideAttributeTable(c,e)}else c=this.isTable?this.mapTables[this.menuLayerPos]:this.mapLayers[this.menuLayerPos],arcgisonline.map.table.toc_hideAttributeTable(c,this.menuSubLayerPos)},configurePopup:function(){var a=this.isTable?
this.mapTables[this.menuLayerPos]:this.mapLayers[this.menuLayerPos];if(arcgisonline.map.featColl.isFeatureCollection(a))arcgisonline.map.leftPanel.openLeftPopupPanel(a.id,this.menuSubLayerPos);else if(a.layer instanceof esri.layers.GeoRSSLayer)arcgisonline.map.leftPanel.openLeftPopupPanel(a.id,-1==this.menuSubLayerPos?0:this.menuSubLayerPos);else if(a.layer instanceof esri.layers.FeatureLayer||a.layer instanceof esri.layers.ArcGISImageServiceLayer||a.layer instanceof esri.layers.ArcGISImageServiceVectorLayer||
a.layer instanceof esri.layers.CSVLayer)arcgisonline.map.leftPanel.openLeftPopupPanel(a.id);else if(a.layer instanceof esri.layers.ArcGISTiledMapServiceLayer){var d=a.layer.layerInfos[this.menuSubLayerPos];arcgisonline.map.leftPanel.openLeftPopupPanel(a.id,d.id)}else arcgisonline.map.main.hasDynamicLayers(a)?-1==this.menuSubLayerPos?arcgisonline.map.leftPanel.openLeftPopupPanel(a.id,-1):(d=a.layer.dynamicLayerInfos[this.menuSubLayerPos],arcgisonline.map.leftPanel.openLeftPopupPanel(a.id,d.id)):(d=
a.layer.layerInfos[this.menuSubLayerPos],arcgisonline.map.leftPanel.openLeftPopupPanel(a.id,d.id))},enablePopup:function(){var a=this.isTable?this.mapTables[this.menuLayerPos]:this.mapLayers[this.menuLayerPos];!a&&this.isTable&&(a=this.mapLayers[this.menuLayerPos]);arcgisonline.map.popup.toc_enablePopup(a,this.menuSubLayerPos)},removePopup:function(){var a=this.isTable?this.mapTables[this.menuLayerPos]:this.mapLayers[this.menuLayerPos];!a&&this.isTable&&(a=this.mapLayers[this.menuLayerPos]);arcgisonline.map.popup.toc_removePopup(a,
this.menuSubLayerPos)},editRenderer:function(){arcgisonline.map.leftPanel.openLeftRendererPanel(this.mapLayers[this.menuLayerPos].id,this.menuSubLayerPos,!0)},smartMappingRenderer:function(b,d){arcgisonline.map.dijit.toc.options.closeToolTipDialogs();var c=-1;if(b&&esri.isDefined(d)){var e=arcgisonline.map.main.getParameterListById(b);e.layers?a.forEach(e.layers,function(a,b){a.id==d&&(c=b)}):a.forEach(e.layer.dynamicLayerInfos||e.layer.layerInfos,function(a,b){a.id==d&&(c=b)})}b?arcgisonline.map.leftPanel.openLeftRendererPanel(b,
c,!0,!0):arcgisonline.map.leftPanel.openLeftRendererPanel(this.mapLayers[this.menuLayerPos].id,this.menuSubLayerPos,!0,!0)},editLabels:function(){arcgisonline.map.leftPanel.openLeftRendererLabelsPanel(this.mapLayers[this.menuLayerPos],this.menuSubLayerPos)},enableEditing:function(){if(this.isTable){var a=this.mapTables[this.menuLayerPos];a.serviceInfo&&a.serviceInfo.capabilities&&a.serviceInfo._origCapabilities&&(a.serviceInfo.capabilities=a.serviceInfo._origCapabilities,delete a.serviceInfo._origCapabilities,
delete a.layer,a.layer=new esri.layers.FeatureLayer(a.url,{id:a.id,outFields:["*"],resourceInfo:a.serviceInfo}))}else arcgisonline.map.edit.toc_enableEditing(this.mapLayers[this.menuLayerPos])},disableEditing:function(){if(this.isTable){var a=this.mapTables[this.menuLayerPos];a.serviceInfo&&a.serviceInfo.capabilities&&(a.serviceInfo&&a.serviceInfo.capabilities)&&(a.serviceInfo._origCapabilities=a.serviceInfo.capabilities,a.serviceInfo.capabilities=arcgisonline.map.edit.removeEditCapabilities(a.serviceInfo.capabilities),
delete a.layer,a.layer=new esri.layers.FeatureLayer(a.url,{id:a.id,outFields:["*"],resourceInfo:a.serviceInfo}))}else arcgisonline.map.edit.toc_disableEditing(this.mapLayers[this.menuLayerPos])},enableShowLegend:function(){var b=this.mapLayers[this.menuLayerPos];if(-1<this.menuSubLayerPos){if(arcgisonline.map.featColl.isFeatureCollection(b))b.layers&&delete b.layers[this.menuSubLayerPos].__showLegend;else if(b.layer instanceof esri.layers.CSVLayer)delete b.layer.__showLegend;else if(b.layer instanceof
esri.layers.GeoRSSLayer)delete b.layer.getFeatureLayers()[-1<this.menuSubLayerPos?this.menuSubLayerPos:0].__showLegend;else{var d;d=arcgisonline.map.main.hasDynamicLayers(b)?b.layer.dynamicLayerInfos[this.menuSubLayerPos]:b.layer.layerInfos[this.menuSubLayerPos];for(var c=0;c<b.itemLayers.length;c++)if(b.itemLayers[c].id===d.id){delete b.itemLayers[c].showLegend;a.json.stringify(b.itemLayers[c])===a.json.stringify({id:d.id})&&b.itemLayers.splice(c,1);break}}a.style(a.byId("subLayerMenu.enableShowLegend"),
"display","none");a.style(a.byId("subLayerMenu.disableShowLegend"),"display",10>a.isIE?"inline":"")}else"base"==b.type||"labels"==b.type?b.showLegend=!0:delete b.showLegend,a.style(a.byId("layerMenu.enableShowLegend"),"display","none"),a.style(a.byId("layerMenu.disableShowLegend"),"display",10>a.isIE?"inline":"");leftPanel&&leftPanel.deleteLegendStack();(b.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer||b.layer instanceof esri.layers.ArcGISTiledMapServiceLayer)&&-1===this.menuSubLayerPos||
(b.legendChanged=!0);arcgisonline.map.main.markMapAsChanged("enableShowLegend")},disableShowLegend:function(){var b=this.mapLayers[this.menuLayerPos];if(-1<this.menuSubLayerPos){if(arcgisonline.map.featColl.isFeatureCollection(b))b.layers&&(b.layers[this.menuSubLayerPos].__showLegend=!1);else if(b.layer instanceof esri.layers.CSVLayer)b.layer.__showLegend=!1;else if(b.layer instanceof esri.layers.GeoRSSLayer)b.layer.getFeatureLayers()[-1<this.menuSubLayerPos?this.menuSubLayerPos:0].__showLegend=!1;
else{var d;d=arcgisonline.map.main.hasDynamicLayers(b)?b.layer.dynamicLayerInfos[this.menuSubLayerPos]:b.layer.layerInfos[this.menuSubLayerPos];if(b.itemLayers){for(var c=!1,e=0;e<b.itemLayers.length;e++)if(b.itemLayers[e].id===d.id){b.itemLayers[e].showLegend=!1;c=!0;break}c||b.itemLayers.push({id:d.id,showLegend:!1})}else b.itemLayers=[{id:d.id,showLegend:!1}]}a.style(a.byId("subLayerMenu.enableShowLegend"),"display",10>a.isIE?"inline":"");a.style(a.byId("subLayerMenu.disableShowLegend"),"display",
"none")}else"base"==b.type||"labels"==b.type?delete b.showLegend:b.showLegend=!1,a.style(a.byId("layerMenu.enableShowLegend"),"display",10>a.isIE?"inline":""),a.style(a.byId("layerMenu.disableShowLegend"),"display","none");leftPanel&&leftPanel.deleteLegendStack();(b.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer||b.layer instanceof esri.layers.ArcGISTiledMapServiceLayer)&&-1===this.menuSubLayerPos||(b.legendChanged=!0);arcgisonline.map.main.markMapAsChanged("disableShowLegend")},configureAnalysis:function(b,
d,c){var e=this.menuSubLayerPos;d?(d=arcgisonline.map.main.getParameterListById(d),d.layer&&d.layer instanceof esri.layers.KMLLayer&&d.layer.folders?a.forEach(d.layer.folders,function(a,b){a.id===c&&(e=b)}):(e=-1,a.forEach(arcgisonline.map.main.mapLayers,function(a,b){}),esri.isDefined(c)&&(d.layers?a.forEach(d.layers,function(a,b){a.id==c&&(e=b)}):a.forEach(d.layer.dynamicLayerInfos||d.layer.layerInfos,function(a,b){a.id==c&&(e=b)})))):d=this.mapLayers[this.menuLayerPos];this.analysisObj.configureAnalysis(b,
{mapLayer:d,menuSubLayerPos:e,isKmlNetworkLinkFolder:this._isKmlNetworkLinkFolder,kmlFcollbycurfolder:this._kmlFcollbycurfolder,kmlAnalysisLayer:this._kmlAnalysisLayer})},prepConfigureAnalysis:function(b,d,c,e,g){if(e&&esri.isDefined(g)){c=arcgisonline.map.main.getParameterListById(e);b=a.filter(c.layer.folders,function(a){if(a.id===g)return a})[0];if((this._kmlFcollbycurfolder=c.layer.getFeatureCollection(b.id))&&0<this._kmlFcollbycurfolder.length)this._kmlAnalysisLayer=c.layer;this._isKmlNetworkLinkFolder=
!1}else b=this._kmlNetworkFlayers[b+"_"+d+"_"+c],this.menuLayerPos=c,this.menuSubLayerPos=b.folder.id,this._isKmlNetworkLinkFolder=this.menuOpen=!0,this._kmlFcollbycurfolder=b.kmlFcollbycurfolder,this._kmlAnalysisLayer=b.link,this._kmlAnalysisLayer.title=b.folder.name,this._kmlAnalysisLayer.name=this._kmlAnalysisLayer.title,this._kmlNetworkMenuId=b.baseId+"_"+b.folder.id+"_menu"},cancelAnalysis:function(a){this.analysisObj.cancelAnalysis(a)},filter:function(b,d){var c=this.menuSubLayerPos;arcgisonline.map.dijit.toc.options.closeToolTipDialogs();
var e;b?(e=arcgisonline.map.main.getParameterListById(b),c=-1,a.forEach(arcgisonline.map.main.mapLayers,function(a,b){}),esri.isDefined(d)&&(e.layers?a.forEach(e.layers,function(a,b){a.id==d&&(c=b)}):a.forEach(e.layer.dynamicLayerInfos||e.layer.layerInfos,function(a,b){a.id==d&&(c=b)}))):e=this.isTable?this.mapTables[this.menuLayerPos]:this.mapLayers[this.menuLayerPos];var g;-1<c?arcgisonline.map.main.hasDynamicLayers(e)?(g=e.layer.dynamicLayerInfos[c],arcgisonline.map.main.openFilterDlg(e,g)):(g=
e.layer.layerInfos[c],arcgisonline.map.main.getLayerInfoForQuery(e,g.id,g.subLayerIds).then(function(a){g=a;arcgisonline.map.main.openFilterDlg(e,g)})):(g=e.serviceInfo,arcgisonline.map.main.openFilterDlg(e,g))},onOpenRefreshInterval:function(){this.onOpenDlg(a.byId("layerMenu.refreshIntervalDlg"));this._displayRefreshInterval()},enableTime:function(){var a=this.mapLayers[this.menuLayerPos];a.layer.setUseMapTime(!0);a.timeChanged=!0;arcgisonline.map.time.checkOnTimeButton();arcgisonline.map.time.checkTimeSliderProperties()},
disableTime:function(){var a=this.mapLayers[this.menuLayerPos];a.layer.setUseMapTime(!1);a.timeChanged=!0;arcgisonline.map.time.checkOnTimeButton()},enableDimension:function(){var a=this.mapLayers[this.menuLayerPos];a.layer.useMapDimensionValue=!0;a.dimensionChanged=!0;arcgisonline.map.multiDimensions.addActiveDimension(a.layer);arcgisonline.map.multiDimensions.checkOnMdSliderButton()},disableDimension:function(){var a=this.mapLayers[this.menuLayerPos];a.layer.useMapDimensionValue=!1;a.dimensionChanged=
!0;arcgisonline.map.multiDimensions.removeActiveDimension(a.layer);arcgisonline.map.multiDimensions.disableDimensionAnimation(a.layer);arcgisonline.map.multiDimensions.checkOnMdSliderButton()},routeToAll:function(){var b=this.mapLayers[this.menuLayerPos],d=[],c=b.layer;if(b.layers)a.forEach(b.layers,function(a){"esriGeometryPoint"==a.geometryType&&!arcgisonline.map.main.isTextLayer(a)&&(c=a)});else if(b.layer instanceof esri.layers.GeoRSSLayer){var e=b.layer.getFeatureLayers();a.forEach(e,function(a){"esriGeometryPoint"==
a.geometryType&&(c=a)})}var g=c.graphics,e=a.filter(c.fields,function(a){return"sequence"===a.name.toLowerCase()});if(g.length&&e.length){var f=e[0].name,g=[];a.forEach(c.graphics,function(a){g.push(new esri.Graphic(a.geometry,null,a.attributes))});g=g.sort(function(a,b){return a.attributes[f]==b.attributes[f]?0:a.attributes[f]<b.attributes[f]?-1:1})}var k=arcgisonline.map.main.getDirectionsDisplayField(c);a.forEach(g,function(a){var e=a.geometry,g=c.name;"mapNotes"===b.type&&(g=b.title);var f="";
c.objectIdField&&esri.isDefined(a.attributes[c.objectIdField])&&(f=a.attributes[c.objectIdField]);a=new esri.Graphic(e,null,{layerName:g,objectIdInLayer:f,displayName:a.attributes[k]});d.push(a)});arcgisonline.map.leftPanel.openLeftDirectionsPanel(null,{features:d,hasSequence:g.length&&e.length})},_displayRefreshInterval:function(){var b=-1,d=this.i18n.refreshIntervalText.indexOf("${",b),c=this.i18n.refreshIntervalText.substring(b+1,d),b=this.i18n.refreshIntervalText.indexOf("}",d),d=this.i18n.refreshIntervalText.length,
b=this.i18n.refreshIntervalText.substring(b+1,d);a.byId("layerMenu.refreshIntervalText1").innerHTML=c;a.byId("layerMenu.refreshIntervalText2").innerHTML=b;this.refreshIntervalNumberChangeHandler&&(a.disconnect(this.refreshIntervalNumberChangeHandler),this.refreshIntervalNumberChangeHandler=null);this.refreshIntervalCheckChangeHandler&&(a.disconnect(this.refreshIntervalCheckChangeHandler),this.refreshIntervalCheckChangeHandler=null);c=this.mapLayers[this.menuLayerPos];c.layer.refreshInterval?(this.layerMenuRefreshIntervalMinutes.attr("value",
c.layer.refreshInterval),this.layerMenuRefreshIntervalEnabled.attr("checked",!0)):(this.layerMenuRefreshIntervalMinutes.attr("value",c.layer.refreshInterval||0),this.layerMenuRefreshIntervalEnabled.attr("checked",!1));this.refreshIntervalNumberChangeHandler=a.connect(this.layerMenuRefreshIntervalMinutes,"onChange",a.hitch(this,function(a){var b=this.layerMenuRefreshIntervalMinutes.attr("value");b&&!this.layerMenuRefreshIntervalEnabled.attr("checked")&&this.layerMenuRefreshIntervalEnabled.attr("checked",
!0);if(a.layer.refreshInterval!=b&&(a.layer.refreshInterval||b))a.layer.setRefreshInterval(b),a.refreshIntervalChanged=!0},c));this.refreshIntervalCheckChangeHandler=a.connect(this.layerMenuRefreshIntervalEnabled,"onChange",a.hitch(this,function(a){var b=this.layerMenuRefreshIntervalMinutes.attr("value");if(this.layerMenuRefreshIntervalEnabled.attr("checked")&&b){if(a.layer.refreshInterval!=b&&(a.layer.refreshInterval||b))a.layer.setRefreshInterval(b),a.refreshIntervalChanged=!0}else a.layer.refreshInterval&&
(a.layer.setRefreshInterval(!1),a.refreshIntervalChanged=!0)},c))},reviewGeocode:function(){arcgisonline.map.leftPanel.openLeftGeocodePanel(null,{parameterList:this.mapLayers[this.menuLayerPos]})},saveProps:function(){var b=this.mapLayers[this.menuLayerPos];(b.popupChanged||b.rendererChanged||b.scaleChanged||b.legendChanged||b.featureTemplatesChanged||b.renderingRuleChanged||b.mosaicRuleChanged||b.imageQualityChanged||b.defExpChanged||b.spatialFilterChanged||b.refreshIntervalChanged||b.visibleLayersChanged||
b.dataChanged||b.editableChanged||b.timeChanged||b.visibilityChanged||b.opacityChanged||b.layersChanged)&&arcgisonline.map.mapUtil.checkHostedFSAccess(b,a.hitch(this,function(a){a.rendererChanged||a.scaleChanged||a.featureTemplatesChanged||a.opacityChanged?arcgisonline.map.itemData.updateFeatureService(a):arcgisonline.map.itemData.uploadItemLayerInfos(a)}),a.hitch(this,function(){arcgisonline.map.itemData.uploadItemLayerInfos(b)}))},openAboutStack:function(){leftPanel.showStack("aboutStack")},openLegendStack:function(){leftPanel.showStack("legendStack")},
getLayersList:function(b){if(b.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer||b.layer instanceof esri.layers.ArcGISTiledMapServiceLayer){var d=arcgisonline.map.main.buildExportLayers(b);if(!d.length&&!esri.isDefined(b.visibleLayers)){var c=[],d=b.layer.layerInfos;arcgisonline.map.main.hasDynamicLayers(b)&&(d=b.itemLayers);a.forEach(d,function(d){a.byId(b.id+"_"+d.id+"_checkbox").checked&&c.push(d.id)},this);return arcgisonline.map.main.filterSubLayers(d,c.toString())}return d}return null},
adjustHeight:function(b){if(!("undefined"==typeof leftPanel||"contentStack"!=leftPanel.visibleStack)){b=a.coords(a.byId("leftPanelDiv")).h;var d=a.coords(a.byId("tocContentHeader")).h,c=a.coords(a.byId("contentSiteFooter_links")).h+10;a.style(a.byId("tocContentFooter"),"height",c+"px");a.style(a.byId("tocContentPane"),"height",b-(d+c)+"px")}},_checkUploadLink:function(b,d){var c=arcgisonline.sharing.util.getUser();c?arcgisonline.map.mapUtil.checkFSItemAccess(b,a.hitch(this,function(){var a=!b.popupChanged&&
!b.legendChanged&&!b.rendererChanged&&!b.scaleChanged&&!b.featureTemplatesChanged&&!b.defExpChanged&&!b.renderingRuleChanged&&!b.mosaicRuleChanged&&!b.imageQualityChanged&&!b.refreshIntervalChanged&&!b.visibleLayersChanged&&!b.dataChanged&&!b.editableChanged&&!b.timeChanged&&!b.visibilityChanged&&!b.opacityChanged&&!b.spatialFilterChanged&&!b.layersChanged;b.itemCard&&("update"===b.itemCard.itemControl||"admin"===b.itemCard.itemControl)?d(a,!0):esriGeowConfig.userRole&&(esriGeowConfig.userRole.isAdmin()||
esriGeowConfig.userRole.isCustom()&&esriGeowConfig.userRole.canUpdateOrgItems())&&b.url&&-1<b.url.indexOf("/"+c.accountId+"/")?d(a,!0):b.itemOwner&&b.itemOwner===c.email?d(a,!0):d(!0,!1)})):d(!0,!1)}})});