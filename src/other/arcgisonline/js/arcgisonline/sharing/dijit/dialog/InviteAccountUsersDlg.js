// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/dialog/InviteAccountUsersDlg",["dijit","dojo","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,dijit/Tooltip,dijit/form/CheckBox,dijit/form/SimpleTextarea,dijit/form/TextBox,arcgisonline/sharing/geow/Account,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/util"],function(d,c,f){c.provide("arcgisonline.sharing.dijit.dialog.InviteAccountUsersDlg");c.require("dijit.Dialog");c.require("dijit._Widget");c.require("dijit._Templated");
c.require("dijit.Tooltip");c.require("dijit.form.CheckBox");c.require("dijit.form.SimpleTextarea");c.require("dijit.form.TextBox");c.require("arcgisonline.sharing.geow.Account");c.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");c.require("arcgisonline.sharing.util");c.declare("arcgisonline.sharing.dijit.dialog.InviteAccountUsersDlg",[d._Widget,d._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n    \x3cdiv dojotype\x3d"dijit.Dialog" id\x3d"invite-account-users-dialog" title\x3d"Invite Users" execute\x3d""\x3e\r\n      \x3cdiv id\x3d"invite-account-users-search"\x3e\r\n        \x3cspan id\x3d"invite-account-users-search-label"\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cbr /\x3e\r\n      \x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd valign\x3d"top"\x3e\x3clabel\x3eTo:\x3c/label\x3e\x3c/td\x3e\r\n          \x3ctd valign\x3d"top"\x3e\r\n            \x3cdiv id\x3d"invite-account-users-email" dojoType\x3d"dijit.form.TextBox" type\x3d"textbox" dojoAttachPoint\x3d"_email" dojoAttachEvent\x3d"onFocus:onEmailFocus,onBlur:onEmailBlur" style\x3d"width:400px;"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd valign\x3d"top"\x3e\x3cbr/\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd valign\x3d"top"\x3e\x3clabel\x3eMessage:\x3c/label\x3e\x3c/td\x3e\r\n          \x3ctd valign\x3d"top"\x3e\r\n            \x3cdiv id\x3d"invite-account-users-message" dojoType\x3d"dijit.form.SimpleTextarea" type\x3d"textarea" dojoAttachPoint\x3d"_message" style\x3d"width:400px; min-height:150px; resize:none;"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd valign\x3d"top"\x3e\x3cbr/\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd valign\x3d"top" colspan\x3d"2"\x3e\r\n            \x3cdiv id\x3d"invite-account-users-must-approve" dojoType\x3d"dijit.form.CheckBox" dojoAttachPoint\x3d"_mustApprove" type\x3d"checkbox"\x3e\x3c/div\x3e\r\n            \x3cspan id\x3d"invite-account-users-must-approve-label"\x3e\x3c/span\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/table\x3e\r\n      \x3cbr /\x3e\r\n      \x3cdiv style\x3d"float: right; padding-top:0px; padding-bottom:5px;"\x3e\r\n        \x3cbutton id\x3d"button_send-invite" class\x3d"jevent primary" dojoType\x3d"dijit.form.Button" type\x3d"button"\x3eSend\x3c/button\x3e\r\n        \x3cbutton id\x3d"button_invite-account-users-close" class\x3d"jevent cancel" dojoType\x3d"dijit.form.Button" type\x3d"button"\x3eCancel\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
_organization:null,_admin:null,_handler:null,_email:null,_subject:null,_message:null,_mustApprove:null,defaultEmailMsg:"Enter a comma-delimited list of email addresses.",defaultMessage:"",statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.InviteAccountUsersDlg);return this._instance}},postCreate:function(){this.loadConnections()},show:function(a,b,e){this._organization=a;this._admin=b;this._handler=e;this.createLabels();this.createSubject();
this.createDefaultMessage();d.byId("invite-account-users-dialog").show();this._email.setValue(this.defaultEmailMsg);setTimeout(c.hitch(this,function(){this._mustApprove.focus()}),350)},clear:function(){this._email.value=""},loadConnections:function(){c.query(".jevent").connect("onclick",function(a){a.preventDefault()});c.query("#button_invite-account-users-close").connect("onclick",function(){d.byId("invite-account-users-dialog").hide()});c.connect(c.byId("button_send-invite"),"onclick",this,"sendInvite");
c.connect(d.byId("invite-account-users-dialog"),"hide",this,"clear")},sendInvite:function(a){if(this.validates()){a=this.createTextMessage();var b=this.createHTMLMessage();arcgisonline.sharing.geow.Account.inviteAccountUsersByEmail(this._organization.id,{emails:this._email.value,subject:this._subject,text:a,html:b,mustApprove:this._mustApprove.checked,role:"account_user",expiration:20160},c.hitch(this,this._handler),c.hitch(this,this._handler));this.hide()}},validates:function(){var a=!0,b="",c=this._email.value;
if(c===this.defaultEmailMsg)b="Please enter at least one email address.",a=!1;else for(var c=c.split(","),d=0;d<c.length;d++)if(!this.containsRequiredEmailChars(c[d])){b="Email address '"+c[d]+"' does not appear to be a valid email address.";a=!1;break}a||arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:"Notice",message:b});return a},hide:function(){d.byId("invite-account-users-dialog").hide()},createHTMLLineBreaks:function(a){if(a)for(var b=-1;-1<(b=a.indexOf("\n"));)a=
0===b?"\x3cbr/\x3e"+a.substring(b+1):a.substring(0,b)+"\x3cbr/\x3e"+a.substring(b+1);return a},createLabels:function(){var a;a="Invite people to join your "+(esriGeowConfig.useDefaultIdentityStore?"portal":"organization");c.byId("invite-account-users-search-label").innerHTML=a+" by sending them an email.";a="Invited users must be approved before they are accepted to the "+(esriGeowConfig.useDefaultIdentityStore?"portal.":"organization.");c.byId("invite-account-users-must-approve-label").innerHTML=
a},createSubject:function(){this._subject="Invitation to join "+this._organization.name+" on "+(esriGeowConfig.useDefaultIdentityStore?esriGeowConfig.portalName||"ArcGIS":"ArcGIS Online")},createHTMLMessage:function(){var a=esriGeowConfig.useDefaultIdentityStore?esriGeowConfig.portalName||"ArcGIS":"ArcGIS Online",b=esriGeowConfig.baseUrl.replace("http:","https:"),c=this.createHTMLLineBreaks(this._message.value),b="\x3cp\x3e@@user.fullname@@ has invited you to join @@org.name@@ at "+a+". "+('\x3ca href\x3d"'+
b+esriGeowConfig.signin+'?invitation\x3d@@invitation.id@@\x26org\x3d@@org.name@@"\x3eClick here to join\x3c/a\x3e.\x3c/p\x3e'),b=b+("\x3cp\x3e"+c+"\x3c/p\x3e"),b=b+'\x3cp style\x3d"color:gray;"\x3eThis is an automated email, please do not reply. Contact the ',b=b+'\x3ca href\x3d"mailto:arcgisonline_feedback@esri.com?subject\x3dA comment about ArcGIS Online accounts."\x3e';return b+=a+"\x3c/a\x3e team if you have questions.\x3c/p\x3e"},createTextMessage:function(){var a=esriGeowConfig.useDefaultIdentityStore?
esriGeowConfig.portalName||"ArcGIS":"ArcGIS Online",b=esriGeowConfig.baseUrl.replace("http:","https:"),b="@@user.fullname@@ has invited you to join @@org.name@@ at "+a+". "+("Visit the following link to join:\n\r"+b+esriGeowConfig.signin+"?invitation\x3d@@invitation.id@@\x26org\x3d@@org.name@@\n\r"),b=b+(this._message.value+"\n\r"),b=b+("This is an automated email, please do not reply. Contact the "+a+" team at ");return b+="arcgisonline_feedback@esri.com if you have questions."},createDefaultMessage:function(){var a=
"To join, you'll need an "+(esriGeowConfig.useDefaultIdentityStore?"account":"Esri Global Account")+" that references the same email address this invitation was sent to. ";this.defaultMessage=a+="You can create a new account or use an existing account that is registered with "+(esriGeowConfig.useDefaultIdentityStore?esriGeowConfig.portalName||"ArcGIS":"ArcGIS Online")+".";this._message.setValue(this.defaultMessage)},onEmailFocus:function(a){this._email.value===this.defaultEmailMsg&&this._email.setValue("")},
onEmailBlur:function(a){(!this._email.value||""===this._email.value)&&this._email.setValue(this.defaultEmailMsg)},containsRequiredEmailChars:function(a){if(window.RegExp){var b=/^.+\@(\[?)[a-zA-Z0-9\-\.]+\.([a-zA-Z]{2,20}|[0-9]{1,3})(\]?)$/;return!/(@.*@)|(\.\.)|(@\.)|(\.@)|(^\.)/.test(a)&&b.test(a)?!0:!1}return-1===a.indexOf("@")||-1===a.indexOf(".")?!1:!0}})});