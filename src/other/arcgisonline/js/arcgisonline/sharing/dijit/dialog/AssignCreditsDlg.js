// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
require({cache:{"url:arcgisonline/sharing/dijit/dialog/templates/AssignCreditsDlg.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"${baseClass} assign-credits-dialog" data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"_dialog"\x3e\r\n    \x3cspan data-dojo-attach-point\x3d"_currentCreditsLabel"\x3e\x3c/span\x3e\r\n    \x3cbr\x3e\x3cbr\x3e\r\n    \x3cspan data-dojo-attach-point\x3d"_setAllocationLabel"\x3e\x3c/span\x3e\r\n    \x3cbr\x3e\x3cbr\x3e\r\n    \x3cspan class\x3d"esriLeadingPadding05"\x3e\r\n      \x3cinput type\x3d"radio" id\x3d"setAllocation-${baseClass}" name\x3d"allocation"\r\n             data-dojo-attach-point\x3d"_setAllocationRadioBtn" data-dojo-type\x3d"dijit/form/RadioButton"\x3e\r\n      \x3clabel for\x3d"setAllocation-${baseClass}"\x3e${i18n.allocateCreditsSet}\x3c/label\x3e\r\n      \x3cinput type\x3d"text" data-dojo-attach-point\x3d"_credits" class\x3d"creditEntry" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"trim:true"\x3e\r\n    \x3c/span\x3e\r\n    \x3cbr\x3e\x3cbr\x3e\r\n    \x3cspan class\x3d"esriLeadingPadding05"\x3e\r\n      \x3cinput type\x3d"radio" id\x3d"setUnlimited-${baseClass}" name\x3d"allocation"\r\n             data-dojo-attach-point\x3d"_setUnlimitedRadioBtn" data-dojo-type\x3d"dijit/form/RadioButton"\x3e\r\n      \x3clabel for\x3d"setUnlimited-${baseClass}" data-dojo-attach-point\x3d"_unlimitedCreditsLabel"\x3e\x3c/label\x3e\r\n    \x3c/span\x3e\r\n    \x3cbr\x3e\x3cbr\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n      \x3cbutton type\x3d"button" class\x3d"calcite secondary small" data-dojo-attach-point\x3d"_okBtn" data-dojo-type\x3d"dijit/form/Button"\x3e${i18n.assign}\x3c/button\x3e\r\n      \x3cbutton type\x3d"button" class\x3d"calcite transparent small" data-dojo-attach-point\x3d"_cancelBtn" data-dojo-type\x3d"dijit/form/Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr\x3e\x3cbr\x3e\x3cbr\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n'}});
define("arcgisonline/sharing/dijit/dialog/AssignCreditsDlg","require dojo/_base/declare dojo/_base/lang dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/on dojo/json dojo/number dijit/a11yclick dojo/mouse dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/Dialog dijit/form/Button dijit/form/RadioButton dijit/form/TextBox dijit/form/NumberTextBox dijit/Tooltip esri/lang arcgisonline/sharing/util arcgisonline/sharing/dijit/dialog/GeneralDlg dojo/i18n!arcgisonline/nls/arcgisonline dojo/text!arcgisonline/sharing/dijit/dialog/templates/AssignCreditsDlg.html".split(" "),
function(s,t,g,h,D,E,u,q,k,v,w,x,y,z,A,F,G,H,I,J,l,c,r,B,m,C){var p=t("arcgisonline.sharing.dijit.dialog.AssignCreditsDlg",[y,z,A],{declaredClass:"arcgisonline.sharing.dijit.dialog.AssignCreditsDlg",baseClass:"esriAssignCreditsDlg",basePath:s.toUrl("arcgisonline/sharing/dijit/dialog"),templateString:C,widgetsInTemplate:!0,_username:null,_tooltips:[],postMixInProperties:function(){this.inherited(arguments);this.i18n=g.mixin({},m.common);g.mixin(this.i18n,m);g.mixin(this.i18n,m.assignCreditsDlg)},postCreate:function(){this.inherited(arguments);
this._generalDlg=B.prototype.statics.getInstance();this._setupConnections()},_setupConnections:function(){var a=g.hitch(this,this._handleRadioClick);this.own(this._okBtn.on("click",g.hitch(this,this._assignCredits)),v(this._cancelBtn,g.hitch(this,this.hide)),this._setAllocationRadioBtn.on("click",a),this._setUnlimitedRadioBtn.on("click",a))},_handleRadioClick:function(a){this._credits.set("disabled",a&&a.target&&a.target.id&&a.target.id==="setUnlimited-"+this.baseClass)},_setupTooltips:function(){this._tooltips&&
0===this._tooltips.length&&this._tooltips.push(this._createTooltip("noLimitTooltip-"+this.baseClass,this.i18n.orgLimit,200,300))},_createTooltip:function(a,c,d,b){d=esri.isDefined(d)?d:200;b=esri.isDefined(b)?b:300;return new l({label:'\x3cdiv style\x3d"max-width:'+b+'px;"\x3e'+c+"\x3c/div\x3e",connectId:[a],id:"tooltip_"+a,showDelay:d})},_setAssigning:function(a){this._okBtn.set("disabled",a);this._okBtn.set("label",a?this.i18n.assigning:this.i18n.assign)},_clear:function(){this._setAllocationRadioBtn.set("checked",
!0);this._credits.set("disabled",!1);this._credits.set("value","");this._credits.set("constraints",{pattern:"0.##"});h.set(this._dialog,"title",this.i18n.manageCredits);h.set(this._currentCreditsLabel,"innerHTML",c.substitute({num:k.format(parseInt(esriGeowConfig.self.subscriptionInfo.availableCredits,10))},this.i18n.currentCredits));h.set(this._setAllocationLabel,"innerHTML",c.substitute({name:this._username},this.i18n.setAllocation));h.set(this._unlimitedCreditsLabel,"innerHTML",'\x3cspan id\x3d"noLimitTooltip-'+
this.baseClass+'" class\x3d"hasTooltip"\x3e'+this.i18n.allocateCreditsUnlimited+"\x3c/span\x3e");this._setupTooltips();this._setAssigning(!1)},_assignCredits:function(){var a=this,n=a._setAllocationRadioBtn.get("checked"),d=a._credits.get("value"),b;if(a._validates())if(a._setAssigning(!0),n){try{b=k.parse(d),b=isNaN(b)?parseFloat(d):b}catch(e){a._createOneTimeTooltip(a.i18n.creditsNumberRequired,a._okBtn.domNode),a._setAssigning(!1)}a._assignCreditLimit(b).then(function(f){f&&f.code&&f.message?(console.log("unable to set allocation to "+
b+".",f),a._generalDlg.show({title:a.i18n.errorTitle,message:c.substitute({name:a._username,num:b},a.i18n.cantAllocateCredits)})):(a._generalDlg.show({title:a.i18n.noticeLabel,message:c.substitute({name:a._username,num:b},a.i18n.allocateCredits)}),a.hide());a._setAssigning(!1);a._publishCreditsChanged()},function(f){console.log("unable to set allocation to "+b+".",f);a._generalDlg.show({title:a.i18n.errorTitle,message:c.substitute({name:a._username,num:b},a.i18n.cantAllocateCredits)});a._setAssigning(!1)})}else a._assignNoLimit().then(function(b){b&&
b.code&&b.message?(console.log("unable to set allocation to no limit.",b),a._generalDlg.show({title:a.i18n.errorTitle,message:c.substitute({name:a._username},a.i18n.cantAllocateNoLimit)})):(a._generalDlg.show({title:a.i18n.noticeLabel,message:c.substitute({name:a._username},a.i18n.allocatedNoLimit)}),a.hide());a._setAssigning(!1);a._publishCreditsChanged()},function(b){console.log("unable to set allocation to no limit.",b);a._generalDlg.show({title:a.i18n.errorTitle,message:c.substitute({name:a._username},
a.i18n.cantAllocateNoLimit)});a._setAssigning(!1)})},_assignCreditLimit:function(a){return r.request({url:esriGeowConfig.restBaseUrl+"portals/self/assignUserCredits",content:{userAssignments:q.stringify([{username:this._username,credits:a}])}},{usePost:!0}).promise},_assignNoLimit:function(){return r.request({url:esriGeowConfig.restBaseUrl+"portals/self/unassignUserCredits",content:{usernames:q.stringify([this._username])}},{usePost:!0}).promise},_publishCreditsChanged:function(){x.publish("credits-change")},
_validates:function(){var a=this._setAllocationRadioBtn.get("checked"),n=esriGeowConfig.self.subscriptionInfo.availableCredits,d=this._credits.get("value"),b=this._okBtn.domNode,e;if(a){if(!c.isDefined(d)||0===d.length)return this._createOneTimeTooltip(this.i18n.mustSetCredits,b),!1;try{e=k.parse(d);e=isNaN(e)?parseFloat(d):e;if(isNaN(e))return this._createOneTimeTooltip(this.i18n.creditsNumberRequired,b),!1;if(0>e)return this._createOneTimeTooltip(this.i18n.creditsZeroGreater,b),!1;if(e>n)return this._createOneTimeTooltip(this.i18n.creditLimitOrg,
b),!1}catch(f){return this._createOneTimeTooltip(this.i18n.creditsNumberRequired,b),!1}}return!0},_createOneTimeTooltip:function(a,c){l.show('\x3cspan style\x3d"color:red;"\x3e'+a+"\x3c/span\x3e",c);u.once(c,w.leave,function(){l.hide(c)})},show:function(a){this._username=a;this._clear();this._dialog.show()},hide:function(){this._dialog.hide()}});p.prototype.statics={_instance:null,getInstance:function(){null==this._instance&&(this._instance=new p);return this._instance}};return p});