// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/dialog/FolderDlg",["dijit","dojo","dojox","dojo/require!dijit/_Widget,dijit/_Templated,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/util,dijit/Dialog,arcgisonline/sharing/geow/Folder"],function(e,a,h){a.provide("arcgisonline.sharing.dijit.dialog.FolderDlg");a.require("dijit._Widget");a.require("dijit._Templated");a.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");a.require("arcgisonline.sharing.util");a.require("dijit.Dialog");a.require("arcgisonline.sharing.geow.Folder");
a.declare("arcgisonline.sharing.dijit.dialog.FolderDlg",[e._Widget,e._Templated],{util:arcgisonline.sharing.util,folder:arcgisonline.sharing.geow.Folder,widgetsInTemplate:!0,templateString:'\x3cdiv\x3e\r\n\x3cdiv dojotype\x3d"dijit.Dialog" dojoAttachPoint\x3d"_folderDialog" title\x3d"${i18n.folderDlgTitle}" style\x3d"width:460px;"\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_folderErrorDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_folderForm" dojoAttachEvent\x3d"onSubmit:createFolder,onkeydown:onKeyDown"\x3e\r\n      \x3cdiv style\x3d"margin:2px;"\x3e\r\n        \x3clabel class\x3d"long" for\x3d"fldr_title"\x3e${i18n.folderName}\x3c/label\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"_folderTitleInput" name\x3d"fldr_title" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" required\x3d"true" maxlength\x3d"125" style\x3d"padding:2px;"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cbr/\x3e\r\n      \x3cdiv style\x3d"float:right;"\x3e\r\n        \x3cbutton type\x3d"button" dojotype\x3d"dijit.form.Button" class\x3d"primary" dojoAttachEvent\x3d"onClick:createFolder"\x3e${i18n.create}\x3c/button\x3e\r\n        \x3cbutton dojotype\x3d"dijit.form.Button" class\x3d"cancel" dojoAttachEvent\x3d"onClick:_handleCancelBtn"\x3e${i18n.cancel}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n      \x3cbr/\x3e\r\n      \x3cbr/\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
statics:{_instance:null,getInstance:function(){null===this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.FolderDlg({}));return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n={};this.i18n=a.mixin({},a.i18n.getLocalization("arcgisonline","arcgisonline").common);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").generalDlg);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").folderDlg);this.allFolderNames=
""},show:function(d,b){var c=this.util.getUser();b&&(this.overrideUser=b);this.allFolderNames=this.overrideUser?"||"+this.overrideUser.username+"||":"||"+c.email+"||";a.forEach(d,a.hitch(this,function(a){this.allFolderNames+=(a.title[0]?a.title[0].toLowerCase():a.title.toLowerCase())+"||"}));this.clear();this._folderDialog.show()},clear:function(){this._folderTitleInput.set("value","");this._folderErrorDiv.innerHTML="";a.removeClass(this._folderErrorDiv,"error")},_handleCancelBtn:function(a){this._folderDialog.hide();
a.preventDefault()},hide:function(){this._folderDialog.hide()},createFolder:function(d){d.preventDefault();var b=a.trim(this._folderTitleInput.get("value")),c;if(0===b.length)c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),c.show({title:this.i18n.errorDlgTitle,message:this.i18n.invalid.provideName});else if(-1<b.indexOf("\x3c")||-1<b.indexOf("\x3e"))c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),c.show({title:this.i18n.errorDlgTitle,message:this.i18n.invalid.invalidCharacters});
else if(-1<this.allFolderNames.indexOf("||"+b.toLowerCase()+"||"))c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),c.show({title:this.i18n.errorDlgTitle,message:a.string.substitute(this.i18n.invalid.sameFolderName,[b])});else{var e=b.replace(/ /g,"_");d={folderName:e,title:b};var f=function(){this._folderDialog.hide();a.publish("refreshFolders",[e])},g=function(d){c=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();c.show({title:this.i18n.errorDlgTitle,
message:a.string.substitute(this.i18n.invalid.sameFolderName,[b])})};this.overrideUser?this.folder.createFolderByUser(this.overrideUser.username,d,a.hitch(this,f),a.hitch(this,g)):this.folder.createFolder(d,a.hitch(this,f),a.hitch(this,g))}},onKeyDown:function(a){var b;window.event?b=a.keyCode:a.which&&(b=a.which);13===b&&this.createFolder(a)}})});