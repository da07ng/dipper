// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/ShareOptions",["dijit","dojo","dojox","dojo/require!dijit/form/Textarea,dijit/form/CheckBox,dijit/_Widget,dijit/_Templated,arcgisonline/sharing/geow/Account,arcgisonline/sharing/geow/Community,arcgisonline/sharing/geow/Content,arcgisonline/sharing/util"],function(g,a,q){a.provide("arcgisonline.sharing.dijit.ShareOptions");a.require("dijit.form.Textarea");a.require("dijit.form.CheckBox");a.require("dijit._Widget");a.require("dijit._Templated");a.require("arcgisonline.sharing.geow.Account");
a.require("arcgisonline.sharing.geow.Community");a.require("arcgisonline.sharing.geow.Content");a.require("arcgisonline.sharing.util");a.declare("arcgisonline.sharing.dijit.ShareOptions",[g._Widget,g._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv style\x3d"line-height:25px; padding-left:15px; padding-top:5px;"\x3e\r\n  \x3cdiv id\x3d"share-loading"\x3e\r\n    \x3clabel\x3e\r\n      ${i18n.loadinglabel}\r\n    \x3c/label\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"img_share-everyone-check_div" style\x3d"display:none;"\x3e\r\n    \x3cimg id\x3d"img_share-everyone-check" dojoAttachPoint\x3d"_imgShareEveryoneCheck" border\x3d"0" style\x3d"vertical-align:middle"/\x3e${i18n.everyone}\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"share-everyone-check_div" style\x3d"display:none;"\x3e\r\n    \x3cinput id\x3d"share-everyone-check" dojotype\x3d"dijit.form.CheckBox" type\x3d"checkbox" /\x3e\r\n    \x3clabel id\x3d"share-everyone-check-label" for\x3d"share-everyone-check"\x3e\r\n      ${i18n.everyone}\r\n    \x3c/label\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"img_share-account-check_div" style\x3d"display:none;"\x3e\r\n    \x3cimg id\x3d"img_share-account-check" dojoAttachPoint\x3d"_imgShareAccountCheck" border\x3d"0" style\x3d"vertical-align:middle"/\x3e\x26nbsp;\r\n    \x3clabel id\x3d"img_share-account-check-label" for\x3d"img_share-account-check"\x3e\r\n    \x3c/label\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"share-account-check_div" style\x3d"display:none;"\x3e\r\n    \x3cinput id\x3d"share-account-check" dojotype\x3d"dijit.form.CheckBox" type\x3d"checkbox" /\x3e\r\n    \x3clabel id\x3d"share-account-check-label" for\x3d"share-account-check"\x3e\r\n    \x3c/label\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"share-groups-div" style\x3d"display:none;"\x3e\r\n    \x3cinput id\x3d"share-groups-check" dojotype\x3d"dijit.form.CheckBox" type\x3d"checkbox" /\x3e\r\n    \x3clabel id\x3d"share-groups-check-label" for\x3d"share-groups-check"\x3e\r\n      ${i18n.theseGroups}\r\n    \x3c/label\x3e\r\n    \x3cbr/\x3e\r\n    \x3cdiv style\x3d"padding-left:20px; padding-top:5px;"\x3e\r\n      \x3cdiv dojotype\x3d"dijit.layout.BorderContainer" gutters\x3d"false" design\x3d"headline" style\x3d"width:95%; height:115px;"\x3e\r\n        \x3cdiv id\x3d"share-groups-list" dojotype\x3d"dijit.layout.ContentPane" region\x3d"middle" splitter\x3d"false"\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
community:arcgisonline.sharing.geow.Community,util:arcgisonline.sharing.util,userGroups:null,sortField:null,user:null,items:null,itemsAreSharedToGroups:"",itemsInfo:{},itemUser:null,organization:null,itemUsername:null,adminGroups:null,lowestAccess:3,isMultiTenant:!0,shareConnect:null,shareType:"item",i18n:null,_checkboxImgUrl:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=a.mixin({},a.i18n.getLocalization("arcgisonline","arcgisonline").common);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline",
"arcgisonline").shareOptions);this._checkboxImgUrl=this.util.relativeToExplicitUrl("images/checkbox.gif")},postCreate:function(){this.checkTenantType();this.loadConnections();a.attr(this._imgShareEveryoneCheck,"src",this.util.relativeToExplicitUrl("images/checkbox2.gif"));a.attr(this._imgShareAccountCheck,"src",this.util.relativeToExplicitUrl("images/checkbox2.gif"))},checkTenantType:function(){this.isMultiTenant=void 0===esriGeowConfig.isMultiTenant||!0===esriGeowConfig.isMultiTenant},loadConnections:function(){a.subscribe("shareOptionsSetup",
function(){a.style(a.byId("share-loading"),"display","none")})},share:function(a){"group"===this.shareType?this.shareItemToGroups():"admin"===this.shareType?this.shareItemAsAdmin(a):this.shareItem(a)},_setRoleFlags:function(){this._roleCanShareToGroup=(this._isCustomRole=esriGeowConfig.userRole)&&esriGeowConfig.userRole.canShareItemToGroup();this._roleCanShareToOrg=this._isCustomRole&&esriGeowConfig.userRole.canShareItemToOrg();this._roleCanSharePublic=this._isCustomRole&&esriGeowConfig.userRole.canShareItemToPublic();
this._orgUserCanSharePublicOrOverride=this.organization&&(!0===this.organization.canSharePublic&&(!this._isCustomRole||this._roleCanSharePublic)||esriGeowConfig.userRole.isAdmin())},checkForAccount:function(c){(this.user=this.util.getUser())&&this.user.accountId&&""!==this.user.accountId&&!this.organization?arcgisonline.sharing.geow.Account.getSelf(a.hitch(this,function(b){b&&!b.code&&!b.message?(this.organization=b,this._setRoleFlags(),a.byId("img_share-account-check-label").innerHTML=this.organization.name,
a.byId("share-account-check-label").innerHTML=this.organization.name,this.isMultiTenant||a.attr(a.byId("share-everyone-check-label"),"innerHTML",this.i18n.everyonePortal),this._isCustomRole&&!this._roleCanShareToOrg&&a.style(a.byId("share-account-check_div"),"display","none")):a.style(a.byId("share-account-check_div"),"display","none");c&&c()})):(a.style(a.byId("share-account-check_div"),"display","none"),c&&c())},clear:function(){a.byId("share-groups-list").innerHTML="";g.byId("share-everyone-check").set("value",
!1);g.byId("share-account-check").set("value",!1);g.byId("share-groups-check").set("value",!1);a.style(a.byId("img_share-everyone-check_div"),"display","none");a.style(a.byId("share-everyone-check_div"),"display","none");a.style(a.byId("img_share-account-check_div"),"display","none");a.style(a.byId("share-account-check_div"),"display","none");a.disconnect(this.shareConnect);this.shareType="item"},filterOwnedGroups:function(a){if(a){for(var b=[],d,f=0;f<a.length;f++)d=a[f],d.userMembership&&("owner"===
d.userMembership.memberType||"admin"===d.userMembership.memberType)&&(!d.capabilities||!d.capabilities.length)&&b.push(d);return b}return null},showGroups:function(c,b){this.items=c;this.sortField="title";(this.userGroups=this.filterOwnedGroups(b))&&this.userGroups.sort(a.hitch(this,"_sortFunc"));this.clear();this.shareType="group";for(var d=function(a,c){var b=[];if(c.admin)for(var d=0;d<c.admin.length;d++)b.push(c.admin[d].id);a.sharing={groups:b}},f=0;f<this.items.length;f++){var h=this.items[f];
h.sharing=null;this.util.getJson(esriGeowConfig.restBaseUrl+"content/items/"+h.id+"/groups",a.hitch(this,d,h))}setTimeout(a.hitch(this,"buildGroupList",0),100)},filterAdminGroups:function(c){if(c){for(var b=[],d=0;d<this.userGroups.length;d++)b.push(this.userGroups[d].id);for(var f=[],d=0;d<c.length;d++)-1===a.indexOf(b,c[d].id)&&(!c[d].capabilities||!c[d].capabilities.length)&&f.push(c[d]);return f}return null},findLowestAccessLevel:function(){this.lowestAccess=3;for(var a,b,d=0;d<this.items.length;d++)(b=
this.items[d].access)||(b="private"),1===b.length&&(b=b[0]),"public"===b?a=3:"org"===b?a=2:"shared"===b?a=1:"private"===b&&(a=0),a<this.lowestAccess&&(this.lowestAccess=a)},showAdmin:function(c,b,d,f){this.items=c;this.itemUser=d;this.sortField="title";this.userGroups=a.filter(b||[],"return (!item.capabilities || !item.capabilities.length);");this.userGroups.sort(a.hitch(this,"_sortFunc"));this.adminGroups=this.filterAdminGroups(f);this.checkForAccount(a.hitch(this,function(){this.clear();this.findLowestAccessLevel();
this.shareType="admin";for(var b=function(a,b){a.sharing=b.sharing},c=0;c<this.items.length;c++){var d=this.items[c];d.sharing=null;var f=esriGeowConfig.restBaseUrl+"content/users/"+(this.itemUser?this.itemUser.username?this.itemUser.username:this.itemUser.email:this.user.email);if(esri.isDefined(d.folderId)&&"/"!==d.folderId||esri.isDefined(d.ownerFolder)&&"/"!==d.ownerFolder)f+="/"+(d.folderId||d.ownerFolder);f+="/items/"+d.id;this.util.getJson(f,a.hitch(this,b,d))}setTimeout(a.hitch(this,"buildAdminList",
0),100)}))},filterViewOnlyGroups:function(a){if(a){for(var b=[],d,f=0;f<a.length;f++)d=a[f],(!d.capabilities||!d.capabilities.length)&&(d.userMembership&&("owner"===d.userMembership.memberType||"admin"===d.userMembership.memberType)||!esri.isDefined(d.isViewOnly)||!d.isViewOnly)&&b.push(d);return b}return null},show:function(c,b,d){this.items=c;d&&null!==d&&(this.itemUser=d);this.userGroups=this.filterViewOnlyGroups(b);this.sortField="title";esri.isDefined(this.userGroups)&&this.userGroups.sort(a.hitch(this,
"_sortFunc"));this.checkForAccount(a.hitch(this,function(){this.clear();this.shareType="item";for(var b=0;b<this.items.length;b++){var c=this.items[b];c.sharing=null;var d=this.util.getUser(),g=esriGeowConfig.restBaseUrl+"content/users/",g=this.itemUser&&null!==this.itemUser?this.itemUser.username?g+this.itemUser.username:g+this.itemUser.email:g+d.email;if(esri.isDefined(c.folderId)&&"/"!==c.folderId||esri.isDefined(c.ownerFolder)&&"/"!==c.ownerFolder)g+="/"+(c.folderId||c.ownerFolder);g+="/items/"+
c.id;this.util.getJson(g,a.hitch(this,function(a,b){a.sharing=b.sharing},c))}setTimeout(a.hitch(this,"buildList",0),100)}))},buildGroupList:function(c){var b,d;for(b=0;b<this.items.length;b++)if(!this.items[b].sharing&&20>c){c+=1;setTimeout(a.hitch(this,"buildGroupList",c),100);return}!this._isCustomRole||this._roleCanShareToGroup?0<this.userGroups.length?a.style(a.byId("share-groups-div"),"display","block"):a.publish("doesNotOwnGroups"):a.style(a.byId("share-groups-div"),"display","none");this.itemsAreSharedToGroups=
",";c=[];for(b=0;b<this.items.length;b++){var f=this.items[b];eval("this.itemsInfo._"+f.id+" \x3d new Object();");eval("this.itemsInfo._"+f.id).itemsIsSharedToGroups=",";if(f.sharing)for(var h=0;h<f.sharing.groups.length;h++){var e=f.sharing.groups[h];eval("this.itemsInfo._"+f.id).itemsIsSharedToGroups+=e+",";if(-1===this.itemsAreSharedToGroups.indexOf(","+e+","))this.itemsAreSharedToGroups+=e+",",d=[],d[0]=e,d[1]=1,c[c.length]=d;else for(d=0;d<c.length;d++)if(c[d][0]===e){c[d][1]+=1;break}}}var f=
"",h=!1,k,l;for(b=0;b<this.userGroups.length;b++){e=this.userGroups[b];k="";l=this.items.length;if(-1<this.itemsAreSharedToGroups.indexOf(","+e.id+",")){k="checked";h=!0;for(d=0;d<c.length;d++)if(c[d][0]===e.id){l=c[d][1];break}}f=l<this.items.length?f+('\x3cdiv id\x3d"img_group_'+b+"_div\" style\x3d\"display:block;\"\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0'\x3e\x3ctr\x3e\x3ctd width\x3d'17' valign\x3d'top'\x3e\x3cimg id\x3d\"img_group_"+b+'" src\x3d"'+this._checkboxImgUrl+'" border\x3d"0"\x3e\x3c/td\x3e\x3ctd\x3e'+
e.title+'\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv id\x3d"group_'+b+"_div\" style\x3d\"display:none;\"\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0'\x3e\x3ctr\x3e\x3ctd width\x3d'17' valign\x3d'top'\x3e\x3cinput id\x3d\"group_"+b+'" '+k+' value\x3d"'+e.id+'" type\x3d"checkbox" style\x3d"vertical-align:middle;border:none; padding:0px; margin:0px;width:13px;height:13px;" dojoType\x3d"dijit.form.Checkbox" /\x3e\x3c/td\x3e\x3ctd\x3e'+e.title):f+('\x3cdiv id\x3d"group_'+b+"_div\" style\x3d\"display:block;\"\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0'\x3e\x3ctr\x3e\x3ctd width\x3d'17' valign\x3d'top'\x3e\x3cinput id\x3d\"group_"+
b+'" '+k+' value\x3d"'+e.id+'" type\x3d"checkbox" style\x3d"vertical-align:middle;border:none; padding:0px; margin:0px;width:13px;height:13px;" dojoType\x3d"dijit.form.Checkbox" /\x3e\x3c/td\x3e\x3ctd\x3e'+e.title);e.isOpenData&&esriGeowConfig.openDataConfigEnabled&&(f+=" "+this.i18n.openData);f+="\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e"}a.connect(a.byId("share-groups-list"),"onclick",this,"checkGroup");a.byId("share-groups-list").innerHTML=f;h?g.byId("share-groups-check").set("checked",
!0):g.byId("share-groups-check").set("checked",!1);a.connect(g.byId("share-groups-check"),"onClick",this,"checkGroups");a.publish("shareOptionsSetup")},buildAdminList:function(c){var b,d;for(b=0;b<this.items.length;b++)if(!this.items[b].sharing&&20>c){c+=1;setTimeout(a.hitch(this,"buildAdminList",c),100);return}if(this.userGroups&&0<this.userGroups.length||this.adminGroups&&0<this.adminGroups.length&&1<this.lowestAccess)!this._isCustomRole||this._roleCanShareToGroup?a.style(a.byId("share-groups-div"),
"display","block"):a.style(a.byId("share-groups-div"),"display","none");this.itemsAreSharedToGroups=",";c=[];for(b=0;b<this.items.length;b++){var f=this.items[b];eval("this.itemsInfo._"+f.id+" \x3d new Object();");eval("this.itemsInfo._"+f.id).itemsIsSharedToGroups=",";if(f.sharing)for(var h=0;h<f.sharing.groups.length;h++){var e=f.sharing.groups[h];eval("this.itemsInfo._"+f.id).itemsIsSharedToGroups+=e+",";if(-1===this.itemsAreSharedToGroups.indexOf(","+e+","))this.itemsAreSharedToGroups+=e+",",
d=[],d[0]=e,d[1]=1,c[c.length]=d;else for(d=0;d<c.length;d++)if(c[d][0]===e){c[d][1]+=1;break}}}var h="",f=!1,k,l;for(b=0;b<this.userGroups.length;b++){e=this.userGroups[b];k="";l=this.items.length;if(-1<this.itemsAreSharedToGroups.indexOf(","+e.id+",")){k="checked";f=!0;for(d=0;d<c.length;d++)if(c[d][0]===e.id){l=c[d][1];break}}h=l<this.items.length?h+('\x3cdiv id\x3d"img_group_'+b+"_div\" style\x3d\"display:block;\"\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0'\x3e\x3ctr\x3e\x3ctd width\x3d'17' valign\x3d'top'\x3e\x3cimg id\x3d\"img_group_"+
b+'" src\x3d"'+this._checkboxImgUrl+'" border\x3d"0"\x3e\x3c/td\x3e\x3ctd\x3e'+e.title+'\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv id\x3d"group_'+b+"_div\" style\x3d\"display:none;\"\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0'\x3e\x3ctr\x3e\x3ctd width\x3d'17' valign\x3d'top'\x3e\x3cinput id\x3d\"group_"+b+'" '+k+' value\x3d"'+e.id+'" type\x3d"checkbox" style\x3d"vertical-align:middle;border:none; padding:0px; margin:0px;width:13px;height:13px;" dojoType\x3d"dijit.form.Checkbox" /\x3e\x3c/td\x3e\x3ctd\x3e'+
e.title):h+('\x3cdiv id\x3d"group_'+b+"_div\" style\x3d\"display:block;\"\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0'\x3e\x3ctr\x3e\x3ctd width\x3d'17' valign\x3d'top'\x3e\x3cinput id\x3d\"group_"+b+'" '+k+' value\x3d"'+e.id+'" type\x3d"checkbox" style\x3d"vertical-align:middle;border:none; padding:0px; margin:0px;width:13px;height:13px;" dojoType\x3d"dijit.form.Checkbox" /\x3e\x3c/td\x3e\x3ctd\x3e'+e.title);e.isOpenData&&esriGeowConfig.openDataConfigEnabled&&(h+=" "+this.i18n.openData);h+=
"\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e"}if(this.adminGroups&&this.adminGroups.length&&1<this.lowestAccess){h+='\x3cdiv style\x3d"display:block;"\x3e\x3chr/\x3e\x3c/div\x3e';for(d=0;d<this.adminGroups.length;d++){e=this.adminGroups[d];k="";l=this.items.length;if(-1<this.itemsAreSharedToGroups.indexOf(","+e.id+",")){k="checked";for(var f=!0,m=0;m<c.length;m++)if(c[m][0]===e.id){l=c[m][1];break}}h=l<this.items.length?h+('\x3cdiv id\x3d"img_group_'+(d+b)+"_div\" style\x3d\"display:block;\"\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0'\x3e\x3ctr\x3e\x3ctd width\x3d'17' valign\x3d'top'\x3e\x3cimg id\x3d\"img_group_"+
(d+b)+'" src\x3d"'+this._checkboxImgUrl+'" border\x3d"0"\x3e\x3c/td\x3e\x3ctd\x3e'+e.title+'\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv id\x3d"group_'+(d+b)+"_div\" style\x3d\"display:none;\"\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0'\x3e\x3ctr\x3e\x3ctd width\x3d'17' valign\x3d'top'\x3e\x3cinput id\x3d\"group_"+(d+b)+'" '+k+' value\x3d"'+e.id+'" type\x3d"checkbox" style\x3d"vertical-align:middle;border:none; padding:0px; margin:0px;width:13px;height:13px;" dojoType\x3d"dijit.form.Checkbox" /\x3e\x3c/td\x3e\x3ctd\x3e'+
e.title):h+('\x3cdiv id\x3d"group_'+(d+b)+"_div\" style\x3d\"display:block;\"\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0'\x3e\x3ctr\x3e\x3ctd width\x3d'17' valign\x3d'top'\x3e\x3cinput id\x3d\"group_"+(d+b)+'" '+k+' value\x3d"'+e.id+'" type\x3d"checkbox" style\x3d"vertical-align:middle;border:none; padding:0px; margin:0px;width:13px;height:13px;" dojoType\x3d"dijit.form.Checkbox" /\x3e\x3c/td\x3e\x3ctd\x3e'+e.title);e.isOpenData&&esriGeowConfig.openDataConfigEnabled&&(h+=" "+this.i18n.openData);
h+="\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e"}}a.connect(a.byId("share-groups-list"),"onclick",this,"checkGroup");a.byId("share-groups-list").innerHTML=h;if(this.organization){for(b=c=0;b<this.items.length;b++)this.items[b].sharing&&"org"===this.items[b].sharing.access&&c++;!this._isCustomRole||this._roleCanShareToOrg?0===c?(g.byId("share-account-check").set("checked",!1),a.style(a.byId("share-account-check_div"),"display","block")):c===this.items.length?(g.byId("share-account-check").set("checked",
!0),a.style(a.byId("share-account-check_div"),"display","block")):(g.byId("share-account-check").set("checked",!0),a.style(a.byId("img_share-account-check_div"),"display","block")):(a.style(a.byId("img_share-account-check_div"),"display","none"),a.style(a.byId("share-account-check_div"),"display","none"))}if(!this.organization||this._orgUserCanSharePublicOrOverride){for(b=c=0;b<this.items.length;b++)this.items[b].sharing&&"public"===this.items[b].sharing.access&&c++;if(0===c)g.byId("share-everyone-check").set("checked",
!1),a.style(a.byId("share-everyone-check_div"),"display","block");else if(c===this.items.length?(g.byId("share-everyone-check").set("checked",!0),a.style(a.byId("share-everyone-check_div"),"display","block")):(g.byId("share-everyone-check").set("checked",!0),a.style(a.byId("img_share-everyone-check_div"),"display","block")),this.organization&&(!this._isCustomRole||this._roleCanShareToOrg))g.byId("share-account-check").set("checked",!0),a.style(a.byId("img_share-account-check_div"),"display","block"),
a.style(a.byId("share-account-check_div"),"display","none");a.connect(a.byId("img_share-everyone-check"),"onclick",a.hitch(this,"checkEveryone"));this.organization&&(!this._isCustomRole||this._roleCanShareToOrg)&&a.connect(a.byId("img_share-account-check"),"onclick",this,"checkAccount");a.connect(g.byId("share-everyone-check"),"onClick",a.hitch(this,"clickEveryone"))}else g.byId("share-everyone-check").set("checked",!1),a.style(a.byId("share-everyone-check_div"),"display","none"),a.style(a.byId("img_share-account-check_div"),
"display","none");f?g.byId("share-groups-check").set("checked",!0):g.byId("share-groups-check").set("checked",!1);a.connect(a.byId("share-groups-check"),"onClick",this,"checkGroups");this.organization&&(!this._isCustomRole||this._roleCanShareToOrg)&&a.connect(g.byId("share-account-check"),"onClick",a.hitch(this,"clickAccount"));a.publish("shareOptionsSetup")},buildList:function(c){var b,d;for(b=0;b<this.items.length;b++)if(!this.items[b].sharing&&20>c){c+=1;setTimeout(a.hitch(this,"buildList",c),
100);return}!this._isCustomRole||this._roleCanShareToGroup?this.userGroups&&0<this.userGroups.length?a.style(a.byId("share-groups-div"),"display","block"):a.publish("notMemberOfAnyGroups"):a.style(a.byId("share-groups-div"),"display","none");this.itemsAreSharedToGroups=",";c=[];for(b=0;b<this.items.length;b++){var f=this.items[b];eval("this.itemsInfo._"+f.id+" \x3d new Object();");eval("this.itemsInfo._"+f.id).itemsIsSharedToGroups=",";if(f.sharing)for(var h=0;h<f.sharing.groups.length;h++){var e=
f.sharing.groups[h];eval("this.itemsInfo._"+f.id).itemsIsSharedToGroups+=e+",";if(-1===this.itemsAreSharedToGroups.indexOf(","+e+","))this.itemsAreSharedToGroups+=e+",",d=[],d[0]=e,d[1]=1,c[c.length]=d;else for(d=0;d<c.length;d++)if(c[d][0]===e){c[d][1]+=1;break}}}h="";f=!1;for(b=0;b<this.userGroups.length;b++){var e=this.userGroups[b],k="",l=this.items.length;if(-1<this.itemsAreSharedToGroups.indexOf(","+e.id+",")){k="checked";f=!0;for(d=0;d<c.length;d++)if(c[d][0]===e.id){l=c[d][1];break}}h=l<this.items.length?
h+('\x3cdiv id\x3d"img_group_'+b+"_div\" style\x3d\"display:block;\"\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0'\x3e\x3ctr\x3e\x3ctd width\x3d'17' valign\x3d'top'\x3e\x3cimg id\x3d\"img_group_"+b+'" src\x3d"'+this._checkboxImgUrl+'" border\x3d"0"\x3e\x3c/td\x3e\x3ctd\x3e'+e.title+'\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv id\x3d"group_'+b+"_div\" style\x3d\"display:none;\"\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0'\x3e\x3ctr\x3e\x3ctd width\x3d'17' valign\x3d'top'\x3e\x3cinput id\x3d\"group_"+
b+'" '+k+' value\x3d"'+e.id+'" type\x3d"checkbox" style\x3d"vertical-align:middle;border:none; padding:0px; margin:0px;width:13px;height:13px;" dojoType\x3d"dijit.form.Checkbox" /\x3e\x3c/td\x3e\x3ctd\x3e'+e.title):h+('\x3cdiv id\x3d"group_'+b+"_div\" style\x3d\"display:block;\"\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0'\x3e\x3ctr\x3e\x3ctd width\x3d'17' valign\x3d'top'\x3e\x3cinput id\x3d\"group_"+b+'" '+k+' value\x3d"'+e.id+'" type\x3d"checkbox" style\x3d"vertical-align:middle;border:none; padding:0px; margin:0px;width:13px;height:13px;" dojoType\x3d"dijit.form.Checkbox" /\x3e\x3c/td\x3e\x3ctd\x3e'+
e.title);e.isOpenData&&esriGeowConfig.openDataConfigEnabled&&(h+=" "+this.i18n.openData);h+="\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e"}a.connect(a.byId("share-groups-list"),"onclick",this,"checkGroup");a.byId("share-groups-list").innerHTML=h;if(this.organization&&esriGeowConfig.userRole&&(!this._isCustomRole||this._roleCanShareToOrg)){for(b=c=0;b<this.items.length;b++)this.items[b].sharing&&"org"===this.items[b].sharing.access&&c++;0===c?(g.byId("share-account-check").set("checked",!1),a.style(a.byId("share-account-check_div"),
"display","block")):c===this.items.length?(g.byId("share-account-check").set("checked",!0),a.style(a.byId("share-account-check_div"),"display","block")):(g.byId("share-account-check").set("checked",!0),a.style(a.byId("img_share-account-check_div"),"display","block"))}if(!this.organization||this._orgUserCanSharePublicOrOverride){for(b=c=0;b<this.items.length;b++)this.items[b].sharing&&"public"===this.items[b].sharing.access&&c++;if(0===c)g.byId("share-everyone-check").set("checked",!1),a.style(a.byId("share-everyone-check_div"),
"display","block");else if(c===this.items.length?(g.byId("share-everyone-check").set("checked",!0),a.style(a.byId("share-everyone-check_div"),"display","block")):(g.byId("share-everyone-check").set("checked",!0),a.style(a.byId("img_share-everyone-check_div"),"display","block")),this.organization&&esriGeowConfig.userRole&&(!this._isCustomRole||this._roleCanShareToOrg))g.byId("share-account-check").set("checked",!0),a.style(a.byId("img_share-account-check_div"),"display","block"),a.style(a.byId("share-account-check_div"),
"display","none");a.connect(a.byId("img_share-everyone-check"),"onclick",a.hitch(this,"checkEveryone"));this.organization&&a.connect(a.byId("img_share-account-check"),"onclick",this,"checkAccount");a.connect(g.byId("share-everyone-check"),"onClick",a.hitch(this,"clickEveryone"))}else if(this.organization&&!this.organization.canSharePublic){for(b=c=0;b<this.items.length;b++)this.items[b].sharing&&"public"===this.items[b].sharing.access&&c++;if(c){if(a.style(a.byId("img_share-everyone-check_div"),"display",
"none"),g.byId("share-everyone-check").set("checked",!0),a.style(a.byId("share-everyone-check_div"),"display","none"),this.organization&&esriGeowConfig.userRole&&(!this._isCustomRole||this._roleCanShareToOrg))g.byId("share-account-check").set("checked",!0),a.style(a.byId("img_share-account-check_div"),"display","none"),a.style(a.byId("share-account-check_div"),"display","block")}else g.byId("share-everyone-check").set("checked",!1),a.style(a.byId("share-everyone-check_div"),"display","none"),a.style(a.byId("img_share-account-check_div"),
"display","none")}else g.byId("share-everyone-check").set("checked",!1),a.style(a.byId("share-everyone-check_div"),"display","none"),a.style(a.byId("img_share-account-check_div"),"display","none");f?g.byId("share-groups-check").set("checked",!0):g.byId("share-groups-check").set("checked",!1);a.connect(a.byId("share-groups-check"),"onClick",this,"checkGroups");this.organization&&(!this._isCustomRole||this._roleCanShareToOrg)&&a.connect(g.byId("share-account-check"),"onClick",a.hitch(this,"clickAccount"));
a.publish("shareOptionsSetup")},shareItemToGroups:function(){var c=g.byId("share-groups-check").get("checked"),b="",d="",f="",h="";c?this.userGroups&&this.userGroups.length&&a.forEach(this.userGroups,function(c,e){var g=c.id;"block"===a.style(a.byId("group_"+e+"_div"),"display")&&(a.byId("group_"+e).checked?(b+=f+g,f=","):(d+=h+g,h=","))}):(h="",this.userGroups&&this.userGroups.length&&a.forEach(this.userGroups,function(a){d+=h+a.id;h=","}));var e=function(b,d,e){arcgisonline.sharing.geow.Content.shareItemByID(b,
{everyone:b&&b.access&&"public"===b.access,org:b&&b.sharing&&"org"===b.sharing.access,groups:d},function(e){if(e&&e.itemId&&e.notSharedWith&&e.notSharedWith.length){var f=b.sharing&&b.sharing.groups||[],g=d.split(","),h=a.filter(g||[],a.hitch(this,function(b){return-1===a.indexOf(f,b)}));0!==h.length&&a.every(e.notSharedWith||[],a.hitch(this,function(b){return-1<a.indexOf(h,b)}))&&a.publish("onNotShareUpdate",e.notSharedWith)}a.publish("onShareUpdate",[c?"shared":"private"])},function(b){a.publish("onShareUpdate",
[b])})},k=this.items[0];0<d.length?arcgisonline.sharing.geow.Content.unshareItemByID(k,{everyone:k&&k.access&&"public"===k.access,org:k&&k.sharing&&"org"===k.sharing.access,groups:d},a.hitch(this,e,k,b)):e(k,b);a.publish("shareOptionsTeardown")},shareItemAsAdmin:function(c){var b="",d="";a.forEach(this.items,function(a){b+=d+a.id;d=","});var f=c=!1;if(a.byId("share-everyone-check_div")&&"block"===a.style(a.byId("share-everyone-check_div"),"display")||"block"===a.style(a.byId("img_share-everyone-check_div"),
"display"))c=g.byId("share-everyone-check").get("checked");if(a.byId("share-account-check_div")&&"block"===a.style(a.byId("share-account-check_div"),"display")||"block"===a.style(a.byId("img_share-account-check_div"),"display"))f=g.byId("share-account-check").get("checked");var h="",e="",k="",l="",m=0;if(g.byId("share-groups-check").get("checked")){var n;if(this.userGroups&&this.userGroups.length)for(m=0;m<this.userGroups.length;m++)n=this.userGroups[m].id,"block"===a.style(a.byId("group_"+m+"_div"),
"display")&&(a.byId("group_"+m).checked?(h+=k+n,k=","):(e+=l+n,l=","));if(this.adminGroups&&this.adminGroups.length&&1<this.lowestAccess)for(var p=0;p<this.adminGroups.length;p++)n=this.adminGroups[p].id,"block"===a.style(a.byId("group_"+(p+m)+"_div"),"display")&&(a.byId("group_"+(p+m)).checked?(h+=k+n,k=","):(e+=l+n,l=","))}else l="",this.userGroups&&this.userGroups.length&&a.forEach(this.userGroups,function(a){e+=l+a.id;l=","}),this.adminGroups&&(this.adminGroups.length&&1<this.lowestAccess)&&a.forEach(this.adminGroups,
function(a){e+=l+a.id;l=","});k=function(c,d,e,f){for(var g=c.length,h=function(){g--;0===g&&a.publish("onShareUpdate",[e?"public":f?"org":d?"shared":"private"])},k={items:b,groups:d,everyone:e,account:f},l=0;l<c.length;l++)arcgisonline.sharing.geow.Content.shareItemByID(c[l],k,h)};if(0<e.length){n={items:b,groups:e};for(m=0;m<this.items.length;m++)arcgisonline.sharing.geow.Content.unshareItemByID(this.items[m],n,a.hitch(this,k,this.items,h,c,f))}else k(this.items,h,c,f);a.publish("shareOptionsTeardown")},
shareItem:function(c){var b="",d="";a.forEach(this.items,function(a){b+=d+a.id;d=","});var f=c=!1;if(a.byId("share-everyone-check_div")&&"block"===a.style(a.byId("share-everyone-check_div"),"display")||"block"===a.style(a.byId("img_share-everyone-check_div"),"display"))c=g.byId("share-everyone-check").get("checked");if(a.byId("share-account-check_div")&&"block"===a.style(a.byId("share-account-check_div"),"display")||"block"===a.style(a.byId("img_share-account-check_div"),"display"))f=g.byId("share-account-check").get("checked");
var h="",e="",k="",l="";g.byId("share-groups-check").get("checked")?this.userGroups&&this.userGroups.length&&a.forEach(this.userGroups,function(b,c){var d=b.id;"block"===a.style(a.byId("group_"+c+"_div"),"display")&&(a.byId("group_"+c).checked?(h+=k+d,k=","):(e+=l+d,l=","))}):(l="",this.userGroups&&this.userGroups.length&&a.forEach(this.userGroups,function(a){e+=l+a.id;l=","}));var m=function(b){a.publish("onShareUpdate",[b])},n=function(c,d,e,f){var g=function(){a.publish("onShareUpdate",[e?"public":
f?"org":d?"shared":"private"])},h={items:b,groups:d,everyone:e,account:f};c&&null!==c?arcgisonline.sharing.geow.Content.shareItemsByUser(c.username?c.username:c.email,h,g):arcgisonline.sharing.geow.Content.shareItems(h,g,m)};if(0<e.length){var p={items:b,groups:e};this.itemUser&&null!==this.itemUser?arcgisonline.sharing.geow.Content.unshareItemsByUser(this.itemUser.username?this.itemUser.username:this.itemUser.email,p,a.hitch(this,n,this.itemUser,h,c,f)):arcgisonline.sharing.geow.Content.unshareItems(p,
a.hitch(this,n,this.itemUser,h,c,f),m)}else n(this.itemUser,h,c,f);a.publish("shareOptionsTeardown")},checkGroup:function(c){-1<c.target.id.indexOf("img_group_")&&(a.style(a.byId(c.target.id+"_div"),"display","none"),a.style(a.byId(c.target.id.substring(4,c.target.id.length)+"_div"),"display","block"));!0===c.target.checked&&-1<c.target.id.indexOf("group_")&&g.byId("share-groups-check").set("checked",!0);a.publish("onClickGroup")},checkGroups:function(){a.publish("onClickGroup")},clickEveryone:function(c){if(!0===
g.byId("share-everyone-check").get("checked"))c=a.byId("share-account-check_div"),this.organization&&(c&&"block"===a.style(c,"display"))&&(a.style(a.byId("img_share-account-check_div"),"display","block"),a.style(c,"display","none")),g.byId("share-everyone-check").set("checked",!0);else{if(this.organization&&esriGeowConfig.userRole&&(!this._isCustomRole||this._roleCanShareToOrg))a.style(a.byId("img_share-account-check_div"),"display","none"),a.style(a.byId("share-account-check_div"),"display","block");
g.byId("share-account-check").set("checked",!0);g.byId("share-everyone-check").set("checked",!1)}a.publish("onClickEveryone")},checkEveryone:function(c){c=a.byId("share-everyone-check_div");a.style(a.byId("img_share-everyone-check_div"),"display","none");a.style(c,"display","block");g.byId("share-everyone-check").set("checked",!0);this.organization&&(c&&"block"===a.style(c,"display"))&&(a.style(a.byId("img_share-account-check_div"),"display","block"),a.style(a.byId("share-account-check_div"),"display",
"none"),g.byId("share-account-check").set("checked",!0));a.publish("onClickEveryone")},clickAccount:function(c){!0===g.byId("share-account-check").get("checked")?(this._orgUserCanSharePublicOrOverride&&("none"===a.style(a.byId("share-everyone-check_div"),"display")&&(a.style(a.byId("img_share-everyone-check_div"),"display","none"),a.style(a.byId("share-everyone-check_div"),"display","block")),g.byId("share-everyone-check").set("checked",!1)),g.byId("share-account-check").set("checked",!0)):g.byId("share-account-check").set("checked",
!1);a.publish("onClickAccount")},checkAccount:function(c){a.style(a.byId("img_share-account-check_div"),"display","none");a.style(a.byId("share-account-check_div"),"display","block");g.byId("share-account-check").set("checked",!0);this._orgUserCanSharePublicOrOverride&&("none"===a.style(a.byId("share-everyone-check_div"),"display")&&(a.style(a.byId("img_share-everyone-check_div"),"display","none"),a.style(a.byId("share-everyone-check_div"),"display","block")),g.byId("share-everyone-check").set("checked",
!1));a.publish("onClickAccount")},isEveryoneChecked:function(){var c=a.byId("share-everyone-check_div"),b=g.byId("share-everyone-check");return c&&"block"===a.style(c,"display")&&!0===b.get("checked")},isAccountChecked:function(){var c=a.byId("share-account-check_div"),b=g.byId("share-account-check");return c&&"block"===a.style(c,"display")&&!0===b.get("checked")},isGroupChecked:function(){if(g.byId("share-groups-check").get("checked"))for(var c=0;c<this.userGroups.length;c++)if("block"===a.style(a.byId("group_"+
c+"_div"),"display")&&a.byId("group_"+c).checked)return!0;return!1},getSharedGroups:function(){return a.filter(this.userGroups||[],function(c,b){var d=c.id;return"block"===a.style(a.byId("group_"+b+"_div"),"display")&&a.byId("group_"+b).checked?d:!1})},_sortFunc:function(a,b){var d=a[this.sortField].toLowerCase(),f=b[this.sortField].toLowerCase();return null===d||null===f||d===f?0:d<f?-1:1}})});