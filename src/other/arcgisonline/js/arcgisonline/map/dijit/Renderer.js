// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/map/dijit/Renderer",["dijit","dojo","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dojox/data/AndOrWriteStore,arcgisonline/sharing/dijit/HelpManager,arcgisonline/sharing/dijit/dialog/ChoiceDlg,arcgisonline/sharing/dijit/dialog/SymbolDlg,arcgisonline/sharing/dijit/dialog/RendererDlg,arcgisonline/sharing/dijit/dialog/RotationDlg,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/RendererGrid,esri/tasks/GenerateRendererTask"],function(r,a,s){a.provide("arcgisonline.map.dijit.Renderer");
a.require("dijit._Widget");a.require("dijit._Templated");a.require("dojox.data.AndOrWriteStore");a.require("arcgisonline.sharing.dijit.HelpManager");a.require("arcgisonline.sharing.dijit.dialog.ChoiceDlg");a.require("arcgisonline.sharing.dijit.dialog.SymbolDlg");a.require("arcgisonline.sharing.dijit.dialog.RendererDlg");a.require("arcgisonline.sharing.dijit.dialog.RotationDlg");a.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");a.require("arcgisonline.sharing.dijit.RendererGrid");a.require("esri.tasks.GenerateRendererTask");
a.declare("arcgisonline.map.dijit.Renderer",[r._Widget,r._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv dojoType\x3d"dijit.layout.BorderContainer" region\x3d"top" style\x3d"height:100%;"\x3e\r\n  \x3cdiv id\x3d"renderer-main" class\x3d"panel panel_left" dojoType\x3d"dijit.layout.ContentPane" region\x3d"center" style\x3d"padding:7px;margin-bottom:-5px;"\x3e\r\n    \x3cdiv id\x3d"rendererHeader" dojotype\x3d"dijit.layout.ContentPane" region\x3d"top"\x3e\r\n      \x3cdiv class\x3d"esriFloatTrailing" style\x3d"display:inline;"\x3e\r\n        \x3ca href\x3d"JavaScript:void(0);" dojoAttachPoint\x3d"_closeBtn" title\x3d"${i18n.close}" class\x3d"panel panel_close panel_collapse"\x3e\x3c/a\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"rendererTitle" class\x3d"esriFloatLeading panel_title"\x3e\r\n        ${i18n.rendererPanelTitle}\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"clear:both; height:1px;"\x3e\x3c/div\x3e\x3c!--border-bottom: #333 thin solid;--\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv dojotype\x3d"dijit.layout.ContentPane" region\x3d"center" id\x3d"rendererPane" style\x3d"padding-top:10px;overflow-y:auto;"\x3e\r\n      \x3cdiv id\x3d"renderer_type"\x3e\r\n        \x3ctable style\x3d"width:100%"\x3e\r\n          \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd valign\x3d"top" colspan\x3d"2"\x3e\r\n    \t\t\t\t\t\t\x3cdiv class\x3d"esriFloatLeading"\x3e${i18n.specifySymbols}\x3c/div\x3e\r\n                \x3cdiv class\x3d"esriFloatTrailing" style\x3d"padding-bottom:5px;" class\x3d"esriItemLinks"\x3e\r\n                  \x3ca id\x3d"renderer-help" href\x3d"" target\x3d"_blank"\x3e${i18n.help}\x3c/a\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd valign\x3d"top" nowrap\x3e\r\n                \x3cdiv id\x3d"rendererTypeLabel" class\x3d"firstColumnDiv" style\x3d"position:relative;height:25px;top:8px;width:57px;"\x3e\r\n                  \x3clabel class\x3d"firstColumnLabel"\x3e\r\n                    ${i18n.useLabel}\r\n                  \x3c/label\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e \r\n                \x3cselect class\x3d"rendererInput" class\x3d"calcite light" dojoAttachPoint\x3d"_rendererType" dojoAttachEvent\x3d"onChange:_onChangeRendererType" dojoType\x3d"dijit.form.Select"\x3e\r\n                  \x3coption value\x3d"simple" selected\x3d"selected"\x3e${i18n.singleSymbol}\x3c/option\x3e\r\n                  \x3coption value\x3d"unique"\x3e${i18n.uniqueSymbol}\x3c/option\x3e\r\n                  \x3coption value\x3d"color"\x3e${i18n.color}\x3c/option\x3e\r\n                  \x3coption value\x3d"size"\x3e${i18n.size}\x3c/option\x3e\r\n                \x3c/select\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"renderer_simple"\x3e\r\n        \x3ctable\x3e\r\n          \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd nowrap\x3e\r\n                \x3cdiv class\x3d"firstColumnDiv"\x3e\r\n                  \x3clabel class\x3d"firstColumnLabel"\x3e\r\n                    ${i18n.symbolLabel}\r\n                  \x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cdiv id\x3d"panelSymbolImage" style\x3d"vertical-align:middle;"\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n        \x3cdiv style\x3d"padding-bottom:3px;"\x3e\r\n          \x3cdiv class\x3d"esriFloatLeading"\x3e\r\n\t          \x3cbutton dojoAttachPoint\x3d"_rendererSimpleChangeSymbolButton" class\x3d"calcite light tiny" dojotype\x3d"dijit.form.Button" type\x3d"button" dojoAttachEvent\x3d"onClick:_onSimpleChangeSymbolClick"\x3e\r\n\t            \x3cspan\x3e${i18n.changeSymbolBtn}\x3c/span\x3e\r\n\t          \x3c/button\x3e\r\n            \x3cbutton dojoAttachPoint\x3d"_rendererSimpleSymbolsButton" dojotype\x3d"dijit.form.DropDownButton" type\x3d"button" class\x3d"calcite transparent tiny" style\x3d"display:none; padding-left:0; padding-right:0;"\x3e\r\n              \x3cspan\x3e${i18n.options}\x3c/span\x3e\r\n              \x3cdiv id\x3d"rendererSimpleMenu" dojotype\x3d"dijit.Menu"\x3e\r\n                \x3cdiv dojotype\x3d"dijit.MenuItem" dojoAttachEvent\x3d"onClick:_onSimpleChangeSymbolClick"\x3e\r\n                    ${i18n.changeSymbolBtn}\r\n                \x3c/div\x3e\r\n                \x3cdiv dojotype\x3d"dijit.MenuItem" dojoAttachPoint\x3d"_rendererSimpleRotationOption" dojoAttachEvent\x3d"onClick:_onClickRendererSimpleRotation"\x3e\r\n                    ${i18n.setRotationAngle}\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/button\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv id\x3d"rendererSimpleApply" class\x3d"esriFloatTrailing"\x3e\r\n            \x3cbutton dojotype\x3d"dijit.form.Button" class\x3d"calcite green tiny" type\x3d"button" dojoAttachEvent\x3d"onClick:_onSaveRenderer"\x3e\r\n              \x3cspan\x3e${i18n.apply}\x3c/span\x3e\r\n            \x3c/button\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv style\x3d"clear:both;"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"renderer_stream" style\x3d"padding-top:15px;"\x3e\r\n          \x3ctable\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd colspan\x3d"2"\x3e\r\n                  \x3cspan\x3e\r\n                    ${i18n.streamMsg}\r\n                  \x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n          \x3ctable style\x3d"padding-top:10px;"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd style\x3d"padding-top:2px;"\x3e\r\n                  \x3cinput dojoAttachPoint\x3d"rendererStreamPreviousCheck" dojoAttachEvent\x3d"onChange:_onChangeStreamPrevious" dojotype\x3d"dijit.form.CheckBox" checked\x3d"false" type\x3d"checkbox" /\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd nowrap\x3e\r\n                  \x3cspan id\x3d"renderer_stream_msg_part1" class\x3d"esriLeadingMargin05"\x3e\r\n                  \x3c/span\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cinput class\x3d"rendererInput" dojoAttachPoint\x3d"rendererStreamMaxTrackPts" dojoAttachEvent\x3d"onChange:_onChangeStreamMaxTrackPts" intermediateChanges\x3d"true" dojoType\x3d"dijit.form.NumberSpinner" value\x3d"5" smallDelta\x3d"1" constraints\x3d"{min:2,max:100,places:0}" style\x3d"width:40px; margin: 0 5px;"/\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd nowrap\x3e\r\n                  \x3cspan id\x3d"renderer_stream_msg_part2"\x3e\r\n                  \x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n          \x3cdiv class\x3d"esriLeadingMargin108"\x3e\r\n            \x3ctable\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd nowrap\x3e\r\n                    \x3cdiv\x3e\r\n                      \x3clabel\x3e\r\n                        ${i18n.symbolLabel}\r\n                      \x3c/label\x3e\r\n                    \x3c/div\x3e\r\n                  \x3c/td\x3e\r\n                  \x3ctd\x3e\r\n                    \x3cdiv id\x3d"panelStreamSymbolImage" style\x3d"vertical-align:middle;"\x3e\r\n                    \x3c/div\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n            \x3ctable\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd style\x3d"padding-top:2px;"\x3e\r\n                    \x3cinput dojoAttachPoint\x3d"rendererStreamConnectCheck" dojoAttachEvent\x3d"onChange:_onChangeStreamConnect" dojotype\x3d"dijit.form.CheckBox" checked\x3d"false" type\x3d"checkbox" /\x3e\r\n                  \x3c/td\x3e\r\n                  \x3ctd\x3e\r\n                    \x3cspan class\x3d"esriLeadingMargin05"\x3e\r\n                      ${i18n.connectObservations}\r\n                    \x3c/span\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n            \x3cdiv class\x3d"esriLeadingMargin108"\x3e\r\n              \x3ctable\x3e\r\n                \x3ctbody\x3e\r\n                  \x3ctr\x3e\r\n                    \x3ctd nowrap\x3e\r\n                      \x3cdiv\x3e\r\n                        \x3clabel\x3e\r\n                          ${i18n.symbolLabel}\r\n                        \x3c/label\x3e\r\n                      \x3c/div\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd width\x3d"10"\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                      \x3cdiv id\x3d"panelStreamLineSymbolImage" style\x3d"vertical-align:middle;"\x3e\r\n                      \x3c/div\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                \x3c/tbody\x3e\r\n              \x3c/table\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"renderer_unique" style\x3d"display:none;"\x3e\r\n        \x3ctable\x3e\r\n          \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd nowrap\x3e\r\n                \x3cdiv class\x3d"firstColumnDiv"\x3e\r\n                  \x3clabel class\x3d"firstColumnLabel"\x3e\r\n                    ${i18n.toShowLabel}\r\n                  \x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cselect class\x3d"rendererInput" dojoAttachPoint\x3d"_rendererUniqueAttribute" dojoAttachEvent\x3d"onChange:_onChangeRendererUniqueAttribute" dojoType\x3d"dijit.form.Select" maxHeight\x3d"150" sortByLabel\x3d"false"\x3e\r\n                \x3c/select\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd nowrap\x3e\r\n                \x3cdiv class\x3d"firstColumnDiv"\x3e\r\n                  \x3clabel class\x3d"firstColumnLabel"\x3e\r\n                    ${i18n.colorsLabel}\r\n                  \x3c/label\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cselect dojoAttachPoint\x3d"_rendererUniqueColor" dojoAttachEvent\x3d"onChange:_onChangeRendererUniqueColor" dojoType\x3d"dijit.form.Select" maxHeight\x3d"150" sortByLabel\x3d"false" class\x3d"rendererUniqueColor"\x3e\r\n                \x3c/select\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n        \x3cdiv class\x3d"rendererCenterButtons"\x3e\r\n          \x3cdiv class\x3d"esriFloatLeading"\x3e\r\n\t\t\t      \x3cbutton dojoAttachPoint\x3d"_rendererUniqueSymbolsButton" dojotype\x3d"dijit.form.DropDownButton" type\x3d"button" class\x3d"calcite transparent tiny"\x3e\r\n\t\t\t        \x3cspan\x3e${i18n.options}\x3c/span\x3e\r\n\t\t\t\t\t\t\t\x3cdiv id\x3d"rendererUniqueMenu" dojotype\x3d"dijit.Menu"\x3e\r\n\t\t\t\t\t\t\t  \x3cdiv dojotype\x3d"dijit.MenuItem" dojoAttachEvent\x3d"onClick:_onClickRendererUniqueSymbolsChange"\x3e\r\n\t\t\t\t\t\t\t      ${i18n.changeAllSymbols}\r\n\t\t\t\t\t\t\t  \x3c/div\x3e\r\n\t\t\t\t\t\t\t  \x3cdiv dojotype\x3d"dijit.MenuItem" dojoAttachEvent\x3d"onClick:_onClickRendererUniqueFlipColors"\x3e\r\n\t\t\t\t\t\t\t      ${i18n.flipColors}\r\n\t\t\t\t\t\t\t  \x3c/div\x3e\r\n                \x3cdiv dojotype\x3d"dijit.MenuItem" dojoAttachPoint\x3d"_rendererUniqueOtherOption" dojoAttachEvent\x3d"onClick:_onClickRendererUniqueOther"\x3e\r\n                    ${i18n.showOtherValues}\r\n                \x3c/div\x3e\r\n                \x3cdiv dojotype\x3d"dijit.MenuItem" dojoAttachPoint\x3d"_rendererUniqueRotationOption" dojoAttachEvent\x3d"onClick:_onClickRendererUniqueRotation"\x3e\r\n                    ${i18n.setRotationAngle}\r\n                \x3c/div\x3e\r\n\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t      \x3c/button\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n\t          \x3cbutton dojoAttachPoint\x3d"_rendererUniqueApplyButton" dojotype\x3d"dijit.form.Button" class\x3d"calcite green tiny" type\x3d"button" dojoAttachEvent\x3d"onClick:_onSaveRenderer"\x3e\r\n\t            \x3cspan\x3e${i18n.apply}\x3c/span\x3e\r\n\t          \x3c/button\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"rendererUniqueRendererGridDiv" class\x3d"rendererList" style\x3d"clear:both;"\x3e\r\n          \x3cdiv id\x3d"rendererUniqueRendererGrid"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"renderer_classBreaks" style\x3d"display:none;"\x3e\r\n        \x3ctable\x3e\r\n          \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd nowrap\x3e\r\n                \x3cdiv class\x3d"firstColumnDiv"\x3e\r\n                  \x3clabel class\x3d"firstColumnLabel"\x3e\r\n                    ${i18n.toShowLabel}\r\n                  \x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd colspan\x3d"2"\x3e\r\n                \x3cselect class\x3d"rendererInput" dojoAttachPoint\x3d"_rendererClassBreaksAttribute" dojoAttachEvent\x3d"onChange:_onChangeRendererClassBreaksAttribute" dojoType\x3d"dijit.form.Select" maxHeight\x3d"150" sortByLabel\x3d"false"\x3e\r\n                \x3c/select\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr id\x3d"renderer_classBreaks_normalizedBy" style\x3d"display:none;"\x3e\r\n              \x3ctd nowrap\x3e\r\n                \x3cdiv class\x3d"firstColumnDiv"\x3e\r\n                  \x26nbsp;\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd style\x3d"padding-top: 3px;" nowrap\x3e\r\n                \x3cdiv class\x3d"secondColumnDiv" style\x3d"width:100px;"\x3e\r\n                  \x3clabel class\x3d"secondColumnLabel" title\x3d"${i18n.normalizedHelp}"\x3e\r\n                    ${i18n.normalizedBy}\x26nbsp;\r\n                  \x3c/label\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd style\x3d"padding-top: 3px;"\x3e\r\n                \x3cdiv\x3e\r\n                  \x3cselect class\x3d"rendererInput" dojoAttachPoint\x3d"_rendererClassBreaksNormalizedBy" dojoAttachEvent\x3d"onChange:_onChangeRendererClassBreaksNormalizedBy" dojoType\x3d"dijit.form.Select" maxHeight\x3d"150" sortByLabel\x3d"false"\x3e\r\n                  \x3c/select\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd valign\x3d"top" nowrap\x3e\r\n                \x3cdiv class\x3d"firstColumnDiv" style\x3d"position:relative;height:30px;top:8px"\x3e\r\n                  \x3clabel class\x3d"firstColumnLabel"\x3e\r\n                    ${i18n.byLabel}\r\n                  \x3c/label\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd colspan\x3d"2"\x3e\r\n                \x3cselect class\x3d"rendererInput" dojoAttachPoint\x3d"_rendererClassBreaksMethod" dojoAttachEvent\x3d"onChange:_onChangeRendererClassBreaksMethod" dojoType\x3d"dijit.form.Select"\x3e\r\n                  \x3coption value\x3d"natural" selected\x3d"selected"\x3e${i18n.naturalBreaks}\x3c/option\x3e\r\n                  \x3coption value\x3d"equal"\x3e${i18n.equalInterval}\x3c/option\x3e\r\n                  \x3coption value\x3d"stdDev"\x3e${i18n.standardDeviation}\x3c/option\x3e\r\n                  \x3coption value\x3d"quantile"\x3e${i18n.quantile}\x3c/option\x3e\r\n                \x3c/select\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"renderer_color" style\x3d"display:none;"\x3e\r\n        \x3ctable\x3e\r\n          \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd nowrap\x3e\r\n                \x3cdiv class\x3d"firstColumnDiv"\x3e\r\n                  \x3clabel class\x3d"firstColumnLabel"\x3e\r\n                    ${i18n.withLabel}\r\n                  \x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cdiv id\x3d"rendererColorBreaksClassesDiv"\x3e\r\n\t                \x3cinput class\x3d"rendererInput" dojoAttachPoint\x3d"_rendererColorBreaks" dojoAttachEvent\x3d"onChange:_onChangeRendererColorBreaks" intermediateChanges\x3d"true" dojoType\x3d"dijit.form.NumberSpinner" value\x3d"5" smallDelta\x3d"1" constraints\x3d"{min:1,max:10,places:0}" style\x3d"width:40px;"/\x3e\r\n\t                \x3clabel\x3e${i18n.classes}\x3c/label\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv id\x3d"rendererColorBreaksIntervalDiv" style\x3d"display:none;"\x3e\r\n                  \x3cselect class\x3d"rendererInput" dojoAttachPoint\x3d"_rendererColorInterval" dojoAttachEvent\x3d"onChange:_onChangeRendererColorInterval" dojoType\x3d"dijit.form.Select" style\x3d"width:50px;"\x3e\r\n                    \x3coption value\x3d"0.33"\x3e0.33\x3c/option\x3e\r\n                    \x3coption value\x3d"0.25"\x3e0.25\x3c/option\x3e\r\n                    \x3coption value\x3d"0.5"\x3e0.5\x3c/option\x3e\r\n                    \x3coption value\x3d"1" selected\x3d"selected"\x3e1\x3c/option\x3e\r\n                  \x3c/select\x3e\r\n                  \x3clabel\x3e${i18n.intervals}\x3c/label\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd nowrap\x3e\r\n                \x3cdiv class\x3d"firstColumnDiv"\x3e\r\n                  \x3clabel class\x3d"firstColumnLabel"\x3e\r\n                    ${i18n.colorsLabel}\r\n                  \x3c/label\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cselect dojoAttachPoint\x3d"_rendererColorColor" dojoAttachEvent\x3d"onChange:_onChangeRendererColorColor" dojoType\x3d"dijit.form.Select" maxHeight\x3d"150" sortByLabel\x3d"false" class\x3d"rendererColorColor"\x3e\r\n                \x3c/select\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n        \x3cdiv class\x3d"rendererCenterButtons"\x3e\r\n          \x3cdiv class\x3d"esriFloatLeading"\x3e\r\n            \x3cbutton dojoAttachPoint\x3d"_rendererColorSymbolsButton" dojotype\x3d"dijit.form.DropDownButton" type\x3d"button" class\x3d"calcite transparent tiny"\x3e\r\n              \x3cspan\x3e${i18n.options}\x3c/span\x3e\r\n              \x3cdiv id\x3d"rendererColorMenu" dojotype\x3d"dijit.Menu"\x3e\r\n                \x3cdiv dojotype\x3d"dijit.MenuItem" dojoAttachEvent\x3d"onClick:_onClickRendererColorSymbolsChange"\x3e\r\n                    ${i18n.changeAllSymbols}\r\n                \x3c/div\x3e\r\n                \x3cdiv dojotype\x3d"dijit.MenuItem" dojoAttachEvent\x3d"onClick:_onClickRendererColorFlipColors"\x3e\r\n                    ${i18n.flipColors}\r\n                \x3c/div\x3e\r\n                \x3cdiv dojotype\x3d"dijit.MenuItem" dojoAttachPoint\x3d"_rendererColorOtherOption" dojoAttachEvent\x3d"onClick:_onClickRendererColorOther"\x3e\r\n                    ${i18n.showOtherValues}\r\n                \x3c/div\x3e\r\n                \x3cdiv dojotype\x3d"dijit.MenuItem" dojoAttachPoint\x3d"_rendererColorRotationOption" dojoAttachEvent\x3d"onClick:_onClickRendererColorRotation"\x3e\r\n                    ${i18n.setRotationAngle}\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/button\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n            \x3cbutton dojoAttachPoint\x3d"_rendererColorApplyButton" dojotype\x3d"dijit.form.Button" class\x3d"calcite green tiny" type\x3d"button" dojoAttachEvent\x3d"onClick:_onSaveRenderer"\x3e\r\n              \x3cspan\x3e${i18n.apply}\x3c/span\x3e\r\n            \x3c/button\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"rendererColorRendererGridDiv" class\x3d"rendererList" style\x3d"clear:both;"\x3e\r\n          \x3cdiv id\x3d"rendererColorRendererGrid"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"renderer_size" style\x3d"display:none;"\x3e\r\n        \x3ctable\x3e\r\n          \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd nowrap\x3e\r\n                \x3cdiv class\x3d"firstColumnDiv"\x3e\r\n                  \x3clabel class\x3d"firstColumnLabel"\x3e\r\n                    ${i18n.withLabel}\r\n                  \x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n              \t\x3cdiv id\x3d"rendererSizeBreaksClassesDiv"\x3e\r\n\t                \x3cinput class\x3d"rendererInput" dojoAttachPoint\x3d"_rendererSizeBreaks" dojoAttachEvent\x3d"onChange:_onChangeRendererSizeBreaks" intermediateChanges\x3d"true" dojoType\x3d"dijit.form.NumberSpinner" value\x3d"5" smallDelta\x3d"1" constraints\x3d"{min:1,max:10,places:0}" style\x3d"width:40px;"/\x3e\r\n\t  \t\t\t\t\t\t\t\x3clabel\x3e${i18n.classes}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3cdiv id\x3d"rendererSizeBreaksIntervalDiv" style\x3d"display:none;"\x3e\r\n\t                \x3cselect class\x3d"rendererInput" dojoAttachPoint\x3d"_rendererSizeInterval" dojoAttachEvent\x3d"onChange:_onChangeRendererSizeInterval" dojoType\x3d"dijit.form.Select" style\x3d"width:50px;"\x3e\r\n\t                  \x3coption value\x3d"0.33"\x3e0.33\x3c/option\x3e\r\n\t                  \x3coption value\x3d"0.25"\x3e0.25\x3c/option\x3e\r\n\t                  \x3coption value\x3d"0.5"\x3e0.5\x3c/option\x3e\r\n\t                  \x3coption value\x3d"1" selected\x3d"selected"\x3e1\x3c/option\x3e\r\n\t                \x3c/select\x3e\r\n\t\t\t\t\t\t\t\t\t\x3clabel\x3e${i18n.intervals}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n        \x3cdiv class\x3d"rendererCenterButtons"\x3e\r\n          \x3cdiv class\x3d"esriFloatLeading"\x3e\r\n            \x3cbutton dojoAttachPoint\x3d"_rendererSizeSymbolsButton" dojotype\x3d"dijit.form.DropDownButton" type\x3d"button" class\x3d"calcite transparent tiny"\x3e\r\n              \x3cspan\x3e${i18n.options}\x3c/span\x3e\r\n              \x3cdiv id\x3d"rendererSizeMenu" dojotype\x3d"dijit.Menu"\x3e\r\n                \x3cdiv dojotype\x3d"dijit.MenuItem" dojoAttachEvent\x3d"onClick:_onClickRendererSizeSymbolsChange"\x3e\r\n                    ${i18n.changeAllSymbols}\r\n                \x3c/div\x3e\r\n                \x3cdiv dojotype\x3d"dijit.MenuItem" dojoAttachPoint\x3d"_rendererSizeOtherOption" dojoAttachEvent\x3d"onClick:_onClickRendererSizeOther"\x3e\r\n                    ${i18n.showOtherValues}\r\n                \x3c/div\x3e\r\n                \x3cdiv dojotype\x3d"dijit.MenuItem" dojoAttachPoint\x3d"_rendererSizeBackgroundOption" dojoAttachEvent\x3d"onClick:_onClickRendererSizeBackground"\x3e\r\n                    ${i18n.showBackground}\r\n                \x3c/div\x3e\r\n                \x3cdiv dojotype\x3d"dijit.MenuItem" dojoAttachPoint\x3d"_rendererSizeRotationOption" dojoAttachEvent\x3d"onClick:_onClickRendererSizeRotation"\x3e\r\n                    ${i18n.setRotationAngle}\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/button\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n            \x3cbutton dojoAttachPoint\x3d"_rendererSizeApplyButton"  class\x3d"calcite green tiny" dojotype\x3d"dijit.form.Button" type\x3d"button" dojoAttachEvent\x3d"onClick:_onSaveRenderer"\x3e\r\n              \x3cspan\x3e${i18n.apply}\x3c/span\x3e\r\n            \x3c/button\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"rendererSizeRendererGridDiv" class\x3d"rendererList" style\x3d"clear:both;"\x3e\r\n          \x3cdiv id\x3d"rendererSizeRendererGrid"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\t    \x3cdiv id\x3d"rendererListLoading" style\x3d"display:none;position:absolute;background-color:white;"\x3e\r\n\t      \x3cspan style\x3d"line-height:40px"\x3e\x26nbsp;\x26nbsp;\x26nbsp;${i18n.loadingMsg}\x26nbsp;\x26nbsp;\x26nbsp;\x3c/span\x3e\r\n\t    \x3c/div\x3e\r\n      \x3cdiv id\x3d"rendererListError" style\x3d"display:none;position:absolute;background-color:white;"\x3e\r\n        \x3cspan style\x3d"line-height:40px"\x3e\x26nbsp;\x26nbsp;\x26nbsp;${i18n.errors.genericError.message}\x26nbsp;\x26nbsp;\x26nbsp;\x3c/span\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"rendererContentClose"\x3e\r\n      \x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" class\x3d"calcite blue" id\x3d"rendererContent-close" dojoAttachPoint\x3d"_doneChangingButton" dojoAttachEvent\x3d"onClick:_onDoneChangingSymbols"\x3e\x3cspan\x3e${i18n.doneChangingSymbolsBtn}\x3c/span\x3e\x3c/button\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"rendererContentFooter" dojoType\x3d"dijit.layout.ContentPane" region\x3d"bottom" style\x3d"height:40px; padding: 0 5px 0 5px;"\x3e\r\n    \x3cdiv class\x3d"footer" id\x3d"rendererFooter" dojotype\x3d"arcgisonline.sharing.dijit.SiteFooterMap" style\x3d"white-space:normal;"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
_rConnects:null,i18n:null,disableAllEvents:!0,container:null,subLayerId:null,mapLayer:null,layer:null,features:null,renderer:null,symbol:null,streamPreviousSymbol:null,streamConnectLineSymbol:null,colorSetUniqueResult:null,colorSetClassBreaksResult:null,onSymbolCancelHandler:null,onSymbolChangeHandler:null,onRotationChangeHandler:null,applyRendererEditsHandler:null,saveRendererHandler:null,colorSetGroupId:null,colorSetItems:null,rendererUniqueColorStore:null,rendererColorColorStore:null,attributesStore:null,
classBreaksMinSize:6,classBreaksEndSize:0,classBreaksIncreaseSize:4,currentClassBreakType:null,datePattern:null,currentColorOrderIsDefault:!0,rendererHasUserColors:!1,pattern:"#,###,###,##0.##",defaultPointSymbols:[{name:"Circle",type:"esriSMS",style:"esriSMSCircle",color:[0,0,128,128],size:6,outline:{color:[0,0,128,255],width:0}},{name:"Square",type:"esriSMS",style:"esriSMSSquare",color:[0,0,128,128],size:6,outline:{color:[0,0,128,255],width:0}},{name:"Diamond",type:"esriSMS",style:"esriSMSDiamond",
color:[0,0,128,128],size:6,outline:{color:[0,0,128,255],width:0}},{name:"Cross",type:"esriSMS",style:"esriSMSCross",color:[0,0,128,128],size:6,outline:{color:[0,0,128,255],width:1}},{name:"X",type:"esriSMS",style:"esriSMSX",color:[0,0,128,128],size:6,outline:{color:[0,0,128,255],width:1}}],pointJson:{type:"esriSMS",style:"esriSMSCircle",color:[34,114,162,128],size:6,outline:{color:[34,114,162,255],width:1}},pointStreamJson:{type:"esriSMS",style:"esriSMSCircle",color:[5,112,176,204],size:6,outline:{color:[255,
255,255,255],width:1}},lineJson:{type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:2},lineStreamJson:{type:"esriSLS",style:"esriSLSSolid",color:[200,200,200,255],width:2},polygonJson:{type:"esriSFS",style:"esriSFSSolid",color:[128,128,128,128],outline:{type:"esriSLS",style:"esriSLSSolid",color:[128,128,128,255],width:0.75}},backgroundPolygonJson:{type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,0],outline:{type:"esriSLS",style:"esriSLSSolid",color:[128,128,128,255],width:0.75}},markerJson:{type:"esriPMS",
url:"/Symbols/Basic/RedSphere.png",imageData:"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQBQYWludC5ORVQgdjMuNS4xTuc4+QAAB3VJREFUeF7tmPlTlEcexnve94U5mANQbgQSbgiHXHINlxpRIBpRI6wHorLERUmIisKCQWM8cqigESVQS1Kx1piNi4mW2YpbcZONrilE140RCTcy3DDAcL/zbJP8CYPDL+9Ufau7uqb7eZ7P+/a8PS8hwkcgIBAQCAgEBAICAYGAQEAgIBAQCAgEBAICAYGAQEAgIBAQCDx/AoowKXFMUhD3lQrioZaQRVRS+fxl51eBTZUTdZ41U1Rox13/0JF9csGJ05Qv4jSz/YPWohtvLmSKN5iTGGqTm1+rc6weICOBRbZs1UVnrv87T1PUeovxyNsUP9P6n5cpHtCxu24cbrmwKLdj+osWiqrVKhI0xzbmZ7m1SpJ+1pFpvE2DPvGTomOxAoNLLKGLscZYvB10cbYYjrJCb7A5mrxleOBqim+cWJRakZY0JfnD/LieI9V1MrKtwokbrAtU4Vm0A3TJnphJD4B+RxD0u0LA7w7FTE4oprOCMbklEGNrfdGf4IqnQTb4wc0MFTYibZqM7JgjO8ZdJkpMln/sKu16pHZGb7IfptIWg389DPp9kcChWODoMuDdBOhL1JgpisbUvghM7AqFbtNiaFP80RLnhbuBdqi0N+1dbUpWGde9gWpuhFi95yL7sS7BA93JAb+Fn8mh4QujgPeTgb9kAZf3Apd2A+fXQ38yHjOHozB1IAJjOSEY2RSIwVUv4dd4X9wJccGHNrJ7CYQ4GGjLeNNfM+dyvgpzQstKf3pbB2A6m97uBRE0/Ergcxr8hyqg7hrwn0vAtRIKIRX6Y2pMl0RhIj8co9nBGFrvh55l3ngU7YObng7IVnFvGS+BYUpmHziY/Ls2zgP9SX50by/G9N5w6I+ogYvpwK1SoOlHQNsGfWcd9Peqof88B/rTyzF9hAIopAByQzC0JQB9ST5oVnvhnt+LOGsprvUhxNIwa0aY7cGR6Cp7tr8+whkjawIxkRWC6YJI6N+lAKq3Qf/Tx+B77oGfaQc/8hB8w2Xwtw9Bf3kzZspXY/JIDEbfpAB2BKLvVV90Jvjgoac9vpRxE8kciTVCBMMkNirJ7k/tRHyjtxwjKV4Yp3t/6s+R4E+/DH3N6+BrS8E314Dvvg2+/Sb4hxfBf5sP/up2TF3ZhonK1zD6dhwGdwail26DzqgX8MRKiq9ZBpkSkmeYOyPM3m9Jjl+1Z9D8AgNtlAq6bZ70qsZi+q+bwV/7I/hbB8D/dAr8Axq89iz474p/G5++koHJy1sx/lkGdBc2YjA3HF0rHNHuboomuQj/5DgclIvOGCGCYRKFFuTMV7YUAD3VDQaLMfyqBcZORGPy01QKYSNm/rYV/Nd/Av9NHvgbueBrsjDzRQamKKDxT9Kgq1iLkbIUDOSHoiNcgnYHgnYZi+9ZExSbiSoMc2eE2flKcuJLa4KGRQz6/U0wlGaP0feiMH4uFpMXEjBVlYjp6lWY+SSZtim0kulYMiYuJEJXuhTDJ9UYPByOvoIwdCxfgE4bAo0Jh39xLAoVpMwIEQyTyFCQvGpLon9sJ0K3J4OBDDcMH1dj9FQsxkrjMPFRPCbOx2GyfLal9VEcxstioTulxjAFNfROJPqLl6Bnfyg6V7ugz5yBhuHwrZjBdiU5YJg7I8wOpifAKoVIW7uQ3rpOBH2b3ekVjYT2WCRG3o+mIGKgO0OrlIaebU/HYOQDNbQnojB4NJyGD0NPfjA0bwTRE6Q7hsUcWhkWN8yZqSQlWWGECAZLmJfJmbrvVSI8taK37xpbdB/wQW8xPee/8xIGjvlj8IQ/hk4G0JbWcX8MHPVDX4kveoq8ocn3xLM33NCZRcPHOGJYZIKfpQyq7JjHS6yJjcHujLHADgkpuC7h8F8zEVqXSNC2awE69lqhs8AamkO26HrbDt2H7dBVQov2NcW26CiwQtu+BWjdY4n2nZboTbfCmKcCnRyDO/YmyLPnDlHvjDH8G6zhS9/wlEnYR7X00fWrFYuWdVI0ZpuhcbcczW/R2qdAcz6t/bRov4mONeaaoYl+p22rHF0bVNAmKtBvweIXGxNcfFH8eNlC4m6wMWMusEnKpn5hyo48pj9gLe4SNG9QoGGLAk8z5XiaJUd99u8122/IpBA2K9BGg2vWWKAvRYVeLzEa7E1R422m2+MsSTem97nSYnfKyN6/mzATv7AUgqcMrUnmaFlLX3ysM0fj+t/b5lQLtK22QEfyAmiSLKFZpUJ7kBRPXKW4HqCYynWVHKSG2LkyZex1uO1mZM9lKem9Tx9jjY5iNEYo0bKMhn7ZAu0r6H5PpLXCAq0rKJClSjSGynE/QIkrQYqBPe6S2X+AJsY2Ped6iWZk6RlL0c2r5szofRsO9R5S1IfQLRCpQL1aifoYFerpsbkuTImaUJXuXIDiH6/Ys8vm3Mg8L2i20YqsO7fItKLcSXyn0kXccclVqv3MS6at9JU/Ox+ouns+SF6Z4cSupz7l8+z1ucs7LF1AQjOdxfGZzmx8Iu1TRcfnrioICAQEAgIBgYBAQCAgEBAICAQEAgIBgYBAQCAgEBAICAQEAv8H44b/6ZiGvGAAAAAASUVORK5CYII\x3d",
contentType:"image/png",width:15,height:15},constructor:function(a,c){a&&(a.containerNode&&(this.container=a.containerNode),this.subLayerId=a.subLayerId,this.mapLayer=a.mapLayer,this.isFeatColl=arcgisonline.map.featColl.isFeatureCollection(this.mapLayer),this.isCSV=this.mapLayer.layer instanceof esri.layers.CSVLayer,this.isSL=this.mapLayer.layer instanceof esri.layers.StreamLayer,this.hasDynamic=arcgisonline.map.main.hasDynamicLayers(this.mapLayer),this._rConnects=[])},destroy:function(){this.onRendererUpdateHandler&&
a.unsubscribe(this.onRendererUpdateHandler);this.onSymbolChangeHandler&&a.unsubscribe(this.onSymbolChangeHandler);this.onSymbolCancelHandler&&a.unsubscribe(this.onSymbolCancelHandler);this.applyRendererEditsHandler&&a.unsubscribe(this.applyRendererEditsHandler);this.saveRendererHandler&&a.unsubscribe(this.saveRendererHandler);this.onRotationChangeHandler&&a.unsubscribe(this.onRotationChangeHandler);this.uniqueValueRendererGrid&&this.uniqueValueRendererGrid.getUpdatedRenderer();this.classBreaksColorRendererGrid&&
this.classBreaksColorRendererGrid.getUpdatedRenderer();this.classBreaksSizeRendererGrid&&this.classBreaksSizeRendererGrid.getUpdatedRenderer();a.forEach(this._rConnects,a.disconnect);delete this._rConnects;this.inherited(arguments)},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.clone(a.i18n.getLocalization("arcgisonline","arcgisonline").common);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").generalDlg);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline",
"arcgisonline").viewer.time);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").rendererPanel)},postCreate:function(){this.container.addChild(r.byId("rendererPanel"));this.loadConnections()},loadConnections:function(){this._rConnects.push(a.connect(r.byId("leftContentPanel"),"resize",this,"adjustHeight"));this.onRendererUpdateHandler=a.subscribe("_onRendererUpdate",a.hitch(this,"_onRendererUpdate"));this.applyRendererEditsHandler=a.subscribe("applyRendererEdits",a.hitch(this,
"_onSaveRenderer"));this.saveRendererHandler=a.subscribe("saveRenderer",a.hitch(this,"_onSaveRenderer"));var b=arcgisonline.sharing.dijit.HelpManager.prototype.statics.getInstance(),c=setInterval(a.hitch(this,function(){a.byId("renderer-help")&&b.isLoaded()&&(clearInterval(c),a.byId("renderer-help").href=b.getHelpUrl("120000470"))}),200);a.connect(this._closeBtn,"onclick",this,"onClose")},onClose:function(a){a.preventDefault();arcgisonline.map.leftPanel.openLeftTOCPanel()},startup:function(){this.inherited(arguments);
this._init()},_init:function(){a.style(a.byId("renderer_stream"),"display","none");this.isHosted=!1;if(this.mapLayer.layer instanceof esri.layers.GeoRSSLayer)-1==this.subLayerId&&(this.subLayerId=0),this.layer=this.mapLayer.layer.getFeatureLayers()[this.subLayerId],a.style(this._rendererType.domNode,"display","none"),a.style(a.byId("rendererTypeLabel"),"display","none");else if(this.hasDynamic)this.layer=this.mapLayer.layer.dynamicLayerInfos[this.subLayerId],a.forEach(this.mapLayer.layersInfo.layers,
function(a){a.id==this.layer.source.mapLayerId&&(this.serviceLayerInfo=a)},this);else if(this.mapLayer.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer)this.layer=this.mapLayer.layersInfo.layers[this.subLayerId];else if(this.isSL){this.layer=this.mapLayer.layer;a.style(this._rendererType.domNode,"display","none");a.style(a.byId("rendererTypeLabel"),"display","none");if(this.mapLayer.serviceInfo.timeInfo&&this.mapLayer.serviceInfo.timeInfo.trackIdField){var b=this.i18n.drawPastObservations,
c=b.indexOf("${"),d=b.indexOf("}");a.byId("renderer_stream_msg_part1").innerHTML=b.substring(0,c);a.byId("renderer_stream_msg_part2").innerHTML=b.substring(d+1);a.style(a.byId("renderer_stream"),"display","");this.mapLayer.layer.renderer.observationRenderer?(this.rendererStreamPreviousCheck.set("checked",!0),this.streamPreviousSymbol=esri.symbol.fromJson(this.mapLayer.layer.renderer.observationRenderer.symbol.toJson()),this.mapLayer.layer.renderer.trackRenderer?(this.rendererStreamConnectCheck.set("checked",
!0),this.streamConnectLineSymbol=esri.symbol.fromJson(this.mapLayer.layer.renderer.trackRenderer.symbol.toJson())):(this.rendererStreamConnectCheck.set("checked",!1),this.streamConnectLineSymbol=esri.symbol.fromJson(this.lineStreamJson))):(this.rendererStreamPreviousCheck.set("checked",!1),this.rendererStreamConnectCheck.set("checked",!1),this.streamPreviousSymbol=esri.symbol.fromJson(this.pointStreamJson),this.streamConnectLineSymbol=esri.symbol.fromJson(this.lineStreamJson));this.mapLayer.layerDefinition&&
esri.isDefined(this.mapLayer.layerDefinition.maximumTrackPoints)&&2<this.mapLayer.layerDefinition.maximumTrackPoints?this.rendererStreamMaxTrackPts.set("value",this.mapLayer.layerDefinition.maximumTrackPoints-1):2<this.mapLayer.layer.maximumTrackPoints?this.rendererStreamMaxTrackPts.set("value",this.mapLayer.layer.maximumTrackPoints-1):this.rendererStreamMaxTrackPts.set("value",5);arcgisonline.map.symbol.drawSymbol(a.byId("panelStreamLineSymbolImage"),this.streamConnectLineSymbol,this.template);arcgisonline.map.symbol.drawSymbol(a.byId("panelStreamSymbolImage"),
this.streamPreviousSymbol,this.template)}this._rConnects.push(a.connect(a.byId("panelStreamSymbolImage"),"onclick",a.hitch(this,"_onSimpleStreamChangeSymbolClick")));this._rConnects.push(a.connect(a.byId("panelStreamLineSymbolImage"),"onclick",a.hitch(this,"_onSimpleStreamLineChangeSymbolClick")))}else this.mapLayer.layer?(this.layer=this.mapLayer.layer,this.isHosted=arcgisonline.sharing.util.isHostedService(this.layer.url)):this.layer=this.mapLayer.layers[this.subLayerId];b=!1;c=this._getLayerFields();
for(d=0;d<c.length;d++){var e=c[d];if("esriFieldTypeSingle"==e.type||"esriFieldTypeDouble"==e.type||"esriFieldTypeInteger"==e.type||"esriFieldTypeSmallInteger"==e.type){b=!0;break}}this.geometryType=this.layer.geometryType;this.hasDynamic&&(this.geometryType=this.serviceLayerInfo.geometryType);b||(this._rendererType.removeOption(3),this._rendererType.removeOption(2));this.renderer=this.layer.renderer;this.layer.drawingInfo?this.renderer=esri.renderer.fromJson(this.layer.drawingInfo.renderer):this.layer.layerDefinition&&
this.layer.layerDefinition.drawingInfo?this.renderer=esri.renderer.fromJson(this.layer.layerDefinition.drawingInfo.renderer):this.serviceLayerInfo&&(this.renderer=esri.renderer.fromJson(this.serviceLayerInfo.drawingInfo.renderer));"esri.renderer.TemporalRenderer"==this.renderer.declaredClass?this._initSimpleRenderer():"esri.renderer.SimpleRenderer"==this.renderer.declaredClass?"simple"==this._rendererType.get("value")?this._initSimpleRenderer():this._rendererType.set("value","simple"):"esri.renderer.UniqueValueRenderer"==
this.renderer.declaredClass?this._rendererType.set("value","unique"):"esri.renderer.ClassBreaksRenderer"==this.renderer.declaredClass&&this._guessClassBreakSettings();this._rConnects.push(a.connect(a.byId("panelSymbolImage"),"onclick",a.hitch(this,"_onSimpleChangeSymbolClick")));setTimeout(a.hitch(this,function(){this.disableAllEvents=!1}),2E3)},_onChangeRendererType:function(b){a.style(a.byId("renderer_simple"),"display","none");a.style(a.byId("renderer_unique"),"display","none");a.style(a.byId("renderer_classBreaks"),
"display","none");a.style(a.byId("renderer_color"),"display","none");a.style(a.byId("renderer_size"),"display","none");a.style(this._rendererSizeBackgroundOption.domNode,"display","none");a.style(this._rendererSimpleRotationOption.domNode,"display","none");a.style(this._rendererUniqueRotationOption.domNode,"display","none");a.style(this._rendererColorRotationOption.domNode,"display","none");a.style(this._rendererSizeRotationOption.domNode,"display","none");this._hideLoading();b=this._rendererType.get("value");
"simple"===b?(a.style(a.byId("renderer_simple"),"display","block"),a.style(this._rendererSimpleChangeSymbolButton,"display",""),a.style(this._rendererSimpleSymbolsButton.domNode,"display","none"),this._initSimpleRenderer()):"unique"===b?(a.style(a.byId("renderer_unique"),"display","block"),"esri.renderer.UniqueValueRenderer"==this.renderer.declaredClass?this._initUniqueRenderer(!0):this._initUniqueRenderer(!1)):"color"===b?(a.style(a.byId("renderer_classBreaks"),"display","block"),a.style(a.byId("renderer_color"),
"display","block"),this._updateClassesOrInterval(),"esri.renderer.ClassBreaksRenderer"==this.renderer.declaredClass&&"color"==this.currentClassBreakType?this._initClassBreaksColorRenderer(!0):this._initClassBreaksColorRenderer(!1)):"size"===b&&(a.style(a.byId("renderer_classBreaks"),"display","block"),a.style(a.byId("renderer_size"),"display","block"),"esriGeometryPolygon"===this.geometryType&&a.style(this._rendererSizeBackgroundOption.domNode,"display",""),this._updateClassesOrInterval(),"esri.renderer.ClassBreaksRenderer"==
this.renderer.declaredClass&&"size"==this.currentClassBreakType?this._initClassBreaksSizeRenderer(!0):this._initClassBreaksSizeRenderer(!1));this.currentColorOrderIsDefault=!0;this.adjustHeight()},_onRendererUpdate:function(){leftPanel&&(leftPanel.deleteLegendStack(),leftPanel.deleteContentStack());this.mapLayer.rendererChanged=!0},_onSaveRenderer:function(b,c,d){this._isLoading()?(esri.isDefined(c)||(c=0),10>c&&setTimeout(a.hitch(this,"_onSaveRenderer",b,c+1),500)):esri.isDefined(c)?setTimeout(a.hitch(this,
"_onSaveRenderer"),500):"rendererStack"===arcgisonline.map.leftPanel.getLeftContentPanelStack()&&this._rendererType&&(this.isFeatColl||this.isCSV||this.isSL?this._onSaveRendererGo(null,d):(b=this._rendererType.get("value"),"unique"===b&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||"unique"!==b&&"esri.renderer.UniqueValueRenderer"===this.renderer.declaredClass?arcgisonline.map.mapUtil.checkHostedFSAccess(this.mapLayer,a.hitch(this,function(){var b=this.layer.getEditCapabilities();
!this.layer.isEditable()||!b.canCreate&&(b.canUpdate||b.canDelete)?this._onSaveRendererGo(!0,d):arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance().show({title:this.i18n.warning,message:this.i18n.featureTypesAndTemplatesWarning,choiceOneTitle:this.i18n.yesLabel,choiceOneHandler:a.hitch(this,function(){this._onSaveRendererGo(!0,d)}),choiceTwoTitle:this.i18n.noLabel,choiceTwoHandler:a.hitch(this,function(){})})}),a.hitch(this,function(){this._onSaveRendererGo(null,d)})):"unique"===
b?(b=this._rendererUniqueAttribute.get("value"),b!==this.i18n.selectAField&&b!==this.renderer.attributeField?arcgisonline.map.mapUtil.checkHostedFSAccess(this.mapLayer,a.hitch(this,function(){var b=this.layer.getEditCapabilities();!this.layer.isEditable()||!b.canCreate&&(b.canUpdate||b.canDelete)?this._onSaveRendererGo(!0,d):arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance().show({title:this.i18n.warning,message:this.i18n.featureTypesAndTemplatesWarning,choiceOneTitle:this.i18n.yesLabel,
choiceOneHandler:a.hitch(this,function(){this._onSaveRendererGo(!0,d)}),choiceTwoTitle:this.i18n.noLabel,choiceTwoHandler:a.hitch(this,function(){})})}),a.hitch(this,function(){this._onSaveRendererGo(null,d)})):this._onSaveRendererGo(null,d)):this._onSaveRendererGo(null,d)))},_onSaveRendererGo:function(b,c){arcgisonline.map.dynLayer.checkDynamicLayers(this.mapLayer);this.hasDynamic=arcgisonline.map.main.hasDynamicLayers(this.mapLayer);this.isSL||(this.isFeatColl||this.isCSV?arcgisonline.map.edit.removeTypesAndTemplatesOnMapLayer(this.mapLayer):
b&&(arcgisonline.map.edit.removeTypesAndTemplatesOnLayer(this.mapLayer.layer),this.mapLayer.featureTemplatesChanged=!0));a.publish("_onRendererUpdate",[]);var d=this._rendererType.get("value");if("simple"===d)if(this.isSL&&this.rendererStreamPreviousCheck.get("checked")){var d=new esri.renderer.SimpleRenderer(this.symbol),e=new esri.renderer.SimpleRenderer(this.streamPreviousSymbol),f=this.renderer.rotationInfo||(this.renderer.latestObservationRenderer?this.renderer.latestObservationRenderer.rotationInfo:
null);f?(d.setRotationInfo(f),e.setRotationInfo(f)):(d.setRotationInfo(null),e.setRotationInfo(null));this.rendererStreamConnectCheck.get("checked")?(f=new esri.renderer.SimpleRenderer(this.streamConnectLineSymbol),d=new esri.renderer.TemporalRenderer(e,d,f,null)):d=new esri.renderer.TemporalRenderer(e,d,null,null);this.setRenderer(d);this.mapLayer.layerDefinition=this.mapLayer.layerDefinition||{};this.mapLayer.layerDefinition.maximumTrackPoints=this.rendererStreamMaxTrackPts.get("value")+1;this.mapLayer.layer.setMaximumTrackPoints(this.mapLayer.layerDefinition.maximumTrackPoints);
this.mapLayer.maximumTrackPointsChanged=!0}else d=new esri.renderer.SimpleRenderer(this.symbol),this.renderer.rotationInfo&&d.setRotationInfo(this.renderer.rotationInfo),this.setRenderer(d),a.style(a.byId("rendererSimpleApply"),"display","none"),this.isSL&&(this.mapLayer.layerDefinition&&esri.isDefined(this.mapLayer.layerDefinition.maximumTrackPoints)&&1!==this.mapLayer.layerDefinition.maximumTrackPoints)&&(this.mapLayer.maximumTrackPointsChanged=!0,this.mapLayer.layerDefinition=this.mapLayer.layerDefinition||
{},this.mapLayer.layerDefinition.maximumTrackPoints=1,this.mapLayer.layer.setMaximumTrackPoints(1));else"unique"===d?(d=this.uniqueValueRendererGrid.getUpdatedRenderer(),this.renderer.rotationInfo&&d.setRotationInfo(this.renderer.rotationInfo),this.setRenderer(d)):"color"===d?(d=this.classBreaksColorRendererGrid.getUpdatedRenderer(),this.renderer.rotationInfo&&d.setRotationInfo(this.renderer.rotationInfo),this.setRenderer(d),this.currentClassBreakType="color"):"size"===d&&(d=this.classBreaksSizeRendererGrid.getUpdatedRenderer(),
this.renderer.rotationInfo&&d.setRotationInfo(this.renderer.rotationInfo),this.setRenderer(d),this.currentClassBreakType="size");(arcgisonline.map.featColl.isFeatureCollection(this.mapLayer)||this.isCSV)&&arcgisonline.map.main.markMapAsChanged("onRendererChange");arcgisonline.map.edit.createTypesAndTemplatesOnMapLayer(this.mapLayer);c&&c()},setRenderer:function(b){var c=arcgisonline.map.main.map.infoWindow;c.hide();c.clearFeatures();if(this.hasDynamic){a.forEach(this.mapLayer.itemLayers,function(a){a.id==
this.layer.id&&(a.layerDefinition=a.layerDefinition||{},a.layerDefinition.drawingInfo={renderer:b.toJson()},this.renderer=b)},this);arcgisonline.map.dynLayer.refreshDynamicLayers(this.mapLayer);this.serviceLayerInfo||(this.serviceLayerInfo=this.layer,this.layer=this.mapLayer.layer.dynamicLayerInfos[this.subLayerId]);delete this.mapLayer.legendInfo;for(var c=this.mapLayer.layer.url+"/legend",d=arcgisonline.map.main.allLegendInfos,e=0;e<d.length;e++)if(d[e].legendURL==c){d.splice(e,1);break}}else this.mapLayer.layer instanceof
esri.layers.GeoRSSLayer?(this.layer.setRenderer(b),this.layer.redraw(),this.renderer=this.layer.renderer,"esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType?this.mapLayer.layer.pointSymbol=esri.symbol.fromJson(b.symbol.toJson()):"esriGeometryPolyline"==this.geometryType?this.mapLayer.layer.polylineSymbol=esri.symbol.fromJson(b.symbol.toJson()):"esriGeometryPolygon"==this.geometryType&&(this.mapLayer.layer.polygonSymbol=esri.symbol.fromJson(b.symbol.toJson()))):(this.layer.setRenderer(b),
this.layer.redraw(),this.renderer=this.layer.renderer)},_onDoneChangingSymbols:function(b){var c=this._rendererType.get("value");"simple"===c&&"none"!==a.style(a.byId("rendererSimpleApply"),"display")||"unique"===c&&!1===this._rendererUniqueApplyButton.get("disabled")||"color"===c&&!1===this._rendererColorApplyButton.get("disabled")||"size"===c&&!1===this._rendererSizeApplyButton.get("disabled")?this._onSaveRenderer(b,null,function(){arcgisonline.map.leftPanel.openLeftTOCPanel()}):arcgisonline.map.leftPanel.openLeftTOCPanel()},
_onSimpleChangeSymbolClick:function(b){this.onSymbolChangeHandler&&a.unsubscribe(this.onSymbolChangeHandler);this.onSymbolCancelHandler&&a.unsubscribe(this.onSymbolCancelHandler);this.onSymbolChangeHandler=a.subscribe("onSymbolChange",a.hitch(this,"_onRendererSimpleSymbolChange","main"));this.onSymbolCancelHandler=a.subscribe("onSymbolChangeCancel",a.hitch(this,"_onRendererSimpleSymbolCancel","main"));b=arcgisonline.sharing.dijit.dialog.SymbolDlg.prototype.statics.getInstance();"esri.renderer.SimpleRenderer"==
this.renderer.declaredClass?b.showSymbol(this.renderer.symbol||this._getDefaultSymbol(this.geometryType)):b.showSymbol(this.symbol||this._getDefaultSymbol(this.geometryType))},_onSimpleStreamChangeSymbolClick:function(b){this.onSymbolChangeHandler&&a.unsubscribe(this.onSymbolChangeHandler);this.onSymbolCancelHandler&&a.unsubscribe(this.onSymbolCancelHandler);this.onSymbolChangeHandler=a.subscribe("onSymbolChange",a.hitch(this,"_onRendererSimpleSymbolChange","previous"));this.onSymbolCancelHandler=
a.subscribe("onSymbolChangeCancel",a.hitch(this,"_onRendererSimpleSymbolCancel","previous"));arcgisonline.sharing.dijit.dialog.SymbolDlg.prototype.statics.getInstance().showSymbol(this.streamPreviousSymbol);this.rendererStreamPreviousCheck.set("checked",!0)},_onSimpleStreamLineChangeSymbolClick:function(b){this.onSymbolChangeHandler&&a.unsubscribe(this.onSymbolChangeHandler);this.onSymbolCancelHandler&&a.unsubscribe(this.onSymbolCancelHandler);this.onSymbolChangeHandler=a.subscribe("onSymbolChange",
a.hitch(this,"_onRendererSimpleSymbolChange","track"));this.onSymbolCancelHandler=a.subscribe("onSymbolChangeCancel",a.hitch(this,"_onRendererSimpleSymbolCancel","track"));arcgisonline.sharing.dijit.dialog.SymbolDlg.prototype.statics.getInstance().showSymbol(this.streamConnectLineSymbol);this.rendererStreamPreviousCheck.set("checked",!0);this.rendererStreamConnectCheck.set("checked",!0)},_onRendererSimpleSymbolChange:function(b,c){if("rendererStack"===arcgisonline.map.leftPanel.getLeftContentPanelStack()){var d=
c.toJson();if("esriPMS"==c.type&&(0==d.url.length||"http://"==d.url))c=esri.symbol.fromJson(this.getMarkerJson());"previous"===b?(this.streamPreviousSymbol=c,arcgisonline.map.symbol.drawSymbol(a.byId("panelStreamSymbolImage"),this.streamPreviousSymbol,this.template)):"track"===b?(this.streamConnectLineSymbol=c,arcgisonline.map.symbol.drawSymbol(a.byId("panelStreamLineSymbolImage"),this.streamConnectLineSymbol,this.template)):(this.symbol=c,arcgisonline.map.symbol.drawSymbol(a.byId("panelSymbolImage"),
this.symbol,this.template));(this.isFeatColl||this.isCSV)&&arcgisonline.map.main.markMapAsChanged("onRendererChange")}},_onRendererSimpleSymbolCancel:function(b){"rendererStack"===arcgisonline.map.leftPanel.getLeftContentPanelStack()&&(this.onSymbolChangeHandler&&a.unsubscribe(this.onSymbolChangeHandler),this.onSymbolCancelHandler&&a.unsubscribe(this.onSymbolCancelHandler))},_onClickRendererSimpleRotation:function(b){this.onRotationChangeHandler&&a.unsubscribe(this.onRotationChangeHandler);this.onRotationChangeHandler=
a.subscribe("onRotationChange",a.hitch(this,"_onRendererSimpleRotationChange"));this.attributeStore||this.getAttributeStore();b=this.renderer.rotationInfo;"esri.renderer.TemporalRenderer"===this.renderer.declaredClass&&(b=this.renderer.latestObservationRenderer.rotationInfo);arcgisonline.sharing.dijit.dialog.RotationDlg.prototype.statics.getInstance().show(b,this.attributesStore)},_onRendererSimpleRotationChange:function(a,c){"esri.renderer.TemporalRenderer"===this.renderer.declaredClass?(this.renderer.observationRenderer.setRotationInfo(a),
this.renderer.latestObservationRenderer.setRotationInfo(a)):this.renderer.setRotationInfo(a);(c||"esri.layers.StreamLayer"===this.mapLayer.layer.declaredClass)&&this._onSaveRenderer()},_onChangeRendererUniqueAttribute:function(a){a=this._rendererUniqueAttribute.get("value");a!=this.i18n.selectAField&&(this._rendererUniqueAttribute.removeOption(this.i18n.selectAField),this._rendererUniqueSymbolsButton.set("disabled",!1),this._rendererUniqueApplyButton.set("disabled",!1));this._rendererUniqueOtherOption.set("label",
this.i18n.showOtherValues);this._calculateDatePattern(this._rendererUniqueAttribute.get("value"));"picturemarkersymbol"===this.symbol.type&&(this.symbol=esri.symbol.fromJson(this.defaultPointSymbols[0]));this._buildUniqueValuesList(!1,!1)},_onChangeRendererUniqueColor:function(a){this.adjustHeight();this.disableAllEvents||(this.rendererHasUserColors=!1,this.currentColorOrderIsDefault=!0,this._buildUniqueValuesList(!1,!0))},_onClickRendererUniqueSymbolsChange:function(b){this.onSymbolChangeHandler&&
a.unsubscribe(this.onSymbolChangeHandler);this.onSymbolCancelHandler&&a.unsubscribe(this.onSymbolCancelHandler);this.onSymbolChangeHandler=a.subscribe("onSymbolChange",a.hitch(this,"_onRendererUniqueSymbolChange"));arcgisonline.sharing.dijit.dialog.SymbolDlg.prototype.statics.getInstance().showSymbol(this.symbol,{noPreDefSymbols:!0,showNoBgColor:!0})},_onRendererUniqueSymbolChange:function(a){var c=a.toJson();if("esriPMS"==a.type&&(0==c.url.length||"http://"==c.url))a=esri.symbol.fromJson(this.getMarkerJson());
this.symbol=a;this._buildUniqueValuesList(!1,!0);this.adjustHeight()},_onClickRendererUniqueFlipColors:function(a){this.currentColorOrderIsDefault=!this.currentColorOrderIsDefault;this._buildUniqueValuesList(!1,!0)},_onClickRendererUniqueOther:function(a){this.uniqueValueRendererGrid.toggleDefaultSymbol();this._rendererUniqueOtherOption.get("label")===this.i18n.hideOtherValues?this._rendererUniqueOtherOption.set("label",this.i18n.showOtherValues):this._rendererUniqueOtherOption.set("label",this.i18n.hideOtherValues)},
_onClickRendererUniqueRotation:function(b){this.onRotationChangeHandler&&a.unsubscribe(this.onRotationChangeHandler);this.onRotationChangeHandler=a.subscribe("onRotationChange",a.hitch(this,"_onRendererUniqueRotationChange"));arcgisonline.sharing.dijit.dialog.RotationDlg.prototype.statics.getInstance().show(this.renderer.rotationInfo,this.attributesStore)},_onRendererUniqueRotationChange:function(a,c){this.renderer.setRotationInfo(a);c&&this._onSaveRenderer()},_onChangeRendererClassBreaksAttribute:function(){var b=
this._rendererClassBreaksAttribute.get("value");b!=this.i18n.selectAField?(this._rendererClassBreaksAttribute.removeOption(this.i18n.selectAField),this._rendererSizeSymbolsButton.set("disabled",!1),this._rendererSizeApplyButton.set("disabled",!1),this._rendererColorSymbolsButton.set("disabled",!1),this._rendererColorApplyButton.set("disabled",!1),this.attributesStore.fetchItemByIdentity({identity:b,onItem:a.hitch(this,function(b){if("esriFieldTypeDate"==b.type)a.style(a.byId("renderer_classBreaks_normalizedBy"),
"display","none"),this._rendererClassBreaksNormalizedBy.set("value","none");else if(this.isFeatColl||this.isCSV||this.mapLayer.layer&&10.1<=this.mapLayer.layer.version){var d=this._rendererClassBreaksNormalizedBy.get("value");d===b.name[0]&&(d=this.i18n.normalizedByNone);this._rendererClassBreaksNormalizedBy.setStore(this.attributesStore,d,{query:"NOT name:'"+b.name[0]+"' AND NOT type:'selectAField' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeString' AND NOT type:'esriFieldTypeDate'"});
a.style(a.byId("renderer_classBreaks_normalizedBy"),"display","")}})})):(a.style(a.byId("renderer_classBreaks_normalizedBy"),"display","none"),this._rendererClassBreaksNormalizedBy.set("value","none"));this._calculateDatePattern(this._rendererClassBreaksAttribute.get("value"));this.disableAllEvents||(this._rendererColorOtherOption.set("label",this.i18n.showOtherValues),this._rendererSizeOtherOption.set("label",this.i18n.showOtherValues),"size"==this._rendererType.get("value")?("simplefillsymbol"===
this.symbol.type&&(this.symbol=esri.symbol.fromJson(this.defaultPointSymbols[0])),this._buildClassBreaksSizeValuesList(!1,!1)):("picturemarkersymbol"===this.symbol.type&&(this.symbol=esri.symbol.fromJson(this.defaultPointSymbols[0])),this._buildClassBreaksColorValuesList(!1,!1)))},_onChangeRendererClassBreaksNormalizedBy:function(a){this._rendererClassBreaksAttribute.get("value")!=this.i18n.selectAField&&(this._rendererSizeSymbolsButton.set("disabled",!1),this._rendererSizeApplyButton.set("disabled",
!1),this._rendererColorSymbolsButton.set("disabled",!1),this._rendererColorApplyButton.set("disabled",!1),this.disableAllEvents||("size"==this._rendererType.get("value")?this._buildClassBreaksSizeValuesList(!1,!1):("picturemarkersymbol"===this.symbol.type&&(this.symbol=esri.symbol.fromJson(this.defaultPointSymbols[0])),this._buildClassBreaksColorValuesList(!1,!1))))},_onChangeRendererClassBreaksMethod:function(a){if(!this.disableAllEvents){if("equal"==a||"natural"==a||"quantile"==a)a="size"==this._rendererType.get("value")?
this._rendererSizeBreaks:this._rendererColorBreaks,a.constraints={min:2,max:10,places:0};else if(!arcgisonline.sharing.util.isHostedService(this.layer.url)&&(!this.mapLayer.layer||!this.mapLayer.layer.supportsDynamicLayers))a="size"==this._rendererType.get("value")?this._rendererSizeBreaks:this._rendererColorBreaks,a.constraints={min:1,max:3,places:0},a.set("value",Math.min(3,a.get("value")));this._updateClassesOrInterval();"size"==this._rendererType.get("value")?this._buildClassBreaksSizeValuesList(!1,
!1):this._buildClassBreaksColorValuesList(!1,!1)}},_updateClassesOrInterval:function(){(arcgisonline.sharing.util.isHostedService(this.layer.url)||this.mapLayer.layer&&this.mapLayer.layer.supportsDynamicLayers)&&"stdDev"==this._rendererClassBreaksMethod.get("value")?"size"==this._rendererType.get("value")?(a.style(a.byId("rendererSizeBreaksClassesDiv"),"display","none"),a.style(a.byId("rendererSizeBreaksIntervalDiv"),"display","")):"color"==this._rendererType.get("value")&&(a.style(a.byId("rendererColorBreaksClassesDiv"),
"display","none"),a.style(a.byId("rendererColorBreaksIntervalDiv"),"display","")):"size"==this._rendererType.get("value")?(a.style(a.byId("rendererSizeBreaksClassesDiv"),"display",""),a.style(a.byId("rendererSizeBreaksIntervalDiv"),"display","none")):"color"==this._rendererType.get("value")&&(a.style(a.byId("rendererColorBreaksClassesDiv"),"display",""),a.style(a.byId("rendererColorBreaksIntervalDiv"),"display","none"))},_onChangeRendererColorColor:function(a){this.adjustHeight();this.disableAllEvents||
(this.rendererHasUserColors=!1,this.currentColorOrderIsDefault=!0,this._buildClassBreaksColorValuesList(!1,!0))},_onChangeRendererColorInterval:function(){this.disableAllEvents||this._buildClassBreaksColorValuesList(!1,!1)},_onChangeRendererColorBreaks:function(){this.disableAllEvents||this._buildClassBreaksColorValuesList(!1,!1)},_onClickRendererColorSymbolsChange:function(b){this.onSymbolChangeHandler&&a.unsubscribe(this.onSymbolChangeHandler);this.onSymbolCancelHandler&&a.unsubscribe(this.onSymbolCancelHandler);
this.onSymbolChangeHandler=a.subscribe("onSymbolChange",a.hitch(this,"_onRendererColorSymbolChange"));arcgisonline.sharing.dijit.dialog.SymbolDlg.prototype.statics.getInstance().showSymbol(this.symbol,{noPreDefSymbols:!0,showNoBgColor:!0})},_onRendererColorSymbolChange:function(a){var c=a.toJson();if("esriPMS"==a.type&&(0==c.url.length||"http://"==c.url))a=esri.symbol.fromJson(this.getMarkerJson());this.symbol=a;this._buildClassBreaksColorValuesList(!1,!0);this.adjustHeight()},_onClickRendererColorFlipColors:function(a){this.currentColorOrderIsDefault=
!this.currentColorOrderIsDefault;this._buildClassBreaksColorValuesList(!1,!0)},_onClickRendererColorOther:function(a){this.classBreaksColorRendererGrid.toggleDefaultSymbol();this._rendererColorOtherOption.get("label")===this.i18n.hideOtherValues?this._rendererColorOtherOption.set("label",this.i18n.showOtherValues):this._rendererColorOtherOption.set("label",this.i18n.hideOtherValues)},_onClickRendererColorRotation:function(b){this.onRotationChangeHandler&&a.unsubscribe(this.onRotationChangeHandler);
this.onRotationChangeHandler=a.subscribe("onRotationChange",a.hitch(this,"_onRendererColorRotationChange"));arcgisonline.sharing.dijit.dialog.RotationDlg.prototype.statics.getInstance().show(this.renderer.rotationInfo,this.attributesStore)},_onRendererColorRotationChange:function(a,c){this.renderer.setRotationInfo(a);c&&this._onSaveRenderer()},_onChangeRendererSizeBreaks:function(){this.disableAllEvents||this._buildClassBreaksSizeValuesList(!1,!1)},_onChangeRendererSizeInterval:function(){this.disableAllEvents||
this._buildClassBreaksSizeValuesList(!1,!1)},_onClickRendererSizeSymbolsChange:function(b){this.onSymbolChangeHandler&&a.unsubscribe(this.onSymbolChangeHandler);this.onSymbolCancelHandler&&a.unsubscribe(this.onSymbolCancelHandler);this.onSymbolChangeHandler=a.subscribe("onSymbolChange",a.hitch(this,"_onRendererSizeSymbolChange"));arcgisonline.sharing.dijit.dialog.SymbolDlg.prototype.statics.getInstance().showSymbol(this.symbol,{endSize:this.classBreaksEndSize})},_onRendererSizeSymbolChange:function(a,
c){var d=a.toJson();if("esriPMS"==a.type&&(0==d.url.length||"http://"==d.url))a=esri.symbol.fromJson(this.getMarkerJson());this.symbol=a;this.classBreaksEndSize=c;this._buildClassBreaksSizeValuesList(!1,!0);this.adjustHeight()},_onClickRendererSizeOther:function(a){this.classBreaksSizeRendererGrid.toggleDefaultSymbol();this._rendererSizeOtherOption.get("label")===this.i18n.hideOtherValues?this._rendererSizeOtherOption.set("label",this.i18n.showOtherValues):this._rendererSizeOtherOption.set("label",
this.i18n.hideOtherValues)},_onClickRendererSizeBackground:function(a){this.classBreaksSizeRendererGrid.toggleBackgroundSymbol();this._rendererSizeBackgroundOption.get("label")===this.i18n.hideBackground?this._rendererSizeBackgroundOption.set("label",this.i18n.showBackground):this._rendererSizeBackgroundOption.set("label",this.i18n.hideBackground)},_onClickRendererSizeRotation:function(b){this.onRotationChangeHandler&&a.unsubscribe(this.onRotationChangeHandler);this.onRotationChangeHandler=a.subscribe("onRotationChange",
a.hitch(this,"_onRendererSizeRotationChange"));arcgisonline.sharing.dijit.dialog.RotationDlg.prototype.statics.getInstance().show(this.renderer.rotationInfo,this.attributesStore)},_onRendererSizeRotationChange:function(a,c){this.renderer.setRotationInfo(a);c&&this._onSaveRenderer()},_initSimpleRenderer:function(){if("esri.renderer.TemporalRenderer"==this.renderer.declaredClass)a.style(a.byId("rendererSimpleApply"),"display","none"),this.symbol=this.renderer.latestObservationRenderer.symbol;else if("esri.renderer.SimpleRenderer"==
this.renderer.declaredClass)a.style(a.byId("rendererSimpleApply"),"display","none"),this.symbol=this.renderer.symbol;else if(a.style(a.byId("rendererSimpleApply"),"display",""),"esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType)this.symbol=esri.symbol.fromJson(this.getMarkerJson());else if("esriGeometryPolyline"==this.geometryType)this.symbol=esri.symbol.fromJson(this.lineJson);else if("esriGeometryPolygon"==this.geometryType)this.symbol=esri.symbol.fromJson(this.polygonJson);
else return;"esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType?(a.style(this._rendererSimpleRotationOption.domNode,"display",""),a.style(this._rendererSimpleChangeSymbolButton.domNode,"display","none"),a.style(this._rendererSimpleSymbolsButton.domNode,"display","")):(a.style(this._rendererSimpleRotationOption.domNode,"display","none"),a.style(this._rendererSimpleSymbolsButton.domNode,"display","none"),a.style(this._rendererSimpleChangeSymbolButton.domNode,"display",
""));this.mapLayer.layer instanceof esri.layers.GeoRSSLayer&&(a.style(this._rendererSimpleSymbolsButton.domNode,"display","none"),a.style(this._rendererSimpleChangeSymbolButton.domNode,"display",""));10>a.isIE?setTimeout(a.hitch(this,function(){arcgisonline.map.symbol.drawSymbol(a.byId("panelSymbolImage"),this.symbol,this.template)}),500):arcgisonline.map.symbol.drawSymbol(a.byId("panelSymbolImage"),this.symbol,this.template)},_initUniqueRenderer:function(b){if(!this._rendererUniqueAttribute.get("store"))if(this.getAttributeStore(),
arcgisonline.sharing.util.isHostedService(this.layer.url)||this.mapLayer.layer instanceof esri.layers.FeatureLayer&&this.mapLayer.layer.url?this._rendererUniqueAttribute.setStore(this.attributesStore,this.i18n.selectAField,{query:"NOT type:'none' AND NOT type:'percent' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeDate'"}):this._rendererUniqueAttribute.setStore(this.attributesStore,this.i18n.selectAField,{query:"NOT type:'none' AND NOT type:'percent' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry'"}),
this._rendererUniqueSymbolsButton.set("disabled",!0),this._rendererUniqueApplyButton.set("disabled",!0),"esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType)this.symbol=esri.symbol.fromJson(this.defaultPointSymbols[0]);else if("esriGeometryPolyline"==this.geometryType)this.symbol=esri.symbol.fromJson(this.lineJson);else if("esriGeometryPolygon"==this.geometryType)this.symbol=esri.symbol.fromJson(this.polygonJson);else return;("esriGeometryPoint"==this.geometryType||
"esriGeometryMultipoint"==this.geometryType)&&a.style(this._rendererUniqueRotationOption.domNode,"display","");"picturemarkersymbol"===this.symbol.type&&(this.symbol=esri.symbol.fromJson(this.defaultPointSymbols[0]));this.rendererHasUserColors=!1;if(b){this._rendererUniqueAttribute.set("value",this.renderer.attributeField);this._rendererUniqueSymbolsButton.set("disabled",!1);this._rendererUniqueApplyButton.set("disabled",!1);this.symbol=this.renderer.infos&&this.renderer.infos.length&&this.renderer.infos[0].symbol?
esri.symbol.fromJson(this.renderer.infos[0].symbol.toJson()):this._getDefaultSymbol(this.geometryType);var c=!0;a.forEach(this.renderer.infos,function(a){"picturemarkersymbol"==a.symbol.type&&(c=!1)});c&&(this.rendererHasUserColors=!0);this.renderer.defaultSymbol&&this.renderer.defaultLabel?this._rendererUniqueOtherOption.set("label",this.i18n.hideOtherValues):this._rendererUniqueOtherOption.set("label",this.i18n.showOtherValues)}this._calculateDatePattern(this._rendererUniqueAttribute.get("value"));
this._rendererUniqueColor.get("store")?this._buildUniqueValuesList(b,!1):this.colorSetUniqueResult?(this._fillUniqueColorComboBox(this.colorSetUniqueResult),this._buildUniqueValuesList(b,!1)):this._getColorSetGroup(a.hitch(this,function(){a.forEach(this.colorSetItems,function(c){-1<c.tags.toString().indexOf("unique")&&arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"content/items/"+c.id+"/data",a.hitch(this,function(a,c){this.colorSetUniqueResult=a||{};this._fillUniqueColorComboBox(this.colorSetUniqueResult);
this._buildUniqueValuesList(b,!1)}),a.hitch(this,function(){console.log("Error retrieving color sets.")}))},this)}))},_buildUniqueValuesList:function(b,c){this._showLoading(a.byId("rendererUniqueRendererGridDiv"));setTimeout(a.hitch(this,function(){this._buildUniqueValuesListTimeout(b,c)}),1)},_buildUniqueValuesListTimeout:function(b,c){if(this._rendererUniqueAttribute.get("value")==this.i18n.selectAField)this._hideLoading();else if(b)this._updateUniqueValueRendererGrid();else if(this.attributesStore&&
this.rendererUniqueColorStore)if(c){var d=this.uniqueValueRendererGrid.getUpdatedRenderer();this.rendererHasUserColors?a.forEach(d.infos,function(b){var c=b.symbol.color.toRgba();if(("esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType)&&("cross"===b.symbol.style||"x"===b.symbol.style))c=b.symbol.outline.color.toRgba();c=this._getSymbol(this.geometryType,c);b.symbol=c;d._symbols[b.value]==b.symbol;c=a.indexOf(d.values,b.value);d.infos[c].symbol=b.symbol},this):this.rendererUniqueColorStore.fetchItemByIdentity({identity:this._rendererUniqueColor.get("value"),
onItem:a.hitch(this,function(b){var c=0;this.currentColorOrderIsDefault||(c=b.colors.length-1);a.forEach(d.infos,function(g){var h=this._getSymbol(this.geometryType,b.colors[c]);g.symbol=h;d._symbols[g.value]==g.symbol;h=a.indexOf(d.values,g.value);d.infos[h].symbol=g.symbol;this.currentColorOrderIsDefault?(c++,c%=b.colors.length):(c--,0>c&&(c=b.colors.length-1))},this)})});this.uniqueValueRendererGrid.updateRenderer(d);this._hideLoading()}else this.attributesStore.fetchItemByIdentity({identity:this._rendererUniqueAttribute.get("value"),
onItem:a.hitch(this,function(b){this.rendererUniqueColorStore.fetchItemByIdentity({identity:this._rendererUniqueColor.get("value"),onItem:a.hitch(this,function(c){this._generateRendererUniqueValues(b.name,a.hitch(this,function(a){this._buildUniqueValueRenderer(b,a,c)}))})})})}),this._rendererUniqueOtherOption.set("label",this.i18n.showOtherValues)},_buildUniqueValueRenderer:function(b,c,d){c=c.sort("esriFieldTypeInteger"==b.type||"esriFieldTypeDouble"==b.type||"esriFieldTypeSingle"==b.type||"esriFieldTypeSmallInteger"==
b.type?function(a,b){return a.value-b.value}:function(a,b){var c=a.value,d=b.value;return c==d?0:c<d?-1:1});var e=this._getDefaultSymbol(this.geometryType),f=new esri.renderer.UniqueValueRenderer(e,this._rendererUniqueAttribute.get("value"));f.defaultSymbol=null;var g=0;this.currentColorOrderIsDefault||(g=d.colors.length-1);a.some(c,function(c,e){if(200<=e)return arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorDlgTitle,message:a.string.substitute(this.i18n.error.tooManyValues,
{attribute:b.alias})}),!0;var k=c.value;if(esri.isDefined(k)&&("string"!==typeof k||"string"==typeof k&&k.length)&&"\x3cnull\x3e"!==k&&"\x3cNull\x3e"!==k){var l=c.label||k;if(b.codedValues)for(var m=a.json.parse(b.codedValues),p=0;p<m.length;p++)if(("string"==typeof m[p].code||"number"==typeof m[p].code)&&m[p].code==k){l=m[p].name;break}else{if(m[p].code[0]==k){l=m[p].name[0];break}}else this.datePattern&&esri.isDefined(k)&&k.toString().length&&"Null"!==k?l=a.date.locale.format(new Date(k),{datePattern:this.datePattern.datePattern,
timePattern:this.datePattern.timePattern,selector:this.datePattern.datePattern&&this.datePattern.timePattern?null:this.datePattern.datePattern?"date":"time"}):"number"===typeof k&&!isNaN(k)&&(l=a.number.format(k,{pattern:this.pattern}));f.addValue({value:k,symbol:this._getSymbol(this.geometryType,d.colors[g]),label:""+l});this.currentColorOrderIsDefault?(g++,g%=d.colors.length):(g--,0>g&&(g=d.colors.length-1))}else f.defaultSymbol=this._getDefaultSymbol(this.geometryType),f.defaultLabel=this.i18n.other,
this._rendererUniqueOtherOption.set("label",this.i18n.hideOtherValues)},this);if(f.infos.length){if(this.isFeatColl||this.isCSV)for(c=0;c<this.layer.graphics.length;c++)if(e=this.layer.graphics[c].attributes[b.name],!esri.isDefined(e)||"string"==typeof e&&!e.length){f.defaultSymbol=this._getDefaultSymbol(this.geometryType);f.defaultLabel=this.i18n.other;this._rendererUniqueOtherOption.set("label",this.i18n.hideOtherValues);break}}else f.defaultSymbol=this._getDefaultSymbol(this.geometryType),f.defaultLabel=
this.i18n.other,this._rendererUniqueOtherOption.set("label",this.i18n.hideOtherValues);this._updateUniqueValueRendererGrid(f)},_updateUniqueValueRendererGrid:function(a){a=a||this.renderer;this.uniqueValueRendererGrid?this.uniqueValueRendererGrid.updateRenderer(a):this.uniqueValueRendererGrid=new arcgisonline.sharing.dijit.RendererGrid({id:"uniqueValueGrid",renderer:a,datePattern:this.datePattern,defaultSymbol:this._getDefaultSymbol(this.geometryType),style:"position: relative; width: 100%; height:100%; overflow-y:hidden; overflow-x:hidden; padding:0;"},
"rendererUniqueRendererGrid");a.defaultSymbol&&a.defaultLabel?this._rendererUniqueOtherOption.set("label",this.i18n.hideOtherValues):this._rendererUniqueOtherOption.set("label",this.i18n.showOtherValues);this._hideLoading();this.adjustHeight()},_destroyUniqueValueRendererGrid:function(){this.uniqueValueRendererGrid&&(this.uniqueValueRendererGrid.destroy(),this.uniqueValueRendererGrid=null,a.byId("rendererUniqueRendererGrid")||a.create("div",{id:"rendererUniqueRendererGrid"},a.byId("rendererUniqueRendererGridDiv")))},
_initClassBreaksColorRenderer:function(b){if(!this._rendererClassBreaksAttribute.get("store"))if(this.getAttributeStore(),arcgisonline.sharing.util.isHostedService(this.layer.url)||this.mapLayer.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer||this.mapLayer.layer instanceof esri.layers.FeatureLayer&&this.mapLayer.layer.url?this._rendererClassBreaksAttribute.setStore(this.attributesStore,this.i18n.selectAField,{query:"NOT type:'none' AND NOT type:'percent' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeString' AND NOT type:'esriFieldTypeDate'"}):
this._rendererClassBreaksAttribute.setStore(this.attributesStore,this.i18n.selectAField,{query:"NOT type:'none' AND NOT type:'percent' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeString'"}),this._rendererClassBreaksNormalizedBy.setStore(this.attributesStore,this.i18n.normalizedByNone,{query:"NOT type:'selectAField' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeString' AND NOT type:'esriFieldTypeDate'"}),
this._rendererSizeSymbolsButton.set("disabled",!0),this._rendererSizeApplyButton.set("disabled",!0),this._rendererColorSymbolsButton.set("disabled",!0),this._rendererColorApplyButton.set("disabled",!0),"esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType)this.symbol=esri.symbol.fromJson(this.defaultPointSymbols[0]);else if("esriGeometryPolyline"==this.geometryType)this.symbol=esri.symbol.fromJson(this.lineJson);else if("esriGeometryPolygon"==this.geometryType)this.symbol=
esri.symbol.fromJson(this.polygonJson);else return;("esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType)&&a.style(this._rendererColorRotationOption.domNode,"display","");this.rendererHasUserColors=!1;if(b){this._rendererClassBreaksAttribute.set("value",this.renderer.attributeField);"field"===this.renderer.normalizationType?this._rendererClassBreaksNormalizedBy.set("value",this.renderer.normalizationField):"percent-of-total"===this.renderer.normalizationType&&this._rendererClassBreaksNormalizedBy.set("value",
"percent-of-total");this._rendererSizeSymbolsButton.set("disabled",!1);this._rendererSizeApplyButton.set("disabled",!1);this._rendererColorSymbolsButton.set("disabled",!1);this._rendererColorApplyButton.set("disabled",!1);this.symbol=this._checkSymbol(this.renderer.infos[0].symbol,1<this.renderer.infos.length?this.renderer.infos[1].symbol:null);var c=this.symbol.toJson();if("esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType)for(var d=0;d<this.defaultPointSymbols.length;d++)if(c.style===
this.defaultPointSymbols[d].style){this.symbol=esri.symbol.fromJson(c);c=this.defaultPointSymbols[d].color;this.symbol.color.setColor(new a.Color([c[0],c[1],c[2],c[3]/255]));c=this.defaultPointSymbols[d].outline.color;this.symbol.outline.color.setColor(new a.Color([c[0],c[1],c[2],c[3]/255]));break}var e=!0;a.forEach(this.renderer.infos,function(a){"picturemarkersymbol"==a.symbol.type&&(e=!1)});e&&(this.rendererHasUserColors=!0);this.renderer.defaultSymbol&&this.renderer.defaultLabel?this._rendererColorOtherOption.set("label",
this.i18n.hideOtherValues):this._rendererColorOtherOption.set("label",this.i18n.showOtherValues)}"esriGeometryPolygon"==this.geometryType&&("picturemarkersymbol"===this.symbol.type||"simplemarkersymbol"===this.symbol.type)?this.symbol=esri.symbol.fromJson(this.polygonJson):"picturemarkersymbol"===this.symbol.type&&(this.symbol=esri.symbol.fromJson(this.defaultPointSymbols[0]));this._calculateDatePattern(this._rendererClassBreaksAttribute.get("value"));this._rendererColorColor.get("store")?this._buildClassBreaksColorValuesList(b,
!1):this.colorSetClassBreaksResult?(this._fillClassBreakColorComboBox(this.colorSetClassBreaksResult),this._buildClassBreaksColorValuesList(b,!1)):this._getColorSetGroup(a.hitch(this,function(){a.forEach(this.colorSetItems,function(c){-1<c.tags.toString().indexOf("class break")&&arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"content/items/"+c.id+"/data",a.hitch(this,function(a,c){this.colorSetClassBreaksResult=a||{};this._fillClassBreakColorComboBox(this.colorSetClassBreaksResult);
this._buildClassBreaksColorValuesList(b,!1)}),a.hitch(this,function(){console.log("Error retrieving color sets.")}))},this)}))},_buildClassBreaksColorValuesList:function(b,c){this._showLoading(a.byId("rendererColorRendererGridDiv"));setTimeout(a.hitch(this,function(){this._buildClassBreaksColorValuesListTimeout(b,c)}),1)},_buildClassBreaksColorValuesListTimeout:function(b,c){if(this._rendererClassBreaksAttribute.get("value")==this.i18n.selectAField)this._hideLoading();else if(b)this._updateClassBreaksColorRendererGrid();
else if(this.attributesStore)if(c){var d=this.classBreaksColorRendererGrid.getUpdatedRenderer();this.rendererHasUserColors?a.forEach(d.infos,function(b){var c=b.symbol.color.toRgba();if(("esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType)&&("cross"===b.symbol.style||"x"===b.symbol.style))c=b.symbol.outline.color.toRgba();c=this._getSymbol(this.geometryType,c);b.symbol=c;d._symbols[b.value]==b.symbol;var g=0;a.forEach(d.breaks,function(a,c){a[0]==b.minValue&&a[1]==
b.maxValue&&(g=c)});d.breaks[g].symbol=b.symbol},this):(this._updateClassBreaksMinSize(),this.rendererColorColorStore.fetchItemByIdentity({identity:this._rendererColorColor.get("value"),onItem:a.hitch(this,function(b){var c=this._buildColorList(b.colors,d.infos.length);a.forEach(d.infos,function(b,e){var n=this._getSymbol(this.geometryType,c[e]);b.symbol=n;d._symbols[b.value]==b.symbol;var k=0;a.forEach(d.breaks,function(a,c){a[0]==b.minValue&&a[1]==b.maxValue&&(k=c)});d.breaks[k].symbol=b.symbol},
this)})}));this.classBreaksColorRendererGrid.updateRenderer(d);this._hideLoading()}else this.attributesStore.fetchItemByIdentity({identity:this._rendererClassBreaksAttribute.get("value"),onItem:a.hitch(this,function(b){var c=this._rendererClassBreaksMethod.get("value"),d=parseInt(this._rendererColorBreaks.get("value")),d=Math.min(Math.max(d,1),10);this._rendererColorBreaks.set("value",d);var h=parseFloat(this._rendererColorInterval.get("value"));this.attributesStore.fetchItemByIdentity({identity:this._rendererClassBreaksNormalizedBy.get("value"),
onItem:a.hitch(this,function(n){var k;"percent"===n.type[0]?k={normalizationType:"percent-of-total"}:"none"!==n.type[0]&&(k={normalizationField:n.name[0],normalizationType:"field"});this._generateRendererClassBreaks(b,c,d,h,"color",k,a.hitch(this,function(a,b){this._buildClassBreaksColorRenderer(a,b)}))})})})}),this._rendererColorOtherOption.set("label",this.i18n.showOtherValues)},_buildClassBreaksColorRenderer:function(b,c){if(!b||!b.length)this._hideLoading();else{this._updateClassBreaksMinSize();
var d=this._getDefaultSymbol(this.geometryType),e=new esri.renderer.ClassBreaksRenderer(d,this._rendererClassBreaksAttribute.get("value"));e.defaultSymbol=null;e.setMaxInclusive(!0);e.normalizationType=c&&c.normalizationType;e.normalizationField=c&&c.normalizationField;e.normalizationTotal=c&&c.normalizationTotal;this.rendererColorColorStore.fetchItemByIdentity({identity:this._rendererColorColor.get("value"),onItem:a.hitch(this,function(d){var g=this._buildColorList(d.colors,b.length),h=1;c&&"percent-of-total"===
c.normalizationType&&a.forEach(b,function(a,b){a.maxValue!==a.minValue&&(h=Math.min(h,a.maxValue-a.minValue))});a.forEach(b,function(d,f){var l="";if(d.label)l=d.label;else if("stdDev"==this._rendererClassBreaksMethod.get("value")&&f==(b.length-1)/2)l="Mean";else if(c&&"percent-of-total"===c.normalizationType)l=this._buildRangeTextPercent(d.minValue,d.maxValue,h);else if(this.datePattern){if(d.minValue&&0<d.minValue.toString().length&&(l=a.date.locale.format(new Date(d.minValue),{datePattern:this.datePattern.datePattern,
timePattern:this.datePattern.timePattern,selector:this.datePattern.datePattern&&this.datePattern.timePattern?null:this.datePattern.datePattern?"date":"time"})),d.maxValue&&0<d.maxValue.toString().length)var m=a.date.locale.format(new Date(d.maxValue),{datePattern:this.datePattern.datePattern,timePattern:this.datePattern.timePattern,selector:this.datePattern.datePattern&&this.datePattern.timePattern?null:this.datePattern.datePattern?"date":"time"}),l=l+((0<l.length?" - ":"")+m)}else var l=d.minValue,
m=d.maxValue,p=Math.abs(l),q=Math.abs(m),l=1E4<p?Math.round(l):1<p?a.number.round(l,2):a.number.round(l,3),m=1E4<q?Math.round(m):1<q?a.number.round(m,2):a.number.round(m,3),l=this._buildRangeText(l,m);e.addBreak({minValue:d.minValue,maxValue:d.maxValue,symbol:this._getSymbol(this.geometryType,g[e.infos.length]),label:l})},this)})});this._updateClassBreaksColorRendererGrid(e)}},_updateClassBreaksColorRendererGrid:function(a){a=a||this.renderer;this.classBreaksColorRendererGrid?this.classBreaksColorRendererGrid.updateRenderer(a):
this.classBreaksColorRendererGrid=new arcgisonline.sharing.dijit.RendererGrid({id:"classBreaksColorGrid",renderer:a,datePattern:this.datePattern,defaultSymbol:this._getDefaultSymbol(this.geometryType),style:"position: relative; width: 100%; height:100%; overflow-y:hidden; overflow-x:hidden; padding:0;"},"rendererColorRendererGrid");this._hideLoading();this.adjustHeight()},_destroyClassBreaksColorRendererGrid:function(){this.classBreaksColorRendererGrid&&(this.classBreaksColorRendererGrid.destroy(),
this.classBreaksColorRendererGrid=null,a.byId("rendererColorRendererGrid")||a.create("div",{id:"rendererColorRendererGrid"},a.byId("rendererColorRendererGridDiv")))},_initClassBreaksSizeRenderer:function(b){this._rendererClassBreaksAttribute.get("store")||(this.getAttributeStore(),arcgisonline.sharing.util.isHostedService(this.layer.url)||this.mapLayer.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer||this.mapLayer.layer instanceof esri.layers.FeatureLayer&&this.mapLayer.layer.url?this._rendererClassBreaksAttribute.setStore(this.attributesStore,
this.i18n.selectAField,{query:"NOT type:'none' AND NOT type:'percent' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeString' AND NOT type:'esriFieldTypeDate'"}):this._rendererClassBreaksAttribute.setStore(this.attributesStore,this.i18n.selectAField,{query:"NOT type:'none' AND NOT type:'percent' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeString'"}),this._rendererClassBreaksNormalizedBy.setStore(this.attributesStore,
this.i18n.selectAField,{query:"NOT type:'selectAField' AND NOT type:'esriFieldTypeOID' AND NOT type:'esriFieldTypeGeometry' AND NOT type:'esriFieldTypeString' AND NOT type:'esriFieldTypeDate'"}),this._rendererSizeSymbolsButton.set("disabled",!0),this._rendererSizeApplyButton.set("disabled",!0),this._rendererColorSymbolsButton.set("disabled",!0),this._rendererColorApplyButton.set("disabled",!0));if("esri.renderer.SimpleRenderer"==this.renderer.declaredClass)this.symbol="esriGeometryPolygon"==this.geometryType?
esri.symbol.fromJson(this.pointJson):"esriGeometryPolyline"==this.geometryType?this.renderer.symbol:esri.symbol.fromJson(this.pointJson);else if("esriGeometryPoint"==this.geometryType||"esriGeometryMultipoint"==this.geometryType)this.symbol=esri.symbol.fromJson(this.pointJson);else if("esriGeometryPolyline"==this.geometryType)this.symbol=esri.symbol.fromJson(this.lineJson);else if("esriGeometryPolygon"==this.geometryType)this.symbol=esri.symbol.fromJson(this.pointJson);else return;("esriGeometryPoint"==
this.geometryType||"esriGeometryMultipoint"==this.geometryType)&&a.style(this._rendererSizeRotationOption.domNode,"display","");if(b){this._rendererClassBreaksAttribute.set("value",this.renderer.attributeField);"field"===this.renderer.normalizationType?this._rendererClassBreaksNormalizedBy.set("value",this.renderer.normalizationField):"percent-of-total"===this.renderer.normalizationType&&this._rendererClassBreaksNormalizedBy.set("value","percent-of-total");this._rendererSizeSymbolsButton.set("disabled",
!1);this._rendererSizeApplyButton.set("disabled",!1);this._rendererColorSymbolsButton.set("disabled",!1);this._rendererColorApplyButton.set("disabled",!1);this.symbol=this._checkSymbol(this.renderer.infos[0].symbol,1<this.renderer.infos.length?this.renderer.infos[1].symbol:null);var c=this.renderer.infos[this.renderer.infos.length-1].symbol;this.classBreaksEndSize=c.width?c.width:c.size;this.renderer.defaultSymbol&&this.renderer.defaultLabel?this._rendererSizeOtherOption.set("label",this.i18n.hideOtherValues):
this._rendererSizeOtherOption.set("label",this.i18n.showOtherValues);this.renderer.backgroundFillSymbol?this._rendererSizeBackgroundOption.set("label",this.i18n.hideBackground):this._rendererSizeBackgroundOption.set("label",this.i18n.showBackground)}else this.classBreaksEndSize=(this.symbol.width?this.symbol.width:this.symbol.size)+("simplelinesymbol"==this.symbol.type?10:20);this._calculateDatePattern(this._rendererClassBreaksAttribute.get("value"));this._buildClassBreaksSizeValuesList(b,!1)},_buildClassBreaksSizeValuesList:function(b,
c){this._showLoading(a.byId("rendererSizeRendererGridDiv"));setTimeout(a.hitch(this,function(){this._buildClassBreaksSizeValuesListTimeout(b,c)}),1)},_buildClassBreaksSizeValuesListTimeout:function(b,c){if(this._rendererClassBreaksAttribute.get("value")==this.i18n.selectAField)this._hideLoading();else if(b)this._updateClassBreaksSizeRendererGrid();else if(this.attributesStore)if(c){var d=this.classBreaksSizeRendererGrid.getUpdatedRenderer();this._updateClassBreaksMinSize();this._updateClassBreaksIncreaseSize(d.breaks.length-
1);a.forEach(d.infos,function(b,c){var g=this._buildClassBreakSizeSymbol(c);b.symbol=g;d._symbols[b.value]==b.symbol;var h=0;a.forEach(d.breaks,function(a,c){a[0]==b.minValue&&a[1]==b.maxValue&&(h=c)});d.breaks[h].symbol=b.symbol},this);this.classBreaksSizeRendererGrid.updateRenderer(d);this._hideLoading()}else this.attributesStore.fetchItemByIdentity({identity:this._rendererClassBreaksAttribute.get("value"),onItem:a.hitch(this,function(b){var c=this._rendererClassBreaksMethod.get("value"),d=parseInt(this._rendererSizeBreaks.get("value")),
d=Math.min(Math.max(d,1),10);this._rendererSizeBreaks.set("value",d);var h=parseFloat(this._rendererSizeInterval.get("value"));this.attributesStore.fetchItemByIdentity({identity:this._rendererClassBreaksNormalizedBy.get("value"),onItem:a.hitch(this,function(n){var k;"percent"===n.type[0]?k={normalizationType:"percent-of-total"}:"none"!==n.type[0]&&(k={normalizationField:n.name[0],normalizationType:"field"});this._generateRendererClassBreaks(b,c,d,h,"size",k,a.hitch(this,function(a,b){this._buildClassBreaksSizeRenderer(a,
b)}))})})})}),this._rendererSizeOtherOption.set("label",this.i18n.showOtherValues)},_buildClassBreaksSizeRenderer:function(b,c){if(!b||0==b.length)this._hideLoading();else{this._updateClassBreaksMinSize();this._updateClassBreaksIncreaseSize(b.length);var d=this._getDefaultSymbol(this.geometryType),e=new esri.renderer.ClassBreaksRenderer(d,this._rendererClassBreaksAttribute.get("value"));e.defaultSymbol=null;e.setMaxInclusive(!0);e.normalizationType=c&&c.normalizationType;e.normalizationField=c&&c.normalizationField;
e.normalizationTotal=c&&c.normalizationTotal;"esriGeometryPolygon"===this.geometryType&&(e.backgroundFillSymbol=esri.symbol.fromJson(this.backgroundPolygonJson),this._rendererSizeBackgroundOption.set("label",this.i18n.hideBackground));var f=1;c&&"percent-of-total"===c.normalizationType&&a.forEach(b,function(a,b){a.maxValue!==a.minValue&&(f=Math.min(f,a.maxValue-a.minValue))});a.forEach(b,function(d,h){var n;if(d.label)n=d.label;else if("stdDev"==this._rendererClassBreaksMethod.get("value")&&h==(b.length-
1)/2)n="Mean";else if(c&&"percent-of-total"===c.normalizationType)n=this._buildRangeTextPercent(d.minValue,d.maxValue,f);else if(this.datePattern){if(n="",0<d.minValue.toString().length&&(n=a.date.locale.format(new Date(d.minValue),{datePattern:this.datePattern.datePattern,timePattern:this.datePattern.timePattern,selector:this.datePattern.datePattern&&this.datePattern.timePattern?null:this.datePattern.datePattern?"date":"time"})),0<d.maxValue.toString().length){var k=a.date.locale.format(new Date(d.maxValue),
{datePattern:this.datePattern.datePattern,timePattern:this.datePattern.timePattern,selector:this.datePattern.datePattern&&this.datePattern.timePattern?null:this.datePattern.datePattern?"date":"time"});n+=(0<n.length?" - ":"")+k}}else n=this._buildRangeText(d.minValue,d.maxValue);e.addBreak({minValue:d.minValue,maxValue:d.maxValue,symbol:this._buildClassBreakSizeSymbol(h),label:n})},this);this._updateClassBreaksSizeRendererGrid(e)}},_updateClassBreaksSizeRendererGrid:function(a){a=a||this.renderer;
this.classBreaksSizeRendererGrid?this.classBreaksSizeRendererGrid.updateRenderer(a):this.classBreaksSizeRendererGrid=new arcgisonline.sharing.dijit.RendererGrid({id:"classBreaksSizeGrid",renderer:a,datePattern:this.datePattern,defaultSymbol:this._getDefaultSymbol(this.geometryType),backgroundSymbol:"esriGeometryPolygon"===this.geometryType?esri.symbol.fromJson(this.backgroundPolygonJson):null,style:"position: relative; width: 100%; height:100%; overflow-y:hidden; overflow-x:hidden; padding:0;"},"rendererSizeRendererGrid");
this._hideLoading();this.adjustHeight()},_destroyClassBreaksSizeRendererGrid:function(){this.classBreaksSizeRendererGrid&&(this.classBreaksSizeRendererGrid.destroy(),this.classBreaksSizeRendererGrid=null,a.byId("rendererSizeRendererGrid")||a.create("div",{id:"rendererSizeRendererGrid"},a.byId("rendererSizeRendererGridDiv")))},_fillUniqueColorComboBox:function(b){b=a.map(b,a.hitch(this,function(b,d){var e='\x3cimg src\x3d"',e=(!a.isIE||8<a.isIE)&&0<b.imageData.length?e+("data:image/png;base64,"+b.imageData):
e+b.url;return{name:b.name,url:b.url,imageData:b.imageData,img:e+'" border\x3d"0" class\x3d"rendererImageSwatches"/\x3e',colors:b.colors}}));this.rendererUniqueColorStore=new s.data.AndOrWriteStore({data:{label:"img",identifier:"name",items:b}});this._rendererUniqueColor.setStore(this.rendererUniqueColorStore);this.adjustHeight();a.connect(this._rendererUniqueColor.dropDown,"onOpen",a.hitch(this,function(){this.adjustHeight()}))},_fillClassBreakColorComboBox:function(b){b=a.map(b,a.hitch(this,function(b,
d){var e='\x3cimg src\x3d"',e=(!a.isIE||8<a.isIE)&&0<b.imageData.length?e+("data:image/png;base64,"+b.imageData):e+b.url;return{name:b.name,url:b.url,imageData:b.imageData,img:e+'" border\x3d"0" class\x3d"rendererImageSwatches"/\x3e',colors:b.colors}}));this.rendererColorColorStore=new s.data.AndOrWriteStore({data:{label:"img",identifier:"name",items:b}});this._rendererColorColor.setStore(this.rendererColorColorStore);this.adjustHeight();a.connect(this._rendererColorColor.dropDown,"onOpen",a.hitch(this,
function(){this.adjustHeight()}))},_getColorSetGroup:function(b){var c=function(a,c){a&&a.results&&0<a.results.length?(this.colorSetGroupId=a.results[0].id,this._getColorSetItems(this.colorSetGroupId,b)):d(a,c)},d=function(a,b){console.log("Error retrieving color sets.")};this.colorSetGroupId?this._getColorSetItems(this.colorSetGroupId,b):arcgisonline.sharing.geow.Community.searchGroups(esriGeowConfig.colorSetsGroupQuery,a.hitch(this,c),a.hitch(this,d))},_getColorSetItems:function(b,c){var d=function(a,
b){a.results&&0<a.results.length?(this.colorSetItems=a.results,c()):e(a,b)},e=function(){console.log("Error retrieving color sets.")};this.colorSetItems?c():arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"search?num\x3d20\x26q\x3dgroup:"+b+' AND type:"Color Set"',a.hitch(this,d),a.hitch(this,e))},_buildColorList:function(b,c){if(!this.currentColorOrderIsDefault){var d=a.map(b,function(a){return a});d.reverse();b=d}var d=function(b,c,d){var e=[];if(2==d)e=[b,c];else for(var f=0;f<d;f++){var g=
1/(d-1)*f,g=new a.Color([b.r+g*(c.r-b.r),b.g+g*(c.g-b.g),b.b+g*(c.b-b.b)]);e.push(g.toRgba())}return e},e;if(1==c)e=[b[0]];else if(2==b.length)if(2==c)e=[b[0],b[1]];else{e=new a.Color(b[0]);var f=new a.Color(b[1]);e=d(e,f,c)}else{e=b[0];var g=b[1],h=b[2];5==b.length&&(g=b[2],h=b[4]);if(2==c)e=[e,h];else if(3==c)e=[e,g,h];else if(f=c,0===c%2&&(f=2*c-1),e=d(new a.Color(e),new a.Color(g),Math.ceil(f/2)),d=d(new a.Color(g),new a.Color(h),Math.ceil(f/2)),d.splice(0,1),e=e.concat(d),f!=c){d=[];for(f=0;f<
e.length;f++)0===f%2&&d.push(e[f]);e=d}}return e},getFeatures:function(a){arcgisonline.map.featColl.isFeatureCollectionLayer(a)||a instanceof esri.layers.CSVLayer?this.features||(this.features=this.layer.toJson().featureSet.features):this.features=this.layer.graphics;return this.features},getAttributeStore:function(){var b=arcgisonline.map.table.getPopupInfo(this.mapLayer,this.mapLayer.layer instanceof esri.layers.FeatureLayer?null:this.subLayerId),c=function(a){if(b&&b.fieldInfos)for(var c=0;c<b.fieldInfos.length;c++){var d=
b.fieldInfos[c];if(d.fieldName==a)return d.label}return null},d=this._getLayerFields(),d=a.map(d,a.hitch(this,function(b,d){var g={name:b.name,alias:c(b.name)||b.alias||b.name,type:b.type};b.domain&&b.domain.codedValues&&(g.codedValues=a.json.stringify(b.domain.codedValues));return g})),d=d.sort(function(a,b){var d=(c(a.name)||a.alias||a.name).toLowerCase(),h=(c(b.name)||b.alias||b.name).toLowerCase();return d==h?0:d<h?-1:1});d.splice(0,0,{name:"percent-of-total",alias:"\x26lt;"+this.i18n.normalizedByPercent+
"\x26gt;",type:"percent"});d.splice(0,0,{name:"none",alias:"\x26lt;"+this.i18n.normalizedByNone+"\x26gt;",type:"none"});d.splice(0,0,{name:this.i18n.selectAField,alias:this.i18n.selectAField,type:"selectAField"});this.attributesStore=new s.data.AndOrWriteStore({data:{label:"alias",identifier:"name",items:d}})},_buildRangeText:function(b,c){return b===c?""+a.number.format(b,{pattern:this.pattern}):(-Infinity==b||b==-Number.MAX_VALUE)&&c?"\x3c "+a.number.format(c,{pattern:this.pattern}):b&&(Infinity==
c||c==Number.MAX_VALUE)?"\x3e\x3d "+a.number.format(b,{pattern:this.pattern}):""+a.number.format(b,{pattern:this.pattern})+" - "+a.number.format(c,{pattern:this.pattern})},_buildRangeTextPercent:function(b,c,d){d=0.01<=d?2:1E-4<=d?4:6;return b===c?""+a.number.format(b,{places:d})+"%":(-Infinity==b||b==-Number.MAX_VALUE)&&c?"\x3c "+a.number.format(c,{places:d})+"%":b&&(Infinity==c||c==Number.MAX_VALUE)?"\x3e\x3d "+a.number.format(b,{places:d})+"%":""+a.number.format(b,{places:d})+"% - "+a.number.format(c,
{places:d})+"%"},_guessClassBreakSettings:function(){if(2>this.renderer.infos.length)this.currentClassBreakType="size",this._rendererType.set("value",this.currentClassBreakType),this._rendererSizeBreaks.set("value",2);else{var a=this.renderer.infos[0].symbol,c=this.renderer.infos[1].symbol,d,e;if("simplemarkersymbol"==a.type)d=a.size;else if("picturemarkersymbol"==a.type||"simplelinesymbol"==a.type)d=a.width;if("simplemarkersymbol"==c.type)e=c.size;else if("picturemarkersymbol"==c.type||"simplelinesymbol"==
c.type)e=c.width;this.currentClassBreakType=d<e?"size":"color";this._rendererType.set("value",this.currentClassBreakType);"color"==this.currentClassBreakType?this._rendererColorBreaks.set("value",this.renderer.infos.length):this._rendererSizeBreaks.set("value",this.renderer.infos.length)}},_generateRendererUniqueValues:function(b,c){b instanceof Array&&(b=b.toString());var d=new esri.tasks.UniqueValueDefinition;d.attributeField=b;var e=new esri.tasks.GenerateRendererParameters;e.classificationDefinition=
d;this.mapLayer.layer instanceof esri.layers.GeoRSSLayer||this.isFeatColl||this.isCSV?d=new esri.tasks.GenerateRendererTask(this.layer):this.hasDynamic?(d=this.mapLayer.layer.layerDefinitions&&this.mapLayer.layer.layerDefinitions[this.layer.id]?this.mapLayer.layer.layerDefinitions[this.layer.id]:null,e.where=d?d:null,d=new esri.tasks.GenerateRendererTask(this.mapLayer.url+"/dynamicLayer",{source:this.layer.source})):this.mapLayer.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer?(d=this.mapLayer.layer.layerDefinitions&&
this.mapLayer.layer.layerDefinitions[this.layer.id],e.where=d?d:null,d=new esri.tasks.GenerateRendererTask(this.mapLayer.url+"/"+this.layer.id)):(d=this.mapLayer.layer.getDefinitionExpression(),e.where=d?d:null,d=new esri.tasks.GenerateRendererTask(this.layer.url));d.execute(e,a.hitch(this,function(b){b=a.map(b.infos,function(a){return{value:a.value,label:a.label}});c(b)}),a.hitch(this,a.hitch(this,function(d){console.log("generateRenderer ",d);if(this.mapLayer.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer)this._rendererUniqueSymbolsButton.set("disabled",
!0),this._rendererUniqueApplyButton.set("disabled",!0),this._destroyUniqueValueRendererGrid(),this._hideLoading(),this._showError(a.byId("rendererUniqueRendererGridDiv"));else{d=a.map(this.getFeatures(this.layer),function(a){return{value:a.attributes[b]}});var e={};d=a.filter(d,function(a){return!e[a.value]?e[a.value]=!0:!1});c(d)}})))},_generateRendererClassBreaks:function(b,c,d,e,f,g,h){var n=b.name;n instanceof Array&&(n=n[0]);var k=new esri.tasks.ClassBreaksDefinition;k.classificationField=n;
k.breakCount=d;switch(c){case "natural":k.classificationMethod="natural-breaks";break;case "quantile":k.classificationMethod="quantile";break;case "stdDev":k.classificationMethod="standard-deviation";k.standardDeviationInterval=e;break;default:k.classificationMethod="equal-interval"}g&&(k.normalizationField=g.normalizationField,k.normalizationType=g.normalizationType);var l=new esri.tasks.GenerateRendererParameters;l.classificationDefinition=k;var m;if(this.mapLayer.layer instanceof esri.layers.GeoRSSLayer)m=
new esri.tasks.GenerateRendererTask(this.layer);else if(this.isFeatColl||this.isCSV)m=new esri.tasks.GenerateRendererTask(this.layer);else if(this.hasDynamic)c=this.mapLayer.layer.layerDefinitions&&this.mapLayer.layer.layerDefinitions[this.layer.id]?this.mapLayer.layer.layerDefinitions[this.layer.id]:null,l.where=c?c:null,m=new esri.tasks.GenerateRendererTask(this.mapLayer.url+"/dynamicLayer",{source:this.layer.source});else if(this.mapLayer.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer)m=
new esri.tasks.GenerateRendererTask(this.mapLayer.url+"/"+this.layer.id);else if(10.1>this.mapLayer.layer.version){if((d=this.getFeatures(this.layer))&&d.length)c=this.mapLayer.layer.getDefinitionExpression(),l.where=c?c:null,l.features=d,m=new esri.tasks.GenerateRendererTask(this.layer)}else c=this.mapLayer.layer.getDefinitionExpression(),l.where=c?c:null,m=new esri.tasks.GenerateRendererTask(this.layer.url);var p=function(c,d,e){console.log("generateRenderer ",e&&e.code,e&&e.message,e&&e.details);
if(!c&&!(d&&"percent-of-total"===d.normalizationType)&&(c=this.getFeatures(this.layer))&&c.length){l.features=c;a.disconnect(q);q=a.connect(m,"onError",a.hitch(this,p,c));m.execute(l);return}c=function(b){"color"==b?(this._rendererColorSymbolsButton.set("disabled",!0),this._rendererColorApplyButton.set("disabled",!0),this._destroyClassBreaksColorRendererGrid(),this._hideLoading(),this._showError(a.byId("rendererColorRendererGridDiv"))):(this._rendererSizeSymbolsButton.set("disabled",!0),this._rendererSizeApplyButton.set("disabled",
!0),this._destroyClassBreaksSizeRendererGrid(),this._hideLoading(),this._showError(a.byId("rendererSizeRendererGridDiv")))};this.mapLayer.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer?a.hitch(this,c,f)():(111==e.code?(e=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),e.show({title:this.i18n.errorDlgTitle,message:a.string.substitute(this.i18n.error.noNormalizedBy,{attribute:b.alias})})):(e=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),
e.show({title:this.i18n.errorDlgTitle,message:a.string.substitute(this.i18n.error.errorGenerateRenderer,{attribute:b.alias})})),a.hitch(this,c,f)(),h([]))};a.connect(m,"onComplete",a.hitch(this,function(b){if(b.infos&&b.infos.length&&(esri.isDefined(b.infos[0].classMaxValue)&&isNaN(b.infos[0].classMaxValue)||isNaN(b.infos[0].minValue)||isNaN(b.infos[0].maxValue)))a.hitch(this,p,{code:111,message:"generateRenderer returned NaN values"})();else{g&&"percent-of-total"===g.normalizationType&&(g.normalizationTotal=
b.normalizationTotal);var c=[];a.forEach(b.infos,function(a){c.push({minValue:a.minValue,maxValue:a.maxValue,label:this.datePattern||g&&"percent-of-total"===g.normalizationType?null:a.label})},this);h(c,g)}}));var q=a.connect(m,"onError",a.hitch(this,p,l.features,g));m.execute(l)},_calculateDatePattern:function(b){this.datePattern=null;this.attributesStore.fetchItemByIdentity({identity:b,onItem:a.hitch(this,function(b){if("esriFieldTypeDate"==b.type)if(this.mapLayer.layer instanceof esri.layers.ArcGISDynamicMapServiceLayer)this.datePattern=
{datePattern:this.i18n.datePattern,timePattern:this.i18n.hourTimePattern};else{var d=Number.MAX_VALUE,e=Number.MIN_VALUE;a.forEach(this.getFeatures(this.layer),function(a){a=a.attributes[b.name];null!==a&&(d=Math.min(d,a),e=Math.max(e,a))},this);var f=this.getFeatures(this.layer).length,f=Math.round((e-d)/f),e=d+f;this.datePattern=this._getDatePattern(new Date(d),new Date(e))}})})},_getDatePattern:function(a,c){var d=null,e=null;"unique"==this._rendererType.get("value")?(d=this.i18n.datePattern,e=
this.i18n.minuteTimePattern):c&&a.getFullYear()==c.getFullYear()?a.getMonth()==c.getMonth()?a.getDate()==c.getDate()?a.getHours()==c.getHours()?a.getMinutes()==c.getMinutes()?a.getSeconds()==c.getSeconds()?(d=this.i18n.datePattern,e=this.i18n.millisecondTimePattern):(d=this.i18n.datePattern,e=this.i18n.secondTimePattern):(d=this.i18n.datePattern,e=this.i18n.minuteTimePattern):(d=this.i18n.datePattern,e=this.i18n.hourTimePattern):2>c.getDate()-a.getDate()?(d=this.i18n.datePattern,e=this.i18n.hourTimePattern):
d=this.i18n.datePattern:d=this.i18n.datePattern:d=c&&2<c.getFullYear()-a.getFullYear()?this.i18n.yearPattern:this.i18n.datePattern;return{datePattern:d,timePattern:e}},_getSymbol:function(b,c){var d;if("esriGeometryPoint"==b||"esriGeometryMultipoint"==b)d=esri.symbol.fromJson(this.symbol.toJson()),c&&("cross"===d.style||"x"===d.style?d.outline.setColor(new a.Color([c[0],c[1],c[2],d.color.toRgba()[3]])):d.setColor(new a.Color([c[0],c[1],c[2],d.color.toRgba()[3]])));else if("esriGeometryPolyline"==
b||"esriGeometryPolygon"==b)d=esri.symbol.fromJson(this.symbol.toJson()),c&&(this.symbol.color?d.setColor(new a.Color([c[0],c[1],c[2],this.symbol.color.toRgba()[3]])):d.setColor(new a.Color(c)));return d},_getDefaultSymbol:function(a){return"esriGeometryPoint"==a||"esriGeometryMultipoint"==a?new esri.symbol.SimpleMarkerSymbol:"esriGeometryPolyline"==a?new esri.symbol.SimpleLineSymbol:"esriGeometryPolygon"==a?esri.symbol.fromJson(this.polygonJson):null},_updateClassBreaksMinSize:function(){"simplemarkersymbol"==
this.symbol.type?this.classBreaksMinSize=this.symbol.size:"picturemarkersymbol"==this.symbol.type?this.classBreaksMinSize=this.symbol.width:"simplelinesymbol"==this.symbol.type?this.classBreaksMinSize=this.symbol.width:"simplefillsymbol"==this.symbol.type&&(this.classBreaksMinSize=this.symbol.outline.width)},_updateClassBreaksIncreaseSize:function(a){this.classBreaksIncreaseSize=Math.round((this.classBreaksEndSize-this.classBreaksMinSize)/a)},_buildClassBreakSizeSymbol:function(a){var c=esri.symbol.fromJson(this.symbol.toJson());
a=this.classBreaksMinSize+a*this.classBreaksIncreaseSize;a>this.classBreaksEndSize&&(a=this.classBreaksEndSize);"simplemarkersymbol"==c.type?c.setSize(a):"picturemarkersymbol"==c.type?(c.setHeight(c.height/c.width*a),c.setWidth(a)):"simplelinesymbol"==c.type&&c.setWidth(a);return c},_showLoading:function(b){b=a.coords(b);a.style(a.byId("rendererListLoading"),"top",b.y-85+"px");a.style(a.byId("rendererListLoading"),"left",b.x-3+"px");a.style(a.byId("rendererListLoading"),"display",10>a.isIE?"inline":
"")},_hideLoading:function(){a.style(a.byId("rendererListLoading"),"display","none");this._hideError()},_showError:function(b){b=a.coords(b);a.style(a.byId("rendererListError"),"top",b.y-85+"px");a.style(a.byId("rendererListError"),"left",b.x-3+"px");a.style(a.byId("rendererListError"),"display",10>a.isIE?"inline":"")},_hideError:function(){a.style(a.byId("rendererListError"),"display","none")},_isLoading:function(){return"none"!==a.style(a.byId("rendererListLoading"),"display")},_getLayerFields:function(){if(this.hasDynamic){var b=
this.serviceLayerInfo.fields;return this.mapLayer.thematicGroup&&this.mapLayer.thematicGroup.fieldNames&&this.mapLayer.thematicGroup.fieldNames.length?a.filter(b,function(b){return a.some(this.mapLayer.thematicGroup.fieldNames,function(a){return a===b.name},this)},this):b}return this.layer.fields},adjustHeight:function(b){if(!("undefined"==typeof leftPanel||"rendererStack"!=leftPanel.visibleStack)){var c=60;a.forEach(a.query(".firstColumnLabel",this.domNode),function(b){c=Math.max(c,a.coords(b).w)});
a.query(".firstColumnDiv",this.domNode).style("width",c+"px");var d=20;a.forEach(a.query(".secondColumnLabel",this.domNode),function(b){d=Math.max(d,a.coords(b).w)});a.query(".secondColumnDiv",this.domNode).style("width",d+"px");var e=a.coords(a.byId("leftContentStackContainer")).h,f=a.coords(a.byId("rendererHeader")).h;b=a.coords(a.byId("rendererContentClose")).h-5;var g=a.coords(a.byId("rendererFooter_links")).h+10;a.style(a.byId("rendererContentFooter"),"height",g+"px");e=e-f-b-g-23;0<e&&a.style(a.byId("rendererPane"),
"height",e+"px");f=a.coords(a.byId("leftContentStackContainer")).w;newWidth=f-16;0<newWidth&&a.style(a.byId("rendererPane"),"width",newWidth+"px");if(this._rendererType){var h=f-c-25;0<h&&a.style(this._rendererType.domNode,"width",h+"px");f=h-d-3;"unique"==this._rendererType.get("value")&&0<e&&0<newWidth?(0<h&&(a.style(this._rendererUniqueAttribute.domNode,"width",h+"px"),a.style(this._rendererUniqueColor.domNode,"width",h+"px"),a.forEach(a.query(".rendererUniqueColor .rendererImageSwatches","rendererPane"),
function(b){a.style(b,"width",h-30+"px")}),a.forEach(a.query(".dijitMenuPopup .rendererImageSwatches",null),function(b){a.style(b,"width",h-30+"px")})),e=a.coords(a.byId("rendererUniqueRendererGridDiv")).t,f=a.coords(a.byId("rendererContentFooter")).t,b=f-e-b-10,8>=a.isIE&&(b-=35),0<b&&a.style(a.byId("rendererUniqueRendererGridDiv"),"height",b+"px"),a.style(a.byId("rendererUniqueRendererGridDiv"),"width",newWidth-2+"px"),9>a.isIE&&this.uniqueValueRendererGrid&&(0<b&&a.style(this.uniqueValueRendererGrid.domNode,
"height",b+"px"),a.style(this.uniqueValueRendererGrid.domNode,"width",newWidth-2+"px")),this.uniqueValueRendererGrid&&this.uniqueValueRendererGrid.resize(),a.forEach(a.query(".dojoxGridRowTable","rendererUniqueRendererGridDiv"),function(b){a.style(b,"width","100%")}),a.forEach(a.query(".item","rendererUniqueRendererGridDiv"),function(b){a.style(b,"width",newWidth-37+"px")})):"color"==this._rendererType.get("value")&&0<e&&0<newWidth?(0<h&&(a.style(this._rendererClassBreaksAttribute.domNode,"width",
h+"px"),a.style(this._rendererClassBreaksMethod.domNode,"width",h+"px"),a.style(this._rendererColorColor.domNode,"width",h+"px"),a.forEach(a.query(".rendererColorColor .rendererImageSwatches","rendererPane"),function(b){a.style(b,"width",h-30+"px")}),a.forEach(a.query(".dijitMenuPopup .rendererImageSwatches",null),function(b){a.style(b,"width",h-30+"px")}),a.style(this._rendererClassBreaksNormalizedBy.domNode,"width",f+"px")),e=a.coords(a.byId("rendererColorRendererGridDiv")).t,f=a.coords(a.byId("rendererContentFooter")).t,
b=f-e-b-10,8>=a.isIE&&(b-=35),0<b&&a.style(a.byId("rendererColorRendererGridDiv"),"height",b+"px"),a.style(a.byId("rendererColorRendererGridDiv"),"width",newWidth-2+"px"),9>a.isIE&&this.classBreaksColorRendererGrid&&(0<b&&a.style(this.classBreaksColorRendererGrid.domNode,"height",b+"px"),a.style(this.classBreaksColorRendererGrid.domNode,"width",newWidth-2+"px")),this.classBreaksColorRendererGrid&&this.classBreaksColorRendererGrid.resize(),a.forEach(a.query(".dojoxGridRowTable","rendererColorRendererGridDiv"),
function(b){a.style(b,"width","100%")}),a.forEach(a.query(".item","rendererColorRendererGridDiv"),function(b){a.style(b,"width",newWidth-37+"px")})):"size"==this._rendererType.get("value")&&(0<e&&0<newWidth)&&(0<h&&(a.style(this._rendererClassBreaksAttribute.domNode,"width",h+"px"),a.style(this._rendererClassBreaksMethod.domNode,"width",h+"px"),a.style(this._rendererClassBreaksNormalizedBy.domNode,"width",f+"px")),e=a.coords(a.byId("rendererSizeRendererGridDiv")).t,f=a.coords(a.byId("rendererContentFooter")).t,
b=f-e-b-10,8>=a.isIE&&(b-=35),a.isFF&&(b-=1),0<b&&a.style(a.byId("rendererSizeRendererGridDiv"),"height",b+"px"),a.style(a.byId("rendererSizeRendererGridDiv"),"width",newWidth-2+"px"),9>a.isIE&&this.classBreaksSizeRendererGrid&&(0<b&&a.style(this.classBreaksSizeRendererGrid.domNode,"height",b+"px"),a.style(this.classBreaksSizeRendererGrid.domNode,"width",newWidth-2+"px")),this.classBreaksSizeRendererGrid&&this.classBreaksSizeRendererGrid.resize(),a.forEach(a.query(".dojoxGridRowTable","rendererSizeRendererGridDiv"),
function(b){a.style(b,"width","100%")}),a.forEach(a.query(".item","rendererSizeRendererGridDiv"),function(b){a.style(b,"width",newWidth-37+"px")}))}}},getMarkerJson:function(){var a=this.markerJson;a.url=arcgisonline.sharing.util.getRedSphereUrl();return a},_checkSymbol:function(b,c){if("simplemarkersymbol"!==b.type&&"simplelinesymbol"!==b.type&&"simplefillsymbol"!==b.type||!b.color)return b;var d=b.color.toRgba();if(0===d[3]&&(!b.outline||b.outline&&(0===b.outline.width||b.outline.color&&0===b.outline.color.toRgba()[3])))c?
0===c.color.toRgba()[3]&&(!c.outline||c.outline&&(0===c.outline.width||c.outline.color&&0===c.outline.color.toRgba()[3]))?b.setColor(new a.Color([d[0],d[1],d[2],1])):b=c:b.setColor(new a.Color([d[0],d[1],d[2],1]));return b},_onChangeStreamPrevious:function(){this.rendererStreamPreviousCheck.get("checked")||this.rendererStreamConnectCheck.set("checked",!1);this._onSaveRenderer()},_onChangeStreamMaxTrackPts:function(a){this.rendererStreamPreviousCheck.get("checked")?this._onSaveRenderer():this.rendererStreamPreviousCheck.set("checked",
!0)},_onChangeStreamConnect:function(){this.rendererStreamConnectCheck.get("checked")?this.rendererStreamPreviousCheck.get("checked")?this._onSaveRenderer():this.rendererStreamPreviousCheck.set("checked",!0):this._onSaveRenderer()}})});