// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/Gallery",["dijit","dojo","dojox","dojo/i18n!arcgisonline/nls/arcgisonline","dojo/require!arcgisonline/sharing/dijit/views,dijit/_Widget,dijit/_Templated,dojo/NodeList-fx,dijit/layout/ContentPane,arcgisonline/sharing/util,dijit/form/Button,arcgisonline/sharing/geow/QueryReadStore"],function(g,a,l){a.provide("arcgisonline.sharing.dijit.Gallery");a.require("arcgisonline.sharing.dijit.views");a.require("dijit._Widget");a.require("dijit._Templated");a.require("dojo.NodeList-fx");
a.require("dijit.layout.ContentPane");a.require("arcgisonline.sharing.util");a.require("dijit.form.Button");a.requireLocalization("arcgisonline","arcgisonline");a.require("arcgisonline.sharing.geow.QueryReadStore");a.declare("arcgisonline.sharing.dijit.Gallery",[g._Widget,g._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv dojoAttachPoint\x3d"containerNode"\x3e\r\n  \x3cdiv class\x3d"clearfix galleryBackground"\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"flowContainer" class\x3d"clearfix"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"pageControls" class\x3d"esriFloatLeading" style\x3d"maxheight: 3em; width: 100%; clear: both;"\x3e\r\n      \x3cp style\x3d"text-align: center;"\x3e\r\n        \x3cspan dojoType\x3d"dijit.form.Button" dojoAttachPoint\x3d"_prev" style\x3d"display:none;"\x3e${i18n.previous}\x3c/span\x3e\r\n        \x3cspan dojoAttachPoint\x3d"_pages" dojoAttachEvent\x3d"onClick:goToPage" class\x3d"esriItemLinks esriPagingLinks"\x3e\x3c/span\x3e\r\n        \x3cspan dojoType\x3d"dijit.form.Button" dojoAttachPoint\x3d"_next" style\x3d"display:none;"\x3e${i18n.next}\x3c/span\x3e\r\n      \x3c/p\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
tooltip:null,showToolTip:!0,showNodeLabels:!0,showThumbnailInDetails:!0,fadeOutOtherNodes:!0,animFadeOut:!0,unfocusedOpacity:0.5,highlightFocusedNode:!0,largeNodes:0,maxNodes:0,flowContainer:null,showDelay:300,nodesPerPage:4,currentPage:1,pageCount:1,maxPages:null,showPageControls:!0,_prev:null,_next:null,_pages:null,nodeClass:"galleryNode",nodeHighlightClass:"highlight",thumbClass:"galleryThumbnail",labelClass:"label",labelBgClass:"galleryLabelContainer",detailsClass:"galleryDetail",detailsThumbClass:"galleryDetailThumb",
messageClass:"galleryMessage",_lastFocusedNode:null,_timer:null,_galleryFadeIn:null,_galleryFadeOut:null,_galleryFadeOutTotal:null,_suspendTooltip:!1,includeNode:null,_defaultNoResultsMessage:null,noResultsMessage:null,items:null,i18n:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=a.i18n.getLocalization("arcgisonline","arcgisonline").common;a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").gallery);this._defaultNoResultsMessage=this.i18n.filterNoResults},
postCreate:function(){this._userToken=(this._user=arcgisonline.sharing.util.getUser())&&this._user.token;null===this.tooltip&&(this.tooltip=new arcgisonline.sharing.dijit._GalleryContentPane({_gallery:this},a.create("div",{id:this.id+"_popup"},a.body())),this._galleryFadeIn=a.animateProperty({node:this.flowContainer,properties:{opacity:1}}),this._galleryFadeOut=a.animateProperty({node:this.flowContainer,properties:{opacity:this.unfocusedOpacity}}),this._galleryFadeOutTotal=a.animateProperty({node:this.flowContainer,
properties:{opacity:0}}),a.connect(this.domNode,"scroll",this,function(){this.tooltip&&this.tooltip.isShowing&&this.tooltip.hide()}),this.showPageControls&&(a.connect(this,"onContentChange",this,this._layoutPageControls),a.connect(this,"onPageChange",this,this._layoutPageControls)))},_showTooltip:function(b,c){var e=this.tooltip.domNode,d;esriGeowConfig.isRightToLeft||(d=this.showThumbnailInDetails?{TL:"TL",TR:"TR"}:{TL:"TR",TR:"TL"});esriGeowConfig.isRightToLeft&&(d=this.showThumbnailInDetails?{BR:"BR"}:
{BR:"TR"});d=g.placeOnScreenAroundNode(e,b,d);this.tooltip.set("content",this._buildItemDetailsLayout(c,d,b));if(this.showThumbnailInDetails){var f="none"==a.style(e,"display");f&&a.style(e,{visibility:"hidden",display:"block"});var h=a.contentBox(e),k=a.coords(e);f&&a.style(e,{visibility:"",display:"none"});"TR"==d.aroundCorner?(a.style(e,"top",k.t-h.t+"px"),a.style(e,"left",k.l+h.l+"px")):"TL"==d.aroundCorner&&(a.style(e,"top",k.t-h.t+"px"),a.style(e,"left",k.l-h.l+"px"))}this._highlightNode(c);
this.tooltip.show()},node_onMouseEnter:function(b){var c=b.currentTarget,e=this._getItemByNode(c);this.onNodeMouseEnter(b,e);!this._suspendTooltip&&this.showToolTip&&(this.tooltip.isShowing&&this.tooltip.hide(),this._timer&&(clearTimeout(this._timer),this._timer=null),this._unhighlightNodes(),this._timer||(this._timer=setTimeout(a.hitch(this,function(){this._showTooltip(c,e)}),this.showDelay)))},node_onMouseLeave:function(a){this._timer&&(clearTimeout(this._timer),this._timer=null);var c=this._getItemByNode(a.currentTarget);
this.onNodeMouseLeave(a,c)},tooltip_onMouseLeave:function(a){this._unhighlightNodes();this.tooltip.hide()},_highlightNode:function(b){b=a.byId("galleryNode_"+b.id);this.fadeOutOtherNodes&&(this.animFadeOut?(this._galleryFadeIn.stop(),this._galleryFadeOut.play()):a.style(this.flowContainer,"opacity",this.unfocusedOpacity));this.highlightFocusedNode&&a.addClass(b,this.nodeHighlightClass);this._lastFocusedNode=b},_unhighlightNodes:function(){this.fadeOutOtherNodes&&(this.animFadeOut?(this._galleryFadeOut.stop(),
this._galleryFadeIn.play()):a.style(this.flowContainer,"opacity",1));null!==this._lastFocusedNode&&a.removeClass(this._lastFocusedNode,this.nodeHighlightClass);this._lastFocusedNode=null},_loadItems:function(b){this.tooltip&&this.tooltip.hide();this._galleryFadeIn.stop();this._galleryFadeOut.stop();this._galleryFadeOutTotal.onEnd=a.hitch(this,function(b){a.empty(this.flowContainer);0<b.length?(this.maxNodes&&(b=b.splice(0,this.maxNodes)),a.forEach(b,a.hitch(this,function(a,b){a.id||(a.id=b);this.flowContainer.appendChild(this._buildNodeLayout(a,
b<this.largeNodes))})),a.create("br",{style:{clear:"both"}},this.flowContainer),b=a.query("."+this.nodeClass,this.domNode),b.connect("onmouseenter",this,this.node_onMouseEnter),b.connect("onmouseleave",this,this.node_onMouseLeave),this.tooltip&&a.connect(this.tooltip.domNode,"onmouseleave",this,this.tooltip_onMouseLeave)):a.create("span",{innerHTML:this.noResultsMessage||this._defaultNoResultsMessage,"class":this.messageClass},this.flowContainer);this._galleryFadeIn.play();this._galleryFadeOut.onEnd=
null;this._suspendTooltip=!1},b);this._galleryFadeOutTotal.play()},clear:function(b){this.tooltip&&this.tooltip.hide();this._galleryFadeIn.stop();this._galleryFadeOut.stop();a.empty(this.flowContainer);a.empty(this._pages);a.create("span",{innerHTML:b,"class":this.messageClass},this.flowContainer);this._galleryFadeIn.play();this._galleryFadeOut.onEnd=null;this._suspendTooltip=!1},_buildNodeLayout:function(b,c){var e=a.create("div",{id:"galleryNode_"+b.id,"class":this.nodeClass});a.addClass(e,c?"large":
"small");var d=arcgisonline.sharing.util,f=d.relativeToExplicitUrl("images/transparent.gif");"Web Mapping Application"==b.type&&d.getStaticImagesUrl();f="Mobile Application"==b.type?d.getStaticImagesUrl()+"/mobileapp.png":"Web Scene"===b.type||"Scene Service"===b.type?d.getStaticImagesUrl()+"/desktopapp.png":"Workforce Project"===b.type?d.getStaticImagesUrl()+"/workforceproject.png":d.getStaticImagesUrl()+"/desktopapp.png";d.getGalleryMainLinkInfo(b);d=a.create("a",{href:"#"},e);a.connect(d,"onclick",
this,this.onNodeClick,b);a.create("img",{"class":this.thumbClass,src:b.thumbnail?this._getThumbailUrl(b):f},d);this.showNodeLabels&&(f=a.create("div",{"class":"galleryLabelContainer"},e),d=b.title||"",a.create("span",{innerHTML:d,alt:d,title:d},f));return e},_buildItemDetailsLayout:function(a,c,e){return arcgisonline.sharing.dijit.views.item.medium(a,{showThumb:this.showThumbnailInDetails,align:(esriGeowConfig.isRightToLeft?0:"TR"==c.aroundCorner)?"right":"left",hideOpenMenu:!0,showProfilePopup:!1})},
_getItemByNode:function(b){for(;!a.hasClass(b,this.nodeClass);)b=b.parentNode;b=b.id.substr(b.id.indexOf("_")+1);for(var c=0;c<this.items.length;c++)if(this.items[c].id==b)return this.items[c];return null},_getThumbailUrl:function(a){var c=this._userToken;return esriGeowConfig.restBaseUrl+"content/items/"+a.id+"/info/"+a.thumbnail+(c?"?token\x3d"+c:"")},_layoutPageControls:function(){a.empty(this._pages);if(1!==this.pageCount){for(var b=1;b<=this.pageCount;b++){var c=a.create("span",{innerHTML:b},
a.create("a",{onclick:a.hitch(this,this.goToPage,b)},this._pages));b==this.currentPage&&a.addClass(c,"currentPage")}1==this.currentPage?a.style(this._prev.domNode,"visibility","hidden"):a.style(this._prev.domNode,"visbility","");this.currentPage==this.pageCount?a.style(this._next.domNode,"visibility","hidden"):a.style(this._next.domNode,"visbility","")}},nextPage:function(){this.currentPage<this.pageCount&&this.goToPage(this.currentPage+1)},prevPage:function(){1<this.currentPage&&this.goToPage(this.currentPage-
1)},goToPage:function(a){0<this.pageCount&&(!isNaN(a)&&0<a)&&(this._suspendTooltip=!0,this._loadRange((a-1)*this.nodesPerPage,this.nodesPerPage),this.currentPage=a,this.onPageChange(this.currentPage,-1))},_loadRange:function(b,c){var e=a.clone(this.items);this._loadItems(e.splice(b,c))},_setItemsAttr:function(b){this.items=this.includeNode?a.filter(b,this.includeNode):b;0==this.items.length?(this.pageCount=1,this.onContentChange(0)):(this.pageCount=Math.ceil(this.items.length/this.nodesPerPage),this.onContentChange(this.items.length));
this.currentPage=1;this.goToPage(1)},onPageChange:function(a,c){},onContentChange:function(a){},onNodeClick:function(a,c){},onNodeMouseEnter:function(a,c){},onNodeMouseLeave:function(a,c){}});a.declare("arcgisonline.sharing.dijit._GalleryContentPane",g.layout.ContentPane,{_gallery:null,animateShowHide:!0,"class":"galleryPopup",fadeDuration:300,isShowing:!1,postCreate:function(){this.inherited(arguments);a.style(this.domNode,{position:"absolute",top:"-1000px",opacity:0});a.style(this.domNode,esriGeowConfig.isRightToLeft||
-1<a.indexOf(["ar","he"],a.locale)?"right":"left","-1000px");this.fadeIn=a.fadeIn({node:this.domNode,duration:this.fadeDuration});this.fadeOut=a.fadeOut({node:this.domNode,duration:this.fadeDuration,onEnd:a.hitch(this,"_afterFade")})},_afterFade:function(){a.style(this.domNode,{top:"-1000px"});a.style(this.domNode,esriGeowConfig.isRightToLeft?"right":"left","-1000px")},show:function(b){this.isShowing=!0;this.animateShowHide?(this.fadeOut.stop(),this.fadeIn.play()):a.style(this.domNode,"display","block")},
hide:function(){this.isShowing=!1;this.animateShowHide?(this.fadeIn.stop(),this.fadeOut.play()):a.style(this.domNode,"display","none")}})});