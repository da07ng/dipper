// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/dijit/Organization",["dijit","dojo","dojox","dojo/i18n!arcgisonline/nls/arcgisonline","dojo/require!dijit/_Widget,dijit/_Templated,dijit/_editor/plugins/FontChoice,dijit/_editor/plugins/ViewSource,dijit/Editor,dijit/form/TextBox,dijit/form/Button,dijit/form/CheckBox,dijit/form/NumberTextBox,dijit/form/RadioButton,dijit/form/Select,dijit/form/MultiSelect,dijit/form/FilteringSelect,dijit/layout/BorderContainer,dijit/layout/ContentPane,dijit/layout/TabContainer,dijit/Menu,dijit/MenuItem,dijit/Tooltip,dojo/json,dojo/data/ItemFileReadStore,dojo/data/ItemFileWriteStore,dojo/io/iframe,dojo/io/script,dojo/store/Memory,dojo/DeferredList,dgrid/editor,esri/IdentityManager,arcgisonline/map/main,arcgisonline/sharing/util,arcgisonline/sharing/geow/Account,arcgisonline/sharing/geow/Community,arcgisonline/sharing/geow/Content,arcgisonline/sharing/geow/Geow,arcgisonline/sharing/geow/Roles,arcgisonline/sharing/dijit/ComboBox,arcgisonline/sharing/dijit/TravelModes,arcgisonline/sharing/dijit/CustomRoles,arcgisonline/sharing/dijit/DataGrid,arcgisonline/sharing/dijit/Grid,arcgisonline/sharing/dijit/GroupSelector,arcgisonline/sharing/dijit/LinkDialog,arcgisonline/sharing/dijit/ManageLicenses,arcgisonline/sharing/dijit/OpenData,arcgisonline/sharing/dijit/PrintTemplates,arcgisonline/sharing/dijit/ConfigureAGOLUtilServices,arcgisonline/sharing/dijit/SecuredHosts,arcgisonline/sharing/dijit/ProfilePopup,arcgisonline/sharing/dijit/_NetworkServicesMixin,arcgisonline/sharing/dijit/dialog/AddGeocoderDlg,arcgisonline/sharing/dijit/dialog/InviteAccountUsersDlg,arcgisonline/sharing/dijit/dialog/DeleteWarningDlg,arcgisonline/sharing/dijit/dialog/ExtentDlg,arcgisonline/sharing/dijit/dialog/FederateServerDlg,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/dialog/ChoiceDlg,arcgisonline/sharing/dijit/dialog/ManageSubscriptionDlg,arcgisonline/sharing/dijit/dialog/SetIdentityProviderDlg,arcgisonline/sharing/dijit/dialog/ResendInviteDlg,arcgisonline/sharing/dijit/dialog/PasswordPolicyDlg,arcgisonline/sharing/dijit/dialog/BatchAssignToGroupsDlg,arcgisonline/sharing/dijit/dialog/BatchAssignCreditsDlg,arcgisonline/sharing/dijit/dialog/AssignCreditsDlg"],
function(g,c,q){c.provide("esri.arcgisonline.sharing.dijit.Organization");c.require("dijit._Widget");c.require("dijit._Templated");c.require("dijit._editor.plugins.FontChoice");c.require("dijit._editor.plugins.ViewSource");c.require("dijit.Editor");c.require("dijit.form.TextBox");c.require("dijit.form.Button");c.require("dijit.form.CheckBox");c.require("dijit.form.NumberTextBox");c.require("dijit.form.RadioButton");c.require("dijit.form.Select");c.require("dijit.form.MultiSelect");c.require("dijit.form.FilteringSelect");
c.require("dijit.layout.BorderContainer");c.require("dijit.layout.ContentPane");c.require("dijit.layout.TabContainer");c.require("dijit.Menu");c.require("dijit.MenuItem");c.require("dijit.Tooltip");c.require("dojo.json");c.require("dojo.data.ItemFileReadStore");c.require("dojo.data.ItemFileWriteStore");c.require("dojo.io.iframe");c.require("dojo.io.script");c.require("dojo.store.Memory");c.require("dojo.DeferredList");c.require("dgrid.editor");c.require("esri.IdentityManager");c.require("arcgisonline.map.main");
c.require("arcgisonline.sharing.util");c.require("arcgisonline.sharing.geow.Account");c.require("arcgisonline.sharing.geow.Community");c.require("arcgisonline.sharing.geow.Content");c.require("arcgisonline.sharing.geow.Geow");c.require("arcgisonline.sharing.geow.Roles");c.require("arcgisonline.sharing.dijit.ComboBox");c.require("arcgisonline.sharing.dijit.TravelModes");c.require("arcgisonline.sharing.dijit.CustomRoles");c.require("arcgisonline.sharing.dijit.DataGrid");c.require("arcgisonline.sharing.dijit.Grid");
c.require("arcgisonline.sharing.dijit.GroupSelector");c.require("arcgisonline.sharing.dijit.LinkDialog");c.require("arcgisonline.sharing.dijit.ManageLicenses");c.require("arcgisonline.sharing.dijit.OpenData");c.require("arcgisonline.sharing.dijit.PrintTemplates");c.require("arcgisonline.sharing.dijit.ConfigureAGOLUtilServices");c.require("arcgisonline.sharing.dijit.SecuredHosts");c.require("arcgisonline.sharing.dijit.ProfilePopup");c.require("arcgisonline.sharing.dijit._NetworkServicesMixin");c.require("arcgisonline.sharing.dijit.dialog.AddGeocoderDlg");
c.require("arcgisonline.sharing.dijit.dialog.InviteAccountUsersDlg");c.require("arcgisonline.sharing.dijit.dialog.DeleteWarningDlg");c.require("arcgisonline.sharing.dijit.dialog.ExtentDlg");c.require("arcgisonline.sharing.dijit.dialog.FederateServerDlg");c.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");c.require("arcgisonline.sharing.dijit.dialog.ChoiceDlg");c.require("arcgisonline.sharing.dijit.dialog.ManageSubscriptionDlg");c.require("arcgisonline.sharing.dijit.dialog.SetIdentityProviderDlg");
c.require("arcgisonline.sharing.dijit.dialog.ResendInviteDlg");c.require("arcgisonline.sharing.dijit.dialog.PasswordPolicyDlg");c.require("arcgisonline.sharing.dijit.dialog.BatchAssignToGroupsDlg");c.require("arcgisonline.sharing.dijit.dialog.BatchAssignCreditsDlg");c.require("arcgisonline.sharing.dijit.dialog.AssignCreditsDlg");c.requireLocalization("arcgisonline","arcgisonline");c.declare("arcgisonline.sharing.dijit.Organization",[g._Widget,g._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv data-dojo-type\x3d"dijit.layout.ContentPane" data-dojo-attach-point\x3d"containerNode" class\x3d"orgDijit"\x3e\r\n  \x3cdiv id\x3d"myOrgView" data-dojo-attach-point\x3d"_myOrgView"\x3e\r\n    \x3cdiv id\x3d"newAccountSplash" style\x3d"width:780px; clear:both; margin-top:2em; padding-left:10px; display:none;" class\x3d"newAccount"\x3e\x3c/div\x3e\r\n\r\n    \x3cdiv style\x3d"width:780px; clear:both; margin-top:2em; margin-bottom: 1em; padding-left:10px;" class\x3d"editOnly"\x3e\r\n      \x3cbutton id\x3d"upperSave" data-dojo-attach-event\x3d"onClick:saveEdit" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"editOnly calcite blue"\x3e${i18n.saveLabel}\x3c/button\x3e\r\n      \x3cbutton data-dojo-attach-event\x3d"onClick:cancelEdit" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"editOnly calcite transparent"\x3e${i18n.cancel}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv style\x3d"clear:both;margin-top:2em;margin-left:-1em;margin-right:-1em;display:none;" id\x3d"organization-control-div"\x3e\r\n      \x3cbutton id\x3d"organization-edit-button" data-dojo-attach-event\x3d"onClick:startEdit" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-props\x3d"iconClass:\'esriEditGroupIcon\'" class\x3d"readOnly calcite transparent"\x3e${i18n.editLabel}\x3c/button\x3e\r\n      \x3cspan id\x3d"organization-adduser-span"\x3e\x3cbutton id\x3d"organization-adduser-btn" data-dojo-attach-event\x3d"onClick:inviteUsers" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-props\x3d"iconClass:\'esriJoinGroupIcon\'" class\x3d"readOnly calcite transparent"\x3e${i18n.inviteUsersLabel}\x3c/button\x3e\x3c/span\x3e\r\n      \x3cbutton id\x3d"organization-view-status-button" data-dojo-attach-event\x3d"onClick:viewStatus" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-props\x3d"iconClass:\'esriViewStatusIcon\'" class\x3d"calcite transparent"\x3e${i18n.subscriptionStatus.viewStatus}\x3c/button\x3e\r\n      \x3cbutton id\x3d"organization-view-health-button" data-dojo-attach-event\x3d"onClick:viewHealth" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-props\x3d"iconClass:\'esriViewHealthIcon\'" class\x3d"calcite transparent"\x3e${i18n.viewHealth}\x3c/button\x3e\r\n      \x3cspan id\x3d"organization-manage-licenses-span"\x3e\x3cbutton id\x3d"organization-manage-licenses-button" data-dojo-attach-event\x3d"onClick:manageLicenses" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" data-dojo-props\x3d"iconClass:\'esriManageLicensesIcon\'" class\x3d"calcite transparent"\x3e${i18n.manageLicensesLabel}\x3c/button\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"esriFloatLeading editOnly esriLeadingMargin1" style\x3d"width:850px; margin-bottom:1em; clear:both;"\x3e\r\n\r\n      \x3cdiv id\x3d"editTabs" style\x3d"width:100%; height:100%;"\x3e\x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv style\x3d"width:780px; clear:both; padding-left:10px;" class\x3d"editOnly"\x3e\r\n      \x3cbutton id\x3d"lowerSave" data-dojo-attach-event\x3d"onClick:saveEdit" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"editOnly calcite blue"\x3e${i18n.saveLabel}\x3c/button\x3e\r\n      \x3cbutton data-dojo-attach-event\x3d"onClick:cancelEdit" data-dojo-type\x3d"dijit.form.Button" type\x3d"button" class\x3d"editOnly calcite transparent"\x3e${i18n.cancel}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"esriFloatLeading readOnly orgTable orgTableLrg" class\x3d"esriTrailingMargin2"\x3e\r\n      \x3cspan class\x3d"section"\x3e${i18n.membersLabel}\x3c/span\x3e\x3cbr/\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit.layout.ContentPane" data-dojo-props\x3d"region:top" class\x3d"borderedContent" style\x3d"width:100%;"\x3e\r\n        \x3cdiv id\x3d"organizationUsersToolbar" data-dojo-type\x3d"dijit.Toolbar" data-dojo-attach-point\x3d"_userGridToolbar"\x3e\r\n          ${i18n.viewingLabel} \x3cdiv data-dojo-attach-point\x3d"_memberView" data-dojo-type\x3d"arcgisonline.sharing.dijit.ComboBox" style\x3d"display:inline-block;zoom:1;*display:inline;"\x3e\x3c/div\x3e\r\n          \x3cspan class\x3d"esriFloatTrailing"\x3e\r\n            \x3cinput data-dojo-attach-point\x3d"_userSearchText" data-dojo-type\x3d"dijit.form.TextBox" data-dojo-attach-event\x3d"onKeyPress:onUserSearchKeyPress" class\x3d"userSearchText currentMembers" type\x3d"text" data-dojo-props\x3d"trim:true" value\x3d""/\x3e\r\n            \x3cbutton data-dojo-attach-event\x3d"onclick:onUserSearchClick" style\x3d"margin:0; padding:0; border:0; background-color:transparent;" id\x3d"usersearch-submit" alt\x3d"" title\x3d"" class\x3d"currentMembers" data-dojo-attach-point\x3d"_userSearchButton"\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3c/button\x3e\r\n          \x3c/span\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit.layout.BorderContainer" data-dojo-props\x3d"design:\'headline\',gutters:false,preventcache:true,usecache:false,cachecontent:false,region:\'center\'" class\x3d"borderedContent currentMembers" style\x3d"width:100%; height:410px;"\x3e\r\n        \x3cdiv id\x3d"userGridContentPane" data-dojo-attach-point\x3d"_userGridContentPane" data-dojo-type\x3d"dijit.layout.ContentPane" region\x3d"center" style\x3d"width:100%; height:100%;"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit.layout.BorderContainer" data-dojo-props\x3d"design:\'headline\',gutters:false,preventcache:true,usecache:false,cachecontent:false,region:\'center\'" class\x3d"borderedContent pendingMembers" style\x3d"width:100%; height:410px; display:none;"\x3e\r\n        \x3cdiv id\x3d"pendingGridContentPane" data-dojo-attach-point\x3d"_pendingGridContentPane" data-dojo-type\x3d"dijit.layout.ContentPane" region\x3d"center" style\x3d"width:100%; height:100%;"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit.layout.ContentPane" data-dojo-props\x3d"region:\'top\'" class\x3d"userGridFooter"\x3e\r\n        \x3ctable style\x3d"width:100%; border:0;"\x3e\r\n          \x3ctbody\x3e\x3ctr\x3e\r\n          \x3ctd style\x3d"width:560px;" class\x3d"esriTdAlignLeading"\x3e\r\n            \x3cspan\x3e\r\n              \x3ca data-dojo-attach-event\x3d"onclick:firstPage"\x3e\x3cimg data-dojo-attach-point\x3d"_firstButton" style\x3d"vertical-align:middle;"\x3e\x3c/a\x3e\r\n              \x3ca data-dojo-attach-event\x3d"onclick:prevPage"\x3e\x3cimg data-dojo-attach-point\x3d"_prevButton"  style\x3d"vertical-align:middle;"\x3e\x3c/a\x3e\r\n              ${i18n.pageLabel}\r\n              \x3cinput data-dojo-type\x3d"dijit.form.NumberTextBox" data-dojo-attach-point\x3d"_currentUserPage" style\x3d"width:25px;" data-dojo-attach-event\x3d"onKeyPress:onChangeUserPage"/\x3e\r\n              ${i18n.ofLabel} \x3cspan data-dojo-attach-point\x3d"_userPages"\x3e1\x3c/span\x3e\r\n\r\n              \x3ca data-dojo-attach-event\x3d"onclick:nextPage"\x3e\x3cimg data-dojo-attach-point\x3d"_nextButton" style\x3d"vertical-align:middle;"\x3e\x3c/a\x3e\r\n              \x3ca data-dojo-attach-event\x3d"onclick:lastPage"\x3e\x3cimg data-dojo-attach-point\x3d"_lastButton" style\x3d"vertical-align:middle;"\x3e\x3c/a\x3e\r\n\r\n              \x3cinput data-dojo-type\x3d"arcgisonline.sharing.dijit.ComboBox" data-dojo-attach-point\x3d"_userPageComboBox" data-dojo-attach-event\x3d"onKeyPress:onChangeUserPageKeyPress,onChange:onChangeUserPageChange" data-dojo-props\x3d"searchAttr:\'page\'" value\x3d"1" style\x3d"width:45px;display:inline-block;zoom:1; margin-left:10px; margin-bottom:0;*display:inline;"/\x3e\r\n            \x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd style\x3d"width:200px" class\x3d"esriAlignTrailing"\x3e\r\n            \x3cspan data-dojo-attach-point\x3d"_viewingLabel"\x3e\x26nbsp;\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3c/tr\x3e\x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"esriFloatTrailing readOnly orgTableSml"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_subscriptionStatus" style\x3d"display:none;"\x3e\r\n          \x3cspan class\x3d"section"\x3e${i18n.subscriptionStatus.title}\x3c/span\x3e\x3cbr/\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_subscriptionStatusLinks" style\x3d"width:auto;" class\x3d"esriItemLinks orgPageSubStatus"\x3e\r\n              \x3cspan data-dojo-attach-point\x3d"_statusMessage"\x3e\x3c/span\x3e\x3cbr/\x3e\r\n              \x3cspan data-dojo-attach-point\x3d"_subscriptionExpires"\x3e\r\n                \x3cspan data-dojo-attach-point\x3d"_subscriptionExpiresDate"\x3e\x3c/span\x3e\r\n                \x3cdiv style\x3d"display:none;" data-dojo-attach-point\x3d"_upgradeSubscriptionButton" data-dojo-attach-event\x3d"onClick:onUpgradeSubscription" data-dojo-type\x3d"dijit.form.Button" class\x3d"calcite transparent"\x3e${i18n.upgradeSubscriptionLabel}\x3c/div\x3e\x3c!--data-dojo-props\x3d"iconClass:\'esriUpgradeSubscriptionIcon\'" --\x3e\r\n                \x3cdiv style\x3d"display:none;" data-dojo-attach-point\x3d"_manageSubscriptionButton" data-dojo-attach-event\x3d"onClick:onManageSubscription" data-dojo-type\x3d"dijit.form.Button" class\x3d"calcite transparent"\x3e${i18n.manageSubscriptionLabel}\x3c/div\x3e\x3c!--data-dojo-props\x3d"iconClass:\'esriManageSubscriptionIcon\'"--\x3e\r\n              \x3c/span\x3e\x3cbr/\x3e\r\n              \x3cspan data-dojo-attach-point\x3d"_subscriptionId"\x3e\x3c/span\x3e\r\n              \x3cspan style\x3d"color:red;display:none;" data-dojo-attach-point\x3d"_subscriptionState"\x3e\x3c/span\x3e\r\n              \x3c!--\x3ca  href\x3d"status.html"\x3e${i18n.subscriptionStatus.viewStatus}\x3c/a\x3e--\x3e\r\n          \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv data-dojo-attach-point\x3d"_memberStatus" style\x3d"display:none;"\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"_memberStatusTitle" class\x3d"section"\x3e\x3c/span\x3e\r\n        \x3cbr/\x3e\r\n        \x3cdiv style\x3d"width:auto;"\x3e\r\n          \x3ctable\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd data-dojo-attach-point\x3d"_memberStatusCurrTitle"\x3e\x3c/td\x3e\r\n                \x3ctd data-dojo-attach-point\x3d"_memberStatusCurrCount"\x3e\x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd data-dojo-attach-point\x3d"_memberStatusMaxTitle"\x3e\x3c/td\x3e\r\n                \x3ctd data-dojo-attach-point\x3d"_memberStatusMaxCount"\x3e\x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cspan class\x3d"section"\x3e${i18n.findLinks.title}\x3c/span\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_organizationContentLinks"\x3e\x3c/div\x3e\r\n\r\n      \x3cdiv id\x3d"organizationFeaturedGroups" style\x3d"display:none;"\x3e\r\n        \x3cbr/\x3e\r\n        \x3cspan class\x3d"section"\x3e${i18n.featuredGroupsLabel}\x3c/span\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_organizationFeaturedGroupsLinks"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cbr/\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv style\x3d"clear: both;"\x3e\x3c/div\x3e\r\n\r\n    \x3cdiv id\x3d"group-thumbnail-dialog" class\x3d"thumbnailDialog dijitDialog"\x3e\r\n      \x3cdiv id\x3d"group-thumbnail-header"\x3e\r\n        \x3cdiv style\x3d"background:none;padding-top:2px;" class\x3d"dijitDialogTitle dijitDialogTitleBar"\x3e${i18n.uploadThumbnail}\x3c/div\x3e\r\n        \x3cdiv id\x3d"group-thumbnail-close" title\x3d"${i18n.close}" class\x3d"dijitDialogCloseIcon"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"group-thumbnail-content"\x3e\r\n        \x3cp\x3e\x3cspan\x3e\x3clabel\x3e${i18n.specifyThumbnail}\x3c/label\x3e\x3c/span\x3e\x3c/p\x3e\r\n        \x3cdiv\x3e\r\n          \x3cspan style\x3d"margin-top:6px;"\x3e\x3clabel for\x3d"thumbnail"\x3e${i18n.thumbnailImage} \x3c/label\x3e\x3c/span\x3e\r\n          \x3cinput type\x3d"hidden" name\x3d"MAX_FILE_SIZE" value\x3d"1024000"\x3e\r\n          \x3cform id\x3d"thumbnail" data-dojo-attach-point\x3d"_thumbnailForm" method\x3d"post" enctype\x3d"multipart/form-data"\x3e\r\n            \x3cinput type\x3d"file" name\x3d"file" size\x3d"44" data-dojo-attach-point\x3d"_thumbnailPath"\x3e\r\n            \x3cinput type\x3d"hidden" id\x3d"key" name\x3d"key" value\x3d""\x3e\r\n            \x3cinput type\x3d"hidden" name\x3d"text" value\x3d""\x3e\r\n            \x3cinput type\x3d"hidden" name\x3d"f" value\x3d"json"\x3e\r\n          \x3c/form\x3e\r\n        \x3c/div\x3e\r\n        \x3cp style\x3d"margin-top: 1.5em;"\x3e\x3cspan\x3e${i18n.thumbnailReminder}\x3c/span\x3e\x3c/p\x3e\r\n        \x3cdiv style\x3d"margin-top: 1.5em;"\x3e\r\n          \x3cbutton id\x3d"group-thumbnail-cancel" class\x3d"esriFloatTrailing jevent calcite transparent" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n          \x3cbutton id\x3d"group-thumbnail-ok" class\x3d"esriFloatTrailing jevent calcite primary" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.ok}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv style\x3d"clear:both; width:100%;"\x3e\x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv id\x3d"banner-thumbnail-dialog" class\x3d"thumbnailDialog dijitDialog"\x3e\r\n        \x3cdiv id\x3d"banner-thumbnail-header"\x3e\r\n          \x3cdiv style\x3d"background:none;padding-top:2px;" class\x3d"dijitDialogTitle dijitDialogTitleBar"\x3e${i18n.uploadBanner}\x3c/div\x3e\r\n          \x3cdiv id\x3d"banner-thumbnail-close" title\x3d"${i18n.close}" class\x3d"dijitDialogCloseIcon"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"banner-thumbnail-content"\x3e\r\n          \x3cp\x3e\x3cspan\x3e\x3clabel\x3e${i18n.specifyBanner}\x3c/label\x3e\x3c/span\x3e\x3c/p\x3e\r\n          \x3cdiv\x3e\r\n            \x3cspan style\x3d"margin-top:6px;"\x3e\x3clabel for\x3d"bannerThumbnail"\x3e${i18n.thumbnailImage} \x3c/label\x3e\x3c/span\x3e\r\n            \x3cinput type\x3d"hidden" name\x3d"MAX_FILE_SIZE" value\x3d"1024000"\x3e\r\n            \x3cform id\x3d"bannerThumbnail" data-dojo-attach-point\x3d"_bannerThumbnailForm" method\x3d"post" enctype\x3d"multipart/form-data"\x3e\r\n              \x3cinput type\x3d"file" name\x3d"file" size\x3d"44" data-dojo-attach-point\x3d"_bannerThumbnailPath"\x3e\r\n              \x3cinput type\x3d"hidden" id\x3d"banner-key" name\x3d"key" value\x3d""\x3e\r\n              \x3cinput type\x3d"hidden" name\x3d"text" value\x3d""\x3e\r\n              \x3cinput type\x3d"hidden" name\x3d"f" value\x3d"json"\x3e\r\n            \x3c/form\x3e\r\n          \x3c/div\x3e\r\n          \x3cp style\x3d"margin-top: 1.5em;"\x3e\x3cspan\x3e${i18n.bannerReminder}\x3c/span\x3e\x3c/p\x3e\r\n          \x3cdiv style\x3d"margin-top: 1.5em;"\x3e\r\n            \x3cbutton id\x3d"banner-thumbnail-cancel" class\x3d"esriFloatTrailing jevent calcite transparent" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n            \x3cbutton id\x3d"banner-thumbnail-ok" class\x3d"esriFloatTrailing jevent calcite primary" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.ok}\x3c/button\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv style\x3d"clear:both; width:100%;"\x3e\x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv id\x3d"bg-thumbnail-dialog" class\x3d"thumbnailDialog dijitDialog"\x3e\r\n        \x3cdiv id\x3d"bg-thumbnail-header"\x3e\r\n          \x3cdiv style\x3d"background:none;padding-top:2px;" class\x3d"dijitDialogTitle dijitDialogTitleBar"\x3e${i18n.uploadBackground}\x3c/div\x3e\r\n          \x3cdiv id\x3d"bg-thumbnail-close" title\x3d"${i18n.close}" class\x3d"dijitDialogCloseIcon"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"bg-thumbnail-content"\x3e\r\n          \x3cp\x3e\x3cspan\x3e\x3clabel\x3e${i18n.specifyBackground}\x3c/label\x3e\x3c/span\x3e\x3c/p\x3e\r\n          \x3cdiv\x3e\r\n            \x3cspan style\x3d"margin-top:6px;"\x3e\x3clabel for\x3d"bgThumbnail"\x3e${i18n.thumbnailImage} \x3c/label\x3e\x3c/span\x3e\r\n            \x3cinput type\x3d"hidden" name\x3d"MAX_FILE_SIZE" value\x3d"1024000"\x3e\r\n            \x3cform id\x3d"bgThumbnail" data-dojo-attach-point\x3d"_bgThumbnailForm" method\x3d"post" enctype\x3d"multipart/form-data"\x3e\r\n              \x3cinput type\x3d"file" name\x3d"file" size\x3d"44" data-dojo-attach-point\x3d"_bgThumbnailPath"\x3e\r\n              \x3cinput type\x3d"hidden" id\x3d"bg-key" name\x3d"key" value\x3d""\x3e\r\n              \x3cinput type\x3d"hidden" name\x3d"text" value\x3d""\x3e\r\n              \x3cinput type\x3d"hidden" name\x3d"f" value\x3d"json"\x3e\r\n            \x3c/form\x3e\r\n          \x3c/div\x3e\r\n          \x3cp style\x3d"margin-top: 1.5em;"\x3e\x3cspan\x3e${i18n.backgroundReminder}\x3c/span\x3e\x3c/p\x3e\r\n          \x3cdiv style\x3d"margin-top: 1.5em;"\x3e\r\n            \x3cbutton id\x3d"bg-thumbnail-cancel" class\x3d"esriFloatTrailing jevent calcite transparent" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n            \x3cbutton id\x3d"bg-thumbnail-ok" class\x3d"esriFloatTrailing jevent calcite primary" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.ok}\x3c/button\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv style\x3d"clear:both; width:100%;"\x3e\x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv id\x3d"pendingActionMenu" class\x3d"actionMenu" data-dojo-type\x3d"dijit.Menu" data-dojo-attach-point\x3d"_pendingActionMenu" style\x3d"display:none;"\x3e\r\n      \x3cdiv id\x3d"pendingActionMenu-approve" class\x3d"actionMenuItem" data-dojo-type\x3d"dijit.MenuItem" data-dojo-attach-point\x3d"_pendingActionApprove" style\x3d"display:none;"\x3e${i18n.formatters.approveInvite}\x3c/div\x3e\r\n      \x3cdiv id\x3d"pendingActionMenu-resend" class\x3d"actionMenuItem" data-dojo-type\x3d"dijit.MenuItem" data-dojo-attach-point\x3d"_pendingActionResend" style\x3d"display:none;"\x3e${i18n.formatters.resendInvite}\x3c/div\x3e\r\n      \x3cdiv id\x3d"pendingActionMenu-remove" class\x3d"actionMenuItem" data-dojo-type\x3d"dijit.MenuItem" data-dojo-attach-point\x3d"_pendingActionRemove"\x3e${i18n.formatters.removeInvite}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv id\x3d"userActionMenu" class\x3d"actionMenu" data-dojo-type\x3d"dijit.Menu" data-dojo-attach-point\x3d"_userActionMenu" style\x3d"display:none;"\x3e\r\n      \x3cdiv id\x3d"userActionMenu-items" class\x3d"actionMenuItem" data-dojo-type\x3d"dijit.MenuItem" data-dojo-attach-point\x3d"_userActionItems"\x3e${i18n.formatters.manageItems}\x3c/div\x3e\r\n      \x3cdiv id\x3d"userActionMenu-budget" class\x3d"actionMenuItem" data-dojo-type\x3d"dijit.MenuItem" data-dojo-attach-point\x3d"_userActionBudget" style\x3d"display:none;"\x3e${i18n.formatters.manageCredits}\x3c/div\x3e\r\n      \x3cdiv id\x3d"userActionMenu-groups" class\x3d"actionMenuItem" data-dojo-type\x3d"dijit.MenuItem" data-dojo-attach-point\x3d"_userActionGroups"\x3e${i18n.formatters.viewGroups}\x3c/div\x3e\r\n      \x3cdiv id\x3d"userActionMenu-profile" class\x3d"actionMenuItem" data-dojo-type\x3d"dijit.MenuItem" data-dojo-attach-point\x3d"_userActionProfile"\x3e${i18n.formatters.viewProfile}\x3c/div\x3e\r\n      \x3cdiv id\x3d"userActionMenu-expire" class\x3d"actionMenuItem" data-dojo-type\x3d"dijit.MenuItem" data-dojo-attach-point\x3d"_userActionExpire" style\x3d"display:none;"\x3e${i18n.formatters.expirePassword}\x3c/div\x3e\r\n      \x3cdiv id\x3d"userActionMenu-reset" class\x3d"actionMenuItem" data-dojo-type\x3d"dijit.MenuItem" data-dojo-attach-point\x3d"_userActionReset" style\x3d"display:none;"\x3e${i18n.formatters.resetPassword}\x3c/div\x3e\r\n      \x3cdiv id\x3d"userActionMenu-disablemfa" class\x3d"actionMenuItem" data-dojo-type\x3d"dijit.MenuItem" data-dojo-attach-point\x3d"_userActionMFA" style\x3d"display:none;"\x3e${i18n.formatters.disableMultiFactor}\x3c/div\x3e\r\n      \x3cdiv id\x3d"userActionMenu-enableesri" class\x3d"actionMenuItem" data-dojo-type\x3d"dijit.MenuItem" data-dojo-attach-point\x3d"_userActionEnableEsri" style\x3d"display:none;"\x3e${i18n.formatters.enableEsri}\x3c/div\x3e\r\n      \x3cdiv id\x3d"userActionMenu-disableesri" class\x3d"actionMenuItem" data-dojo-type\x3d"dijit.MenuItem" data-dojo-attach-point\x3d"_userActionDisableEsri" style\x3d"display:none;"\x3e${i18n.formatters.disableEsri}\x3c/div\x3e\r\n      \x3cdiv id\x3d"userActionMenu-enable" class\x3d"actionMenuItem" data-dojo-type\x3d"dijit.MenuItem" data-dojo-attach-point\x3d"_userActionEnable" style\x3d"display:none;"\x3e${i18n.formatters.enableUser}\x3c/div\x3e\r\n      \x3cdiv id\x3d"userActionMenu-suspend" class\x3d"actionMenuItem" data-dojo-type\x3d"dijit.MenuItem" data-dojo-attach-point\x3d"_userActionSuspend" style\x3d"display:none;"\x3e${i18n.formatters.suspendUser}\x3c/div\x3e\r\n      \x3cdiv id\x3d"userActionMenu-delete" class\x3d"actionMenuItem" data-dojo-type\x3d"dijit.MenuItem" data-dojo-attach-point\x3d"_userActionDelete" style\x3d"display:none;"\x3e${i18n.formatters.deleteUser}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"manageLicensesView" data-dojo-attach-point\x3d"_manageLicensesView" style\x3d"clear:both;margin-top:2em;margin-bottom:1em;display:none;"\x3e\r\n    \x3c!-- manage licenses UI will get created here --\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cinput data-dojo-attach-point\x3d"_organizationIdTextBox" data-dojo-type\x3d"dijit.form.TextBox" type\x3d"hidden" value\x3d""/\x3e\r\n\x3c/div\x3e\r\n',
_community:arcgisonline.sharing.geow.Community,_content:arcgisonline.sharing.geow.Content,_util:arcgisonline.sharing.util,_account:arcgisonline.sharing.geow.Account,_user:null,_userRole:null,_isSingleTenant:!1,_isNewAccount:!1,_selfNoAuth:null,_organization:null,_organizationId:null,_organizationUsers:null,_organizationUsersStart:1,_organizationUsersNum:10,_organizationGroupsStart:1,_organizationGroupsMaxNum:100,_federatedServersRows:5,_organizationSummaryCount:310,_performingSearch:!1,_allSSLChanged:!1,
_editConnects:[],_bannerConnects:[],_bgConnects:[],_tooltips:[],_signInTooltip:null,_firstLoad:!0,_currentDefaultBasemapId:"0",_agoRouteServiceUrl:"arcgis.com/arcgis/rest/services/world/route/naserver",_federatedServers:{current:[],toAdd:[],toRemove:[]},_page:1,_totalPages:1,_totalSearchUsers:1,_geocodersPerPage:5,defaultImgThumbnail:null,mostViewedItemsValue:"most_viewed",groupReminderText:null,mostViewedReminderText:null,numberPattern:"#.#",unitsEnglish:"english",unitsMetric:"metric",predefinedBanner1Id:"banner-1",
predefinedBanner2Id:"banner-2",predefinedBanner3Id:"banner-3",predefinedBanner4Id:"banner-4",predefinedBanner5Id:"banner-5",customBannerId:"banner-custom",htmlBannerId:"banner-html",predefinedBackground1:"none",predefinedBackground2:"images/arcgis_background.jpg",statusURL:"http://status.arcgis.com",userTypeArcGIS:"arcgisonly",userTypeBoth:"both",homePageFeaturedCountDefault:12,browserDefault:"browser",localizedOrgPropsKey:"localizedOrgProperties",formatArcGIS:"arcgis",formatFGDC:"fgdc",formatINSPIRE:"inspire",
formatISO19139:"iso19139",formatISO1913932:"iso19139-3.2",formatISO19115:"iso19115",_token:null,_securityPolicy:null,i18n:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=c.i18n.getLocalization("arcgisonline","arcgisonline").common;c.mixin(this.i18n,c.i18n.getLocalization("arcgisonline","arcgisonline").myOrganization)},constructor:function(){this._token=""},postCreate:function(){this._isSingleTenant=esri.isDefined(esriGeowConfig.isMultiTenant)&&!1===esriGeowConfig.isMultiTenant;
this._extentDlg=arcgisonline.sharing.dijit.dialog.ExtentDlg.prototype.statics.getInstance();this._generalDlg=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();this._deleteWarnDlg=arcgisonline.sharing.dijit.dialog.DeleteWarningDlg.prototype.statics.getInstance();this._choiceDlg=arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance();this._pwdPolicyDlg=arcgisonline.sharing.dijit.dialog.PasswordPolicyDlg.prototype.statics.getInstance();this._addGeocoderDlg=
arcgisonline.sharing.dijit.dialog.AddGeocoderDlg.prototype.statics.getInstance();this._setIdentityProviderDlg=arcgisonline.sharing.dijit.dialog.SetIdentityProviderDlg.prototype.statics.getInstance();this._resendInviteDlg=arcgisonline.sharing.dijit.dialog.ResendInviteDlg.prototype.statics.getInstance();this._manageSubscriptionsDlg=arcgisonline.sharing.dijit.dialog.ManageSubscriptionDlg.prototype.statics.getInstance();this._subscriptionStatusDlg=arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg.prototype.statics.getInstance();
this._federateServerDlg=arcgisonline.sharing.dijit.dialog.FederateServerDlg.prototype.statics.getInstance();this._batchAssignToGroupsDlg=arcgisonline.sharing.dijit.dialog.BatchAssignToGroupsDlg.prototype.statics.getInstance();this._batchAssignCreditsDlg=arcgisonline.sharing.dijit.dialog.BatchAssignCreditsDlg.prototype.statics.getInstance();this._assignCreditsDlg=arcgisonline.sharing.dijit.dialog.AssignCreditsDlg.prototype.statics.getInstance();this._rolesAPI=new arcgisonline.sharing.geow.Roles;this.defaultImgThumbnail=
this._util.relativeToExplicitUrl("images/group-no-image.png");this._setupToggleSprites();this._checkUser();this._setupEditTabs();this._hideEditModeItems();c.addClass("organizationUsersToolbar","userSearch");this._setupNewAccountSplash();this._setupAccountSettings();this._setupUserSearchBox();this._setupTooltips()},startup:function(){esri.config.defaults.io.proxyUrl=esriGeowConfig.proxyServer;esriGeowConfig.proxyUrl&&(esri.config.defaults.io.proxyUrl=esriGeowConfig.proxyUrl);var a=this._util.getToken();
a&&(this._token="?token\x3d"+a);c.attr(this._thumbnail,"src",this.defaultImgThumbnail);esri.isDefined(this._user.accountId)?this.refreshOrganization():window.location="error.html?c\x3dInvalidOrganization";this._disableEditButton();c.style("organization-manage-licenses-span","display","none")},_enableEditButton:function(){g.byId("organization-edit-button").set("disabled",!1)},_disableEditButton:function(){g.byId("organization-edit-button").set("disabled",!0)},_retrieveSelfNoAuth:function(){esri.request({url:location.protocol+
"//"+this._organization.portalHostname+"/sharing/rest/portals/self",content:{f:"json",culture:this._organization.culture||"en"}}).then(c.hitch(this,function(a){this._selfNoAuth=a}))},_setupUserSearchBox:function(){this._userSearchButton.setAttribute("alt",this.i18n.userSearchLabel);this._userSearchButton.setAttribute("title",this.i18n.userSearchLabel);this._setGridNavigationButtons()},_setupInviteUsers:function(){!esriGeowConfig.showOrganizationInviteUsers||this._isSingleTenant&&!this._isAdmin?c.style("organization-adduser-span",
"display","none"):this._isSingleTenant&&g.byId("organization-adduser-btn").set("label",this.i18n.invitePortalUsersLabel)},_setupManageLicenses:function(){var a=this,b=!1;esriGeowConfig.manageLicensesEnabled&&esriGeowConfig.userRole&&(esriGeowConfig.userRole.isAdmin()||a._roleCanManageLicenses)?a._util.findLicenseByUserProducts().then(function(d){d&&d.pro&&(a._proListing=c.clone(d.pro),b=!0);d&&d.products&&(a._productListings=c.clone(d.products),b=!0);b?(c.style("organization-manage-licenses-span",
"display",""),a._startupManageLicenses()):c.style("organization-manage-licenses-span","display","none")},function(a){console.log("error retrieving purchases for organization",a);c.style("organization-manage-licenses-span","display","none")}):c.style("organization-manage-licenses-span","display","none")},_startupManageLicenses:function(){var a=this;a._manageLicenses||(a._manageLicenses=new arcgisonline.sharing.dijit.ManageLicenses({id:"manageLicensesUI"},c.create("div",null,a._manageLicensesView)),
a._manageLicenses.startup(),c.subscribe("manage-licenses/provisions-exceeded",function(){"none"===c.style(a._manageLicensesView,"display")&&"none"!==c.style(a._myOrgView,"display")&&a._generalDlg.show({title:a.i18n.notice,message:a.i18n.provisionsExceededWarning})}),c.subscribe("manage-licenses/close",function(){a._setOrganizationNameDesc();c.style(a._manageLicensesView,"display","none");c.style(a._myOrgView,"display","");a._refreshUserGrids()}))},_setupTooltips:function(){this._tooltips&&(0===this._tooltips.length&&
!esri.isTouchEnabled)&&(this._tooltips.push(this._createTooltip("thumbnailDelete",this.i18n.generalTab.deleteThumbTooltip)),this._tooltips.push(this._createTooltip("contactUsLinkTooltip",this.i18n.generalTab.footerLinks.contactUsTooltip)),this._tooltips.push(this._createTooltip("bingKeyTooltip",this.i18n.mapTab.bingKeyShareTooltip)),this._tooltips.push(this._createTooltip("travelModesHelp",this.i18n.utilityServicesTab.travelModesLearnMore)),this._tooltips.push(this._createTooltip("customRolesHelp",
this.i18n.rolesTab.learnMore)),this._tooltips.push(this._createTooltip("geocodingTooltip",this.i18n.utilityServicesTab.geocodingTooltip)),this._tooltips.push(this._createTooltip("sslTooltip",this.i18n.securityTab.sslTooltip)),this._tooltips.push(this._createTooltip("anonymousTooltip",this.i18n.securityTab.anonTooltip)),esriGeowConfig.multiFactorEnabled&&this._tooltips.push(this._createTooltip("mfaHelp",this.i18n.securityTab.multiFactorLearnMore)),esriGeowConfig.metadataEnabled&&(this._tooltips.push(this._createTooltip("metadataHelp",
this.i18n.itemDetailsTab.metadataSettingTooltip)),this._tooltips.push(this._createTooltip("metadataTooltip",esri.substitute({type:this._getTenantTypeString()},this.i18n.itemDetailsTab.byEnablingMetadata)))),this._isSingleTenant?this._tooltips.push(this._createTooltip("idpTooltip",this.i18n.securityTab.aboutIdentityFederationPortal+"\x3cbr\x3e\x3cbr\x3e"+this.i18n.securityTab.onceFederatedPortal+"\x3cbr\x3e\x3cbr\x3e"+this.i18n.securityTab.useSetIdentityProviderPortal+"\x3cbr\x3e\x3cbr\x3e"+this.i18n.securityTab.useGetServiceProviderPortal)):
this._tooltips.push(this._createTooltip("idpTooltip",this.i18n.securityTab.aboutIdentityFederation+"\x3cbr\x3e\x3cbr\x3e"+this.i18n.securityTab.onceFederated+"\x3cbr\x3e\x3cbr\x3e"+this.i18n.securityTab.useSetIdentityProvider+"\x3cbr\x3e\x3cbr\x3e"+this.i18n.securityTab.useGetServiceProvider)),!this._isSingleTenant&&esriGeowConfig.openDataConfigEnabled&&this._tooltips.push(this._createTooltip("openDataHelp",this.i18n.openDataTab.learnMore)),!this._isSingleTenant&&esriGeowConfig.creditBudgetingEnabled&&
this._tooltips.push(this._createTooltip("creditsHelp",this.i18n.creditsTab.learnMore)))},_setupPrecreatedUserTooltip:function(){this._tooltips.push(this._createSelectorTooltip("userGridNode","span.esriContentTypeName.orgSettingTooltip",this.i18n.notYetTooltip))},_createTooltip:function(a,b,c,e){c=esri.isDefined(c)?c:200;e=esri.isDefined(e)?e:300;return new g.Tooltip({label:'\x3cdiv style\x3d"max-width:'+e+'px;"\x3e'+b+"\x3c/div\x3e",connectId:[a],id:"tooltip_"+a,showDelay:c})},_createSelectorTooltip:function(a,
b,c,e,f){e=esri.isDefined(e)?e:200;f=esri.isDefined(f)?f:300;return new g.Tooltip({label:'\x3cdiv style\x3d"max-width:'+f+'px;"\x3e'+c+"\x3c/div\x3e",connectId:[a],selector:b,id:"tooltip_"+a,showDelay:e})},_showEditModeItems:function(){this._hideMenuButtons();c.query(".readOnly",this.domNode).style("display","none");c.query(".editOnly",this.domNode).style("display","")},_hideEditModeItems:function(){this._showMenuButtons();c.query(".editOnly",this.domNode).style("display","none");c.query(".readOnly",
this.domNode).style("display","")},_setupToggleSprites:function(){this._toggleDown&&c.attr(this._toggleDown,"src",this._util.relativeToExplicitUrl("js/jsapi/dojo/dijit/themes/tundra/images/doubleArrowDown.png"));this._toggleUp&&c.attr(this._toggleUp,"src",this._util.relativeToExplicitUrl("js/jsapi/dojo/dijit/themes/tundra/images/doubleArrowUp.png"))},_checkUser:function(){this._user=this._util.getUser();this._util.isLoggedIn()||this._util.requireAuthentication()},_setupForSingleTenant:function(){this._isSingleTenant&&
((!esriGeowConfig.userRole||!esriGeowConfig.userRole.isAdmin())&&c.byId("storageSection")&&c.style("storageSection","display","none"),this.i18n.defaultEsriSelection=this.i18n.defaultPortalSelection)},_setGridNavigationButtons:function(){esriGeowConfig.isRightToLeft?this._firstButton&&(c.attr(this._firstButton,"src",this._util.relativeToExplicitUrl("js/arcgisonline/css/images/last.png")),c.attr(this._prevButton,"src",this._util.relativeToExplicitUrl("js/arcgisonline/css/images/next.png")),c.attr(this._lastButton,
"src",this._util.relativeToExplicitUrl("js/arcgisonline/css/images/first.png")),c.attr(this._nextButton,"src",this._util.relativeToExplicitUrl("js/arcgisonline/css/images/prev.png"))):(c.attr(this._firstButton,"src",this._util.relativeToExplicitUrl("js/arcgisonline/css/images/first.png")),c.attr(this._prevButton,"src",this._util.relativeToExplicitUrl("js/arcgisonline/css/images/prev.png")),c.attr(this._lastButton,"src",this._util.relativeToExplicitUrl("js/arcgisonline/css/images/last.png")),c.attr(this._nextButton,
"src",this._util.relativeToExplicitUrl("js/arcgisonline/css/images/next.png")))},_setRoleFlags:function(){this._isAdmin=esriGeowConfig.userRole&&esriGeowConfig.userRole.isAdmin();this._isCustomRole=esriGeowConfig.userRole&&esriGeowConfig.userRole.isCustom();this._canListMarketplace=this._organization.canListApps||this._organization.canListData;this._roleCanViewUsers=this._isCustomRole&&esriGeowConfig.userRole.canViewUsers();this._roleCanInviteUsers=this._isCustomRole&&this._roleCanViewUsers&&esriGeowConfig.userRole.canInviteUsers();
this._roleCanUpdateUsers=this._isCustomRole&&esriGeowConfig.userRole.canUpdateUsers();this._roleCanDeleteUsers=this._isCustomRole&&esriGeowConfig.userRole.canDeleteUsers();this._roleCanDisableUsers=this._isCustomRole&&esriGeowConfig.userRole.canDisableUsers();this._roleCanChangeUserRoles=this._isCustomRole&&esriGeowConfig.userRole.canChangeUserRoles();this._roleCanViewItems=this._isCustomRole&&esriGeowConfig.userRole.canViewOrgItems();this._roleCanViewGroups=this._isCustomRole&&esriGeowConfig.userRole.canViewOrgGroups();
this._roleCanManageLicenses=this._isCustomRole&&esriGeowConfig.userRole.canManageLicenses()},_handleGetOrganization:function(a){a&&a.id&&0<a.id.length?(this._organization=c.clone(a),this._setRoleFlags(),esriGeowConfig.restrictOrganizationPageToAdmin&&(!esriGeowConfig.userRole||!esriGeowConfig.userRole.isAdmin())?window.location="error.html?c\x3dAccessDeniedResource":(this._createUserGrid(),this._setupInviteUsers(),this._setupManageLicenses(),this._setupMemberView(),this._setupForSingleTenant(),this._isSingleTenant||
(this._retrieveSelfNoAuth(),this._configureContactInfoVisibility()),this._setupAnonDesc(),this._setupNoDataMessages(),this._checkSubscription(),this._loadOrganization(),this._loadQuotaUsage(this._organization),this._retrieveLocalizedOrgProperties())):window.location="error.html?c\x3dInvalidOrganization"},_configureContactInfoVisibility:function(){c.query("tr.orgContact").forEach(c.hitch(this,function(a){c.style(a,"display",this._canListMarketplace?"":"none")}))},_setupAnonDesc:function(){if(!this._util.isPortal()){var a=
this._organization.helpBase;this._organization.helpMap.m["120000455"]&&(a+=this._organization.helpMap.m["120000455"]);c.byId("anonDescUrl")&&c.attr(c.byId("anonDescUrl"),"innerHTML",this._organization.urlKey+"."+this._organization.customBaseUrl);c.byId("anonDescDocUrl")&&c.attr(c.byId("anonDescDocUrl"),"href",a)}},_handleGetPendingOrganizationUsers:function(a){var b=arcgisonline.sharing.util.getUser(),d=null,e=null;if(a.invitations){d=[];for(e=0;e<a.invitations.length;e++)d.push(a.invitations[e]);
e=this._account.pendingUsersToStore(d,b.culture)}if(null!==e&&(this._pendingGrid.set("store",e),this._pendingGrid.sort(),this._page=1,d)){var b=a.start,e=a.start+d.length-1,f=a.total;a.start>this._organizationUsersNum&&(this._page=Math.floor(a.start/this._organizationUsersNum)+(0<a.start%this._organizationUsersNum?1:0));0===f&&(this._page=1);a=Math.ceil(f/this._organizationUsersNum);0===a&&(a=1);this._totalPages=Math.ceil(f/this._organizationUsersNum);d=this.i18n.viewingPage+" ";d=0<f?b===e?d+(b+
" "+this.i18n.ofLabel+" "+f):d+(b+" - "+e+" "+this.i18n.ofLabel+" "+f):d+("0 "+this.i18n.ofLabel+" 0");b=[];for(e=0;e<this._totalPages;e++)b.push({page:""+(e+1)});this._currentUserPage.set("value",this._page);this._userPages.innerHTML=a;this._viewingLabel.innerHTML=d;this._userPageComboBox.set("store",new c.data.ItemFileReadStore({data:{identifier:"page",label:"page",items:b}}));this._userPageComboBox.set("value",this._page)}},_handleGetOrganizationUsers:function(a){var b=this._util.getUser(),d=null,
e=null;if(a.users)if(this._wasSearch)this._userGrid.noDataMessage=this._noSearchResultsMessage,e=this._account.usersToStore(a.users,b.culture),d=a.users,this._totalSearchUsers=a.total,this._isNewAccount=!1;else{if(1<a.total)this._userGrid.noDataMessage=null,e=this._account.usersToStore(a.users,b.culture),this._isNewAccount=!1;else if(this._userGrid.noDataMessage=this._noSearchResultsMessage,e=this._account.usersToStore(a.users,b.culture),this._organization.name===this.i18n.defaultTitleText&&(null===
this._organization.description||""===this._organization.description))this._isNewAccount=!0;d=a.users;this._totalSearchUsers=a.total}if(null!==e){this._userGrid.set("store",e);this._userGrid.sort();this._updateToolbar();this._page=1;if(d){var b=a.start,e=a.start+d.length-1,f=a.total;a.start>this._organizationUsersNum&&(this._page=Math.floor(a.start/this._organizationUsersNum)+(0<a.start%this._organizationUsersNum?1:0));0===f&&(this._page=1);a=Math.ceil(f/this._organizationUsersNum);0===a&&(a=1);this._totalPages=
Math.ceil(f/this._organizationUsersNum);d=this.i18n.viewingPage+" ";d=0<f?b===e?d+(b+" "+this.i18n.ofLabel+" "+f):d+(b+" - "+e+" "+this.i18n.ofLabel+" "+f):d+("0 "+this.i18n.ofLabel+" 0");b=[];for(e=0;e<this._totalPages;e++)b.push({page:""+(e+1)});this._currentUserPage.set("value",this._page);this._userPages.innerHTML=a;this._viewingLabel.innerHTML=d;this._userPageComboBox.set("store",new c.data.ItemFileReadStore({data:{identifier:"page",label:"page",items:b}}));this._userPageComboBox.set("value",
this._page)}this._performingSearch=!1;this._isNewAccount&&(c.query(".newAccount",this.domNode).style("display",""),this.startEdit())}},checkMaxUsers:function(a,b,d){this._user&&(this._user.role&&(this._isAdmin||this._roleCanInviteUsers))&&this._account.getPendingAccountUsers(this._organization.id,{start:1,num:1,type:"email"},c.hitch(this,function(c){a+=c.total;this.handleMaxUsersCheck(a,d,b)}),c.hitch(this,function(c){this.handleMaxUsersCheck(a,d,b)}))},handleMaxUsersCheck:function(a,b,c){this._organization.subscriptionInfo&&
-1<this._organization.subscriptionInfo.maxUsers&&a>=this._organization.subscriptionInfo.maxUsers?b():c()},onSelfDelete:function(){this._generalDlg.show({title:this.i18n.deleteUserLabel,message:this.i18n.deleteSelfMsg})},onSelfSelect:function(){this._generalDlg.show({title:this.i18n.roleChangeLabel,message:this.i18n.manageOwnRoleMsg})},_updateToolbar:function(){},_replayLastSearch:function(){var a=this._findStart(this._page),a=this._addSortParams({start:a});this._replaySearch(a)},_replaySearch:function(a){this._performingSearch=
!0;var b=this._memberView.value;if(this.i18n.memberViewCurrent===b)b=this._userSearchText.get("value"),0<c.trim(b).length&&b!==this.i18n.defaultUserSearchBoxText?this._account.searchAccountUsers(this._organization.id,this.setupSearchParams(b,a.start,a.num),c.hitch(this,this._handleGetOrganizationUsers)):this._account.getAccountUsers(this._organization.id,a,c.hitch(this,this._handleGetOrganizationUsers));else if(this.i18n.memberViewPending===b||this.i18n.invitationsPending===b)a.type="email",this._account.getPendingAccountUsers(this._organization.id,
a,c.hitch(this,this._handleGetPendingOrganizationUsers))},_handleAccountUpdate:function(){g.focus(this.domNode)},_findStart:function(a){return this._organizationUsersNum*(a-1)+1},_validServerVersionMatch:function(a,b,d){return-1<c.indexOf(a[b],d)},onValidateServers:function(){var a=this._federatedServersGrid.get("store"),b=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))+"/portaladmin/federation/servers/validate",d,e,f,k;this._util.request({url:b}).then(c.hitch(this,function(b){a.fetch({onComplete:c.hitch(this,
function(c){if(b&&b.serversStatus&&0<b.serversStatus.length){for(f=0;f<b.serversStatus.length;f++){d=b.serversStatus[f];for(k=0;k<c.length;k++)e=c[k],d.serverId===a.getValue(e,"id")&&(a.setValue(e,"status","success"===d.status?"valid":"invalid"),a.setValue(e,"msg",d.messages.join(" ")))}a.save()}})})}),c.hitch(this,function(b){console.log("Error when attempting to validate federated servers.",b);a.fetch({onComplete:c.hitch(this,function(b){for(f=0;f<b.length;f++)a.setValue(b[f],"status","invalid"),
a.setValue(e[f],"msg",this.i18n.serversTab.validation.serverError);a.save()})})}))},onFederateServerClick:function(){"7443"===location.port?this._generalDlg.show({title:this.i18n.noticeLabel,message:this.i18n.serversTab.noFederationOn7443}):this._federateServerDlg.show()},_updateHostedServerList:function(){if(esriGeowConfig.hostedServerConfigEnabled&&(this._hostedServerSelectStore=new c.data.ItemFileWriteStore({data:{identifier:"id",label:"name",items:[{id:0,name:this.i18n.serversTab.noHostedServer,
url:null,adminUrl:null}]}}),this._hostedServerSelect.set("store",this._hostedServerSelectStore),this._federatedServers.current&&0<this._federatedServers.current.length)){for(var a=0;a<this._federatedServers.current.length;a++)this._federatedServers.current[a].isHosted&&!0===this._federatedServers.current[a].isHosted&&(this._currentHostedServer=this._federatedServers.current[a]),this._hostedServerSelectStore.newItem(this._federatedServers.current[a]);this._hostedServerSelectStore.save();this._setHostedServerValue()}},
onEnableCreditBudget:function(){var a;this._enableCreditBudget.get("checked")?(a=this.i18n.creditsTab.enableBudgetDesc+"\x3cul\x3e\x3cli\x3e"+this.i18n.creditsTab.enableBudgetPoint1+"\x3c/li\x3e\x3cli\x3e"+this.i18n.creditsTab.enableBudgetPoint2+"\x3c/li\x3e\x3c/ul\x3e"+this.i18n.creditsTab.enableBudgetExceedsBudget+"\x3cbr\x3e\x3cbr\x3e"+this.i18n.creditsTab.enableBudgetContinue,this._choiceDlg.show({title:this.i18n.creditsTab.enableBudget,message:a,choiceOneTitle:this.i18n.yesLabel,choiceTwoTitle:this.i18n.noLabel,
choiceOneHandler:c.hitch(this,function(){this.reallyEnableCreditBudget()}),choiceTwoHandler:c.hitch(this,function(){this._enableCreditBudget.set("checked",!1)})})):(this._enableCreditBudget.set("checked",!0),this._deleteWarnDlg.showMsgTitleButton(this.i18n.creditsTab.disableBudgetQuestion+"\x3cbr\x3e\x3cbr\x3e"+this.i18n.creditsTab.disableBudgetDesc,this.i18n.creditsTab.disableBudget,this.i18n.disable,c.hitch(this,this.reallyDisableCreditBudget)),c.removeClass(g.byId("button_delete-warning-submit").domNode,
"orange"),c.addClass(g.byId("button_delete-warning-submit").domNode,"caution"))},reallyEnableCreditBudget:function(){c.style(c.byId("creditSpinner"),"display","");this._util.request({url:esriGeowConfig.restBaseUrl+"portals/self/update",content:{creditAssignments:"enabled"}},{usePost:!0}).then(c.hitch(this,function(a){a&&!0===a.success?(this._organization.creditAssignments="enabled",esriGeowConfig.self.creditAssignments="enabled",this._enableCreditBudget.set("checked",!0)):(console.log("Unable to enable the credit budgeting tools",
a),this._enableCreditBudget.set("checked",!1),this._generalDlg.show({title:this.i18n.errorTitle,message:this.i18n.creditsTab.cantEnableBudget}));this._toggleCreditBudgetContainer()}),c.hitch(this,function(a){console.log("Unable to enable the credit budgeting tools",a);this._enableCreditBudget.set("checked",!1);this._generalDlg.show({title:this.i18n.errorTitle,message:this.i18n.creditsTab.cantEnableBudget});this._toggleCreditBudgetContainer()}))},reallyDisableCreditBudget:function(){c.style(c.byId("creditSpinner"),
"display","");this._util.request({url:esriGeowConfig.restBaseUrl+"portals/self/update",content:{creditAssignments:"disabled"}},{usePost:!0}).then(c.hitch(this,function(a){a&&!0===a.success?(this._organization.creditAssignments="disabled",esriGeowConfig.self.creditAssignments="disabled",this._enableCreditBudget.set("checked",!1)):(this._enableCreditBudget.set("checked",!0),this._generalDlg.show({title:this.i18n.errorTitle,message:this.i18n.creditsTab.cantDisableBudget}));this._toggleCreditBudgetContainer()}),
c.hitch(this,function(a){this._enableCreditBudget.set("checked",!0);this._generalDlg.show({title:this.i18n.errorTitle,message:this.i18n.creditsTab.cantDisableBudget})}))},_toggleCreditBudgetContainer:function(){var a=this._enableCreditBudget.get("checked");c.style(this._creditBudgetToolContainer,"display",a?"":"none");c.style(c.byId("creditSpinner"),"display","none")},onCreditChange:function(){this._replayLastSearch()},onAssignCredits:function(){this._batchAssignCreditsDlg.show()},onSetIdentityProvider:function(){this._util.request({url:esriGeowConfig.restBaseUrl+
"portals/self/idp"}).then(c.hitch(this,function(a){esri.isDefined(a)?(this._currentIdentityProvider=a,this._setSignInOptionsLabels()):this._currentIdentityProvider=null;this._setEnterpriseIdentityProvider();this._setSignInOptions()}),c.hitch(this,function(a){this._currentIdentityProvider=null;this._setEnterpriseIdentityProvider();this._setSignInOptions()}))},onAddFederatedServer:function(a){a.status="valid";a.msg="";this._federatedServers.current.push(a);try{var b=this._federatedServersGrid.get("store");
b.newItem(a);b.save();this._updateHostedServerList()}catch(c){console.log(c),this._generalDlg.show({title:this.i18n.noticeLabel,message:this.i18n.serversTab.federatedServerExists})}},removeFederatedServer:function(a){var b=g.byId("organizationWidget"),d,e=!1;for(d=0;d<b._federatedServers.current.length;d++)if(b._federatedServers.current[d].id===a){e=!0;break}if(e)b=c.hitch(this,function(b){c.style(c.byId("removeServer-"+a),"display","none");this._removeFederatedServer(b).then(c.hitch(this,function(){var a=
this._federatedServers.current[b],d=this._federatedServersGrid.get("store");d.fetch({onComplete:c.hitch(this,function(e){var f=!1;c.forEach(e,c.hitch(this,function(c){d.getValue(c,"id")==a.id&&(f=d.getValue(c,"isHosted"),this._federatedServers.current.splice(b,1),d.deleteItem(c))}));d.save();f&&(this._currentHostedServer=null,this._revertToCurrentHostedServer(),this._updateHostedServerList())})})}),c.hitch(this,function(b){c.style(c.byId("removeServer-"+a),"display","");var d=this.i18n.serversTab.unableToRemoveServer;
esri.isDefined(b.failure)&&"unfederateServer"===b.failure&&(d=b.message);this._generalDlg.show({title:this.i18n.errorTitle,message:d})}))},d),this._choiceDlg.show({title:this.i18n.noticeLabel,message:this.i18n.serversTab.removeFederatedServerMsg+"\x3cbr\x3e\x3cbr\x3e"+this.i18n.serversTab.wishToUnregisterMsg,choiceOneTitle:this.i18n.yesLabel,choiceTwoTitle:this.i18n.noLabel,choiceOneHandler:b});else{for(d=0;d<b._federatedServers.toAdd.length;d++)if(b._federatedServers.toAdd[d].id===a){e=!0;break}if(e){b._federatedServers.toAdd.splice(d,
1);var f=b._federatedServersGrid.get("store");f.fetch({onComplete:c.hitch(this,function(b){c.forEach(b,c.hitch(this,function(b){b.id==a&&f.deleteItem(b)}));f.save()})})}}},onAllSSLChange:function(a){var b=this._organization.allSSL,c=this._getTenantTypeString();a&&!b?(a=esri.substitute({type:c},this.i18n.securityTab.turnAllSSLOn),this._generalDlg.show({title:this.i18n.noticeLabel,message:a})):!a&&b&&(a=esri.substitute({type:c},this.i18n.securityTab.turnAllSSLOff),this._generalDlg.show({title:this.i18n.noticeLabel,
message:a}))},onChangeUserPage:function(a){a.keyCode==c.keys.ENTER&&(c.stopEvent(a),a=this._currentUserPage.get("value"),a!==this._page&&(a>this._totalPages&&(a=this._totalPages),this._page=a,this._replayLastSearch()))},onChangeUserPageKeyPress:function(a){a.keyCode==c.keys.ENTER&&(c.stopEvent(a),a=this._userPageComboBox.value,a!==this._page&&(a>this._totalPages&&(a=this._totalPages),this._page=a,this._replayLastSearch()))},onChangeUserPageChange:function(){if(!this._performingSearch){var a=this._userPageComboBox.value;
a!==this._page&&(a>this._totalPages&&(a=this._totalPages),this._page=a,this._replayLastSearch())}},onMemberViewChange:function(){var a=this._memberView.value;if(this._selectedMemberView!==a){if(this.i18n.memberViewCurrent===a)c.removeClass("organizationUsersToolbar","noUserSearch"),c.addClass("organizationUsersToolbar","userSearch"),c.query(".pendingMembers",this.domNode).style("display","none"),c.query(".currentMembers",this.domNode).style("display",""),this._loadOrganizationUsers();else if(this.i18n.memberViewPending===
a||this.i18n.invitationsPending===a)this._pendingGrid||this._createPendingGrid(),c.removeClass("organizationUsersToolbar","userSearch"),c.addClass("organizationUsersToolbar","noUserSearch"),c.query(".currentMembers",this.domNode).style("display","none"),c.query(".pendingMembers",this.domNode).style("display",""),this._loadPendingOrganizationUsers();this._selectedMemberView=a}},onGallerySelectChange:function(){var a=this._gallerySelect.get("store");if("  "===this._gallerySelect.get("displayedValue")){var b=
this._organization.featuredItemsGroupQuery;(esri.isDefined(b)||""!==b)&&a.fetch({onComplete:c.hitch(this,function(d,f){var k=null;c.forEach(d,c.hitch(this,function(c){var d=a.getValue(c,"group");b==="id:"+d&&(k=c)}));if(esri.isDefined(k)){var g=a.getValue(k,"name");this._gallerySelect.set("displayedValue",g);!g||g===this.i18n.mostViewedItems?(c.attr(this._groupSelectedReminder,"innerHTML",this.mostViewedReminderText),this._disableGallerySort()):(c.attr(this._groupSelectedReminder,"innerHTML",this.groupReminderText),
this._gallerySelect.set("item",k),this._enableGallerySort(a.getValue(k,"groupObj").group))}else this._gallerySelect.set("displayedValue",this.i18n.mostViewedItems),c.attr(this._groupSelectedReminder,"innerHTML",this.mostViewedReminderText),this._disableGallerySort()})})}else if(this._gallerySelect.item){var d=this._gallerySelect.item.name[0];this._newSelectedGallery={name:d,group:this._gallerySelect.item.group[0]};!d||d===this.i18n.mostViewedItems?(this._groupSelectedReminder.innerHTML=this.mostViewedReminderText,
this._disableGallerySort()):(this._groupSelectedReminder.innerHTML=this.groupReminderText,this._enableGallerySort(this._gallerySelect.item.groupObj[0].group))}else a.fetch({onComplete:c.hitch(this,function(b){for(var c=this._gallerySelect.get("displayedValue"),d=0;d<b.length;d++){var g=a.getValue(b[d],"name");if(c===g){this._newSelectedGallery={name:g,group:a.getValue(b[d],"group")};!c||c===this.i18n.mostViewedItems?(this._groupSelectedReminder.innerHTML=this.mostViewedReminderText,this._disableGallerySort()):
(this._groupSelectedReminder.innerHTML=this.groupReminderText,this._enableGallerySort(b[d].groupObj[0]));break}}})})},onDefaultBasemapSelectChange:function(){this._newSelectedBasemapName=this._defaultBasemapSelect.get("displayedValue");if(this._defaultBasemapSelect.item)this._newSelectedBasemapId=this._defaultBasemapSelect.item.id[0];else{var a=this._defaultBasemapSelect.get("store");a.fetch({onComplete:c.hitch(this,function(b){for(var c=0;c<b.length;c++)if(a.getValue(b[c],"title")==this._newSelectedBasemapName){this._newSelectedBasemapId=
a.getValue(b[c],"id");break}})})}},onBasemapGallerySelectChange:function(a){this._newSelectedBasemapGallery=this._basemapGallerySelect.get("displayedValue");this._loadAvailableBasemaps()},onGalleryAppsSelectChange:function(){this._newSelectedGalleryAppsGroup=this._galleryAppsSelect.get("displayedValue");if(this._galleryAppsSelect.item)this._galleryAppsSelect.item.group[0]?(this._newSelectedGalleryAppsGroupQuery="id:"+this._galleryAppsSelect.item.group[0].id,this._enableGalleryAppsSort(this._galleryAppsSelect.item.group[0].group),
this._enableAddEsriGalleryAppTemplates()):(this._newSelectedGalleryAppsGroupQuery="",this._disableGalleryAppSort(),this._disableAddEsriGalleryAppTemplates());else{var a=this._galleryAppsSelect.get("store");a.fetch({onComplete:c.hitch(this,function(b){for(var c=0;c<b.length;c++)if(a.getValue(b[c],"name")===this._newSelectedGalleryAppsGroup){var e=a.getValue(b[c],"group");e?(this._newSelectedGalleryAppsGroupQuery="id:"+e.id,this._galleryAppsSelect.set("item",b[c]),this._enableGalleryAppsSort(e.group),
this._enableAddEsriGalleryAppTemplates()):(this._newSelectedGalleryAppsGroupQuery="",this._disableGalleryAppSort(),this._disableAddEsriGalleryAppTemplates());break}})})}},onHomePageFeaturedChange:function(){this._newSelectedHomePageFeatured=this._homePageFeaturedSelect.get("displayedValue");if(this._homePageFeaturedSelect.item)this._homePageFeaturedSelect.item.group[0]?(this._newSelectedHomePageFeaturedQuery="id:"+this._homePageFeaturedSelect.item.group[0].id,this._enableHomePageFeaturedSort(this._homePageFeaturedSelect.item.group[0].group)):
(this._newSelectedHomePageFeaturedQuery="",this._disableHomePageFeaturedSort());else{var a=this._homePageFeaturedSelect.get("store");a.fetch({onComplete:c.hitch(this,function(b){for(var c=0;c<b.length;c++)if(a.getValue(b[c],"name")===this._newSelectedHomePageFeatured){var e=a.getValue(b[c],"group");e?(this._newSelectedHomePageFeaturedQuery="id:"+e.id,this._homePageFeaturedSelect.set("item",b[c]),this._enableHomePageFeaturedSort(e.group)):(this._newSelectedHomePageFeaturedQuery="",this._disableHomePageFeaturedSort());
break}})})}},onTemplatesSelectChange:function(){this._newSelectedTemplates=this._templatesSelect.get("displayedValue");if(this._templatesSelect.item)this._templatesSelect.item.group[0]?(this._newSelectedTemplatesQuery="id:"+this._templatesSelect.item.group[0].id,this._enableTemplatesGallerySort(this._templatesSelect.item.group[0].group),this._enableAddEsriWebAppTemplates()):(this._newSelectedTemplatesQuery="",this._disableTemplatesGallerySort(),this._disableAddEsriWebAppTemplates());else{var a=this._templatesSelect.get("store");
a.fetch({onComplete:c.hitch(this,function(b){for(var c=0;c<b.length;c++)if(a.getValue(b[c],"name")===this._newSelectedTemplates){var e=a.getValue(b[c],"group");e?(this._newSelectedTemplatesQuery="id:"+e.id,this._templatesSelect.set("item",b[c]),this._enableTemplatesGallerySort(e.group),this._enableAddEsriWebAppTemplates()):(this._newSelectedTemplatesQuery="",this._disableTemplatesGallerySort(),this._disableAddEsriWebAppTemplates());break}})})}},onUseMapExtent:function(){var a=this._defaultBasemapSelect.get("value"),
b=this._defaultBasemapSelect.get("store");b.fetch({onComplete:c.hitch(this,function(d){for(var e,f,g=!1,h=new esri.SpatialReference({wkid:4326}),l=0;l<d.length;l++)if(f=b.getValue(d[l],"title"),e=b.getValue(d[l],"id"),e==a){g=!0;break}g&&e&&"0"!==e&&f?(d=c.hitch(this,function(a){a&&(!a.code&&!a.message)&&(a=a.extent,this._newSelectedDefaultExtent=new esri.geometry.Extent(a[0][0],a[0][1],a[1][0],a[1][1],h),this._displayExtent(this._newSelectedDefaultExtent))}),this._content.getItem(e,d,d)):"0"==e&&
!this._util.isPortal()?(e=c.hitch(this,function(a){a&&(!a.code&&!a.message&&0<a.length&&a[0])&&(a=a[0],this._newSelectedDefaultExtent=new esri.geometry.Extent(a.xmin,a.ymin,a.xmax,a.ymax,h),this._displayExtent(this._newSelectedDefaultExtent))}),d=new esri.geometry.Extent(this._selfNoAuth.defaultExtent.xmin,this._selfNoAuth.defaultExtent.ymin,this._selfNoAuth.defaultExtent.xmax,this._selfNoAuth.defaultExtent.ymax,new esri.SpatialReference({wkid:this._selfNoAuth.defaultExtent.spatialReference.wkid})),
arcgisonline.map.main.doProject(d,h,e,e)):"0"===e&&this._util.isPortal()&&(this._newSelectedDefaultExtent=new esri.geometry.Extent(-180,-90,180,90,h),this._displayExtent(this._newSelectedDefaultExtent))})})},onChooseExtent:function(){var a=[],a=this._newSelectedDefaultExtent?[[Math.round(1E3*this._newSelectedDefaultExtent.xmin)/1E3,Math.round(1E3*this._newSelectedDefaultExtent.ymin)/1E3],[Math.round(1E3*this._newSelectedDefaultExtent.xmax)/1E3,Math.round(1E3*this._newSelectedDefaultExtent.ymax)/1E3]]:
[[Math.round(1E3*this._currentDefaultExtent.xmin)/1E3,Math.round(1E3*this._currentDefaultExtent.ymin)/1E3],[Math.round(1E3*this._currentDefaultExtent.xmax)/1E3,Math.round(1E3*this._currentDefaultExtent.ymax)/1E3]];this._extentDlg.show(a)},onExtentUpdate:function(a){a&&a[0]?(this._newSelectedDefaultExtent=new esri.geometry.Extent(a[0][0],a[0][1],a[1][0],a[1][1],new esri.SpatialReference({wkid:4326})),this._displayExtent(this._newSelectedDefaultExtent)):this._newSelectedDefaultExtent=null},onBingMapsKeyChange:function(){var a=
this._bingKey.get("value");esri.isDefined(a)&&(this._newBingKey=a)},onAnonymousAccessChanged:function(){this._anonAccess.get("checked")?(c.style(this._shareBingDiv,"display",""),this._shareBingKey.set("checked",esri.isDefined(this._organization.canShareBingPublic)?this._organization.canShareBingPublic:!1)):(c.style(this._shareBingDiv,"display","none"),this._shareBingKey.set("checked",!1))},_useProxyForServiceRequest:function(a){return!1},onConfigureAGOServicesPublish:function(a){var b=a.elevation,
d=a.elevationSync;if(b||d)b&&(this._organization.helperServices.elevation=a.elevation,this._currentElevationServices.elevation=c.clone(a.elevation)),d&&(this._organization.helperServices.elevationSync=a.elevationSync,this._currentElevationServices.elevationSync=c.clone(a.elevationSync)),this._setElevationServerValue();a.geocode&&(this._organization.helperServices.geocode=a.geocode,this._currentGeocodingServices=c.clone(a.geocode),this._setGeocodingServersValue());a.geoenrichment&&(this._organization.helperServices.geoenrichment=
a.geoenrichment,this._currentGeoEnrichService=c.clone(a.geoenrichment),this._newGeoEnrichService=c.clone(a.geoenrichment),this._setGeoEnrichServerValue());a.hydrology&&(this._organization.helperServices.hydrology=a.hydrology,this._currentHydrologyService=c.clone(a.hydrology),this._newHydrologyService=c.clone(a.hydrology),this._setHydrologyServerValue());var b=a.asyncClosestFacility,d=a.asyncLocationAllocation,e=a.asyncServiceArea,f=a.asyncVRP,g=a.closestFacility,h=a.serviceArea,l=a.syncVRP,m=a.traffic,
p=a.routingUtilities,n=a.asyncRoute;if(b||d||e||f||g||h||l||m||p||n)b&&(this._organization.helperServices.asyncClosestFacility=a.asyncClosestFacility,this._currentNetworkServices.asyncClosestFacility=c.clone(a.asyncClosestFacility)),d&&(this._organization.helperServices.asyncLocationAllocation=a.asyncLocationAllocation,this._currentNetworkServices.asyncLocationAllocation=c.clone(a.asyncLocationAllocation)),e&&(this._organization.helperServices.asyncServiceArea=a.asyncServiceArea,this._currentNetworkServices.asyncServiceArea=
c.clone(a.asyncServiceArea)),f&&(this._organization.helperServices.asyncVRP=a.asyncVRP,this._currentNetworkServices.asyncVRP=c.clone(a.asyncVRP)),g&&(this._organization.helperServices.closestFacility=a.closestFacility,this._currentNetworkServices.closestFacility=c.clone(a.closestFacility)),h&&(this._organization.helperServices.serviceArea=a.serviceArea,this._currentNetworkServices.serviceArea=c.clone(a.serviceArea)),l&&(this._organization.helperServices.syncVRP=a.syncVRP,this._currentNetworkServices.syncVRP=
c.clone(a.syncVRP)),m&&(this._organization.helperServices.traffic=a.traffic,this._currentNetworkServices.traffic=c.clone(a.traffic)),p&&(this._organization.helperServices.routingUtilities=a.routingUtilities,this._currentNetworkServices.routingUtilities=c.clone(a.routingUtilities)),n&&(this._organization.helperServices.asyncRoute=a.asyncRoute,this._currentNetworkServices.asyncRoute=c.clone(a.asyncRoute)),this._setNetworkServerValue();a.route&&(this._organization.helperServices.route=a.route,this._currentRoutingService=
c.clone(a.route),this._newRoutingService=c.clone(a.route),this._setRoutingServerValue());this._generalDlg.show({title:this.i18n.agolTab.configUtilSvcsSuccess,message:this.i18n.agolTab.configUtilSvcsMsg})},onPrintingServiceKeyPress:function(a){a.keyCode==c.keys.ENTER&&(c.stopEvent(a),document.activeElement.blur())},onPrintingServiceChange:function(){var a=this._printingService.get("value"),b={title:this.i18n.noticeLabel,message:this.i18n.utilityServicesTab.invalidPrintServerUrl};if(esri.isDefined(a)&&
!this._settingPrintingServiceValue)if(0<a.length)try{if(c.style(c.byId("printingSpinner"),"display",""),-1<a.indexOf("GPServer")){var d=this._isThroughServiceProxy(a),e=this._util.isPortal()&&this._util.onFederatedServer(a);esri.request({url:a,content:{f:"json"},timeout:5E3,callbackParamName:"callback"},{useProxy:this._useProxyForServiceRequest(a),disableIdentityLookup:!d&&!e}).then(c.hitch(this,function(d){c.style(c.byId("printingSpinner"),"display","none");d&&esri.isDefined(d.parameters)&&esri.isDefined(d.executionType)&&
"esriExecutionTypeSynchronous"===d.executionType?(this._newPrintingService={url:this._cleanUrl(a)},this._isEsriDefaultPrintService(this._newPrintingService.url)?c.style(this._printTemplates.domNode,"display","none"):(c.style(this._printTemplates.domNode,"display",""),this._printTemplates.set("printTask",this._newPrintingService),this._printTemplates.refresh())):(esri.isDefined(d.executionType)&&"esriExecutionTypeAsynchronous"===d.executionType&&(b.message=this.i18n.utilityServicesTab.asyncPrintServiceError),
this._generalDlg.show(b),this._newPrintingService=null)}),c.hitch(this,function(a){c.style(c.byId("printingSpinner"),"display","none");this._generalDlg.show(b);this._newPrintingService=null}))}else c.style(c.byId("printingSpinner"),"display","none"),this._generalDlg.show(b),this._newPrintingService=null}catch(f){c.style(c.byId("printingSpinner"),"display","none"),this._generalDlg.show(b),this._newPrintingService=null}else this._newPrintingService="",c.style(this._printTemplates.domNode,"display",
"none");this._settingPrintingServiceValue=!1},_isEsriDefaultPrintService:function(a){var b=!1;return b=this._isSingleTenant?-1!==a.indexOf("/newPrint")||-1!==a.indexOf(".arcgisonline.com"):this._selfNoAuth&&this._selfNoAuth.helperServices&&this._selfNoAuth.helperServices.printTask?this._protocolAgnosticUrlMatch(a,this._selfNoAuth.helperServices.printTask.url):-1<a.indexOf(".arcgisonline.com")},onAddGeocoder:function(){var a=this._geocodersGrid.store.query(function(a){return!!a.esri});if(!this._util.isPortal()&&
this._selfNoAuth&&this._selfNoAuth.helperServices&&this._selfNoAuth.helperServices.geocode&&this._selfNoAuth.helperServices.geocode[0]){var b=c.clone(this._selfNoAuth.helperServices.geocode[0]);b.name=this.i18n.esriWorldGeocoder;b.esri=!0;this._addGeocoderDlg.setWorldGeocodingService(b)}this._addGeocoderDlg.showAdd(this._util.isPortal()?!0:0<a.length)},onGeocoderAdded:function(a){var b,d,e=this._geocodersGrid._grid?this._geocodersGrid._grid._currentPage:1,f=this._geocodersGrid.store.query();a.id=
f.length;this._geocodersGrid.store.put(a);b=this._geocodersGrid._grid.on("dgrid-refresh-complete",c.hitch(this,function(a){d=Math.ceil(a.grid._total/a.grid.rowsPerPage);(e!==d||1!==e)&&a.grid.gotoPage(d);b.remove()}));this._geocodersGrid._grid.refresh()},onGeocoderAltered:function(a){var b,d=this._geocodersGrid._grid?this._geocodersGrid._grid._currentPage:1,e=this._geocodersGrid.store.get(a.id);e.url=a.url;e.name=a.name;a.placeholder?e.placeholder=a.placeholder:delete e.placeholder;esri.isDefined(a.placefinding)?
e.placefinding=a.placefinding:delete e.placefinding;esri.isDefined(a.batch)?e.batch=a.batch:delete e.batch;b=this._geocodersGrid._grid.on("dgrid-refresh-complete",c.hitch(this,function(a){a.grid._currentPage!==d&&a.grid.gotoPage(d);b.remove()}));this._geocodersGrid._grid.refresh()},onElevationSelectChange:function(){var a=this._elevationSelect.get("value"),b=this._elevationService.get("value");this._organization&&this._organization.helperServices&&this._organization.helperServices[a]?(a=(a=this._newElevationServices[a])&&
a.url?a.url:"",a!==b&&(this._settingElevationServiceValue=!0,this._elevationService.set("value",a))):""!==b&&(this._settingElevationServiceValue=!0,this._elevationService.set("value",""))},onElevationServiceChange:function(){var a=this._elevationService.get("value"),b=this._elevationSelect.get("value"),d={title:this.i18n.noticeLabel,message:this.i18n.utilityServicesTab.invalidElevationServerUrl};if(esri.isDefined(a)&&!this._settingElevationServiceValue)if(0<a.length)try{c.style(c.byId("elevationSpinner"),
"display",""),esri.request({url:a,content:{f:"json"},timeout:5E3,callbackParamName:"callback"},{useProxy:this._useProxyForServiceRequest(a)}).then(c.hitch(this,function(e){c.style(c.byId("elevationSpinner"),"display","none");this._isValidElevationService(b,e)?this._newElevationServices[b]={url:this._cleanUrl(a)}:(this._generalDlg.show(d),this._newElevationServices[b]=null)}),c.hitch(this,function(a){c.style(c.byId("elevationSpinner"),"display","none");this._generalDlg.show(d);this._newElevationServices[b]=
null}))}catch(e){c.style(c.byId("elevationSpinner"),"display","none"),this._generalDlg.show(d),this._newElevationServices[b]=null}else this._newElevationServices[b]="";this._settingElevationServiceValue=!1},onElevationServiceKeyPress:function(a){a.keyCode==c.keys.ENTER&&(c.stopEvent(a),document.activeElement.blur())},_isValidElevationService:function(a,b){var d=a&&b,e=function(a,b,d){return-1<c.indexOf(a,b)},f=function(a,b){return b.executionType===a.executionType&&b.maximumRecords>=a.maximumRecords&&
b.tasks&&0<b.tasks.length&&c.every(b.tasks,c.hitch(this,e,a.tasks))};if(d)switch(d=arcgisonline.sharing.dijit._NetworkServicesMixin.elevationServiceDefinitions[a],a){case "elevation":d=f(d,b);break;case "elevationSync":d=f(d,b);break;default:d=!1}return d},onNetworkSelectChange:function(){var a=this._networkSelect.get("value"),b=this._networkService.get("value"),d=this.i18n.utilityServicesTab.exampleNetworkServices[a];this._isSingleTenant&&(d=d.replace("http:","https:"));this._organization&&this._organization.helperServices&&
this._organization.helperServices[a]?(a=(a=this._newNetworkServices[a])&&a.url?a.url:"",a!==b&&(this._settingNetworkServiceValue=!0,this._networkService.set("value",a))):""!==b&&(this._settingNetworkServiceValue=!0,this._networkService.set("value",""));c.attr(this._networkServiceExample,"innerHTML","\x26nbsp;"+d)},onNetworkServiceKeyPress:function(a){a.keyCode==c.keys.ENTER&&(c.stopEvent(a),document.activeElement.blur())},_isValidNetworkService:function(a,b){var d=a&&b,e=function(a,b,c){return b.type&&
b.type===a.type&&b.timeInfo&&b.timeInfo.exportOptions&&b.timeInfo.hasLiveData===a.timeInfo.hasLiveData&&b.timeInfo.exportOptions.useTime===a.timeInfo.exportOptions.useTime},f=function(a,b,d){return-1<c.indexOf(a,b)},g=function(a,b){return b.name===a.name&&b.executionType===a.executionType&&b.parameters&&0<b.parameters.length},h=function(a,b){return b.executionType===a.executionType&&b.maximumRecords>=a.maximumRecords&&b.tasks&&0<b.tasks.length&&c.some(b.tasks,c.hitch(this,f,a.tasks))},l=function(a,
b){return b.layers&&0<b.layers.length&&c.some(b.layers,c.hitch(this,e,a))};if(d)switch(d=arcgisonline.sharing.dijit._NetworkServicesMixin.networkServiceDefinitions[a],a){case "closestFacility":d=b.layerType===d.layerType;break;case "asyncClosestFacility":d=g(d,b);break;case "serviceArea":d=b.layerType===d.layerType;break;case "asyncServiceArea":d=g(d,b);break;case "syncVRP":d=g(d,b);break;case "asyncVRP":d=g(d,b);break;case "asyncLocationAllocation":d=h(d,b);break;case "routingUtilities":d=h(d,b);
break;case "traffic":d=l(d,b);break;case "asyncRoute":d=h(d,b);break;default:d=!1}return d},onNetworkServiceChange:function(){var a=this._networkService.get("value"),b=this._networkSelect.get("value"),d={title:this.i18n.noticeLabel,message:esri.substitute({serviceType:b},this.i18n.utilityServicesTab.invalidNetworkServerUrl)},e;if(esri.isDefined(a)&&!this._settingNetworkServiceValue)if(0<a.length)try{c.style(c.byId("networkSpinner"),"display",""),e=a,"traffic"===b&&(e+="/layers"),esri.request({url:e,
content:{f:"json"},timeout:5E3,callbackParamName:"callback"},{useProxy:this._useProxyForServiceRequest(e)}).then(c.hitch(this,function(e){c.style(c.byId("networkSpinner"),"display","none");this._isValidNetworkService(b,e)?this._newNetworkServices[b]={url:this._cleanUrl(a)}:(this._generalDlg.show(d),this._newNetworkServices[b]=null)}),c.hitch(this,function(a){c.style(c.byId("networkSpinner"),"display","none");this._generalDlg.show(d);this._newNetworkServices[b]=null}))}catch(f){c.style(c.byId("networkSpinner"),
"display","none"),this._generalDlg.show(d),this._newNetworkServices[b]=null}else this._newNetworkServices[b]="";this._settingNetworkServiceValue=!1},onEnableAnalysisClick:function(a){a&&a.preventDefault();this._currentHostedServer&&0!==this._currentHostedServer.id&&(this._newAnalysisService={url:this._generateHostedServerAnalysisURL(this._currentHostedServer)},this._mustStartAnalysisService={startUrl:this._generateHostedServerAdminAnalysisStartURL(this._currentHostedServer,this._newAnalysisService.url)},
c.style(this._enableAnalysis.domNode,"display","none"),c.style(this._disableAnalysis.domNode,"display",""),this._updateAnalysisServerSetting(),this._generalDlg.show({title:this.i18n.utilityServicesTab.enableAnalysis,message:this.i18n.utilityServicesTab.enableAnalysisSave}))},onDisableAnalysisClick:function(a){a&&a.preventDefault();this._deleteWarnDlg.showMsgTitleButton(this.i18n.utilityServicesTab.disableAnalysisDesc,this.i18n.utilityServicesTab.disableAnalysis,this.i18n.utilityServicesTab.disableAnalysis,
c.hitch(this,this.reallyDisableAnalysis));c.removeClass(g.byId("button_delete-warning-submit").domNode,"orange");c.addClass(g.byId("button_delete-warning-submit").domNode,"caution")},reallyDisableAnalysis:function(){this._newAnalysisService={removeService:!0};this._mustStartAnalysisService=null;c.style(this._disableAnalysis.domNode,"display","none");c.style(this._enableAnalysis.domNode,"display","");this._updateAnalysisServerSetting()},onHydroServiceKeyPress:function(a){a.keyCode==c.keys.ENTER&&(c.stopEvent(a),
document.activeElement.blur())},onHydroServiceChange:function(){var a=this._hydrologyService.get("value"),b={title:this.i18n.noticeLabel,message:this.i18n.utilityServicesTab.invalidHydroServerUrl};if(esri.isDefined(a)&&!this._settingHydroServiceValue)if(0<a.length)try{c.style(c.byId("hydroSpinner"),"display",""),esri.request({url:a,content:{f:"json"},timeout:5E3,callbackParamName:"callback"},{useProxy:this._useProxyForServiceRequest(a)}).then(c.hitch(this,function(d){c.style(c.byId("hydroSpinner"),
"display","none");-1<a.indexOf("/GPServer")&&d&&"esriExecutionTypeAsynchronous"===d.executionType&&d.tasks&&2<=d.tasks.length&&-1<c.indexOf(d.tasks,"Watershed")&&-1<c.indexOf(d.tasks,"TraceDownstream")?this._newHydrologyService={url:this._cleanUrl(a)}:(this._generalDlg.show(b),this._newHydrologyService=null)}),c.hitch(this,function(a){c.style(c.byId("hydroSpinner"),"display","none");this._generalDlg.show(b);this._newHydrologyService=null}))}catch(d){c.style(c.byId("hydroSpinner"),"display","none"),
this._generalDlg.show(b),this._newHydrologyService=null}else this._newHydrologyService="";this._settingHydroServiceValue=!1},onGeoEnrichServiceKeyPress:function(a){a.keyCode==c.keys.ENTER&&(c.stopEvent(a),document.activeElement.blur())},onGeoEnrichServiceChange:function(){var a=this._geoEnrichService.get("value"),b={title:this.i18n.noticeLabel,message:this.i18n.utilityServicesTab.invalidGeoEnrichServerUrl};if(esri.isDefined(a)&&!this._settingGeoEnrichServiceValue)if(0<a.length)try{c.style(c.byId("geoEnrichSpinner"),
"display",""),esri.request({url:a,content:{f:"json"},timeout:5E3,callbackParamName:"callback"},{useProxy:this._useProxyForServiceRequest(a)}).then(c.hitch(this,function(d){c.style(c.byId("geoEnrichSpinner"),"display","none");-1<a.indexOf("/GeoenrichmentServer")&&d&&esri.isDefined(d.Description)?this._newGeoEnrichService={url:this._cleanUrl(a)}:(this._generalDlg.show(b),this._newGeoEnrichService=null)}),c.hitch(this,function(a){c.style(c.byId("geoEnrichSpinner"),"display","none");this._generalDlg.show(b);
this._newGeoEnrichService=null}))}catch(d){c.style(c.byId("geoEnrichSpinner"),"display","none"),this._generalDlg.show(b),this._newGeoEnrichService=null}else this._newGeoEnrichService="";this._settingGeoEnrichServiceValue=!1},onGeometryServiceKeyPress:function(a){a.keyCode==c.keys.ENTER&&(c.stopEvent(a),document.activeElement.blur())},onGeometryServiceChange:function(){var a=this._geometryService.get("value"),b={title:this.i18n.noticeLabel,message:this.i18n.utilityServicesTab.invalidGeometryServerUrl};
if(esri.isDefined(a)&&!this._settingGeometryServiceValue)if(0<a.length)try{c.style(c.byId("geometrySpinner"),"display",""),esri.request({url:a,content:{f:"json"},timeout:5E3,callbackParamName:"callback"},{useProxy:this._useProxyForServiceRequest(a)}).then(c.hitch(this,function(d){c.style(c.byId("geometrySpinner"),"display","none");-1<a.indexOf("/GeometryServer")&&d&&esri.isDefined(d.serviceDescription)?this._newGeometryService={url:this._cleanUrl(a)}:(this._generalDlg.show(b),this._newGeometryService=
null)}),c.hitch(this,function(a){c.style(c.byId("geometrySpinner"),"display","none");this._generalDlg.show(b);this._newGeometryService=null}))}catch(d){c.style(c.byId("geometrySpinner"),"display","none"),this._generalDlg.show(b),this._newGeometryService=null}else this._newGeometryService="";this._settingGeometryServiceValue=!1},onRoutingServiceKeyPress:function(a){a.keyCode==c.keys.ENTER&&(c.stopEvent(a),document.activeElement.blur())},onRoutingServiceChange:function(){var a=this._routingService.get("value"),
b={title:this.i18n.noticeLabel,message:this.i18n.utilityServicesTab.invalidRoutingServerUrl};if(esri.isDefined(a)&&!this._settingRoutingServiceValue)if(0<a.length)try{c.style(c.byId("routingSpinner"),"display","");var d=this._isRoutingServiceProxy(a),e=this._util.isPortal()&&this._util.onFederatedServer(a),f={f:"json"},g=this._util.getUser().token;d&&(f.token=g);esri.request({url:a,content:f,timeout:5E3,callbackParamName:"callback"},{useProxy:this._useProxyForServiceRequest(a),disableIdentityLookup:!d&&
!e}).then(c.hitch(this,function(e){c.style(c.byId("routingSpinner"),"display","none");e&&esri.isDefined(e.layerType)&&"esriNAServerRouteLayer"===e.layerType?(this._newRoutingService={url:this._cleanUrl(a)},this._util.isPortal()&&d?this._determineIfEsriRouteThroughProxy():!this._util.isPortal()&&(!d&&esri.isDefined(this._travelModes))&&-1!==this._newRoutingService.url.toLowerCase().indexOf(this._agoRouteServiceUrl)&&(this._newRoutingService.defaultTravelMode=this._travelModes.getDefaultTravelModeId())):
(this._generalDlg.show(b),this._newRoutingService=null)}),c.hitch(this,function(a){c.style(c.byId("routingSpinner"),"display","none");this._generalDlg.show(b);this._newRoutingService=null}))}catch(h){c.style(c.byId("routingSpinner"),"display","none"),this._generalDlg.show(b),this._newRoutingService=null}else this._newRoutingService="";this._settingRoutingServiceValue=!1},_isThroughServiceProxy:function(a){a=(a||"").toLowerCase();return 0<a.length&&-1<a.indexOf("/sharing/servers/")&&-1<a.indexOf("/rest/services/")},
_isRoutingServiceProxy:function(a){var b=(a||"").toLowerCase();a=-1<b.indexOf("/naserver")&&(-1<b.indexOf("/sharing/servers/")||b.indexOf("/sharing/rest/services/"))&&-1<b.indexOf("/rest/services/");var c=this._util.isPortal()&&-1<b.indexOf(esriGeowConfig.self.portalHostname),b=!this._util.isPortal()&&-1<b.indexOf("route")&&-1<b.indexOf(".arcgis.com");return a&&(c||b)},_determineIfEsriRouteThroughProxy:function(){this._util.request({url:esriGeowConfig.restBaseUrl+"/search",content:{q:"orgid:"+esriGeowConfig.self.id+
" type:'Network Analysis Service' typekeywords:'Network Analysis Service' typekeywords:'Service Proxy'",start:1,num:100}}).then(c.hitch(this,function(a){if(a&&a.results){var b,c;for(c=0;c<a.results.length;c++)if(b=a.results[c],b.url&&-1<this._newRoutingService.url.indexOf(this._cleanUrl(b.url))&&b.sourceUrl&&-1!==b.sourceUrl.toLowerCase().indexOf(this._agoRouteServiceUrl)){this._newRoutingService.platformService=!0;break}}}),c.hitch(this,function(){}))},_cleanUrl:function(a){return a?a.replace(/\s/g,
"%20"):""},onHostedServerSelectChange:function(){var a=this._hostedServerSelect.get("value"),b,d=this._hostedServerSelect.get("store");d.fetch({onComplete:c.hitch(this,function(c){for(var f=0;f<c.length;f++)if(d.getValue(c[f],"name")===a){b=c[f];break}esri.isDefined(b)&&d.getValue(b,"name")!==this.i18n.serversTab.noHostedServer?(c=!0,esri.isDefined(this._currentHostedServer)&&this._currentHostedServer.name===d.getValue(b,"name")&&(c=!1),c&&(this._newHostedServer={id:d.getValue(b,"id"),name:d.getValue(b,
"name"),url:d.getValue(b,"url"),adminUrl:d.getValue(b,"adminUrl"),isHosted:d.getValue(b,"isHosted")},!this._settingHostedServerValue&&(!esri.isDefined(this._organization.helperServices.geocode)||0===this._organization.helperServices.geocode.length||!esri.isDefined(this._organization.helperServices.geocode[0].url))&&this._generalDlg.show({title:this.i18n.noticeLabel,message:this.i18n.serversTab.noGeocodeServers}))):this._newHostedServer=null;this._settingHostedServerValue=!1})})},_revertToCurrentHostedServer:function(){this._currentHostedServer&&
this._currentHostedServer.name?this._hostedServerSelect.set("value",this._currentHostedServer.name):this._hostedServerSelect.set("value",this.i18n.serversTab.noHostedServer)},inviteUsers:function(a){this.checkMaxUsers(this._totalSearchUsers,c.hitch(this,function(){this._subscriptionAllowsInvite()||this._isCustomRole&&this._roleCanViewUsers&&this._roleCanInviteUsers?window.location=esriGeowConfig.baseUrl+"inviteusers.html":this._subscriptionStatusDlg.show(this._organization.subscriptionInfo)}),c.hitch(this,
function(){var a;a=this._organization.helpBase+this._organization.helpMap.m["120000503"];a=this._isSingleTenant?this.i18n.maxUsersPortalMsg:esri.substitute({linkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"'+a+'"\x3e',linkEnd:"\x3c/a\x3e\x3c/span\x3e"},this.i18n.maxUsersMsg);this._generalDlg.show({title:this.i18n.noticeLabel,message:a})}))},viewStatus:function(){if(esriGeowConfig.userRole&&(esriGeowConfig.userRole.isAdmin()||this._roleCanViewUsers&&this._roleCanViewGroups&&
this._roleCanViewItems))this._util.isPortal()?window.location=this._util.getSecureUrl(location.protocol+"//"+esriGeowConfig.self.portalHostname)+"/apps/activitydashboard/usage.html":window.location=esriGeowConfig.baseUrl+"status/usage.html"},viewHealth:function(){window.open(this.statusURL,"_blank")},manageLicenses:function(){this._manageLicenses&&this._manageLicenses.reload();c.style(this._myOrgView,"display","none");c.style(this._manageLicensesView,"display","")},onUsersInvited:function(a){if(a.success&&
!0===a.success)this.i18n.memberViewCurrent===this._memberView.value?this._replayLastSearch():(this.i18n.memberViewPending===this._memberView.value||this.i18n.invitationsPending===this._memberView.value)&&this._loadPendingOrganizationUsers();else{var b=this._generalDlg.onOkClick;this._generalDlg.onOkClick=c.hitch(this,function(){this.i18n.memberViewCurrent===this._memberView.value?this._replayLastSearch():(this.i18n.memberViewPending===this._memberView.value||this.i18n.invitationsPending===this._memberView.value)&&
this._loadPendingOrganizationUsers();this._generalDlg.onOkClick=b});this._generalDlg.show({title:this.i18n.unableToInviteLabel,message:this.i18n.problemInvitingMsg})}},deleteUser:function(a){if(this._user.email!==a)this._deleteWarnDlg.showMsgTitleButton(esri.substitute({user:a},this.i18n.reallyDeleteUserMsg),this.i18n.deleteUserLabel,this.i18n.deleteUserLabel,c.hitch(this,this.reallyDeleteUser,a)),c.removeClass(g.byId("button_delete-warning-submit").domNode,"orange"),c.addClass(g.byId("button_delete-warning-submit").domNode,
"caution");else this.onSelfDelete()},reallyDeleteUser:function(a){this._account.deleteUser(a,c.hitch(this,this._handleUserDelete,a),c.hitch(this,this._handleUserDelete,a))},_handleUserDelete:function(a,b){if(b)if(b.code&&b.messageCode){var d;d="COM_1029"===b.messageCode?esri.substitute({user:a},this.i18n.unableToDeleteUserMsg):"COM_1056"===b.messageCode?esri.substitute({user:a},this.i18n.noDeleteDisconnectedUserMsg):"COM_1057"===b.messageCode?esri.substitute({user:a},this.i18n.noDeleteProvisionedUserMsg):
"COM_1060"==b.messageCode?esri.substitute({user:a},this.i18n.securityTab.needTwoAdminDeleteMsg):"COM_1077"==b.messageCode?esri.substitute({user:a},this.i18n.unableToDeleteUserBaseMsg)+" "+this.i18n.couldNotRemoveContact:esri.substitute({user:a},this.i18n.unableToDeleteUserMsg);this._generalDlg.show({title:this.i18n.noticeLabel,message:d})}else this._replayLastSearch(),this._util.isPortal()&&(d=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))+"/portaladmin/system/licenses",
this._util.request({url:d,content:{ts:(new Date).getTime()}}).then(c.hitch(this,function(a){a&&(!a.code&&!a.message)&&(c.attr(this._memberStatusCurrCount,"innerHTML",a.currentRegisteredMembers),c.attr(this._memberStatusMaxCount,"innerHTML",a.maximumRegisteredMembers))})))},_initializeEditMode:function(){this._editDescription._started||this._editDescription.startup();this._editHTMLBanner._started||this._editHTMLBanner.startup();this._showEditModeItems();this._deletingThumbnail=!1;c.addClass(this._thumbnail,
"linkNoHref");c.addClass(this._viewThumbnail,"linkNoHref");g.byId("group-thumbnail-ok").set("disabled",!1);g.byId("group-thumbnail-cancel").set("disabled",!1);g.byId("banner-thumbnail-ok").set("label",this.i18n.ok);g.byId("banner-thumbnail-ok").set("disabled",!1);g.byId("banner-thumbnail-cancel").set("disabled",!1);c.style(c.byId("printingSpinner"),"display","none");this._isSingleTenant&&c.style(c.byId("geometrySpinner"),"display","none");if(!this._isSingleTenant)if(esri.isDefined(this._travelModes))try{this._travelModes.reset()}catch(a){console.log("Unable to reset the Travel Modes UI. Could be due to admin having insufficient privileges due to lack of credits.",
a)}else{this._travelModes=new arcgisonline.sharing.dijit.TravelModes({id:"travelModes"},c.create("div",{},this._utilityServicesTab.domNode));try{this._travelModes.startup().then(c.hitch(this,this._travelModesGridLoad)),this._travelModesGrid.enable(!0)}catch(b){console.log("Unable to startup the Travel Modes UI. Could be due to admin having insufficient privileges due to lack of credits.",b)}var d=esriGeowConfig.self.helpMap.m[this._travelModes._helpTopicId],d=esriGeowConfig.self.helpBase+(esri.isDefined(d)?
d:"");c.attr(c.byId("travelModesHelpLink"),"href",d)}!this._util.isPortal()&&(esriGeowConfig.creditBudgetingEnabled&&!this._creditsTabRemoved)&&(d=esriGeowConfig.self.helpMap.m["120001056"],c.attr(c.byId("creditsHelpLink"),"href",esriGeowConfig.self.helpBase+(esri.isDefined(d)?d:"")),esri.isDefined(this._organization.creditAssignments)?"enabled"===this._organization.creditAssignments||"validated"===this._organization.creditAssignments?this._enableCreditBudget.set("checked",!0):this._enableCreditBudget.set("checked",
!1):this._enableCreditBudget.set("checked",!1),this._toggleCreditBudgetContainer());if(esri.isDefined(this._roles))this._roles.reset();else{this._roles=new arcgisonline.sharing.dijit.CustomRoles({id:"customRoles"},c.create("div",null,this._rolesTabPanel));this._roles.startup();var d=c.locale&&-1<c.locale.indexOf("-")&&-1===c.indexOf(["pt-br","pt-pt","zh-cn","zh-hk","zh-tw"],c.locale.toLowerCase())?c.locale.split("-")[0].toLowerCase():c.locale.toLowerCase(),e,f;if(this._util.isPortal()){var d=this._user.culture||
this._organization.culture||d||"en",k=esriGeowConfig.baseUrl.replace("/home","/portalhelp")+d+"/admin/help/";esri.request({url:k+"cxhelp.js"}).then(c.hitch(this,function(a){e=a.m["120000897"];f=k+e;c.attr(c.byId("customRolesHelpLink"),"href",f)}))}else e=esriGeowConfig.self.helpMap.m["120000897"],f=esriGeowConfig.self.helpBase+(esri.isDefined(e)?e:""),c.attr(c.byId("customRolesHelpLink"),"href",f)}!this._isSingleTenant&&esriGeowConfig.openDataConfigEnabled&&(this._organization.subscriptionInfo&&this._organization.subscriptionInfo.type&&
"trial developer"!==this._organization.subscriptionInfo.type.toLowerCase()?esri.isDefined(this._openData)?this._openData.reset():(this._openData=new arcgisonline.sharing.dijit.OpenData({id:"openData"},c.create("div",null,this._openDataTabPanel)),this._openData.startup(),c.connect(this._openData,"onOpenDataEnabled",c.hitch(this,function(){this._organization.portalProperties||(this._organization.portalProperties={});this._organization.portalProperties.openData={enabled:!0};this._roles.reset()})),c.connect(this._openData,
"onOpenDataDisabled",c.hitch(this,function(){this._organization.portalProperties||(this._organization.portalProperties={});this._organization.portalProperties.openData={enabled:!1};this._roles.reset()})),d=esriGeowConfig.self.helpMap.m["120000905"],d=esriGeowConfig.self.helpBase+(esri.isDefined(d)?d:""),c.attr(c.byId("openDataHelpLink"),"href",d)):this._editTabs.removeChild(this._openDataTab));this._loadEditConnections();this._firstLoad=!0},_openEdit:function(){g.byId("upperSave").set("disabled",
!0);g.byId("lowerSave").set("disabled",!0);this._initializeEditMode();this._editTabs.resize();this._setBasemapGalleryValue();this._setHomePageFeaturedValue();this._setTemplatesValue();this._setDefaultBasemapValue();this._setDefaultExtentValue();this._setHomePageDescriptionValue();this._setLanguageValue();this._isSingleTenant||(this._setContactInfo(),this._setRegionValue());esriGeowConfig.passwordPolicyEnabled&&this._retrieveSecurityPolicy();this._setLinksValue();esriGeowConfig.metadataEnabled&&this._setMetadataValue();
this._setBackgroundValue();this._setBannerValue();this._setGalleryValue();this._setFeaturedGroupsValue();this._setGalleryAppsValue();this._setBingMapsKeyValue();this._setUnitsValue();this._setSecuredHostsValue();this._setPrintServerValue();this._setGeocodingServersValue();this._setRoutingServerValue();this._isSingleTenant&&(this._setGeometryServerValue(),this._setGeoEnrichServerValue(),this._setHydrologyServerValue(),this._setElevationServerValue(),this._setNetworkServerValue(),esriGeowConfig.federatedServerConfigEnabled&&
(this._setFederatedServers(),esriGeowConfig.hostedServerConfigEnabled&&(this._setHostedServerValue(),this._setAnalysisServerValue())),esriGeowConfig.portalAGOConfigEnabled&&this._cfgAGOUtilServices&&this._cfgAGOUtilServices.reset());esriGeowConfig.enterpriseLoginConfigEnabled&&(this._setEnterpriseIdentityProvider(),this._setSignInOptions());this._isSingleTenant?this.unsetSaving():this._isDeveloperSubscription?(this._hideMFA(),this.unsetSaving()):this._setAdminContactsValue().then(c.hitch(this,function(){esriGeowConfig.multiFactorEnabled?
this._setMFAValue().then(c.hitch(this,function(){this.unsetSaving()})):this.unsetSaving()}))},_loadEditConnections:function(){this._editConnects.push(c.connect(this._thumbnail,"onclick",this,"_showThumbnailDialog"));this._editConnects.push(c.connect(this._thumbnailDelete,"onclick",this,"_deleteThumbnail"));this._editConnects.push(c.connect(c.byId("group-thumbnail-close"),"onclick",this,"_thumbnailCancel"));this._editConnects.push(c.connect(c.byId("group-thumbnail-ok"),"onclick",this,"_thumbnailOk"));
this._editConnects.push(c.connect(c.byId("group-thumbnail-cancel"),"onclick",this,"_thumbnailCancel"));this._bannerConnects.push(c.connect(this._bannerRadio1,"onClick",this,"onPredefinedBannerSelect"));this._bannerConnects.push(c.connect(this._bannerRadio2,"onClick",this,"onPredefinedBannerSelect"));this._bannerConnects.push(c.connect(this._bannerRadio3,"onClick",this,"onPredefinedBannerSelect"));this._bannerConnects.push(c.connect(this._bannerRadio4,"onClick",this,"onPredefinedBannerSelect"));this._bannerConnects.push(c.connect(this._bannerRadio5,
"onClick",this,"onPredefinedBannerSelect"));this._bannerConnects.push(c.connect(c.byId("bannerCustomCol"),"onclick",this,"onBannerCustomSelect"));this._bannerConnects.push(c.connect(this._bannerRadioCustom,"onClick",this,"onBannerCustomSelect"));this._bannerConnects.push(c.connect(c.byId("banner-thumbnail-close"),"onclick",this,"_bannerThumbnailCancel"));this._bannerConnects.push(c.connect(c.byId("banner-thumbnail-ok"),"onclick",this,"_bannerThumbnailOk"));this._bannerConnects.push(c.connect(c.byId("banner-thumbnail-cancel"),
"onclick",this,"_bannerThumbnailCancel"));this._bgConnects.push(c.connect(this._bgRadio1,"onClick",this,"onPredefinedBackgroundSelect"));this._bgConnects.push(c.connect(this._bgRadio2,"onClick",this,"onPredefinedBackgroundSelect"));this._bgConnects.push(c.connect(c.byId("bgCustomCol"),"onclick",this,"onCustomBackgroundSelect"));this._bgConnects.push(c.connect(this._bgRadioCustom,"onClick",this,"onCustomBackgroundSelect"));this._bgConnects.push(c.connect(c.byId("bg-thumbnail-close"),"onclick",this,
"_backgroundThumbnailCancel"));this._bgConnects.push(c.connect(c.byId("bg-thumbnail-ok"),"onclick",this,"_backgroundThumbnailOk"));this._bgConnects.push(c.connect(c.byId("bg-thumbnail-cancel"),"onclick",this,"_backgroundThumbnailCancel"))},_retrieveSecurityPolicy:function(){this._loadSecurityPolicy().then(c.hitch(this,function(a){a&&!a.code&&!a.messageCode?(this._securityPolicy=a,esri.isDefined(this._securityPolicy)&&("default"===this._securityPolicy.passwordPolicy.type?c.style(this._removePwdPolicy.domNode,
"display","none"):"custom"===this._securityPolicy.passwordPolicy.type&&c.style(this._removePwdPolicy.domNode,"display",""))):(console.log("security policy retrieval error",a),this._securityPolicy=null,c.style(this._removePwdPolicy.domNode,"display","none"))}),c.hitch(this,function(a){console.log("unexpected security policy retrieval error",a);this._securityPolicy=null;c.style(this._removePwdPolicy.domNode,"display","none")}))},_loadSecurityPolicy:function(){return this._util.request({url:this._util.getSecureUrl(esriGeowConfig.restBaseUrl)+
"portals/self/securityPolicy"})},_loadPasswordPolicy:function(){return this._util.request({url:this._util.getSecureUrl(esriGeowConfig.restBaseUrl)+"portals/self/securityPolicy/passwordPolicy"})},_setEnterpriseIdentityProvider:function(){esri.isDefined(this._currentIdentityProvider)?(c.style(this._setIdentityProvider.domNode,"display","none"),c.style(this._editIdentityProvider.domNode,"display",""),c.style(this._removeIdentityProvider.domNode,"display",""),c.style(this._signInTitleRow,"display",""),
c.style(this._signInRow,"display","")):(c.style(this._setIdentityProvider.domNode,"display",""),c.style(this._editIdentityProvider.domNode,"display","none"),c.style(this._removeIdentityProvider.domNode,"display","none"),c.style(this._signInTitleRow,"display","none"),c.style(this._signInRow,"display","none"))},_setSignInOptions:function(){esri.isDefined(this._currentIdentityProvider)?(c.style(this._signInTitleRow,"display",""),c.style(this._signInRow,"display","")):(c.style(this._signInTitleRow,"display",
"none"),c.style(this._signInRow,"display","none"));this._organization.canSignInArcGIS?this._arcgisSignIn.set("checked",this._organization.canSignInArcGIS):!this._organization.canSignInArcGIS&&this._organization.canSignInIDP?this._enterpriseSignIn.set("checked",this._organization.canSignInIDP):this._arcgisSignIn.set("checked",this._organization.canSignInArcGIS)},_setHostedServerValue:function(){this._currentHostedServer?this._hostedServerSelectStore.fetch({onComplete:c.hitch(this,function(a){c.forEach(a,
c.hitch(this,function(a){var c=this._hostedServerSelectStore.getValue(a,"id");a&&c===this._currentHostedServer.id&&(this._settingHostedServerValue=!0,this._hostedServerSelect.set("value",this._currentHostedServer.name))}))})}):this._hostedServerSelect.set("value",this.i18n.serversTab.noHostedServer)},_setSecuredHostsValue:function(){this._securedHosts.set("hosts",this._organization.authorizedCrossOriginDomains||[])},_setFederatedServers:function(){var a=this._federatedServersGrid.get("store");a.fetch({onComplete:c.hitch(this,
function(b){c.forEach(b,c.hitch(function(b){a.deleteItem(b)}));a.save();c.forEach(this._federatedServers.current,c.hitch(this,function(b){a.newItem(b)}));a.save()})})},_enableBasemapGallerySort:function(a){this._basemapSortBySelect.set("disabled",!1);this._basemapSortByCheckBox.set("disabled",!1);c.style(this._basemapSortBySpan,"display","");a.sortField?this._basemapSortBySelect.set("value",this.i18n.sortFields[a.sortField]):this._basemapSortBySelect.set("value",this.i18n.sortFields.title);a.sortOrder&&
"desc"===a.sortOrder?this._basemapSortByCheckBox.set("checked",!1):this._basemapSortByCheckBox.set("checked",!0)},_disableBasemapGallerySort:function(){this._basemapSortBySelect.set("disabled",!0);this._basemapSortByCheckBox.set("disabled",!0);c.style(this._basemapSortBySpan,"display","none")},_enableHomePageFeaturedSort:function(a){this._homePageSortBySelect.set("disabled",!1);this._homePageSortByCheckBox.set("disabled",!1);c.style(this._homePageSortBySpan,"display","");a.sortField?this._homePageSortBySelect.set("value",
this.i18n.sortFields[a.sortField]):this._homePageSortBySelect.set("value",this.i18n.sortFields.title);a.sortOrder&&"desc"===a.sortOrder?this._homePageSortByCheckBox.set("checked",!1):this._homePageSortByCheckBox.set("checked",!0);this._homePageFeaturedCountSelect.set("disabled",!1);c.style(this._homePageFeaturedCountSelectSpan,"display","")},_disableHomePageFeaturedSort:function(){this._homePageSortBySelect.set("disabled",!0);this._homePageSortByCheckBox.set("disabled",!0);c.style(this._homePageSortBySpan,
"display","none");this._homePageFeaturedCountSelect.set("disabled",!0);c.style(this._homePageFeaturedCountSelectSpan,"display","none")},_enableAddEsriBasemaps:function(){esri.isDefined(this._addEsriBasemaps)&&c.style(c.byId("addEsriBasemapsTable"),"display","")},_disableAddEsriBasemaps:function(){esri.isDefined(this._addEsriBasemaps)&&c.style(c.byId("addEsriBasemapsTable"),"display","none")},_enableAddEsriWebAppTemplates:function(){esri.isDefined(this._addEsriWebAppTemplates)&&c.style(c.byId("addEsriWebAppTemplatesTable"),
"display","")},_disableAddEsriWebAppTemplates:function(){esri.isDefined(this._addEsriWebAppTemplates)&&c.style(c.byId("addEsriWebAppTemplatesTable"),"display","none")},_enableAddEsriGalleryAppTemplates:function(){esri.isDefined(this._addEsriGalleryAppTemplates)&&c.style(c.byId("addEsriGalleryAppTemplatesTable"),"display","")},_disableAddEsriGalleryAppTemplates:function(){esri.isDefined(this._addEsriGalleryAppTemplates)&&c.style(c.byId("addEsriGalleryAppTemplatesTable"),"display","none")},_enableTemplatesGallerySort:function(a){this._templatesSortBySelect.set("disabled",
!1);this._templatesSortByCheckBox.set("disabled",!1);c.style(this._templatesSortBySpan,"display","");a.sortField?this._templatesSortBySelect.set("value",this.i18n.sortFields[a.sortField]):this._templatesSortBySelect.set("value",this.i18n.sortFields.title);a.sortOrder&&"desc"===a.sortOrder?this._templatesSortByCheckBox.set("checked",!1):this._templatesSortByCheckBox.set("checked",!0)},_disableTemplatesGallerySort:function(){this._templatesSortBySelect.set("disabled",!0);this._templatesSortByCheckBox.set("disabled",
!0);c.style(this._templatesSortBySpan,"display","none")},_enableGalleryAppsSort:function(a){this._galleryAppsSortBySelect.set("disabled",!1);this._galleryAppsSortByCheckBox.set("disabled",!1);c.style(this._galleryAppsSortBySpan,"display","");a.sortField?this._galleryAppsSortBySelect.set("value",this.i18n.sortFields[a.sortField]):this._galleryAppsSortBySelect.set("value",this.i18n.sortFields.title);a.sortOrder&&"desc"===a.sortOrder?this._galleryAppsSortByCheckBox.set("checked",!1):this._galleryAppsSortByCheckBox.set("checked",
!0)},_disableGalleryAppSort:function(){this._galleryAppsSortBySelect.set("disabled",!0);this._galleryAppsSortByCheckBox.set("disabled",!0);c.style(this._galleryAppsSortBySpan,"display","none")},_enableGallerySort:function(a){this._gallerySortBySelect.set("disabled",!1);this._gallerySortByCheckBox.set("disabled",!1);c.style(this._gallerySortBySpan,"display","");a.sortField?this._gallerySortBySelect.set("value",this.i18n.sortFields[a.sortField]):this._galleryAppsSortBySelect.set("value",this.i18n.sortFields.title);
a.sortOrder&&"desc"===a.sortOrder?this._gallerySortByCheckBox.set("checked",!1):this._gallerySortByCheckBox.set("checked",!0)},_disableGallerySort:function(){this._gallerySortBySelect.set("disabled",!0);this._gallerySortByCheckBox.set("disabled",!0);c.style(this._gallerySortBySpan,"display","none")},_setBasemapGalleryValue:function(){this._addEsriBasemaps.set("checked",!1);if(this._currentBasemapGalleryGroupQuery&&this._currentBasemapGalleryGroupQuery!==esriGeowConfig.basemapGalleryGroupQuery){var a=
this._basemapGallerySelect.get("store"),b=this._currentBasemapGalleryGroupQuery.indexOf('title:"'),d=this._currentBasemapGalleryGroupQuery.indexOf("id:");if(-1<b){var e=this._currentBasemapGalleryGroupQuery,e=e.substring(b+7),e=e.substring(0,e.lastIndexOf('"')),f,b=this._currentBasemapGalleryGroupQuery.indexOf("owner:");-1<b&&(f=this._currentBasemapGalleryGroupQuery.substring(b+6));if(e&&f)for(b=0;b<this._allGroups.length;b++)d=this._allGroups[b],e===d.title&&f===d.owner&&(e=d.altTitle||d.title);
!this._isSingleTenant&&0<this._currentBasemapGalleryGroupQuery.indexOf("owner:esri")?(this._basemapGallerySelect.set("displayedValue",this.i18n.defaultEsriSelection),this._disableBasemapGallerySort()):(this._basemapGallerySelect.set("displayedValue",e),a.fetch({onComplete:c.hitch(this,function(b){for(var c=!0,d=0;d<b.length;d++)if(e===a.getValue(b[d],"name")&&f===a.getValue(b[d],"owner")){c=!1;this._basemapGallerySelect.set("item",b[d]);this._enableBasemapGallerySort(a.getValue(b[d],"group").group);
break}c&&(this._basemapGallerySelect.set("displayedValue",this.i18n.defaultEsriSelection),this._disableBasemapGallerySort())})}))}else if(-1<d){var g=this._currentBasemapGalleryGroupQuery.substring(d+3);a.fetch({onComplete:c.hitch(this,function(b){for(var c=!0,d=0;d<b.length;d++)if(g==a.getValue(b[d],"id")){c=!1;this._basemapGallerySelect.set("displayedValue",a.getValue(b[d],"name"));this._basemapGallerySelect.set("item",b[d]);this._enableBasemapGallerySort(a.getValue(b[d],"group").group);break}c&&
(this._basemapGallerySelect.set("displayedValue",this.i18n.defaultEsriSelection),this._disableBasemapGallerySort())})})}else this._basemapGallerySelect.set("displayedValue",this.i18n.defaultEsriSelection),this._disableBasemapGallerySort()}else this._basemapGallerySelect.set("displayedValue",this.i18n.defaultEsriSelection),this._disableBasemapGallerySort()},_setHomePageFeaturedValue:function(){esri.isDefined(this._organization.homePageFeaturedContentCount)?0===this._organization.homePageFeaturedContentCount?
this._homePageFeaturedCountSelect.set("value",this.i18n.homeTab.allOption):this._homePageFeaturedCountSelect.set("value",this._organization.homePageFeaturedContentCount):this._homePageFeaturedCountSelect.set("value",this.i18n.homeTab.allOption);if(this._currentHomePageFeaturedQuery){var a=this._homePageFeaturedSelect.get("store"),b=this._currentHomePageFeaturedQuery.indexOf('title:"'),d=this._currentHomePageFeaturedQuery.indexOf("id:");if(-1<b){var e=this._currentHomePageFeaturedQuery.substring(b+
7),e=e.substring(0,e.lastIndexOf('"')),f,b=this._currentHomePageFeaturedQuery.indexOf("owner:");-1<b&&(f=this._currentHomePageFeaturedQuery.substring(b+6));if(e&&f)for(b=0;b<this._allGroups.length;b++)d=this._allGroups[b],e===d.title&&f===d.owner&&(e=d.altTitle||d.title);0<this._currentHomePageFeaturedQuery.indexOf("owner:esri")?(this._homePageFeaturedSelect.set("displayedValue",this.i18n.noFeaturedContent),this._disableHomePageFeaturedSort()):(this._homePageFeaturedSelect.set("displayedValue",e),
a.fetch({onComplete:c.hitch(this,function(b){for(var c=!0,d=0;d<b.length;d++)if(e===a.getValue(b[d],"name")&&f===a.getValue(b[d],"owner")){c=!1;this._homePageFeaturedSelect.set("item",b[d]);this._enableHomePageFeaturedSort(a.getValue(b[d],"group").group);break}c&&(this._homePageFeaturedSelect.set("displayedValue",this.i18n.noFeaturedContent),this._disableHomePageFeaturedSort())})}))}else if(-1<d){var g=this._currentHomePageFeaturedQuery.substring(d+3);a.fetch({onComplete:c.hitch(this,function(b){for(var c=
!0,d=0;d<b.length;d++)if(g==a.getValue(b[d],"id")){c=!1;this._homePageFeaturedSelect.set("displayedValue",a.getValue(b[d],"name"));this._homePageFeaturedSelect.set("item",b[d]);this._enableHomePageFeaturedSort(a.getValue(b[d],"group").group);break}c&&(this._homePageFeaturedSelect.set("displayedValue",this.i18n.noFeaturedContent),this._disableHomePageFeaturedSort())})})}else this._homePageFeaturedSelect.set("displayedValue",this.i18n.noFeaturedContent),this._disableHomePageFeaturedSort()}else this._homePageFeaturedSelect.set("displayedValue",
this.i18n.noFeaturedContent),this._disableHomePageFeaturedSort()},_setTemplatesValue:function(){this._addEsriWebAppTemplates.set("checked",!1);if(this._currentTemplatesGroupQuery){var a=this._templatesSelect.get("store"),b=this._currentTemplatesGroupQuery.indexOf('title:"'),d=this._currentTemplatesGroupQuery.indexOf("id:");if(-1<b){var e=this._currentTemplatesGroupQuery.substring(b+7),e=e.substring(0,e.lastIndexOf('"')),f,b=this._currentTemplatesGroupQuery.indexOf("owner:");-1<b&&(f=this._currentTemplatesGroupQuery.substring(b+
6));if(e&&f)for(b=0;b<this._allGroups.length;b++)d=this._allGroups[b],e===d.title&&f===d.owner&&(e=d.altTitle||d.title);!this._isSingleTenant&&0<this._currentTemplatesGroupQuery.indexOf("owner:esri")?(this._templatesSelect.set("displayedValue",this.i18n.defaultEsriSelection),this._disableTemplatesGallerySort()):(this._templatesSelect.set("displayedValue",e),a.fetch({onComplete:c.hitch(this,function(b){for(var c=!0,d=0;d<b.length;d++)if(e===a.getValue(b[d],"name")&&f===a.getValue(b[d],"owner")){c=
!1;this._templatesSelect.set("item",b[d]);this._enableTemplatesGallerySort(a.getValue(b[d],"group").group);break}c&&(this._templatesSelect.set("displayedValue",this.i18n.defaultEsriSelection),this._disableTemplatesGallerySort())})}))}else if(-1<d){var g=this._currentTemplatesGroupQuery.substring(d+3);a.fetch({onComplete:c.hitch(this,function(b){for(var c=!0,d=0;d<b.length;d++)if(g==a.getValue(b[d],"id")){c=!1;this._templatesSelect.set("displayedValue",a.getValue(b[d],"name"));this._templatesSelect.set("item",
b[d]);this._enableTemplatesGallerySort(a.getValue(b[d],"group").group);break}c&&(this._templatesSelect.set("displayedValue",this.i18n.defaultEsriSelection),this._disableTemplatesGallerySort())})})}else this._templatesSelect.set("displayedValue",this.i18n.defaultEsriSelection),this._disableTemplatesGallerySort()}else this._templatesSelect.set("displayedValue",this.i18n.defaultEsriSelection),this._disableTemplatesGallerySort()},_setGalleryAppsValue:function(){this._addEsriGalleryAppTemplates.set("checked",
!1);if(this._currentGalleryAppsGroupQuery){var a=this._galleryAppsSelect.get("store"),b=this._currentGalleryAppsGroupQuery.indexOf('title:"'),d=this._currentGalleryAppsGroupQuery.indexOf("id:");if(-1<b){var e=this._currentGalleryAppsGroupQuery.substring(b+7),e=e.substring(0,e.lastIndexOf('"')),f,b=this._currentGalleryAppsGroupQuery.indexOf("owner:");-1<b&&(f=this._currentGalleryAppsGroupQuery.substring(b+6));if(e&&f)for(b=0;b<this._allGroups.length;b++)d=this._allGroups[b],e===d.title&&f===d.owner&&
(e=d.altTitle||d.title);!this._isSingleTenant&&0<this._currentGalleryAppsGroupQuery.indexOf("owner:esri")?(this._galleryAppsSelect.set("displayedValue",this.i18n.defaultEsriSelection),this._disableGalleryAppSort()):(this._galleryAppsSelect.set("displayedValue",e),a.fetch({onComplete:c.hitch(this,function(b){for(var c=!0,d=0;d<b.length;d++)if(e===a.getValue(b[d],"name")&&f===a.getValue(b[d],"owner")){c=!0;this._galleryAppsSelect.set("item",b[d]);this._enableGalleryAppsSort(a.getValue(b[d],"group").group);
break}c&&(this._galleryAppsSelect.set("displayedValue",this.i18n.defaultEsriSelection),this._disableGalleryAppSort())})}))}else if(-1<d){var g=this._currentGalleryAppsGroupQuery.substring(d+3);a.fetch({onComplete:c.hitch(this,function(b){for(var c=!0,d=0;d<b.length;d++)if(g==a.getValue(b[d],"id")){c=!1;this._galleryAppsSelect.set("displayedValue",a.getValue(b[d],"name"));this._galleryAppsSelect.set("item",b[d]);this._enableGalleryAppsSort(a.getValue(b[d],"group").group);break}c&&(this._galleryAppsSelect.set("displayedValue",
this.i18n.defaultEsriSelection),this._disableGalleryAppSort())})})}else this._galleryAppsSelect.set("displayedValue",this.i18n.defaultEsriSelection),this._disableGalleryAppSort()}else this._galleryAppsSelect.set("displayedValue",this.i18n.defaultEsriSelection),this._disableGalleryAppSort()},_setBingMapsKeyValue:function(){"public"===this._organization.access?c.style(this._shareBingDiv,"display",""):c.style(this._shareBingDiv,"display","none");this._shareBingKey.set("checked",esri.isDefined(this._organization.canShareBingPublic)?
this._organization.canShareBingPublic:!1);esri.isDefined(this._currentBingKey)?this._bingKey.set("value",this._currentBingKey):this._bingKey.set("value","")},_setUnitsValue:function(){esri.isDefined(this._organization.units)&&this._organization.units===this.unitsMetric?this._unitsSelect.set("value",this.i18n.mapTab.unitsMetric):this._unitsSelect.set("value",this.i18n.mapTab.unitsEnglish)},_setElevationServerValue:function(){this._newElevationServices=c.clone(this._currentElevationServices);this.onElevationSelectChange()},
_setNetworkServerValue:function(){this._newNetworkServices=c.clone(this._currentNetworkServices);this.onNetworkSelectChange()},_setAnalysisServerValue:function(){if(this._isSingleTenant&&this._currentHostedServer&&0!==this._currentHostedServer.id&&esri.isDefined(this._organization.supportsSceneServices)&&!0===this._organization.supportsSceneServices){c.style(this._analysisTitleRow,"display","");c.style(this._analysisRow,"display","");var a=this._currentAnalysisService&&this._currentAnalysisService.url;
c.style(this._enableAnalysis.domNode,"display",a?"none":"");c.style(this._disableAnalysis.domNode,"display",a?"":"none")}else c.style(this._analysisTitleRow,"display","none"),c.style(this._analysisRow,"display","none")},_setGeometryServerValue:function(){var a=this._geometryService.get("value");esri.isDefined(this._currentGeometryService)&&(!this._isSingleTenant&&this._currentGeometryService&&this._currentGeometryService.url&&this._protocolAgnosticUrlMatch(this._currentGeometryService.url,this._selfNoAuth.helperServices.geometry.url)?
(this._settingGeometryServiceValue=""!==a,this._geometryService.set("value","")):this._currentGeometryService&&(this._settingGeometryServiceValue=a!==this._currentGeometryService.url,this._geometryService.set("value",this._currentGeometryService.url)))},_setGeoEnrichServerValue:function(){var a=this._geoEnrichService.get("value");esri.isDefined(this._currentGeoEnrichService)&&(!this._isSingleTenant&&this._currentGeoEnrichService&&this._currentGeoEnrichService.url&&this._protocolAgnosticUrlMatch(this._currentGeoEnrichService.url,
this._selfNoAuth.helperServices.geoenrichment.url)?(this._settingGeoEnrichServiceValue=""!==a,this._geoEnrichService.set("value","")):this._currentGeoEnrichService&&(this._settingGeoEnrichServiceValue=a!==this._currentGeoEnrichService.url,this._geoEnrichService.set("value",this._currentGeoEnrichService.url)))},_setHydrologyServerValue:function(){var a=this._hydrologyService.get("value");esri.isDefined(this._currentHydrologyService)&&(!this._isSingleTenant&&this._currentHydrologyService&&this._currentHydrologyService.url&&
this._protocolAgnosticUrlMatch(this._currentHydrologyService.url,this._selfNoAuth.helperServices.hydrology.url)?(this._settingHydroServiceValue=""!==a,this._hydrologyService.set("value","")):this._currentHydrologyService&&(this._settingHydroServiceValue=a!==this._currentHydrologyService.url,this._hydrologyService.set("value",this._currentHydrologyService.url)))},_setRoutingServerValue:function(){var a=this._routingService.get("value");esri.isDefined(this._currentRoutingService)&&(!this._isSingleTenant&&
this._currentRoutingService&&this._currentRoutingService.url&&this._protocolAgnosticUrlMatch(this._currentRoutingService.url,this._selfNoAuth.helperServices.route.url)?(this._settingRoutingServiceValue=""!==a,this._routingService.set("value","")):this._currentRoutingService&&(this._settingRoutingServiceValue=a!==this._currentRoutingService.url,this._routingService.set("value",this._currentRoutingService.url)))},_protocolAgnosticUrlMatch:function(a,b){var c,e;0===a.indexOf("http:")?c=a.substring(5):
0===a.indexOf("https:")&&(c=a.substring(6));0===b.indexOf("http:")?e=b.substring(5):0===b.indexOf("https:")&&(e=b.substring(6));return c===e},_setGeocodingServersValue:function(){var a,b=this._geocodersGrid.store.query();for(a=0;a<b.length;a++)this._geocodersGrid.store.remove(b[a].id);if(esri.isDefined(this._currentGeocodingServices)&&0<this._currentGeocodingServices.length){for(a=0;a<this._currentGeocodingServices.length;a++){this._currentGeocodingServices[a].id=a;var b=this._currentGeocodingServices[a].url,
c=this._currentGeocodingServices[a].name;if((!esri.isDefined(c)||esri.isDefined(c)&&c===this.i18n.esriWorldGeocoder)&&b&&-1<b.toLowerCase().indexOf("arcgis.com/arcgis/rest/services/world/geocodeserver"))this._currentGeocodingServices[a].name=this.i18n.esriWorldGeocoder,this._currentGeocodingServices[a].esri=!0;this._geocodersGrid.store.put(this._currentGeocodingServices[a])}this._geocodersGrid.refresh()}},_setPrintServerValue:function(){var a=this._printingService.get("value"),b=this._isSingleTenant?
"/sharing/tools/newPrint":null;esri.isDefined(this._currentPrintingService)&&(!this._isSingleTenant&&this._currentPrintingService&&this._currentPrintingService.url&&this._protocolAgnosticUrlMatch(this._currentPrintingService.url,this._selfNoAuth.helperServices.printTask.url)||this._isSingleTenant&&b&&this._currentPrintingService&&this._currentPrintingService.url&&-1<this._currentPrintingService.url.indexOf(b)?(this._settingPrintingServiceValue=""!==a,this._printingService.set("value",""),c.style(this._printTemplates.domNode,
"display","none")):this._currentPrintingService&&(this._settingPrintingServiceValue=a!==this._currentPrintingService.url,this._printingService.set("value",this._currentPrintingService.url),this._printTemplates.set("printTask",c.clone(this._currentPrintingService)),c.style(this._printTemplates.domNode,"display",""),this._printTemplates.refresh()))},_setDefaultBasemapValue:function(){this._currentDefaultBasemap&&this._currentDefaultBasemapId&&"0"!==this._currentDefaultBasemapId?(this._defaultBasemapSelect.set("displayedValue",
this._currentDefaultBasemap),this._newBasemapId=this._currentDefaultBasemapId):this._defaultBasemapSelect.set("displayedValue",this.i18n.defaultEsriSelection)},_setDefaultExtentValue:function(){this._newSelectedDefaultExtent=null;var a=new esri.SpatialReference({wkid:4326});if(!this._currentDefaultExtent.spatialReference.wkid||4326!==this._currentDefaultExtent.spatialReference.wkid){var b=c.hitch(this,function(b){b&&(!b.code&&!b.message&&0<b.length&&b[0])&&(b=b[0],this._currentDefaultExtent=new esri.geometry.Extent(b.xmin,
b.ymin,b.xmax,b.ymax,a),this._displayExtent(this._currentDefaultExtent))});arcgisonline.map.main.doProject(this._currentDefaultExtent,a,b,b)}else this._displayExtent(this._currentDefaultExtent)},_setSummaryValue:function(){this._organization.localizedOrgProperties&&this._organization.localizedOrgProperties["default"]?this._organization.localizedOrgProperties["default"].description?this._orgSummary.set("value",this._organization.localizedOrgProperties["default"].description):this._orgSummary.set("value",
""):this._orgSummary.set("value","")},_setHomePageDescriptionValue:function(){var a=this._organization.showHomePageDescription,a=esri.isDefined(a)&&!0===a;this._homePageDescription.set("checked",a)},_setMetadataValue:function(){"#"===c.attr(c.byId("metadataHelpLink"),"href")&&c.attr(c.byId("metadataHelpLink"),"href",this._organization.helpBase+this._organization.helpMap.m["120001028"]);this._organization.metadataEditable?this._enableMetadata.set("checked",!0):this._enableMetadata.set("checked",!1);
var a=this._organization.metadataFormats||[];0===c.indexOf(a,this.formatFGDC)?this._metadataFGDCOption.set("checked",!0):0===c.indexOf(a,this.formatINSPIRE)?this._metadataINSPIREOption.set("checked",!0):0===c.indexOf(a,this.formatISO19139)?this._metadataISO19139Option.set("checked",!0):0===c.indexOf(a,this.formatISO19115)?this._metadataISO19115Option.set("checked",!0):this._metadataISO1913932Option.set("checked",!0);c.style(this._metadataFormatDiv,"display",this._enableMetadata.get("checked")?"":
"none")},_setLinksValue:function(){this._initOrgPropertiesSetting();esri.isDefined(this._organization.portalProperties)&&esri.isDefined(this._organization.portalProperties.links)&&esri.isDefined(this._organization.portalProperties.links.contactUs)?(this._contactUsVisible.set("checked",!!this._organization.portalProperties.links.contactUs.visible),this._contactUsLink.set("value",this._organization.portalProperties.links.contactUs.url)):(this._contactUsVisible.set("checked",!1),this._contactUsLink.set("value",
""))},_setContactInfo:function(){this._canListMarketplace&&(esri.isDefined(this._organization.orgEmail)&&this._orgEmail.set("value",this._organization.orgEmail),esri.isDefined(this._organization.orgUrl)&&this._orgUrl.set("value",this._organization.orgUrl),esri.isDefined(this._organization.orgPhone)&&this._orgPhone.set("value",this._organization.orgPhone))},_setRegionValue:function(){var a=this._regionSelect.get("store");a.fetchItemByIdentity({identity:this._organization.region||esriGeowConfig.self&&
esriGeowConfig.self.ipCntryCode,onItem:c.hitch(this,function(b){this._regionSelect.set("displayedValue",b&&a.getValue(b,"localizedName")||"WO");this._newSelectedRegion=b&&a.getValue(b,"region")||"WO"})})},_setLanguageValue:function(){if(this._organization.culture&&0<this._organization.culture.length){var a=this._languageSelect.get("store");a.fetchItemByIdentity({identity:this._organization.culture,onItem:c.hitch(this,function(b){b&&this._languageSelect.set("displayedValue",a.getValue(b,"displayName"))})})}else this._languageSelect.set("displayedValue",
this.i18n.browserDefaultSelection)},_setBackgroundValue:function(){this._newCustomBackgroundKey=null;c.byId("bgCustomCol").innerHTML=this.i18n.clickToUploadCustomImage;esri.isDefined(this._currentSelectedBackground)?this._currentSelectedBackground===this.predefinedBackground1?(this._bgRadio1.set("checked",!0),this._selectedBgRadioButton=this._bgRadio1):this._currentSelectedBackground===this.predefinedBackground2?(this._bgRadio2.set("checked",!0),this._selectedBgRadioButton=this._bgRadio2):(this._bgRadioCustom.set("checked",
!0),c.byId("bgCustomCol").innerHTML=this.i18n.updateExistingCustomImage,this._selectedBgRadioButton=this._bgRadioCustom):(this._bgRadio1.set("checked",!0),this._selectedBgRadioButton=this._bgRadio1,this._newSelectedBackground=this._bgRadio1.value)},_fixSingleDivIssue:function(a){var b=RegExp(/\/div>/i),c=RegExp(/<div/gi);return!RegExp(/^<div/i).test(a)||!(b.test(a)&&1<a.match(c).length)?"\x3cdiv\x3e"+a+"\x3c/div\x3e":a},_setBannerValue:function(){this._newCustomBannerKey=null;c.byId("bannerCustomCol").innerHTML=
this.i18n.clickToUploadCustomImage;if(this._currentRotatorPanels){var a=this.insertSecurityToken(this._currentRotatorPanels[0]),a=a?this._fixSingleDivIssue(a):"";this._editHTMLBanner.set("value",a);this.predefinedBanner1Id===this._currentSelectedRotatorPanelId?(this._bannerRadio1.set("checked",!0),this._selectedBannerRadioButton=this._bannerRadio1,this._newSelectedRotatorPanelId=this._bannerRadio1.value,this._bannerImageSelect.set("checked",!0),this.onBannerImageSelect()):this.predefinedBanner2Id===
this._currentSelectedRotatorPanelId?(this._bannerRadio2.set("checked",!0),this._selectedBannerRadioButton=this._bannerRadio2,this._newSelectedRotatorPanelId=this._bannerRadio2.value,this._bannerImageSelect.set("checked",!0),this.onBannerImageSelect()):this.predefinedBanner3Id===this._currentSelectedRotatorPanelId?(this._bannerRadio3.set("checked",!0),this._selectedBannerRadioButton=this._bannerRadio3,this._newSelectedRotatorPanelId=this._bannerRadio3.value,this._bannerImageSelect.set("checked",!0),
this.onBannerImageSelect()):this.predefinedBanner4Id===this._currentSelectedRotatorPanelId?(this._bannerRadio4.set("checked",!0),this._selectedBannerRadioButton=this._bannerRadio4,this._newSelectedRotatorPanelId=this._bannerRadio4.value,this._bannerImageSelect.set("checked",!0),this.onBannerImageSelect()):this.predefinedBanner5Id===this._currentSelectedRotatorPanelId?(this._bannerRadio5.set("checked",!0),this._selectedBannerRadioButton=this._bannerRadio5,this._newSelectedRotatorPanelId=this._bannerRadio5.value,
this._bannerImageSelect.set("checked",!0),this.onBannerImageSelect()):this.customBannerId===this._currentSelectedRotatorPanelId?(this._bannerRadioCustom.set("checked",!0),this._selectedBannerRadioButton=this._bannerRadioCustom,this._newSelectedRotatorPanelId=this._bannerRadioCustom.value,this._bannerImageSelect.set("checked",!0),c.byId("bannerCustomCol").innerHTML=this.i18n.updateExistingCustomImage,this.onBannerImageSelect()):this.htmlBannerId===this._currentSelectedRotatorPanelId&&(this._bannerHTMLSelect.set("checked",
!0),this._newSelectedRotatorPanelId=this.htmlBannerId,this.onBannerHTMLSelect())}else this._bannerImageSelect.set("checked",!0),this._bannerRadio2.set("checked",!0),this._selectedBannerRadioButton=this._bannerRadio2,this._newSelectedRotatorPanelId=this._bannerRadio2.value,this.onBannerImageSelect()},_setGalleryValue:function(){var a=this._organization.featuredItemsGroupQuery;if(a===esriGeowConfig.featuredItemsGroupQuery)this._gallerySelect.set("displayedValue",this.i18n.mostViewedItems),this._disableGallerySort();
else if(esri.isDefined(a)||""!==a){var b=this._gallerySelect.get("store");b.fetch({onComplete:c.hitch(this,function(d){var e=null;c.forEach(d,c.hitch(this,function(c){var d=b.getValue(c,"group");a==="id:"+d&&(e=c)}));esri.isDefined(e)?(this._gallerySelect.set("displayedValue",b.getValue(e,"name")),this._gallerySelect.set("item",e),b.getValue(e,"name")===this.i18n.mostViewedItems?(this._groupSelectedReminder.innerHTML=this.mostViewedReminderText,this._disableGallerySort()):(this._groupSelectedReminder.innerHTML=
this.groupReminderText,this._enableGallerySort(b.getValue(e,"groupObj").group))):(this._gallerySelect.set("displayedValue",this.i18n.mostViewedItems),this._groupSelectedReminder.innerHTML=this.mostViewedReminderText,this._disableGallerySort())})})}},_hideMFA:function(){c.style(this._mfaSettingTitleRow,"display","none");c.style(this._mfaSettingRow,"display","none")},_setMFAValue:function(){var a=new c.Deferred,b=c.hitch(this,function(){this._loadMFASettings();"#"===c.attr(c.byId("mfaHelpLink"),"href")&&
c.attr(c.byId("mfaHelpLink"),"href",this._organization.helpBase+this._organization.helpMap.m["120000978"]);this._mfaEnabled.set("checked",!!this._organization.mfaEnabled);this.toggleMFAConfig();this._newMfaAdmins=c.clone(this._currentMfaAdmins);this._refreshAdminList();this._refreshDesignatedAdminList();a.resolve()});this._retrieveAllAdministrators().then(b,b);return a},_setAdminContactsValue:function(){var a=new c.Deferred,b=c.hitch(this,function(){this._loadAdminContactSettings();this._newAdminContacts=
c.clone(this._currentAdminContacts);this._refreshAdminContactList();this._refreshDesignatedAdminContactList();a.resolve()});this._retrieveAllAdministrators().then(b,b);return a},_setFeaturedGroupsValue:function(){this._loadFeaturedGroupsList()},_refreshAdminList:function(){var a=c.byId("adminsToDesignatePane");c.attr(a,"innerHTML","");var b=this._allAdmins,d;if(b)for(var e=0;e<b.length;e++)d=b[e],c.create("a",{id:"admin-"+e,innerHTML:d.altName,username:d.username,className:"linkNoHref"},a),c.create("br",
null,a)},_refreshAdminContactList:function(){var a=c.byId("adminContactsToDesignatePane");c.attr(a,"innerHTML","");var b=this._allAdmins,d;if(b)for(var e=0;e<b.length;e++)d=b[e],c.create("a",{id:"admin-contact-"+e,innerHTML:d.altName,username:d.username,className:"linkNoHref"},a),c.create("br",null,a)},_refreshDesignatedAdminList:function(){var a=c.byId("designatedAdminsPane");c.attr(a,"innerHTML","");if(this._newMfaAdmins)for(var b,d=0;d<this._newMfaAdmins.length;d++)b=this._newMfaAdmins[d],c.create("a",
{id:"designated-admin-"+d,innerHTML:b.altName,username:b.username,className:"linkNoHref"},a),c.create("br",null,a)},_refreshDesignatedAdminContactList:function(){var a=c.byId("designatedAdminContactsPane");c.attr(a,"innerHTML","");if(this._newAdminContacts)for(var b,d=0;d<this._newAdminContacts.length;d++)b=this._newAdminContacts[d],c.create("a",{id:"designated-admin-contact-"+d,innerHTML:b.altName,username:b.username,className:"linkNoHref"},a),c.create("br",null,a)},_closeEdit:function(){this.unsetLoading();
this.unsetSaving();this._resetThumbnail();this._thumbnailPath.value="";this._bannerThumbnailPath.value="";this._bgThumbnailPath.value="";this._unloadEditConnections();c.removeClass(this._thumbnail,"linkNoHref");c.removeClass(this._viewThumbnail,"linkNoHref");c.query(".newAccount",this.domNode).style("display","none");this._hideEditModeItems();esri.isDefined(this._organization.thumbnail)&&0<this._organization.thumbnail.length?(c.attr(this._thumbnail,"src",esriGeowConfig.restBaseUrl+"portals/self/resources/"+
this._organization.thumbnail+this._token+"\x26ts\x3d"+(new Date).getTime()),c.attr(this._viewThumbnail,"src",esriGeowConfig.restBaseUrl+"portals/self/resources/"+this._organization.thumbnail+this._token+"\x26ts\x3d"+(new Date).getTime())):c.attr(this._thumbnail,"src",this.defaultImgThumbnail);this._newSelectedGallery&&(this._newSelectedGallery=null);this._allAdmins=[];this._setOrganizationNameDesc();this._setOrganizationThumbnail();this._refreshUserGrids()},_refreshUserGrids:function(){this._userGrid.setStructure(this._createUserGridLayout());
this._userGrid&&(this._userGrid.resize(),this._userGrid.update());this._pendingGrid&&(this._pendingGrid.resize(),this._pendingGrid.update())},_unloadEditConnections:function(){c.forEach(this._editConnects,function(a){c.disconnect(a)});c.forEach(this._bannerConnects,function(a){c.disconnect(a)});c.forEach(this._bgConnects,function(a){c.disconnect(a)});this._editConnects=[];this._bannerConnects=[];this._bgConnects=[]},_showBackgroundThumbnailDialog:function(a){a=c.position(c.byId("bgCustomCol"));c.style(c.byId("bg-thumbnail-dialog"),
"top",Math.round(a.y-20)+"px");c.style(c.byId("bg-thumbnail-dialog"),"left",(esriGeowConfig.isRightToLeft?Math.round(a.x)+a.w-c.style("bg-thumbnail-dialog","width"):Math.round(a.x))+"px");c.style(c.byId("bg-thumbnail-dialog"),"display","block")},_showBannerThumbnailDialog:function(a){a=c.position(c.byId("bannerCustomCol"));c.style(c.byId("banner-thumbnail-dialog"),"top",Math.round(a.y-20)+"px");c.style(c.byId("banner-thumbnail-dialog"),"left",(esriGeowConfig.isRightToLeft?Math.round(a.x)+a.w-c.style("banner-thumbnail-dialog",
"width"):Math.round(a.x))+"px");c.style(c.byId("banner-thumbnail-dialog"),"display","block")},_showThumbnailDialog:function(a){a=c.position(this._thumbnail);c.style(c.byId("group-thumbnail-dialog"),"top",Math.round(a.y)+"px");c.style(c.byId("group-thumbnail-dialog"),"left",(esriGeowConfig.isRightToLeft?Math.round(a.x)+a.w-c.style("group-thumbnail-dialog","width"):Math.round(a.x))+"px");c.style(c.byId("group-thumbnail-dialog"),"display","block")},_deleteThumbnail:function(){this._thumbnail.src=this.defaultImgThumbnail;
this._newThumbKey=null;this._deletingThumbnail=!0;c.style(c.byId("thumbnailDeleteDiv"),"display","none")},_backgroundThumbnailOk:function(){var a=this._bgThumbnailPath.value,b=a.lastIndexOf("."),d=a.substring(b+1,a.length).toLowerCase();if("png"!=d&&"gif"!=d&&"jpg"!=d&&"jpeg"!=d)this._generalDlg.show({title:this.i18n.errorLabel,message:this.i18n.invalidImageTypeMsg});else{g.byId("bg-thumbnail-ok").set("label",this.i18n.uploadingLabel);g.byId("bg-thumbnail-ok").set("disabled",!0);g.byId("bg-thumbnail-cancel").set("disabled",
!0);var e=a.lastIndexOf("\\");0<e&&e<b?this._newCustomBackgroundKey=a.substring(e+1):(e=a.lastIndexOf("/"),this._newCustomBackgroundKey=0<e&&e<b?a.substring(e+1):"background-"+(new Date).getTime()+"."+d);this._newCustomBackgroundKey="background."+d;c.byId("bg-key").value=this._newCustomBackgroundKey;this._addBackgroundResource()}},_bannerThumbnailOk:function(){var a=this._bannerThumbnailPath.value,b=a.lastIndexOf("."),d=a.substring(b+1,a.length).toLowerCase();if("png"!=d&&"gif"!=d&&"jpg"!=d&&"jpeg"!=
d)this._generalDlg.show({title:this.i18n.errorLabel,message:this.i18n.invalidImageTypeMsg});else{g.byId("banner-thumbnail-ok").set("label",this.i18n.uploadingLabel);g.byId("banner-thumbnail-ok").set("disabled",!0);g.byId("banner-thumbnail-cancel").set("disabled",!0);var e=a.lastIndexOf("\\");0<e&&e<b?this._newCustomBannerKey=a.substring(e+1):(e=a.lastIndexOf("/"),this._newCustomBannerKey=0<e&&e<b?a.substring(e+1):"banner-"+(new Date).getTime()+"."+d);this._newCustomBannerKey="banner."+d;c.byId("banner-key").value=
this._newCustomBannerKey;this._addBannerResource()}},_thumbnailOk:function(){var a=this._thumbnailPath.value,b=a.lastIndexOf("."),a=a.substring(b+1,a.length).toLowerCase();"png"!=a&&"gif"!=a&&"jpg"!=a&&"jpeg"!=a?this._generalDlg.show({title:this.i18n.errorLabel,message:this.i18n.invalidImageTypeMsg}):(this._existingThumbKey=this._organization.thumbnail,this._newThumbKey="thumbnail."+a,c.byId("key").value=this._newThumbKey,""!==this._thumbnailPath.value&&(c.attr(this._thumbnail,"src",this._util.relativeToExplicitUrl("images/group-thumbnail-update.png")),
c.attr(this._viewThumbnail,"src",this._util.relativeToExplicitUrl("images/group-thumbnail-update.png"))),c.style(c.byId("thumbnailDeleteDiv"),"display","none"),c.style(c.byId("group-thumbnail-dialog"),"display","none"))},_handleCustomBackgroundFailed:function(){g.byId("bg-thumbnail-ok").set("label",this.i18n.ok);g.byId("bg-thumbnail-ok").set("disabled",!1);g.byId("bg-thumbnail-cancel").set("disabled",!1);c.style(c.byId("bg-thumbnail-dialog"),"display","none");this._newCustomBackgroundKey=null;this._generalDlg.show({title:this.i18n.errorLabel,
message:this.i18n.customBackgroundErrorMsg})},_handleCustomBackgroundAdded:function(){g.byId("bg-thumbnail-ok").set("label",this.i18n.ok);g.byId("bg-thumbnail-ok").set("disabled",!1);g.byId("bg-thumbnail-cancel").set("disabled",!1);c.style(c.byId("bg-thumbnail-dialog"),"display","none");c.byId("bgCustomCol").innerHTML=this.i18n.homeTab.newBackground},_handleCustomBannerFailed:function(){g.byId("banner-thumbnail-ok").set("label",this.i18n.ok);g.byId("banner-thumbnail-ok").set("disabled",!1);g.byId("banner-thumbnail-cancel").set("disabled",
!1);c.style(c.byId("banner-thumbnail-dialog"),"display","none");this._newCustomBannerKey=null;this._generalDlg.show({title:this.i18n.errorLabel,message:this.i18n.customBannerErrorMsg})},_handleCustomBannerAdded:function(){g.byId("banner-thumbnail-ok").set("label",this.i18n.ok);g.byId("banner-thumbnail-ok").set("disabled",!1);g.byId("banner-thumbnail-cancel").set("disabled",!1);c.style(c.byId("banner-thumbnail-dialog"),"display","none");c.byId("bannerCustomCol").innerHTML=this.i18n.homeTab.newBanner},
_handleResourceFailed:function(){this._organization.thumbnail=this._existingThumbKey;this.unsetLoading();this.unsetSaving()},_handleResourceAdded:function(){this._updateAccountSettings()},_backgroundThumbnailCancel:function(a){c.style(c.byId("bg-thumbnail-dialog"),"display","none");c.forEach(this._bgConnects,function(a){c.disconnect(a)});this._bgConnects=[];this._bgThumbnailPath.value="";this._bgConnects.push(c.connect(this._bgRadio1,"onClick",this,"onPredefinedBackgroundSelect"));this._bgConnects.push(c.connect(this._bgRadio2,
"onClick",this,"onPredefinedBackgroundSelect"));this._bgConnects.push(c.connect(c.byId("bgCustomCol"),"onclick",this,"onCustomBackgroundSelect"));this._bgConnects.push(c.connect(this._bgRadioCustom,"onClick",this,"onCustomBackgroundSelect"));this._bgConnects.push(c.connect(c.byId("bg-thumbnail-close"),"onclick",this,"_backgroundThumbnailCancel"));this._bgConnects.push(c.connect(c.byId("bg-thumbnail-ok"),"onclick",this,"_backgroundThumbnailOk"));this._bgConnects.push(c.connect(c.byId("bg-thumbnail-cancel"),
"onclick",this,"_backgroundThumbnailCancel"))},_bannerThumbnailCancel:function(a){c.style(c.byId("banner-thumbnail-dialog"),"display","none");c.forEach(this._bannerConnects,function(a){c.disconnect(a)});this._bannerConnects=[];this._bannerThumbnailPath.value="";this._bannerConnects.push(c.connect(this._bannerRadio1,"onClick",this,"onPredefinedBannerSelect"));this._bannerConnects.push(c.connect(this._bannerRadio2,"onClick",this,"onPredefinedBannerSelect"));this._bannerConnects.push(c.connect(this._bannerRadio3,
"onClick",this,"onPredefinedBannerSelect"));this._bannerConnects.push(c.connect(this._bannerRadio4,"onClick",this,"onPredefinedBannerSelect"));this._bannerConnects.push(c.connect(this._bannerRadio5,"onClick",this,"onPredefinedBannerSelect"));this._bannerConnects.push(c.connect(c.byId("bannerCustomCol"),"onclick",this,"onBannerCustomSelect"));this._bannerConnects.push(c.connect(this._bannerRadioCustom,"onClick",this,"onBannerCustomSelect"));this._bannerConnects.push(c.connect(c.byId("banner-thumbnail-close"),
"onclick",this,"_bannerThumbnailCancel"));this._bannerConnects.push(c.connect(c.byId("banner-thumbnail-ok"),"onclick",this,"_bannerThumbnailOk"));this._bannerConnects.push(c.connect(c.byId("banner-thumbnail-cancel"),"onclick",this,"_bannerThumbnailCancel"))},_thumbnailCancel:function(){c.style(c.byId("group-thumbnail-dialog"),"display","none");c.forEach(this._editConnects,function(a){c.disconnect(a)});this._editConnects=[];this._thumbnailPath.value="";this._editConnects.push(c.connect(this._thumbnail,
"onclick",this,"_showThumbnailDialog"));this._editConnects.push(c.connect(this._thumbnailDelete,"onclick",this,"_deleteThumbnail"));this._editConnects.push(c.connect(c.byId("group-thumbnail-close"),"onclick",this,"_thumbnailCancel"));this._editConnects.push(c.connect(c.byId("group-thumbnail-ok"),"onclick",this,"_thumbnailOk"));this._editConnects.push(c.connect(c.byId("group-thumbnail-cancel"),"onclick",this,"_thumbnailCancel"))},startEdit:function(a){this._openEdit();c.connect(this._editDescription,
"onFocus",this,this._onDescriptionFocus);this._isNewAccount?(c.connect(this._editTitle,"onFocus",this,this._onTitleFocus),c.addClass(this._editTitle,"dim"),c.addClass(this._editDescription,"dim"),this._editTitle.set("value",this.i18n.defaultTextTitle),this._editDescription.set("value",this.i18n.defaultTextDescription),c.attr(this._thumbnail,"src",this._util.relativeToExplicitUrl("images/group-thumbnail.png")),c.style(this._changeThumbLabel,"display","none")):(this._editTitle.set("value",this._organization.name),
this._organization&&esri.isDefined(this._organization.description)&&""!==this.removeHTMLBreak(this._organization.description)?this._editDescription.set("value",this._organization.description):this._editDescription.set("value",this.i18n.defaultTextDescription));this._allowComments.set("checked",this._organization.commentsEnabled);this._useStdSQL.set("checked",this._organization.useStandardizedQuery);this._shareToPublic.set("checked",this._organization.canSharePublic);this._searchPublic.set("checked",
this._organization.canSearchPublic);this._allSSL.set("checked",this._organization.allSSL);this._anonAccess.set("checked","public"===this._organization.access?!0:!1)},cancelEdit:function(){this._newThumbKey=null;this._rolesAPI.getRoles(1,100).then(c.hitch(this,function(a){a&&(!a.code&&a.roles)&&(this._customRoles=a.roles);this._retrieveRemainingRoles(a.roles.length,a.nextStart,a.total).then(c.hitch(this,function(){this._closeEdit()}))}),c.hitch(this,function(a){this._closeEdit()}))},_resetThumbnail:function(){this._deletingThumbnail=
!1;null===this._newThumbKey&&esri.isDefined(this._existingThumbKey)&&(this._organization.thumbnail=this._existingThumbKey,this._setOrganizationThumbnail())},saveEdit:function(){this.setSaving();var a=!1,b="",d=this._editTitle.getValue(),e=!1,f=!1;d?(d=c.trim(d),0<d.length?-1<d.indexOf("\x3c")||-1<d.indexOf("\x3e")||-1<d.indexOf("%")?(a=!0,b=this.i18n.orgName.invalidChars):55<d.length?(a=!0,b=this.i18n.orgName.tooLong):this.i18n.defaultTextTitle&&this.i18n.defaultTextTitle!==d&&(this._organization.name!==
d&&(e=!0),this._organization.name=this._editTitle.getValue()):(a=!0,b=this.i18n.orgName.isRequired)):(a=!0,b=this.i18n.orgName.isRequired);(f=this._editDescription.getValue())?(f=c.trim(f),0<f.length&&f!==this.i18n.defaultTextDescription?(f=f.replace(/"'/g,'"').replace(/'"/g,'"'),this._organization.description=f):this._organization.description="\x3cbr\x3e"):this._organization.description="\x3cbr\x3e";null===this._organization.localizedOrgProperties&&null!==this._currentLocalizedOrgProperties&&(this._organization.localizedOrgProperties=
this._currentLocalizedOrgProperties);d=this._orgSummary.get("value");f=this._organization.localizedOrgProperties&&this._organization.localizedOrgProperties["default"]?this._organization.localizedOrgProperties["default"].description:"";d?(d=this._util.stripHTML(d),d.length>this._organizationSummaryCount&&(d=d.substring(0,this._organizationSummaryCount)),f=d!==f):f=f&&0<f.length;e||f?(e&&(this._organization.localizedOrgProperties["default"].name=this._organization.name),f&&(this._organization.localizedOrgProperties["default"].description=
""===d?null:d)):this._organization.localizedOrgProperties=null;this._newSelectedCulture!==this._currentCulture&&(this._organization.culture=this._newSelectedCulture===this.browserDefault?"":this._newSelectedCulture);this._newSelectedRegion!==this._currentRegion&&(this._organization.region=this._newSelectedRegion);e=this._contactUsLink.get("value");this._contactUsVisible.get("checked")&&(!esri.isDefined(e)||0===e.length)?(a=!0,b=this.i18n.finishContactUsSetup):esri.isDefined(e)&&0<e.length?(0!==e.indexOf("http")&&
0!==e.indexOf("mailto:")&&0<e.indexOf("@")?e="mailto:"+e:0!==e.indexOf("http")&&(0>e.indexOf("mailto:")&&0>e.indexOf("@"))&&(e="http://"+e),this._organization.portalProperties.links.contactUs={url:e,visible:!!this._contactUsVisible.get("checked")}):delete this._organization.portalProperties.links.contactUs;esriGeowConfig.metadataEnabled&&(this._organization.metadataEditable=this._enableMetadata.get("checked"),this._organization.metadataFormats=[],this._metadataFGDCOption.get("checked")?this._organization.metadataFormats.push(this.formatFGDC):
this._metadataINSPIREOption.get("checked")?this._organization.metadataFormats.push(this.formatINSPIRE):this._metadataISO19139Option.get("checked")?this._organization.metadataFormats.push(this.formatISO19139):this._metadataISO19115Option.get("checked")?this._organization.metadataFormats.push(this.formatISO19115):this._organization.metadataFormats.push(this.formatISO1913932));if(esriGeowConfig.multiFactorEnabled&&!this._isSingleTenant&&!this._isDeveloperSubscription)if(this._mfaEnabled.get("checked"))if(!this._newMfaAdmins||
2>this._newMfaAdmins.length)a=!0,b=this._organization.mfaEnabled?this.i18n.securityTab.needTwoAdminUpdateMsg:this.i18n.securityTab.needTwoAdminMsg;else{this._organization.mfaEnabled=!0;this._organization.mfaAdmins=[];for(e=0;e<this._newMfaAdmins.length;e++)this._organization.mfaAdmins.push(this._newMfaAdmins[e].username)}else this._organization.mfaEnabled=!1,this._organization.mfaAdmins=[];if(!this._isSingleTenant&&(this._organization.contacts||(this._organization.contacts=[]),this._newAdminContacts)){this._organization.contacts=
[];for(e=0;e<this._newAdminContacts.length;e++)this._organization.contacts.push(this._newAdminContacts[e].username)}!this._isSingleTenant&&this._canListMarketplace&&(e=this._orgEmail.get("value"),f=this._orgUrl.get("value"),e&&(0<e.length&&!this._util.isValidEmailAddress(e))&&(a=!0,b=this.i18n.generalTab.invalidContactEmail),!a&&(f&&0<f.length&&!(0===f.indexOf("http")&&0<f.indexOf("://")))&&(a=!0,b=this.i18n.generalTab.invalidContactUrl));this._arcgisSignIn&&this._enterpriseSignIn&&(this._enterpriseSignIn.get("checked")?
this._organization.canSignInArcGIS=!1:this._organization.canSignInArcGIS=!0,this._organization.canSignInIDP=!0);this._useStdSQL&&(this._organization.useStandardizedQuery=this._useStdSQL.get("checked"));this._organization.showHomePageDescription=this._homePageDescription.get("checked");this._organization.commentsEnabled=this._allowComments.get("checked");this._organization.canSearchPublic=this._searchPublic.get("checked");this._organization.canSharePublic=this._shareToPublic.get("checked");this._newSelectedGallery&&
(this._organization.featuredGroupsId=this._newSelectedGallery.group,this._organization.featuredItemsGroupQuery=this._newSelectedGallery.group===this.mostViewedItemsValue?"":"id:"+this._newSelectedGallery.group);this._unitsSelect.get("value")===this.i18n.mapTab.unitsMetric?this._organization.units=this.unitsMetric:this._organization.units=this.unitsEnglish;a?(this._generalDlg.show({title:this.i18n.noticeLabel,message:b}),this.unsetSaving()):(this._isNewAccount=!1,this.setLoading(),""!==this._thumbnailPath.value?
(this._existingThumbKey=this._organization.thumbnail,this._organization.thumbnail=this._newThumbKey,this._addResource()):(this._deletingThumbnail&&(null==this._newThumbKey&&esri.isDefined(this._existingThumbKey))&&(this._organization.thumbnail="",this._removeResource(this._existingThumbKey)),this._updateAccountSettings()))},_initOrgPropertiesSetting:function(){esri.isDefined(this._organization.portalProperties)||(this._organization.portalProperties={});esri.isDefined(this._organization.portalProperties.links)||
(this._organization.portalProperties.links={})},_getPredefinedBannerColor:function(a){var b="";this.predefinedBanner1Id===a||this.predefinedBanner3Id===a||this.predefinedBanner5Id===a?b="color:#fff;":this.predefinedBanner2Id===a?b="color:#369;":this.predefinedBanner4Id===a&&(b="color:#036;");return b},_updateAccountSettings:function(){var a=c.hitch(this,function(a){this._isSingleTenant&&esriGeowConfig.federatedServerConfigEnabled&&esriGeowConfig.hostedServerConfigEnabled?this._updateHostedServerSetting().then(c.hitch(this,
this._updateGroupSettings),c.hitch(this,this._updateGroupSettings)):this._updateGroupSettings()});if(this._isSingleTenant)this._addLocalizedOrgPropertiesResource().then(a,a);else{var b=c.hitch(this,function(){this._addLocalizedOrgPropertiesResource().then(a,a)});this._updateOrgContactInfo().then(b,b)}},_updateHostedServerSetting:function(){var a=new c.Deferred,b;this._isSingleTenant&&esriGeowConfig.federatedServerConfigEnabled&&esriGeowConfig.hostedServerConfigEnabled?this._currentHostedServer&&0!==
this._currentHostedServer.id&&(null===this._newHostedServer||this._newHostedServer&&this._newHostedServer.id&&this._newHostedServer.id!=this._currentHostedServer.id)?this._unhostCurrentHostedServer().then(c.hitch(this,function(d){this._newHostedServer&&this._newHostedServer.id&&0!==this._newHostedServer.id&&this._newHostedServer.id!=d.serverId?this._setNewHostedServer().then(c.hitch(this,function(){this._configureHostedServices();a.resolve()}),c.hitch(this,function(c){b=esri.substitute({name:this._newHostedServer.name},
this.i18n.serversTab.hostedServerError);c.message&&(b+="\x3cp\x3e"+c.message+"\x3c/p\x3e");this._generalDlg.show({title:this.i18n.errorTitle,message:b});a.reject()})):(this._removeHostedServices(),a.resolve())}),c.hitch(this,function(b){a.reject()})):this._newHostedServer&&this._newHostedServer.id&&0!==this._newHostedServer.id?this._setNewHostedServer().then(c.hitch(this,function(){this._configureHostedServices();a.resolve()}),c.hitch(this,function(c){b=esri.substitute({name:this._newHostedServer.name},
this.i18n.serversTab.hostedServerError);c.message&&(b+="\x3cp\x3e"+c.message+"\x3c/p\x3e");this._generalDlg.show({title:this.i18n.errorTitle,message:b});a.reject()})):a.resolve():a.resolve();return a},_removeHostedServices:function(){this._newAnalysisService={}},_configureHostedServices:function(){var a=0<this._organization.helperServices.printTask.url.indexOf("/sharing/tools/newPrint"),b=esri.isDefined(this._newHostedServer)&&esri.isDefined(this._newHostedServer.url)&&(!this._currentHostedServer||
0===this._currentHostedServer.id),c=esri.isDefined(this._newHostedServer)&&esri.isDefined(this._newHostedServer.url)&&this._currentHostedServer&&this._currentHostedServer.id!==this._newHostedServer.id;if(b||c)if(b){if(a&&(this._newPrintingService={url:this._generateHostedServerPrintURL(this._newHostedServer)},this._mustStartPrintingService={startUrl:this._generateHostedServerAdminPrintURL(this._newHostedServer,this._newPrintingService.url)}),!esri.isDefined(this._organization.helperServices.analysis)||
!esri.isDefined(this._organization.helperServices.analysis.url)||0===this._organization.helperServices.analysis.url.length)this._newAnalysisService={url:this._generateHostedServerAnalysisURL(this._newHostedServer)}}else if(c){b=this._generateHostedServerPrintURL(this._currentHostedServer);if(a=a||this._organization.helperServices.printTask.url===b)this._newPrintingService={url:this._generateHostedServerPrintURL(this._newHostedServer)},this._mustStartPrintingService={startUrl:this._generateHostedServerAdminPrintURL(this._newHostedServer,
this._newPrintingService.url)};if(!esri.isDefined(this._organization.helperServices.analysis)||!esri.isDefined(this._organization.helperServices.analysis.url)||0===this._organization.helperServices.analysis.url.length||0<this._organization.helperServices.analysis.url.length&&(-1<this._organization.helperServices.analysis.url.indexOf(this._currentHostedServer.url)||-1<this._organization.helperServices.analysis.url.indexOf(this._currentHostedServer.adminUrl)))this._newAnalysisService={url:this._generateHostedServerAnalysisURL(this._newHostedServer)}}},
_generateHostedServerAnalysisURL:function(a){return a.url+"/rest/services/System/SpatialAnalysisTools/GPServer"},_generateHostedServerPrintURL:function(a){return a.url+"/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task"},_generateHostedServerAdminAnalysisStartURL:function(a,b){return b.replace(a.url,a.adminUrl).replace("/rest/","/admin/").replace("/GPServer",".GPServer")+"/start"},_generateHostedServerAdminPrintURL:function(a,b){return b.replace(a.url,a.adminUrl).replace("/rest/",
"/admin/").replace("/GPServer/",".GPServer/").replace("/Export%20Web%20Map%20Task","/start")},_startPrintingService:function(){var a=new c.Deferred;this._util.request({url:this._mustStartPrintingService.startUrl,content:{f:"json",token:this._user.token}},{usePost:!0}).then(c.hitch(this,function(){this._mustStartPrintingService=null;a.resolve()}),c.hitch(this,function(){this._mustStartPrintingService=null;a.resolve()}));return a},_startAnalysisService:function(){var a=new c.Deferred;this._util.request({url:this._mustStartAnalysisService.startUrl,
content:{f:"json",token:this._user.token}},{usePost:!0}).then(c.hitch(this,function(){this._mustStartAnalysisService=null;a.resolve()}),c.hitch(this,function(){this._mustStartAnalysisService=null;a.resolve()}));return a},_setNewHostedServer:function(){var a=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))+"/portaladmin/federation/servers/"+this._newHostedServer.id+"/update";return this._util.request({url:a,content:{isHosted:!0}},{usePost:!0})},_unhostCurrentHostedServer:function(){var a=
esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))+"/portaladmin/federation/servers/"+this._currentHostedServer.id+"/update";return this._util.request({url:a,content:{isHosted:!1}},{usePost:!0})},_removeFederatedServer:function(a){var b=new c.Deferred;a=this._federatedServers.current[a];a=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))+"/portaladmin/federation/servers/"+a.id+"/unfederate?culture\x3d"+c.locale;this._util.request({url:a},{usePost:!0}).then(c.hitch(this,
function(a){b.resolve()}),c.hitch(this,function(a){b.reject(c.mixin({failure:"unfederateServer"},a))}));return b},_registerProxyRule:function(a){esri.addProxyRule({urlPrefix:a,proxyUrl:esriGeowConfig.proxyServer})},_unregisterProxyRule:function(a){if(esri.isDefined(a)){var b=esri.config.defaults.io.proxyRules;a=esri.getProxyRule(a);esri.isDefined(b)&&esri.isDefined(a)&&(a=c.indexOf(b,a),-1!==a&&b.splice(a,1))}},_updateGroupSettings:function(){this._validateSortingProperties()?this._updateGroupProperties().then(c.hitch(this,
this._updateOrganizationSettings),c.hitch(this,this._updateOrganizationSettings)):(this._generalDlg.show({title:this.i18n.noticeLabel,message:"\x3cp\x3e"+this.i18n.oneGroupMultipleSortProperties+"\x3c/p\x3e\x3cp\x3e"+this.i18n.pleaseCorrectSortProperties+"\x3c/p\x3e"}),this.unsetLoading(),this.unsetSaving())},_updateOrganizationSettings:function(){var a=this;a._saveUpdatedGroupSortPropertiesLocally();a._updateSecuritySettings();a._updateBackgroundSetting();a._updateRotatorPanelsSetting();a._updateFeaturedGroupsSetting();
a._updateHomePageFeaturedSetting();a._updateTemplatesGroupQuerySetting();a._updateGalleryAppsGroupQuerySetting();a._updatePrintServerSetting();a._updateGeocodeServersSetting();a._updateGeometryServerSetting();a._updateRoutingServerSetting();a._updateBingMapsKeySetting();a._updateBasemapGalleryGroupQuerySetting();a._updateSecuredHostsSetting();this._util.isPortal()&&(a._updateGeoEnrichServerSetting(),a._updateHydrologyServerSetting(),a._updateElevationServerSetting(),a._updateNetworkServerSetting());
a._updateNetworkServerTravelModes().then(function(){a._updateDefaultBasemapSetting()})},_updateGroupProperties:function(){var a=new c.Deferred;this._updatedGroups={};var b=[],d=this._updateGroupSortProperties(this._homePageFeaturedSelect,this._getHomePageFeaturedSortingProperties()),e=this._updateGroupSortProperties(this._basemapGallerySelect,this._getBasemapGallerySortingProperties()),f=this._updateGroupSortProperties(this._templatesSelect,this._getTemplatesSortingProperties()),g=this._updateGroupSortProperties(this._galleryAppsSelect,
this._getGalleryAppsSortProps()),h=this._updateGroupSortProperties(this._gallerySelect,this._getGallerySortProps());d&&b.push(d);e&&b.push(e);f&&b.push(f);g&&b.push(g);h&&b.push(h);this._addEsriBasemaps.get("checked")&&b.push(this._shareEsriBasemaps());this._addEsriWebAppTemplates.get("checked")&&b.push(this._shareEsriWebAppTemplates());this._addEsriGalleryAppTemplates.get("checked")&&b.push(this._shareEsriGalleryAppTemplates());(new c.DeferredList(b)).then(c.hitch(this,function(b){a.resolve()}),
c.hitch(this,function(b){console.log(b);a.reject()}));return a},_saveUpdatedGroupSortPropertiesLocally:function(){for(var a=0;a<this._allGroups.length;a++){var b=this._allGroups[a].id;if(this._updatedGroups[b]&&this._updatedGroups[b].id){this._allGroups[a].group.sortField=this._updatedGroups[b].sortProps.field;this._allGroups[a].group.sortOrder=this._updatedGroups[b].sortProps.order;for(var a=this._updatedGroups[b].sortProps.uiOrigin.split(","),d=0;d<a.length;d++){var e,f=a[d];"gallery"===f?e=this._gallerySelect.get("store"):
"galleryApps"===f?e=this._galleryAppsSelect.get("store"):"templates"===f?e=this._templatesSelect.get("store"):"basemapGallery"===f?e=this._basemapGallerySelect.get("store"):"homePageFeatured"===f&&(e=this._homePageFeaturedSelect.get("store"));e&&e.fetch({onComplete:c.hitch(this,function(a){for(var c=0;c<a.length;c++){var d=a[c];if(e.getValue(d,"id")==this._updatedGroups[b].id){a="gallery"===f?e.getValue(d,"groupObj"):e.getValue(d,"group");a.group.sortField=this._updatedGroups[b].sortProps.field;a.group.sortOrder=
this._updatedGroups[b].sortProps.order;e.setValue(d,"gallery"===f?"groupObj":"group",a);break}}e.save()})})}break}}},_getGallerySortProps:function(){return this._getSortProperties(this._gallerySortBySelect,this._gallerySortByCheckBox,"gallery")},_getGalleryAppsSortProps:function(){return this._getSortProperties(this._galleryAppsSortBySelect,this._galleryAppsSortByCheckBox,"galleryApps")},_getTemplatesSortingProperties:function(){return this._getSortProperties(this._templatesSortBySelect,this._templatesSortByCheckBox,
"templates")},_getBasemapGallerySortingProperties:function(){return this._getSortProperties(this._basemapSortBySelect,this._basemapSortByCheckBox,"basemapGallery")},_getHomePageFeaturedSortingProperties:function(){return this._getSortProperties(this._homePageSortBySelect,this._homePageSortByCheckBox,"homePageFeatured")},_normalizeSortField:function(a){for(var b=this._getSortByData(),c=0;c<b.length;c++)if(b[c].name===a)return b[c].id;return a},_normalizeSortOrder:function(a){return a?"asc":"desc"},
_getSortProperties:function(a,b,c){return{field:this._normalizeSortField(a.get("value")),order:this._normalizeSortOrder(b.get("checked")),uiOrigin:c}},_matchSortProperties:function(a,b){return b.field===a.field&&b.order===a.order},_validateGroupSortingProperties:function(a,b,c){var e=!0;a[b.id]?e=this._matchSortProperties(a[b.id],c):a[b.id]=c;return e},_validateSortingProperties:function(){var a=[],b={},d=this._homePageFeaturedSelect.get("item");d&&(d.group&&d.group[0]&&d.group[0].group)&&(d=this._validateGroupSortingProperties(b,
d.group[0].group,this._getHomePageFeaturedSortingProperties()),a.push(d));if((d=this._basemapGallerySelect.get("item"))&&d.group&&d.group[0]&&d.group[0].group)d=this._validateGroupSortingProperties(b,d.group[0].group,this._getBasemapGallerySortingProperties()),a.push(d);if((d=this._templatesSelect.get("item"))&&d.group&&d.group[0]&&d.group[0].group)d=this._validateGroupSortingProperties(b,d.group[0].group,this._getTemplatesSortingProperties()),a.push(d);if((d=this._galleryAppsSelect.get("item"))&&
d.group&&d.group[0]&&d.group[0].group)d=this._validateGroupSortingProperties(b,d.group[0].group,this._getGalleryAppsSortProps()),a.push(d);if((d=this._gallerySelect.get("item"))&&d.groupObj&&d.groupObj[0]&&d.groupObj[0].group)b=this._validateGroupSortingProperties(b,d.groupObj[0].group,this._getGallerySortProps()),a.push(b);return-1===c.indexOf(a,!1)},_updateGroupSortProperties:function(a,b){var c=null,e=null,f=esriGeowConfig.restBaseUrl+"community/groups/${id}/update",g=a.get("item");g&&(g.group&&
g.group[0]&&g.group[0].group?e=g.group[0].group.id:g.groupObj&&(g.groupObj[0]&&g.groupObj[0].group)&&(e=g.groupObj[0].group.id),e&&!this._updatedGroups[e]?(this._updatedGroups[e]={updated:!0,id:e,sortProps:b},f=esri.substitute({id:e},f),c=this._util.request({url:f,content:{sortField:b.field,sortOrder:b.order}},{usePost:!0})):this._updatedGroups[e]&&(this._updatedGroups[e].sortProps.uiOrigin+=","+b.uiOrigin));return c},_updateSecuritySettings:function(){var a=this._allSSL.get("checked");a!==this._organization.allSSL&&
(this._organization.allSSL=a,this._allSSLChanged=!0);this._organization.access=this._anonAccess.get("checked")?"public":"private"},_updateBackgroundSetting:function(){var a=this._bgRadioCustom.get("checked");this._newSelectedBackground!==this._currentSelectedBackground&&(a&&esri.isDefined(this._newCustomBackgroundKey)?this._organization.backgroundImage=this._newCustomBackgroundKey:this._newSelectedBackground===this.predefinedBackground1?this._organization.backgroundImage=this.predefinedBackground1:
this._newSelectedBackground===this.predefinedBackground2&&(this._organization.backgroundImage=this._newSelectedBackground))},_updateRotatorPanelsSetting:function(){var a=this._bannerHTMLSelect.get("checked"),b=this._bannerImageSelect.get("checked"),c=this._bannerRadioCustom.get("checked"),e=this._editHTMLBanner.get("value");e&&(e=this.removeSecurityToken(e));var f=!1,g=!1,h=!1;if(this._newSelectedRotatorPanelId!==this._currentSelectedRotatorPanelId)a?h=!0:b&&(f=!0,c&&(this._newCustomBannerKey?g=!0:
f=g=!1));else if(a)e!==this._currentRotatorPanels[0].innerHTML&&(h=!0);else if(c&&this._newCustomBannerKey)g=f=!0;else if(a=this._currentSelectedRotatorPanelId,a===this.predefinedBanner1Id||a===this.predefinedBanner2Id||a===this.predefinedBanner3Id||a===this.predefinedBanner4Id||a===this.predefinedBanner5Id)f=!0;h?this._organization.rotatorPanels=[{id:this.htmlBannerId,innerHTML:arcgisonline.sharing.dijit.Organization.util.escapeQuotes(e)}]:this._deletingThumbnail||f?(e=esriGeowConfig.restBaseUrl,
this._organization.urlKey&&this._organization.customBaseUrl&&(f=this._organization.urlKey.toLowerCase()+"."+this._organization.customBaseUrl,window.location.host!==f&&(e=e.replace(this._organization.portalHostname,f))),h=e+"portals/self/resources/",h=this._newThumbKey?h+this._newThumbKey:this._existingThumbKey?h+this._existingThumbKey:this._organization.thumbnail&&0<this._organization.thumbnail.length?h+this._organization.thumbnail:null,this._deletingThumbnail&&(h=null),h&&(h+="?token\x3dSECURITY_TOKEN"),
a=null,f="",g?(a=this.customBannerId,f="\x3cimg src\x3d'"+(e+"portals/self/resources/"+this._newCustomBannerKey+"?token\x3dSECURITY_TOKEN")+"' style\x3d'-webkit-border-radius:0 0 10px 10px; -moz-border-radius:0 0 10px 10px; -o-border-radius:0 0 10px 10px; border-radius:0 0 10px 10px; margin-top:0; width:960px;'/\x3e"):this._selectedBannerRadioButton&&(a=this._selectedBannerRadioButton.value,f="\x3cimg src\x3d'"+("images/"+a+".jpg")+"' style\x3d'-webkit-border-radius:0 0 10px 10px; -moz-border-radius:0 0 10px 10px; -o-border-radius:0 0 10px 10px; border-radius:0 0 10px 10px; margin-top:0; width:960px; height:180px;'/\x3e",
f=esriGeowConfig.isRightToLeft?f+"\x3cdiv style\x3d'position:absolute; bottom:80px; right:80px; max-height:65px; width:660px; margin:0;'\x3e":f+"\x3cdiv style\x3d'position:absolute; bottom:80px; left:80px; max-height:65px; width:660px; margin:0;'\x3e",h&&(f+="\x3cimg src\x3d'"+h+"' alt\x3d'"+this._organization.name+"'  class\x3d'esriFloatLeading esriTrailingMargin025' style\x3d'margin-bottom:0; max-height:100px;'/\x3e"),f+="\x3cspan style\x3d'position:absolute; bottom:0; margin-bottom:0; line-height:normal; font-family:HelveticaNeue,Verdana; font-weight:600; font-size:32px; "+
this._getPredefinedBannerColor(a)+"'\x3e"+this._organization.name+"\x3c/span\x3e",f+="\x3c/div\x3e"),this._organization.rotatorPanels=[{id:a,innerHTML:f}]):(this._allSSLChanged&&(this._currentUnparsedRotatorPanels&&1===this._currentUnparsedRotatorPanels.length)&&(this._currentUnparsedRotatorPanels[0]&&this._currentUnparsedRotatorPanels.id)&&(g=this._allSSL.get("checked"),f=this._currentUnparsedRotatorPanels[0].innerHTML,f=g?f.replace("http:","https:"):f.replace("https:","http:"),this._currentUnparsedRotatorPanels[0].innerHTML=
f),this._currentUnparsedRotatorPanels&&this._currentUnparsedRotatorPanels[0]&&this._currentUnparsedRotatorPanels[0].id?(g=this._currentUnparsedRotatorPanels[0].id,e=this.removeSecurityToken(this._currentUnparsedRotatorPanels[0].innerHTML),this._organization.rotatorPanels=[{id:g,innerHTML:e}]):this._organization.rotatorPanels=this._currentUnparsedRotatorPanels)},_updateFeaturedGroupsSetting:function(){this._organization.featuredGroups=this._newFeaturedGroups&&0<this._newFeaturedGroups.length?this._newFeaturedGroups:
[]},_updateHomePageFeaturedSetting:function(){this._organization.homePageFeaturedContentCount=this._homePageFeaturedCountSelect.get("value");this._organization.homePageFeaturedContentCount===this.i18n.homeTab.allOption&&(this._organization.homePageFeaturedContentCount=0);this._newSelectedHomePageFeatured&&(this._newSelectedHomePageFeatured===this.i18n.noFeaturedContent?(this._organization.homePageFeaturedContent="",this._organization.homePageFeaturedContentCount=this.homePageFeaturedCountDefault):
this._organization.homePageFeaturedContent=this._newSelectedHomePageFeaturedQuery)},_updateGalleryAppsGroupQuerySetting:function(){this._newSelectedGalleryAppsGroup&&this._newSelectedGalleryAppsGroupQuery!==this._currentGalleryAppsGroupQuery?this._organization.galleryTemplatesGroupQuery=this._newSelectedGalleryAppsGroup===this.i18n.defaultEsriSelection?"":this._newSelectedGalleryAppsGroupQuery:!this._newSelectedGalleryAppsGroup&&(!this._newSelectedGalleryAppsGroupQuery&&this._galleryAppsSelect.get("displayedValue")===
this.i18n.defaultEsriSelection)&&(this._organization.galleryTemplatesGroupQuery="")},_updateTemplatesGroupQuerySetting:function(){this._newSelectedTemplates&&this._newSelectedTemplatesQuery!==this._currentTemplatesGroupQuery?this._organization.templatesGroupQuery=this._newSelectedTemplates===this.i18n.defaultEsriSelection?"":this._newSelectedTemplatesQuery:!this._newSelectedTemplates&&(!this._newSelectedTemplatesQuery&&this._templatesSelect.get("displayedValue")===this.i18n.defaultEsriSelection)&&
(this._organization.templatesGroupQuery="")},_updateBasemapGalleryGroupQuerySetting:function(){this._newSelectedBasemapGallery&&this._newSelectedBasemapGalleryQuery!==this._currentBasemapGalleryGroupQuery?this._organization.basemapGalleryGroupQuery=this._newSelectedBasemapGallery===this.i18n.defaultEsriSelection?"":this._newSelectedBasemapGalleryQuery:!this._newSelectedBasemapGallery&&(!this._newSelectedBasemapGalleryQuery&&this._basemapGallerySelect.get("displayedValue")===this.i18n.defaultEsriSelection)&&
(this._organization.basemapGalleryGroupQuery="")},_updateSecuredHostsSetting:function(){this._organization.authorizedCrossOriginDomains=this._securedHosts.get("hosts")||[]},_updateAnalysisServerSetting:function(){this._util.isPortal()&&(esri.isDefined(this._newAnalysisService)&&esri.isDefined(this._newAnalysisService.url)?this._organization.helperServices.analysis=this._newAnalysisService:esri.isDefined(this._newAnalysisService)&&!0===this._newAnalysisService.removeService?this._organization.helperServices.analysis=
"":esri.isDefined(this._newAnalysisService)&&!esri.isDefined(this._newAnalysisService.url)&&(this._organization.helperServices.analysis=""))},_updatePrintServerSetting:function(){esri.isDefined(this._newPrintingService)&&(""===this._newPrintingService||!esri.isDefined(this._currentPrintingService)||esri.isDefined(this._newPrintingService.url)&&esri.isDefined(this._currentPrintingService)&&this._newPrintingService.url!==this._currentPrintingService.url)?this._organization.helperServices.printTask=
""===this._newPrintingService?"":this._newPrintingService:!this._isSingleTenant&&(null===this._newPrintingService&&esri.isDefined(this._currentPrintingService)&&esri.isDefined(this._selfNoAuth)&&this._currentPrintingService.url===this._selfNoAuth.helperServices.printTask.url)&&(this._organization.helperServices.printTask="");if(esri.isDefined(this._organization.helperServices.printTask)&&""!==this._organization.helperServices.printTask&&!this._isEsriDefaultPrintService(this._organization.helperServices.printTask.url)&&
this._printTemplates){var a=this._printTemplates.get("templates");0<a.length&&(this._organization.helperServices.printTask.templates=a)}},_updateGeometryServerSetting:function(){esri.isDefined(this._newGeometryService)&&(""===this._newGeometryService||!esri.isDefined(this._currentGeometryService)||esri.isDefined(this._newGeometryService.url)&&esri.isDefined(this._currentGeometryService)&&this._newGeometryService.url!==this._currentGeometryService.url)?this._organization.helperServices.geometry=""===
this._newGeometryService?"":this._newGeometryService:!this._isSingleTenant&&(null===this._newGeometryService&&esri.isDefined(this._currentGeometryService)&&esri.isDefined(this._selfNoAuth)&&this._currentGeometryService.url===this._selfNoAuth.helperServices.geometry.url)&&(this._organization.helperServices.geometry="")},_updateNetworkServerTravelModes:function(){var a=this,b=new c.Deferred,d="route asyncRoute closestFacility asyncClosestFacility serviceArea asyncServiceArea syncVRP asyncVRP asyncLocationAllocation".split(" "),
e,f,g,h;a._travelModes?a._travelModes.getDefaultTravelModeId().then(function(c){if(esri.isDefined(c))for(h=0;h<d.length;h++)if(e=d[h],f=(g=a._organization.helperServices[e])&&g.url?g.url.toLowerCase():"",g&&(-1<f.indexOf("logistics")||-1<f.indexOf("route"))&&-1<g.url.toLowerCase().indexOf(".arcgis.com/"))g.defaultTravelMode=c;b.resolve()},function(a){console.log("error determining default travel mode",a);b.resolve()}):b.resolve();return b.promise},_updateElevationServerSetting:function(){var a,b,
c;if(this._isSingleTenant&&esri.isDefined(this._newElevationServices))for(a in this._newElevationServices)if(this._newElevationServices.hasOwnProperty(a)&&(b=this._newElevationServices[a],c=this._currentElevationServices[a],esri.isDefined(b)&&(""===b||""===b.url||!esri.isDefined(c)||esri.isDefined(b.url)&&esri.isDefined(c)&&b.url!==c.url)))this._organization.helperServices[a]=""===b||""===b.url?"":b},_updateNetworkServerSetting:function(){var a,b,c;if(this._isSingleTenant&&esri.isDefined(this._newNetworkServices))for(a in this._newNetworkServices)if(this._newNetworkServices.hasOwnProperty(a)&&
(b=this._newNetworkServices[a],c=this._currentNetworkServices[a],esri.isDefined(b)&&(""===b||""===b.url||!esri.isDefined(c)||esri.isDefined(b.url)&&esri.isDefined(c)&&b.url!==c.url)))this._organization.helperServices[a]=""===b||""===b.url?"":b},_updateGeoEnrichServerSetting:function(){this._isSingleTenant&&(esri.isDefined(this._newGeoEnrichService)&&(""===this._newGeoEnrichService||""===this._newGeoEnrichService.url||!esri.isDefined(this._currentGeoEnrichService)||esri.isDefined(this._newGeoEnrichService.url)&&
esri.isDefined(this._currentGeoEnrichService)&&this._newGeoEnrichService.url!==this._currentGeoEnrichService.url)?this._organization.helperServices.geoenrichment=""===this._newGeoEnrichService||""===this._newGeoEnrichService.url?"":this._newGeoEnrichService:!this._isSingleTenant&&(null===this._newGeoEnrichService&&esri.isDefined(this._currentGeoEnrichService)&&esri.isDefined(this._selfNoAuth)&&this._currentGeoEnrichService.url===this._selfNoAuth.helperServices.geoenrichment.url)&&(this._organization.helperServices.geoenrichment=
""))},_updateHydrologyServerSetting:function(){this._isSingleTenant&&(esri.isDefined(this._newHydrologyService)&&(""===this._newHydrologyService||""===this._newHydrologyService.url||!esri.isDefined(this._currentHydrologyService)||esri.isDefined(this._newHydrologyService.url)&&esri.isDefined(this._currentHydrologyService)&&this._newHydrologyService.url!==this._currentHydrologyService.url)?this._organization.helperServices.hydrology=""===this._newHydrologyService||""===this._newHydrologyService.url?
"":this._newHydrologyService:!this._isSingleTenant&&(null===this._newHydrologyService&&esri.isDefined(this._currentHydrologyService)&&esri.isDefined(this._selfNoAuth)&&this._currentHydrologyService.url===this._selfNoAuth.helperServices.hydrology.url)&&(this._organization.helperServices.hydrology=""))},_updateRoutingServerSetting:function(){esri.isDefined(this._newRoutingService)&&(""===this._newRoutingService||""===this._newRoutingService.url||!esri.isDefined(this._currentRoutingService)||esri.isDefined(this._newRoutingService.url)&&
esri.isDefined(this._currentRoutingService)&&this._newRoutingService.url!==this._currentRoutingService.url)?this._organization.helperServices.route=""===this._newRoutingService||""===this._newRoutingService.url?this._isSingleTenant?"":c.clone(this._selfNoAuth.helperServices.route):this._newRoutingService:!this._isSingleTenant&&(null===this._newRoutingService&&esri.isDefined(this._currentRoutingService)&&esri.isDefined(this._selfNoAuth)&&this._currentRoutingService.url===this._selfNoAuth.helperServices.route.url)&&
(this._organization.helperServices.route=c.clone(this._selfNoAuth.helperServices.route))},_updateGeocodeServersSetting:function(){for(var a=[],b,d=this._geocodersGrid.store.query(),e=!1,f=!1,g=0;g<d.length;g++)b=c.clone(d[g]),a.push(b),!b.esri&&!b.zoomScale&&(b.zoomScale=1E4),b.esri?(f=e=!0,b.suggest=!0,delete b.esri):esri.isDefined(b.placefinding)&&!0===b.placefinding&&(f=!0),delete b.id;0<a.length&&(!e&&!f)&&(a[0].placefinding=!0);this._organization.helperServices.geocode=0<a.length?a:""},_updateBingMapsKeySetting:function(){esri.isDefined(this._newBingKey)&&
this._newBingKey!==this._currentBingKey&&(this._organization.bingKey=this._newBingKey);this._organization.canShareBingPublic=this._shareBingKey.get("checked");if("public"!==this._organization.access||!esri.isDefined(this._organization.bingKey)||0===this._organization.bingKey.length)this._organization.canShareBingPublic=!1},_updateDefaultBasemapSetting:function(){if(this._newSelectedBasemapId&&(this._newSelectedBasemapId!==this._currentDefaultBasemapId||this._newSelectedBasemapName!==this._currentDefaultBasemap))"0"===
this._newSelectedBasemapId?(this._organization.defaultBasemap=null,this._updateDefaultExtentSetting(new esri.SpatialReference({wkid:102100}))):this._content.getItem(this._newSelectedBasemapId,c.hitch(this,this._handleLoadBasemapInfo),c.hitch(this,this._handleLoadBasemapError));else if(!this._newSelectedBasemapId&&!this._newSelectedBasemapName&&this._defaultBasemapSelect.get("displayedValue")===this.i18n.defaultEsriSelection)this._organization.defaultBasemap=null,this._updateDefaultExtentSetting(new esri.SpatialReference({wkid:102100}));
else if(this._organization.defaultBasemap&&this._organization.defaultBasemap.baseMapLayers&&0<this._organization.defaultBasemap.baseMapLayers.length&&this._organization.defaultBasemap.baseMapLayers[0].resourceInfo&&this._organization.defaultBasemap.baseMapLayers[0].resourceInfo.spatialReference){var a=new esri.SpatialReference(this._organization.defaultBasemap.baseMapLayers[0].resourceInfo.spatialReference);this._updateDefaultExtentSetting(a)}else this._updateDefaultExtentSetting(new esri.SpatialReference({wkid:102100}))},
_shareGroupContentsWithGroup:function(a,b){var d=new c.Deferred;this._util.request({url:esriGeowConfig.restBaseUrl+"content/groups/"+a}).then(c.hitch(this,function(a){if(a&&a.items&&0<a.items.length){for(var f,g=[],h=0;h<a.items.length;h++)f=a.items[h],f=this._util.request({url:esriGeowConfig.restBaseUrl+"content/items/"+f.id+"/share",content:{groups:b}},{usePost:!0}),g.push(f);0<g.length?(new c.DeferredList(g)).then(c.hitch(this,function(a){d.resolve()}),c.hitch(this,function(a){d.resolve()})):d.resolve()}else d.resolve()}),
c.hitch(this,function(a){d.resolve()}));return d},_findGroupId:function(a){return this._util.request({url:esriGeowConfig.restBaseUrl+"community/groups?q\x3d"+a})},_shareEsriGalleryAppTemplates:function(){var a=new c.Deferred;if(this._newSelectedGalleryAppsGroup&&this._galleryAppsSelect.item&&this._galleryAppsSelect.item.group&&this._galleryAppsSelect.item.group[0]){var b=this._galleryAppsSelect.item.group[0].id,d;d=this._util.isPortal()?'title:"Gallery Templates" AND owner:esri_'+this._organization.culture:
this._selfNoAuth.galleryTemplatesGroupQuery;this._findGroupId(d).then(c.hitch(this,function(d){d&&d.results&&1===d.results.length&&d.results[0]?this._shareGroupContentsWithGroup(d.results[0].id,b).then(c.hitch(this,function(b){a.resolve()}),c.hitch(this,function(b){a.resolve()})):a.resolve()}),c.hitch(this,function(b){a.resolve()}))}else a.resolve();return a},_shareEsriWebAppTemplates:function(){var a=new c.Deferred;if(this._newSelectedTemplates&&this._templatesSelect.item&&this._templatesSelect.item.group&&
this._templatesSelect.item.group[0]){var b=this._templatesSelect.item.group[0].id,d;d=this._util.isPortal()?'title:"Web Application Templates" AND owner:esri_'+this._organization.culture:this._selfNoAuth.templatesGroupQuery;this._findGroupId(d).then(c.hitch(this,function(d){d&&d.results&&1===d.results.length&&d.results[0]?this._shareGroupContentsWithGroup(d.results[0].id,b).then(c.hitch(this,function(b){a.resolve()}),c.hitch(this,function(b){a.resolve()})):a.resolve()}),c.hitch(this,function(b){a.resolve()}))}else a.resolve();
return a},_shareEsriBasemaps:function(){var a=new c.Deferred;if(this._newSelectedBasemapGallery&&this._basemapGallerySelect.item&&this._basemapGallerySelect.item.group&&this._basemapGallerySelect.item.group[0]){var b=this._basemapGallerySelect.item.group[0].id,d;d=this._util.isPortal()?'title:"ArcGIS Online Basemaps" AND owner:esri_'+this._organization.culture:this._selfNoAuth.basemapGalleryGroupQuery;this._findGroupId(d).then(c.hitch(this,function(d){d&&d.results&&1===d.results.length&&d.results[0]?
this._shareGroupContentsWithGroup(d.results[0].id,b).then(c.hitch(this,function(b){a.resolve()}),c.hitch(this,function(b){a.resolve()})):a.resolve()}),c.hitch(this,function(b){a.resolve()}))}else a.resolve();return a},_handleLoadBasemapError:function(a){console.log(a);this._uploadAccountSettings()},_handleLoadBasemapInfo:function(a){a?this._content.getItemData(a.id,c.hitch(this,this._handleLoadBasemapItemData,a),c.hitch(this,this._handleLoadBasemapItemData,a)):this._updateDefaultExtentSetting(new esri.SpatialReference({wkid:102100}))},
_handleLoadBasemapItemData:function(a,b){if(b)if(b.code&&b.message)this._updateDefaultExtentSetting(new esri.SpatialReference({wkid:102100}));else{var d={},e;d.id=a.id;d.title=a.title;d.baseMapLayers=b.baseMap&&b.baseMap.baseMapLayers?b.baseMap.baseMapLayers:[];d.operationalLayers=b.operationalLayers?b.operationalLayers:[];var f=c.hitch(this,function(a){if(a&&!a.code&&!a.message){d.baseMapLayers[0].resourceInfo=a;var b=esri.id.findCredential(esri.urlToObject(d.baseMapLayers[0].url).path);esri.isDefined(b)&&
(esri.isDefined(b.token)&&b.token!==this._util.getToken())&&delete d.baseMapLayers[0].resourceInfo;a=new esri.SpatialReference(a.spatialReference);this._organization.defaultBasemap=d;this._updateDefaultExtentSetting(a)}else this._updateDefaultExtentSetting(new esri.SpatialReference({wkid:102100}))});d.baseMapLayers&&d.baseMapLayers[0]&&(d.baseMapLayers[0].url||d.baseMapLayers[0].templateUrl)?(e=d.baseMapLayers[0],"WMS"===e.layerType||"WebTiledLayer"===e.type||"WebTiledLayer"===e.layerType?(e=b.spatialReference?
new esri.SpatialReference(b.spatialReference):d.baseMapLayers[0].fullExtent&&d.baseMapLayers[0].fullExtent.spatialReference?new esri.SpatialReference(d.baseMapLayers[0].fullExtent.spatialReference):new esri.SpatialReference({wkid:102100}),this._organization.defaultBasemap=d,this._updateDefaultExtentSetting(e)):this.getServiceInfo(e.url,f,f)):(this._organization.defaultBasemap=d,this._updateDefaultExtentSetting(new esri.SpatialReference({wkid:102100})))}else this._updateDefaultExtentSetting(new esri.SpatialReference({wkid:102100}))},
_updateDefaultExtentSetting:function(a){var b=c.hitch(this,function(a){a&&(!a.code&&!a.message&&0<a.length)&&(this._organization.defaultExtent=a[0]);this._uploadAccountSettings()}),d=new esri.SpatialReference(a);this._newSelectedDefaultExtent&&a?arcgisonline.map.main.doProject(this._newSelectedDefaultExtent,d,b,b):this._currentDefaultExtent&&a?arcgisonline.map.main.doProject(this._currentDefaultExtent,d,b,b):this._uploadAccountSettings()},_uploadAccountSettings:function(){this._updateAccount()},_handleUploadAccountSettings:function(a){a&&
(a.code&&a.message)&&console.log(a);this._updateAccount()},_updateAccount:function(){this._account.updateAccount(this._organization,c.hitch(this,this._handleSaveEdit),c.hitch(this,this._handleSaveEditError));this._setOrganizationNameDesc()},_addBackgroundResource:function(){this._util.postForm(this._bgThumbnailForm,esriGeowConfig.restBaseUrl+"portals/self/addResource",c.hitch(this,function(){this._handleCustomBackgroundAdded()}),c.hitch(this,function(){this._handleCustomBackgroundFailed()}))},_addBannerResource:function(){this._util.postForm(this._bannerThumbnailForm,
esriGeowConfig.restBaseUrl+"portals/self/addResource",c.hitch(this,function(){this._handleCustomBannerAdded()}),c.hitch(this,function(){this._handleCustomBannerFailed()}))},_addResource:function(){this._util.postForm(this._thumbnailForm,esriGeowConfig.restBaseUrl+"portals/self/addResource",c.hitch(this,function(){this._handleResourceAdded()}),c.hitch(this,function(){this._handleResourceFailed()}))},_removeResource:function(a){return this._util.request({url:esriGeowConfig.restBaseUrl+"portals/self/removeResource",
content:{key:a}},{usePost:!0})},_mustUpdateOrgContactInfo:function(){var a=null,b=c.trim(this._orgEmail.get("value")),d=c.trim(this._orgUrl.get("value")),e=c.trim(this._orgPhone.get("value")),f=this._organization.orgEmail,g=this._organization.orgUrl,h=this._organization.orgPhone;if(this._canListMarketplace){if(esri.isDefined(b)&&(!esri.isDefined(f)||b!==f))a||(a={}),a.orgEmail=b;if(esri.isDefined(d)&&(!esri.isDefined(g)||d!==g))a||(a={}),a.orgUrl=d;if(esri.isDefined(e)&&(!esri.isDefined(h)||e!==h))a||
(a={}),a.orgPhone=e}return a},_updateOrgContactInfo:function(){var a=this._mustUpdateOrgContactInfo();if(a&&this._canListMarketplace){var b=this._util.getSecureUrl(esriGeowConfig.restBaseUrl)+"portals/self/addResource",a={key:"accountSettings",type:"text",text:c.json.stringify(a)};return this._util.request({url:b,content:a},{usePost:!0})}b=new c.Deferred;b.resolve();return b},_addLocalizedOrgPropertiesResource:function(){if(this._organization.localizedOrgProperties){var a=esriGeowConfig.restBaseUrl+
"portals/self/addResource",b=c.create("form",{method:"post",enctype:"multipart/form-data"});9>c.isIE&&(b.encoding="multipart/form-data");c.create("input",{name:"key",type:"text",value:this.localizedOrgPropsKey},b);c.create("input",{name:"text",type:"text",value:c.json.stringify(this._organization.localizedOrgProperties)},b);return this._util.request({url:a,form:b},{usePost:!0})}a=new c.Deferred;a.resolve();return a},_handleSaveEditError:function(){var a=this._generalDlg.onOkClick;this._generalDlg.onOkClick=
c.hitch(this,function(b){b.hide();this._handleResourceFailed();b.onOkClick=a},this._generalDlg);this._generalDlg.show({title:this.i18n.errorLabel,message:this.i18n.unableToSaveSettingsMsg})},_handleSaveEdit:function(){this._closeEdit();this._isSingleTenant&&this._mustStartPrintingService&&this._startPrintingService();this._isSingleTenant&&this._mustStartAnalysisService&&this._startAnalysisService();var a=arcgisonline.sharing.util.getCookie("esri_auth");a&&a.region!==this._organization.region&&(a.region=
this._organization.region,arcgisonline.sharing.geow.Geow.setAuthCookie(a));this._allAdmins=[];if(this._allSSLChanged){var a=this._allSSL.get("checked"),b=window.location.href,b=a?arcgisonline.sharing.util.getSecureUrl(b):arcgisonline.sharing.util.getHttpUrl(b);if(a)window.location=b;else{var d=this._generalDlg.onOkClick;this._generalDlg.onOkClick=c.hitch(this,function(){var a=arcgisonline.sharing.util.getSecureUrl()+esriGeowConfig.signin+"?returnUrl\x3d"+b;arcgisonline.sharing.geow.Geow.signout(a);
this._generalDlg.onOkClick=d});this._generalDlg.show({title:this.i18n.noticeLabel,message:this.i18n.securityTab.securityChanged})}}else esriGeowConfig.self=null,this._rolesAPI.getRoles(1,100).then(c.hitch(this,function(a){a&&(!a.code&&a.roles)&&(this._customRoles=a.roles);this._retrieveRemainingRoles(a.roles.length,a.nextStart,a.total).then(c.hitch(this,function(){this._account.getSelf(c.hitch(this,function(a){this._organization=c.clone(a);g.byId("header")._finishStartup(a);g.byId("footer").refresh();
this._checkSubscription();this._loadOrganizationResources();this._retrieveLocalizedOrgProperties();this._refreshUserGrids();this._replayLastSearch()}))}))}),c.hitch(this,function(a){this._account.getSelf(c.hitch(this,function(a){this._organization=c.clone(a);g.byId("header")._finishStartup(a);g.byId("footer").refresh();this._checkSubscription();this._loadOrganizationResources();this._retrieveLocalizedOrgProperties();this._refreshUserGrids();this._replayLastSearch()}))}))},_getSubscriptionExpiration:function(){var a=
{selector:"date",formatLength:"short"};if(c.locale)switch(c.locale){case "ko":a.datePattern="yyy. MM. dd";break;case "cs":case "de":case "lv":case "nb":case "ru":a.datePattern="dd.MM.yyy";break;case "nl":a.datePattern="dd-MM-yyy";break;case "es":case "da":case "he":case "it":case "pt-br":case "pt-pt":case "th":a.datePattern="dd/MM/yyy";break;case "en":a.datePattern="MM/dd/yyy";break;case "et":case "ja":a.formatLength="medium";break;case "lt":a.datePattern="yyy MM dd";break;case "zh-cn":a.datePattern=
"yyy-MM-dd"}return a},_checkSubscription:function(){if(!this._isSingleTenant&&this._organization.subscriptionInfo&&this._user.role&&this._isAdmin){var a=this._organization.subscriptionInfo.type,b=this._getSubscriptionExpiration(),b=esri.substitute({expires:(9>c.isIE?"\x3cbr\x3e":"")+c.date.locale.format(new Date(this._organization.subscriptionInfo.expDate),b)},this.i18n.subscriptionStatus.expires);c.attr(this._subscriptionExpiresDate,"innerHTML",b);(this._isDeveloperSubscription="trial developer"===
a.toLowerCase())&&c.style(this._subscriptionExpires,"display","none");if("active"===this._organization.subscriptionInfo.state){if("Trial"===a||"Trial Press"===a||"Evaluation"===a)this._upgradeSubscriptionButton.set("label",this.i18n.manageSubscriptionLabel),(9>c.has("ie")||5>c.has("trident"))&&c.addClass(this._upgradeSubscriptionButton.domNode,"ie8ButtonFontSize");c.style(this._upgradeSubscriptionButton.domNode,"display","")}else"Trial"===a||"Trial Press"===a||"Evaluation"===a?c.style(this._manageSubscriptionButton.domNode,
"display",""):c.style(this._upgradeSubscriptionButton.domNode,"display","")}if(!this._util.isPortal()&&this._organization.subscriptionInfo&&-1<c.indexOf(esriGeowConfig.creditBudgetingExcludedSubscriptionTypes||[],this._organization.subscriptionInfo.type))this._editTabs.removeChild(this._creditsTab),this._creditsTabRemoved=!0},_subscriptionAllowsInvite:function(){return this._isSingleTenant||!this._isSingleTenant&&this._organization.subscriptionInfo&&this._user.role&&this._isAdmin&&("active"===this._organization.subscriptionInfo.state||
"expired"===this._organization.subscriptionInfo.state||"restricted"===this._organization.subscriptionInfo.state)},_onTitleFocus:function(){this._editTitle.getValue()==this.i18n.defaultTextTitle&&(this._editTitle.set("value",""),c.removeClass(this._editTitle,"dim"));this._editTitle.focus()},_onDescriptionFocus:function(){this.removeHTMLBreak(this._editDescription.getValue())===this.i18n.defaultTextDescription&&(this._editDescription.set("value",""),c.removeClass(this._editDescription,"dim"));this._editDescription.focus()},
firstPage:function(){if(1!==this._page){var a=this._addSortParams({start:1});this._replaySearch(a)}},lastPage:function(){if(this._page!==this._totalPages){var a=this._addSortParams({start:(this._totalPages-1)*this._organizationUsersNum+1});this._replaySearch(a)}},prevPage:function(){if(1!==this._page){var a=this._addSortParams({start:(this._page-1)*this._organizationUsersNum+1-this._organizationUsersNum});this._replaySearch(a)}},nextPage:function(){if(this._page!==this._totalPages){var a=this._addSortParams({start:this._page*
this._organizationUsersNum+1});this._replaySearch(a)}},_addSortParams:function(a){a=c.mixin({num:this._organizationUsersNum},a);this._gridSortField&&(a.sortField=this._gridSortField);this._gridSortOrder&&(a.sortOrder=this._gridSortOrder);this._util.isPortal()&&(a.excludeSystemUsers=!0);return a},onUpgradeSubscription:function(a){this._manageSubscriptionsDlg.showUpgrade(this._organization)},onManageSubscription:function(a){this._manageSubscriptionsDlg.showManage(this._organization)},onRegionChange:function(a){this._newSelectedRegion=
a},onLanguageChange:function(a){this._newSelectedCulture=a},onUserSearchKeyPress:function(a){a.keyCode==c.keys.ENTER&&(c.stopEvent(a),this.onUserSearchClick(a));this.onUserSearchFieldKeyPress(a)},onUserSearchClick:function(a){c.stopEvent(a);var b=this._userSearchText.get("value");null!=a&&a.preventDefault&&a.preventDefault();if(0===c.trim(b).length)this._loadOrganizationUsers();else{if(c.isIE||c.has("trident")&&void 0===c.isIE)b=encodeURIComponent(b);this.focus=null;this.searchUsers(b)}},onUserSearchFieldKeyPress:function(a){},
searchUsers:function(a){!esri.isDefined(a)||a===this.i18n.defaultUserSearchBoxText?(this._wasSearch=!1,this._account.getAccountUsers(this._organization.id,{start:this._organizationUsersStart,num:this._organizationUsersNum},c.hitch(this,this._handleGetOrganizationUsers))):(this._wasSearch=!0,this._account.searchAccountUsers(this._organization.id,this.setupSearchParams(a,this._organizationUsersStart,this._organizationUsersNum),c.hitch(this,this._handleGetOrganizationUsers)))},setupSearchParams:function(a,
b,d){var e={start:this._organizationUsersStart,num:this._organizationUsersNum,sortField:this._gridSortField,sortOrder:this._gridSortOrder};b&&(e.start=b);d&&(e.num=d);if(a){b=(a=c.string.trim(a))&&0<a.length?a.toLowerCase():a;switch(a){case this.i18n.formatters.roleUser.toLowerCase():e.role="org_user";break;case this.i18n.formatters.rolePublisher.toLowerCase():e.role="org_publisher";break;case this.i18n.formatters.roleAdmin.toLowerCase():e.role="org_admin";break;default:if(this._customRoles&&0<this._customRoles.length)for(d=
0;d<this._customRoles.length;d++)if(b===this._customRoles[d].name.toLowerCase()){e.role=this._customRoles[d].id;break}}e.username=a;e.fullname=a;e.firstname=a;e.lastname=a}this._util.isPortal()&&(e.excludeSystemUsers=!0);return e},toggleDescription:function(a){a.preventDefault();"none"===c.style(this._description,"display")?(c.style(this._description,"display",""),c.style(this._summary,"display","none"),c.style(this._toggleDown,"display","none"),c.style(this._toggleUp,"display","")):(c.style(this._description,
"display","none"),c.style(this._summary,"display",""),c.style(this._toggleUp,"display","none"),c.style(this._toggleDown,"display",""))},onBannerImageSelect:function(){c.style("bannerImagePanel","display","block");c.style("bannerHTMLPanel","display","none");this._bannerRadio1.get("checked")?this._newSelectedRotatorPanelId=this._bannerRadio1.value:this._bannerRadio2.get("checked")?this._newSelectedRotatorPanelId=this._bannerRadio2.value:this._bannerRadio3.get("checked")?this._newSelectedRotatorPanelId=
this._bannerRadio3.value:this._bannerRadio4.get("checked")?this._newSelectedRotatorPanelId=this._bannerRadio4.value:this._bannerRadio5.get("checked")?this._newSelectedRotatorPanelId=this._bannerRadio5.value:this._bannerRadioCustom.get("checked")&&(this._newSelectedRotatorPanelId=this._bannerRadioCustom.value)},onBannerHTMLSelect:function(){c.style("bannerImagePanel","display","none");c.style("bannerHTMLPanel","display","block");this._newSelectedRotatorPanelId=this.htmlBannerId},onPredefinedBannerSelect:function(a){this._selectedBannerRadioButton=
g.getEnclosingWidget(a.target);this._newSelectedRotatorPanelId=this._selectedBannerRadioButton.value},onPredefinedBannerImageSelect:function(a){a.set("checked",!0);this._selectedBannerRadioButton=a;this._newSelectedRotatorPanelId=this._selectedBannerRadioButton.value},onBannerCustomSelect:function(a){g.byId("bannerRadioCustom").set("checked",!0);this._selectedBannerRadioButton=null;this._newSelectedRotatorPanelId=this.customBannerId;this._newCustomBannerKey?(a={title:this.i18n.noticeLabel,message:this.i18n.uploadNewBanner,
choiceOneTitle:this.i18n.yesLabel,choiceTwoTitle:this.i18n.noLabel},a.choiceOneHandler=c.hitch(this,function(){this._newCustomBannerKey=null;c.byId("bannerCustomCol").innerHTML=this.i18n.homeTab.uploadImage;this._showBannerThumbnailDialog()}),a.choiceTwoHandler=c.hitch(this,function(){this._bannerRadioCustom.set("checked",!0)}),this._choiceDlg.show(a)):this._showBannerThumbnailDialog(a)},onCustomBackgroundSelect:function(a){g.byId("bgRadioCustom").set("checked",!0);this._selectedBgRadioButton=null;
this._newCustomBackgroundKey?(a={title:this.i18n.noticeLabel,message:this.i18n.uploadNewBackground,choiceOneTitle:this.i18n.yesLabel,choiceTwoTitle:this.i18n.noLabel},a.choiceOneHandler=c.hitch(this,function(){this._newCustomBackgroundKey=null;c.byId("bgCustomCol").innerHTML=this.i18n.homeTab.uploadImage;this._showBackgroundThumbnailDialog()}),a.choiceTwoHandler=c.hitch(this,function(){this._bgRadioCustom.set("checked",!0)}),this._choiceDlg.show(a)):this._showBackgroundThumbnailDialog(a)},onPredefinedBackgroundSelect:function(a){this._selectedBgRadioButton=
g.getEnclosingWidget(a.target);this._newSelectedBackground=this._selectedBgRadioButton.value},onPredefinedBackgroundImageSelect:function(a){a.set("checked",!0);this._selectedBgRadioButton=a;this._newSelectedBackground=this._selectedBgRadioButton.value},onAssignGroupMembersClick:function(){this._batchAssignToGroupsDlg.show()},toggleMFAConfig:function(){var a=c.hitch(this,function(){this._mfaEnabled.get("checked")?c.style(this._mfaConfig,"display",""):c.style(this._mfaConfig,"display","none")}),b=c.hitch(this,
function(){this._mfaEnabled.set("checked",!0)});this._organization.mfaEnabled&&!this._mfaEnabled.get("checked")?this._choiceDlg.show({title:this.i18n.noticeLabel,message:this.i18n.securityTab.disableMultiFactorMsg,choiceOneTitle:this.i18n.ok,choiceTwoTitle:this.i18n.cancel,choiceOneHandler:a,choiceTwoHandler:b}):a()},designateAdmin:function(a){var b=a.target.id.indexOf("admin-");if(-1<b&&(a=parseInt(a.target.id.substring(b+6),10),b=this._allAdmins))if(a=b[a]){for(var b=!1,c=0;c<this._newMfaAdmins.length;c++)if(this._newMfaAdmins[c].username===
a.username){b=!0;break}b||((!a.email||""===a.email)&&this._generalDlg.show({title:this.i18n.notice,message:esri.substitute({user:a.altName},this.i18n.securityTab.adminNoMfaEmail)}),this._newMfaAdmins.push(a),this._refreshDesignatedAdminList())}},designateAdminContact:function(a){var b=a.target.id.indexOf("admin-contact-");if(-1<b&&(a=parseInt(a.target.id.substring(b+14),10),b=this._allAdmins))if(a=b[a]){for(var b=!1,c=0;c<this._newAdminContacts.length;c++)if(this._newAdminContacts[c].username===a.username){b=
!0;break}b||((!a.email||""===a.email)&&this._generalDlg.show({title:this.i18n.notice,message:esri.substitute({user:a.altName},this.i18n.generalTab.adminContactNoEmail)}),this._newAdminContacts.push(a),this._refreshDesignatedAdminContactList())}},featuredGroupsChange:function(a){if(a&&a.selectedGroups){this._newFeaturedGroups=[];a=a.selectedGroups;var b,c,e;for(b=0;b<a.length;b++)c=a[b],e={title:c.title,owner:c.owner},esri.isDefined(c.id)&&(e.id=c.id),esri.isDefined(c.altTitle)&&(e.altTitle=c.altTitle),
this._newFeaturedGroups.push(e)}},removeDesignatedAdmin:function(a){var b=a.target.id.indexOf("designated-admin-");if(-1<b){for(a=parseInt(a.target.id.substring(b+17),10);a<this._newMfaAdmins.length-1;a++)this._newMfaAdmins[a]=this._newMfaAdmins[a+1];this._newMfaAdmins[this._newMfaAdmins.length-1]=null;this._newMfaAdmins.length-=1;this._refreshDesignatedAdminList()}},removeDesignatedAdminContact:function(a){var b=a.target.id.indexOf("designated-admin-contact-");if(-1<b){for(a=parseInt(a.target.id.substring(b+
25),10);a<this._newAdminContacts.length-1;a++)this._newAdminContacts[a]=this._newAdminContacts[a+1];this._newAdminContacts[this._newAdminContacts.length-1]=null;this._newAdminContacts.length-=1;this._refreshDesignatedAdminContactList()}},_setupNewAccountSplash:function(){var a=this.i18n.newOrg.AGOOrg,b=this.i18n.organizationType,d=this.i18n.newOrg.AGO;this._isSingleTenant&&(a=esriGeowConfig.portalName||this.i18n.newOrg.portalForAGS,b=this.i18n.portalType,d=esriGeowConfig.portalName||this.i18n.newOrg.portalForAGS);
var e=this.i18n.newOrg.benefits1,e=e+("\x3cbr\x3e"+esri.substitute({type:b},this.i18n.newOrg.benefits2)),e=e+("\x3cbr\x3e"+esri.substitute({type:b},this.i18n.newOrg.benefits3)),e=e+("\x3cbr\x3e"+esri.substitute({hostType:d},this.i18n.newOrg.benefits4)),d=c.byId("newAccountSplash");c.create("h1",{innerHTML:this.i18n.newOrg.welcome},d);c.create("p",{innerHTML:esri.substitute({purchaseType:a},this.i18n.newOrg.purchase)},d);c.create("p",{innerHTML:e},d);c.create("p",{innerHTML:esri.substitute({type:b},
this.i18n.newOrg.getStarted)},d)},_setupNoDataMessages:function(){var a=this._organization.user.fullName,b=this._getTenantTypeString(),c=this._isSingleTenant?this.i18n.noData.usersMessagePortal:this.i18n.noData.usersMessage;this._noDataMessage='\x3cdiv class\x3d"esriAlignLeading" style\x3d"width:100%;"\x3e\x3cspan style\x3d"color: #21759b; font-size: 16px; font-weight: bold;"\x3e'+esri.substitute({fullName:a,type:b},this.i18n.noData.usersTitle)+"\x3c/span\x3e\x3cbr\x3e\x3cp\x3e"+esri.substitute({type:b},
c)+"\x3cbr\x3e"+this.i18n.noData.usersAddUsers+"\x3cbr\x3e\x3cul\x3e\x3cli\x3e"+this.i18n.noData.usersAbilities_1+"\x3c/li\x3e\x3cli\x3e"+this.i18n.noData.usersAbilities_2+"\x3c/li\x3e\x3cli\x3e"+this.i18n.noData.usersAbilities_3+"\x3c/li\x3e\x3cli\x3e"+this.i18n.noData.usersAbilities_4+"\x3c/li\x3e\x3cli\x3e"+this.i18n.noData.usersAbilities_5+"\x3c/li\x3e\x3cli\x3e"+this.i18n.noData.usersAbilities_6+'\x3c/li\x3e\x3c/ul\x3e\x3c/p\x3e\x3cbr\x3e\x3cbr\x3e\x3cspan style\x3d"color: #21759b; font-size: 16px; font-weight: bold;"\x3e'+
esri.substitute({type:b},this.i18n.noData.usersSetupTitle)+"\x3c/span\x3e\x3cbr\x3e\x3cp\x3e"+esri.substitute({type:b},this.i18n.noData.usersSetupMessage)+"\x3c/p\x3e\x3c/div\x3e";this._organization&&(this._organization.subscriptionInfo&&1===this._organization.subscriptionInfo.maxUsers)&&(this._noDataMessage='\x3cdiv class\x3d"esriAlignLeading" style\x3d"width:100%;"\x3e\x3cspan style\x3d"color: #21759b; font-size: 16px; font-weight: bold;"\x3e'+esri.substitute({type:b},this.i18n.noData.usersSetupTitle)+
"\x3c/span\x3e\x3cbr\x3e\x3cp\x3e"+esri.substitute({type:b},this.i18n.noData.usersSetupMessage)+"\x3c/p\x3e\x3c/div\x3e");a=esri.substitute({type:b},this.i18n.noData.pendingMessage);this._isSingleTenant&&(a=esri.substitute({type:b},this.i18n.noData.pendingMessagePortal));this._pendingNoDataMessage='\x3cdiv class\x3d"esriAlignLeading" style\x3d"width:100%;"\x3e\x3cspan style\x3d"color: #21759b; font-size: 16px; font-weight: bold;"\x3e'+this.i18n.noData.pendingTitle+"\x3c/span\x3e\x3cbr\x3e\x3cp\x3e"+
a+"\x3c/p\x3e\x3cp\x3e \x3c/p\x3e\x3c/div\x3e";this._noSearchResultsMessage='\x3cdiv class\x3d"esriAlignLeading"  style\x3d"width:100%;"\x3e\x3cspan style\x3d"color: #21759b; font-size: 16px; font-weight: bold;"\x3e'+this.i18n.noData.searchTitle+"\x3c/span\x3e\x3cbr\x3e\x3cp\x3e"+this.i18n.noData.searchMessage+"\x3c/p\x3e\x3cp\x3e"+this.i18n.noData.searchSuggestionsTitle+"\x3cbr\x3e\x3cul\x3e\x3cli\x3e"+this.i18n.noData.searchSuggestions_1+"\x3c/li\x3e\x3cli\x3e"+this.i18n.noData.searchSuggestions_2+
"\x3c/li\x3e\x3cli\x3e"+this.i18n.noData.searchSuggestions_3+"\x3c/li\x3e\x3cli\x3e"+this.i18n.noData.searchSuggestions_4+"\x3c/li\x3e\x3c/ul\x3e\x3c/p\x3e\x3c/div\x3e"},_setupMemberView:function(){var a=[{label:this.i18n.memberViewCurrent,name:this.i18n.memberViewCurrent}];this._user.role&&((this._isAdmin||this._roleCanInviteUsers)&&!this._isSingleTenant)&&a.push({label:this.i18n.memberViewPending,name:this.i18n.memberViewPending});this._memberView.set("store",new c.data.ItemFileReadStore({data:{identifier:"name",
label:"label",items:a}}));this._memberView.set("value",this.i18n.memberViewCurrent);this._selectedMemberView=this._memberView.value;this._userSearchText.set("placeHolder",this.i18n.defaultUserSearchBoxText);c.connect(this._memberView,"onChange",c.hitch(this,this.onMemberViewChange))},_setupEditTabs:function(){var a="left-h";esriGeowConfig.isRightToLeft&&(a="right-h");this._editTabs=new g.layout.TabContainer({tabPosition:a,tabStrip:!0,className:"orgEditTabs respond",style:{height:this._isSingleTenant?
"2000px":"1800px"}},c.byId("editTabs"));this._setupGeneralTab();this._setupHomePageTab();this._setupGalleryTab();this._setupMapTab();this._setupItemDetailsTab();this._setupGroupsTab();this._setupUtilityServicesTab();this._isSingleTenant&&esriGeowConfig.portalAGOConfigEnabled&&this._setupAGOLTab();this._isSingleTenant&&esriGeowConfig.federatedServerConfigEnabled&&this._setupServersTab();this._setupRolesTab();!this._isSingleTenant&&esriGeowConfig.creditBudgetingEnabled&&this._setupCreditsTab();this._setupSecurityTab();
!this._isSingleTenant&&esriGeowConfig.openDataConfigEnabled&&this._setupOpenDataTab();this._editTabs.startup()},_getTenantTypeString:function(){return this._isSingleTenant?this.i18n.portalType:this.i18n.organizationType},_createSpacerRow:function(a){a=c.create("div",{innerHTML:"\x26nbsp;"},c.create("td",{colspan:"2"},c.create("tr",null,a)));c.addClass(a,"spacerRow");return a},_elipseTitle:function(a){return a&&17<a.length?a.substring(0,15)+"...":a},_createTabContainer:function(a,b,d){a={title:this._elipseTitle(a),
content:b};d&&(a.selected=!0);d=new g.layout.ContentPane(a);c.addClass(d.domNode,"orgSettingTab");return d},_createTab:function(a){var b=c.create("div");a=c.create("span",{innerHTML:a},b);c.addClass(a,"tabTitle");return b},_createTabPanel:function(a,b){var d=c.create("div",{innerHTML:a+"\x3cbr\x3e\x3cbr\x3e"},b);c.addClass(d,"panelContents respond");return d},_createWidgetTabPanel:function(a,b){var d=c.create("div",{innerHTML:a},b);c.addClass(d,"panelContents respond");return d},_createTabTable:function(a){return c.create("tbody",
null,c.create("table",null,a))},_createGeneralTabAbstract:function(){return this._isSingleTenant?this.i18n.generalTab.portalTabDescription:this.i18n.generalTab.tabDescription},_createHomePageTabAbstract:function(){return this._isSingleTenant?this.i18n.homeTab.portalTabDescription:this.i18n.homeTab.tabDescription},_createGalleryTabAbstract:function(){return esri.substitute({type:this._getTenantTypeString()},this.i18n.galleryTab.tabDescription)},_createMapTabAbstract:function(){return this._isSingleTenant?
this.i18n.mapTab.portalTabDescription:this.i18n.mapTab.tabDescription},_createItemDetailsTabAbstract:function(){return esri.substitute({type:this._getTenantTypeString()},this.i18n.itemDetailsTab.tabDescription)},_createGroupsTabAbstract:function(){return esri.substitute({type:this._getTenantTypeString()},this.i18n.groupsTab.tabDescription)},_createUtilityServicesTabAbstract:function(){var a=esri.substitute({type:this._getTenantTypeString()},this.i18n.utilityServicesTab.tabDescription);this._isSingleTenant&&
esriGeowConfig.portalAGOConfigEnabled&&(a+=" "+this.i18n.utilityServicesTab.agolTabNote);return a},_createServersTabAbstract:function(){return esri.substitute({type:this._getTenantTypeString()},this.i18n.serversTab.tabDescription)},_createAGOLTabAbstract:function(){return this.i18n.agolTab.tabDescription},_createCreditsTabAbstract:function(){return this.i18n.creditsTab.tabDescription+"\x3cbr\x3e\x3cbr\x3e"+this.i18n.creditsTab.tabDescriptionDisable},_createSecurityTabAbstract:function(){return esri.substitute({type:this._getTenantTypeString()},
this.i18n.securityTab.tabDescription)},_createNameLogoRow:function(a){var b=c.create,d=this.i18n.generalTab.logoName;this._isSingleTenant&&(d=this.i18n.generalTab.portalLogoName);d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+d+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-general-logo-name.png")},d);c.addClass(d,"titleColumn");a=b("td",
null,a);c.addClass(a,"valignTop");a=b("tr",null,b("tbody",null,b("table",null,a)));d=b("td",null,a);c.addClass(d,"orgEditThumbnail");this._thumbnailDelete=b("img",{id:"thumbnailDelete",src:this._util.relativeToExplicitUrl("js/arcgisonline/css/images/delete.png")},b("div",{id:"thumbnailDeleteDiv",className:"orgDeleteThumbnail"},d));this._thumbnail=b("img",{src:"",align:"center"},d);b("br",null,d);this._changeThumbLabel=b("span",{innerHTML:this.i18n.generalTab.changeThumb},d);c.addClass(this._thumbnail,
"groupThumbnail");d=this.i18n.generalTab.orgName;this._isSingleTenant&&(d=this.i18n.generalTab.portalName);a=b("td",{innerHTML:"\x3cstrong\x3e"+d+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},a);c.addClass(a,"valignTop");b=b("div",null,a);this._editTitle=new g.form.TextBox({maxlength:"250",style:{width:"30em"}},b)},_createContactRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.generalTab.contactSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",{"class":"orgContact"},
a));a=b("tr",{"class":"orgContact"},a);var e=b("td",null,a);a=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-general-contact.png")},e);c.addClass(d,"valignTop");c.addClass(e,"titleColumn");c.addClass(a,"valignTop");b("label",{innerHTML:this.i18n.generalTab.contactDesc+"\x3cbr\x3e\x3cbr\x3e"},a);d=b("div",{"class":"contactField"},a);b("div",{"class":"contactLabel",innerHTML:this.i18n.generalTab.contactEmail+"\x26nbsp;"},d);this._orgEmail=
new g.form.TextBox({id:"orgEmail"},b("span",null,d));d=b("div",{"class":"contactField"},a);b("div",{"class":"contactLabel",innerHTML:this.i18n.generalTab.contactUrl+"\x26nbsp;"},d);this._orgUrl=new g.form.TextBox({id:"orgUrl"},b("span",null,d));d=b("div",{"class":"contactField"},a);b("div",{"class":"contactLabel",innerHTML:this.i18n.generalTab.contactPhone+"\x26nbsp;"},d);this._orgPhone=new g.form.TextBox({id:"orgPhone"},b("span",null,d))},_createSummaryRow:function(a){var b=c.create,d=b("td",{colspan:"2",
innerHTML:"\x3cstrong\x3e"+this.i18n.generalTab.summarySetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a)),e=b("tr",null,a);a=b("td",null,e);e=b("td",null,e);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-general-summary.png")},a);c.addClass(d,"valignTop");c.addClass(a,"titleColumn");c.addClass(e,"valignTop");b("div",{innerHTML:esri.substitute({chars:this._organizationSummaryCount},this.i18n.generalTab.summaryDesc)},e);b("br",null,e);this._orgSummary=
new g.form.TextBox({id:"orgSummary",style:{width:"100%"},maxlength:this._organizationSummaryCount},b("div",null,e));b("br",null,e);this._orgSummaryCount=b("label",{innerHTML:esri.substitute({chars:this._organizationSummaryCount},this.i18n.generalTab.summaryCharsLeft)},e);c.addClass(this._orgSummaryCount,"example");b=c.hitch(this,function(){var a=this._orgSummary.get("value");c.attr(this._orgSummaryCount,"innerHTML",esri.substitute({chars:this._organizationSummaryCount-(a&&-1<a.length?a.length:0)},
this.i18n.generalTab.summaryCharsLeft))});c.connect(this._orgSummary,"onKeyUp",b);c.connect(this._orgSummary,"onChange",b)},_createDescriptionRow:function(a){var b=c.create,d=this.i18n.generalTab.descriptionSetting;this._isSingleTenant&&(d=this.i18n.generalTab.portalDescriptionSetting);d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+d+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-general-description.png")},
d);c.addClass(d,"titleColumn");a=b("td",null,a);c.addClass(a,"valignTop");d=b("div",null,a);c.addClass(d,"zeroLeft");d=b("div",null,d);c.addClass(d,"editorBorder");this._editDescription=new g.Editor({height:"150px",plugins:["bold","italic","underline","foreColor","hiliteColor","|","justifyLeft","justifyCenter","justifyRight","justifyFull","|","insertOrderedList","insertUnorderedList","indent","outdent","|","createEsriLink","unlink","insertImage","|","undo","redo","|","viewsource",{name:"dijit._editor.plugins.FontChoice",
command:"fontName",custom:"Arial;Courier New;Garamond;Tahoma;Times New Roman;Verdana".split(";")},{name:"dijit._editor.plugins.FontChoice",command:"fontSize",custom:["2","3","4","5","6"]}],style:"font-family:Verdana; font-size:13px;"},d);b("br",null,a);this._homePageDescription=new g.form.CheckBox({id:"homePageDescription",value:!0,checked:!0},b("div",null,a));b("label",{innerHTML:" "+this.i18n.generalTab.showDescription},a)},_createLanguageRow:function(a){var b=c.create,d=b("tr",null,a),d=b("td",
{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.generalTab.languageSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},d);c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);c.addClass(d,"titleColumn");b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-language.png")},d);d=this.i18n.generalTab.browserDefaultAGOL;this._isSingleTenant&&(d=this.i18n.generalTab.browserDefaultPortal);a=b("td",{innerHTML:this.i18n.generalTab.languageDesc+" "+d+"\x3cbr\x3e\x3cbr\x3e"},
a);c.addClass(a,"valignTop");this._languageSelect=new g.form.FilteringSelect({id:"languageSelect"},b("div",null,a));c.addClass(this._languageSelect,"gallerySelect");c.connect(this._languageSelect,"onChange",c.hitch(this,this.onLanguageChange))},_createRegionRow:function(a){var b=c.create,d=b("tr",null,a),d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.generalTab.regionSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},d);c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);c.addClass(d,
"titleColumn");b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-region.png")},d);d=esri.substitute({type:this._getTenantTypeString()},this.i18n.generalTab.regionDesc);a=b("td",{innerHTML:d+"\x3cbr\x3e\x3cbr\x3e"},a);c.addClass(a,"valignTop");this._regionSelect=new g.form.FilteringSelect({id:"regionSelect"},b("div",null,a));c.addClass(this._regionSelect,"gallerySelect");c.connect(this._regionSelect,"onChange",c.hitch(this,this.onRegionChange))},_createCommentsRow:function(a){var b=
c.create,d=b("tr",null,a),d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.itemDetailsTab.commentsSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},d),e=b("tr",null,a);a=b("td",null,e);e=b("td",null,e);c.addClass(d,"valignTop");c.addClass(a,"titleColumn");c.addClass(e,"valignTop");b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-comments.png")},a);this._allowComments=new g.form.CheckBox({id:"allowCommentsCheckBox",value:!0,checked:!0},b("div",null,
e));b("label",{innerHTML:" "+this.i18n.itemDetailsTab.allowComments,"for":"allowCommentsCheckBox"},e)},_createMetadataRow:function(a){var b=c.create,d='\x3cspan id\x3d"metadataHelp" class\x3d"my-org valignBottom"\x3e\x3ca id\x3d"metadataHelpLink" href\x3d"#" target\x3d"_blank"\x3e\x3cimg src\x3d"'+this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/helpIcon.png")+'"\x3e\x3c/a\x3e\x3c/span\x3e',d="\x3cstrong\x3e"+this.i18n.itemDetailsTab.metadataSetting+"\x3c/strong\x3e "+d+
"\x3cbr\x3e\x3cbr\x3e",e=b("tr",null,a),d=b("td",{colspan:"2",innerHTML:d},e),e=b("tr",null,a);a=b("td",null,e);e=b("td",null,e);c.addClass(d,"valignTop");c.addClass(a,"titleColumn");c.addClass(e,"valignTop");b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-metadata.png")},a);this._enableMetadata=new g.form.CheckBox({id:"enableMetadataCheckBox",value:!1,checked:!1},b("div",null,e));b("label",{innerHTML:" "+esri.substitute({startSpan:'\x3cspan id\x3d"metadataTooltip" class\x3d"orgSettingTooltip"\x3e',
endSpan:"\x3c/span\x3e",type:this._getTenantTypeString()},this.i18n.itemDetailsTab.enableMetadata),"for":"enableMetadataCheckBox"},e);b("br",null,e);b("br",null,e);this._metadataFormatDiv=b("div",null,e);b("label",{innerHTML:esri.substitute({type:this._getTenantTypeString()},this.i18n.itemDetailsTab.selectMetadataFormats)},this._metadataFormatDiv);b("br",null,this._metadataFormatDiv);b("br",null,this._metadataFormatDiv);this._metadataFGDCOption=new g.form.RadioButton({id:"metadataFormatFGDC",name:"metadataFormat",
checked:!1},b("div",null,this._metadataFormatDiv));b("label",{innerHTML:"\x26nbsp;"+this.i18n.itemDetailsTab.formats.fgdc,"for":"metadataFormatFGDC"},this._metadataFormatDiv);b("br",null,this._metadataFormatDiv);b("br",null,this._metadataFormatDiv);this._metadataINSPIREOption=new g.form.RadioButton({id:"metadataFormatINSPIRE",name:"metadataFormat",checked:!1},b("div",null,this._metadataFormatDiv));b("label",{innerHTML:"\x26nbsp;"+this.i18n.itemDetailsTab.formats.inspire,"for":"metadataFormatINSPIRE"},
this._metadataFormatDiv);b("br",null,this._metadataFormatDiv);b("br",null,this._metadataFormatDiv);this._metadataISO1913932Option=new g.form.RadioButton({id:"metadataFormatISO1913932",name:"metadataFormat",checked:!0},b("div",null,this._metadataFormatDiv));b("label",{innerHTML:"\x26nbsp;"+this.i18n.itemDetailsTab.formats.iso1913932,"for":"metadataFormatISO1913932"},this._metadataFormatDiv);b("br",null,this._metadataFormatDiv);b("br",null,this._metadataFormatDiv);this._metadataISO19139Option=new g.form.RadioButton({id:"metadataFormatISO19139",
name:"metadataFormat",checked:!0},b("div",null,this._metadataFormatDiv));b("label",{innerHTML:"\x26nbsp;"+this.i18n.itemDetailsTab.formats.iso19139,"for":"metadataFormatISO19139"},this._metadataFormatDiv);b("br",null,this._metadataFormatDiv);b("br",null,this._metadataFormatDiv);this._metadataISO19115Option=new g.form.RadioButton({id:"metadataFormatISO19115",name:"metadataFormat",checked:!0},b("div",null,this._metadataFormatDiv));b("label",{innerHTML:"\x26nbsp;"+this.i18n.itemDetailsTab.formats.iso19115,
"for":"metadataFormatISO19115"},this._metadataFormatDiv);c.style(this._metadataFormatDiv,"display","none");c.connect(this._enableMetadata,"onChange",c.hitch(this,function(){c.style(this._metadataFormatDiv,"display",this._enableMetadata.get("checked")?"":"none")}))},_createBackgroundRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.homeTab.backgroundSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",
null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-homepage-background.png")},d);c.addClass(d,"titleColumn");a=b("td",{innerHTML:this.i18n.homeTab.backgroundDesc+"\x3cbr\x3e\x3cbr\x3e"},a);c.addClass(a,"valignTop");a=b("div",{id:"bgImagePanel"},a);var e=b("tbody",null,b("table",null,a)),f=b("tr",null,e);a=b("td",{innerHTML:this.i18n.homeTab.noBackground},f);c.addClass(a,"valignCenter talignCenter");c.addClass(a,"noImage");d=b("td",null,f);b("img",
{src:this._util.relativeToExplicitUrl("images/arcgis_background.jpg"),width:"115px",height:"39px",style:{width:"115px",height:"39px"}},d);c.addClass(d,"valignCenter");f=b("td",{id:"bgCustomCol",innerHTML:this.i18n.homeTab.uploadImage},f);c.addClass(f,"valignCenter talignCenter");c.addClass(f,"customImage");var f=b("tr",null,e),k=b("td",null,f);c.addClass(k,"talignCenter");e=b("td",null,f);c.addClass(e,"talignCenter");f=b("td",null,f);c.addClass(f,"talignCenter");k=b("div",null,k);e=b("div",null,e);
b=b("div",null,f);this._bgRadio1=g.form.RadioButton({id:"bgRadio1",name:"bgRadio",value:this.predefinedBackground1},k);this._bgRadio2=g.form.RadioButton({id:"bgRadio2",name:"bgRadio",value:this.predefinedBackground2},e);this._bgRadioCustom=g.form.RadioButton({id:"bgRadioCustom",name:"bgRadio",value:"bgCustom"},b);c.connect(a,"onclick",c.hitch(this,function(){this.onPredefinedBackgroundImageSelect(this._bgRadio1)}));c.connect(d,"onclick",c.hitch(this,function(){this.onPredefinedBackgroundImageSelect(this._bgRadio2)}))},
_createBannerRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.homeTab.bannerSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-homepage-banner.png")},d);c.addClass(d,"titleColumn");a=b("td",{innerHTML:this.i18n.homeTab.bannerDesc+"\x3cbr\x3e\x3cbr\x3e"},a);c.addClass(a,"valignTop");d=b("div",null,
a);b("label",{innerHTML:" "+this.i18n.homeTab.bannerImage+" \x26nbsp;\x26nbsp;"},a);var e=b("div",null,a);b("label",{innerHTML:" "+this.i18n.homeTab.bannerHTML},a);this._bannerImageSelect=new g.form.RadioButton({checked:!0,value:"image",name:"bannerControl",type:"radio"},d);this._bannerHTMLSelect=new g.form.RadioButton({value:"html",name:"bannerControl",type:"radio"},e);b("br",null,a);b("br",null,a);var d=b("div",{id:"bannerImagePanel"},a),f=b("tbody",null,b("table",null,d)),k=b("tr",null,f),d=b("td",
null,k);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/homepage-banner-1.jpg")},d);c.addClass(d,"valignCenter");e=b("td",null,k);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/homepage-banner-2.jpg")},e);c.addClass(e,"valignCenter");k=b("td",null,k);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/homepage-banner-3.jpg")},k);c.addClass(k,"valignCenter");var h=b("tr",null,f),l=b("td",
null,h);c.addClass(l,"talignCenter");var m=b("td",null,h);c.addClass(m,"talignCenter");h=b("td",null,h);c.addClass(h,"talignCenter");l=b("div",null,l);m=b("div",null,m);h=b("div",null,h);this._bannerRadio1=g.form.RadioButton({id:"bannerRadio1",name:"bannerRadio",value:this.predefinedBanner1Id},l);this._bannerRadio2=g.form.RadioButton({id:"bannerRadio2",name:"bannerRadio",value:this.predefinedBanner2Id},m);this._bannerRadio3=g.form.RadioButton({id:"bannerRadio3",name:"bannerRadio",value:this.predefinedBanner3Id},
h);l=b("tr",null,f);m=b("td",null,l);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/homepage-banner-4.jpg")},m);c.addClass(m,"valignCenter");h=b("td",null,l);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/homepage-banner-5.jpg")},h);c.addClass(h,"valignCenter");l=b("td",{id:"bannerCustomCol",innerHTML:this.i18n.homeTab.uploadImage},l);c.addClass(l,"valignCenter talignCenter");c.addClass(l,"customImage");var l=b("tr",
null,f),p=b("td",null,l);c.addClass(p,"talignCenter");f=b("td",null,l);c.addClass(f,"talignCenter");l=b("td",null,l);c.addClass(l,"talignCenter");p=b("div",null,p);f=b("div",null,f);l=b("div",null,l);this._bannerRadio4=g.form.RadioButton({id:"bannerRadio4",name:"bannerRadio",value:this.predefinedBanner4Id},p);this._bannerRadio5=g.form.RadioButton({id:"bannerRadio5",name:"bannerRadio",value:this.predefinedBanner5Id},f);this._bannerRadioCustom=g.form.RadioButton({id:"bannerRadioCustom",name:"bannerRadio",
value:"bannerCustom"},l);a=b("div",{id:"bannerHTMLPanel"},a);c.addClass(a,"zeroLeft");b=b("div",null,a);c.addClass(a,"panelContents2 editorBorder");this._editHTMLBanner=new g.Editor({id:"bannerHTMLEditor",height:"120px",plugins:"bold italic underline foreColor hiliteColor | justifyLeft justifyCenter justifyRight justifyFull | insertOrderedList insertUnorderedList indent outdent | createLink unlink insertImage | undo redo | viewsource".split(" "),style:"font-family:Verdana; font-size:13px;"},b);c.connect(this._bannerImageSelect,
"onClick",c.hitch(this,this.onBannerImageSelect));c.connect(this._bannerHTMLSelect,"onClick",c.hitch(this,this.onBannerHTMLSelect));c.connect(d,"onclick",c.hitch(this,function(){this.onPredefinedBannerImageSelect(this._bannerRadio1)}));c.connect(e,"onclick",c.hitch(this,function(){this.onPredefinedBannerImageSelect(this._bannerRadio2)}));c.connect(k,"onclick",c.hitch(this,function(){this.onPredefinedBannerImageSelect(this._bannerRadio3)}));c.connect(m,"onclick",c.hitch(this,function(){this.onPredefinedBannerImageSelect(this._bannerRadio4)}));
c.connect(h,"onclick",c.hitch(this,function(){this.onPredefinedBannerImageSelect(this._bannerRadio5)}));c.style(a,"display","none")},_createFeaturedMapsRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.homeTab.featuredMapsSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-homepage-featured.png")},
d);c.addClass(d,"titleColumn");a=b("td",{innerHTML:this.i18n.homeTab.featuredMapsDesc+"\x3cbr\x3e\x3cbr\x3e"},a);c.addClass(a,"valignTop");this._homePageFeaturedSelect=new g.form.FilteringSelect({id:"homePageFeaturedSelect",style:{display:"inline-block"}},b("div",null,a));c.addClass(this._homePageFeaturedSelect,"gallerySelect");d=this._homePageSortBySpan=b("span",{innerHTML:"\x26nbsp;\x26nbsp;"},a);b("label",{innerHTML:this.i18n.sortedByLabel+"\x26nbsp;"},d);this._homePageSortBySelect=new arcgisonline.sharing.dijit.ComboBox({id:"homePageFeaturedSortBy",
searchAttr:"name",style:{display:"inline-block",width:"75px"}},b("span",null,d));b("span",{innerHTML:"\x26nbsp;\x26nbsp;"},d);this._homePageSortBySelect.set("store",new c.store.Memory({data:this._getSortByData()}));c.addClass(this._homePageSortBySelect,"gallerySelect");this._homePageSortBySelect.set("value",this.i18n.sortFields.title);this._homePageSortByCheckBox=new g.form.CheckBox({type:"checkbox",checked:!0},b("span",null,d));b("label",{innerHTML:"\x26nbsp;"+this.i18n.sortOrderLabel},d);b("br",
null,a);b("br",null,a);this._homePageFeaturedCountSelectSpan=b("span",null,a);b("label",{innerHTML:this.i18n.homeTab.showCount+"\x26nbsp;"},this._homePageFeaturedCountSelectSpan);this._homePageFeaturedCountSelect=new arcgisonline.sharing.dijit.ComboBox({id:"homePageFeaturedCountSelect",searchAttr:"name",style:{display:"inline-block",width:"45px"},store:new c.store.Memory({data:[{id:0,name:this.i18n.homeTab.allOption},{id:4,name:4},{id:8,name:8},{id:12,name:12},{id:16,name:16},{id:20,name:20},{id:24,
name:24},{id:28,name:28},{id:32,name:32}]})},b("span",null,this._homePageFeaturedCountSelectSpan));b("label",{innerHTML:"\x26nbsp;"+this.i18n.homeTab.itemsLabel},this._homePageFeaturedCountSelectSpan)},_createGalleryRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.galleryTab.showInSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a));c.addClass(d,"valignTop");d=b("tr",null,a);a=b("td",null,d);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-gallery.png")},
a);c.addClass(a,"titleColumn");a=this._getTenantTypeString();var e=esri.substitute({type:a},this.i18n.galleryTab.showInDesc),d=b("td",{innerHTML:e+"\x3cbr\x3e\x3cbr\x3e"},d);c.addClass(d,"valignTop");this._gallerySelect=new g.form.FilteringSelect({id:"gallerySelect",style:{display:"inline-block"}},b("div",null,d));c.addClass(this._gallerySelect,"gallerySelect");e=this._gallerySortBySpan=b("span",{innerHTML:"\x26nbsp;\x26nbsp;"},d);b("label",{innerHTML:this.i18n.sortedByLabel+"\x26nbsp;"},e);this._gallerySortBySelect=
new arcgisonline.sharing.dijit.ComboBox({id:"gallerySortBy",searchAttr:"name",style:{display:"inline-block",width:"75px"}},b("span",null,e));b("span",{innerHTML:"\x26nbsp;\x26nbsp;"},e);this._gallerySortBySelect.set("store",new c.store.Memory({data:this._getSortByData()}));c.addClass(this._gallerySortBySelect,"gallerySelect");this._gallerySortBySelect.set("value",this.i18n.sortFields.title);this._gallerySortByCheckBox=new g.form.CheckBox({type:"checkbox",checked:!0},b("span",null,e));b("label",{innerHTML:"\x26nbsp;"+
this.i18n.sortOrderLabel},e);this._groupSelectedReminder=c.create("span",{id:"group-selected-reminder",innerHTML:""},d);this.groupReminderText="\x3cbr\x3e\x3cbr\x3e"+this.i18n.galleryTab.groupReminder;this.mostViewedReminderText="\x3cbr\x3e\x3cbr\x3e"+esri.substitute({type:a},this.i18n.galleryTab.mostViewedReminder)},_createBasemapGalleryRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.mapTab.gallerySetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,
a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-map-basemap-gallery.png")},d);c.addClass(d,"titleColumn");a=b("td",{innerHTML:this.i18n.mapTab.galleryDesc+"\x3cbr\x3e\x3cbr\x3e"},a);c.addClass(a,"valignTop");this._basemapGallerySelect=new g.form.FilteringSelect({id:"basemapGallerySelect",style:{display:"inline-block"}},b("div",null,a));c.addClass(this._basemapGallerySelect,"gallerySelect");
d=this._basemapSortBySpan=b("span",{innerHTML:"\x26nbsp;\x26nbsp;"},a);b("label",{innerHTML:this.i18n.sortedByLabel+"\x26nbsp;"},d);this._basemapSortBySelect=new arcgisonline.sharing.dijit.ComboBox({id:"basemapSortBy",searchAttr:"name",style:{display:"inline-block",width:"75px"}},b("span",null,d));b("span",{innerHTML:"\x26nbsp;\x26nbsp;"},d);this._basemapSortBySelect.set("store",new c.store.Memory({data:this._getSortByData()}));c.addClass(this._basemapSortBySelect,"gallerySelect");this._basemapSortBySelect.set("value",
this.i18n.sortFields.title);this._basemapSortByCheckBox=new g.form.CheckBox({type:"checkbox",checked:!0},b("span",null,d));b("label",{innerHTML:"\x26nbsp;"+this.i18n.sortOrderLabel},d);b("br",null,a);b("br",null,a);a=b("table",{id:"addEsriBasemapsTable",style:{display:"none"}},a);a=b("tr",null,b("tbody",null,a));this._addEsriBasemaps=new g.form.CheckBox({id:"addEsriBasemaps"},b("div",null,b("td",{className:"valignTop"},a)));b("label",{innerHTML:this.i18n.mapTab.addEsriBasemaps},b("td",{className:"valignTop"},
a))},_createDefaultBasemapRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.mapTab.basemapSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-map-default-basemap.png")},d);c.addClass(d,"titleColumn");a=b("td",{innerHTML:this.i18n.mapTab.basemapDesc+"\x3cbr\x3e\x3cbr\x3e"},a);c.addClass(a,"valignTop");
b("div",{id:"defaultBasemapSelectDiv"},a);b("br",null,a);b("br",null,a);this._useMapExtentBtn=new g.form.Button({id:"useMapExtentBtn",label:this.i18n.mapTab.useMapExtent},b("div",null,a));c.addClass(this._useMapExtentBtn.domNode,["calcite","tertiary","small"]);c.connect(this._useMapExtentBtn,"onClick",c.hitch(this,this.onUseMapExtent))},_createDefaultExtentRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.mapTab.extentSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},
b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-default-extent.png")},d);c.addClass(d,"titleColumn");a=b("td",{innerHTML:this.i18n.mapTab.extentDesc+"\x3cbr\x3e\x3cbr\x3e"},a);c.addClass(a,"valignTop");a=b("table",null,a);d=b("tr",null,a);b("td",{innerHTML:this.i18n.mapTab.extentLeftLabel},d);this.extentLeftValue=b("span",{id:"extentLeftValue"},b("td",{align:"right",nowrap:"nowrap"},
d));b("td",{style:{width:"2em"}},d);b("td",{innerHTML:this.i18n.mapTab.extentRightLabel},d);this.extentRightValue=b("span",{id:"extentRightValue"},b("td",{align:"right",nowrap:"nowrap"},d));this.chooseExtentBtn=new g.form.Button({id:"chooseExtentBtn",label:this.i18n.mapTab.chooseExtent,type:"button",style:{margin:"0"}},b("div",null,b("td",{rowspan:"3",align:"right",width:"200px"},d)));c.addClass(this.chooseExtentBtn.domNode,["calcite","tertiary","small"]);b("td",{colspan:"5",innerHTML:"\x26nbsp;",
style:{"line-height":"5px"}},b("tr",null,a));a=b("tr",null,a);b("td",{innerHTML:this.i18n.mapTab.extentTopLabel},a);this.extentTopValue=b("span",{id:"extentTopValue"},b("td",{align:"right",nowrap:"nowrap"},a));b("td",null,a);b("td",{innerHTML:this.i18n.mapTab.extentBottomLabel},a);this.extentBottomValue=b("span",{id:"extentBottomValue"},b("td",{align:"right",nowrap:"nowrap"},a));c.connect(this.chooseExtentBtn,"onClick",c.hitch(this,this.onChooseExtent));c.subscribe("onExtentUpdate",c.hitch(this,this.onExtentUpdate))},
_createBingMapsRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.mapTab.bingKeySetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-bing-key.png")},d);c.addClass(d,"titleColumn");var d=this._getTenantTypeString(),d=esri.substitute({type:d,bingLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca href\x3d"https://www.bingmapsportal.com/" target\x3d"_blank"\x3e',
bingLinkEnd:"\x3c/a\x3e\x3c/span\x3e"},this.i18n.mapTab.bingKeyDesc),e=esri.substitute({esriLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca href\x3d"http://www.esri.com/about-esri/offices/" target\x3d"_blank"\x3e',esriLinkEnd:"\x3c/a\x3e\x3c/span\x3e"},this.i18n.mapTab.bingKeyEsriDesc);a=b("td",{innerHTML:d+(!this._isSingleTenant?" "+e:"")+"\x3cbr\x3e\x3cbr\x3e"},a);c.addClass(a,"valignTop");this._bingKey=new g.form.TextBox({trim:!0,style:{width:"30em"}},b("div",null,a));c.addClass(this._bingKey.domNode,
"orgTextBox");b("br",null,a);b("br",null,a);this._shareBingDiv=b("div",{id:"shareBingDiv",style:{display:"none"}},a);a=b("tr",null,b("tbody",null,b("table",null,this._shareBingDiv)));this._shareBingKey=new g.form.CheckBox({type:"checkbox",checked:!1},b("div",null,b("td",{className:"valignTop"},a)));d=q.html.entities.encode(this.i18n.mapTab.bingKeyShareTooltip);e='\x3cspan id\x3d"bingKeyTooltip" class\x3d"orgSettingTooltip" ';esri.isTouchEnabled&&(e+='title\x3d"'+d+'"');d=" "+esri.substitute({startSpan:e+
"\x3e",endSpan:"\x3c/span\x3e"},this.i18n.mapTab.bingKeyShareDesc);b("label",{innerHTML:d},b("td",{className:"valignTop"},a));c.connect(this._bingKey,"onChange",c.hitch(this,this.onBingMapsKeyChange))},_createWebMapTemplatesRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.mapTab.templatesSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-map-template-gallery.png")},
d);c.addClass(d,"titleColumn");a=b("td",{innerHTML:this.i18n.mapTab.templatesDesc+"\x3cbr\x3e\x3cbr\x3e"},a);c.addClass(a,"valignTop");this._templatesSelect=new g.form.FilteringSelect({id:"templatesSelect",style:{display:"inline-block"}},b("div",null,a));c.addClass(this._templatesSelect,"gallerySelect");d=this._templatesSortBySpan=b("span",{innerHTML:"\x26nbsp;\x26nbsp;"},a);b("label",{innerHTML:this.i18n.sortedByLabel+"\x26nbsp;"},d);this._templatesSortBySelect=new arcgisonline.sharing.dijit.ComboBox({id:"templatesSortBy",
searchAttr:"name",style:{display:"inline-block",width:"75px"}},b("span",null,d));b("span",{innerHTML:"\x26nbsp;\x26nbsp;"},d);this._templatesSortBySelect.set("store",new c.store.Memory({data:this._getSortByData()}));c.addClass(this._templatesSortBySelect,"gallerySelect");this._templatesSortBySelect.set("value",this.i18n.sortFields.title);this._templatesSortByCheckBox=new g.form.CheckBox({type:"checkbox",checked:!0},b("span",null,d));b("label",{innerHTML:"\x26nbsp;"+this.i18n.sortOrderLabel},d);b("br",
null,a);b("br",null,a);a=b("table",{id:"addEsriWebAppTemplatesTable",style:{display:"none"}},a);a=b("tr",null,b("tbody",null,a));this._addEsriWebAppTemplates=new g.form.CheckBox({id:"addEsriWebAppTemplates"},b("div",null,b("td",{className:"valignTop"},a)));b("label",{innerHTML:this.i18n.mapTab.addEsriWebAppTemplates},b("td",{className:"valignTop"},a))},_createUnitsRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.mapTab.unitsSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},
b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-units.png")},d);c.addClass(d,"titleColumn");a=b("td",null,a);c.addClass(a,"valignTop");b("label",{innerHTML:this.i18n.mapTab.unitsDesc+"\x3cbr\x3e\x3cbr\x3e"},a);this._unitsSelect=new arcgisonline.sharing.dijit.ComboBox({id:"unitsSelect",style:{display:"inline-block"}},b("div",null,a));c.addClass(this._unitsSelect,"gallerySelect")},
_createGroupAssignmentRow:function(a){var b=c.create,d=esri.substitute({type:this._getTenantTypeString()},this.i18n.groupsTab.groupAssignSetMembers),e=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.groupsTab.groupAssignSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a)),f=b("tr",null,a);a=b("td",null,f);f=b("td",null,f);c.addClass(e,"valignTop");c.addClass(a,"titleColumn");c.addClass(f,"valignTop");b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-group-assignment.png")},
a);b("label",{innerHTML:this.i18n.groupsTab.groupAssignDesc+"\x3cbr\x3e\x3cbr\x3e"},f);b("label",{innerHTML:d+"\x3cbr\x3e\x3cbr\x3e"},f);this._assignGroupMembers=new g.form.Button({id:"assignGroupMembers",label:this.i18n.groupsTab.assignGroupMembers},b("div",null,f));c.addClass(this._assignGroupMembers.domNode,["calcite","tertiary","small"]);c.connect(this._assignGroupMembers,"onClick",c.hitch(this,this.onAssignGroupMembersClick))},_createFeaturedGroupsRow:function(a){var b=c.create,d=b("td",{colspan:"2",
innerHTML:"\x3cstrong\x3e"+this.i18n.groupsTab.featuredGroupsSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-gallery-links.png")},d);c.addClass(d,"titleColumn");this._featuredGroupsCol=b("td",null,a);c.addClass(this._featuredGroupsCol,"valignTop");b("label",{innerHTML:this.i18n.groupsTab.featuredGroupsDesc+"\x3cbr\x3e"},this._featuredGroupsCol)},
_createMFARow:function(a){var b=c.create,d='\x3cspan id\x3d"mfaHelp" class\x3d"my-org valignBottom"\x3e\x3ca id\x3d"mfaHelpLink" href\x3d"#" target\x3d"_blank"\x3e\x3cimg src\x3d"'+this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/helpIcon.png")+'"\x3e\x3c/a\x3e\x3c/span\x3e',e="\x3cstrong\x3e"+this.i18n.securityTab.multiFactorAuth+"\x3c/strong\x3e "+d+"\x3cbr\x3e\x3cbr\x3e",d=b("tr",null,a),e=b("td",{colspan:"2",innerHTML:e},d);this._mfaSettingTitleRow=d;c.addClass(e,"valignTop");
a=b("tr",null,a);d=b("td",null,a);this._mfaSettingRow=a;b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-mfa.png")},d);c.addClass(d,"titleColumn");a=b("td",null,a);c.addClass(a,"valignTop");b("label",{innerHTML:this.i18n.securityTab.multiFactorAuthDesc},a);b("br",null,a);b("br",null,a);e=b("tr",null,b("tbody",null,b("table",{cellpadding:"0",cellspacing:"0"},a)));d=b("td",null,e);e=b("td",null,e);c.addClass(d,"valignTop");this._mfaEnabled=new g.form.CheckBox({id:"mfaEnabled",
type:"checkbox"},b("span",null,d));b("label",{innerHTML:"\x26nbsp;"+this.i18n.securityTab.enableMultiFactorDesc+"\x3cbr\x3e"},e);this._mfaConfig=b("div",null,a);b("br",null,this._mfaConfig);b("label",{innerHTML:this.i18n.securityTab.adminRequirementDesc+"\x3cbr\x3e\x3cbr\x3e"},this._mfaConfig);a=b("tbody",null,b("table",{cellpadding:"0",cellspacing:"0"},this._mfaConfig));d=b("tr",null,a);a=b("tr",null,a);e=b("td",{width:"270px"},d);c.addClass(e,"valignTop");b("label",{innerHTML:this.i18n.securityTab.clickAddName+
"\x3cbr\x3e"},e);b("td",{width:"10px"},d);d=b("td",{width:"270px"},d);c.addClass(d,"valignTop");b("label",{innerHTML:this.i18n.securityTab.clickRemoveName},d);d=b("td",{width:"270px"},a);c.addClass(d,"valignTop");e=b("div",{innerHTML:"\x26nbsp;\x26nbsp;"+this.i18n.securityTab.adminHeader},d);c.addClass(e,"groupListLabel");d=new g.layout.BorderContainer({gutters:!1,splitters:!1,design:"headline",style:{height:"120px",backgroundColor:"#fff",border:"1px solid #999",overflow:"auto"}},b("div",null,d));
this._adminsToDesignatePane=(new g.layout.ContentPane({id:"adminsToDesignatePane",region:"middle",splitter:!1})).placeAt(d);c.addClass(this._adminsToDesignatePane,"groupListInnerContainer");b("td",{width:"10px"},a);a=b("td",{width:"270px"},a);c.addClass(a,"valignTop");d=b("div",{innerHTML:"\x26nbsp;\x26nbsp;"+this.i18n.securityTab.designatedAdminHeader},a);c.addClass(d,"featuredGroupListLabel");b=new g.layout.BorderContainer({gutters:!1,splitters:!1,design:"headline",style:{height:"120px",backgroundColor:"#fff",
border:"1px solid #999",overflow:"auto"}},b("div",null,a));c.addClass(b,"groupListContainer");this._designatedAdminsPane=(new g.layout.ContentPane({id:"designatedAdminsPane",region:"middle",splitter:!1})).placeAt(b);c.addClass(this._designatedAdminsPane,"groupListInnerContainer");c.connect(this._mfaEnabled,"onClick",c.hitch(this,this.toggleMFAConfig));c.connect(this._adminsToDesignatePane,"onClick",c.hitch(this,this.designateAdmin));c.connect(this._designatedAdminsPane,"onClick",c.hitch(this,this.removeDesignatedAdmin))},
_createSecuredHostsRow:function(a){var b=c.create,d=esri.substitute({type:this._getTenantTypeString()},this.i18n.securityTab.securedHostsDesc),e=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.securityTab.securedHostsSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a)),f=b("tr",null,a);a=b("td",null,f);f=b("td",null,f);c.addClass(e,"valignTop");c.addClass(a,"titleColumn");c.addClass(f,"valignTop");b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-secured-hosts.png")},
a);b("label",{innerHTML:d+"\x3cbr\x3e\x3cbr\x3e"},f);this._securedHosts=new arcgisonline.sharing.dijit.SecuredHosts({id:"securedHosts"},b("div",null,f))},_createGalleryAppsRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.groupsTab.galleryApps+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-gallery-apps.png")},
d);c.addClass(d,"titleColumn");a=b("td",{innerHTML:this.i18n.groupsTab.galleryAppsDesc+"\x3cbr\x3e\x3cbr\x3e"},a);c.addClass(a,"valignTop");this._galleryAppsSelect=new g.form.FilteringSelect({id:"galleryAppsSelect",style:{display:"inline-block"}},b("div",null,a));c.addClass(this._galleryAppsSelect,"gallerySelect");d=this._galleryAppsSortBySpan=b("span",{innerHTML:"\x26nbsp;\x26nbsp;"},a);b("label",{innerHTML:this.i18n.sortedByLabel+"\x26nbsp;"},d);this._galleryAppsSortBySelect=new arcgisonline.sharing.dijit.ComboBox({id:"galleryAppsSortBy",
searchAttr:"name",style:{display:"inline-block",width:"75px"}},b("span",null,d));b("span",{innerHTML:"\x26nbsp;\x26nbsp;"},d);this._galleryAppsSortBySelect.set("store",new c.store.Memory({data:this._getSortByData()}));c.addClass(this._galleryAppsSortBySelect,"gallerySelect");this._galleryAppsSortBySelect.set("value",this.i18n.sortFields.title);this._galleryAppsSortByCheckBox=new g.form.CheckBox({type:"checkbox",checked:!0},b("span",null,d));b("label",{innerHTML:"\x26nbsp;"+this.i18n.sortOrderLabel},
d);b("br",null,a);b("br",null,a);a=b("table",{id:"addEsriGalleryAppTemplatesTable",style:{display:"none"}},a);a=b("tr",null,b("tbody",null,a));this._addEsriGalleryAppTemplates=new g.form.CheckBox({id:"addEsriGalleryAppTemplates"},b("div",null,b("td",{className:"valignTop"},a)));b("label",{innerHTML:this.i18n.groupsTab.addEsriGalleryAppTemplates},b("td",{className:"valignTop"},a))},_createAGOLUtilServicesRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.agolTab.agolUtilSetting+
"\x3cstrong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a)),e=b("tr",null,a);a=b("td",null,e);e=b("td",null,e);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-utility-ago-services.png")},a);this._cfgAGOUtilServices=new arcgisonline.sharing.dijit.ConfigureAGOLUtilServices({id:"configureAGOLUtilServices"},b("div",null,e));c.addClass(d,"valignTop");c.addClass(a,"titleColumn");c.addClass(e,"valignTop");c.subscribe("configure-helperServices",c.hitch(this,this.onConfigureAGOServicesPublish))},
_createPrintingRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.utilityServicesTab.printingSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-utility-printing.png")},d);c.addClass(d,"titleColumn");a=b("td",null,a);c.addClass(a,"valignTop");b("label",{innerHTML:this.i18n.utilityServicesTab.printingDesc+
"\x3cbr\x3e\x3cbr\x3e"},a);this._printingService=new g.form.TextBox({placeHolder:this._isSingleTenant?this.i18n.defaultPortalSelection:this.i18n.defaultEsriSelection,trim:!0,style:{width:"30em"}},b("div",null,a));c.addClass(this._printingService.domNode,"orgTextBox");b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/css/images/spinner20.gif"),width:"14",height:"14",style:{verticalAlign:"middle"}},b("span",{id:"printingSpinner",style:{display:"none"},innerHTML:" "},a));b("br",null,a);
d=this.i18n.exampleLabel+" "+(this._isSingleTenant?this.i18n.utilityServicesTab.examplePrintService.replace("http:","https:"):this.i18n.utilityServicesTab.examplePrintService);b("label",{className:"example",innerHTML:d},a);b("br",null,a);b("br",null,a);this._printTemplates=new arcgisonline.sharing.dijit.PrintTemplates({id:"printTemplates"},b("div",{id:"printTemplatesContainer"},a));c.connect(this._printingService,"onChange",c.hitch(this,this.onPrintingServiceChange));c.connect(this._printingService,
"onKeyPress",c.hitch(this,this.onPrintingServiceKeyPress))},_moveGeocoderUp:function(a){var b,d,e,f=c.clone(this._geocodersGrid.store.query());for(b=0;b<f.length;b++)this._geocodersGrid.store.remove(b);b=a.id-1;e=b+1<this._geocodersGrid._grid.rowsPerPage?1:Math.ceil((b+1)/this._geocodersGrid._grid.rowsPerPage);f.splice(a.id,1);f.splice(b,0,a);for(b=0;b<f.length;b++)f[b].id=b,this._geocodersGrid.store.put(f[b]);d=this._geocodersGrid._grid.on("dgrid-refresh-complete",c.hitch(this,function(a){a.grid._currentPage!==
e&&a.grid.gotoPage(e);d.remove()}));this._geocodersGrid._grid.refresh()},_moveGeocoderDown:function(a){var b,d,e,f=c.clone(this._geocodersGrid.store.query());for(b=0;b<f.length;b++)this._geocodersGrid.store.remove(b);b=a.id+1;e=b+1<this._geocodersGrid._grid.rowsPerPage?1:Math.ceil((b+1)/this._geocodersGrid._grid.rowsPerPage);f.splice(a.id,1);f.splice(b,0,a);for(b=0;b<f.length;b++)f[b].id=b,this._geocodersGrid.store.put(f[b]);d=this._geocodersGrid._grid.on("dgrid-refresh-complete",c.hitch(this,function(a){a.grid._currentPage!==
e&&a.grid.gotoPage(e);d.remove()}));this._geocodersGrid._grid.refresh()},_geocodersGridColumns:function(){return{primary:{label:" ",sortable:!1,renderCell:c.hitch(this,function(a,b,d,e){b=c.create("span");var f=this._util.relativeToExplicitUrl("js/arcgisonline/map/css/images/LayerUp16.png");d=this._util.relativeToExplicitUrl("js/arcgisonline/map/css/images/LayerDown16.png");var g=this.i18n.utilityServicesTab.geocoderGrid.moveUp;e=this.i18n.utilityServicesTab.geocoderGrid.moveDown;0!==a.id&&(f=c.create("img",
{src:f,title:g,alt:g,className:"clickable"},b),c.connect(f,"onclick",c.hitch(this,this._moveGeocoderUp,a)));a.id<this._geocodersGrid.store.query().length-1&&(d=c.create("img",{src:d,title:e,alt:e,className:"clickable"},b),c.connect(d,"onclick",c.hitch(this,this._moveGeocoderDown,a)));return b})},name:{label:this.i18n.utilityServicesTab.geocoderGrid.nameCol,sortable:!1,formatter:c.hitch(this,function(a){return'\x3cspan class\x3d"esriContentTypeName"\x3e'+a+"\x3c/span\x3e"})},alter:{label:"  ",sortable:!1,
renderCell:c.hitch(this,function(a,b,d){if(a.esri)return"";b=this.i18n.utilityServicesTab.geocoderGrid.editTitle;d=this._util.relativeToExplicitUrl("js/arcgisonline/css/images/edit.png");b=c.create("img",{src:d,title:b,alt:b,className:"clickable"});c.connect(b,"onclick",c.hitch(this,function(){this._addGeocoderDlg.showConfig(c.clone(a))}));return b})},remove:{label:"  ",sortable:!1,renderCell:c.hitch(this,function(a,b,d){var e=this;b=e.i18n.utilityServicesTab.geocoderGrid.deleteTitle;d=e._util.relativeToExplicitUrl("images/delete_20x20.png");
b=c.create("img",{src:d,title:b,alt:b,className:"clickable"});c.connect(b,"onclick",function(){var b=e._geocodersGrid.store,d=c.clone(b.query()),g=e._geocodersGrid._grid?e._geocodersGrid._grid._currentPage:1,l,m;for(m=0;m<d.length;m++)b.remove(d[m].id);d.splice(a.id,1);for(m=0;m<d.length;m++)d[m].id=m,b.put(d[m]);b=Math.ceil(d.length/e._geocodersPerPage);g>b&&(g=b);l=e._geocodersGrid._grid.on("dgrid-refresh-complete",function(a){a.grid._currentPage!==g&&0<d.length&&a.grid.gotoPage(g);l.remove()});
e._geocodersGrid._grid.refresh()});return b})}}},_createGeocodingRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.utilityServicesTab.geocodingSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-utility-geocoding.png")},d);c.addClass(d,"titleColumn");a=b("td",null,a);c.addClass(a,"valignTop");d=
'\x3cspan id\x3d"geocodingTooltip" class\x3d"orgSettingTooltip" ';esri.isTouchEnabled&&(d+=' title\x3d"'+q.html.entities.encode(this.i18n.utilityServicesTab.geocodingTooltip)+'"');d+="\x3e";d=esri.substitute({type:this._getTenantTypeString(),startSpan:d,endSpan:"\x3c/span\x3e"},this.i18n.utilityServicesTab.geocodingDesc);this._geocodersDesc=b("label",{innerHTML:d+"\x3cbr\x3e\x3cbr\x3e"},a);this._addGeocoder=new g.form.Button({id:"addGeocoderBtn",label:this.i18n.utilityServicesTab.addGeocoder},b("div",
null,a));c.addClass(this._addGeocoder.domNode,["calcite","tertiary","small"]);b("br",null,a);b("br",null,a);this._geocodersGrid=new arcgisonline.sharing.dijit.Grid({columns:this._geocodersGridColumns(),id:"geocodersGrid",region:"center",noDataMessage:this.i18n.utilityServicesTab.geocoderGrid.noDataMsg,showLoadingMessage:!0,showHeader:!0,rowsPerPage:this._geocodersPerPage,pagingLinks:!0,selectionMode:"none",store:new c.store.Memory({identifier:"id",label:"name",data:[]}),sort:[{attribute:"id",descending:!1}]},
b("div",null,a));this._geocodersGrid.startup();this._geocodersGrid.refresh();c.connect(this._addGeocoder,"onClick",c.hitch(this,this.onAddGeocoder));c.subscribe("geocoder-added",c.hitch(this,this.onGeocoderAdded));c.subscribe("geocoder-altered",c.hitch(this,this.onGeocoderAltered))},_createGeometryRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.utilityServicesTab.geometrySetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a));c.addClass(d,"valignTop");
a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-utility-geometry.png")},d);c.addClass(d,"titleColumn");a=b("td",null,a);c.addClass(a,"valignTop");d='\x3cspan class\x3d"orgSettingTooltip" title\x3d"'+esri.substitute({type:this._getTenantTypeString()},this.i18n.utilityServicesTab.geometryDescTooltip)+'"\x3e';d=esri.substitute({startSpan:d,endSpan:"\x3c/span\x3e"},this.i18n.utilityServicesTab.geometryDesc);b("label",{innerHTML:d+
"\x3cbr\x3e\x3cbr\x3e"},a);this._geometryService=new g.form.TextBox({placeHolder:!this._isSingleTenant?this.i18n.defaultEsriSelection:"",trim:!0,style:{width:"30em"}},b("div",null,a));b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/css/images/spinner20.gif"),width:"14",height:"14",style:{verticalAlign:"middle"}},b("span",{id:"geometrySpinner",style:{display:"none"},innerHTML:" "},a));b("br",null,a);d=this.i18n.exampleLabel+" "+(this._isSingleTenant?this.i18n.utilityServicesTab.exampleGeometryService.replace("http:",
"https:"):this.i18n.utilityServicesTab.exampleGeometryService);b("label",{className:"example",innerHTML:d},a);c.connect(this._geometryService,"onChange",c.hitch(this,this.onGeometryServiceChange));c.connect(this._geometryService,"onKeyPress",c.hitch(this,this.onGeometryServiceKeyPress))},_createAnalysisRow:function(a){var b=c.create,d=b("tr",null,a),e=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.utilityServicesTab.analysisSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},d);a=b("tr",null,
a);var f=b("td",null,a),k=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-analysis.png")},f);b("label",{innerHTML:this.i18n.utilityServicesTab.analysisDesc+"\x3cbr\x3e\x3cbr\x3e"},k);this._analysisTitleRow=d;this._analysisRow=a;this._enableAnalysis=new g.form.Button({id:"enableAnalysisBtn",label:this.i18n.enable},b("div",null,k));this._disableAnalysis=new g.form.Button({id:"disableAnalysisBtn",label:this.i18n.disable},b("div",null,k));c.addClass(e,
"valignTop");c.addClass(f,"titleColumn");c.addClass(k,"valignTop");c.addClass(this._enableAnalysis.domNode,"calcite tertiary");c.addClass(this._disableAnalysis.domNode,"calcite caution");c.connect(this._enableAnalysis,"onClick",c.hitch(this,this.onEnableAnalysisClick));c.connect(this._disableAnalysis,"onClick",c.hitch(this,this.onDisableAnalysisClick))},_createGeoEnrichmentRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.utilityServicesTab.geoEnrichSetting+
"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-geoenrichment.png")},d);c.addClass(d,"titleColumn");a=b("td",null,a);c.addClass(a,"valignTop");b("label",{innerHTML:this.i18n.utilityServicesTab.geoEnrichDesc+"\x3cbr\x3e\x3cbr\x3e"},a);this._geoEnrichService=new g.form.TextBox({placeHolder:!this._isSingleTenant?this.i18n.defaultEsriSelection:
"",trim:!0,style:{width:"30em"}},b("div",null,a));b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/css/images/spinner20.gif"),width:"14",height:"14",style:{verticalAlign:"middle"}},b("span",{id:"geoEnrichSpinner",style:{display:"none"},innerHTML:" "},a));b("br",null,a);d=this.i18n.exampleLabel+" "+(this._isSingleTenant?this.i18n.utilityServicesTab.exampleGeoEnrichService.replace("http:","https:"):this.i18n.utilityServicesTab.exampleGeoEnrichService);b("label",{className:"example",innerHTML:d},
a);c.connect(this._geoEnrichService,"onChange",c.hitch(this,this.onGeoEnrichServiceChange));c.connect(this._geoEnrichService,"onKeyPress",c.hitch(this,this.onGeoEnrichServiceKeyPress))},_createHydrologyRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.utilityServicesTab.hydroSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a)),e=b("tr",null,a);a=b("td",null,e);e=b("td",null,e);c.addClass(d,"valignTop");c.addClass(a,"titleColumn");c.addClass(e,"valignTop");
b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-hydrology.png")},a);b("label",{innerHTML:this.i18n.utilityServicesTab.hydroDesc+"\x3cbr\x3e\x3cbr\x3e"},e);this._hydrologyService=new g.form.TextBox({placeHolder:!this._isSingleTenant?this.i18n.defaultEsriSelection:"",trim:!0,style:{width:"30em"}},b("div",null,e));b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/css/images/spinner20.gif"),width:"14",height:"14",style:{verticalAlign:"middle"}},
b("span",{id:"hydroSpinner",style:{display:"none"},innerHTML:" "},e));b("br",null,e);d=this.i18n.exampleLabel+" "+(this._isSingleTenant?this.i18n.utilityServicesTab.exampleHydroService.replace("http:","https:"):this.i18n.utilityServicesTab.exampleHydroService);b("label",{className:"example",innerHTML:d},e);c.connect(this._hydrologyService,"onChange",c.hitch(this,this.onHydroServiceChange));c.connect(this._hydrologyService,"onKeyPress",c.hitch(this,this.onHydroServiceKeyPress))},_createElevationRow:function(a){var b=
c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.utilityServicesTab.elevationSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a)),e=b("tr",null,a);a=b("td",null,e);e=b("td",null,e);c.addClass(d,"valignTop");c.addClass(a,"titleColumn");c.addClass(e,"valignTop");b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-elevation.png")},a);b("label",{innerHTML:this.i18n.utilityServicesTab.elevationDesc+"\x3cbr\x3e\x3cbr\x3e"},e);this._elevationSelect=
new g.form.FilteringSelect({searchAttr:"name",store:new c.data.ItemFileReadStore({data:{identifier:"id",label:"name",items:[{id:"elevation",name:this.i18n.utilityServicesTab.elevationServices.elevation},{id:"elevationSync",name:this.i18n.utilityServicesTab.elevationServices.elevationSync}]}})},b("div",null,e));this._elevationSelect.set("displayedValue",this.i18n.utilityServicesTab.elevationServices.elevation);b("br",null,e);b("br",null,e);this._elevationService=new g.form.TextBox({placeHolder:!this._isSingleTenant?
this.i18n.defaultEsriSelection:"",trim:!0,style:{width:"30em"}},b("div",null,e));b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/css/images/spinner20.gif"),width:"14",height:"14",style:{verticalAlign:"middle"}},b("span",{id:"elevationSpinner",style:{display:"none"},innerHTML:" "},e));b("br",null,e);b("span",null,e);b("label",{className:"example",innerHTML:this.i18n.exampleLabel},e);b("label",{className:"example",innerHTML:"\x26nbsp;"+this.i18n.utilityServicesTab.exampleElevationService},
e);c.connect(this._elevationSelect,"onChange",c.hitch(this,this.onElevationSelectChange));c.connect(this._elevationService,"onChange",c.hitch(this,this.onElevationServiceChange));c.connect(this._elevationService,"onKeyPress",c.hitch(this,this.onElevationServiceKeyPress))},_createNetworkRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.utilityServicesTab.networkSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a)),e=b("tr",null,a);a=b("td",null,e);e=
b("td",null,e);c.addClass(d,"valignTop");c.addClass(a,"titleColumn");c.addClass(e,"valignTop");b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-network.png")},a);b("label",{innerHTML:this.i18n.utilityServicesTab.networkDesc+"\x3cbr\x3e\x3cbr\x3e"},e);this._networkSelect=new g.form.FilteringSelect({searchAttr:"name",store:new c.data.ItemFileReadStore({data:{identifier:"id",label:"name",items:[{id:"closestFacility",name:this.i18n.utilityServicesTab.networkServices.closestFacility},
{id:"asyncClosestFacility",name:this.i18n.utilityServicesTab.networkServices.closestFacilityAsync},{id:"serviceArea",name:this.i18n.utilityServicesTab.networkServices.serviceArea},{id:"asyncServiceArea",name:this.i18n.utilityServicesTab.networkServices.serviceAreaAsync},{id:"syncVRP",name:this.i18n.utilityServicesTab.networkServices.vehicleRoute},{id:"asyncVRP",name:this.i18n.utilityServicesTab.networkServices.vehicleRouteAsync},{id:"asyncLocationAllocation",name:this.i18n.utilityServicesTab.networkServices.locationAllocationAsync},
{id:"routingUtilities",name:this.i18n.utilityServicesTab.networkServices.routingUtilities},{id:"traffic",name:this.i18n.utilityServicesTab.networkServices.traffic},{id:"asyncRoute",name:this.i18n.utilityServicesTab.networkServices.asyncRoute}]}})},b("div",null,e));this._networkSelect.set("displayedValue",this.i18n.utilityServicesTab.networkServices.closestFacility);b("br",null,e);b("br",null,e);this._networkService=new g.form.TextBox({placeHolder:!this._isSingleTenant?this.i18n.defaultEsriSelection:
"",trim:!0,style:{width:"30em"}},b("div",null,e));b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/css/images/spinner20.gif"),width:"14",height:"14",style:{verticalAlign:"middle"}},b("span",{id:"networkSpinner",style:{display:"none"},innerHTML:" "},e));b("br",null,e);b("span",null,e);b("label",{className:"example",innerHTML:this.i18n.exampleLabel},e);this._networkServiceExample=b("label",{className:"example"},e);c.connect(this._networkSelect,"onChange",c.hitch(this,this.onNetworkSelectChange));
c.connect(this._networkService,"onChange",c.hitch(this,this.onNetworkServiceChange));c.connect(this._networkService,"onKeyPress",c.hitch(this,this.onNetworkServiceKeyPress))},_travelModesGridColumns:function(){return{name:{label:this.i18n.utilityServicesTab.travelModesGrid.nameCol,sortable:!0,formatter:c.hitch(this,function(a){return'\x3cspan class\x3d"esriContentTypeName"\x3e'+a+"\x3c/span\x3e"})},desc:{label:this.i18n.utilityServicesTab.travelModesGrid.descCol,sortable:!1,renderCell:c.hitch(this,
function(a,b,d){return c.create("span",{className:"esriContentTypeName",innerHTML:b,title:a.fullDescription})})},copy:{label:"  ",sortable:!1,renderCell:c.hitch(this,function(a,b,d){b=this.i18n.utilityServicesTab.travelModesGrid.copyTitle;d=this._util.relativeToExplicitUrl("js/arcgisonline/css/images/copy.png");b=c.create("img",{src:d,title:b,alt:b,className:"clickable"});c.connect(b,"onclick",c.hitch(this,function(){var b=c.clone(a.travelMode);b.name=b.name+" "+this._travelModes.i18n.copy;b.id=null;
this._travelModesAddNew(b)}));return b})},alter:{label:"  ",sortable:!1,renderCell:c.hitch(this,function(a,b,d){b=this.i18n.utilityServicesTab.travelModesGrid.editTitle;d=this._util.relativeToExplicitUrl("js/arcgisonline/css/images/edit.png");b=c.create("img",{src:d,title:b,alt:b,className:"clickable"});c.connect(b,"onclick",c.hitch(this,function(){this._travelModesGrid.enable(!1);for(var b=[],d=this._travelModesGrid.store.query(),g=0;g<d.length;g++)a.name!==d[g].name&&b.push(d[g].name);this._travelModes.show(a.travelMode,
b).then(c.hitch(this,function(a){this._travelModesGridLoad(a)})).always(c.hitch(this,function(){this._travelModesGrid.enable(!0)}))}));return b})},remove:{label:"  ",sortable:!1,renderCell:c.hitch(this,function(a,b,d){b=this.i18n.utilityServicesTab.travelModesGrid.deleteTitle;d=this._util.relativeToExplicitUrl("images/delete_20x20.png");b=c.create("img",{src:d,title:b,alt:b,className:"clickable"});c.connect(b,"onclick",c.hitch(this,function(){1>=this._travelModesGrid.store.data.length?this._travelModesReset():
this._choiceDlg.show({title:this.i18n.utilityServicesTab.travelModes,message:this.i18n.utilityServicesTab.travelModesGrid.deleteQuestion,choiceOneTitle:this.i18n.utilityServicesTab.travelModesGrid.deleteAnswer,choiceOneHandler:c.hitch(this,function(){this._travelModesGrid.enable(!1);this._travelModes.deleteTravelMode(a.travelMode).then(c.hitch(this,function(a){this._travelModesGridLoad(a)})).always(c.hitch(this,function(){this._travelModesGrid.enable(!0)}))})})}));return b})}}},_travelModesAddNew:function(a){if(this._travelModes){for(var b=
[],d=this._travelModesGrid.store.query(),e=0;e<d.length;e++)b.push(d[e].name);this._travelModesGrid.enable(!1);this._travelModes.show(a,b).then(c.hitch(this,function(a){this._travelModesGridLoad(a)})).always(c.hitch(this,function(){this._travelModesGrid.enable(!0)}))}},_travelModesReset:function(){this._choiceDlg.show({title:this.i18n.utilityServicesTab.travelModes,message:this.i18n.utilityServicesTab.travelModesGrid.resetQuestion,choiceOneTitle:this.i18n.utilityServicesTab.travelModesGrid.resetAnswer,
choiceOneHandler:c.hitch(this,function(){this._travelModesGrid.enable(!1);this._travelModes.resetTravelModes().then(c.hitch(this,this._travelModesGridLoad)).always(c.hitch(this,function(){this._travelModesGrid.enable(!0)}))})})},_travelModesGridLoad:function(a){var b=this._travelModesGrid,c=this._travelModesDefault;b.store.setData([]);c.store.setData([]);for(var e in a)if(a.hasOwnProperty(e)){var f={id:a[e].id,name:a[e].name,desc:100<a[e].description.length?a[e].description.substr(0,97)+"...":a[e].description,
fullDescription:a[e].description,travelMode:a[e]};b.store.put(f);c.store.put(f)}b.refresh();c.store.data.length&&this._travelModes.getDefaultTravelModeId().then(function(a){(a=c.store.query({id:a})[0])||(a=c.store.query({},{sort:[{attribute:"name"}]})[0]);c.set("item",a)})},_createRoutingRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+(this._isSingleTenant?this.i18n.utilityServicesTab.routingSettingPortal:this.i18n.utilityServicesTab.routingSetting)+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},
b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-utility-routing.png")},d);c.addClass(d,"titleColumn");a=b("td",null,a);c.addClass(a,"valignTop");this._isSingleTenant||b("label",{innerHTML:"\x3cstrong\x3e"+this.i18n.utilityServicesTab.routingService+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},a);b("label",{innerHTML:(this._isSingleTenant?this.i18n.utilityServicesTab.routingDescPortal:
this.i18n.utilityServicesTab.routingDesc)+"\x3cbr\x3e\x3cbr\x3e"},a);this._routingService=new g.form.TextBox({placeHolder:!this._isSingleTenant?this.i18n.defaultEsriSelection:"",trim:!0,style:{width:"30em"}},b("div",null,a));c.addClass(this._routingService.domNode,"orgTextBox");b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/css/images/spinner20.gif"),width:"14",height:"14",style:{verticalAlign:"middle"}},b("span",{id:"routingSpinner",style:{display:"none"},innerHTML:" "},a));b("br",
null,a);d=this.i18n.exampleLabel+" "+(this._isSingleTenant?this.i18n.utilityServicesTab.exampleRouteService.replace("http:","https:"):this.i18n.utilityServicesTab.exampleRouteService);b("label",{className:"example",innerHTML:d},a);c.connect(this._routingService,"onChange",c.hitch(this,this.onRoutingServiceChange));c.connect(this._routingService,"onKeyPress",c.hitch(this,this.onRoutingServiceKeyPress));if(!this._isSingleTenant){var e;b("br",null,a);b("br",null,a);this._showTravelModes=new g.form.Button({id:"showTravelModeBtn",
label:this.i18n.utilityServicesTab.showTravelModes,onClick:c.hitch(this,function(){this._showTravelModes.set("label",e.style.display?this.i18n.utilityServicesTab.hideTravelModes:this.i18n.utilityServicesTab.showTravelModes);e.style.display=e.style.display?"":"none";this._travelModesGrid.refresh()})},b("div",null,a));c.addClass(this._showTravelModes.domNode,["calcite","tertiary","small"]);e=b("div",{id:"travel-modes-panel",style:"position: relative; display: none;"},a);b("label",{innerHTML:"\x3cbr\x3e\x3cstrong\x3e"+
this.i18n.utilityServicesTab.travelModes+'\x3c/strong\x3e\x26nbsp;\x26nbsp;\x3cspan id\x3d"travelModesHelp"\x3e\x3ca id\x3d"travelModesHelpLink" target\x3d"_blank"\x3e\x3cimg src\x3d"'+this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/helpIcon.png")+'"\x3e\x3c/a\x3e\x3c/span\x3e\x3cbr\x3e\x3cbr\x3e'},e);b("label",{innerHTML:this.i18n.utilityServicesTab.travelModeDesc+"\x3cbr\x3e\x3cbr\x3e"},e);b("label",{innerHTML:this.i18n.utilityServicesTab.defaultTravelMode+"\x26nbsp;"},
e);this._travelModesDefault=new arcgisonline.sharing.dijit.ComboBox({id:"travelModesDefault",store:new c.store.Memory({identifier:"id",label:"name",data:[]}),fetchProperties:{sort:[{attribute:"name",descending:!1}]},onChange:c.hitch(this,function(){this._travelModes._defaultId=this._travelModesDefault.item.id})},b("div",null,e));b("br",null,e);b("br",null,e);this._addTravelMode=new g.form.Button({id:"addTravelModeBtn",label:this.i18n.utilityServicesTab.addTravelMode,onClick:c.hitch(this,function(){this._travelModesAddNew()})},
b("div",null,e));c.addClass(this._addTravelMode.domNode,["calcite","tertiary","small"]);this._resetTravelMode=new g.form.Button({id:"resetTravelModeBtn",label:this.i18n.utilityServicesTab.resetTravelMode,onClick:c.hitch(this,function(){this._travelModesReset()})},b("div",null,e));c.addClass(this._resetTravelMode.domNode,["calcite","transparent","small"]);b("br",null,e);b("br",null,e);this._travelModesGrid=new arcgisonline.sharing.dijit.Grid({columns:this._travelModesGridColumns(),id:"travelModesGrid",
region:"center",noDataMessage:this.i18n.utilityServicesTab.travelModesGrid.noDataMsg,showLoadingMessage:!0,showHeader:!0,rowsPerPage:10,pagingLinks:!0,selectionMode:"none",store:new c.store.Memory({identifier:"id",label:"name",data:[]}),sort:[{attribute:"name",descending:!1}]},b("div",null,e));this._travelModesGrid.startup();this._travelModesGrid.refresh();this._travelModesGrid._waitingDiv=b("div",{id:"travelModesWaiting"},e);this._travelModesGrid.enable=function(a){this._waitingDiv.style.display=
a?"none":""}}},_createFederatedServersRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.serversTab.federatedSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-federated-servers.png")},d);c.addClass(d,"titleColumn");a=b("td",null,a);c.addClass(a,"valignTop");b("label",{innerHTML:esri.substitute({type:this._getTenantTypeString()},
this.i18n.serversTab.federatedDesc)+"\x3cbr\x3e\x3cbr\x3e"},a);d=b("span",null,a);this._federateServerBtn=new g.form.Button({label:this.i18n.serversTab.federateServerLabel},b("div",null,d));c.addClass(this._federateServerBtn.domNode,["calcite","tertiary","small"]);b("br",null,a);b("br",null,a);d=[[{get:this.federatedServerStatusFormatter,formatter:arcgisonline.sharing.util.fix,width:"16px"},{name:this.i18n.serversTab.federatedServersColumn,get:this.federatedServerFormatter,formatter:arcgisonline.sharing.util.fix,
width:"100%"},{get:this.removeFederatedServerFormatter,formatter:arcgisonline.sharing.util.fix,width:"25px"}]];this._federatedServersStore=new c.data.ItemFileWriteStore({data:{identifier:"url",label:"url",items:[]}});this._federatedServersGrid=arcgisonline.sharing.dijit.DataGrid({store:this._federatedServersStore,structure:d,rowsPerPage:this._federatedServersRows,noDataMessage:this.i18n.serversTab.federatedGridNoData,selectionMode:"none",clientSort:!1,canSort:arcgisonline.sharing.dijit.Organization.util.serversNoSort,
id:"federatedServersGridNode"},b("div",{style:{height:"200px"}},a));this._federatedServersGrid.startup();c.addClass(this._federatedServersGrid.domNode,"borderedContent");c.connect(this._federateServerBtn,"onClick",c.hitch(this,this.onFederateServerClick));c.subscribe("federate-server-register",c.hitch(this,this.onAddFederatedServer))},_createHostedServerRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.serversTab.hostedSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},
b("tr",null,a));c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-hosted-server.png")},d);c.addClass(d,"titleColumn");a=b("td",null,a);c.addClass(a,"valignTop");b("label",{innerHTML:esri.substitute({type:this._getTenantTypeString()},this.i18n.serversTab.hostedDesc)+"\x3cbr\x3e\x3cbr\x3e"},a);this._hostedServerSelect=new arcgisonline.sharing.dijit.ComboBox({id:"hostedServerSelect"},b("div",null,
a));this._hostedServerSelectStore=new c.data.ItemFileWriteStore({data:{identifier:"id",label:"name",items:[{name:this.i18n.noHostedServer,group:null,id:0}]}});this._hostedServerSelect.set("store",this._hostedServerSelectStore);c.connect(this._hostedServerSelect,"onChange",c.hitch(this,this.onHostedServerSelectChange))},_createCreditBudgetRow:function(a){var b=c.create,d=b("tr",null,a),d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.creditsTab.creditBudgetSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},
d),e=b("tr",null,a);a=b("td",null,e);e=b("td",null,e);c.addClass(d,"valignTop");c.addClass(a,"titleColumn");c.addClass(e,"valignTop");b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-credit-budget.png")},a);b("div",{innerHTML:this.i18n.creditsTab.creditBudgetDesc+"\x3cbr\x3e\x3cbr\x3e"},e);this._enableCreditBudget=new g.form.CheckBox({id:"creditBudgetChkBox"},b("div",null,e));b("label",{"for":"creditBudgetChkBox",innerHTML:"\x26nbsp;"+this.i18n.creditsTab.enableCreditBudget},
e);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/css/images/spinner20.gif"),width:"14",height:"14",style:{verticalAlign:"middle"}},b("span",{id:"creditSpinner",style:{display:"none"},innerHTML:"\x26nbsp;\x26nbsp;"},e));this._creditBudgetToolContainer=b("div",null,e);b("br",null,this._creditBudgetToolContainer);this._assignCredits=new g.form.Button({id:"assignCreditsBtn",label:this.i18n.creditsTab.createBudget},b("div",null,this._creditBudgetToolContainer));c.addClass(this._assignCredits.domNode,
"calcite tertiary small");c.style(this._creditBudgetToolContainer,"display","none");c.connect(this._enableCreditBudget,"onClick",c.hitch(this,this.onEnableCreditBudget));c.connect(this._assignCredits,"onClick",c.hitch(this,this.onAssignCredits));c.subscribe("credits-change",c.hitch(this,this.onCreditChange))},_createPoliciesRow:function(a){var b=c.create,d=b("tr",null,a),d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.securityTab.policiesSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},d);
c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-security-policies.png")},d);c.addClass(d,"titleColumn");a=b("td",null,a);c.addClass(a,"valignTop");a=b("tbody",null,b("table",null,a));var d=b("tr",null,a),e=b("td",null,d),f=b("td",null,d);c.addClass(e,"valignTop");var k=q.html.entities.encode(this.i18n.securityTab.sslTooltip),h='\x3cspan id\x3d"sslTooltip" class\x3d"orgSettingTooltip" ',d=this._getTenantTypeString();
esri.isTouchEnabled&&(h+='title\x3d"'+k+'"');k=esri.substitute({type:d,startSpan:h+"\x3e",endSpan:"\x3c/span\x3e"},this.i18n.securityTab.sslDesc);this._allSSL=new g.form.CheckBox({id:"allSSLCheckBox",value:!1,checked:!1},b("div",null,e));b("label",{innerHTML:" "+k},f);this._createSpacerRow(a);f=b("tr",null,a);e=b("td",null,f);f=b("td",null,f);c.addClass(e,"valignTop");k=q.html.entities.encode(this.i18n.securityTab.anonTooltip);h='\x3cspan id\x3d"anonymousTooltip" style\x3d"border-bottom:1px dotted #487696;" ';
esri.isTouchEnabled&&(h+='title\x3d"'+k+'"');h+="\x3e";this._isSingleTenant?d=esri.substitute({type:d,startSpan:h,endSpan:"\x3c/span\x3e"},this.i18n.securityTab.anonDescPortal):(d=esri.substitute({type:d,startSpan:h,endSpan:"\x3c/span\x3e",website:'\x3cspan id\x3d"anonDescUrl"\x3e\x3c/span\x3e'},this.i18n.securityTab.anonDesc),d+='\x3cbr\x3e\x3cspan class\x3d"esriItemLinks"\x3e\x3ca href\x3d"#" id\x3d"anonDescDocUrl" target\x3d"_blank"\x3e'+this.i18n.securityTab.anonDescDoc+"\x3c/a\x3e\x3c/span\x3e");
this._anonAccess=new g.form.CheckBox({id:"anonAccessCheckBox",value:!1,checked:!1},b("div",null,e));b("label",{innerHTML:" "+d},f);this._createSpacerRow(a);a=b("tr",null,a);d=b("td",null,a);e=b("td",null,a);c.addClass(d,"valignTop");this._useStdSQL=new g.form.CheckBox({id:"useStdSQLCheckBox",value:!1,checked:!1},b("div",null,d));b("label",{innerHTML:" "+this.i18n.securityTab.useStdSQLDesc},e);this._isSingleTenant&&c.style(a,"display","none");c.connect(this._allSSL,"onChange",c.hitch(this,this.onAllSSLChange));
c.connect(this._anonAccess,"onChange",c.hitch(this,this.onAnonymousAccessChanged))},_createSharingAndSearchingRow:function(a){var b=c.create,d=b("tr",null,a),e=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.generalTab.shareSearchSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},d);c.addClass(e,"valignTop");a=b("tr",null,a);e=b("td",null,a);c.addClass(e,"titleColumn");b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-general-sharing.png")},e);e=b("td",
null,a);c.addClass(e,"valignTop");var f=b("span",null,e);this._shareToPublic=new g.form.CheckBox({type:"checkbox"},b("div",null,f));b("label",{innerHTML:"\x26nbsp;"+this.i18n.generalTab.shareToPublic},f);b("div",{className:"spacerRow",innerHTML:"\x26nbsp;"},e);e=b("span",null,e);this._searchPublic=new g.form.CheckBox({type:"checkbox"},b("div",null,e));b("label",{innerHTML:"\x26nbsp;"+this.i18n.generalTab.searchPublic},e);this._isSingleTenant&&(c.style(d,"display","none"),c.style(a,"display","none"))},
_createAdminContactsRow:function(a){var b=c.create,d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.generalTab.adminContacts+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},b("tr",null,a)),e=b("tr",null,a);a=b("td",null,e);e=b("td",null,e);c.addClass(d,"valignTop");c.addClass(a,"titleColumn");c.addClass(e,"valignTop");b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb_admin_contacts.png")},a);b("label",{innerHTML:this.i18n.generalTab.adminContactsDesc},
e);b("br",null,e);b("br",null,e);d=b("tbody",null,b("table",{cellpadding:"0",cellspacing:"0"},e));a=b("tr",null,d);d=b("tr",null,d);e=b("td",{width:"270px"},a);c.addClass(e,"valignTop");b("label",{innerHTML:this.i18n.securityTab.clickAddName+"\x3cbr\x3e"},e);b("td",{width:"10px"},a);a=b("td",{width:"270px"},a);c.addClass(a,"valignTop");b("label",{innerHTML:this.i18n.securityTab.clickRemoveName},a);a=b("td",{width:"270px"},d);c.addClass(a,"valignTop");e=b("div",{innerHTML:"\x26nbsp;\x26nbsp;"+this.i18n.securityTab.adminHeader},
a);c.addClass(e,"groupListLabel");a=new g.layout.BorderContainer({gutters:!1,splitters:!1,design:"headline",style:{height:"120px",backgroundColor:"#fff",border:"1px solid #999",overflow:"auto"}},b("div",null,a));this._adminContactsToDesignatePane=(new g.layout.ContentPane({id:"adminContactsToDesignatePane",region:"middle",splitter:!1})).placeAt(a);c.addClass(this._adminContactsToDesignatePane,"groupListInnerContainer");b("td",{width:"10px"},d);d=b("td",{width:"270px"},d);c.addClass(d,"valignTop");
a=b("div",{innerHTML:"\x26nbsp;\x26nbsp;"+this.i18n.securityTab.designatedAdminHeader},d);c.addClass(a,"featuredGroupListLabel");b=new g.layout.BorderContainer({gutters:!1,splitters:!1,design:"headline",style:{height:"120px",backgroundColor:"#fff",border:"1px solid #999",overflow:"auto"}},b("div",null,d));c.addClass(b,"groupListContainer");this._designatedAdminContactsPane=(new g.layout.ContentPane({id:"designatedAdminContactsPane",region:"middle",splitter:!1})).placeAt(b);c.addClass(this._designatedAdminContactsPane,
"groupListInnerContainer");c.connect(this._adminContactsToDesignatePane,"onClick",c.hitch(this,this.designateAdminContact));c.connect(this._designatedAdminContactsPane,"onClick",c.hitch(this,this.removeDesignatedAdminContact))},_createLinksRow:function(a){var b=c.create,d=b("tr",null,a),d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+this.i18n.generalTab.linksSetting+"\x3c/strong\x3e"},d);c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);c.addClass(d,"titleColumn");b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-links.png")},
d);a=b("td",null,a);c.addClass(a,"valignTop");b("label",{innerHTML:this.i18n.generalTab.linksDesc+"\x3cbr\x3e\x3cbr\x3e"},a);d=b("tr",null,b("tbody",null,b("table",null,a)));a=b("td",{style:{width:"15em"}},d);d=b("td",null,d);c.addClass(a,"valignTop");c.addClass(d,"valignTop");this._contactUsVisible=new g.form.CheckBox({id:"contactUsVisible"},b("div",null,a));var e='\x3cspan class\x3d"orgSettingTooltip" ';esri.isTouchEnabled&&(e+='title\x3d"'+q.html.entities.encode(this.i18n.generalTab.footerLinks.contactUsTooltip)+
'"');e=esri.substitute({startSpan:e+"\x3e",endSpan:"\x3c/span\x3e"},this.i18n.generalTab.footerLinks.contactUs);b("label",{id:"contactUsLinkTooltip","for":"contactUsVisible",innerHTML:"\x26nbsp;"+e},a);this._contactUsLink=new g.form.TextBox({id:"contactUsLink",trim:!0,style:{width:"25em"},placeholder:this.i18n.generalTab.footerLinks.contactUsExample},b("div",null,d))},_createSignInOptionsRow:function(a){var b=c.create;this._signInTitleRow=b("tr",null,a);var d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+
this.i18n.securityTab.signInSetting+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},this._signInTitleRow);c.addClass(d,"valignTop");this._signInRow=b("tr",null,a);a=b("td",null,this._signInRow);c.addClass(this._signInRow,"titleColumn");b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-sign-in-options.png")},a);a=b("td",null,this._signInRow);c.addClass(a,"valignTop");this._signInDesc=b("label",{innerHTML:"\x3cbr\x3e\x3cbr\x3e"},a);d=b("span",null,a);this._arcgisSignIn=
new g.form.RadioButton({id:"arcgisSignInOption",name:"signInOption",checked:!0},b("div",null,d));this._arcgisSignInLabel=b("label",{"for":"arcgisSignInOption",innerHTML:"\x26nbsp;\x26nbsp;"},d);b("br",null,a);b("br",null,a);a=b("span",null,a);this._enterpriseSignIn=new g.form.RadioButton({id:"enterpriseSignInOption",name:"signInOption",checked:!1},b("div",null,a));this._enterpriseSignInLabel=b("label",{"for":"enterpriseSignInOption",innerHTML:"\x26nbsp;\x26nbsp;"},a)},_createPasswordPolicyRow:function(a){var b=
c.create,d=this.i18n.securityTab.pwdPolicySetting,e=b("tr",null,a),d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+d+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},e),e=b("tr",null,a);a=b("td",null,e);var e=b("td",null,e),f=c.hitch(this,function(){this._pwdPolicyDlg.show(this._securityPolicy)}),k=c.hitch(this,function(){this._deleteWarnDlg.showMsgTitleButton(this.i18n.securityTab.removePolicyMsg+"\x3cbr\x3e\x3cbr\x3e"+this.i18n.securityTab.doRemovePolicyMsg,this.i18n.securityTab.useDefaultPwdPolicy,this.i18n.yesLabel,
c.hitch(this,this.reallyRemoveSecurityPolicy));c.removeClass(g.byId("button_delete-warning-submit").domNode,"orange");c.addClass(g.byId("button_delete-warning-submit").domNode,"blue")});b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-password-policy.png")},a);b("label",{innerHTML:(this._isSingleTenant?this.i18n.securityTab.pwdPolicyPortalDesc:this.i18n.securityTab.pwdPolicyDesc)+"\x3cbr\x3e\x3cbr\x3e"},e);this._editPwdPolicy=new g.form.Button({id:"editPwdPolicy",
type:"button",label:this.i18n.securityTab.updatePwdPolicy},b("div",null,e));this._removePwdPolicy=new g.form.Button({id:"removePwdPolicy",type:"button",label:this._isSingleTenant?this.i18n.securityTab.useDefaultPortalPwdPolicy:this.i18n.securityTab.useDefaultPwdPolicy},b("div",null,e));c.addClass(d,"valignTop");c.addClass(a,"titleColumn");c.addClass(e,"valignTop");c.addClass(this._editPwdPolicy.domNode,["calcite","tertiary","small"]);c.addClass(this._removePwdPolicy.domNode,["calcite","caution","small"]);
c.style(this._removePwdPolicy.domNode,"display","none");c.connect(this._editPwdPolicy,"onClick",f);c.connect(this._removePwdPolicy,"onClick",k);c.subscribe("password-policy-change",c.hitch(this,this._retrieveSecurityPolicy))},_createEnterpriseLoginsRow:function(a){var b=c.create,d=b("tr",null,a),d=b("td",{colspan:"2",innerHTML:"\x3cstrong\x3e"+(this._isSingleTenant?this.i18n.securityTab.enterpriseLoginsPortalSetting:this.i18n.securityTab.enterpriseLoginsSetting)+"\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e"},
d);c.addClass(d,"valignTop");a=b("tr",null,a);d=b("td",null,a);c.addClass(d,"titleColumn");b("img",{src:this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-security-enterprise-login.png")},d);a=b("td",null,a);c.addClass(a,"valignTop");var e;e=this._isSingleTenant?this.i18n.securityTab.aboutIdentityFederationPortal+"\n\r"+this.i18n.securityTab.onceFederatedPortal+"\n\r"+this.i18n.securityTab.useSetIdentityProviderPortal+"\n\r"+this.i18n.securityTab.useGetServiceProviderPortal:
this.i18n.securityTab.aboutIdentityFederation+"\n\r"+this.i18n.securityTab.onceFederated+"\n\r"+this.i18n.securityTab.useSetIdentityProvider+"\n\r"+this.i18n.securityTab.useGetServiceProvider;d='\x3cspan id\x3d"idpTooltip" style\x3d"border-bottom:1px dotted #487696;" ';esri.isTouchEnabled&&(d+='title\x3d"'+e+'"');e=this._isSingleTenant?this.i18n.securityTab.enterpriseLoginsPortalDesc:this.i18n.securityTab.enterpriseLoginsDesc;e+="\x3cbr\x3e\x3cbr\x3e"+esri.substitute({tooltipStart:d+"\x3e",tooltipEnd:"\x3c/span\x3e"},
this.i18n.securityTab.identityFederationDesc);b("label",{innerHTML:e+"\x3cbr\x3e\x3cbr\x3e"},a);this._setIdentityProvider=new g.form.Button({id:"setIdentityProvider",type:"button",label:this.i18n.securityTab.setIdentityProvider},b("div",null,a));this._editIdentityProvider=new g.form.Button({id:"editIdentityProvider",type:"button",label:this.i18n.securityTab.editIdentityProvider},b("div",null,a));this._removeIdentityProvider=new g.form.Button({id:"removeIdentityProvider",type:"button",label:this.i18n.securityTab.removeIdentityProvider},
b("div",null,a));this._getServiceProvider=new g.form.Button({id:"getServiceProvider",type:"button",label:this.i18n.securityTab.getServiceProvider},b("div",null,a));c.addClass(this._setIdentityProvider.domNode,["calcite","tertiary","small"]);c.addClass(this._editIdentityProvider.domNode,["calcite","tertiary","small"]);c.addClass(this._removeIdentityProvider.domNode,["calcite","caution","small"]);c.addClass(this._getServiceProvider.domNode,["calcite","tertiary","small"]);c.style(this._editIdentityProvider.domNode,
"display","none");c.style(this._removeIdentityProvider.domNode,"display","none");c.connect(this._setIdentityProvider,"onClick",c.hitch(this,function(){this._setIdentityProviderDlg.show()}));c.connect(this._editIdentityProvider,"onClick",c.hitch(this,function(){this._setIdentityProviderDlg.edit(this._currentIdentityProvider)}));c.connect(this._removeIdentityProvider,"onClick",c.hitch(this,function(){this._deleteWarnDlg.showMsgTitleButton(this.i18n.securityTab.removingIdentityProvider+"\x3cbr\x3e\x3cbr\x3e"+
this.i18n.securityTab.doRemoveIdentityProvider,this.i18n.securityTab.removeIdentityProvider,this.i18n.yesLabel,c.hitch(this,this.reallyRemoveIdentityProvider));c.removeClass(g.byId("button_delete-warning-submit").domNode,"orange");c.addClass(g.byId("button_delete-warning-submit").domNode,"caution")}));c.connect(this._getServiceProvider,"onClick",c.hitch(this,function(){window.open(esriGeowConfig.restBaseUrl+"portals/self/sp/metadata"+this._token,"_blank")}));c.subscribe("setIdentityProvider",c.hitch(this,
this.onSetIdentityProvider))},reallyRemoveSecurityPolicy:function(){c.removeClass(g.byId("button_delete-warning-submit").domNode,"blue");c.addClass(g.byId("button_delete-warning-submit").domNode,"orange");esri.isDefined(this._securityPolicy)&&this._util.request({url:this._util.getSecureUrl(esriGeowConfig.restBaseUrl)+"/portals/self/securitypolicy/reset"},{usePost:!0}).then(c.hitch(this,function(a){a&&!a.code&&!a.message?(c.publish("password-policy-change",[]),this._generalDlg.show({title:this.i18n.notice,
message:this.i18n.securityTab.pwdPolicyReset})):(console.log("revert password policy error",a),this._generalDlg.show({title:this.i18n.notice,message:this.i18n.securityTab.pwdPolicyUnableToDelete}))}),c.hitch(this,function(a){console.log("unexpected revert password policy error",a);this._generalDlg.show({title:this.i18n.notice,message:this.i18n.securityTab.pwdPolicyUnableToDelete})}))},reallyRemoveIdentityProvider:function(){esri.isDefined(this._currentIdentityProvider)&&this._util.request({url:esriGeowConfig.restBaseUrl+
"/portals/self/idp/"+this._currentIdentityProvider.id+"/unregister"},{usePost:!0}).then(c.hitch(this,function(a){esri.isDefined(a)&&!a.error&&(this._currentIdentityProvider=null,this._setEnterpriseIdentityProvider())}),c.hitch(this,function(a){this._generalDlg.show({title:this.i18n.errorLabel,message:this.i18n.securityTab.couldNotRemoveIdentityProvider})}))},_setupGeneralTab:function(){var a=this._createTab(this.i18n.generalTab.tabTitle),b=this._createTabTable(this._createTabPanel(this._createGeneralTabAbstract(),
a));this._createNameLogoRow(b);this._createSpacerRow(b);this._isSingleTenant||(this._createContactRow(b),this._createSpacerRow(b));this._createDescriptionRow(b);this._createSpacerRow(b);this._createSummaryRow(b);this._createSpacerRow(b);this._createLanguageRow(b);this._createSpacerRow(b);this._isSingleTenant||(this._createRegionRow(b),this._createSpacerRow(b),this._createAdminContactsRow(b),this._createSpacerRow(b));this._createLinksRow(b);this._generalTab=this._createTabContainer(this.i18n.generalTab.tabTitle,
a,!0);this._editTabs.addChild(this._generalTab)},_setupRolesTab:function(){var a=this.i18n.rolesTab.tabTitle+' \x3cspan id\x3d"customRolesHelp"\x3e\x3ca id\x3d"customRolesHelpLink" target\x3d"_blank"\x3e\x3cimg src\x3d"'+this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/helpIcon.png")+'"\x3e\x3c/a\x3e\x3c/span\x3e',a=this._createTab(a);this._rolesTabPanel=this._createWidgetTabPanel("",a);this._rolesTab=this._createTabContainer(this.i18n.rolesTab.tabTitle,a);this._editTabs.addChild(this._rolesTab);
c.connect(this._rolesTab,"onShow",c.hitch(this,function(){this._roles&&this._roles._started&&this._roles.refresh()}))},_setupHomePageTab:function(){var a=this._createTab(this.i18n.homeTab.tabTitle),b=this._createTabTable(this._createTabPanel(this._createHomePageTabAbstract(),a));this._createBackgroundRow(b);this._createSpacerRow(b);this._createBannerRow(b);this._createSpacerRow(b);this._createFeaturedMapsRow(b);this._homePageTab=this._createTabContainer(this.i18n.homeTab.tabTitle,a);this._editTabs.addChild(this._homePageTab)},
_setupGalleryTab:function(){var a=this._createTab(this.i18n.galleryTab.tabTitle),b=this._createTabTable(this._createTabPanel(this._createGalleryTabAbstract(),a));this._createGalleryRow(b);this._galleryTab=this._createTabContainer(this.i18n.galleryTab.tabTitle,a);this._editTabs.addChild(this._galleryTab)},_setupMapTab:function(){var a=this._createTab(this.i18n.mapTab.tabTitle),b=this._createTabTable(this._createTabPanel(this._createMapTabAbstract(),a));this._createBasemapGalleryRow(b);this._createSpacerRow(b);
this._createDefaultBasemapRow(b);this._createSpacerRow(b);this._createDefaultExtentRow(b);this._createSpacerRow(b);this._createBingMapsRow(b);this._createSpacerRow(b);this._createWebMapTemplatesRow(b);this._createSpacerRow(b);this._createUnitsRow(b);this._mapTab=this._createTabContainer(this.i18n.mapTab.tabTitle,a);this._editTabs.addChild(this._mapTab)},_setupItemDetailsTab:function(){var a=this._createTab(this.i18n.itemDetailsTab.tabTitle),b=this._createTabTable(this._createTabPanel(this._createItemDetailsTabAbstract(),
a));this._createCommentsRow(b);esriGeowConfig.metadataEnabled&&(this._createSpacerRow(b),this._createMetadataRow(b));this._itemDetailsTab=this._createTabContainer(this.i18n.itemDetailsTab.tabTitle,a);this._editTabs.addChild(this._itemDetailsTab)},_setupGroupsTab:function(){var a=this._createTab(this.i18n.groupsTab.tabTitle),b=this._createTabTable(this._createTabPanel(this._createGroupsTabAbstract(),a));this._createGroupAssignmentRow(b);this._createSpacerRow(b);this._createFeaturedGroupsRow(b);this._createSpacerRow(b);
this._createGalleryAppsRow(b);this._groupsTab=this._createTabContainer(this.i18n.groupsTab.tabTitle,a);this._editTabs.addChild(this._groupsTab)},_setupUtilityServicesTab:function(){var a=this._createTab(this.i18n.utilityServicesTab.tabTitle),b=this._createTabTable(this._createTabPanel(this._createUtilityServicesTabAbstract(),a));c.addClass(a,"utilityServicesPanel");this._createPrintingRow(b);this._isSingleTenant&&(this._createSpacerRow(b),this._createGeometryRow(b),this._createSpacerRow(b),this._createGeoEnrichmentRow(b),
this._createSpacerRow(b),this._createHydrologyRow(b),this._createSpacerRow(b),this._createElevationRow(b),this._createSpacerRow(b),this._createNetworkRow(b));this._createSpacerRow(b);this._createGeocodingRow(b);this._createSpacerRow(b);this._createRoutingRow(b);this._utilityServicesTab=this._createTabContainer(this.i18n.utilityServicesTab.tabTitle,a);this._editTabs.addChild(this._utilityServicesTab);c.connect(this._utilityServicesTab,"onShow",c.hitch(this,function(){this._geocodersGrid&&this._geocodersGrid._started&&
(this._geocodersGrid._grid.resize(),this._geocodersGrid._grid.refresh());this._printTemplates&&this._printTemplates._started&&this._printTemplates.refresh();this._isSingleTenant||(this._travelModesGrid&&this._travelModesGrid._started&&(this._travelModesGrid._grid.resize(),this._travelModesGrid._grid.refresh()),this._travelModes._grid&&this._travelModes._grid._started&&(this._travelModes._grid._grid.resize(),this._travelModes._grid._grid.refresh()))}))},_setupServersTab:function(){var a=this._createTab(this.i18n.serversTab.tabTitle),
b=this._createTabTable(this._createTabPanel(this._createServersTabAbstract(),a));this._createFederatedServersRow(b);esriGeowConfig.hostedServerConfigEnabled&&(this._createSpacerRow(b),this._createHostedServerRow(b),this._createSpacerRow(b),this._createAnalysisRow(b));this._serversTab=this._createTabContainer(this.i18n.serversTab.tabTitle,a);this._editTabs.addChild(this._serversTab);c.connect(this._serversTab,"onShow",c.hitch(this,function(){if(this._federatedServers&&this._federatedServers.current&&
0<this._federatedServers.current.length)this.onValidateServers()}))},_setupAGOLTab:function(){var a=this._createTab(this.i18n.agolTab.tabTitle),b=this._createTabTable(this._createTabPanel(this._createAGOLTabAbstract(),a));this._createAGOLUtilServicesRow(b);this._agolTab=this._createTabContainer(this.i18n.agolTab.tabTitle,a);this._editTabs.addChild(this._agolTab)},_setupCreditsTab:function(){var a=this.i18n.creditsTab.tabTitle+' \x3cspan id\x3d"creditsHelp"\x3e\x3ca id\x3d"creditsHelpLink" target\x3d"_blank"\x3e\x3cimg src\x3d"'+
this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/helpIcon.png")+'"\x3e\x3c/a\x3e\x3c/span\x3e',a=this._createTab(a),b=this._createTabTable(this._createTabPanel(this._createCreditsTabAbstract(),a));this._createCreditBudgetRow(b);this._creditsTab=this._createTabContainer(this.i18n.creditsTab.tabTitle,a);this._editTabs.addChild(this._creditsTab)},_setupSecurityTab:function(){var a=this._createTab(this.i18n.securityTab.tabTitle),b=this._createTabTable(this._createTabPanel(this._createSecurityTabAbstract(),
a));this._createPoliciesRow(b);this._createSpacerRow(b);this._createSharingAndSearchingRow(b);esriGeowConfig.passwordPolicyEnabled&&(this._createSpacerRow(b),this._createPasswordPolicyRow(b));esriGeowConfig.enterpriseLoginConfigEnabled&&(this._createSpacerRow(b),this._createEnterpriseLoginsRow(b),this._createSpacerRow(b),this._createSignInOptionsRow(b));this._isSingleTenant||(this._createSpacerRow(b),this._createMFARow(b));this._createSpacerRow(b);this._createSecuredHostsRow(b);this._securityTab=
this._createTabContainer(this.i18n.securityTab.tabTitle,a);this._editTabs.addChild(this._securityTab);c.connect(this._securityTab,"onShow",c.hitch(this,function(){this._securedHosts&&this._securedHosts.refresh()}))},_setupOpenDataTab:function(){var a=this.i18n.openDataTab.tabFullTitle+' \x3cspan id\x3d"openDataHelp"\x3e\x3ca id\x3d"openDataHelpLink" target\x3d"_blank"\x3e\x3cimg src\x3d"'+this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/helpIcon.png")+'"\x3e\x3c/a\x3e\x3c/span\x3e',
a=this._createTab(a);this._openDataTabPanel=this._createWidgetTabPanel("",a);this._openDataTab=this._createTabContainer(this.i18n.openDataTab.tabTitle,a);this._editTabs.addChild(this._openDataTab)},_createRegionSelectStore:function(){this._regionSelectStore=new c.data.ItemFileReadStore({data:{identifier:"region",label:"localizedName",items:[]}});this._regionSelect.set("store",this._regionSelectStore)},_createLanguageSelectStore:function(){this._languageSelectStore=new c.data.ItemFileReadStore({data:{identifier:"culture",
label:"name",items:[]}});this._languageSelect.set("store",this._languageSelectStore)},_createGalleryAppsSelectStore:function(){var a=this._isSingleTenant?this.i18n.defaultPortalSelection:this.i18n.defaultEsriSelection;this._galleryAppsSelectStore=new c.data.ItemFileWriteStore({data:{identifier:"id",label:"name",items:[{name:a,group:null,id:0}]}});this._galleryAppsSelect.set("store",this._galleryAppsSelectStore);this._galleryAppsSelect.set("displayedValue",a)},_createGallerySelectStore:function(){this._gallerySelectStore=
new c.data.ItemFileWriteStore({data:{identifier:"group",label:"name",items:[{name:this.i18n.mostViewedItems,group:this.mostViewedItemsValue},{name:"  ",group:"divider"}]}});this._gallerySelect.set("store",this._gallerySelectStore);this._gallerySelect.set("displayedValue",this.i18n.mostViewedItems);c.connect(g.byId("gallerySelect"),"loadDropDown",function(){var a=setInterval(c.hitch(this,function(){c.byId("gallerySelect_popup1")&&(c.style(c.byId("gallerySelect_popup1"),"borderTop","1px #CCC solid"),
9>c.isIE?c.style(c.byId("gallerySelect_popup1"),"height","1px"):c.style(c.byId("gallerySelect_popup0"),"margin","0 0 4px 0"));clearInterval(a)}),200)});c.connect(this._gallerySelect,"onChange",c.hitch(this,this.onGallerySelectChange))},_createHomePageFeaturedSelectStore:function(){this._homePageFeaturedSelectStore=new c.data.ItemFileWriteStore({data:{identifier:"id",label:"name",items:[{name:this.i18n.noFeaturedContent,group:null,id:0}]}});this._homePageFeaturedSelect.set("store",this._homePageFeaturedSelectStore);
this._homePageFeaturedSelect.set("displayedValue",this.i18n.noFeaturedContent)},_createDefaultBasemapSelectStore:function(){var a=this._isSingleTenant?this.i18n.defaultPortalSelection:this.i18n.defaultEsriSelection;this._defaultBasemapSelectStore=new c.data.ItemFileReadStore({data:{identifier:"id",label:"title",items:[{title:a,id:"0"}]}});this._defaultBasemapSelect=new g.form.FilteringSelect({searchAttr:"title",store:this._defaultBasemapSelectStore},c.byId("defaultBasemapSelectDiv"));this._defaultBasemapSelect.set("displayedValue",
a)},_createBasemapGallerySelectStore:function(){var a=this._isSingleTenant?this.i18n.defaultPortalSelection:this.i18n.defaultEsriSelection;this._basemapGallerySelectStore=new c.data.ItemFileWriteStore({data:{identifier:"id",label:"name",items:[{name:a,group:null,id:0}]}});this._basemapGallerySelect.set("store",this._basemapGallerySelectStore);this._basemapGallerySelect.set("displayedValue",a)},_createTemplatesSelectStore:function(){var a=this._isSingleTenant?this.i18n.defaultPortalSelection:this.i18n.defaultEsriSelection;
this._templatesSelectStore=new c.data.ItemFileWriteStore({data:{identifier:"id",label:"name",items:[{name:a,group:null,id:0}]}});this._templatesSelect.set("store",this._templatesSelectStore);this._templatesSelect.set("displayedValue",a)},_createUnitsSelectStore:function(){this._unitsSelectStore=new c.data.ItemFileWriteStore({data:{identifier:"id",label:"name",items:[{id:0,name:this.i18n.mapTab.unitsEnglish,value:this.unitsEnglish},{id:1,name:this.i18n.mapTab.unitsMetric,value:this.unitsMetric}]}});
this._unitsSelect.set("store",this._unitsSelectStore);this._unitsSelect.set("value",this.i18n.mapTab.unitsEnglish)},_setupAccountSettings:function(){this._createLanguageSelectStore();this._isSingleTenant||this._createRegionSelectStore();this._createGalleryAppsSelectStore();this._createGallerySelectStore();this._createHomePageFeaturedSelectStore();this._createDefaultBasemapSelectStore();this._createBasemapGallerySelectStore();this._createTemplatesSelectStore();this._createUnitsSelectStore();this._allAdmins=
[];this._allGroups=[]},_getSortByData:function(){return[{id:"title",name:this.i18n.sortFields.title},{id:"owner",name:this.i18n.sortFields.owner},{id:"avgrating",name:this.i18n.sortFields.avgrating},{id:"numviews",name:this.i18n.sortFields.numviews},{id:"modified",name:this.i18n.sortFields.modified}]},_createPendingGrid:function(){this._pendingGrid=arcgisonline.sharing.dijit.DataGrid({structure:[[{field:"email",get:this.pendingEmailFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.pendingGrid.email,
width:"100%"},{field:"created",name:this.i18n.pendingGrid.invited,get:this.createdFormatter,formatter:arcgisonline.sharing.util.fix,width:"125px",editable:!1},{field:"dateAccepted",name:this.i18n.pendingGrid.accepted,get:this.dateAcceptedFormatter,formatter:arcgisonline.sharing.util.fix,width:"100px",editable:!1},{field:"accepted",name:'\x3cdiv style\x3d"text-align:center;"\x3e'+this.i18n.pendingGrid.actions+"\x3c/div\x3e",get:this.pendingActionsFormatter,formatter:arcgisonline.sharing.util.fix,width:"85px"}]],
rowsPerPage:this._organizationUsersNum,region:"center",noDataMessage:this._pendingNoDataMessage,id:"pendingGridNode",jsid:"pendingGrid",selectionMode:"none",clientSort:!0,gutters:!1,sortInfo:1,canSort:arcgisonline.sharing.dijit.Organization.util.pendingNoSort},c.byId("pendingGridContentPane"));this._pendingGrid.startup();c.subscribe("invitation-resent",c.hitch(this,this.onInvitationResent));this._pendingGrid.setSortInfo=c.hitch(this,function(a){this._pendingGrid.canSort(a)&&(this._pendingGrid.sortInfo=
a,a=this._pendingGrid.getSortProps(),0<a.length?(this._gridSortField=a[0].attribute.toLowerCase(),this._gridSortOrder=!0===a[0].descending?"desc":"asc"):this._gridSortField=this._gridSortField=null,this._replayLastSearch())});this._user.role&&(this._isAdmin||this._roleCanInviteUsers)&&c.connect(this._pendingGrid,"onRowClick",c.hitch(this,function(a){if(3===a.cellIndex&&a.target&&a.target.tagName&&"img"===a.target.tagName.toLowerCase()){var b=this._pendingGrid.get("store").getValue(this._pendingGrid.getItem(a.rowIndex),
"id");this.loadPendingUserActionsMenu(a,b)}}))},_retrieveLocalizedOrgProperties:function(){var a=this,b,c=!1,e=esriGeowConfig.restBaseUrl+"portals/self/resources",f=function(){a._organization.localizedOrgProperties={"default":{name:a._organization.name,description:null}};a._currentLocalizedOrgProperties=a._organization.localizedOrgProperties;a._setSummaryValue()};a._util.request({url:e,content:{start:1,num:100}}).then(function(g){if(g&&!g.code){for(b=0;b<g.resources.length;b++)if(g.resources[b].key===
a.localizedOrgPropsKey){c=!0;break}c?a._util.request({url:e+"/"+a.localizedOrgPropsKey}).then(function(b){b&&!b.code?(a._organization.localizedOrgProperties=b,a._organization.localizedOrgProperties["default"]||(a._organization.localizedOrgProperties["default"]={name:a._organization.name,description:null})):a._organization.localizedOrgProperties={"default":{name:a._organization.name,description:null}};a._currentLocalizedOrgProperties=a._organization.localizedOrgProperties;a._setSummaryValue()},function(a){console.log("error retrieving localizedOrgPropsKey",
a);f()}):f()}else f()})},_createUserGridLayout:function(){var a=[[]];a[0].push({field:"fullName",get:this.nameFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.currentGrid.fullName,width:"100%"});this._isAdmin&&(esriGeowConfig.multiFactorEnabled&&this._organization.mfaEnabled&&!this._isSingleTenant&&!this._isDeveloperSubscription)&&a[0].push({field:"mfaEnabled",get:this.mfaFormatter,formatter:arcgisonline.sharing.util.fix,name:'\x3cspan class\x3d"mfaHeaderImg"\x3e\x3cimg src\x3d"'+
this._util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/mfa_header.png")+'" title\x3d"'+this.i18n.securityTab.multiFactorAuth+'"\x3e\x3c/span\x3e',width:"30px"});a[0].push({field:"username",name:this.i18n.currentGrid.username,width:"145px"});!this._isSingleTenant&&(esriGeowConfig.creditBudgetingEnabled&&this._user.role&&this._isAdmin&&esri.isDefined(this._organization.creditAssignments)&&("enabled"===this._organization.creditAssignments||"validated"===this._organization.creditAssignments))&&
a[0].push({field:"availableCredits",get:this.creditFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.currentGrid.credits,width:"125px"});a[0].push({field:"lastLogin",get:this.lastLoginFormatter,formatter:arcgisonline.sharing.util.fix,name:this.i18n.currentGrid.lastLogin,width:"125px"});this._user.role&&(this._isAdmin||this._roleCanChangeUserRoles)?a[0].push({field:"role",cellType:q.grid.cells.Select,get:this.roleSelectFormatter,name:this.i18n.currentGrid.role,width:"150px"}):this._isSingleTenant||
a[0].push({field:"role",formatter:arcgisonline.sharing.util.fix,get:this.roleFormatter,name:this.i18n.currentGrid.role,width:"150px"});a[0].push({name:'\x3cdiv style\x3d"text-align:center;"\x3e'+this.i18n.currentGrid.actions+"\x3c/div\x3e",get:this.userActionsFormatter,formatter:arcgisonline.sharing.util.fix,width:"75px"});return a},_createUserGrid:function(){this._userGrid||(this._userGrid=arcgisonline.sharing.dijit.DataGrid({structure:this._createUserGridLayout(),rowsPerPage:this._organizationUsersNum,
region:"center",noDataMessage:this._noSearchResultsMessage,id:"userGridNode",jsid:"userGrid",selectionMode:"none",clientSort:!0,gutters:!1,sortInfo:1,canSort:arcgisonline.sharing.dijit.Organization.util.noSort},c.byId("userGridContentPane")),this._userGrid.startup(),c.addClass(c.byId("userGridNode"),"userGrid"),this._userGrid.setSortInfo=c.hitch(this,function(a){this._userGrid.canSort(a)&&(this._userGrid.sortInfo=a,a=this._userGrid.getSortProps(),0<a.length?(this._gridSortField=a[0].attribute.toLowerCase(),
this._gridSortOrder=!0===a[0].descending?"desc":"asc"):this._gridSortField=this._gridSortField=null,this._replayLastSearch())}),c.connect(this._userGrid,"onStyleRow",c.hitch(this,function(a){var b;null!==this._userGrid.getItem(a.index)&&(b=this._userGrid.getItem(a.index),!0===this._userGrid.get("store").getValue(b,"disabled")&&-1!==this._userGrid.get("store").getValue(b,"lastLogin")&&(a.customClasses+=" disabledUserRow"))})),this._user.role&&(this._isAdmin||this._roleCanChangeUserRoles)?c.connect(this._userGrid,
"onRowClick",c.hitch(this,function(a){var b=g.byId("userRole"+a.rowIndex),c=this._userGrid.getItem(a.rowIndex),e=3,f=4,k=this._isAdmin&&esriGeowConfig.creditBudgetingEnabled&&!this._isSingleTenant&&this._organization.creditAssignments&&("enabled"===this._organization.creditAssignments||"validated"===this._organization.creditAssignments);this._isAdmin&&(esriGeowConfig.multiFactorEnabled&&this._organization.mfaEnabled&&!this._isSingleTenant&&!this._isDeveloperSubscription)&&(e++,f++);k&&(e++,f++);a.cellIndex===
e&&(a.target&&a.target.tagName&&"input"===a.target.tagName.toLowerCase())&&b.loadDropDown();a.cellIndex===f&&(a.target&&a.target.tagName&&"img"===a.target.tagName.toLowerCase())&&this.loadUserActionsMenu(a,c)})):this._user.role&&!this._isAdmin&&c.connect(this._userGrid,"onRowClick",c.hitch(this,function(a){var b=this._userGrid.getItem(a.rowIndex);(this._util.isPortal()&&3===a.cellIndex||!this._util.isPortal()&&4===a.cellIndex)&&(a.target&&a.target.tagName&&"img"===a.target.tagName.toLowerCase())&&
this.loadUserActionsMenu(a,b)})),c.connect(window,"onresize",c.hitch(this,function(){this._refreshUserGrids();this._editTabs.resize()})),this._setupPrecreatedUserTooltip())},refreshOrganization:function(){this._rolesAPI.getRoles(1,100).then(c.hitch(this,function(a){a&&(!a.code&&a.roles)&&(this._customRoles=a.roles);this._retrieveRemainingRoles(a.roles.length,a.nextStart,a.total).then(c.hitch(this,function(){this._account.getSelf(c.hitch(this,this._handleGetOrganization))}))}),c.hitch(this,function(a){this._account.getSelf(c.hitch(this,
this._handleGetOrganization))}))},_retrieveRemainingRoles:function(a,b,d){var e=new c.Deferred;if(0<b){a=Math.ceil((d-a)/100);d=[];for(var f=0;f<a;f++)d.push(this._rolesAPI.getRoles(b+100*f,100));(new c.DeferredList(d)).then(c.hitch(this,function(a){c.forEach(a,c.hitch(this,function(a){a[1]&&a[1].roles&&(this._customRoles=this._customRoles.concat(a[1].roles))}));e.resolve()}),c.hitch(this,function(a){e.resolve()}))}else e.resolve();return e},_loadQuotaUsage:function(a){if(a&&a.subscriptionInfo){var b=
c.number.format(parseInt(a.subscriptionInfo.availableCredits,10),{pattern:"#,###,###,##0"});c.attr(this._statusMessage,"innerHTML",esri.substitute({availableCredits:b},this.i18n.subscriptionStatus.message));c.attr(this._subscriptionId,"innerHTML",esri.substitute(a.subscriptionInfo,this.i18n.subscriptionStatus.id));c.attr(this._subscriptionState,"innerHTML",this.i18n.subscriptionStatus[a.subscriptionInfo.state]);if("expired"===a.subscriptionInfo.state||"suspended"===a.subscriptionInfo.state)c.create("br",
null,this._subscriptionState,"before"),c.create("br",null,this._subscriptionState,"before"),esri.show(this._subscriptionState)}},_cleanOrgName:function(a){return 9>c.isIE&&a&&"\x26"===a[a.length-1]?a.substring(0,a.length-1)+"\x26#38;":a},_setOrganizationNameDesc:function(){this._newThumbKey=null;this._existingThumbKey=this._organization.thumbnail;var a=this._cleanOrgName(this._organization.name),b=c.attr(this._thumbnail,"src")||"";c.attr(c.byId("myOrg"),"innerHTML",'\x3cimg id\x3d"_viewThumbnail" src\x3d"'+
b+'" align\x3d"center" class\x3d"groupThumbnail"/\x3e \x3cspan id\x3d"myOrgName"\x3e'+a+"\x3c/span\x3e");this._viewThumbnail=c.query("#_viewThumbnail")[0]},_setManagingOrganizationLicenses:function(){c.attr(c.byId("myOrgName"),"innerHTML",this.i18n.managingLicensesTitle+" "+this._cleanOrgName(this._organization.name))},_checkAdminUser:function(){if(esri.isDefined(this._user)){var a=this._roleCanViewUsers&&this._roleCanViewGroups&&this._roleCanViewItems;if(!this._isAdmin&&this._isCustomRole&&(this._roleCanInviteUsers||
this._roleCanManageLicenses||a))c.style(g.byId("organization-edit-button").domNode,"display","none"),c.style(g.byId("organization-view-status-button").domNode,"display","none"),c.style(g.byId("organization-view-health-button").domNode,"display","none"),c.style(this._upgradeSubscriptionButton.domNode,"display","none"),this._roleCanInviteUsers?c.style(g.byId("organization-adduser-btn").domNode,"display",""):c.style(g.byId("organization-adduser-btn").domNode,"display","none"),this._roleCanManageLicenses?
c.style(this._manageSubscriptionButton,"display",""):c.style(this._manageSubscriptionButton,"display","none"),this._util.isPortal()||c.style(c.byId("organization-adduser-span"),"display",""),a&&c.style(g.byId("organization-view-status-button").domNode,"display","");this._user.role&&this._isAdmin&&!this._isCustomRole&&!this._util.isPortal()?esri.show(this._subscriptionStatus):this._user.role&&(this._isAdmin&&this._util.isPortal())&&(g.byId("organization-adduser-btn").set("label",this.i18n.invitePortalUsersLabel),
c.style(g.byId("organization-view-health-button").domNode,"display","none"),a=esriGeowConfig.baseUrl.substring(0,esriGeowConfig.baseUrl.indexOf("/home"))+"/portaladmin/system/licenses",this._util.request({url:a,content:{ts:(new Date).getTime()}}).then(c.hitch(this,function(a){if(a&&(!a.code&&!a.message)&&(c.attr(this._memberStatusTitle,"innerHTML",this.i18n.portalSoftAuth.members),c.attr(this._memberStatusCurrTitle,"innerHTML",this.i18n.portalSoftAuth.currentCount),c.attr(this._memberStatusMaxTitle,
"innerHTML",this.i18n.portalSoftAuth.maxAllowed),c.attr(this._memberStatusCurrCount,"innerHTML",a.currentRegisteredMembers),c.attr(this._memberStatusMaxCount,"innerHTML",a.maximumRegisteredMembers),c.style(this._memberStatus,"display",""),a.currentRegisteredMembers>a.maximumRegisteredMembers)){var d=esriGeowConfig.baseUrl.replace("/home","/portalhelp")+this._organization.culture+"/admin/help/";esri.request({url:d+"cxhelp.js"}).then(c.hitch(this,function(c){c="\x3cp\x3e"+this.i18n.portalSoftAuth.softAuthDesc+
"\x3c/p\x3e\x3ctable\x3e\x3ctbody\x3e\x3ctr\x3e\x3ctd\x3e"+this.i18n.portalSoftAuth.currentCountLong+"\x3c/td\x3e\x3ctd\x3e"+a.currentRegisteredMembers+"\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e"+this.i18n.portalSoftAuth.maxAllowedLong+"\x3c/td\x3e\x3ctd\x3e"+a.maximumRegisteredMembers+"\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\x3cp\x3e"+esri.substitute({linkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca href\x3d"'+(d+c.m["120000836"])+'" target\x3d"_blank"\x3e',linkEnd:"\x3c/a\x3e\x3c/span\x3e"},
this.i18n.portalSoftAuth.softAuthResolve)+"\x3c/p\x3e";this._generalDlg.show({title:this.i18n.portalSoftAuth.softAuthError,message:c})}))}})))}else window.location="error.html?c\x3dAccessDeniedOrganization"},_checkFeaturedGroup:function(){if(!this._organization.featuredItemsGroupQuery||""===this._organization.featuredItemsGroupQuery)this._organization.featuredItemsGroupQuery=this.mostViewedItemsValue},_setOrganizationThumbnail:function(){if(esri.isDefined(this._organization.thumbnail)&&0<this._organization.thumbnail.length){var a=
esriGeowConfig.restBaseUrl+"portals/self/resources/"+this._organization.thumbnail+this._token;c.attr(this._thumbnail,"src",a);c.attr(this._viewThumbnail,"src",a);c.style(c.byId("thumbnailDeleteDiv"),"display","")}else c.style(c.byId("thumbnailDeleteDiv"),"display","none")},_setOrganizationFindLinks:function(){var a=this.i18n.findLinks.mostViewed,b=this.i18n.findLinks.recentlyAdded;this._isSingleTenant||(a+=this.i18n.findLinks.inOrg,b+=this.i18n.findLinks.toOrg);c.create("br",null,this._organizationContentLinks);
var d=c.create("span",{innerHTML:"\x3cbr\x3e\x3cbr\x3e"},this._organizationContentLinks);c.addClass(d,"esriItemLinks");c.create("a",{innerHTML:a,href:"search.html?q\x3dorgid:"+this._user.accountId+"\x26t\x3dcontent\x26sortField\x3dnumviews\x26sortOrder\x3ddesc\x26hideq\x3dtrue"},d,"first");a=c.create("span",null,this._organizationContentLinks);c.addClass(a,"esriItemLinks");c.create("a",{innerHTML:b,href:"search.html?q\x3dorgid:"+this._user.accountId+"\x26t\x3dcontent\x26sortField\x3dmodified\x26sortOrder\x3ddesc\x26hideq\x3dtrue"},
a,"first");this._isSingleTenant||(c.create("br",null,a),c.create("br",null,a),b=this._getTenantTypeString(),b=esri.substitute({type:b},this.i18n.findLinks.publicItems),a=c.create("span",null,this._organizationContentLinks),c.addClass(a,"esriItemLinks"),c.create("a",{innerHTML:b,href:"search.html?q\x3dorgid:"+this._user.accountId+" access:public\x26t\x3dcontent\x26sortField\x3dmodified\x26hideq\x3dtrue"},a,"first"));b=this._isSingleTenant?this.i18n.findLinks.portalGroups:this.i18n.findLinks.groups;
c.create("br",null,this._organizationContentLinks);c.create("br",null,this._organizationContentLinks);a=c.create("span",null,this._organizationContentLinks);c.addClass(a,"esriItemLinks");c.create("a",{innerHTML:b,href:"search.html?t\x3dgroups\x26q\x3dorgid:"+this._user.accountId+"\x26hideq\x3dtrue"},a,"first");if(void 0===esriGeowConfig.isMultiTenant||null===esriGeowConfig.isMultiTenant||!0===esriGeowConfig.isMultiTenant)c.create("br",null,a),c.create("br",null,a),b=this.i18n.findLinks.publicGroups,
a=c.create("span",null,this._organizationContentLinks),c.addClass(a,"esriItemLinks"),c.create("a",{innerHTML:b,href:"search.html?t\x3dgroups\x26q\x3dorgid:"+this._user.accountId+" access:public\x26hideq\x3dtrue"},a);c.create("br",null,this._organizationContentLinks);c.create("br",null,this._organizationContentLinks);b=c.create("span",{innerHTML:"\x3cbr\x3e\x3cbr\x3e"},this._organizationContentLinks);c.addClass(b,"esriItemLinks");c.create("a",{innerHTML:this.i18n.findLinks.organizationApps,href:"search.html"+
encodeURI('?q\x3dtypekeywords:"Registered App" AND orgid:'+esriGeowConfig.self.user.accountId+"\x26hideq\x3dtrue")},b,"first")},_loadOrganization:function(){this._checkAdminUser();this._setOrganizationNameDesc();this._checkFeaturedGroup();this._setOrganizationThumbnail();this._setOrganizationFindLinks();this.organizationLoaded();this._showWelcome();this._loadOrganizationUsers();this._loadOrganizationGroups();this._showMenuButtons()},_showMenuButtons:function(){var a=this._roleCanViewUsers&&this._roleCanViewGroups&&
this._roleCanViewItems,b=!this._isAdmin&&(this._roleCanInviteUsers||this._roleCanManageLicenses||a);!this._user.role||!this._isAdmin&&!this._roleCanInviteUsers&&!this._roleCanManageLicenses&&!a?c.style("organization-control-div","display","none"):(this._isAdmin&&!this._isCustomRole||b)&&c.style("organization-control-div","display","")},_hideMenuButtons:function(){c.style("organization-control-div","display","none")},organizationLoaded:function(){},_showWelcome:function(){if(this._organization&&this._organization.portalProperties&&
this._organization.portalProperties.mustWelcome)if("Trial"===this._organization.subscriptionInfo.type||"Trial Press"===this._organization.subscriptionInfo.type)c.style(g.byId("choice-dialog").domNode,"width","600px"),this._choiceDlg.show({title:esri.substitute({fullName:this._user.fullName},this.i18n.noData.welcomeTitle),message:this.i18n.newOrg.trialActive+"\x3cbr\x3e\x3cbr\x3e"+this.i18n.newOrg.trialContinue,choiceOneTitle:this.i18n.newOrg.getApps,choiceTwoTitle:this.i18n.newOrg.continueAGOL,choiceOneHandler:c.hitch(this,
function(){var a=c.hitch(this,function(){var a=["pt-br","pt-pt","zh-cn","zh-hk","zh-tw"],a=c.locale&&-1<c.locale.indexOf("-")&&-1===c.indexOf(a,c.locale.toLowerCase())?c.locale.split("-")[0].toLowerCase():c.locale.toLowerCase();arcgisonline.sharing.util.openPage(esriGeowConfig.learnArcGIS+"/"+(this._user.culture||this._organization.culture||a||"en")+"/trial",!0)});delete this._organization.portalProperties.mustWelcome;var d=esriGeowConfig.restBaseUrl+"portals/self/update",e={access:this._organization.access,
portalProperties:c.json.stringify(this._organization.portalProperties)};this._util.request({url:d,content:e},{usePost:!0}).then(a)}),choiceTwoHandler:c.hitch(this,function(){delete this._organization.portalProperties.mustWelcome;var a=esriGeowConfig.restBaseUrl+"portals/self/update",d={access:this._organization.access,portalProperties:c.json.stringify(this._organization.portalProperties)};this._util.request({url:a,content:d},{usePost:!0}).then(c.hitch(this,function(){c.style(g.byId("choice-dialog").domNode,
"width","400px")}))})});else{var a=this._generalDlg.onOkClick;this._generalDlg.onOkClick=c.hitch(this,function(){delete this._organization.portalProperties.mustWelcome;var b=esriGeowConfig.restBaseUrl+"portals/self/update",d={access:this._organization.access,portalProperties:c.json.stringify(this._organization.portalProperties)};this._util.request({url:b,content:d},{usePost:!0});this._generalDlg.onOkClick=a;this._generalDlg.hide()});this._generalDlg.show({title:esri.substitute({fullName:this._user.fullName||
("ja"===c.locale?this._user.lastName+" "+this._user.firstName:this._user.firstName+" "+this._user.lastName)},this.i18n.noData.welcomeTitle),message:this._noDataMessage})}},_loadPendingOrganizationUsers:function(){this._wasSearch=!1;this._account.getPendingAccountUsers(this._organization.id,{start:this._organizationUsersStart,num:this._organizationUsersNum,type:"email"},c.hitch(this,this._handleGetPendingOrganizationUsers))},_loadOrganizationUsers:function(){this._wasSearch=!1;this._gridSortField=
"fullname";this._gridSortOrder="asc";var a={start:this._organizationUsersStart,num:this._organizationUsersNum,sortField:this._gridSortField,sortOrder:this._gridSortOrder};this._util.isPortal()&&(a.excludeSystemUsers=!0);this._account.getAccountUsers(this._organization.id,a,c.hitch(this,this._handleGetOrganizationUsers))},_generateAltName:function(a){return(a.firstName&&a.lastName?"ja"===c.locale?a.lastName+" "+a.firstName:a.firstName+" "+a.lastName:a.fullName)+" ("+a.username+")\x26#x200E;"},_retrieveAllAdministrators:function(){var a=
esriGeowConfig.restBaseUrl+"portals/self/users",b=0,d=0,e={start:1,num:100,role:"org_admin",sortField:"fullname",sortOrder:"asc"},f=new c.Deferred,g;this._retrievingAllAdministrators?g=setInterval(c.hitch(this,function(){!this._retrievingAllAdministrators&&(this._allAdmins&&0<this._allAdmins.length)&&(clearInterval(g),f.resolve())}),75):this._allAdmins&&0<this._allAdmins.length?f.resolve():(this._retrievingAllAdministrators=!0,this._allAdmins=[],this._util.request({url:a,content:e}).then(c.hitch(this,
function(g){if(g&&g.users){for(var k,m=0;m<g.users.length;m++)k=g.users[m],k.altName=this._generateAltName(k),k.disabled||this._allAdmins.push(k);if(0<g.nextStart){b=g.total-g.users.length;d=Math.ceil(b/100);var p=[];g=g.nextStart;for(var n=c.clone(e),r=0;r<d;r++)n.start=g+100*r,p.push(this._util.request({url:a,content:n}));(new c.DeferredList(p)).then(c.hitch(this,function(a){c.forEach(a,c.hitch(this,function(a){if(a[1]&&a[1].users)for(m=0;m<a[1].users.length;m++)k=a[1].users[m],k.altName=this._generateAltName(k),
this._allAdmins.push(k)}));this._retrievingAllAdministrators=!1;f.resolve()}),c.hitch(this,function(a){console.log("error retrieving further admins",a);this._retrievingAllAdministrators=!1;f.resolve()}))}else this._retrievingAllAdministrators=!1,f.resolve()}else this._retrievingAllAdministrators=!1,f.resolve()}),c.hitch(this,function(a){console.log("error retrieving admins",a);this._retrievingAllAdministrators=!1;f.resolve()})));return f},_loadOrganizationGroups:function(){this._allGroups=[];this._account.getAccountGroups(this._organization.id,
{start:this._organizationGroupsStart,num:this._organizationGroupsMaxNum},c.hitch(this,this._handleGetOrganizationGroups))},_loadFederatedServers:function(){this._isSingleTenant&&(delete this._newHostedServer,this._currentHostedServer=null,this._util.request({url:esriGeowConfig.restBaseUrl+"portals/self/servers"}).then(c.hitch(this,function(a){esriGeowConfig.federatedServers=a.servers;esriGeowConfig.hostedServerConfigEnabled&&(this._hostedServerSelectStore=new c.data.ItemFileWriteStore({data:{identifier:"id",
label:"name",items:[{id:0,name:this.i18n.serversTab.noHostedServer,url:null,adminUrl:null}]}}),this._hostedServerSelect.set("store",this._hostedServerSelectStore));if(a&&a.servers&&(this._federatedServers.current=a.servers,esriGeowConfig.hostedServerConfigEnabled&&this._federatedServers.current&&0<this._federatedServers.current.length)){for(a=0;a<this._federatedServers.current.length;a++)this._federatedServers.current[a].isHosted&&!0===this._federatedServers.current[a].isHosted&&(this._currentHostedServer=
this._federatedServers.current[a]),this._hostedServerSelectStore.newItem(this._federatedServers.current[a]);this._hostedServerSelectStore.save()}})))},_setSignInOptionsLabels:function(){var a=esri.substitute({name:this._currentIdentityProvider.name,type:this._getTenantTypeString(),arcgis:this._isSingleTenant?this._organization.name:this.i18n.arcgis,site:this._isSingleTenant?this._organization.name:this.i18n.arcgisOnline},this.i18n.securityTab.signInTooltip),b=esri.substitute({type:this._getTenantTypeString(),
tooltipStart:'\x3cspan id\x3d"signInOptionsHelp" class\x3d"orgSettingTooltip"\x3e',tooltipEnd:"\x3c/span\x3e"},this.i18n.securityTab.signInDesc);c.attr(this._signInDesc,"innerHTML",b+"\x3cbr\x3e\x3cbr\x3e");c.attr(this._arcgisSignInLabel,"innerHTML","\x26nbsp;\x26nbsp;"+esri.substitute({name:this._currentIdentityProvider.name,portal:this._isSingleTenant?this._organization.name:this.i18n.arcgisOnline},this.i18n.securityTab.arcgisSignIn));c.attr(this._enterpriseSignInLabel,"innerHTML","\x26nbsp;\x26nbsp;"+
esri.substitute({name:this._currentIdentityProvider.name},this.i18n.securityTab.enterpriseSignIn));g.byId("tooltip_signInOptionsHelp")||(this._signInTooltip=this._createTooltip("signInOptionsHelp",a))},_loadIdentityProvider:function(){esriGeowConfig.enterpriseLoginConfigEnabled&&this._user.role&&this._isAdmin?this._util.request({url:esriGeowConfig.restBaseUrl+"portals/self/idp"}).then(c.hitch(this,function(a){esri.isDefined(a)&&esri.isDefined(a.id)?(this._currentIdentityProvider=a,this._setSignInOptionsLabels()):
this._currentIdentityProvider=null}),c.hitch(this,function(a){this._currentIdentityProvider=null})):this._currentIdentityProvider=null},_loadOrganizationExtent:function(){if(this._organization.defaultExtent&&this._organization.defaultExtent.xmin&&this._organization.defaultExtent.xmax&&this._organization.defaultExtent.ymin&&this._organization.defaultExtent.ymax){var a={};this._organization.defaultExtent.spatialReference.wkid?a.wkid=this._organization.defaultExtent.spatialReference.wkid:this._organization.defaultExtent.spatialReference.wkt&&
(a.wkt=this._organization.defaultExtent.spatialReference.wkt);this._currentDefaultExtent=new esri.geometry.Extent(this._organization.defaultExtent.xmin,this._organization.defaultExtent.ymin,this._organization.defaultExtent.xmax,this._organization.defaultExtent.ymax,new esri.SpatialReference(a))}else this._currentDefaultExtent=new esri.geometry.Extent(this._selfNoAuth.defaultExtent.xmin,this._selfNoAuth.defaultExtent.ymin,this._selfNoAuth.defaultExtent.xmax,this._selfNoAuth.defaultExtent.ymax,new esri.SpatialReference({wkid:this._selfNoAuth.defaultExtent.spatialReference.wkid}));
var b=new esri.SpatialReference({wkid:4326});this._organization.defaultExtent.spatialReference&&4326!==this._organization.defaultExtent.spatialReference?(a=c.hitch(this,function(a){a&&(!a.code&&!a.message&&0<a.length&&a[0])&&(a=a[0],this._currentDefaultExtent=new esri.geometry.Extent(a.xmin,a.ymin,a.xmax,a.ymax,b),this._displayExtent(this._currentDefaultExtent))}),arcgisonline.map.main.doProject(this._currentDefaultExtent,b,a,a)):this._displayExtent(this._currentDefaultExtent)},_displayExtent:function(a){c.attr(this.extentLeftValue,
"innerHTML",c.number.format(Math.round(1E3*a.xmin)/1E3,this.numberPattern));c.attr(this.extentRightValue,"innerHTML",c.number.format(Math.round(1E3*a.xmax)/1E3,this.numberPattern));c.attr(this.extentTopValue,"innerHTML",c.number.format(Math.round(1E3*a.ymax)/1E3,this.numberPattern));c.attr(this.extentBottomValue,"innerHTML",c.number.format(Math.round(1E3*a.ymin)/1E3,this.numberPattern))},_loadOrganizationResources:function(){this._checkUserCultureSetting();this._loadFederatedServers();this._loadIdentityProvider();
this._loadOrganizationExtent();this._clearNewPropertyValueHolders();this._loadGroupBasedSettings();this._loadBackground();this._loadRotatorPanels();this._loadServiceBasedSettings();this._loadFeaturedGroupsList();this._loadMFASettings();this._loadLanguageAndCulture();this._loadGroupSelectControls();this._loadBingMapsKey();this._enableEditButton()},_checkUserCultureSetting:function(){this._community.getProfile(this._user.username,c.hitch(this,function(a){if(a.culture&&c.locale!==a.culture.toLowerCase()){var b=
arcgisonline.sharing.util.getCookie("esri_auth");b.username=b.username||b.email;if(b&&b.username===a.username){if(9>c.isIE&&b.auth_tier&&"web"===b.auth_tier){var d=new Date;b.expires=new Date(d.setSeconds(d.getSeconds()+Number(7200)))}if(!b.culture||b.culture&&b.culture.toLowerCase()!==a.culture.toLowerCase())b.culture=a.culture.toLowerCase(),arcgisonline.sharing.geow.Geow.setAuthCookie(b);window.location.reload()}}}))},_clearNewPropertyValueHolders:function(){this._newHydrologyService=this._newGeoEnrichService=
this._newGeometryService=this._newGeocodingServices=this._newAnalysisService=this._newPrintingService=this._newFeaturedGroups=this._newCustomBannerKey=this._newSelectedBackground=this._newSelectedRotatorPanelId=this._newSelectedHomePageFeaturedQuery=this._newSelectedHomePageFeatured=this._newSelectedDefaultExtent=this._newSelectedBasemapId=this._newSelectedBasemapName=this._newSelectedGalleryAppsGroupQuery=this._newSelectedGalleryAppsGroup=this._newSelectedTemplatesQuery=this._newSelectedTemplates=
this._newSelectedBasemapGalleryQuery=this._newSelectedBasemapGallery=this._newSelectedRegion=this._newSelectedCulture=null;this._newElevationServices={};this._newNetworkServices={};this._newBingKey=null;this._newMfaAdmins=[]},_loadMFASettings:function(){this._currentMfaAdmins=[];if(esri.isDefined(this._organization.mfaAdmins)&&0<this._organization.mfaAdmins.length)for(var a,b,c=0;c<this._organization.mfaAdmins.length;c++){b=this._organization.mfaAdmins[c];for(var e=0;e<this._allAdmins.length;e++)if(a=
this._allAdmins[e],a.username===b){this._currentMfaAdmins.push({username:a.username,altName:a.altName,firstName:a.firstName,lastName:a.lastName,fullName:a.fullName});break}}},_loadAdminContactSettings:function(){this._currentAdminContacts=[];if(esri.isDefined(this._organization.contacts)&&0<this._organization.contacts.length)for(var a,b,c=0;c<this._organization.contacts.length;c++){b=this._organization.contacts[c];for(var e=0;e<this._allAdmins.length;e++)if(a=this._allAdmins[e],a.username===b){this._currentAdminContacts.push({username:a.username,
altName:a.altName,firstName:a.firstName,lastName:a.lastName,fullName:a.fullName});break}}},_loadServiceBasedSettings:function(){esri.isDefined(this._organization.helperServices)||(this._organization.helperServices={});this._currentPrintingService=this._organization.helperServices.printTask?this._organization.helperServices.printTask:null;this._currentGeocodingServices=this._organization.helperServices.geocode?this._organization.helperServices.geocode:null;this._currentGeometryService=this._organization.helperServices.geometry?
this._organization.helperServices.geometry:null;this._organization.helperServices.analysis?(this._currentAnalysisService=this._organization.helperServices.analysis,this._organization.helperServices.analysis=null):this._currentAnalysisService=null;this._currentGeoEnrichService=this._organization.helperServices.geoenrichment?this._organization.helperServices.geoenrichment:null;this._currentHydrologyService=this._organization.helperServices.hydrology?this._organization.helperServices.hydrology:null;
this._currentRoutingService=this._organization.helperServices.route?this._organization.helperServices.route:null;this._currentElevationServices={elevation:this._organization.helperServices.elevation||null,elevationSync:this._organization.helperServices.elevationSync||null};this._currentNetworkServices={closestFacility:this._organization.helperServices.closestFacility||null,asyncClosestFacility:this._organization.helperServices.asyncClosestFacility||null,serviceArea:this._organization.helperServices.serviceArea||
null,asyncServiceArea:this._organization.helperServices.asyncServiceArea||null,syncVRP:this._organization.helperServices.syncVRP||null,asyncVRP:this._organization.helperServices.asyncVRP||null,asyncLocationAllocation:this._organization.helperServices.asyncLocationAllocation||null,traffic:this._organization.helperServices.traffic||null,routingUtilities:this._organization.helperServices.routingUtilities||null,asyncRoute:this._organization.helperServices.asyncRoute||null}},_loadGroupBasedSettings:function(){this._currentBasemapGalleryGroupQuery=
this._organization.basemapGalleryGroupQuery?this._organization.basemapGalleryGroupQuery:null;this._currentHomePageFeaturedQuery=this._organization.homePageFeaturedContent?this._organization.homePageFeaturedContent:null;this._currentTemplatesGroupQuery=this._organization.templatesGroupQuery?this._organization.templatesGroupQuery:null;this._currentGalleryAppsGroupQuery=this._organization.galleryTemplatesGroupQuery?this._organization.galleryTemplatesGroupQuery:null;this._organization.defaultBasemap?
(this._currentDefaultBasemapId=this._organization.defaultBasemap.id,this._currentDefaultBasemap=this._organization.defaultBasemap.title):(this._currentDefaultBasemapId="0",this._currentDefaultBasemap=this.i18n.defaultEsriSelection)},_loadBackground:function(){esri.isDefined(this._organization.backgroundImage)?this._currentSelectedBackground=this._organization.backgroundImage:this._currentSelectedBackground=this.predefinedBackground1},_loadRotatorPanels:function(){if(this._organization.rotatorPanels){var a=
this._organization.rotatorPanels;if(a&&1===a.length){var b=a[0].id;this._currentSelectedRotatorPanelId=b?b:this.customBannerId}else this._currentSelectedRotatorPanelId=a&&1<a.length?this.customBannerId:null;this._currentUnparsedRotatorPanels=c.clone(this._organization.rotatorPanels);this._currentRotatorPanels=a}else this._currentRotatorPanels=this._currentSelectedRotatorPanelId=this._currentUnparsedRotatorPanels=null},_loadGroupSelectControls:function(){esri.isDefined(this._defaultBasemapSelectConn)||
(this._defaultBasemapSelectConn=c.connect(this._defaultBasemapSelect,"onChange",c.hitch(this,this.onDefaultBasemapSelectChange)));esri.isDefined(this._basemapGallerySelectConn)||(this._basemapGallerySelectConn=c.connect(this._basemapGallerySelect,"onChange",c.hitch(this,this.onBasemapGallerySelectChange)));esri.isDefined(this._templatesSelectConn)||(this._templatesSelectConn=c.connect(this._templatesSelect,"onChange",c.hitch(this,this.onTemplatesSelectChange)));esri.isDefined(this._homePageFeaturedSelectConn)||
(this._homePageFeaturedSelectConn=c.connect(this._homePageFeaturedSelect,"onChange",c.hitch(this,this.onHomePageFeaturedChange)));esri.isDefined(this._galleryAppsSelectConn)||(this._galleryAppsSelectConn=c.connect(this._galleryAppsSelect,"onChange",c.hitch(this,this.onGalleryAppsSelectChange)))},_loadBingMapsKey:function(){this._currentBingKey=esri.isDefined(this._organization.bingKey)&&0<this._organization.bingKey.length?this._organization.bingKey:null},_loadFeaturedGroupsList:function(){this._organization.featuredGroups?
(this._currentFeaturedGroups=c.clone(this._organization.featuredGroups),this._newFeaturedGroups=c.clone(this._organization.featuredGroups)):(this._currentFeaturedGroups=[],this._newFeaturedGroups=[]);this._groupSelector||(this._groupSelector=new arcgisonline.sharing.dijit.GroupSelector({id:"groupSelector"},c.create("div",null,this._featuredGroupsCol)),this._groupSelector.startup(),this._groupSelector.set("selectedGroupsLabel",this.i18n.groupsTab.featuredGroupsList),this._groupSelector.on("selection-change",
c.hitch(this,this.featuredGroupsChange)));this._currentFeaturedGroups&&0<this._currentFeaturedGroups.length&&this._groupSelector.set("selectedGroups",this._currentFeaturedGroups)},_loadLanguageAndCulture:function(){this._currentCulture=this._organization.culture;this._currentRegion=this._organization.region;c.when(this._account.getSupportedLanguagesAndRegions(),c.hitch(this,function(a){if(a){var b=[{culture:this.browserDefault,displayName:this.i18n.browserDefaultSelection,language:this.i18n.browserDefaultSelection,
localizedName:this.i18n.browserDefaultSelection}];c.forEach(a.languages,c.hitch(function(a){a.displayName=a.language+(a.localizedName?" - "+a.localizedName:"");b.push(a)}));this._languageSelectStore=new c.data.ItemFileReadStore({data:{identifier:"culture",label:"displayName",items:b}});this._languageSelect.set("store",this._languageSelectStore);this._languageSelect.set("searchAttr","displayName");this._isSingleTenant||(this._regionSelectStore=new c.data.ItemFileReadStore({data:{identifier:"region",
label:"localizedName",items:a.regions}}),this._regionSelect.set("store",this._regionSelectStore),this._regionSelect.set("searchAttr","localizedName"))}}))},_loadAvailableBasemaps:function(){if(this._newSelectedBasemapGallery!==this.i18n.defaultEsriSelection){var a=this._basemapGallerySelect.get("store");a.fetch({onComplete:c.hitch(this,function(b){for(var d,e=0;e<b.length;e++)if(a.getValue(b[e],"name")===this._newSelectedBasemapGallery){d=a.getValue(b[e],"group");this._newSelectedBasemapGalleryQuery=
"id:"+d.id;this._basemapGallerySelect.set("item",b[e]);this._enableBasemapGallerySort(d.group);this._enableAddEsriBasemaps();break}d.id&&(b={},b.q="group:"+d.id+" AND (access:public || access:org)",b.sortField="title",b.sortOrder="asc",b.start=1,b.num=100,this._content.search(esriGeowConfig.restBaseUrl+"search",b,c.hitch(this,this._handleAvailableBasemaps,d.id),c.hitch(this,this._handleAvailableBasemaps,d.id)))})})}else this._newSelectedBasemapGalleryQuery=esriGeowConfig.basemapGalleryGroupQuery,
this._defaultBasemapSelectStore=new c.data.ItemFileReadStore({data:{identifier:"id",label:"title",items:[{title:this.i18n.defaultEsriSelection,id:"0"}]}}),this._defaultBasemapSelect.set("store",this._defaultBasemapSelectStore),this._defaultBasemapSelect.set("displayedValue",this.i18n.defaultEsriSelection),this._disableBasemapGallerySort(),this._disableAddEsriBasemaps()},_handleAvailableBasemaps:function(a,b){if(b){var d=b.results;if(d&&0<d.length){for(var e=[],f=0;f<d.length;f++)"Web Map"===d[f].type&&
e.push({title:d[f].title,id:d[f].id});this._defaultBasemapSelectStore=new c.data.ItemFileReadStore({data:{identifier:"id",label:"title",items:e}});this._defaultBasemapSelect.set("store",this._defaultBasemapSelectStore);if(this._firstLoad)if(this._firstLoad=!1,this._currentDefaultBasemap){var g=this._defaultBasemapSelect.get("store");g.fetch({onComplete:c.hitch(this,function(a,b,d){d=!1;for(var e=0;e<b.length;e++){var f=g.getValue(b[e],"title");if(b[e]&&f&&0<f.length&&this._currentDefaultBasemap===
f){d=!0;this._defaultBasemapSelect.set("displayedValue",this._currentDefaultBasemap);break}}d||(0<a.length?this._defaultBasemapSelect.set("displayedValue",a[0].title):(this._defaultBasemapSelectStore=new c.data.ItemFileReadStore({data:{identifier:"id",label:"title",items:[{title:this.i18n.defaultEsriSelection,id:"0"}]}}),this._defaultBasemapSelect.set("store",this._defaultBasemapSelectStore),this._defaultBasemapSelect.set("displayedValue",this.i18n.defaultEsriSelection)))},e)})}else this._defaultBasemapSelect.set("displayedValue",
e[0].title);else this._defaultBasemapSelect.set("displayedValue",e[0].title)}else this._defaultBasemapSelectStore=new c.data.ItemFileReadStore({data:{identifier:"id",label:"title",items:[{title:this.i18n.defaultEsriSelection,id:"0"}]}}),this._defaultBasemapSelect.set("store",this._defaultBasemapSelectStore),this._defaultBasemapSelect.set("displayedValue",this.i18n.defaultEsriSelection)}},_handleGetOrganizationGroups:function(a){if(a){if(a.results&&0<a.results.length)for(var b,d=0;d<a.results.length;d++)b=
a.results[d],this._allGroups.push({id:b.id,title:b.title,owner:b.owner,group:b});if(0<a.nextStart)this._account.getAccountGroups(this._organization.id,{start:a.nextStart,num:this._organizationGroupsMaxNum},c.hitch(this,this._handleGetOrganizationGroups));else{for(a=0;a<this._allGroups.length;a++){b=this._allGroups[a];for(var d=!1,e=a+1;e<this._allGroups.length;e++){var f=this._allGroups[e];b.title===f.title&&(d=!0,f.altTitle=f.title+" ("+f.owner+")")}d&&(b.altTitle=b.title+" ("+b.owner+")");d=b.altTitle||
b.title;this._gallerySelect.get("store").newItem({name:d,group:b.id,groupObj:b});this._basemapGallerySelect.get("store").newItem({name:d,group:b,id:b.id});this._templatesSelect.get("store").newItem({name:d,group:b,id:b.id});this._homePageFeaturedSelect.get("store").newItem({name:d,group:b,id:b.id});this._galleryAppsSelect.get("store").newItem({name:d,group:b,id:b.id})}this._gallerySelect.get("store").save();this._basemapGallerySelect.get("store").save();this._templatesSelect.get("store").save();this._homePageFeaturedSelect.get("store").save();
this._galleryAppsSelect.get("store").save();var g=this._organization.featuredItemsGroupQuery;if(esri.isDefined(g)||""!==g){var h=this._gallerySelect.get("store");h.fetch({onComplete:c.hitch(this,function(a,b){var d=null;c.forEach(a,c.hitch(this,function(a){var b=h.getValue(a,"group");g==="id:"+b&&(d=a)}));esri.isDefined(d)&&this._gallerySelect.set("displayedValue",h.getValue(d,"name"))})})}this._loadOrganizationResources()}}},_showProfile:function(a){var b=c.attr(a.currentTarget,"owner"),d=arcgisonline.sharing.dijit.ProfilePopup.prototype.statics.getInstance();
esri.isDefined(d)&&c.hitch(d,d.showProfile,b,a.currentTarget).call()},insertSecurityToken:function(a){return a&&a.id&&a.innerHTML?(a.innerHTML=a.innerHTML.replace("token\x3dSECURITY_TOKEN","token\x3d"+this._util.getToken()),a.innerHTML=this._organization.allSSL?a.innerHTML.replace("http:","https:"):a.innerHTML.replace("https:","http:"),a.innerHTML):a},removeSecurityToken:function(a){a&&(a=a.replace("token\x3d"+this._util.getToken(),"token\x3dSECURITY_TOKEN"));return a},removeHTMLBreak:function(a){if(null==
a)return"";a=a.replace(/&(lt|gt);/g,function(a,c){return"lt"==c?"\x3c":"\x3e"});return c.trim(a.replace("\x3cbr /\x3e",""))},refreshPendingInvitations:function(a){this._loadPendingOrganizationUsers()},copyUser:function(a){return{created:a.created[0],culture:a.culture[0],email:a.email[0],fullName:a.fullName[0],lastLogin:a.lastLogin[0],role:a.role[0],storageUsage:a.storageUsage[0],username:a.username[0],disabled:a.disabled[0],idpUsername:a.idpUsername[0],userType:a.userType[0],mfaEnabled:a.mfaEnabled[0],
availableCredits:a.availableCredits[0],assignedCredits:a.assignedCredits[0]}},copyInvite:function(a,b){return{accepted:a.getValue(b,"accepted"),created:a.getValue(b,"created"),culture:a.getValue(b,"culture"),dateAccepted:a.getValue(b,"dateAccepted"),email:a.getValue(b,"email"),expiration:a.getValue(b,"expiration"),fromUsername:a.getValue(b,"fromUsername"),id:a.getValue(b,"id"),mustApprove:a.getValue(b,"mustApprove"),role:a.getValue(b,"role"),targetId:a.getValue(b,"targetId"),targetType:a.getValue(b,
"targetType"),type:a.getValue(b,"type"),username:a.getValue(b,"username")}},loadUserActionsMenu:function(a,b){if(this._userActionMenuConn&&0<this._userActionMenuConn.length){for(var d=0;d<this._userActionMenuConn.length;d++)c.disconnect(this._userActionMenuConn[d]);this._userActionMenuConn=null}var d=this.copyUser(b),e=this._util.getUser();this._selectedUsername=d.username;this._isAdmin?(this._userActionItems.set("label",this.i18n.formatters.manageItems),!this._util.isPortal()&&0>d.lastLogin?(c.style("userActionMenu-items",
"display",""),c.style("userActionMenu-groups","display",""),c.style("userActionMenu-profile","display","none"),c.style("userActionMenu-enable","display","none"),c.style("userActionMenu-suspend","display","none"),c.style("userActionMenu-expire","display","none"),c.style("userActionMenu-reset","display",""),esriGeowConfig.creditBudgetingEnabled&&(esri.isDefined(this._organization.creditAssignments)&&("enabled"===this._organization.creditAssignments||"validated"===this._organization.creditAssignments))&&
c.style("userActionMenu-budget","display",""),c.style("userActionMenu-disablemfa","display","none"),c.style("userActionMenu-enableesri","display","none"),c.style("userActionMenu-disableesri","display","none")):(c.style("userActionMenu-items","display",""),c.style("userActionMenu-groups","display",""),c.style("userActionMenu-profile","display",""),d.disabled?(c.style("userActionMenu-enable","display",""),c.style("userActionMenu-suspend","display","none")):(c.style("userActionMenu-enable","display",
"none"),c.style("userActionMenu-suspend","display","")),esri.isDefined(d.idpUsername)&&0<d.idpUsername.length?(c.style("userActionMenu-expire","display","none"),c.style("userActionMenu-reset","display","none")):(c.style("userActionMenu-expire","display","none"),c.style("userActionMenu-reset","display","")),!this._util.isPortal()&&esriGeowConfig.creditBudgetingEnabled&&esri.isDefined(this._organization.creditAssignments)&&("enabled"===this._organization.creditAssignments||"validated"===this._organization.creditAssignments)?
c.style("userActionMenu-budget","display",""):c.style("userActionMenu-budget","display","none"),esriGeowConfig.multiFactorEnabled&&!this._util.isPortal()&&!this._isDeveloperSubscription&&d.mfaEnabled?c.style("userActionMenu-disablemfa","display",""):c.style("userActionMenu-disablemfa","display","none"),this._util.isPortal()?(c.style("userActionMenu-enableesri","display","none"),c.style("userActionMenu-disableesri","display","none")):esri.isDefined(d.idpUsername)&&0<d.idpUsername.length?(c.style("userActionMenu-enableesri",
"display","none"),c.style("userActionMenu-disableesri","display","none")):d.userType===this.userTypeBoth?(c.style("userActionMenu-enableesri","display","none"),c.style("userActionMenu-disableesri","display","")):(c.style("userActionMenu-enableesri","display",""),c.style("userActionMenu-disableesri","display","none"))),c.style("userActionMenu-delete","display",""),e.username===d.username&&(c.style("userActionMenu-suspend","display","none"),c.style("userActionMenu-expire","display","none"),c.style("userActionMenu-reset",
"display","none"),c.style("userActionMenu-delete","display","none"))):this._isCustomRole?!this._util.isPortal()&&this._roleCanDeleteUsers&&0>d.lastLogin?(c.style("userActionMenu-items","display","none"),c.style("userActionMenu-groups","display","none"),c.style("userActionMenu-profile","display","none"),c.style("userActionMenu-enable","display","none"),c.style("userActionMenu-suspend","display","none"),c.style("userActionMenu-budget","display","none"),c.style("userActionMenu-disablemfa","display",
"none"),c.style("userActionMenu-enableesri","display","none"),c.style("userActionMenu-disableesri","display","none"),c.style("userActionMenu-expire","display","none"),c.style("userActionMenu-reset","display","none"),"account_admin"!==d.role&&"org_admin"!==d.role?c.style("userActionMenu-delete","display",""):c.style("userActionMenu-delete","display","none"),this._roleCanViewUsers&&this._roleCanViewItems&&(this._userActionItems.set("label",this.i18n.formatters.manageItems),c.style("userActionMenu-items",
"display","")),this._roleCanViewUsers&&this._roleCanViewGroups&&c.style("userActionMenu-groups","display","")):(this._roleCanViewUsers&&this._roleCanViewItems?this._userActionItems.set("label",this.i18n.formatters.manageItems):this._userActionItems.set("label",this.i18n.formatters.viewItems),c.style("userActionMenu-items","display",""),c.style("userActionMenu-groups","display",""),c.style("userActionMenu-profile","display",""),c.style("userActionMenu-expire","display","none"),c.style("userActionMenu-reset",
"display","none"),c.style("userActionMenu-budget","display","none"),c.style("userActionMenu-disablemfa","display","none"),c.style("userActionMenu-enableesri","display","none"),c.style("userActionMenu-disableesri","display","none"),this._roleCanDisableUsers&&"account_admin"!==d.role&&"org_admin"!==d.role&&e.username!==d.username?d.disabled?(c.style("userActionMenu-enable","display",""),c.style("userActionMenu-suspend","display","none")):(c.style("userActionMenu-enable","display","none"),c.style("userActionMenu-suspend",
"display","")):(c.style("userActionMenu-enable","display","none"),c.style("userActionMenu-suspend","display","none")),this._roleCanDeleteUsers&&"account_admin"!==d.role&&"org_admin"!==d.role&&e.username!==d.username?c.style("userActionMenu-delete","display",""):c.style("userActionMenu-delete","display","none")):(this._userActionItems.set("label",this.i18n.formatters.viewItems),c.style("userActionMenu-items","display",""),c.style("userActionMenu-groups","display",""),c.style("userActionMenu-profile",
"display",""),c.style("userActionMenu-enable","display","none"),c.style("userActionMenu-suspend","display","none"),c.style("userActionMenu-expire","display","none"),c.style("userActionMenu-reset","display","none"),c.style("userActionMenu-budget","display","none"),c.style("userActionMenu-disablemfa","display","none"),c.style("userActionMenu-enableesri","display","none"),c.style("userActionMenu-disableesri","display","none"),c.style("userActionMenu-delete","display","none"));this._userActionMenuConn=
[];this._userActionMenuConn.push(c.connect(this._userActionItems,"onClick",c.hitch(this,this.viewUserItems,d.username)));this._userActionMenuConn.push(c.connect(this._userActionGroups,"onClick",c.hitch(this,this.viewUserGroups,d.username)));this._userActionMenuConn.push(c.connect(this._userActionProfile,"onClick",c.hitch(this,this.viewUserProfile,d.username)));this._userActionMenuConn.push(c.connect(this._userActionExpire,"onClick",c.hitch(this,this.expireUserPassword,d.username)));this._userActionMenuConn.push(c.connect(this._userActionReset,
"onClick",c.hitch(this,this.resetUserPassword,d.username,d.fullName,d.email)));esriGeowConfig.multiFactorEnabled&&(!this._util.isPortal()&&!this._isDeveloperSubscription)&&this._userActionMenuConn.push(c.connect(this._userActionMFA,"onClick",c.hitch(this,this.disableMFA,d.username)));!this._util.isPortal()&&(esriGeowConfig.creditBudgetingEnabled&&this._organization.creditAssignments&&("enabled"===this._organization.creditAssignments||"validated"===this._organization.creditAssignments))&&this._userActionMenuConn.push(c.connect(this._userActionBudget,
"onClick",c.hitch(this,this.manageBudget,d.username)));this._userActionMenuConn.push(c.connect(this._userActionEnableEsri,"onClick",c.hitch(this,this.enableEsriAccess,d.username)));this._userActionMenuConn.push(c.connect(this._userActionDisableEsri,"onClick",c.hitch(this,this.disableEsriAccess,d.username)));this._userActionMenuConn.push(c.connect(this._userActionEnable,"onClick",c.hitch(this,this.enableUser,d.username)));this._userActionMenuConn.push(c.connect(this._userActionSuspend,"onClick",c.hitch(this,
this.disableUser,d.username)));this._userActionMenuConn.push(c.connect(this._userActionDelete,"onClick",c.hitch(this,this.deleteUser,d.username)));g.byId("userActionMenu")._openMyself(a)},loadPendingUserActionsMenu:function(a,b){this._selectedPendingInvitation=b;if(this._pendingActionMenuConn&&0<this._pendingActionMenuConn.length)for(var d=0;d<this._pendingActionMenuConn;d++)c.disconnect(this._pendingActionMenuConn[d]);var e=this._pendingGrid.get("store");e.fetch({query:{id:b},onComplete:c.hitch(this,
function(d){d&&0<d.length&&(d=this.copyInvite(e,d[0]),esri.isDefined(d.mustApprove)&&!0===d.mustApprove?c.style("pendingActionMenu-approve","display",""):c.style("pendingActionMenu-approve","display","none"),esri.isDefined(d.username)?c.style("pendingActionMenu-resend","display","none"):c.style("pendingActionMenu-resend","display",""),this._pendingActionMenuConn=[],this._pendingActionMenuConn.push(c.connect(this._pendingActionApprove,"onClick",c.hitch(this,this.approveInvitation,b))),this._pendingActionMenuConn.push(c.connect(this._pendingActionResend,
"onClick",c.hitch(this,this.resendInvitation,d))),this._pendingActionMenuConn.push(c.connect(this._pendingActionRemove,"onClick",c.hitch(this,this.removeInvitation,b))),g.byId("pendingActionMenu")._openMyself(a))})})},viewUserItems:function(a){var b=esriGeowConfig.baseUrl,c=this._util.getUser();this._isAdmin||this._roleCanViewUsers&&this._roleCanViewItems?(b+="content.html",a!==c.username&&(b+="?user\x3d"+a)):b+="search.html?q\x3downer:"+a+"\x26t\x3dcontent";window.location=b},viewUserGroups:function(a){var b=
esriGeowConfig.baseUrl,c=this._util.getUser();this._isAdmin||this._roleCanViewGroups?(b+="groups.html",a!==c.username&&(b+="?user\x3d"+a)):b+="search.html?q\x3downer:"+a+"\x26t\x3dgroups";window.location=b},viewUserProfile:function(a){var b=esriGeowConfig.baseUrl+"user.html",c=this._util.getUser();a!==c.username&&(b+="?user\x3d"+a);window.location=b},_generateNewPassword:function(){var a=new c.Deferred,b,d;if(this._util.isPortal()&&esriGeowConfig.passwordPolicyEnabled)this._loadPasswordPolicy().then(c.hitch(this,
function(c){this._passwordPolicy=c;b=this._generatePassword();if(this._passwordPolicy)for(d=this._util.meetsPasswordPolicyStrength(this._passwordPolicy,b);!d.meetsRequirements();)b=this._generatePassword(),d=this._util.meetsPasswordPolicyStrength(this._passwordPolicy,b);else for(;!this._util.meetsPasswordStrength(b);)b=this._generatePassword();a.resolve(b)}),c.hitch(this,function(c){for(b=this._generatePassword();!this._util.meetsPasswordStrength(b);)b=this._generatePassword();a.resolve(b)}));else{for(b=
this._generatePassword();!this._util.meetsPasswordStrength(b);)b=this._generatePassword();a.resolve(b)}return a.promise},_generatePassword:function(){var a="ABCDEFGHIJKLMNOPQRSTWXYZabcdefghjkmnpqrstuvwxyz23456789",b="",c=this._passwordPolicy,e=c?this._passwordPolicy.minLength:8;c&&this._passwordPolicy.minOther&&(a+="!#$%()*+,-./:;\x3d?@[]^_{}~");for(c=0;c<e;c++)b+=a.charAt(Math.floor(Math.random()*a.length));return b},reallyResetUserPassword:function(a,b,d){var e=this._util.getSecureUrl(esriGeowConfig.restBaseUrl),
f=e+"community/users/"+a+"/reset",k={email:!0},h=e+"community/users/"+a+"/update",l,m=e+"community/users/"+a+"/expirePassword",p={expiration:-1},n;this._util.isPortal()?this._generateNewPassword().then(c.hitch(this,function(e){l={password:e};this._util.request({url:h,content:l},{usePost:!0}).then(c.hitch(this,function(f){f&&!f.code?(n="\x3cp\x3e"+esri.substitute({user:a},this.i18n.passwordResetDescPortal)+"\x3c/p\x3e\x3cp\x3e"+esri.substitute({user:a},this.i18n.passwordRespDesc)+"\x3c/p\x3e\x3cp\x3e\x3cstrong\x3e"+
d+"\x3c/strong\x3e\x3c/p\x3e\x3cp\x3e"+esri.substitute({fullname:b},this.i18n.passwordSampleHello)+"\x3c/p\x3e\x3cp\x3e"+esri.substitute({username:a},this.i18n.passwordSampleReset)+"\x3c/p\x3e\x3cp\x3e\x3cstrong\x3e"+e+"\x3c/strong\x3e\x3c/p\x3e\x3cp\x3e"+esri.substitute({orgName:this._organization.name},this.i18n.passwordResetSignIn)+"\x3c/p\x3e",this._util.request({url:m,content:p},{usePost:!0}).then(c.hitch(this,function(){this._generalDlg.show({title:this.i18n.passwordResetLabel,message:n})}),
c.hitch(this,function(){this._generalDlg.show({title:this.i18n.passwordResetLabel,message:n})}))):(console.log(f),this._generalDlg.show({title:this.i18n.errorTitle,message:esri.substitute({user:a},this.i18n.passwordResetError)}))}),c.hitch(this,function(b){console.log(b);this._generalDlg.show({title:this.i18n.errorTitle,message:esri.substitute({user:a},this.i18n.passwordResetError)})}))})):this._util.request({url:f,content:k},{usePost:!0}).then(c.hitch(this,function(){this._generalDlg.show({title:this.i18n.passwordResetLabel,
message:esri.substitute({user:a},this.i18n.passwordResetDesc)})}),c.hitch(this,function(b){console.log(b);n=esri.substitute({user:a},this.i18n.passwordResetError);b&&"COM_1062"===b.messageCode?n=this.i18n.passwordResetDisabled:b&&"COM_1063"===b.messageCode&&(n=this.i18n.passwordResetBlocked);this._generalDlg.show({title:this.i18n.errorTitle,message:n})}));c.addClass(g.byId("button_delete-warning-submit").domNode,"caution")},disableMFA:function(a){this._deleteWarnDlg.showMsgTitleButton(esri.substitute({user:a},
this.i18n.securityTab.disableMultiFactorUserMsg),this.i18n.disable+" "+this.i18n.securityTab.multiFactorAuth,this.i18n.disable,c.hitch(this,this.reallyDisableMFA,a));c.removeClass(g.byId("button_delete-warning-submit").domNode,"orange");c.addClass(g.byId("button_delete-warning-submit").domNode,"caution")},reallyDisableMFA:function(a){var b=this._util.getSecureUrl(esriGeowConfig.restBaseUrl)+"community/users/"+a+"/disableMfa";this._util.request({url:b},{usePost:!0}).then(c.hitch(this,function(b){this._generalDlg.show({title:this.i18n.noticeLabel,
message:esri.substitute({user:a},this.i18n.securityTab.disableMultiFactorSuccess)});this._replayLastSearch()}),c.hitch(this,function(b){console.log("error disabling multi-factor authentication",b);b=esri.substitute({user:a},this.i18n.securityTab.errorDisableMultiFactor);this._generalDlg.show({title:this.i18n.noticeLabel,message:b})}))},resetUserPassword:function(a,b,d){this._deleteWarnDlg.showMsgTitleButton(esri.substitute({user:a},this.i18n.wishToResetPwd),this.i18n.formatters.resetPassword,this.i18n.ok,
c.hitch(this,this.reallyResetUserPassword,a,b,d));c.removeClass(g.byId("button_delete-warning-submit").domNode,"orange");c.removeClass(g.byId("button_delete-warning-submit").domNode,"caution");c.addClass(g.byId("button_delete-warning-submit").domNode,"primary")},expireUserPassword:function(a){this._util.request({url:esriGeowConfig.restBaseUrl+"community/users/"+a+"/expirePassword",content:{expiration:-1}},{usePost:!0}).then(c.hitch(this,function(b){this._generalDlg.show({title:this.i18n.noticeLabel,
message:esri.substitute({user:a},this.i18n.passwordExpired)})}),c.hitch(this,function(b){var c=esri.substitute({user:a},this.i18n.passwordExpiredError);console.log(c,b);this._generalDlg.show({title:this.i18n.noticeLabel,message:c})}))},enableEsriAccess:function(a){this._deleteWarnDlg.showMsgTitleButton(this.i18n.enableEsriAccessDesc,this.i18n.enableEsriAccessTitle,this.i18n.ok,c.hitch(this,this.reallyEnableEsriAccess,a));c.removeClass(g.byId("button_delete-warning-submit").domNode,"orange");c.removeClass(g.byId("button_delete-warning-submit").domNode,
"caution");c.addClass(g.byId("button_delete-warning-submit").domNode,"primary")},reallyEnableEsriAccess:function(a){var b=this._util.getSecureUrl(esriGeowConfig.restBaseUrl)+"community/users/"+a+"/update";this._util.request({url:b,content:{usertype:this.userTypeBoth}},{usePost:!0}).then(c.hitch(this,function(b){this._generalDlg.show({title:this.i18n.noticeLabel,message:esri.substitute({user:a},this.i18n.esriAccessEnabled)});this._replayLastSearch();this._updateUsertypeInCookieAndRefresh(a,this.userTypeBoth)}),
c.hitch(this,function(b){var c=esri.substitute({user:a},this.i18n.enableEsriAccessError);console.log(c,b);this._generalDlg.show({title:this.i18n.noticeLabel,message:c})}));c.addClass(g.byId("button_delete-warning-submit").domNode,"caution")},disableEsriAccess:function(a){var b=this._util.getSecureUrl(esriGeowConfig.restBaseUrl)+"community/users/"+a+"/update";request={usertype:this.userTypeArcGIS};this._util.request({url:b,content:request},{usePost:!0}).then(c.hitch(this,function(b){this._generalDlg.show({title:this.i18n.noticeLabel,
message:esri.substitute({user:a},this.i18n.esriAccessDisabled)});this._replayLastSearch();this._updateUsertypeInCookieAndRefresh(a,this.userTypeArcGIS)}),c.hitch(this,function(b){var c=esri.substitute({user:a},this.i18n.disableEsriAccessError);console.log(c,b);this._generalDlg.show({title:this.i18n.noticeLabel,message:c})}))},_updateUsertypeInCookieAndRefresh:function(a,b){if(this._util.getUser().username===a){esriGeowConfig.userInfo.usertype=b;var c=g.byId("header");c&&c.updateEsriAccessLinks(b)}},
enableUser:function(a){this._util.request({url:esriGeowConfig.restBaseUrl+"community/users/"+a+"/enable"},{usePost:!0}).then(c.hitch(this,function(b){this._generalDlg.show({title:this.i18n.noticeLabel,message:esri.substitute({user:a},this.i18n.enabledUser)});this._replayLastSearch()}),c.hitch(this,function(b){var c=esri.substitute({user:a},this.i18n.enabledUserError);console.log(c,b);this._generalDlg.show({title:this.i18n.noticeLabel,message:c})}))},disableUser:function(a){this._util.request({url:esriGeowConfig.restBaseUrl+
"community/users/"+a+"/disable"},{usePost:!0}).then(c.hitch(this,function(b){this._generalDlg.show({title:this.i18n.noticeLabel,message:esri.substitute({user:a},this.i18n.disabledUser)});b=this._organization.mfaAdmins&&0<this._organization.mfaAdmins.length?c.indexOf(this._organization.mfaAdmins,a):-1;-1<b&&this._organization.mfaAdmins.splice(b,1);this._replayLastSearch()}),c.hitch(this,function(b){var c=esri.substitute({user:a},this.i18n.disabledUserError);console.log(c,b);b&&b.messageCode&&"COM_1061"===
b.messageCode?c=esri.substitute({user:a},this.i18n.securityTab.needTwoAdminDisableMsg):b&&(b.messageCode&&"COM_1078"===b.messageCode)&&(c+=" "+this.i18n.couldNotRemoveContact);this._generalDlg.show({title:this.i18n.noticeLabel,message:c})}))},manageBudget:function(a){this._assignCreditsDlg.show(a)},approveInvitation:function(a){this._account.approvePendingInvitation(this._organization.id,a,c.hitch(this,this.refreshPendingInvitations))},removeInvitation:function(a){this._deleteWarnDlg.showMsgTitleButton(this.i18n.reallyRemoveInviteMsg,
this.i18n.formatters.removeInvite,this.i18n.formatters.removeInvite,c.hitch(this,this.reallyRemoveInvitation,a));c.removeClass(g.byId("button_delete-warning-submit").domNode,"orange");c.addClass(g.byId("button_delete-warning-submit").domNode,"caution")},reallyRemoveInvitation:function(a){this._account.removePendingInvitation(this._organization.id,a,c.hitch(this,this.refreshPendingInvitations))},resendInvitation:function(a){this._resendInviteDlg.show(a)},onInvitationResent:function(a){a&&(this._selectedMemberView=
null,this.onMemberViewChange())},onUserRoleUpdate:function(a,b){b&&b.success&&(g.byId("userRole"+a).set("disabled",!0),this._replayLastSearch())},setSaving:function(){g.byId("upperSave").set("disabled",!0);g.byId("lowerSave").set("disabled",!0);g.byId("upperSave").set("label",this.i18n.savingLabel);g.byId("lowerSave").set("label",this.i18n.savingLabel)},unsetSaving:function(){g.byId("upperSave").set("disabled",!1);g.byId("lowerSave").set("disabled",!1);g.byId("upperSave").set("label",this.i18n.saveLabel);
g.byId("lowerSave").set("label",this.i18n.saveLabel)},setLoading:function(){c.query("body").forEach(function(a){c.addClass(a,"loading")})},unsetLoading:function(){c.query("body").forEach(function(a){c.removeClass(a,"loading")})},_isSSLtoHTTP:function(a){return"https:"===location.protocol&&-1<a.indexOf("http:")},getServiceInfo:function(a,b,c){a=this.setFormat(a);a=this.useSSL(a);a=this.addToken(a);var e=this._isSSLtoHTTP(a);esri.request({url:a,callbackParamName:"callback",load:function(e,g){b?b(e,
g):arcgisonline.sharing.util.handler(e,g,a,b,c)},error:function(b,e){c?c(b,e):arcgisonline.sharing.util.errorHandler(b,e,a,c)}},{useProxy:e})},setFormat:function(a){return a=0<=a.indexOf("?")?a+"\x26f\x3djson":a+"?f\x3djson"},addToken:function(a){var b=this._util.getToken();null!=b&&""!==b&&this._util.isHostedService(a)?a=a+"\x26token\x3d"+b:this._util.isPortal()&&this._util.onFederatedServer(a)&&(a=a+"\x26token\x3d"+b);return a},useSSL:function(a){if((esriGeowConfig.allSSL||"https:"==location.protocol)&&
(this._util.isHostedService(a)||this._util.supportsHttps(a)))a=arcgisonline.sharing.util.getSecureUrl(a);return a},federatedServerStatusFormatter:function(a,b){if(!b)return this.defaultValue;var c=arcgisonline.sharing.util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/server-unknown-icon.png"),e;esri.isDefined(b.status)&&("valid"===b.status[0]?(c=arcgisonline.sharing.util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/server-valid-icon.png"),b.msg&&b.msg[0]&&(e=
b.msg[0])):"invalid"===b.status[0]?(c=arcgisonline.sharing.util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/server-invalid-icon.png"),b.msg&&b.msg[0]&&(e=b.msg[0])):"validating"===b.status[0]&&(c=arcgisonline.sharing.util.relativeToExplicitUrl("js/arcgisonline/css/images/spinner20.gif")));return esri.substitute({image:c,msg:esri.isDefined(e)?'title\x3d"'+e+'"':""},'\x3cdiv ${msg}\x3e\x3cimg src\x3d"${image}" style\x3d"width:16px;height:16px;"\x3e\x3c/div\x3e')},federatedServerFormatter:function(a,
b){return!b?this.defaultValue:esri.substitute({managerUrl:b.adminUrl+"/manager",url:b.adminUrl},'\x3cdiv\x3e\x3ca class\x3d"esriContentItemTitle" href\x3d"${managerUrl}" target\x3d"_blank"\x3e${url}\x3c/a\x3e\x3c/div\x3e')},removeFederatedServerFormatter:function(a,b){if(!b)return this.defaultValue;var c=g.byId("organizationWidget"),e=arcgisonline.sharing.util.relativeToExplicitUrl("js/arcgisonline/css/images/delete_20x20.png");return esri.substitute({id:b.id,removeText:c.i18n.serversTab.federatedRemoveServer},
'\x3cdiv id\x3d"removeServer-'+b.id+'"\x3e\x3ca class\x3d"esriContentItemTitle" href\x3d"#" onclick\x3d"dijit.byId(\'organizationWidget\').removeFederatedServer(\'${id}\')" alt\x3d"${removeText}" title\x3d"${removeText}"\x3e\x3cimg src\x3d"'+e+'" alt\x3d"${removeText}" style\x3d"width:20px; height:20px;"/\x3e\x3c/a\x3e\x3c/div\x3e')},nameFormatter:function(a,b){if(!b)return this.defaultValue;var c=b.fullName,e=b.username,f=q.html.entities.encode(g.byId("organizationWidget").i18n.formatters.viewProfile);
return'\x3cdiv\x3e\x3ca class\x3d"'+(b.disabled[0]&&-1!==b.lastLogin[0]?"disabledUserName":"esriContentItemTitle")+'" href\x3d"#" onclick\x3d"arcgisonline.sharing.dijit.ProfilePopup.prototype.statics.getInstance().showProfile(\''+e+'\', this);" alt\x3d"'+f+'" title\x3d"'+f+'"\x3e'+c+"\x3c/a\x3e\x3c/div\x3e"},mfaFormatter:function(a,b){if(!b)return this.defaultValue;var c="",e=g.byId("organizationWidget"),f=arcgisonline.sharing.util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/check.png"),
k=q.html.entities.encode(e.i18n.securityTab.multiFactorAuth+" "+e.i18n.enabledLabel);b.mfaEnabled[0]&&e._organization.mfaEnabled&&(c='\x3cdiv style\x3d"width:100%;text-align:center;height:16px;"\x3e\x3cimg style\x3d"width:12px;height:16px;" src\x3d"'+f+'" alt\x3d"'+k+'" title\x3d"'+k+'"\x3e\x3c/div\x3e');return c},creditFormatter:function(a,b){if(!b)return this.defaultValue;var d='\x3cspan class\x3d"esriContentTypeName"\x3e',e=g.byId("organizationWidget"),d=b.assignedCredits&&-1<b.assignedCredits[0]?
b.availableCredits[0]>e._organization.subscriptionInfo.availableCredits?d+('\x3clabel title\x3d"'+e.i18n.creditsTab.exceedOrgLimit+'"\x3e'+c.number.format(parseInt(b.availableCredits[0],10))+"\x3c/label\x3e"):d+(""+c.number.format(parseInt(b.availableCredits[0],10))):d+('\x3ci title\x3d"'+e.i18n.creditsTab.orgLimit+'"\x3e'+c.number.format(parseInt(e._organization.subscriptionInfo.availableCredits,10))+"\x3c/i\x3e");return d+"\x3c/span\x3e"},pendingEmailFormatter:function(a,b){if(!b)return this.defaultValue;
var c="";if(b.username[0]&&""!==b.username[0])var c=b.email,e=b.username,f=q.html.entities.encode(g.byId("organizationWidget").i18n.formatters.viewProfile),c='\x3cdiv\x3e\x3ca class\x3d"esriContentItemTitle" href\x3d"#" onclick\x3d"arcgisonline.sharing.dijit.ProfilePopup.prototype.statics.getInstance().showProfile(\''+e+'\', this);" alt\x3d"'+f+'" title\x3d"'+f+'"\x3e'+c+"\x3c/a\x3e\x3c/div\x3e";else c=b.email;return c},createdFormatter:function(a,b){if(!b)return this.defaultValue;var d;d='\x3cspan class\x3d"esriContentTypeName"\x3e'+
c.date.locale.format(new Date(b.created[0]),{selector:"date",formatLength:"medium"});return d+"\x3c/span\x3e"},lastLoginFormatter:function(a,b){if(!b)return this.defaultValue;var d=g.byId("organizationWidget"),e=b.lastLogin[0],f;0<e?f='\x3cspan class\x3d"esriContentTypeName"\x3e'+c.date.locale.format(new Date(e),{selector:"date",formatLength:"medium"}):(f="\x3cspan",f=(!esriGeowConfig.self||!esriGeowConfig.self.isPortal)&&(esriGeowConfig.userRole.isAdmin()||esriGeowConfig.userRole.isCustom()&&(esriGeowConfig.userRole.canInviteUsers()||
esriGeowConfig.userRole.canDeleteUsers()))&&0>e?f+' class\x3d"esriContentTypeName orgSettingTooltip"':f+' class\x3d"esriContentTypeName"',f+="\x3e"+d.i18n.notYet);return f+"\x3c/span\x3e"},dateAcceptedFormatter:function(a,b){if(!b)return this.defaultValue;var d=null;0<b.dateAccepted[0]&&(d=new Date(b.dateAccepted[0]));var e=g.byId("organizationWidget");return d?(d='\x3cspan class\x3d"esriContentTypeName"\x3e'+c.date.locale.format(d,{selector:"date",formatLength:"medium"}),d+"\x3c/span\x3e"):e.i18n.notYet},
pendingActionsFormatter:function(a,b){if(!b)return this.defaultValue;var c=g.byId("organizationWidget"),c=q.html.entities.encode(c.i18n.pendingGrid.actionsHover);return'\x3cdiv class\x3d"actionsCol"\x3e\x3cimg src\x3d"'+arcgisonline.sharing.util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/settings-arrow.png")+'" alt\x3d"'+c+'"\x3e\x3c/div\x3e'},userActionsFormatter:function(a,b){if(!b)return this.defaultValue;var c=g.byId("organizationWidget"),e=arcgisonline.sharing.util.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/settings-arrow.png"),
c=q.html.entities.encode(c.i18n.currentGrid.actionsHover);return'\x3cdiv class\x3d"actionsCol"\x3e\x3cimg src\x3d"'+e+'" alt\x3d"'+c+'"\x3e\x3c/div\x3e'},lookupCustomRoleId:function(a){var b=c.filter(this._customRoles,function(b){return b.name===a});return b&&b[0]?b[0].id:""},lookupCustomRoleName:function(a){var b=c.filter(this._customRoles,function(b){return b.id===a});return b&&b[0]?b[0].name:""},lookupCustomRoleDescription:function(a){var b=c.filter(this._customRoles,function(b){return b.id===
a});return b&&b[0]?b[0].description:""},formatCustomRolesForRoleSelect:function(){var a=[];c.forEach(this._customRoles,c.hitch(this,function(b){a.push({name:b.name,role:b.id})}));return a},roleFormatter:function(a,b){if(!b)return this.defaultValue;var c=g.byId("organizationWidget"),e=b.role[0],f="...",f=-1!==b.lastLogin[0]&&b.disabled[0]?c.i18n.formatters.disabledUser:e===arcgisonline.sharing.dijit.Organization.util.accountUserRole?c.i18n.formatters.roleUser:e===arcgisonline.sharing.dijit.Organization.util.accountPublisherRole?
c.i18n.formatters.rolePublisher:e===arcgisonline.sharing.dijit.Organization.util.accountAdminRole?c.i18n.formatters.roleAdmin:c.lookupCustomRoleName(e);return'\x3cspan class\x3d"esriContentTypeName"\x3e'+f+"\x3c/span\x3e"},roleSelectFormatter:function(a,b){if(!b)return this.defaultValue;var d=g.byId("organizationWidget"),e=b.role[0],f=null,k=-1!==b.lastLogin[0]&&b.disabled[0],h=esriGeowConfig.userRole.isCustom()&&esriGeowConfig.userRole.canChangeUserRoles();if(!e)return this.defaultValue;f=e===arcgisonline.sharing.dijit.Organization.util.accountUserRole?
d.i18n.formatters.roleUser:e===arcgisonline.sharing.dijit.Organization.util.accountPublisherRole?d.i18n.formatters.rolePublisher:e===arcgisonline.sharing.dijit.Organization.util.accountAdminRole?d.i18n.formatters.roleAdmin:d.lookupCustomRoleName(e);g.byId("userRole"+a)&&g.byId("userRole"+a).destroy();var l=g.byId("organizationWidget")._user.email===b.username[0];!esriGeowConfig.userRole.isAdmin()&&!h&&(l=!0);e===arcgisonline.sharing.dijit.Organization.util.accountAdminRole&&h&&(l=!0);var m=[];e!==
arcgisonline.sharing.dijit.Organization.util.accountAdminRole&&h||m.push({name:d.i18n.formatters.roleAdmin,role:arcgisonline.sharing.dijit.Organization.util.accountAdminRole});m.push({name:d.i18n.formatters.rolePublisher,role:arcgisonline.sharing.dijit.Organization.util.accountPublisherRole});m.push({name:d.i18n.formatters.roleUser,role:arcgisonline.sharing.dijit.Organization.util.accountUserRole});h=new c.data.ItemFileReadStore({data:{identifier:"role",label:"name",items:m.concat(d.formatCustomRolesForRoleSelect())}});
h.comparatorMap={name:arcgisonline.sharing.geow.Account.caseInsensitiveComparator};e=new arcgisonline.sharing.dijit.ComboBox({id:"userRole"+a,value:f,rowIndex:a,searchAttr:"name",store:h,fetchProperties:{sort:[{attribute:"name",descending:!1}]},style:{width:"137px","min-width":"137px"},disabled:l,title:e===arcgisonline.sharing.dijit.Organization.util.accountAdminRole?esri.substitute({type:d._getTenantTypeString()},d.i18n.adminRoleTooltip):e===arcgisonline.sharing.dijit.Organization.util.accountPublisherRole?
esri.substitute({type:d._getTenantTypeString()},d.i18n.publisherRoleTooltip):e===arcgisonline.sharing.dijit.Organization.util.accountUserRole?esri.substitute({type:d._getTenantTypeString()},d.i18n.userRoleTooltip):d.lookupCustomRoleDescription(e),onChange:c.hitch(this,function(a,b,e){var f=null,f=e===d.i18n.formatters.roleUser?arcgisonline.sharing.dijit.Organization.util.accountUserRole:e===d.i18n.formatters.rolePublisher?arcgisonline.sharing.dijit.Organization.util.accountPublisherRole:e===d.i18n.formatters.roleAdmin?
arcgisonline.sharing.dijit.Organization.util.accountAdminRole:d.lookupCustomRoleId(e);esri.isDefined(f)&&arcgisonline.sharing.geow.Account.updateUserRole(a,f,c.hitch(this,function(c){if(c&&c.messageCode&&"ORG_1052"===c.messageCode)d._generalDlg.show({title:d.i18n.notice,message:esri.substitute({user:a},this.i18n.securityTab.needTwoAdminRoleMsg)});else if(c.code&&c.messageCode&&"COM_1072"===c.messageCode)d._generalDlg.show({title:d.i18n.notice,message:esri.substitute({user:a},d.i18n.userWithUpdateControlError)});
else d.onUserRoleUpdate(b,c)}),c.hitch(this,function(c){c.code&&c.messageCode&&"ORG_1052"===c.messageCode?d._generalDlg.show({title:d.i18n.notice,message:esri.substitute({user:a},d.i18n.securityTab.needTwoAdminRoleMsg)}):c.code&&c.messageCode&&"COM_1072"===c.messageCode?d._generalDlg.show({title:d.i18n.notice,message:esri.substitute({user:a},d.i18n.userWithUpdateControlError)}):500===c.code&&"ORG_1045"===c.messageCode?d._generalDlg.show({title:d.i18n.notice,message:esri.substitute({user:a},d.i18n.changeToViewerDataError)}):
console.log("unable to change user role",c);d.onUserRoleUpdate(b,{success:!0})}))},b.username[0],a)});e.set("value",f);return k?d.i18n.formatters.disabledUser:e}});arcgisonline.sharing.dijit.Organization.util={accountAdminRole:"account_admin",accountPublisherRole:"account_publisher",accountUserRole:"account_user",noSort:function(a){var b=arcgisonline.sharing.util.getUser(),c=g.byId("organizationWidget"),e=c._isSingleTenant,f=esriGeowConfig.multiFactorEnabled&&c._organization.mfaEnabled&&!e&&!c._isDeveloperSubscription,
k=esriGeowConfig.creditBudgetingEnabled&&c._organization.creditAssignments&&("enabled"===c._organization.creditAssignments||"validated"===c._organization.creditAssignments);a=Math.abs(a);return b&&esriGeowConfig.userRole&&!esriGeowConfig.userRole.isAdmin()&&e?!(5===a||6===a||7===a):c._isAdmin&&k?f?!(4===a||7===a):!(3===a||6===a):c._isAdmin&&f?6!=a:5!==a},pendingNoSort:function(a){return 3>Math.abs(a)},serversNoSort:function(a){return!1},getSizeString:function(a){var b="",d={pattern:"#,###,###,##0.##"};
return b=1073741824<=a?b+(c.number.format(a/1073741824,d)+"GB"):0<a?b+(c.number.format(a/1048567,d)+"MB"):b+(c.number.format(a,d)+"MB")},escapeSingleQuotes:function(a){a&&0<a.length&&(a=a.replace("'","'"));return a},escapeQuotes:function(a){a&&0<a.length&&(a=a.replace(/\"/g,"'"));return a}}});