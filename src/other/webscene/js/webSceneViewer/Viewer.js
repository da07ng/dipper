// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
require({cache:{"dojo/_base/html":function(){define("./kernel ../dom ../dom-style ../dom-attr ../dom-prop ../dom-class ../dom-construct ../dom-geometry".split(" "),function(k,m,d,q,c,g,h,l){k.byId=m.byId;k.isDescendant=m.isDescendant;k.setSelectable=m.setSelectable;k.getAttr=q.get;k.setAttr=q.set;k.hasAttr=q.has;k.removeAttr=q.remove;k.getNodeProp=q.getNodeProp;k.attr=function(b,c,l){return 2==arguments.length?q["string"==typeof c?"get":"set"](b,c):q.set(b,c,l)};k.hasClass=g.contains;k.addClass=g.add;
k.removeClass=g.remove;k.toggleClass=g.toggle;k.replaceClass=g.replace;k._toDom=k.toDom=h.toDom;k.place=h.place;k.create=h.create;k.empty=function(b){h.empty(b)};k._destroyElement=k.destroy=function(b){h.destroy(b)};k._getPadExtents=k.getPadExtents=l.getPadExtents;k._getBorderExtents=k.getBorderExtents=l.getBorderExtents;k._getPadBorderExtents=k.getPadBorderExtents=l.getPadBorderExtents;k._getMarginExtents=k.getMarginExtents=l.getMarginExtents;k._getMarginSize=k.getMarginSize=l.getMarginSize;k._getMarginBox=
k.getMarginBox=l.getMarginBox;k.setMarginBox=l.setMarginBox;k._getContentBox=k.getContentBox=l.getContentBox;k.setContentSize=l.setContentSize;k._isBodyLtr=k.isBodyLtr=l.isBodyLtr;k._docScroll=k.docScroll=l.docScroll;k._getIeDocumentElementOffset=k.getIeDocumentElementOffset=l.getIeDocumentElementOffset;k._fixIeBiDiScrollLeft=k.fixIeBiDiScrollLeft=l.fixIeBiDiScrollLeft;k.position=l.position;k.marginBox=function(b,c){return c?l.setMarginBox(b,c):l.getMarginBox(b)};k.contentBox=function(b,c){return c?
l.setContentSize(b,c):l.getContentBox(b)};k.coords=function(b,c){k.deprecated("dojo.coords()","Use dojo.position() or dojo.marginBox().");b=m.byId(b);var g=d.getComputedStyle(b),g=l.getMarginBox(b,g),h=l.position(b,c);g.x=h.x;g.y=h.y;return g};k.getProp=c.get;k.setProp=c.set;k.prop=function(b,f,l){return 2==arguments.length?c["string"==typeof f?"get":"set"](b,f):c.set(b,f,l)};k.getStyle=d.get;k.setStyle=d.set;k.getComputedStyle=d.getComputedStyle;k.__toPixelValue=k.toPixelValue=d.toPixelValue;k.style=
function(b,c,l){switch(arguments.length){case 1:return d.get(b);case 2:return d["string"==typeof c?"get":"set"](b,c)}return d.set(b,c,l)};return k})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(k,m,d){return k("dijit.form.RangeBoundTextBox",d,{rangeMessage:"",rangeCheck:function(d,c){return("min"in c?0<=this.compare(d,c.min):!0)&&("max"in c?0>=this.compare(d,c.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),
this.constraints)},_isDefinitelyOutOfRange:function(){var d=this.get("value");if(null==d)return!1;var c=!1;"min"in this.constraints&&(c=this.constraints.min,c=0>this.compare(d,"number"==typeof c&&0<=c&&0!=d?0:c));!c&&"max"in this.constraints&&(c=this.constraints.max,c=0<this.compare(d,"number"!=typeof c||0<c?c:0));return c},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(d){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&
!this.required||this.isInRange(d))},getErrorMessage:function(d){var c=this.get("value");return null!=c&&""!==c&&("number"!=typeof c||!isNaN(c))&&!this.isInRange(d)?this.rangeMessage:this.inherited(arguments)},postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=m.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(k,m){return k("dijit._Contained",
null,{_getSibling:function(d){var k=this.domNode;do k=k[d+"Sibling"];while(k&&1!=k.nodeType);return k&&m.byNode(k)},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var d=this.getParent();return!d||!d.getIndexOfChild?-1:d.getIndexOfChild(this)}})})},"dijit/layout/StackContainer":function(){define("dojo/_base/array dojo/cookie dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/has dojo/_base/lang dojo/on dojo/ready dojo/topic dojo/when ../registry ../_WidgetBase ./_LayoutWidget".split(" "),
function(k,m,d,q,c,g,h,l,b,f,n,s,x,a){g("dijit-legacy-requires")&&b(0,function(){require(["dijit/layout/StackController"])});d=d("dijit.layout.StackContainer",a,{doLayout:!0,persist:!1,baseClass:"dijitStackContainer",buildRendering:function(){this.inherited(arguments);q.add(this.domNode,"dijitLayoutContainer")},postCreate:function(){this.inherited(arguments);this.own(l(this.domNode,"keydown",h.hitch(this,"_onKeyDown")))},startup:function(){if(!this._started){var a=this.getChildren();k.forEach(a,this._setupChild,
this);this.persist?this.selectedChildWidget=s.byId(m(this.id+"_selectedChild")):k.some(a,function(a){a.selected&&(this.selectedChildWidget=a);return a.selected},this);var b=this.selectedChildWidget;!b&&a[0]&&(b=this.selectedChildWidget=a[0],b.selected=!0);f.publish(this.id+"-startup",{children:a,selected:b,textDir:this.textDir});this.inherited(arguments)}},resize:function(){if(!this._hasBeenShown){this._hasBeenShown=!0;var a=this.selectedChildWidget;a&&this._showChild(a)}this.inherited(arguments)},
_setupChild:function(a){var b=a.domNode,f=c.place("\x3cdiv role\x3d'tabpanel' class\x3d'"+this.baseClass+"ChildWrapper dijitHidden'\x3e",a.domNode,"replace"),d=a["aria-label"]||a.title||a.label;d&&f.setAttribute("aria-label",d);c.place(b,f);a._wrapper=f;this.inherited(arguments);"none"==b.style.display&&(b.style.display="block");a.domNode.removeAttribute("title")},addChild:function(a,b){this.inherited(arguments);this._started&&(f.publish(this.id+"-addChild",a,b),this.layout(),this.selectedChildWidget||
this.selectChild(a))},removeChild:function(a){var b=k.indexOf(this.getChildren(),a);this.inherited(arguments);c.destroy(a._wrapper);delete a._wrapper;this._started&&f.publish(this.id+"-removeChild",a);if(!this._descendantsBeingDestroyed){if(this.selectedChildWidget===a&&(this.selectedChildWidget=void 0,this._started)){var t=this.getChildren();t.length&&this.selectChild(t[Math.max(b-1,0)])}this._started&&this.layout()}},selectChild:function(a,b){var c;a=s.byId(a);this.selectedChildWidget!=a&&(c=this._transition(a,
this.selectedChildWidget,b),this._set("selectedChildWidget",a),f.publish(this.id+"-selectChild",a),this.persist&&m(this.id+"_selectedChild",this.selectedChildWidget.id));return n(c||!0)},_transition:function(a,b){b&&this._hideChild(b);var c=this._showChild(a);a.resize&&(this.doLayout?a.resize(this._containerContentBox||this._contentBox):a.resize());return c},_adjacent:function(a){var b=this.getChildren(),c=k.indexOf(b,this.selectedChildWidget),c=c+(a?1:b.length-1);return b[c%b.length]},forward:function(){return this.selectChild(this._adjacent(!0),
!0)},back:function(){return this.selectChild(this._adjacent(!1),!0)},_onKeyDown:function(a){f.publish(this.id+"-containerKeyDown",{e:a,page:this})},layout:function(){var a=this.selectedChildWidget;a&&a.resize&&(this.doLayout?a.resize(this._containerContentBox||this._contentBox):a.resize())},_showChild:function(a){var b=this.getChildren();a.isFirstChild=a==b[0];a.isLastChild=a==b[b.length-1];a._set("selected",!0);a._wrapper&&q.replace(a._wrapper,"dijitVisible","dijitHidden");return a._onShow&&a._onShow()||
!0},_hideChild:function(a){a._set("selected",!1);a._wrapper&&q.replace(a._wrapper,"dijitHidden","dijitVisible");a.onHide&&a.onHide()},closeChild:function(a){a.onClose&&a.onClose(this,a)&&(this.removeChild(a),a.destroyRecursive())},destroyDescendants:function(a){this._descendantsBeingDestroyed=!0;this.selectedChildWidget=void 0;k.forEach(this.getChildren(),function(b){a||this.removeChild(b);b.destroyRecursive(a)},this);this._descendantsBeingDestroyed=!1}});d.ChildWidgetProperties={selected:!1,disabled:!1,
closable:!1,iconClass:"dijitNoIcon",showTitle:!0};h.extend(x,d.ChildWidgetProperties);return d})},"dijit/layout/TabController":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/has dojo/i18n dojo/_base/lang ./StackController ../registry ../Menu ../MenuItem dojo/text!./templates/_TabButton.html dojo/i18n!../nls/common".split(" "),function(k,m,d,q,c,g,h,l,b,f,n,s){s=k("dijit.layout._TabButton"+(c("dojo-bidi")?"_NoBidi":""),l.StackButton,{baseClass:"dijitTab",cssStateNodes:{closeNode:"dijitTabCloseButton"},
templateString:s,_setNameAttr:"focusNode",scrollOnFocus:!1,buildRendering:function(){this.inherited(arguments);m.setSelectable(this.containerNode,!1)},startup:function(){this.inherited(arguments);var b=this.domNode;this.defer(function(){b.className=b.className},1)},_setCloseButtonAttr:function(b){this._set("closeButton",b);q.toggle(this.domNode,"dijitClosable",b);this.closeNode.style.display=b?"":"none";b&&(b=g.getLocalization("dijit","common"),this.closeNode&&d.set(this.closeNode,"title",b.itemClose))},
_setDisabledAttr:function(b){this.inherited(arguments);if(this.closeNode)if(b)d.remove(this.closeNode,"title");else{var a=g.getLocalization("dijit","common");d.set(this.closeNode,"title",a.itemClose)}},_setLabelAttr:function(b){this.inherited(arguments);!this.showLabel&&!this.params.title&&(this.iconNode.alt=h.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});c("dojo-bidi")&&(s=k("dijit.layout._TabButton",s,{_setLabelAttr:function(b){this.inherited(arguments);this.applyTextDir(this.iconNode,
this.iconNode.alt)}}));k=k("dijit.layout.TabController",l,{baseClass:"dijitTabController",templateString:"\x3cdiv role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown:onkeydown'\x3e\x3c/div\x3e",tabPosition:"top",buttonWidget:s,buttonWidgetCloseClass:"dijitTabCloseButton",postCreate:function(){this.inherited(arguments);var c=new f({id:this.id+"_Menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,targetNodeIds:[this.domNode],selector:function(a){return q.contains(a,
"dijitClosable")&&!q.contains(a,"dijitTabDisabled")}});this.own(c);var a=g.getLocalization("dijit","common"),r=this;c.addChild(new n({label:a.itemClose,ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,onClick:function(a){a=b.byNode(this.getParent().currentTarget);r.onCloseButtonClick(a.page)}}))}});k.TabButton=s;return k})},"dojox/gfx/matrix":function(){define(["./_base","dojo/_base/lang"],function(k,m){var d=k.matrix={},q={};d._degToRad=function(c){return q[c]||(q[c]=
Math.PI*c/180)};d._radToDeg=function(c){return 180*(c/Math.PI)};d.Matrix2D=function(c){if(c)if("number"==typeof c)this.xx=this.yy=c;else if(c instanceof Array){if(0<c.length){for(var g=d.normalize(c[0]),h=1;h<c.length;++h){var l=g,b=d.normalize(c[h]),g=new d.Matrix2D;g.xx=l.xx*b.xx+l.xy*b.yx;g.xy=l.xx*b.xy+l.xy*b.yy;g.yx=l.yx*b.xx+l.yy*b.yx;g.yy=l.yx*b.xy+l.yy*b.yy;g.dx=l.xx*b.dx+l.xy*b.dy+l.dx;g.dy=l.yx*b.dx+l.yy*b.dy+l.dy}m.mixin(this,g)}}else m.mixin(this,c)};m.extend(d.Matrix2D,{xx:1,xy:0,yx:0,
yy:1,dx:0,dy:0});m.mixin(d,{identity:new d.Matrix2D,flipX:new d.Matrix2D({xx:-1}),flipY:new d.Matrix2D({yy:-1}),flipXY:new d.Matrix2D({xx:-1,yy:-1}),translate:function(c,g){return 1<arguments.length?new d.Matrix2D({dx:c,dy:g}):new d.Matrix2D({dx:c.x,dy:c.y})},scale:function(c,g){return 1<arguments.length?new d.Matrix2D({xx:c,yy:g}):"number"==typeof c?new d.Matrix2D({xx:c,yy:c}):new d.Matrix2D({xx:c.x,yy:c.y})},rotate:function(c){var g=Math.cos(c);c=Math.sin(c);return new d.Matrix2D({xx:g,xy:-c,yx:c,
yy:g})},rotateg:function(c){return d.rotate(d._degToRad(c))},skewX:function(c){return new d.Matrix2D({xy:Math.tan(c)})},skewXg:function(c){return d.skewX(d._degToRad(c))},skewY:function(c){return new d.Matrix2D({yx:Math.tan(c)})},skewYg:function(c){return d.skewY(d._degToRad(c))},reflect:function(c,g){1==arguments.length&&(g=c.y,c=c.x);var h=c*c,l=g*g,b=h+l,f=2*c*g/b;return new d.Matrix2D({xx:2*h/b-1,xy:f,yx:f,yy:2*l/b-1})},project:function(c,g){1==arguments.length&&(g=c.y,c=c.x);var h=c*c,l=g*g,
b=h+l,f=c*g/b;return new d.Matrix2D({xx:h/b,xy:f,yx:f,yy:l/b})},normalize:function(c){return c instanceof d.Matrix2D?c:new d.Matrix2D(c)},isIdentity:function(c){return 1==c.xx&&0==c.xy&&0==c.yx&&1==c.yy&&0==c.dx&&0==c.dy},clone:function(c){var g=new d.Matrix2D,h;for(h in c)"number"==typeof c[h]&&("number"==typeof g[h]&&g[h]!=c[h])&&(g[h]=c[h]);return g},invert:function(c){c=d.normalize(c);var g=c.xx*c.yy-c.xy*c.yx;return c=new d.Matrix2D({xx:c.yy/g,xy:-c.xy/g,yx:-c.yx/g,yy:c.xx/g,dx:(c.xy*c.dy-c.yy*
c.dx)/g,dy:(c.yx*c.dx-c.xx*c.dy)/g})},_multiplyPoint:function(c,d,h){return{x:c.xx*d+c.xy*h+c.dx,y:c.yx*d+c.yy*h+c.dy}},multiplyPoint:function(c,g,h){c=d.normalize(c);return"number"==typeof g&&"number"==typeof h?d._multiplyPoint(c,g,h):d._multiplyPoint(c,g.x,g.y)},multiplyRectangle:function(c,g){var h=d.normalize(c);g=g||{x:0,y:0,width:0,height:0};if(d.isIdentity(h))return{x:g.x,y:g.y,width:g.width,height:g.height};var l=d.multiplyPoint(h,g.x,g.y),b=d.multiplyPoint(h,g.x,g.y+g.height),f=d.multiplyPoint(h,
g.x+g.width,g.y),n=d.multiplyPoint(h,g.x+g.width,g.y+g.height),h=Math.min(l.x,b.x,f.x,n.x),s=Math.min(l.y,b.y,f.y,n.y),x=Math.max(l.x,b.x,f.x,n.x),l=Math.max(l.y,b.y,f.y,n.y);return{x:h,y:s,width:x-h,height:l-s}},multiply:function(c){for(var g=d.normalize(c),h=1;h<arguments.length;++h){var l=g,b=d.normalize(arguments[h]),g=new d.Matrix2D;g.xx=l.xx*b.xx+l.xy*b.yx;g.xy=l.xx*b.xy+l.xy*b.yy;g.yx=l.yx*b.xx+l.yy*b.yx;g.yy=l.yx*b.xy+l.yy*b.yy;g.dx=l.xx*b.dx+l.xy*b.dy+l.dx;g.dy=l.yx*b.dx+l.yy*b.dy+l.dy}return g},
_sandwich:function(c,g,h){return d.multiply(d.translate(g,h),c,d.translate(-g,-h))},scaleAt:function(c,g,h,l){switch(arguments.length){case 4:return d._sandwich(d.scale(c,g),h,l);case 3:return"number"==typeof h?d._sandwich(d.scale(c),g,h):d._sandwich(d.scale(c,g),h.x,h.y)}return d._sandwich(d.scale(c),g.x,g.y)},rotateAt:function(c,g,h){return 2<arguments.length?d._sandwich(d.rotate(c),g,h):d._sandwich(d.rotate(c),g.x,g.y)},rotategAt:function(c,g,h){return 2<arguments.length?d._sandwich(d.rotateg(c),
g,h):d._sandwich(d.rotateg(c),g.x,g.y)},skewXAt:function(c,g,h){return 2<arguments.length?d._sandwich(d.skewX(c),g,h):d._sandwich(d.skewX(c),g.x,g.y)},skewXgAt:function(c,g,h){return 2<arguments.length?d._sandwich(d.skewXg(c),g,h):d._sandwich(d.skewXg(c),g.x,g.y)},skewYAt:function(c,g,h){return 2<arguments.length?d._sandwich(d.skewY(c),g,h):d._sandwich(d.skewY(c),g.x,g.y)},skewYgAt:function(c,g,h){return 2<arguments.length?d._sandwich(d.skewYg(c),g,h):d._sandwich(d.skewYg(c),g.x,g.y)}});k.Matrix2D=
d.Matrix2D;return d})},"esri/styles/basic":function(){define(["dojo/_base/array","dojo/_base/lang","../Color"],function(k,m,d){function q(c,b){var f;if(c)switch(f={},f.color=new d(c.color),b){case "point":f.outline={color:new d(c.outline.color),width:c.outline.width};f.size=c.size;break;case "line":f.width=c.width;break;case "polygon":f.outline={color:new d(c.outline.color),width:c.outline.width}}return f}function c(c){"esriGeometryPoint"===c||"esriGeometryMultipoint"===c?c="point":"esriGeometryPolyline"===
c?c="line":"esriGeometryPolygon"===c&&(c="polygon");return c}var g={"default":{name:"default",label:"Default",description:"Default theme for basic visualization of features.",basemapGroups:{light:"streets gray topo terrain national-geographic oceans osm".split(" "),dark:["satellite","hybrid","dark-gray"]},pointSchemes:{light:{primary:{color:[77,77,77,1],outline:{color:[255,255,255,1],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,1],width:1},size:8},{color:[255,255,
255,1],outline:{color:[51,51,51,1],width:1},size:8}]},dark:{primary:{color:[255,255,255,1],outline:{color:[26,26,26,1],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,1],width:1},size:8},{color:[26,26,26,1],outline:{color:[178,178,178,1],width:1},size:8}]}},lineSchemes:{light:{primary:{color:[77,77,77,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[255,255,255,1],width:2}]},dark:{primary:{color:[255,255,255,1],width:2},secondary:[{color:[226,119,40,1],width:2},
{color:[26,26,26,1],width:2}]}},polygonSchemes:{light:{primary:{color:[227,139,79,0.8],outline:{color:[255,255,255,1],width:1}},secondary:[{color:[128,128,128,0.8],outline:{color:[255,255,255,1],width:1}},{color:[255,255,255,0.8],outline:{color:[128,128,128,1],width:1}}]},dark:{primary:{color:[227,139,79,0.8],outline:{color:[51,51,51,1],width:1}},secondary:[{color:[178,178,178,0.8],outline:{color:[51,51,51,1],width:1}},{color:[26,26,26,0.8],outline:{color:[128,128,128,1],width:1}}]}}}},h={};(function(){var c,
b,f,d,s,x,a,r;for(c in g)for(d in b=g[c],f=b.basemapGroups,s=h[c]={basemaps:[].concat(f.light).concat(f.dark),point:{},line:{},polygon:{}},f){x=f[d];for(a=0;a<x.length;a++)r=x[a],b.pointSchemes&&(s.point[r]=b.pointSchemes[d]),b.lineSchemes&&(s.line[r]=b.lineSchemes[d]),b.polygonSchemes&&(s.polygon[r]=b.polygonSchemes[d])}})();return{getAvailableThemes:function(c){var b=[],f,d,s;for(f in g)d=g[f],s=h[f],c&&-1===k.indexOf(s.basemaps,c)||b.push({name:d.name,label:d.label,description:d.description,basemaps:s.basemaps.slice(0)});
return b},getSchemes:function(d){var b=d.theme,f=d.basemap,g=c(d.geometryType);d=h[b];var s;(d=(d=d&&d[g])&&d[f])&&(s={primaryScheme:q(d.primary,g),secondarySchemes:k.map(d.secondary,function(b){return q(b,g)})});return s},cloneScheme:function(c){var b;c&&(b=m.mixin({},c),b.color&&(b.color=new d(b.color)),b.outline&&(b.outline={color:b.outline.color&&new d(b.outline.color),width:b.outline.width}));return b}}})},"dojox/fx/style":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/fx dojo/fx ./_base dojo/_base/array dojo/dom dojo/dom-style dojo/dom-class dojo/_base/connect".split(" "),
function(k,m,d,q,c,g,h,l,b,f){k.experimental("dojox.fx.style");var n=function(b){return g.map(c._allowedProperties,function(a){return b[a]})},s=function(b,a,r){b=h.byId(b);var f=l.getComputedStyle(b),d=n(f);k[r?"addClass":"removeClass"](b,a);var s=n(f);k[r?"removeClass":"addClass"](b,a);var B={},m=0;g.forEach(c._allowedProperties,function(a){d[m]!=s[m]&&(B[a]=parseInt(s[m]));m++});return B};q={addClass:function(c,a,r){c=h.byId(c);var g=function(c){return function(){b.add(c,a);c.style.cssText=n}}(c),
t=s(c,a,!0),n=c.style.cssText;c=d.animateProperty(m.mixin({node:c,properties:t},r));f.connect(c,"onEnd",c,g);return c},removeClass:function(c,a,r){c=h.byId(c);var g=function(c){return function(){b.remove(c,a);c.style.cssText=n}}(c),t=s(c,a),n=c.style.cssText;c=d.animateProperty(m.mixin({node:c,properties:t},r));f.connect(c,"onEnd",c,g);return c},toggleClass:function(f,a,r,d){"undefined"==typeof r&&(r=!b.contains(f,a));return c[r?"addClass":"removeClass"](f,a,d)},_allowedProperties:"width height left top backgroundColor color borderBottomWidth borderTopWidth borderLeftWidth borderRightWidth paddingLeft paddingRight paddingTop paddingBottom marginLeft marginTop marginRight marginBottom lineHeight letterSpacing fontSize".split(" ")};
m.mixin(c,q);return q})},"dijit/layout/StackController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/topic ../focus ../registry ../_Widget ../_TemplatedMixin ../_Container ../form/ToggleButton dojo/touch".split(" "),function(k,m,d,q,c,g,h,l,b,f,n,s,x,a){q=m("dijit.layout._StackButton",a,{tabIndex:"-1",closeButton:!1,_aria_attr:"aria-selected",buildRendering:function(a){this.inherited(arguments);(this.focusNode||this.domNode).setAttribute("role",
"tab")}});m=m("dijit.layout.StackController",[n,s,x],{baseClass:"dijitStackController",templateString:"\x3cspan role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown'\x3e\x3c/span\x3e",containerId:"",buttonWidget:q,buttonWidgetCloseClass:"dijitStackCloseButton",pane2button:function(a){return f.byId(this.id+"_"+a)},postCreate:function(){this.inherited(arguments);this.own(l.subscribe(this.containerId+"-startup",g.hitch(this,"onStartup")),l.subscribe(this.containerId+"-addChild",g.hitch(this,"onAddChild")),
l.subscribe(this.containerId+"-removeChild",g.hitch(this,"onRemoveChild")),l.subscribe(this.containerId+"-selectChild",g.hitch(this,"onSelectChild")),l.subscribe(this.containerId+"-containerKeyDown",g.hitch(this,"onContainerKeyDown")));this.containerNode.dojoClick=!0;this.own(h(this.containerNode,"click",g.hitch(this,function(a){var b=f.getEnclosingWidget(a.target);if(b!=this.containerNode&&!b.disabled&&b.page)for(a=a.target;a!==this.containerNode;a=a.parentNode)if(d.contains(a,this.buttonWidgetCloseClass)){this.onCloseButtonClick(b.page);
break}else if(a==b.domNode){this.onButtonClick(b.page);break}})))},onStartup:function(a){this.textDir=a.textDir;k.forEach(a.children,this.onAddChild,this);if(a.selected)this.onSelectChild(a.selected);var b=f.byId(this.containerId).containerNode,c=g.hitch(this,"pane2button");a={title:"label",showtitle:"showLabel",iconclass:"iconClass",closable:"closeButton",tooltip:"title",disabled:"disabled",textdir:"textdir"};var d=function(a,r){return h(b,"attrmodified-"+a,function(a){var b=c(a.detail&&a.detail.widget&&
a.detail.widget.id);b&&b.set(r,a.detail.newValue)})},s;for(s in a)this.own(d(s,a[s]))},destroy:function(a){this.destroyDescendants(a);this.inherited(arguments)},onAddChild:function(a,b){var c=new (g.isString(this.buttonWidget)?g.getObject(this.buttonWidget):this.buttonWidget)({id:this.id+"_"+a.id,name:this.id+"_"+a.id,label:a.title,disabled:a.disabled,ownerDocument:this.ownerDocument,dir:a.dir,lang:a.lang,textDir:a.textDir||this.textDir,showLabel:a.showTitle,iconClass:a.iconClass,closeButton:a.closable,
title:a.tooltip,page:a});this.addChild(c,b);a.controlButton=c;if(!this._currentChild)this.onSelectChild(a);c=a._wrapper.getAttribute("aria-labelledby")?a._wrapper.getAttribute("aria-labelledby")+" "+c.id:c.id;a._wrapper.removeAttribute("aria-label");a._wrapper.setAttribute("aria-labelledby",c)},onRemoveChild:function(a){this._currentChild===a&&(this._currentChild=null);var b=this.pane2button(a.id);b&&(this.removeChild(b),b.destroy());delete a.controlButton},onSelectChild:function(a){if(a){if(this._currentChild){var b=
this.pane2button(this._currentChild.id);b.set("checked",!1);b.focusNode.setAttribute("tabIndex","-1")}b=this.pane2button(a.id);b.set("checked",!0);this._currentChild=a;b.focusNode.setAttribute("tabIndex","0");f.byId(this.containerId)}},onButtonClick:function(a){var c=this.pane2button(a.id);b.focus(c.focusNode);this._currentChild&&this._currentChild.id===a.id&&c.set("checked",!0);f.byId(this.containerId).selectChild(a)},onCloseButtonClick:function(a){f.byId(this.containerId).closeChild(a);this._currentChild&&
(a=this.pane2button(this._currentChild.id))&&b.focus(a.focusNode||a.domNode)},adjacent:function(a){if(!this.isLeftToRight()&&(!this.tabPosition||/top|bottom/.test(this.tabPosition)))a=!a;var b=this.getChildren(),c=k.indexOf(b,this.pane2button(this._currentChild.id)),f=b[c],d;do c=(c+(a?1:b.length-1))%b.length,d=b[c];while(d.disabled&&d!=f);return d},onkeydown:function(a,b){if(!this.disabled&&!a.altKey){var f=null;if(a.ctrlKey||!a._djpage){switch(a.keyCode){case c.LEFT_ARROW:case c.UP_ARROW:a._djpage||
(f=!1);break;case c.PAGE_UP:a.ctrlKey&&(f=!1);break;case c.RIGHT_ARROW:case c.DOWN_ARROW:a._djpage||(f=!0);break;case c.PAGE_DOWN:a.ctrlKey&&(f=!0);break;case c.HOME:for(var d=this.getChildren(),g=0;g<d.length;g++){var h=d[g];if(!h.disabled){this.onButtonClick(h.page);break}}a.stopPropagation();a.preventDefault();break;case c.END:d=this.getChildren();for(g=d.length-1;0<=g;g--)if(h=d[g],!h.disabled){this.onButtonClick(h.page);break}a.stopPropagation();a.preventDefault();break;case c.DELETE:case 87:if(this._currentChild.closable&&
(a.keyCode==c.DELETE||a.ctrlKey))this.onCloseButtonClick(this._currentChild),a.stopPropagation(),a.preventDefault();break;case c.TAB:a.ctrlKey&&(this.onButtonClick(this.adjacent(!a.shiftKey).page),a.stopPropagation(),a.preventDefault())}null!==f&&(this.onButtonClick(this.adjacent(f).page),a.stopPropagation(),a.preventDefault())}}},onContainerKeyDown:function(a){a.e._djpage=a.page;this.onkeydown(a.e)}});m.StackButton=q;return m})},"webSceneViewer/widgets/MessageListWidget/MessageListWidget":function(){define(["esri/core/declare",
"dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/MessageListWidget.html","./MessageWidget"],function(k,m,d,q,c){return new (k([m,d],{declaredClass:"MessageListWidget",templateString:q,MessageTypes:{INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error"},direction:"b2t",constructor:function(c){},postCreate:function(){},show:function(d){"string"===typeof d&&(d={message:d});d=new c(d);"t2b"===this.direction?d.placeAt(this.MessageListContentNode,0):d.placeAt(this.MessageListContentNode)}}))})},
"webSceneViewer/environmentUtils":function(){define(["esri/views/3d/SceneViewEnvironment","esri/core/watchUtils","./spatialReferenceUtils"],function(k,m,d){function q(c,d){c.lighting&&null!=c.lighting.displayUTCOffset&&(d.lighting||(d.lighting={}),d.lighting.displayUTCOffset=c.lighting.displayUTCOffset);return d}var c={fromJSON:function(c){return q(c,k.fromJSON(c))},toJSON:function(c){return q(c,c.toJSON())},clone:function(c){return q(c,c.clone())},applyToView:function(c,d){if(c&&c.lighting){var l=
c.lighting,b=d.environment.lighting;null!=l.date&&(b.date=l.date);null!=l.displayUTCOffset&&(b.displayUTCOffset=l.displayUTCOffset);b.directShadows=l.directShadows;b.ambientOcclusion=l.ambientOcclusion}},adjustLightDateForLatitude:function(c,h){d.getLatitudeOfPoint(h).then(function(d){var b=c.date.getMonth(),f;66<d&&(4>b||6<b)?f=5:-66>d&&(10>b&&0<b)&&(f=11);f&&(d=new Date(c.date),d.setMonth(f),c.date=d)})},adjustLightForLayer:function(d,h){h.then(function(){var l=h.fullExtent;l&&m.whenTrueOnce(d.environment.lighting,
"ready",function(){c.adjustLightDateForLatitude(d.environment.lighting,l.center)})})}};return c})},"webSceneViewer/widgets/MenuContainer/MenuContainer":function(){define("esri/core/declare dojo/dom-class dojo/dom-construct dojo/on dojo/query dojo/fx dojox/fx/style esri/core/domUtils dojo/i18n!./../../nls/viewer".split(" "),function(k,m,d,q,c,g,h,l,b){function f(b){var d=[];d.push(h.addClass(b,"fade",{duration:50}));b=c("#viewerContainer .MenuContainer .MenuTabsContainer .tab.lastOne");0<b.length&&
d.push(h.removeClass(b[0],"lastOne",{duration:50}));b=c("#viewerContainer .MenuContainer .MenuTabsContainer .tab.onlyExpand");for(var a=0;a<b.length;a++)d.push(h.removeClass(b[a],"hideTab",{delay:20*a,duration:50}));g.combine(d).play();this._expanded=!0}function n(b){for(var d=c("#viewerContainer .MenuContainer .MenuTabsContainer .tab.onlyExpand"),a=[],f=d.length-1;0<=f;f--)a.push(h.addClass(d[f],"hideTab",{delay:20*(d.length-f-1)}));f=c("#viewerContainer .MenuContainer .MenuTabsContainer .tab");
4<=f.length&&a.push(h.addClass(f[3],"lastOne",{delay:20*d.length}));a.push(h.removeClass(b,"fade",{delay:20*d.length}));g.combine(a).play();this._expanded=!1}return k(null,{name:"MenuContainer",baseClass:"MenuContainer",_expanded:!1,_timeOutSinceExpanded:null,_collapseMenuTimeout:4E3,constructor:function(b){b=d.create("div",{"class":"MenuContainer vertical"},b);this.tabsContainer=d.create("div",{"class":"MenuTabsContainer"},b);this.panesContainer=d.create("div",{"class":"MenuPanesContainer"},b);this.tabs=
[];this.panes=[];this._active=-1},add:function(c){var h=d.create("div",{"class":"tab inactive "+(c.show?"":" hide"),title:c.title});d.create("div",{"class":c.id+"_icon"},h);if(4<this.tabs.length&&!this.expandTab){m.add(this.tabs[this.tabs.length-2],"lastOne");var a=d.create("div",{"class":"tab inactive expand",title:b.menu.moreTools});d.create("div",{"class":"expand_icon"},a);var r=this.tabs.pop();this.tabsContainer.insertBefore(a,this.tabsContainer.lastElementChild);this.tabs.push(a);this.tabs.push(r);
this.expandTab=a;var r=d.create("div",{"class":"pane"},this.panesContainer),g=this.panes.pop();this.panes.push(r);this.panes.push(g);l.hide(r);a.onclick=function(){f(a);this._expanded=!0;this._timeOutSinceExpanded=setTimeout(function(){this._collapseMenu()}.bind(this),2*this._collapseMenuTimeout)}.bind(this);m.add(this.tabs[5],"onlyExpand hideTab")}this.tabsContainer.appendChild(h);this.tabs.push(h);5<this.tabs.length&&m.add(h,"onlyExpand hideTab");h.onclick=function(){var a=this.tabs.indexOf(h)!==
this._active;this.setActive(this.tabs.indexOf(h));if(c.onSelectMethod&&a)c.onSelectMethod()}.bind(this,c);var r=d.create("div",{"class":"pane"},this.panesContainer),g=d.create("div",{"class":"paneHeader"},r),t=d.create("div",{"class":"paneContent"},r);d.create("div",{"class":"paneFooter"},r);var n=d.create("div",{"class":"closeButton"},g);q(n,"click",function(){this.setActive(this._active);if(c.onSelectMethod)c.onSelectMethod()}.bind(this));n="paneTitle";c.hideTitle&&(n+=" hide");d.create("div",{"class":n,
innerHTML:c.title},g);this.panes.push(r);l.hide(r);return t},setActive:function(b){for(var c=0;c<this.panes.length;c++)l.hide(this.panes[c]),m.replace(this.tabs[c],"inactive","active");0>b||(b==this._active?(l.hide(this.panes[b]),m.replace(this.tabs[b],"inactive","active"),this._active=-1,this._expanded&&(clearTimeout(this._timeOutSinceExpanded),this._timeOutSinceExpanded=setTimeout(function(){this._collapseMenu()}.bind(this),this._collapseMenuTimeout))):(4>b&&this._expanded&&(clearTimeout(this._timeOutSinceExpanded),
this._timeOutSinceExpanded=setTimeout(function(){this._collapseMenu()}.bind(this),this._collapseMenuTimeout)),4<=b&&clearTimeout(this._timeOutSinceExpanded),l.show(this.panes[b]),m.replace(this.tabs[b],"active","inactive"),this._active=b))},_collapseMenu:function(){n(this.expandTab);this._expanded=!1}})})},"dojox/fx/_base":function(){define("dojo/_base/array dojo/_base/lang dojo/_base/fx dojo/fx dojo/dom dojo/dom-style dojo/dom-geometry dojo/_base/connect dojo/_base/html".split(" "),function(k,m,
d,q,c,g,h,l,b){k=m.getObject("dojox.fx",!0);m.mixin(k,{anim:d.anim,animateProperty:d.animateProperty,fadeTo:d._fade,fadeIn:d.fadeIn,fadeOut:d.fadeOut,combine:q.combine,chain:q.chain,slideTo:q.slideTo,wipeIn:q.wipeIn,wipeOut:q.wipeOut});k.sizeTo=function(b){var h=b.node=c.byId(b.node),l=b.method||"chain";b.duration||(b.duration=500);"chain"==l&&(b.duration=Math.floor(b.duration/2));var x,a,r,z,t,w=null,k=function(c){return function(){var d=g.getComputedStyle(c),h=d.position,n=d.width,l=d.height;x=
"absolute"==h?c.offsetTop:parseInt(d.top)||0;r="absolute"==h?c.offsetLeft:parseInt(d.left)||0;t="auto"==n?0:parseInt(n);w="auto"==l?0:parseInt(l);z=r-Math.floor((b.width-t)/2);a=x-Math.floor((b.height-w)/2);"absolute"!=h&&"relative"!=h&&(d=g.coords(c,!0),x=d.y,r=d.x,c.style.position="absolute",c.style.top=x+"px",c.style.left=r+"px")}}(h),h=d.animateProperty(m.mixin({properties:{height:function(){k();return{end:b.height||0,start:w}},top:function(){return{start:x,end:a}}}},b)),l=d.animateProperty(m.mixin({properties:{width:function(){return{start:t,
end:b.width||0}},left:function(){return{start:r,end:z}}}},b));return q["combine"==b.method?"combine":"chain"]([h,l])};k.slideBy=function(b){var n,s,x=function(a){return function(){var b=g.getComputedStyle(a),c=b.position;n="absolute"==c?a.offsetTop:parseInt(b.top)||0;s="absolute"==c?a.offsetLeft:parseInt(b.left)||0;"absolute"!=c&&"relative"!=c&&(b=h.coords(a,!0),n=b.y,s=b.x,a.style.position="absolute",a.style.top=n+"px",a.style.left=s+"px")}}(b.node=c.byId(b.node));x();b=d.animateProperty(m.mixin({properties:{top:n+
(b.top||0),left:s+(b.left||0)}},b));l.connect(b,"beforeBegin",b,x);return b};k.crossFade=function(f){var h=f.nodes[0]=c.byId(f.nodes[0]),g=b.style(h,"opacity"),l=f.nodes[1]=c.byId(f.nodes[1]);b.style(l,"opacity");return q.combine([d[0==g?"fadeIn":"fadeOut"](m.mixin({node:h},f)),d[0==g?"fadeOut":"fadeIn"](m.mixin({node:l},f))])};k.highlight=function(f){var h=f.node=c.byId(f.node);f.duration=f.duration||400;var g=f.color||"#ffff99",k=b.style(h,"backgroundColor");"rgba(0, 0, 0, 0)"==k&&(k="transparent");
f=d.animateProperty(m.mixin({properties:{backgroundColor:{start:g,end:k}}},f));"transparent"==k&&l.connect(f,"onEnd",f,function(){h.style.backgroundColor=k});return f};k.wipeTo=function(f){f.node=c.byId(f.node);var h=f.node,g=h.style,l=f.width?"width":"height",a={};a[l]={start:function(){g.overflow="hidden";if("hidden"==g.visibility||"none"==g.display)return g[l]="1px",g.display="",g.visibility="",1;var a=b.style(h,l);return Math.max(a,1)},end:f[l]};return d.animateProperty(m.mixin({properties:a},
f))};return k})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),function(k,m,d,q,c,g,h,l,b){return g("dijit.layout._LayoutWidget",[m,d,q],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);h.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);
var b=this.getParent&&this.getParent();if(!b||!b.isLayoutContainer)this.resize(),this.own(c.on("resize",k.hitch(this,"resize")))}},resize:function(c,d){var h=this.domNode;c&&l.setMarginBox(h,c);var g=d||{};k.mixin(g,c||{});if(!("h"in g)||!("w"in g))g=k.mixin(l.getMarginBox(h),g);var a=b.getComputedStyle(h),r=l.getMarginExtents(h,a),z=l.getBorderExtents(h,a),g=this._borderBox={w:g.w-(r.w+z.w),h:g.h-(r.h+z.h)},r=l.getPadExtents(h,a);this._contentBox={l:b.toPixelValue(h,a.paddingLeft),t:b.toPixelValue(h,
a.paddingTop),w:g.w-r.w,h:g.h-r.h};this.layout()},layout:function(){},_setupChild:function(b){h.add(b.domNode,this.baseClass+"-child "+(b.baseClass?this.baseClass+"-"+b.baseClass:""))},addChild:function(b,c){this.inherited(arguments);this._started&&this._setupChild(b)},removeChild:function(b){h.remove(b.domNode,this.baseClass+"-child"+(b.baseClass?" "+this.baseClass+"-"+b.baseClass:""));this.inherited(arguments)}})})},"dijit/form/Form":function(){define("dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/sniff ../_Widget ../_TemplatedMixin ./_FormMixin ../layout/_ContentPaneResizeMixin".split(" "),
function(k,m,d,q,c,g,h,l){return k("dijit.form.Form",[c,g,h,l],{name:"",action:"",method:"",encType:"","accept-charset":"",accept:"",target:"",templateString:"\x3cform data-dojo-attach-point\x3d'containerNode' data-dojo-attach-event\x3d'onreset:_onReset,onsubmit:_onSubmit' ${!nameAttrSetting}\x3e\x3c/form\x3e",postMixInProperties:function(){this.nameAttrSetting=this.name?"name\x3d'"+this.name+"'":"";this.inherited(arguments)},execute:function(){},onExecute:function(){},_setEncTypeAttr:function(b){m.set(this.domNode,
"encType",b);q("ie")&&(this.domNode.encoding=b);this._set("encType",b)},reset:function(b){var c={returnValue:!0,preventDefault:function(){this.returnValue=!1},stopPropagation:function(){},currentTarget:b?b.target:this.domNode,target:b?b.target:this.domNode};!1!==this.onReset(c)&&c.returnValue&&this.inherited(arguments,[])},onReset:function(){return!0},_onReset:function(b){this.reset(b);b.stopPropagation();b.preventDefault();return!1},_onSubmit:function(b){var c=this.constructor.prototype;if(this.execute!=
c.execute||this.onExecute!=c.onExecute)d.deprecated("dijit.form.Form:execute()/onExecute() are deprecated. Use onSubmit() instead.","","2.0"),this.onExecute(),this.execute(this.getValues());!1===this.onSubmit(b)&&(b.stopPropagation(),b.preventDefault())},onSubmit:function(){return this.isValid()},submit:function(){!1!==this.onSubmit()&&this.containerNode.submit()}})})},"webSceneViewer/urlUtils":function(){define("dojo/io/script dojo/io-query esri/geometry/Point esri/Viewpoint esri/Camera esri/geometry/SpatialReference".split(" "),
function(k,m,d,q,c,g){var h={viewpointFromUrlParameter:function(h){var b=h.split(";"),f=null;if(0<b.length){var n="";h="";for(var s=0;s<b.length;s++)-1!==b[s].indexOf("cam:")?n=b[s]:h=b[s];if(""!==n&&(n=n.substr(4,n.length-4),b=n.split(","),3<=b.length)){var s=n=f=0,f=parseFloat(b[0]),n=parseFloat(b[1]),s=parseFloat(b[2]),k=g.WGS84;4===b.length&&(k=new g(parseInt(b[3],10)));b=new d(f,n,s,k);n=f=0;""!==h&&(h=h.split(","),0<=h.length&&(f=parseFloat(h[0]),1<h.length&&(n=parseFloat(h[1]))));f=new q({targetGeometry:void 0,
scale:void 0,rotation:void 0,camera:new c({position:b,heading:f,tilt:n})})}}return f},viewpointToUrlParameter:function(c,b,d){var h=c;d=d?d:!1;c=-1===c.indexOf("?")?"?":"\x26";h+=c+"viewpoint\x3dcam:";c=b.position.spatialReference.isWebMercator()&&!d?b.position.longitude:b.position.x;c=Math.round(1E8*c)/1E8;var g=b.position.spatialReference.isWebMercator()&&!d?b.position.latitude:b.position.y,g=Math.round(1E8*g)/1E8,k=Math.round(1E3*b.position.z)/1E3,a=Math.round(1E3*b.heading)/1E3,r=Math.round(1E3*
b.tilt)/1E3;b=b.position.spatialReference.isWebMercator()&&!d?"":","+b.position.spatialReference.wkid;return h+(c+","+g+","+k+b+";"+a+","+r)},shortenUrl:function(c,b,d){if("undefined"===typeof esriGeowConfig)d&&d(c);else{var h=esriGeowConfig.bitlyUrl;"https:"==location.protocol&&(h=esriGeowConfig.bitlyUrlSSL);h+="\x26longUrl\x3d"+encodeURIComponent(c)+"\x26format\x3djson";k.get({url:h,callbackParamName:"callback",load:function(h){h&&200==h.status_code&&h.data&&h.data.url&&0<h.data.url.length?b(h.data.url,
c):d&&d(c)},error:function(b){d&&d(c)}})}},urlParams:function(){var c=m.queryToObject(window.location.search.replace(/^\?/,"")),c=c||{},b;for(b in c)c.hasOwnProperty(b)&&(c[b]=c[b].replace(/(&lt;|&gt;|<|>|%3C|%3E)/g,""));return c},cleanUrl:function(){var c=m.queryToObject(window.location.search.replace(/^\?/,"")),c=c||{},b=h.urlParams();if(b.hasOwnProperty("viewingmode")&&(b.hasOwnProperty("layers")||b.hasOwnProperty("url")||b.hasOwnProperty("webscene")))delete c.viewingmode,c=decodeURIComponent(m.objectToQuery(c)),
window.history.pushState(null,null,location.pathname+"?"+c)}};return h})},"dojo/fx":function(){define("./_base/lang ./Evented ./_base/kernel ./_base/array ./aspect ./_base/fx ./dom ./dom-style ./dom-geometry ./ready require".split(" "),function(k,m,d,q,c,g,h,l,b,f,n){d.isAsync||f(0,function(){n(["./fx/Toggler"])});d=d.fx={};f={_fire:function(a,b){this[a]&&this[a].apply(this,b||[]);return this}};var s=function(a){this._index=-1;this._animations=a||[];this._current=this._onAnimateCtx=this._onEndCtx=
null;this.duration=0;q.forEach(this._animations,function(a){this.duration+=a.duration;a.delay&&(this.duration+=a.delay)},this)};s.prototype=new m;k.extend(s,{_onAnimate:function(){this._fire("onAnimate",arguments)},_onEnd:function(){this._onAnimateCtx.remove();this._onEndCtx.remove();this._onAnimateCtx=this._onEndCtx=null;this._index+1==this._animations.length?this._fire("onEnd"):(this._current=this._animations[++this._index],this._onAnimateCtx=c.after(this._current,"onAnimate",k.hitch(this,"_onAnimate"),
!0),this._onEndCtx=c.after(this._current,"onEnd",k.hitch(this,"_onEnd"),!0),this._current.play(0,!0))},play:function(a,b){this._current||(this._current=this._animations[this._index=0]);if(!b&&"playing"==this._current.status())return this;var d=c.after(this._current,"beforeBegin",k.hitch(this,function(){this._fire("beforeBegin")}),!0),h=c.after(this._current,"onBegin",k.hitch(this,function(a){this._fire("onBegin",arguments)}),!0),g=c.after(this._current,"onPlay",k.hitch(this,function(a){this._fire("onPlay",
arguments);d.remove();h.remove();g.remove()}));this._onAnimateCtx&&this._onAnimateCtx.remove();this._onAnimateCtx=c.after(this._current,"onAnimate",k.hitch(this,"_onAnimate"),!0);this._onEndCtx&&this._onEndCtx.remove();this._onEndCtx=c.after(this._current,"onEnd",k.hitch(this,"_onEnd"),!0);this._current.play.apply(this._current,arguments);return this},pause:function(){if(this._current){var a=c.after(this._current,"onPause",k.hitch(this,function(b){this._fire("onPause",arguments);a.remove()}),!0);
this._current.pause()}return this},gotoPercent:function(a,b){this.pause();var c=this.duration*a;this._current=null;q.some(this._animations,function(a,b){if(c<=a.duration)return this._current=a,this._index=b,!0;c-=a.duration;return!1},this);this._current&&this._current.gotoPercent(c/this._current.duration);b&&this.play();return this},stop:function(a){if(this._current){if(a){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);this._current=this._animations[this._index]}var b=
c.after(this._current,"onStop",k.hitch(this,function(a){this._fire("onStop",arguments);b.remove()}),!0);this._current.stop()}return this},status:function(){return this._current?this._current.status():"stopped"},destroy:function(){this.stop();this._onAnimateCtx&&this._onAnimateCtx.remove();this._onEndCtx&&this._onEndCtx.remove()}});k.extend(s,f);d.chain=function(a){return new s(a)};var x=function(a){this._animations=a||[];this._connects=[];this.duration=this._finished=0;q.forEach(a,function(a){var b=
a.duration;a.delay&&(b+=a.delay);this.duration<b&&(this.duration=b);this._connects.push(c.after(a,"onEnd",k.hitch(this,"_onEnd"),!0))},this);this._pseudoAnimation=new g.Animation({curve:[0,1],duration:this.duration});var b=this;q.forEach("beforeBegin onBegin onPlay onAnimate onPause onStop onEnd".split(" "),function(a){b._connects.push(c.after(b._pseudoAnimation,a,function(){b._fire(a,arguments)},!0))})};k.extend(x,{_doAction:function(a,b){q.forEach(this._animations,function(c){c[a].apply(c,b)});
return this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(a,b){var c=this._pseudoAnimation;c[a].apply(c,b)},play:function(a,b){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this},pause:function(){this._doAction("pause",arguments);this._call("pause",arguments);return this},gotoPercent:function(a,b){var c=this.duration*a;q.forEach(this._animations,function(a){a.gotoPercent(a.duration<c?1:c/a.duration,b)});this._call("gotoPercent",
arguments);return this},stop:function(a){this._doAction("stop",arguments);this._call("stop",arguments);return this},status:function(){return this._pseudoAnimation.status()},destroy:function(){this.stop();q.forEach(this._connects,function(a){a.remove()})}});k.extend(x,f);d.combine=function(a){return new x(a)};d.wipeIn=function(a){var b=a.node=h.byId(a.node),d=b.style,f;a=g.animateProperty(k.mixin({properties:{height:{start:function(){f=d.overflow;d.overflow="hidden";if("hidden"==d.visibility||"none"==
d.display)return d.height="1px",d.display="",d.visibility="",1;var a=l.get(b,"height");return Math.max(a,1)},end:function(){return b.scrollHeight}}}},a));var n=function(){d.height="auto";d.overflow=f};c.after(a,"onStop",n,!0);c.after(a,"onEnd",n,!0);return a};d.wipeOut=function(a){var b=(a.node=h.byId(a.node)).style,d;a=g.animateProperty(k.mixin({properties:{height:{end:1}}},a));c.after(a,"beforeBegin",function(){d=b.overflow;b.overflow="hidden";b.display=""},!0);var f=function(){b.overflow=d;b.height=
"auto";b.display="none"};c.after(a,"onStop",f,!0);c.after(a,"onEnd",f,!0);return a};d.slideTo=function(a){var d=null,f=null,t=function(a){return function(){var c=l.getComputedStyle(a),h=c.position;d="absolute"==h?a.offsetTop:parseInt(c.top)||0;f="absolute"==h?a.offsetLeft:parseInt(c.left)||0;"absolute"!=h&&"relative"!=h&&(c=b.position(a,!0),d=c.y,f=c.x,a.style.position="absolute",a.style.top=d+"px",a.style.left=f+"px")}}(a.node=h.byId(a.node));t();a=g.animateProperty(k.mixin({properties:{top:a.top||
0,left:a.left||0}},a));c.after(a,"beforeBegin",t,!0);return a};return d})},"webSceneViewer/webScene/WebScene":function(){define("esri/core/declare dojo/_base/lang dojo/_base/array dojo/promise/all dojo/Deferred dojo/on dojo/string dojo/when esri/core/Accessor esri/core/Evented esri/core/watchUtils esri/request esri/core/lang esri/portal/support/PortalUtil esri/geometry/Extent esri/geometry/support/webMercatorUtils esri/geometry/SpatialReference webSceneViewer/spatialReferenceUtils esri/layers/GroupLayer esri/layers/FeatureLayer esri/layers/SceneLayer esri/layers/Layer esri/layers/support/TileInfo esri/layers/support/LayerDrawingOptions esri/Viewpoint esri/widgets/PopupLegacy/PopupTemplate esri/views/3d/support/cameraUtils esri/views/3d/support/viewpointUtils ../environmentUtils ../basemapUtils ../urlUtils ./WebSceneLayers ./Presentation ./LayerTemplates webSceneViewer/widgets/MessageListWidget/MessageListWidget webSceneViewer/widgets/Dialog/ConfirmDialog dojo/i18n!webSceneViewer/nls/viewer".split(" "),
function(k,m,d,q,c,g,h,l,b,f,n,s,x,a,r,z,t,w,B,H,A,O,I,G,J,C,K,Q,N,F,R,M,U,L,p,y,v){function S(e){if(e.renderer){var a=e.get("renderer");e._websceneEditorProperties.originalRenderer=new a.constructor(a.toJSON())}else e.then(function(a){a=e.get("renderer");e._websceneEditorProperties.originalRenderer=e.renderer?new a.constructor(a.toJSON()):null})}function e(e){if(!(!0===e.disablePopup||null!=e.popupTemplate))if(e.isInstanceOf(H)||e.isInstanceOf(A)&&null!=e._companionFeatureLayer){var a=e.popupTemplate||
new C({title:e.title,fieldInfos:e.fields&&e.fields.map(function(e){var a={fieldName:e.name,label:e.alias,visible:!0};"esriFieldTypeDate"===e.type&&(a.format={dateFormat:"longMonthDayYear"});return a})});e.set("disablePopup",!1);e.set("popupTemplate",a)}}function u(e,a,b){var c;if(a.layerDefinition&&a.layerDefinition.drawingInfo){var u=a.layerDefinition.drawingInfo,d=new G(m.clone(u));L.hasContentByReference(u.renderer)?c=L.createRenderer(u.renderer,b).then(function(a){e.renderer=a;e.showLegend=!1},
function(a){console.warn("Failed to create renderer by reference for "+e.title+": "+(a.message||a));p.show({message:'"'+e.title+'" '+v.messages.byReferenceRendererUnsupported,details:v.messages.layerDisplaysWithServiceSymbology+"\x3cbr\x3e"+e.url,type:p.MessageTypes.WARNING})}):d.renderer?(b=e instanceof A,(e instanceof H||b)&&!M.isFeatureServiceRendererSupported(u.renderer.type)?p.show({message:'"'+e.title+'" '+v.messages.featureServiceNotSupportedRendererType+" "+u.renderer.type,details:v.messages.layerDisplaysWithServiceSymbology+
"\x3cbr\x3e"+e.url,type:p.MessageTypes.WARNING}):e.renderer=d.renderer):a.layerDefinition.drawingInfo.renderer&&p.show({message:'"'+e.title+'" '+v.messages.featureServiceNotSupportedRendererType+" "+u.renderer.type,details:v.messages.layerDisplaysWithServiceSymbology+"\x3cbr\x3e"+e.url,type:p.MessageTypes.WARNING});d.hasOwnProperty("labelingInfo")&&e.set("labelingInfo",d.labelingInfo)}null!=a.minScale?e.minScale=a.minScale:a.layerDefinition&&null!=a.layerDefinition.minScale&&(e.minScale=a.layerDefinition.minScale);
null!=a.maxScale?e.maxScale=a.maxScale:a.layerDefinition&&null!=a.layerDefinition.maxScale&&(e.maxScale=a.layerDefinition.maxScale);a.layerDefinition&&(a.layerDefinition.elevationInfo&&0<Object.keys(a.layerDefinition.elevationInfo).length)&&e.set("elevationInfo",m.clone(a.layerDefinition.elevationInfo));a.visibilityMode&&e.set("visibilityMode",a.visibilityMode);a.listMode&&e.set("listMode",a.listMode);a.popupInfo&&(0===Object.keys(a.popupInfo).length?e.set("popupTemplate",null):e.set("popupTemplate",
new C(a.popupInfo)));a.hasOwnProperty("disablePopup")&&e.set("disablePopup",a.disablePopup);a.showLabels&&e.set("showLabels",a.showLabels);return c}function D(e){return m.exists("spatialReference.wkid",e)?(e=e.spatialReference,e=e instanceof t?e.clone():t.fromJSON(e)):t.WGS84}function E(a,b,c,d){var E=[],f=M.create(a);if(void 0===f)return console.log("cannot apply layer to map "+a.id+" ",a.url),!1;var y=window._webSceneViewerView;switch(d){case 1:F._resetView(b,D(a.serviceInfo),f.fullExtent);N.adjustLightForLayer(y,
f);break;case 2:var r=D(a.serviceInfo);F._resetView(b,r,f.fullExtent);N.adjustLightForLayer(y,f);p.show({message:v.messages.BasemapDropWarningTitle,type:p.MessageTypes.WARNING,details:v.messages.BasemapDropWarning});r.isWebMercator()||(y.globeMode="planar")}f.on("graphics-controller-create",function(e){if(!m.exists("graphicsSource.layerDefinition.advancedQueryCapabilities.supportsPagination",f)||!1===f.graphicsSource.layerDefinition.advancedQueryCapabilities.supportsPagination)g.once(e.graphicsController,
"query-limit-exceeded",function(){var e={message:'"'+f.title+'" '+h.substitute(v.messages.layerDidNotDrawCompletely,{limit:f.maxRecordCount}),type:p.MessageTypes.WARNING,details:f.url};p.show(e)})});f._websceneEditorProperties={editedFlags:{renderer:!1,labelingInfo:!1,elevationInfo:!1,listMode:!1,visibilityMode:!1,popupInfo:!1,showLabels:!1,showLegend:!1}};a.thumbnailUrl&&(f._websceneEditorProperties.thumbnailUrl=a.thumbnailUrl);a.portalLayerItem&&(f._websceneEditorProperties.portalLayerItem=a.portalLayerItem);
a.originalOperationalLayer&&(f._websceneEditorProperties.originalOperationalLayer=a.originalOperationalLayer);f instanceof B&&a.layers.forEach(function(e,a){e.layerIndex=a;var b;e.itemId&&c?b=P.addContentByItemId(f,c,e.itemId,e):(e.itemId&&console.warn("Found item id in layer but no portal to query. Fallback to add by url.",e),b=P.addLayerToMapByUrl(f,e,c));E.push(b)});var t=R.urlParams();E.push(T(b,f,a).then(function(){0<d&&(w.pingGeometryService(f.fullExtent),y.viewpoint=t.viewpoint&&2===d?R.viewpointFromUrlParameter(t.viewpoint):
y.createViewpoint({target:f.fullExtent,heading:0,tilt:0.5}));return u(f,a,c)}).then(function(){S(f);e(f)}).then(function(){return f}));return E}function T(e,a,b){a._websceneIndex=b.layerIndex;a:{b=b.layerIndex;for(var c=e.layers.getAll(),u=0;u<c.length;u++){var p=c[u];if(b<p._websceneIndex){b=u;break a}else if(b>p._websceneIndex&&(p=c[u+1]?c[u+1]._websceneIndex:null,!p||b<p)){b=u+1;break a}}b=void 0}e.add(a,b);return a}function V(e){for(var a=0;a<M.layerHandlers.length;a++)if(M.layerHandlers[a].condition(e))return!0;
return!1}function W(e){e instanceof t||(e=t.fromJSON(e));return e.isWebMercator()}function X(e){return 4326===e.wkid||W(e)}var Y={title:v.defaultWebSceneName,type:"Web Scene",typeKeywords:"Web Scene, 3D, Map, Scene, Web, Streaming"},P=k([b,f],{normalizeCtorArgs:function(e){e&&e.spatialReference&&(1.3<=e.version?e.spatialReference=t.fromJSON(e.spatialReference):delete e.spatialReference);e&&e.clippingArea&&(e.clippingArea.geometry=r.fromJSON(e.clippingArea.geometry));e=m.mixin({},e);e.baseMap&&null==
e.baseMap.elevationLayers&&(e.baseMap.elevationLayers=F.DefaultBasemapJson.elevationLayers);return e},getDefaults:function(){return{baseMap:F.DefaultBasemapJson,operationalLayers:[],portalItemProperties:Y,presentation:new U,spatialReference:t.WebMercator,viewingMode:"global"}},initialize:function(){this._validate()},authoringApp:void 0,authoringAppVersion:void 0,baseMap:void 0,_initialStateSetter:function(e){e&&(e.environment&&!e.environment.declaredClass)&&(e.environment=N.fromJSON(e.environment));
return e},operationalLayers:void 0,portalItemProperties:void 0,presentation:void 0,_presentationSetter:function(e){if(!e)return e;e.declaredClass||(e=U.fromJSON(e));return e},_snippetGetter:function(){return this.portalItemProperties.snippet},_snippetSetter:function(e){this.portalItemProperties.snippet=e},_tagsGetter:function(){return this.portalItemProperties.tags},_tagsSetter:function(e){this.portalItemProperties.tags=e},_titleGetter:function(){return this.portalItemProperties.title},_titleSetter:function(e){this.portalItemProperties.title=
e},toc:void 0,version:void 0,addOperationalLayer:function(e){this.operationalLayers.push(e);return this.operationalLayers},removeOperationalLayer:function(e){for(var a=-1,b=0;b<this.operationalLayers.length;b++)if(this.operationalLayers[b].id===e){a=b;break}return this.operationalLayers.splice(a,1)},_updateLayerFromMap:function(e){var a=function(e,a){if(-1===e.indexOf("."))return a[e];var b=e.split(".");if(2==b.length)return a[b[0]][b[1]];if(3==b.length)return a[b[0]][b[1]][b[2]];if(4==b.length)return a[b[0]][b[1]][b[2]][b[3]];
if(5==b.length)return a[b[0]][b[1]][b[2]][b[3]][b[4]];if(5<b.length)throw Error("propName.length \x3e 5 is not implemented");},b=function(e,b){if(2<arguments.length)throw Error("get value if exists called with too many parameters");return m.exists(e,b)?a(e,b):void 0},c=function(e,a,b){return m.exists(e,a)?b:void 0},u=function(e,b,c){return m.exists(e,b)&&!0===a(e,b)?c:void 0},p=function(e){return e.elevationInfo&&0<Object.keys(e.elevationInfo).length?x.fixJson(e.elevationInfo):void 0},D=function(e){if(e.popupTemplate)return{title:e.popupTemplate.info.title,
fieldInfos:m.clone(e.popupTemplate.info.fieldInfos),description:e.popupTemplate.info.description,showAttachments:e.popupTemplate.info.showAttachments,mediaInfos:m.clone(e.popupTemplate.info.mediaInfos)}},h=function(e){if(e._websceneEditorProperties&&!1===e._websceneEditorProperties.editedFlags.labelingInfo)return b("originalOperationalLayer.layerDefinition.drawingInfo.labelingInfo",e._websceneEditorProperties);if(e._websceneEditorProperties&&!0===e._websceneEditorProperties.editedFlags.labelingInfo){var a=
new G;a.labelingInfo=e.labelingInfo;return(e=a.toJSON())&&e.labelingInfo}return null},v=function(e){if(e._websceneEditorProperties&&!1===e._websceneEditorProperties.editedFlags.renderer)return b("originalOperationalLayer.layerDefinition.drawingInfo.renderer",e._websceneEditorProperties);if(e._websceneEditorProperties&&!0===e._websceneEditorProperties.editedFlags.renderer){var a=new G;a.renderer=e.renderer;return(e=a.toJSON())&&e.renderer}return null},f={url:e.url,title:e.title,id:e.id,layerType:M.extrapolateTypeFromLayerInstance(e),
visibility:e.visible,opacity:e.opacity||1-e.transparency,layerDefinition:{drawingInfo:{}}},E=e._websceneEditorProperties&&e._websceneEditorProperties.originalOperationalLayer;f.itemId=b("portalLayerItem.item.id",e._websceneEditorProperties)||b("itemId",E);null!=E?(f.minScale=c("minScale",E,e.minScale),void 0===f.minScale&&(f.layerDefinition.minScale=c("layerDefinition.minScale",E,e.minScale)),f.maxScale=c("maxScale",E,e.maxScale),void 0===f.maxScale&&(f.layerDefinition.maxScale=c("layerDefinition.maxScale",
E,e.maxScale)),f.layerDefinition.definitionExpression=c("layerDefinition.definitionExpression",E,"string"===typeof e.definitionExpression&&0<e.definitionExpression.length?e.definitionExpression:void 0),f.layerDefinition.drawingInfo.labelingInfo=c("layerDefinition.drawingInfo.labelingInfo",E,h(e)),f.visibilityMode=u("_websceneEditorProperties.editedFlags.visibilityMode",e,e.visibilityMode)||b("visibilityMode",E),f.listMode=u("_websceneEditorProperties.editedFlags.listMode",e,e.listMode)||b("listMode",
E),f.popupInfo=u("_websceneEditorProperties.editedFlags.popupInfo",e,D(e))||b("popupInfo",E),f.showLabels=u("_websceneEditorProperties.editedFlags.showLabels",e,e.showLabels),f.showLegend=u("_websceneEditorProperties.editedFlags.showLegend",e,e.showLegend),void 0===f.showLabels&&(f.showLabels=b("showLabels",E)),void 0===f.showLegend&&(f.showLegend=b("showLegend",E)),f.layerDefinition.elevationInfo=u("_websceneEditorProperties.editedFlags.elevationInfo",e,p(e))||b("elevationInfo",E.layerDefinition),
f.layerDefinition.drawingInfo.renderer=v(e),f.disablePopup=u("_websceneEditorProperties.editedFlags.popupDisable",e,e.disablePopup),void 0===f.disablePopup&&(f.disablePopup=b("disablePopup",E))):(f.visibilityMode=u("_websceneEditorProperties.editedFlags.visibilityMode",e,e.visibilityMode),f.listMode=u("_websceneEditorProperties.editedFlags.listMode",e,e.listMode),f.popupInfo=u("_websceneEditorProperties.editedFlags.popupInfo",e,D(e)),f.showLabels=u("_websceneEditorProperties.editedFlags.showLabels",
e,e.showLabels),f.showLegend=u("_websceneEditorProperties.editedFlags.showLegend",e,e.showLegend),f.layerDefinition.elevationInfo=u("_websceneEditorProperties.editedFlags.elevationInfo",e,p(e)),f.layerDefinition.drawingInfo.renderer=v(e),f.disablePopup=u("_websceneEditorProperties.editedFlags.popupDisable",e,e.disablePopup));e instanceof B&&(delete f.url,f.layers=[],d.forEach(e.layers.getAll(),function(e){f.layers.push(this._updateLayerFromMap(e))}.bind(this)));e.url&&(0<e.url.indexOf("s3-eu-west-1.amazonaws.com")&&
e.resourceInfo)&&(f.resourceInfo=JSON.parse(e.resourceInfo));f=x.fixJson(f,!0);f.layerDefinition&&(f.layerDefinition.elevationInfo&&0===Object.keys(f.layerDefinition.elevationInfo).length)&&delete f.layerDefinition.elevationInfo;f.layerDefinition&&(f.layerDefinition.drawingInfo&&0===Object.keys(f.layerDefinition.drawingInfo).length)&&delete f.layerDefinition.drawingInfo;f.layerDefinition&&0===Object.keys(f.layerDefinition).length&&delete f.layerDefinition;return f},updateFromView:function(e,a){var b=
e.map;e.map.spatialReference&&(this.spatialReference=e.map.spatialReference.clone());this.viewingMode="spherical"===e.globeMode?"global":"local";var c=function(e,a){for(var b,c=0;c<a.length;c++)a[c].id===e&&(b=a[c]);return b},u=function(e,a){var b=c(e.id,a);b&&e.visibility!==b.visibility&&(console.debug("keeping visibility for layer "+b.id+" as "+b.visibility),e.visibility=b.visibility);b&&"GroupLayer"===e.layerType&&e.layers.forEach(function(e){u(e,b.layers)})},p=function(e){return"number"!==typeof e||
isNaN(e)?e:Math.round(1E6*e)/1E6};!1!==a&&(this.baseMap=F.toJSON(e,b.basemap));var d,D=[];d=this.calculateWebsceneExtent(b,a);b.layers.forEach(function(e){"SilentContentLayer"===e.id||"__basemapErrorFallbackLayer__"===e.id||(e=this._updateLayerFromMap(e),D.push(e))}.bind(this));if(!1===a&&this.operationalLayers&&0<this.operationalLayers.length)for(b=0;b<D.length;b++)u(D[b],this.operationalLayers);this.set("operationalLayers",D);d&&(d=z.webMercatorToGeographic(d),this.portalItemProperties.extent=p(d.xmin)+
", "+p(d.ymin)+", "+p(d.xmax)+", "+p(d.ymax))},calculateWebsceneExtent:function(e,a){var b=null;if(this.clippingArea&&this.clippingArea.clip&&this.clippingArea.geometry)b=this.clippingArea.geometry;else if(0<e.layers.length)e.layers.forEach(function(e){if(!("SilentContentLayer"===e.id||"__basemapErrorFallbackLayer__"===e.id))try{var a=e.get("fullExtent");a&&(a.spatialReference.isWebMercator()||(a=z.geographicToWebMercator(a)),b=null==b?a.clone():b.union(a))}catch(c){}}.bind(this));else if(a||!m.exists("portalItemProperties.extent",
this))b=K.toExtent(view,Q.toCamera(view,J.fromJSON(this.initialState.viewpoint)));return b},toJSON:function(e){var a={operationalLayers:this.operationalLayers,baseMap:this.baseMap,version:(1).toString()+"."+(3).toString(),authoringApp:this.currentAuthoringApp,authoringAppVersion:this.currentAuthoringAppVersion,spatialReference:this.spatialReference.toJSON(),viewingMode:this.viewingMode};this.clippingArea&&(a.clippingArea={clip:this.clippingArea.clip,geometry:this.clippingArea.geometry.toJSON()});
this.initialState&&(a.initialState={viewpoint:this.initialState.viewpoint},this.initialState.environment&&(a.initialState.environment=N.toJSON(this.initialState.environment)));this.presentation&&(a.presentation=this.presentation.toJSON());return JSON.stringify(a,null,e)},_applyInitialState:function(e,a){var b=null,c=null;if(e){var u=window.location.hash;if(""!==u){var u=parseInt(u.substr(1),10)-1,p=this.presentation.slides.getAll();if((u=0>u||u>=p.length?null:p[u])&&u.viewpoint)c=J.fromJSON(u.viewpoint).camera}else if(a.viewpoint&&
(u=R.viewpointFromUrlParameter(a.viewpoint)))c=u.camera;this.initialState&&this.initialState.viewpoint&&(b=J.fromJSON(this.initialState.viewpoint).camera);if(b&&(this.initialState.environment||e.setInitialExtent(null,3)))e.camera=b;n.whenOnce(e,"ready",function(){c&&(e.camera=c);n.whenTrueOnce(e.environment.lighting,"ready",function(){this.get("initialState.environment.lighting")?N.applyToView(this.initialState.environment,e):N.adjustLightDateForLatitude(e.environment.lighting,e.camera.position)}.bind(this))}.bind(this))}},
applyToMap:function(e,a,b,u,d){var D=[];e.spatialReference=this.spatialReference||t.WebMercator;"local"===this.viewingMode&&(-1===this.portalItemProperties.typeKeywords.indexOf("viewingmode-local")&&(this.portalItemProperties.typeKeywords+=", ViewingMode-Local"),a.globeMode="planar",a.clippingArea=this.clippingArea&&this.clippingArea.clip?this.clippingArea.geometry:a.clippingArea);var f=[];if(!u||!0===u.basemap){var h=new c;l(F.setFromJSON(a,this.baseMap),function(){h.resolve()},function(e){h.reject({msg:e})});
D.push(h.promise)}(!u||!0===u.initialState)&&this._applyInitialState(a,d);this.operationalLayers.forEach(function(a,c){if(V(a))if(a.layerIndex=c,a.originalOperationalLayer=m.clone(a),"GroupLayer"===a.layerType){a.originalOperationalLayer.layers=null;for(var u=[],d=0;d<a.layers.length;d++)if(V(a.layers[d])){var f=a.layers[d];f.originalOperationalLayer=m.clone(a.layers[d]);u.push(f)}else p.show({message:v.messages.addLayerFailed+(""!==a.layers[d].title?": \x3ci\x3e"+a.layers[d].title+"\x3c/i\x3e":""),
type:p.MessageTypes.ERROR,details:v.messages.layerTypeNotSupported+" "+a.layers[d].layerType,collapsed:!1});a.layers=u;(u=E(a,e,b))&&(D=D.concat(u))}else a.itemId&&b?u=P.addContentByItemId(e,b,a.itemId,a):(a.itemId&&console.warn("Found item id in layer but no portal to query. Fallback to add by url.",a),u=P.addLayerToMapByUrl(e,a,b)),u&&D.push(u);else p.show({message:v.messages.addLayerFailed+(""!==a.title?": \x3ci\x3e"+a.title+"\x3c/i\x3e":""),type:p.MessageTypes.ERROR,details:v.messages.layerTypeNotSupported+
" "+a.layerType,collapsed:!1})}.bind(this));var y=new c,g=setTimeout(function(){y.reject("webscene not resolved on time")},2E4);if(0===D.length)return y.isResolved()||y.resolve({layers:f,slides:this.presentation.slides}),y;var r=D.length;for(a=0;a<D.length;a++)D[a].always(function(e,a){r--;e.isResolved()?a instanceof O?f.push(a):a&&a.layers&&(f=f.concat(a.layers)):p.show({message:v.messages.addLayerFailed,type:p.MessageTypes.ERROR,details:a.msg||a.message,collapsed:!1});0===r&&(clearTimeout(g),y.resolve({layers:f,
slides:this.presentation.slides}))}.bind(this,D[a]));y.then(function(a){e.layers.forEach(function(e){void 0!==e._websceneIndex&&delete e._websceneIndex})});return y},_validate:function(){if("global"===this.viewingMode){if(!W(this.spatialReference))throw Error(v.messages.websceneGlobalSR);var e=[];this.initialState&&this.initialState.viewpoint&&(this.initialState.viewpoint.camera&&e.push(this.initialState.viewpoint.camera.position.spatialReference),this.initialState.viewpoint.targetGeometry&&e.push(this.initialState.viewpoint.targetGeometry.spatialReference));
this.presentation&&this.presentation.slides&&this.presentation.slides.forEach(function(a){a.viewpoint&&(a.viewpoint.camera&&e.push(a.viewpoint.camera.position.spatialReference),a.viewpoint.targetGeometry&&e.push(a.viewpoint.targetGeometry.spatialReference))});if(!e.every(X))throw Error(v.messages.websceneGlobalEmbeddedSR);}else if(w.isGeographicCRS(this.spatialReference))throw Error(v.messages.websceneLocalSRGCS);}});m.mixin(P,{getFromUrl:function(e,b){var u=new c,p=new a(e);s({url:p.useSSL(window.location.protocol,
b)}).then(function(e){var a=P.checkVersion(e.version);if(a.isCompatible)try{var b=new P(e);u.resolve(b)}catch(c){u.reject(c.message)}else u.reject(a.message)},function(e){u.reject(e)});return u},getFromPortalItem:function(e,a){var b=new c,u=e.getItem(a).then(function(c){u=c;e.getItemData(a).then(function(c){var p=P.checkVersion(c.version);if(p.isCompatible)try{var d=new P(c);d.set("portalItemProperties",u);b.resolve(d);e.isSignedIn()||g(e,"sign-in",function(){e.getItem(a).then(function(e){d.set("portalItemProperties",
e)})})}catch(D){b.reject(D.message)}else b.reject(p.message)})},function(e){b.reject(e)});return b},addLayerHandlers:function(e){for(var a=0;a<e.length;a++)M.addHandler(e[a])},_getLayerHandlers:function(){return M.getHandlers()},addLayerByItemId:function(e,a,b,u,p){var d=new c;this.addContentByItemId(e,a,b,u,p).then(function(a){e.layers.forEach(function(e){void 0!==e._websceneIndex&&delete e._websceneIndex});d.resolve(a)},function(e){d.reject(e)});return d},addContentByItemId:function(e,a,b,u,d,D){var f=
this,h=new c;a.getItem(b).then(function(c){a.getItemData(b).then(function(p){p&&p.hasOwnProperty("_ssl")&&delete p._ssl;"Scene Service"===c.type?f._addSceneServiceItem(e,a,c,b,p,u,D).then(h.resolve,h.reject):"Web Scene"==c.type?f._importWebSceneItem(e,a,d,c,p).then(h.resolve,h.reject):f._doAddLayerByItemId(e,a,b,c,p,u,D).then(h.resolve,h.reject)},function(e){h.reject(e)})},function(e){h.reject(e)});h.then(function(e){if(e&&0<e.length)for(var a=0;a<e.length;a++)e[a][0]&&e[a][0].warning&&p.show({message:e[a].warning,
type:p.MessageTypes.WARNING,details:v.messages.itemId+" "+b+"\x3cbr\x3e"+v.messages.itemType+" "+e[a].type});console.log("layer added by item id: "+b)},function(e){p.show({message:e.itemType&&"WebScene"===e.itemType?v.messages.sceneRejectTitle:v.messages.addLayerFailed,type:p.MessageTypes.ERROR,details:(e.msg?e.msg+"\x3cbr\x3e"||"":"")+v.messages.itemId+" "+b,collapsed:!1})});return h.promise},_doAddLayerByItemId:function(e,a,b,u,d,D,f){var h=this,E=[];f=f?f:this.spatialReferenceLocked?0:1;if(!d||
0===Object.keys(d).length){var y=m.mixin({url:u.url,itemId:b,title:u.title,opacity:u.opacity,visibility:u.visibility,thumbnailUrl:u.thumbnailUrl},D);y.portalLayerItem={item:u,itemData:d};for(var g in y)null==y[g]&&delete y[g];g=h.addLayerToMapByUrl(e,y,a,f);E.push(g)}else if(("Feature Service"===u.type||"Scene Service"===u.type)&&d){var r=function(c,p,f,E){f=D&&D.url||u.url;null==f.match(/\/\d+\/?$/)&&null!=c.id&&("Scene Service"===u.type&&(f+="/layers"),f=f+"/"+c.id);delete c.id;f=m.mixin(c,{url:f,
itemId:b,opacity:u.opacity,visibility:u.visibility,thumbnailUrl:u.thumbnailUrl});f=P.mixLayerItemWithWebSceneOverrides(f,D);f.portalLayerItem={item:u,itemData:d};f.layerIndex=void 0!==c.layerIndex?c.layerIndex:p;for(var v in f)null==f[v]&&delete f[v];return h.addLayerToMapByUrl(e,f,a,E)};if(d.layers)if(D&&D.url&&null!=D.url.match(/\/\d+\/?$/)&&0<D.url.match(/\/\d+\/?$/).length){g=D.url.match(/\/\d+\/?$/)[0];g=Number(g.replace(/\//g,""));for(y=0;y<d.layers.length;y++)if(d.layers[y]&&d.layers[y].id==
g){E.push(r(d.layers[y],g,d.layers,f));break}}else{if("Scene Service"===u.type&&f){var t=f,n=l(null),T=[];d.layers.forEach(function(e,a,b){n=n.then(function(){return r(e,a,b,t)}).then(function(e){e instanceof O?T.push(e):T=T.concat(e.layers);0<T.length&&(t=0)}).otherwise(function(e){this._showLayerAddError(e.msg)}.bind(this))}.bind(this));return n=n.then(function(){return{layers:T}})}d.layers.forEach(function(e,a,b){E.push(r(e,a,b,f))})}else E.push(r({},null,[],f))}else if("Map Service"===u.type){g=
m.mixin({url:u.url,itemId:b,title:u.title,opacity:u.opacity,visibility:u.visibility,thumbnailUrl:u.thumbnailUrl},D);d&&(g.layerDefinition={minScale:d.minScale,maxScale:d.maxScale});g.portalLayerItem={item:u,itemData:d};for(y in g)null==g[y]&&delete g[y];var w=new c;E.push(w);h.addLayerToMapByUrl(e,g,a,f).then(function(e){w.resolve(e);p.show({message:v.messages.layerItemPropertiesFromMapServer,type:p.MessageTypes.WARNING})},function(e){w.reject(e)})}else if("Image Service"===u.type){g=m.mixin(d,{url:u.url,
itemId:b,title:u.title,opacity:u.opacity,visibility:u.visibility,thumbnailUrl:u.thumbnailUrl});g=P.mixLayerItemWithWebSceneOverrides(g,D);g.portalLayerItem={item:u,itemData:d};for(var s in g)null==g[s]&&delete g[s];g=h.addLayerToMapByUrl(e,g,a,f);E.push(g)}else{var z=new c;E.push(z);setTimeout(function(){z.reject({msg:v.messages.layerItemTypeNotSupported+" "+u.type})},0)}var k=E;if(1<k.length){var S=[],k=new c;for(g=0;g<E.length;g++)E[g].always(function(e,a){E.splice(E.indexOf(e),1);e.isResolved()?
a instanceof O?S.push(a):S=S.concat(a.layers):this._showLayerAddError(a.msg);0===E.length&&(0<S.length?k.resolve({layers:S}):k.reject())}.bind(this,E[g]))}else k=E[0];return k},_showLayerAddError:function(e){p.show({message:v.messages.addLayerFailed,type:p.MessageTypes.ERROR,details:e,collapsed:!1})},_addSceneServiceItem:function(e,a,b,u,p,d,D){var f=new c,h=this,E=new c;a.getRelatedItems(u).then(function(e){if(e&&1===e.total&&e.relatedItems&&0<e.relatedItems.length){for(var b=!1,c=0;!b&&c<e.relatedItems.length;)"Feature Service"===
e.relatedItems[c].type&&(b=!0,a.getItemData(e.relatedItems[c].id).then(function(e){e&&(e.layers&&1===e.layers.length)&&(null==d&&(d={}),d.popupInfo=e.layers[0].popupInfo,d.disablePopup=e.layers[0].disablePopup);E.resolve()},E.reject.bind(E))),c++;b||E.resolve()}else E.resolve()},E.reject.bind(E));E.promise.always(function(){h._doAddLayerByItemId(e,a,u,b,p,d,D).then(function(e){f.resolve(e)},function(e){f.reject(e)})});return f},_uniqueLayersIds:function(e,a,b){for(var c=0;c<e.length;c++){var u=e[c];
"GroupLayer"===u.layerType&&u.layers&&this._uniqueLayersIds(u.layers,a,b);var p=b[u.id];if(void 0!==p)u.id=p;else if(a.getLayer(u.id)){var p=u.id,d=p.match(/(.*-layer)(\d+)$/),D;d?(D=d[1],d=parseInt(d[2],10)):(D=p+"-",d=0);for(;a.getLayer(p);)d++,p=D+d.toString();p!==u.id&&(b[u.id]=p,u.id=p)}}},updateUniqueLayerIds:function(e,a){var b={};this._uniqueLayersIds(e.operationalLayers,a,b);e.presentation.slides.forEach(function(e){for(var a=0;a<e.visibleLayers.length;a++){var c=e.visibleLayers[a],u=b[c.id];
void 0!==u&&(c.id=u)}})},_importWebSceneItem:function(e,a,b,u,p){var d=new c,D=P.checkVersion(p.version);if(D.isCompatible)try{var f=new P(p),h=window._webSceneViewerView;if("spherical"===h.globeMode&&"local"===f.viewingMode)d.reject({itemType:"WebScene",msg:v.messages.sceneRejectL2G});else if("planar"===h.globeMode&&"global"===f.viewingMode)d.reject({itemType:"WebScene",msg:v.messages.sceneRejectG2L});else{if(f.spatialReference.equals(e.spatialReference))return P.updateUniqueLayerIds(f,e),f.set("portalItemProperties",
u),f.presentation.updateUniqueSlideIds(b.presentation.slides),f.presentation&&f.presentation.slides&&(f.presentation.slides.getAll().forEach(function(e){b.presentation.slides.addItem(e)}),b.set("presentation",b.presentation.toJSON())),f.applyToMap(e,null,a,{basemap:!1,initialState:!1});d.reject({itemType:"WebScene",msg:v.messages.sceneRejectSRTS})}}catch(E){d.reject({msg:E.message})}else d.reject({msg:D.message});return d},_updateDfd:function(e,a,b,c){if(0<a){if(e.resolve({layers:b}),0<c.length)for(a=
0;a<c.length;a++)this._showLayerAddError(c[a].msg)}else if(0<c.length){for(a=1;a<c.length;a++)this._showLayerAddError(c[a].msg);e.reject(c[0])}return e},_showBasemapDropConfirmDialog:function(e,a){var b=P._dropBasemapDialog.on("confirm",function(){c.remove();b.remove();e.resolve({dropBasemap:a})}.bind(this)),c=P._dropBasemapDialog.on("cancel",function(){c.remove();b.remove();e.resolve({dropBasemap:0})}.bind(this));P._dropBasemapDialog.show()},_checkForBasemapDropMapOrImageLayer:function(e,a,b,c,u,
p){c?(e=e instanceof t?e.clone():t.fromJSON(e),!e.equals(b)||a.basemapTerrain&&!a.basemapTerrain.tilingScheme.compatibleWith(c)?1===p&&"planar"===a.globeMode?this._showBasemapDropConfirmDialog(u,p):2===p?u.resolve({dropBasemap:p}):u.resolve({dropBasemap:0}):u.resolve({dropBasemap:0})):u.resolve({dropBasemap:0})},_checkForBasemapDropSceneLayer:function(e,a,b,c,u){e=D(e);b=e.equals(b)?!0:b.isWebMercator()&&4326===e.wkid?!0:!1;b?c.resolve({dropBasemap:0}):1===u&&"planar"===a.globeMode?this._showBasemapDropConfirmDialog(c,
u):2===u?c.resolve({dropBasemap:u}):c.resolve({dropBasemap:0})},_checkForBasemapDrop:function(e,a){var b=new c;0!==e&&0<a.length?M.prepareOpLayerFromService(a[0],e).then(function(c){c=c.serviceInfo;var u=c.tileInfo instanceof I?c.tileInfo:I.fromJSON(c.tileInfo),p=a[0].serviceDetails.serviceType,d=window._webSceneViewerView,D=d.map.spatialReference,f=c.spatialReference;"MapServer"===p?this._checkForBasemapDropMapOrImageLayer(f,d,D,u,b,e):"ImageServer"===p?this._checkForBasemapDropMapOrImageLayer(f,
d,D,u,b,e):"FeatureServer"===p?b.resolve({dropBasemap:0}):("SceneServerLocal"===p||"SceneServer"===p)&&this._checkForBasemapDropSceneLayer(c,d,D,b,e)}.bind(this),function(e){b.resolve({dropBasemap:0,error:e})}):b.resolve({dropBasemap:0});return b.promise},addLayerToMapByUrl:function(e,a,b,u){a.url=M.useSSLIfRequired(a.url,b);var p=new c,d=[],D=[],f=[],h=0;M.prepareFromServiceUrl(a.url,a).then(function(c,g){var y=[];this._checkForBasemapDrop(u,g.services).then(function(u,p){for(var r=0;r<g.services.length;r++)y.push(M.prepareOpLayerFromService(g.services[r],
p.dropBasemap));var t=g.services.length;if(0===y.length)return c.resolve(),c.promise;for(var n=y.slice(0),l=0;l<y.length;l++)y[l].promise.always(function(u,g){var r=y.indexOf(u);y.splice(r,1);var T;if(u.isResolved())h++,r=a.layerIndex,void 0===r&&(r=n.length-n.indexOf(u)),g.layerIndex=r,g.id=a.id,g.visibility=a.visibility,g.opacity=a.opacity,g.layerDefinition=a.layerDefinition,g.minScale=a.minScale,g.maxScale=a.maxScale,g.visibilityMode=a.visibilityMode,g.listMode=a.listMode,g.popupInfo=a.popupInfo,
g.showLabels=a.showLabels,g.showLegend=void 0===a.showLegend?!0:a.showLegend,g.portalLayerItem=a.portalLayerItem,g.originalOperationalLayer=a.originalOperationalLayer,g.thumbnailUrl=a.thumbnailUrl,g.disablePopup=a.disablePopup,T=E(g,e,b,p.dropBasemap),d.push(T);else if(u.isRejected()&&(0===r&&p.error?f.push(p.error):f.push(g)),t--,0===t)return c=this._updateDfd(c,h,D,f),c.promise;if(T){var w=0;q(T).always(function(e,a){d.splice(d.indexOf(d[l]),1);for(var b=0;b<e.length;b++){var u=e[b],p=a[b];u.isResolved()?
(p instanceof O?D.push(p):D=D.concat(p.layers),w++):u.isRejected()&&(null==p&&(!Array.isArray(a)&&a.hasOwnProperty("error"))&&(console.error(v.messages.layerCreationErrorGeneric+" "+a.error),p={msg:v.messages.layerCreationErrorGeneric}),f.push(p))}t--;0===t&&(c=this._updateDfd(c,w,D,f))}.bind(this,T))}}.bind(this,y[l]),function(e,a){e.reject(a)}.bind(this,c))}.bind(this,p),function(e){c.reject(e)})}.bind(this,p),function(e,a){e.reject(a)}.bind(this,p));return p.promise},mixLayerItemWithWebSceneOverrides:function(e,
a){if(null==a)return e;if(null==e)return a;for(var b=Object.keys(e).concat(Object.keys(a)).concat(),c=0;c<b.length;++c)for(var u=c+1;u<b.length;++u)b[c]===b[u]&&b.splice(u--,1);for(c=0;c<b.length;c++)u=b[c],"layerDefinition"===u&&e.hasOwnProperty(u)&&a.hasOwnProperty(u)?e[u]=m.mixin(e[u],a[u]):a.hasOwnProperty(u)&&(e[u]=a[u]);return e},checkVersion:function(e){if(null==e)return{isCompatible:!1,version:{major:null,minor:null},message:v.messages.websceneLoadFail+"\x3cbr\x3e"+v.messages.websceneLoadFailNoVersion};
var a="string"===typeof e?e.split("."):[],b=2===a.length?parseInt(a[0],10):null,a=2===a.length?parseInt(a[1],10):null;return null===b||null===a?{isCompatible:!1,version:{major:null,minor:null},message:v.messages.websceneLoadFail+"\x3cbr\x3e"+h.substitute(v.messages.websceneLoadFailBadVersion,{websceneVersion:e})}:1>b&&!(0===b&&94===a)?{isCompatible:!1,version:{major:b,minor:a},message:v.messages.websceneLoadFail+"\x3cbr\x3e"+h.substitute(v.messages.websceneLoadFailIncompatVersion,{websceneVersion:e})+
" "+h.substitute(v.messages.websceneVersionRequires,{websceneRequiredVersion:"1.x"})}:1<b?{isCompatible:!1,version:{major:b,minor:a},message:v.messages.websceneLoadFail+"\x3cbr\x3e"+h.substitute(v.messages.websceneLoadFailIncompatVersion,{websceneVersion:e})+" (1.3)"}:{isCompatible:!0,version:{major:b,minor:a},message:""}}});P.spatialReferenceLocked=!1;P._dropBasemapDialog=new y({title:v.messages.basemapDropTitle,message:v.messages.basemapDrop,confirm:v.messages.basemapDropConfirm});return P})},"webSceneViewer/assertUtils":function(){define([],
function(){function k(k){this.message=k}k.prototype.toString=function(){return"AssertException: "+this.message};return{AssertException:k,assert:function(m,d){if(!m){var q=Error("dummy");q.stack&&console.log(q.stack);throw new k(d);}}}})},"webSceneViewer/webScene/WebSceneLayers":function(){define("dojo/_base/lang dojo/_base/array dojo/promise/all dojo/Deferred dojo/request/xhr esri/request esri/config esri/geometry/Extent esri/geometry/SpatialReference webSceneViewer/spatialReferenceUtils esri/layers/SceneLayer esri/layers/FeatureLayer esri/layers/ArcGISTiledLayer esri/layers/ArcGISDynamicLayer esri/layers/ArcGISElevationLayer esri/layers/GroupLayer esri/layers/OpenStreetMapLayer esri/layers/support/TileInfo esri/views/3d/terrain/TilingScheme esri/views/3d/terrain/TerrainSurface dojo/i18n!webSceneViewer/nls/viewer".split(" "),
function(k,m,d,q,c,g,h,l,b,f,n,s,x,a,r,z,t,w,B,H,A){function O(e){h.geometryService&&require(["dojo/on","esri/geometry/support/webMercatorUtils"],function(a,c){a.once(e,"load",function(){var a=e.fullExtent;a&&(102100===a.spatialReference.wkid||(3857===a.spatialReference.wkid||4326===a.spatialReference.wkid)||require(["esri/tasks/GeometryService","esri/tasks/support/ProjectParameters"],function(c,u){var p=h.geometryService,d=new u;d.geometries=[a];d.outSR=b.WebMercator;p.project(d).then(function(a){a&&
0<a.length&&e.set("fullExtent",a[0])})}))})})}function I(e){var a=null,b=e.search(/\/rest\/services\//i);0<b&&(a=e.substring(0,b+6));return a}function G(e){var a=document.createElement("a");a.href=e;e=a.hostname;for(var a=[".arcgis.com",".arcgisonline.com"],b=0;b<a.length;b++){var c=a[b];if(-1!==e.indexOf(c,e.length-c.length))return!0}return!1}function J(e){e instanceof w||(e=w.fromJSON(e));return B.WebMercatorAuxiliarySphere.compatibleWith(e)}function C(e,a){e instanceof w||(e=w.fromJSON(e));var b=
a.basemapTerrain&&a.basemapTerrain.tilingScheme;return b?b.compatibleWith(e):!0}function K(e,a){var b=H.checkUnsupported(e.tileInfo,e.fullExtent);if(b)return a.reject({msg:Q(b)+F(e)}),!0}function Q(e){switch(e.name){case "tilingscheme:gaps":return A.messages.tilingSchemeGaps;case "tilingscheme:power-of-two":return A.messages.tilingSchemePowerOfTwo;case "tilingscheme:tile-size":return A.messages.tilingSchemeTileSize;case "terrainsurface:num-root-tiles":return e.message;default:return A.messages.tilingSchemeGeneric}}
function N(e,a,c,p,d){if(a.tileInfo){e=G(e);if(!e&&10.22>c.currentVersion)return p.reject({msg:A.messages.tiledMapServicesMinVersion+F(a)}),!1;if(!e&&10.22===c.currentVersion&&!c._isCorsPatchDetected)return p.reject({msg:A.messages.tiledMapServicesMinVersionPatch+" "+A.messages.patchRequired+"\x3cbr\x3eArcGIS 10.2.2 for Server Patch - View Map and Image Services in the ArcGIS Online Scene Viewer"}),!1;c=window._webSceneViewerView;e=a.spatialReference instanceof b?a.spatialReference.clone():b.fromJSON(a.spatialReference);
var h=c.map.spatialReference,g="planar"===c.globeMode&&1===d;d=2===d;if(!d&&(!g||"spherical"===c.globeMode)&&!e.equals(h))return d=h.isWebMercator()?A.messages.tiledMapServicesSR+" Create a new local scene to add this layer.":A.messages.tiledMapServicesSRGeneric+" ("+h.wkid+")",p.reject({msg:d+F(a)}),!1;if(f.isGeographicCRS(e))return p.reject({msg:A.messages.tiledMapServiceSRGCS+F(a)}),!1;if("spherical"===c.globeMode){if(!d&&!J(a.tileInfo))return p.reject({msg:A.messages.tiledMapServicesTilingScheme+
F(a)}),!1}else if(!d&&!g&&!C(a.tileInfo,c))return p.reject({msg:A.messages.tiledMapServicesSRGeneric+F(a)}),!1;return K(a,p)?!1:"ArcGISTiledMapServiceLayer"}return"ArcGISMapServiceLayer"}function F(e){return e.name&&""!==e.name?"\x3cbr\x3e"+A.messages.serviceName+": "+e.name:""}function R(e,a,c){if(e.tileInfo){var p=e.spatialReference instanceof b?e.spatialReference.clone():b.fromJSON(e.spatialReference),d="LERC"===e.tileInfo.format,h=window._webSceneViewerView,g=h.map.spatialReference,v="planar"===
h.globeMode&&1===c;c=2===c;if(!c&&(!v||"spherical"===h.globeMode)&&!p.equals(g))return p=d?"spherical"===h.globeMode?A.messages.elevationImageServicesSR+" Create a new local scene to add this layer.":A.messages.tiledElevationServicesSRGeneric+" ("+g.wkid+")":"spherical"===h.globeMode?A.messages.imageServicesSR+" Create a new local scene to add this layer.":A.messages.tiledImageServicesSRGeneric+" ("+g.wkid+")",a.reject({msg:p+F(e)}),!1;if(f.isGeographicCRS(p))return a.reject({msg:A.messages.tiledMapServiceSRGCS+
F(e)}),!1;if("spherical"===h.globeMode){if(!c&&!J(e.tileInfo))return p=d?A.messages.elevationImageServicesTilingScheme:A.messages.tiledImageServicesTilingScheme,a.reject({msg:p+F(e)}),!1}else if(!v&&!c&&!C(e.tileInfo,h))return p=d?A.messages.tiledElevationServicesSRGeneric+F(e):A.messages.tiledImageServicesSRGeneric+F(e),a.reject({msg:p}),!1;return K(e,a)?!1:d?"ArcGISTiledElevationServiceLayer":"ArcGISTiledImageServiceLayer"}p=d?A.messages.elevationImageServicesCached:A.messages.imageServicesCached;
a.reject({msg:p+F(e)});return!1}function M(e,a,c){if(e){var p;p=k.exists("spatialReference.wkid",e)?new b(e.spatialReference.wkid):new b(4326);var d=window._webSceneViewerView,h=d.map.spatialReference,g="planar"===d.globeMode&&1===c;if(c=2!==c){if(g=!g||"spherical"===d.globeMode)g=p.equals(h)?!0:h.isWebMercator()&&4326===p.wkid?!0:!1,g=!g;c=g}return c?(p="spherical"===d.globeMode?A.messages.sceneLayerSRWM+" Create a new local scene to add this layer.":A.messages.sceneLayerSR+" ("+h.wkid+")",a.reject({msg:p+
F(e)}),!1):"planar"===d.globeMode&&f.isGeographicCRS(p)?(a.reject({msg:A.messages.sceneLayerSRGCS+F(e)}),!1):(p=e.drawingInfo&&e.drawingInfo.renderer&&e.drawingInfo.renderer.type)&&!v.isFeatureServiceRendererSupported(p)?(a.reject({msg:A.messages.featureServiceNotSupportedRendererType+" "+p+F(e)}),!1):!0}}function U(e,a,b){if(e.type&&"Table"===e.type)return b.reject({msg:A.messages.featureServiceNotSupportedTable+F(e)}),!1;if(e.geometryType&&"esriGeometryMultiPatch"===e.geometryType)return b.reject({msg:A.messages.featureServiceNotSupportedMultipatch+
F(e)}),!1;if(e.geometryType&&"esriGeometryMultipoint"===e.geometryType)return b.reject({msg:"Multipoint Feature Services are not supported"+F(e)}),!1;var c=e.drawingInfo&&e.drawingInfo.renderer&&e.drawingInfo.renderer.type;if(!c)return b.reject({msg:A.messages.featureServiceNotSupportedNoRenderer+F(e)}),!1;if(!v.isFeatureServiceRendererSupported(c))return b.reject({msg:A.messages.featureServiceNotSupportedRendererType+" "+c+F(e)}),!1;if(a.count>p)b.reject({msg:A.messages.featureServiceNotSupportedMaxFeatures+
" "+a.count+"/"+p+F(e)});else return!0}function L(e){return e&&e.replace(/_/g," ").replace(/\/$/,"")}var p=2E3,y=["simple","classBreaks","uniqueValue"],v={create:function(e){for(var a,b=0;b<v.layerHandlers.length;b++)if(v.layerHandlers[b].condition(e)){a=v.layerHandlers[b].create(e);break}return a},addHandler:function(e){v.layerHandlers.push(e)},getHandlers:function(){return v.layerHandlers},layerHandlers:[{name:"ArcGISSceneServiceLayer",condition:function(e){return e.hasOwnProperty("layerType")&&
"ArcGISSceneServiceLayer"===e.layerType},create:function(e){return new n(e.url,v.evalOptions(e))}},{name:"ArcGISFeatureLayer",condition:function(e){return e.hasOwnProperty("layerType")&&"ArcGISFeatureLayer"===e.layerType},create:function(e){var a=v.evalOptions(e);a.mode=s.MODE_SNAPSHOT;a.returnZ=!0;a.outFields=["*"];e=new s(e.url,a);"spherical"===window._webSceneViewerView.globeMode?O(e):f.projectLayerExtentToSceneSR(e);return e}},{name:"ArcGISMapServiceLayer",condition:function(e){return e.hasOwnProperty("layerType")&&
"ArcGISMapServiceLayer"===e.layerType},create:function(e){return new a(e.url,v.evalOptions(e))}},{name:"ArcGISTiledMapServiceLayer",condition:function(e){return e.hasOwnProperty("layerType")&&"ArcGISTiledMapServiceLayer"===e.layerType},create:function(e){return new x(e.url,v.evalOptions(e))}},{name:"ArcGISTiledImageServiceLayer",condition:function(e){return e.hasOwnProperty("layerType")&&"ArcGISTiledImageServiceLayer"===e.layerType},create:function(e){return new x(e.url,v.evalOptions(e))}},{name:"GroupLayer",
condition:function(e){return e.hasOwnProperty("layerType")&&"GroupLayer"===e.layerType},create:function(e){e=v.evalOptions(e);return new z(e)}},{name:"ArcGISTiledElevationServiceLayer",condition:function(e){return e.hasOwnProperty("layerType")&&"ArcGISTiledElevationServiceLayer"===e.layerType},create:function(e){var a=v.evalOptions(e);0<e.url.indexOf("s3-eu-west-1.amazonaws.com")&&(void 0===e.resourceInfo&&(console.warn("missing s3 elevation info"),e.resourceInfo={}),a.resourceInfo=e.resourceInfo,
void 0===e.resourceInfo.tileInfo&&(a.resourceInfo.tileInfo={lods:S}),a.resourceInfo.fullExtent=void 0===e.resourceInfo||void 0===e.resourceInfo.fullExtent?new l(-2.103750722959434E7,-2.197186888040859E7,2.103750722959434E7,2.1971868880408563E7,b.WebMercator):new l(e.resourceInfo.fullExtent));return new r(e.url,a)}}],evalOptions:function(e){var a={visible:void 0===e.visibility?!0:e.visibility,title:e.title};e.id&&(a.id=e.id);void 0!==e.opacity&&(a.opacity=e.opacity);void 0!==e.visibilityMode&&(a.visibilityMode=
e.visibilityMode);a.showLegend=void 0===e.showLegend?!0:e.showLegend;void 0!==e.listMode&&(a.listMode=e.listMode);e.layerDefinition&&e.layerDefinition.definitionExpression&&(a.definitionExpression=e.layerDefinition.definitionExpression);return a},isFeatureServiceRendererSupported:function(e){return-1!==y.indexOf(e)},prepareFromServiceUrl:function(e,a){var b=new q;if(!e)return b.reject({msg:A.messages.invalidUrl}),b.promise;var c=v.validateServerUrl(e),p=c.serviceType,d=c.hasLayer;if(!c.isValidUrl)return b.reject({msg:A.messages.invalidUrl+
" "+e}),b.promise;if("MapServer"===p&&d)c.serviceType="FeatureServer";else if("ImageServer"===p&&d)return b.reject({msg:A.messages.unsupportedUrl+" "+e}),b.promise;var f={url:e,params:a,serviceDetails:c};c.needsGetLayer?g({url:e,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(e,d){if("SceneServer"===p){var f;(f=d.serviceVersion)?(f=f.split("."),f=!f||1>f.length?!1:"1"===f[0]):f=!1;if(!f){b.reject({msg:A.messages.sceneLayerVersion});return}}f=e.url;for(var h=[],g=0;g<
d.layers.length;g++){var v="SceneServer"===p?f+"/layers/"+d.layers[g].id:f+("/"===f.substr(f.length-1,1)?"":"/")+d.layers[g].id;h.push({url:v,params:a,serviceDetails:c})}b.resolve({services:h})}.bind(this,f),function(e){console.log("serviceInfo query on "+f.serviceType+" failed");b.reject(e)}):b.resolve({services:[f]});return b.promise},prepareOpLayerFromService:function(e,a){a=void 0===a?0:a;var b=new q,p=e.serviceDetails,f=p.serviceType,y=e.params,r=e.url,t=[],n=r;if("SceneServer"!==f)if("SceneServerLocal"===
f)f=document.createElement("a"),f.href=r,f=f.host,0>h.request.corsEnabledServers.indexOf(f)&&h.request.corsEnabledServers.push(f),p.hasLayer||(n=r+"/nodes/0/");else if("FeatureServer"===f)p=g({url:r+"/query",content:{f:"json",where:y&&y.layerDefinition&&y.layerDefinition.definitionExpression||"1\x3d1",returnCountOnly:!0},handleAs:"json",callbackParamName:"callback"}),t.push(p);else if("MapServer"===f&&!1===G(r)){var l=I(r);if(l){var w=new q;g({url:l+"services/",content:{f:"json"},handleAs:"json",
callbackParamName:"callback"}).then(function(e){10.22===e.currentVersion?c(l+"self?f\x3djson",{headers:{"X-Requested-With":null},timeout:1E4,handleAs:"json"}).then(function(a){e._isCorsPatchDetected=!a||a.error?!1:!0;w.resolve(e)},function(a){e._isCorsPatchDetected=!1;w.resolve(e)}):w.resolve(e)},w.reject.bind(w));t.push(w)}}e.layer?t.unshift(e.layer.then(function(){return e.layer})):(n=g({url:n,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),t.unshift(n));d(t).then(function(e,c,
p){var d,f=e.serviceDetails.serviceType,h=p[0],g;if("MapServer"===f){if(p=N(c,h,p[1],b,a))d=p,g=e.params.title||v.parseTitleFromLayerUrl(y.url)}else if("ImageServer"===f){if(p=R(h,b,a))d=p,g=e.params.title||L(h.name)}else"FeatureServer"===f?U(h,p[1],b)&&(d="ArcGISFeatureLayer",g=e.serviceDetails.needsGetLayer?(e.params.title||L(e.serviceDetails.serverName))+" - "+L(p[0].name):e.params.title||L(e.serviceDetails.serverName)+" - "+L(p[0].name)):"SceneServer"===f?M(h,b,a)&&(d="ArcGISSceneServiceLayer",
g=p[0].alias||p[0].name,g=e.serviceDetails.needsGetLayer?(e.params.title||L(e.serviceDetails.serverName))+" - "+L(g):e.params.title||L(e.serviceDetails.serverName)+" - "+L(g)):"SceneServerLocal"===f&&(g=d="ArcGISSceneServiceLayer");d?b.resolve({layerType:d,title:g,url:c,serviceInfo:h}):setTimeout(function(){b.reject({msg:"Unsupported service "+c})},50)}.bind(this,e,r),function(e,a){b.reject({msg:a.message,details:e})}.bind(this,r));return b},validateServerUrl:function(e){e=e.replace(/\/$/,"");e=e.split("?")[0];
var a=e.replace(/http.+\/(arcgis\/rest\/services|arcgis\/services)\/?/ig,"").match(/(\/(MapServer|GeocodeServer|GPServer|GeometryServer|ImageServer|NAServer|FeatureServer|GeoDataServer|GlobeServer|MobileServer|WMServer|SceneServer|SceneServerLocal)).*/ig);if(null==a)return{isValidUrl:!1};var b;a&&a[0]&&(b=e.split(a)[0].split("/").pop(),a=a[0].substr(1));a=a&&a.length?a.split("/"):!1;e=a[0];var a=a.splice(1),c=!1,p=!1,d=!1;"SceneServerLocal"===e&&(c=0===a.length||2===a.length&&"layers"===a[0]&&!isNaN(a[1]),
p=2===a.length,d=!p);if("SceneServer"===e)c=0===a.length||2===a.length&&"layers"===a[0]&&!isNaN(a[1]),p=2===a.length,d=!p;else if("FeatureServer"===e)c=0===a.length||1===a.length&&!isNaN(a[0]),p=1===a.length,d=!p;else if("MapServer"===e||"ImageServer"===e)c=0===a.length||1===a.length&&!isNaN(a[0]),p=1===a.length,d=!1;return{serviceType:e,hasLayer:p,isValidUrl:c,needsGetLayer:d,serverName:b}},extrapolateTypeFromLayerInstance:function(e){if(e instanceof n)return"ArcGISSceneServiceLayer";if(e instanceof
s)return"ArcGISFeatureLayer";if(e instanceof x)return e.capabilities?-1!==e.capabilities.split(",").indexOf("Map")?"ArcGISTiledMapServiceLayer":"ArcGISTiledImageServiceLayer":e.url?"ImageServer"===v.validateServerUrl(e.url).serviceType?"ArcGISTiledImageServiceLayer":"ArcGISTiledMapServiceLayer":"ArcGISTiledMapServiceLayer";if(e instanceof a)return"ArcGISMapServiceLayer";if(e instanceof r)return"ArcGISTiledElevationServiceLayer";if(e instanceof z)return"GroupLayer";if(e instanceof t)return"OpenStreetMap"},
URL_REGEXP:"^https?://[^/]+/([^/]+/)*(((SceneServer|MapServer|FeatureServer|ImageServer)((/layers)?/[0-9]+)?/?)|(SceneServerLocal(/([^/]+/?)*)?))$",parseTitleFromLayerUrl:function(e){var a=RegExp(v.URL_REGEXP);e=a.test(e)?L(e.replace(a,"$1")):v.parseIdFromLayerUrl(e);return e.charAt(0).toUpperCase()+e.slice(1)},parseIdFromLayerUrl:function(e,a){var b;b=RegExp(v.URL_REGEXP);b.test(e)?b=a?e.replace(b,"$2__")+a.replace(" ","_").toLowerCase():e.replace(b,"$2__$1"):(b=new URL(e),b=b.pathname.length<b.hostname.length?
b.pathname.replace("/","_"):b.hostname.replace(".","_"));return b},useSSLIfRequired:function(e,a){(function(e){if(!e||!a)return!1;var b=!1;m.forEach(("undefined"===typeof window.esriGeowConfig?{httpsDomains:["arcgis.com","arcgisonline.com"]}:window.esriGeowConfig).httpsDomains,function(a){if(-1<e.indexOf("."+a+"/")||-1<e.indexOf("/"+a+"/"))b=!0});!b&&-1<e.indexOf(a.portalHostname)&&(b=!0);return b})(e)&&(e=a.portalUtil.useSSL(window.location.protocol,e));return e}},S=[{level:0,resolution:156543.03392800014,
scale:5.91657527591555E8},{level:1,resolution:78271.51696399994,scale:2.95828763795777E8},{level:2,resolution:39135.75848200009,scale:1.47914381897889E8},{level:3,resolution:19567.87924099992,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.992452562495,scale:4622324.434309},{level:8,resolution:611.4962262813797,scale:2311162.217155},
{level:9,resolution:305.74811314055756,scale:1155581.108577},{level:10,resolution:152.87405657041106,scale:577790.554289},{level:11,resolution:76.43702828507324,scale:288895.277144},{level:12,resolution:38.21851414253662,scale:144447.638572},{level:13,resolution:19.10925707126831,scale:72223.819286},{level:14,resolution:9.554628535634155,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.388657133974685,scale:9027.977411},{level:17,resolution:1.1943285668550503,
scale:4513.988705},{level:18,resolution:0.5971642835598172,scale:2256.994353},{level:19,resolution:0.29858214164761665,scale:1128.497176}];return v})},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],function(k,m,d){var q=function(c){function g(g){c[g]=function(){var b=arguments,f=d(c,function(c){Array.prototype.unshift.call(b,c);return q(k[g].apply(k,b))});if("forEach"!==g||h)return f}}if(!c)return c;var h=!!c.then;h&&(c=m.delegate(c));g("forEach");
g("filter");g("map");null==c.total&&(c.total=d(c,function(c){return c.length}));return c};m.setObject("dojo.store.util.QueryResults",q);return q})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(k){var m={};k.setObject("dojo.data.util.sorter",m);m.basicComparator=function(d,k){var c=-1;null===d&&(d=void 0);null===k&&(k=void 0);if(d==k)c=0;else if(d>k||null==d)c=1;return c};m.createSortFunction=function(d,k){function c(b,a,c,d){return function(f,h){var g=d.getValue(f,b),n=
d.getValue(h,b);return a*c(g,n)}}for(var g=[],h,l=k.comparatorMap,b=m.basicComparator,f=0;f<d.length;f++){h=d[f];var n=h.attribute;if(n){h=h.descending?-1:1;var s=b;l&&("string"!==typeof n&&"toString"in n&&(n=n.toString()),s=l[n]||b);g.push(c(n,h,s,k))}}return function(b,a){for(var c=0;c<g.length;){var d=g[c++](b,a);if(0!==d)return d}return 0}};return m})},"webSceneViewer/mapUtils":function(){define(["esri/Map","esri/layers/GroupLayer"],function(k,m){var d={setVisibleLayerList:function(k,c){for(var g=
k.layers.getAll(),h=void 0!==g.get?g.get("length"):g.length,l=0;l<h;l++){var b=void 0!==g.getItemAt?g.getItemAt(l):g[l];k.basemap&&k.basemap._mapGroupLayer===b||(0<=c.indexOf(b.get("id"))?b.set("visible",!0):b.set("visible",!1),b instanceof m&&d.setVisibleLayerList(b,c))}},getVisibleLayersList:function(d){function c(h){var l=[];h instanceof k&&(l=h.layers);h instanceof m&&(l=h.layers.getAll());h=void 0!==l.get?l.get("length"):l.length;for(var b=0;b<h;b++){var f=void 0!==l.getItemAt?l.getItemAt(b):
l[b];d.basemap&&d.basemap._mapGroupLayer===f||(f instanceof m?(f.get("visible")&&g.push(f),c(f)):f.get("visible")&&g.push(f))}}var g=[];c(d);return g}};return d})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),function(k,m,d,q,c,g,h,l,b,f){return m("dijit._KeyNavContainer",[b,f,l],{connectKeyNavHandlers:function(b,d){var f=this._keyNavCodes={},
a=g.hitch(this,"focusPrev"),h=g.hitch(this,"focusNext");k.forEach(b,function(b){f[b]=a});k.forEach(d,function(a){f[a]=h});f[c.HOME]=g.hitch(this,"focusFirstChild");f[c.END]=g.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){q.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);k.forEach(this.getChildren(),g.hitch(this,"_startupChild"))},addChild:function(b,c){this.inherited(arguments);this._startupChild(b)},_startupChild:function(b){b.set("tabIndex",
"-1")},_getFirst:function(){var b=this.getChildren();return b.length?b[0]:null},_getLast:function(){var b=this.getChildren();return b.length?b[b.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(b){return(b=h.byNode(b))&&b.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),
function(k,m,d,q,c,g,h,l){return m("dijit._KeyNavMixin",l,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);d.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var b=this._keyNavCodes={};b[q.HOME]=c.hitch(this,"focusFirstChild");b[q.END]=c.hitch(this,"focusLastChild");b[this.isLeftToRight()?q.LEFT_ARROW:q.RIGHT_ARROW]=c.hitch(this,"_onLeftArrow");b[this.isLeftToRight()?q.RIGHT_ARROW:q.LEFT_ARROW]=c.hitch(this,"_onRightArrow");b[q.UP_ARROW]=c.hitch(this,
"_onUpArrow");b[q.DOWN_ARROW]=c.hitch(this,"_onDownArrow")}var f=this,b="string"==typeof this.childSelector?this.childSelector:c.hitch(this,"childSelector");this.own(g(this.domNode,"keypress",c.hitch(this,"_onContainerKeypress")),g(this.domNode,"keydown",c.hitch(this,"_onContainerKeydown")),g(this.domNode,"focus",c.hitch(this,"_onContainerFocus")),g(this.containerNode,g.selector(b,"focusin"),function(b){f._onChildFocus(h.getEnclosingWidget(this),b)}))},_onLeftArrow:function(){},_onRightArrow:function(){},
_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(b,c){b&&(this.focusedChild&&b!==this.focusedChild&&this._onChildBlur(this.focusedChild),
b.set("tabIndex",this.tabIndex),b.focus(c?"end":"start"))},_onContainerFocus:function(b){b.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){d.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(b){d.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(b){b&&b!=this.focusedChild&&
(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),b.set("tabIndex",this.tabIndex),this.lastFocused=b,this._set("focusedChild",b))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(b,c,d,h){b&&this.focusChild(b)},_keyboardSearchCompare:function(b,c){var d=b.domNode,d=(b.label||(d.focusNode?d.focusNode.label:"")||d.innerText||d.textContent||"").replace(/^\s+/,"").substr(0,c.length).toLowerCase();return c.length&&d==c?-1:0},_isFormElement:function(b){return"INPUT"===
b.tagName||"TEXTAREA"===b.tagName||"SELECT"===b.tagName||"BUTTON"===b.tagName},_onContainerKeydown:function(b){if(!this._isFormElement(document.activeElement)){var c=this._keyNavCodes[b.keyCode];c?(c(b,this.focusedChild),b.stopPropagation(),b.preventDefault(),this._searchString=""):b.keyCode==q.SPACE&&(this._searchTimer&&!b.ctrlKey&&!b.altKey&&!b.metaKey)&&(b.stopImmediatePropagation(),b.preventDefault(),this._keyboardSearch(b," "))}},_onContainerKeypress:function(b){if(!this._isFormElement(document.activeElement)&&
!(b.charCode<=q.SPACE||b.ctrlKey||b.altKey||b.metaKey))b.preventDefault(),b.stopPropagation(),this._keyboardSearch(b,String.fromCharCode(b.charCode).toLowerCase())},_keyboardSearch:function(b,d){var h=null,g,l=0;c.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=d;var a=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;g=this._searchString.substr(0,a);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);
var b=this.focusedChild||null;if(1==a||!b)if(b=this._getNextFocusableChild(b,1),!b)return;a=b;do{var c=this._keyboardSearchCompare(b,g);c&&0==l++&&(h=b);if(-1==c){l=-1;break}b=this._getNextFocusableChild(b,1)}while(b!=a)})();this.onKeyboardSearch(h,b,g,l)},_onChildBlur:function(){},_getNextFocusableChild:function(b,c){var d=b;do{if(b)b=this._getNext(b,c);else if(b=this[0<c?"_getFirst":"_getLast"](),!b)break;if(null!=b&&b!=d&&b.isFocusable())return b}while(b!=d);return null},_getFirst:function(){return null},
_getLast:function(){return null},_getNext:function(b,c){if(b)for(b=b.domNode;b;)if((b=b[0>c?"previousSibling":"nextSibling"])&&"getAttribute"in b){var d=h.byNode(b);if(d)return d}return null}})})},"webSceneViewer/widgets/Dialog/ConfirmDialog":function(){define("esri/core/declare dojo/dom-class dijit/Dialog dijit/_WidgetsInTemplateMixin dojo/text!./templates/ConfirmDialog.html dojo/i18n!../../editor/nls/editor dijit/form/Form dijit/form/TextBox dijit/form/ValidationTextBox dijit/form/Button dijit/form/CheckBox dijit/form/Textarea".split(" "),
function(k,m,d,q,c,g,h,l,b,f,n,s){return k([d,q],{templateString:c,message:"",confirm:"",cancel:"",title:"",constructor:function(b,a){},show:function(b){this.inherited(arguments);this._smoothBlendInOut(!0)},postCreate:function(){this.buttonConfirm.set("label",""!==this.confirm?this.confirm:g.confirmDialog.confirm);this.buttonCancel.set("label",""!==this.cancel?this.cancel:g.confirmDialog.cancelButton);this.Message.innerHTML=""!==this.message?this.message:"";this.titleNode.innerHTML=""!==this.title?
this.title:"";this.inherited(arguments)},_confirmButtonClickHandler:function(){this.emit("confirm",{});this._smoothBlendInOut(!1)},onCancel:function(){this.inherited(arguments);this.emit("cancel",{});this._smoothBlendInOut(!1)},_smoothBlendInOut:function(b){var a=document.getElementsByClassName("dijitDialogUnderlay _underlay");0!==a.length&&(a=a[0],b?m.add(a,"on"):m.remove(a,"on"))}})})},"dijit/form/RadioButton":function(){define(["dojo/_base/declare","./CheckBox","./_RadioButtonMixin"],function(k,
m,d){return k("dijit.form.RadioButton",[m,d],{baseClass:"dijitRadio"})})},"webSceneViewer/widgets/ShareDialog/ShareDialog":function(){define("esri/core/declare dojo/_base/lang dojo/dom-class dojo/dom-attr dojo/string dojo/on dijit/form/TextBox dijit/form/SimpleTextarea dijit/form/Select dijit/form/NumberTextBox dijit/_WidgetBase dijit/_TemplatedMixin dijit/form/CheckBox dojo/text!./templates/ShareDialog.html ../../urlUtils dojo/i18n!../nls/widgets".split(" "),function(k,m,d,q,c,g,h,l,b,f,n,s,x,a,
r,z){return k([n,s],{templateString:a,portal:void 0,webscene:void 0,view:void 0,_unsavedSceneChanges:!1,constructor:function(a,b){},destroy:function(){},postCreate:function(){this.Text.innerHTML=z.share.text;this.LinkText.innerHTML=z.share.link;this.embedText.innerHTML=z.share.embed;this.MoreOptionsText.innerHTML=z.share.more;this.ChangeSettingsLink.innerHTML=z.share.changeShareSettings;this._ShortenLinkButton=new x({checked:!0,"class":"shortenLink"},this.ShortenLinkCheckbox);this.ShortenLinkText.innerHTML=
z.share.shortenLink;this._linkUrlTextBox=new h({"class":"shareLinkUrl",onclick:"this.select();",onmouseup:"return false;",readOnly:!0});this.portal&&!this.portal.userCanShareWithPublic()&&(d.add(this.FacebookShare,"hide"),d.add(this.TwitterShare,"hide"));this._linkUrlTextBox.placeAt(this.LinkShareContainer,3);this._embedCodeTextArea=new l({"class":"shareEmbedCode",onclick:"this.select();",onmouseup:"return false;",readOnly:!0});this._embedCodeTextArea.placeAt(this.EmbedShareContainer,2);this._sizeOptions=
new b({options:[{label:z.share.smallSize,value:"small",selected:!0},{label:z.share.mediumSize,value:"medium",selected:!1},{label:z.share.largeSize,value:"large",selected:!1},{label:z.share.customSize,value:"custom",selected:!1}],"class":"sizeOptionsSelect"});this._sizeOptions.placeAt(this.SizeSelect);this.own(g(this._sizeOptions,"change",function(a){switch(a){case "small":this._widthTextBox.set("value",300);this._heightTextBox.set("value",200);d.add(this.CustomSizeContainer,"disable");this._updateEmbedCodeFrameSize();
break;case "medium":this._widthTextBox.set("value",800);this._heightTextBox.set("value",600);d.add(this.CustomSizeContainer,"disable");this._updateEmbedCodeFrameSize();break;case "large":this._widthTextBox.set("value",1080);this._heightTextBox.set("value",720);d.add(this.CustomSizeContainer,"disable");this._updateEmbedCodeFrameSize();break;case "custom":d.remove(this.CustomSizeContainer,"disable")}}.bind(this)));this._widthTextBox=new f({"class":"sizeTextBox",value:300,constraints:{pattern:"#",places:0}});
this._widthTextBox.placeAt(this.CustomSizeContainer,1);this.own(g(this._widthTextBox,"change",function(a){200>a?this._widthTextBox.set("value",200>a?200:a):this._updateEmbedCodeFrameSize()}.bind(this)));this._heightTextBox=new f({"class":"sizeTextBox",value:200,constraints:{pattern:"#",places:0}});this._heightTextBox.placeAt(this.CustomSizeContainer,3);this.own(g(this._heightTextBox,"change",function(a){200>a?this._heightTextBox.set("value",200>a?200:a):this._updateEmbedCodeFrameSize()}.bind(this)));
this.view.watch("stationary",function(){0<this.domNode.offsetHeight&&(this._ShortenLinkButton.get("checked")?this._ShortenLinkButton.set("checked",!1):this.updateUrlViewpoint(!1))}.bind(this));this.own(g(this._ShortenLinkButton,"change",function(a){this._shortenCheckboxClicked(a)}.bind(this)));this.startup();this.updateUrlViewpoint(!1)},setWebScene:function(a){this.webscene=a;0<this.domNode.offsetHeight&&(q.set(this._linkUrlTextBox.domNode,"data-old",""),this._ShortenLinkButton.set("checked",!1));
this.updateShareMessage()},_shortenCheckboxClicked:function(a){var b=q.get(this._linkUrlTextBox.domNode,"data-old"),c=this._linkUrlTextBox.get("value");a?b?c===b?(a=q.get(this._linkUrlTextBox.domNode,"data-old-shortened"),b=q.get(this._embedCodeTextArea.domNode,"data-old-shortened"),this._linkUrlTextBox.set("value",a),this._setEmbedCode(b)):this.updateUrlViewpoint(!0):this.updateUrlViewpoint(!0):(q.set(this._linkUrlTextBox.domNode,"data-old-shortened",c),b?(this._linkUrlTextBox.set("value",b),this._setEmbedCode(b+
"\x26ui\x3dmin")):this.updateUrlViewpoint(!1))},updateUrlViewpoint:function(a){var b=!1,b=!this.portal||this.portal._baseUrl.startsWith("../")?!1:m.exists("webscene.portalItemProperties.id",this)?m.exists("webscene.portalItemProperties.access",this)?"public"===this.webscene.portalItemProperties.access:!1:!0,b=this.portal?this.portal.getSceneViewerUrl(b):"";if(m.exists("webscene.portalItemProperties.id",this)&&!b.startsWith("../"))b+="?webscene\x3d"+this.webscene.portalItemProperties.id;else{var b=
window.location.href,c=b.indexOf("viewpoint\x3d")-1;if(-1<c)var d=b.indexOf("\x26",c+1),f="",f=-1<d?b.substr(c+1,d-c):b.substr(c,b.length-c),b=b.replace(f,"")}this.view&&this.view.get("camera")&&(b=r.viewpointToUrlParameter(b,this.view.get("camera"),"planar"===this.view.globeMode));c=function(a){this._linkUrlTextBox.set("value",a)}.bind(this);d=function(a,b){this._linkUrlTextBox.set("value",a);q.set(this._linkUrlTextBox.domNode,"data-old",b)}.bind(this);a?q.get(this._linkUrlTextBox.domNode,"data-old")!==
b&&r.shortenUrl(b,d,c):c(b);c=function(a){this._setEmbedCode(a);q.set(this._embedCodeTextArea.domNode,"data-old-shortened",a)}.bind(this);d=function(a){this._setEmbedCode(a)}.bind(this);a?q.get(this._linkUrlTextBox.domNode,"data-old")!==b&&r.shortenUrl(b+"\x26ui\x3dmin",c,d):d(b+"\x26ui\x3dmin")},_setEmbedCode:function(a){var b='\x3ciframe width\x3d"'+this._widthTextBox.value+'" height\x3d"'+this._heightTextBox.value+'" frameborder\x3d"0" scrolling\x3d"no" allowfullscreen src\x3d"',b=b+a+'"\x3e\x3c/iframe\x3e';
this._embedCodeTextArea.set("value",b)},_updateEmbedCodeFrameSize:function(a){a=this._embedCodeTextArea.get("value");a=a.replace(/width=\"[0-9]*\"/i,'width\x3d"'+this._widthTextBox.value+'"');a=a.replace(/height=\"[0-9]*\"/i,'height\x3d"'+this._heightTextBox.value+'"');this._embedCodeTextArea.set("value",a)},_moreOptionsExpandCollapse:function(){d.toggle(this.MoreOptionsContainer,"collapsed");d.toggle(this.MoreOptionsIcon,"rotate")},_toFacebook:function(){var a;a="http://www.facebook.com/sharer/sharer.php?s\x3d100\x26p[url]\x3d"+
this._linkUrlTextBox.value;window.open(a,"_blank")},_toTwitter:function(){var a=c.substitute(z.share.shareTwitterTxt,{sceneName:this.webscene?this.webscene.portalItemProperties.title:""}),b=this._linkUrlTextBox.value,d=140-(b.length+1);a.length+14>d&&(a=a.substr(0,d-3)+"...");window.open("http://twitter.com/home?status\x3d"+encodeURIComponent(a+""+b+"\n@ArcGISOnline"),"_blank")},_toEmail:function(){var a="mailto:?subject\x3d"+c.substitute(z.share.shareEmailSubject,{sceneName:encodeURIComponent(this.webscene?
this.webscene.portalItemProperties.title:"")}),b=this._linkUrlTextBox.value,a=a+("\x26body\x3d"+encodeURIComponent(z.share.shareEmailTxt1)+"%0D%0A"+encodeURIComponent(b)),a=a+("%0D%0A%0D%0A"+encodeURIComponent(z.share.shareEmailTxt2));this.portal&&this.portal.isSignedIn()&&this.portal.userHasEditingPrivileges()?this.emit("share-email",{mailUrl:a}):window.location.href=a},updateShareMessage:function(){if(this.portal){var a="",a="undefined"!==typeof esriGeowConfig?esriGeowConfig.baseUrl+"item.html?id\x3d"+
this.webscene.portalItemProperties.id:this.portal.url+"/home/item.html?id\x3d"+this.webscene.portalItemProperties.id;this.ChangeSettingsLink.href=a}if(this._unsavedSceneChanges)d.add(this.ShareMessage,"show"),this.ShareMessageText.innerHTML=z.share.shareUnsaved,d.remove(this.ChangeSettingsLink,"show");else if(this.portal&&this.portal.userCanShareWithPublic())if(m.exists("webscene.portalItemProperties.access",this)&&"public"!==this.webscene.portalItemProperties.access)this.ShareMessageText.innerHTML=
z.share.shareNotPublic,d.add(this.ShareMessage,"show"),d.add(this.ChangeSettingsLink,"show");else{for(a=0;a<this.view.map.layers.get("length");a++){var b=this.view.map.layers.getItemAt(a);if(m.exists("_websceneEditorProperties.portalLayerItem.item",b)&&"public"!==b._websceneEditorProperties.portalLayerItem.item.access){this.ShareMessageText.innerHTML=z.share.shareNotPublicLayer;d.add(this.ShareMessage,"show");d.remove(this.ChangeSettingsLink,"show");return}}this.ShareMessageText.innerHTML="";d.remove(this.ShareMessage,
"show")}else this.ShareMessageText.innerHTML="",d.remove(this.ShareMessage,"show")},setUnsavedSceneChanges:function(a){this._unsavedSceneChanges=a;0<this.domNode.offsetHeight&&this.updateShareMessage()}})})},"webSceneViewer/webScene/Presentation":function(){define("esri/core/declare esri/core/lang esri/Viewpoint esri/core/Collection esri/views/3d/lib/glMatrix webSceneViewer/basemapUtils webSceneViewer/environmentUtils webSceneViewer/mapUtils webSceneViewer/assertUtils".split(" "),function(k,m,d,q,
c,g,h,l,b){var f=b.assert,n=c.vec3d,s=k(null,{declaredClass:"webScene.Presentation",slides:void 0,constructor:function(){this.slides=new q},toJSON:function(){for(var a={slides:[]},b=this.slides.getAll(),c=0;c<b.length;c++)a.slides[c]=s.slideToJson(b[c]);return m.fixJson(a)},addSlide:function(a){this.slides.addItem(a)},removeSlide:function(a){return"number"===typeof a?(f(a<this.slides.get("length")),this.slides.removeItemAt(a)):"object"===typeof a?this.slides.removeItem(a):null},removeSlideById:function(a){for(var b=
0;b<this.slides.items.length;b++)if(this.slides.items[b].id===a)return this.removeSlide(b);return null},getNewSlideId:function(){for(var a=1,b="slide_"+a.toString(),c=[],d=0;d<this.slides.items.length;d++)c[this.slides.items[d].id]=1;for(;c[b];)a++,b="slide_"+a.toString();return b},updateUniqueSlideIds:function(a){if(0!==a.length){for(var b=[],c=[],d=0;d<a.items.length;d++)c[a.items[d].id]=1;for(a=0;a<this.slides.length;a++){var d=this.slides.items[a],f=d.id,h=f.match(/(slide_)(\d+)$/),g;h?(g=h[1],
h=parseInt(h[2],10)):(g=f+"_",h=0);for(;c[f]||b[f];)h++,f=g+h.toString();b[f]=1;f!==d.id&&(d.id=f)}}},updateSlideDetails:function(a,b){var c=this.slides.getItemAt(a);b.title={text:c.title.text};b.description.text=c.description.text;b.id=c.id;this.slides.removeItemAt(a);this.slides.addItem(b,a)},moveSlide:function(a,b){var c;this.slides.getAll().forEach(function(b,d){b.id===a&&(c=b)});c&&this.slides.moveItem(c,b)}}),x=null;s.applySlideToView=function(a,b){var c=d.fromJSON(a.viewpoint).camera;c.fov=
b.get("camera").fov;if(a.environment&&a.environment.lighting&&null!=a.environment.lighting.date){var f=new Date(b.environment.lighting.date),k=f.getTime(),s=60*(60*f.getUTCHours()+f.getUTCMinutes())+f.getUTCSeconds(),m=a.environment.lighting.date,A=m.getTime(),q=60*(60*m.getUTCHours()+m.getUTCMinutes())+m.getUTCSeconds(),I=new Date,G=b.renderCoordsHelper,J=[0,0,0];G.toRenderCoords(b.camera.position,J);var C=[0,0,0];G.toRenderCoords(c.position,C);var K=[0,0,0],Q=b.watch("camera",function(a){G.toRenderCoords(a.position,
K);var c=n.dist2(J,K),d=n.dist2(C,K);a=0;0!==c+d&&(a=c/(c+d));c=s+(q-s)*a;I.setTime(k+(A-k)*a);I.setUTCHours(c/3600);I.setUTCMinutes(c%3600/60);I.setUTCSeconds(c%3600%60);b.environment.lighting.date=I});x&&(x.stop(),x=null);b.environmentManager.autoAdjustTimezone=!1;b.environment.lighting=h.clone(a.environment).lighting;b.environment.lighting.date=f;x=b.animateTo(c);x.then(function(c){Q.remove();"finished"===c.state&&(b.environment.lighting=h.clone(a.environment).lighting);x===c&&(b.environmentManager.autoAdjustTimezone=
!0)})}else h.applyToView(a.environment,b),b.animateTo(c);if(a.visibleLayers){c=[];for(f=0;f<a.visibleLayers.length;f++)c.push(a.visibleLayers[f].id);l.setVisibleLayerList(b.map,c)}a.baseMap&&g.setFromJSON(b,a.baseMap,!0)};s.fromJSON=function(a){var b=new s;if(a&&a.slides&&a.slides.length)for(var c=0;c<a.slides.length;c++){var d=a.slides[c];d.environment&&(d.environment=h.fromJSON(d.environment));d.baseMap&&d.baseMap.elevationLayers&&delete d.baseMap.elevationLayers;d.visibleLayers||(d.visibleLayers=
[]);b.addSlide(d)}return b};s.slideToJson=function(a){var b={id:a.id,title:a.title,thumbnail:a.thumbnail,description:a.description,baseMap:a.baseMap,viewpoint:a.viewpoint,visibleLayers:a.visibleLayers};a.environment&&(b.environment=h.toJSON(a.environment));return m.fixJson(b)};return s})},"esri/widgets/Search":function(){define("require ../core/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/keys dojo/on dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/i18n!../nls/jsapi dojo/text!./Search/templates/Search.html dijit/_TemplatedMixin dijit/_FocusMixin dijit/a11yclick dijit/focus ./Widget ../core/lang ./../PopupTemplate ../geometry/SpatialReference ../Graphic ../core/promiseList ../symbols/PictureMarkerSymbol ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/TextSymbol ../symbols/Font ../geometry/Point ../geometry/Extent ../geometry/support/scaleUtils ../tasks/Locator ../tasks/support/Query ../layers/GraphicsLayer ../Color ../styles/basic".split(" "),
function(k,m,d,q,c,g,h,l,b,f,n,s,x,a,r,z,t,w,B,H,A,O,I,G,J,C,K,Q,N,F,R,M,U,L,p,y,v,S){return m([B,r,z],{declaredClass:"esri.widgets.Search",templateString:a,reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,constructor:function(e){this.css={root:"esri-search",searchGroup:"esri-container",visible:"esri-visible",searchInput:"esri-input",searchInputGroup:"esri-input-container",searchBtn:"esri-search-button",searchSubmit:"esri-submit",searchIcon:"esri-icon esri-icon-search",searchButtonText:"esri-icon-font-fallback-text",
searchToggle:"esri-toggle",searchToggleIcon:"esri-icon esri-icon-down-arrow",searchMenu:"esri-menu",searchMenuHeader:"esri-header",searchClear:"esri-clear",searchClearIcon:"esri-icon esri-icon-close esri-close",searchSpinner:"esri-icon esri-icon-loading-indicator esri-rotating",searchSourceName:"esri-source-name",suggestionsMenu:"esri-suggest-menu",sourcesMenu:"esri-source-menu",activeSource:"esri-active",hasValue:"esri-has-value",hasButtonMode:"esri-has-button-mode",hasMultipleSources:"esri-has-multiple-sources",
showSuggestions:"esri-show-suggestions",showSources:"esri-show-sources",showNoResults:"esri-show-no-results",searchLoading:"esri-search-loading",latLonHeader:"esri-lat-long-header",searchMoreResults:"esri-more-results",searchMoreResultsList:"esri-results-list",searchMoreResultsHeader:"esri-more-header",searchMoreResultsItem:"esri-more-item",searchMoreResultsListHeader:"esri-popup-header",searchShowMoreResults:"esri-show-more-results",searchNoResultsMenu:"esri-no-results-menu",searchNoResultsBody:"esri-no-results-body",
searchNoResultsHeader:"esri-no-results-header",searchNoValueIcon:"esri-no-value-icon esri-icon-notice-triangle",searchNoValueText:"esri-no-value-text",searchNoResultsText:"esri-no-results-text",searchExpandContainer:"esri-expand-container",searchAnimateContainer:"esri-animate",searchExpanded:"esri-expanded",searchCollapsed:"esri-collapsed",searchClearFloat:"esri-clearfix"};this._allIndex="all";this._objectIdIdentifier="_objectId";this._deferreds=[];this.defaultSource={locator:new L("//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"),
singleLineFieldName:"SingleLine",outFields:["Addr_type","Match_addr","StAddr","City"],name:x.widgets.Search.esriLocatorName,localSearchOptions:{minScale:3E5,distance:5E4},placeholder:x.widgets.Search.placeholder,highlightSymbol:(new J(k.toUrl("./Search/images/search-pointer.png"),36,36)).set({xoffset:9,yoffset:18})};this.options={view:null,visible:!0,value:"",allPlaceholder:"",sources:[this.defaultSource],activeSourceIndex:0,suggestionDelay:150,enableSourcesMenu:!0,enableSuggestionsMenu:!0,enablePopup:!0,
showPopupOnSelect:!0,enableSuggestions:!0,enableButtonMode:!1,autoNavigate:!0,autoSelect:!0,addLayersFromMap:!1,zoomScale:1E3,graphicsLayer:null,enableHighlight:!0,highlightGraphic:null,enableLabel:!1,labelSymbol:(new N).set("color",new v([181,56,46,0.9])).set("font",new F("14px",F.STYLE_NORMAL,F.VARIANT_NORMAL,F.WEIGHT_BOLD,"Arial")),labelGraphic:null,popupTemplate:new A({title:x.widgets.Search.searchResult,content:'\x3cdiv class\x3d"${searchTheme}"\x3e\x3cdiv id\x3d"${searchMoreResultsId}" class\x3d"${searchMoreResults}"\x3e\x3cdiv class\x3d"${searchMoreResultsItem}"\x3e${searchResult}\x3c/div\x3e\x3cdiv\x3e${searchMoreResultsHtml}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'}),
searchResults:null,suggestResults:null,selectedResult:null,expanded:!1,maxLength:128,maxResults:6,maxSuggestions:6,locationToAddressDistance:1500,minCharacters:1,enableSearchingAll:!0};e=d.mixin({},this.options,e);this.set(e);this._updateActiveSource();this._i18n=x.widgets.Search;this._defaultSR=O.WGS84},activeSource:null,activeSourceIndex:0,addLayersFromMap:!1,allPlaceholder:"Find address or place",autoNavigate:!0,autoSelect:!0,enableButtonMode:!1,enableHighlight:!0,enableLabel:!1,enablePopup:!0,
enableSourcesMenu:!0,enableSearchingAll:!0,defaultSource:"ArcGIS Online Geocoding service",enableSuggestions:!0,enableSuggestionsMenu:!0,expanded:!1,graphicsLayer:null,highlightGraphic:null,labelGraphic:null,labelSymbol:(new N).set("color",new v([181,56,46,0.9])).set("font",new F("14px",F.STYLE_NORMAL,F.VARIANT_NORMAL,F.WEIGHT_BOLD,"Arial")),loaded:null,maxLength:128,maxResults:6,maxSuggestions:6,minCharacters:1,popupTemplate:new A({title:x.widgets.Search.searchResult,content:'\x3cdiv class\x3d"${searchTheme}"\x3e\x3cdiv id\x3d"${searchMoreResultsId}" class\x3d"${searchMoreResults}"\x3e\x3cdiv class\x3d"${searchMoreResultsItem}"\x3e${searchResult}\x3c/div\x3e\x3cdiv\x3e${searchMoreResultsHtml}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'}),
searchResults:null,selectedResult:null,showPopupOnSelect:!0,sources:[this.defaultSource],suggestResults:null,suggestionDelay:150,value:"",visible:!0,view:null,zoomScale:1E3,startup:function(){this.inherited(arguments);this.sources||(this.sources=[]);var e=[],a=this._getMap();a&&e.push(a);this.view&&e.push(this.view);e.length?G(e).always(function(){this._init()}.bind(this)):this._init()},postCreate:function(){var e=this;this.inherited(arguments);this._moreResultsId=this.id+"_more_results";this.own(h(this.submitNode,
t,this._searchButton.bind(this)));this.own(h(this.sourcesBtnNode,t,this._toggleSourcesMenu.bind(this)));this.own(h(this.inputNode,t,this._inputClick.bind(this)));this.own(h(this.clearNode,t,this._clearButton.bind(this)));this.own(h(this.formNode,"submit",function(e){e.preventDefault();this._cancelSuggest();this.search()}.bind(this)));this.own(h(this.inputNode,"keyup",function(e){this._inputKey(e)}.bind(this)));this.own(h(this.sourcesBtnNode,"keyup",function(e){this._sourceBtnKey(e)}.bind(this)));
this.own(h(this.suggestionsNode,"li:click, li:keyup",function(a){e._suggestionsEvent(a,this)}));this.own(h(this.sourcesNode,"li:click, li:keyup",function(a){e._sourcesEvent(a,this)}));this.own(h(this.inputNode,"input, paste",function(){this._suggestDelay()}.bind(this)));if(this.view){var a=this.view.popup;a&&(a.domNode&&this.enablePopup)&&(this.own(h(a.domNode,"#"+this._moreResultsId+"_show:click",function(e){this._showMoreResultsClick(e)}.bind(this))),this.own(h(a.domNode,"#"+this._moreResultsId+
"_list li a:click",function(e){this._moreResultsClick(e)}.bind(this))),this.own(h(a.domNode,"#"+this._moreResultsId+" [data-switch-coordinates]:click",function(e){this._switchCoordinatesClick(e)}.bind(this))))}this.value&&this._checkStatus();this._hideMenus();this._visible();this._insertSources(this.sources);this._setPlaceholder(this.activeSourceIndex);this._updateButtonMode(this.enableButtonMode);this._expanded()},destroy:function(){if(this.graphicsLayer&&this.get("view")){var e=this.view.get("map");
e&&e.remove(this.graphicsLayer)}s.empty(this.domNode);this.inherited(arguments)},clear:function(){this.clearGraphics();f.get(this.inputNode,"value")&&f.set(this.inputNode,"value","");this._changeAttrValue("value","");this.set("searchResults",null);this.set("suggestResults",null);this.set("selectedResult",null);n.remove(this.containerNode,this.css.hasValue);f.set(this.clearNode,"title","");this._hideMenus();this._closePopup();this._hideLoading();this.emit("clear-search")},search:function(e){var a=
new c;this._mapLoaded().then(function(){this._searchDeferred(e).then(function(e){var b=e.results;this.set("searchResults",b);0===e.numResults&&(this._noResults(e.value),this._showNoResultsMenu());this._hideLoading();this.emit("search-results",e);this._selectFirstResult(b,e.activeSourceIndex);a.resolve(b)}.bind(this),function(e){a.reject(e)})}.bind(this));return a.promise},suggest:function(e){var a=new c;this._mapLoaded().then(function(){this._suggestDeferred(e).then(function(e){if(e){var b=e.results;
this.set("suggestResults",b);this._insertSuggestions(b,e.value);this.emit("suggest-results",e);a.resolve(b)}}.bind(this),function(e){a.reject(e)})}.bind(this));return a.promise},select:function(e){var a=this._getDefaultSymbol(e),b=this.labelSymbol,c,p=this.sources,f=this.activeSourceIndex,h=this.enableHighlight,g=this.enableLabel,v=this.autoNavigate,y=this.showPopupOnSelect,r=this.enablePopup,l=this.popupTemplate,n=I.fromJSON(e.feature.toJSON());if(f===this._allIndex){var k=this._getSourceIndexOfResult(e);
null!==k&&(c=p[k],f=k)}else c=p[f];c&&(c.hasOwnProperty("highlightSymbol")&&(a=c.highlightSymbol),c.hasOwnProperty("labelSymbol")&&(b=c.labelSymbol),c.hasOwnProperty("enableHighlight")&&(h=c.enableHighlight),c.hasOwnProperty("enableLabel")&&(g=c.enableLabel),c.hasOwnProperty("autoNavigate")&&(v=c.autoNavigate),c.hasOwnProperty("showPopupOnSelect")&&(y=c.showPopupOnSelect),c.hasOwnProperty("enablePopup")&&(r=c.enablePopup),c.hasOwnProperty("popupTemplate")?l=c.popupTemplate:c.featureLayer&&c.featureLayer.popupTemplate&&
(l=c.featureLayer.popupTemplate));this._hideMenus();this._hideLoading();if(n){var p=this.highlightGraphic,k=this.graphicsLayer,s=this.labelGraphic,t=d.mixin({},n.attributes,{searchTheme:this.css.root,searchResult:this._searchResultHTML(e),searchMoreResults:this.css.searchMoreResults,searchMoreResultsItem:this.css.searchMoreResultsItem,searchMoreResultsId:this._moreResultsId,searchMoreResultsHtml:this._moreResultsHTML(e)}),S=null;r&&(S=l);s?(s.set("geometry",n.geometry),s.set("attributes",t),s.set("symbol",
b)):(s=new I(n.geometry,b,t),g&&k&&k.add(s));s&&(s.symbol&&"textsymbol"===s.symbol.type)&&s.symbol.set("text",e.name);p?(p.set("geometry",n.geometry),p.set("attributes",t),p.set("popupTemplate",S),p.set("symbol",a)):(p=new I(n.geometry,a,t,S),h&&k&&k.add(p));p&&(p.symbol&&"textsymbol"===p.symbol.type)&&p.symbol.set("text",e.name);var w=null;if(this.view&&this.view.popup&&r&&y){w=this.view.popup;w.setFeatures([p]);var m=this._getPointFromGeometry(p.geometry);m&&w.show(m)}this.view&&(v&&e&&e.hasOwnProperty("extent"))&&
this.view.animateTo(e.extent).then(function(){w&&w.show(m)});this.set("highlightGraphic",p);this.set("labelGraphic",s)}this.set("selectedResult",e);this.emit("select-result",{result:e,source:c,sourceIndex:f})},focus:function(){w.focus(this.inputNode)},blur:function(){w.curNode&&w.curNode.blur()},clearGraphics:function(){var e=this.highlightGraphic,a=this.graphicsLayer,b=this.labelGraphic;e&&a&&a.remove(e);b&&a&&a.remove(b);this.set("labelGraphic",null);this.set("highlightGraphic",null)},_clearButton:function(){this.clear();
w.focus(this.inputNode)},_getMap:function(){var e;this.view&&(e=this.view.get("map"));return e},_init:function(){var e=this.get("graphicsLayer");if(!e&&(e=new y,this.set("graphicsLayer",e),this.get("view"))){var a=this.view.get("map");a&&a.add(e)}this._getMapLayers().then(function(){this.set("loaded",!0);this.emit("load")}.bind(this))},_error:function(e){return Error(this.declaredClass+" "+e)},_searchDeferred:function(e){var a=new c,b=this.value,d=this.activeSourceIndex;e&&e.hasOwnProperty("index")&&
(d=e.index);this._showLoading();this._hideMenus();this._closePopup();this.clearGraphics();(e?"string"===typeof e?this._searchQueries({text:e}):"object"===typeof e&&e.hasOwnProperty("magicKey")?this._searchQueries(e):"object"===typeof e&&e.hasOwnProperty("geometry")?this._searchQueries({geometry:e}):"object"===typeof e&&e.hasOwnProperty(this._objectIdIdentifier)?this._searchQueries(e):"object"===typeof e&&"point"===e.type?this._searchQueries({point:e}):e instanceof Array&&2===e.length?this._searchQueries({latlon:e}):
this._searchQueries({text:b}):this._searchQueries({text:b})).always(function(e){e=this._formatResults(e,d,b);a.resolve(e)}.bind(this));return a.promise},_mapLoaded:function(){var e=new c;this.view&&this.view.map?this.view.map.then(function(){e.resolve()}):e.resolve();return e.promise},_suggestDeferred:function(e){var a=new c;this._deferreds.push(a);e||(e=this.value);var b=this.activeSourceIndex;this._suggestQueries({text:e}).always(function(c){var d;if(c)for(var p=0;p<c.length;p++)c[p]&&(d=!0);d?
(c=this._formatResults(c,b,e),a.resolve(c)):a.resolve()}.bind(this));return a.promise},_getDefaultSymbol:function(e){var a,b,c,d,p;if(d=this._getMap())if(d=d.get("basemap"))p=d.id;p||(p="topo");e&&(e.feature&&e.feature.geometry)&&(c=e.feature.geometry.type);if(c){if(e=S.getSchemes({theme:"default",basemap:p,geometryType:c}))b=e.primaryScheme;if(b){b.color&&b.hasOwnProperty("opacity")&&(b.color.a=b.opacity);a=b;e=b.color;b=b.size;var f;switch(c){case "point":f=new C;f.set("color",e);f.set("size",null!==
b?b:a.size);c=new K;c.set("color",a.outline.color);c.set("width",a.outline.width);f.set("outline",c);break;case "line":f=new K;f.set("color",e);f.set("width",null!==b?b:a.width);break;case "polygon":f=new Q,f.set("color",e),c=new K,c.set("color",a.outline.color),c.set("width",a.outline.width),f.set("outline",c)}a=f}}return a},_selectFirstResult:function(e,a){if(this.autoSelect&&e){var b;a===this._allIndex?b=this._getFirstResult(e):e[a]&&e[a][0]&&(b=e[a][0]);b&&this.select(b)}},_getSourceIndexOfResult:function(e){var a=
this.searchResults;if(a)for(var b in a)if(a[b]&&a[b].length)for(var c=0;c<a[b].length;c++)if(a[b][c]===e)return parseInt(b,10);return null},_getFirstResult:function(e){if(e)for(var a in e)if(e[a]&&e[a][0])return e[a][0];return!1},_onFocus:function(){this.emit("focus");this.inherited(arguments)},_onBlur:function(){this._hideMenus();this.enableButtonMode&&this.loaded&&this.set("expanded",!1);this.emit("blur");this.inherited(arguments)},_getMapLayers:function(){var e=new c,a=this._getMap();if(this.addLayersFromMap&&
a){var b=[];(b=a.get("layers").getAll())&&b.length?G(b).always(function(a){for(var b,c=this.sources,d=0;d<a.length;d++)a[d].loaded&&(a[d].type&&"Feature Layer"===a[d].type)&&(c.push({featureLayer:a[d],enableSuggestions:!0}),b=!0);b&&this.set("sources",c);e.resolve()}.bind(this)):e.resolve()}else e.resolve();return e.promise},_switchCoordinatesClick:function(e){e.preventDefault();if(e=f.get(e.target,"data-switch-coordinates"))this._cancelSuggest(),this.set("value",e),this.search()},_moreResultsClick:function(e){e.preventDefault();
var a=e.target;e=parseInt(f.get(a,"data-source-index"),10);var a=parseInt(f.get(a,"data-index"),10),b=this.searchResults;b&&b[e]&&(e=b[e][a])&&this.select(e)},_showMoreResultsClick:function(e){e.preventDefault();if(e=b.byId(this._moreResultsId)){n.toggle(e,this.css.searchShowMoreResults);var a=b.byId(this._moreResultsId+"_show");a&&(n.contains(e,this.css.searchShowMoreResults)?f.set(a,"textContent",x.widgets.Search.hideMoreResults):f.set(a,"textContent",x.widgets.Search.showMoreResults))}},_getObjectSize:function(e){var a=
0,b;for(b in e)e.hasOwnProperty(b)&&a++;return a},_sourcesEvent:function(e,a){var b=f.get(a,"data-index"),c=l("li",this.sourcesNode),d=q.indexOf(c,a);b!==this._allIndex&&(b=parseInt(b,10));"click"===e.type||e.keyCode===g.ENTER?(this.set("activeSourceIndex",b),w.focus(this.inputNode),this._hideSourcesMenu()):e.keyCode===g.UP_ARROW?(e.stopPropagation(),e.preventDefault(),b=d-1,0>b?w.focus(this.sourcesBtnNode):w.focus(c[b])):e.keyCode===g.DOWN_ARROW?(e.stopPropagation(),e.preventDefault(),b=d+1,b>=c.length?
w.focus(this.sourcesBtnNode):w.focus(c[b])):e.keyCode===g.ESCAPE&&(this._hideSourcesMenu(),w.focus(this.inputNode))},_suggestionsEvent:function(e,a){var b=f.get(a,"data-source-index"),c=parseInt(f.get(a,"data-index"),10),d=l("li",this.suggestionsNode),p=this.sources,h=q.indexOf(d,a);b!==this._allIndex&&(b=parseInt(b,10));this._clearQueryTimeout();if("click"===e.type||e.keyCode===g.ENTER){var d=this.suggestResults,v;d&&(d[b]&&d[b][c])&&(v=d[b][c]);v&&(v.index=b,p[b].featureLayer&&(v[this._objectIdIdentifier]=
v.feature.attributes[p[b].featureLayer.objectIdField]),this.search(v),w.focus(this.inputNode))}else e.keyCode===g.BACKSPACE||e.keyCode===g.DELETE?w.focus(this.inputNode):e.keyCode===g.UP_ARROW?(e.stopPropagation(),e.preventDefault(),b=h-1,0>b?w.focus(this.inputNode):w.focus(d[b])):e.keyCode===g.DOWN_ARROW?(e.stopPropagation(),e.preventDefault(),b=h+1,b>=d.length?w.focus(this.inputNode):w.focus(d[b])):e.keyCode===g.ESCAPE&&(this._hideMenus(),w.focus(this.inputNode))},_getResultName:function(e){var a;
e.hasOwnProperty("name")&&null!==e.name&&(a=e.name.toString());a||(a=x.widgets.Search.untitledResult);return a},_getSuggestionName:function(e){var a;e.hasOwnProperty("name")&&(a=e.name.toString());e=e.text||a;e||(e=x.widgets.Search.untitledResult);return e},_searchResultHTML:function(e){var a="";if(e.feature&&e.feature.attributes&&e.feature.attributes.Addr_type&&"LatLong"===e.feature.attributes.Addr_type){var b=e.name.split(" "),c,d;2===b.length&&(c=b[0],d=b[1]);if(d&&c){if(e=parseFloat(c),d=parseFloat(d),
b=d+", "+e,a+='\x3cdiv class\x3d"'+this.css.searchMoreResultsItem+'"\x3e',a+='\x3cdiv class\x3d"'+this.css.latLonHeader+'"\x3e'+x.widgets.Search.lonlat+"\x3c/div\x3e",a+=e+", "+d,a=a+"\x3c/div\x3e"+('\x3cdiv class\x3d"'+this.css.searchMoreResultsItem+'"\x3e'),e!==d&&!(90<e||-90>e||180<d||-180>d))a+='\x3cdiv class\x3d"'+this.css.latLonHeader+'"\x3e'+x.widgets.Search.reverseLonLatHeader+"\x3c/div\x3e",a+='\x3ca data-switch-coordinates\x3d"'+b+'" tabindex\x3d"0" href\x3d"#"\x3e'+b+"\x3c/a\x3e",a+="\x3c/div\x3e"}else a=
e.name}else a=e.name;return a},_moreResultsHTML:function(e){var a="",b="",c=this.searchResults,d=this.sources,p=0;if(c){var b=b+('\x3cdiv class\x3d"'+this.css.searchMoreResultsItem+'"\x3e'),b=b+('\x3ca href\x3d"#" id\x3d"'+this._moreResultsId+'_show"\x3e'+x.widgets.Search.showMoreResults+"\x3c/a\x3e"),b=b+"\x3c/div\x3e"+('\x3cdiv class\x3d"'+this.css.searchMoreResultsList+'"\x3e'),b=b+('\x3cdiv id\x3d"'+this._moreResultsId+'_list"\x3e'),f;for(f in c)if(c[f]){var h=c[f].length;if(h){var g=1===h&&c[f][0]===
e;if(1<this._getObjectSize(c)&&!g)var v=this._getSourceName(f),b=b+('\x3cdiv class\x3d"'+this.css.searchMoreResultsListHeader+'"\x3e'+v+"\x3c/div\x3e");if(h&&!g){b+="\x3cul\x3e";v=d[f].maxResults||this.maxResults;for(g=0;g<h&&g<v;++g)if(c[f][g]!==e){var y=this._getResultName(c[f][g]),b=b+('\x3cli\x3e\x3ca tabindex\x3d"0" data-index\x3d"'+g+'" data-source-index\x3d"'+f+'" href\x3d"#"\x3e'+y+"\x3c/a\x3e\x3c/li\x3e");p++}b+="\x3c/ul\x3e"}}}b+="\x3c/div\x3e";b+="\x3c/div\x3e"}p&&(a+=b);return a},_validField:function(e,
a){return e.getField(a)},_validFields:function(e,a){if(e&&a&&a.length){for(var b=0;b<a.length;b++)if(!this._validField(e,a[b]))return!1;return!0}return!1},_getCodedName:function(e,a){if(e&&e.length)for(var b=0,c=e.length;b<c;b++){var d=e[b];if(d.code===a)return d.name}},_getCodedValue:function(a,b,c){if(a&&a.length)for(var d=0,p=a.length;d<p;d++){var f=a[d],h=f.name,g=b;c||(h=h.toLowerCase(),g=g.toLowerCase());if(h===g)return f.code}return!1},_whereClause:function(a,b,c,d){var p=null;if(a){var f=
"";this.reHostedFS.test(b.url)&&this._containsNonLatinCharacter(a)&&(f="N");if(c&&c.length)for(var h=0,g=c.length;h<g;h++){var v="",y=a,v=c[h],r=b.getField(v),l=b.getDomain(v);l&&"codedValue"===l.type&&(y=this._getCodedValue(l.codedValues,y,d));y&&(r=r.type,"esriFieldTypeString"===r||"esriFieldTypeDate"===r?v=d?v+" \x3d "+f+"'"+y+"'":"UPPER("+v+") LIKE "+f+"'%"+y.toUpperCase()+"%'":"esriFieldTypeSmallInteger"===r||"esriFieldTypeInteger"===r||"esriFieldTypeSingle"===r||"esriFieldTypeDouble"===r?(y=
parseFloat(y),v=isNaN(y)?!1:v+" \x3d "+y):v=v+" \x3d "+y,v&&(p=p?p+" or ":"",p+=v))}}return p},_suggest:function(a){a||(a={index:this.activeSourceIndex,text:this.value});var b=new c,f=a.index,h=this.sources[f],g=this.enableSuggestions;h.hasOwnProperty("enableSuggestions")&&(g=h.enableSuggestions);var v=0,y;a.hasOwnProperty("text")&&a.text&&(y=d.trim(a.text),v=a.text.length);a=h.minCharacters||this.minCharacters;if(g&&y&&v>=a&&this._supportsPagination(h)){var r="";h.prefix&&(r+=h.prefix);r+=y;h.suffix&&
(r+=h.suffix);var l=this._defaultSR;if(g=this._getMap())l=g.spatialReference;g={};if(h.locator){h.categories&&(g.categories=h.categories);h.locator.outSpatialReference=l;if(this.view&&(h.localSearchOptions&&h.localSearchOptions.hasOwnProperty("distance")&&h.localSearchOptions.hasOwnProperty("minScale"))&&(v=this._getScale(),!h.localSearchOptions.minScale||v&&v<=parseFloat(h.localSearchOptions.minScale)))g.location=this.view.get("extent").get("center"),g.distance=h.localSearchOptions.distance;g.text=
r;h.useMapExtent&&(this.view&&this.view.extent)&&(g.searchExtent=this.view.extent);h.searchExtent&&(g.searchExtent=h.searchExtent);g.maxSuggestions=h.maxSuggestions||this.maxSuggestions;h.sourceCountry&&(g.countryCode=h.sourceCountry);h.countryCode&&(g.countryCode=h.countryCode);h.locator.suggestLocations(g).then(function(a){b.resolve(a)},function(a){a||(a=this._error("Locator suggestLocations could not be performed."));b.reject(a)}.bind(this))}else h.featureLayer?h.featureLayer.then(function(){var a=
this._getDisplayField(h),e=h.searchFields||[a],c=[];h.suggestionTemplate?(h.suggestionTemplate.replace(/(?:\$\{([^}]+)\})/g,function(a,e){c.push(e)}),-1===q.indexOf(c,h.featureLayer.objectIdField)&&c.push(h.featureLayer.objectIdField)):c=[a,h.featureLayer.objectIdField];var a=this._validField(h.featureLayer,a),g=this._validFields(h.featureLayer,c),v=this._validFields(h.featureLayer,e);if(!a||!g||!v)b.reject(this._error("Invalid FeatureLayer field"));else{a=new p;h.hasOwnProperty("suggestQueryParams")&&
d.mixin(a,h.suggestQueryParams);a.outSpatialReference=l;a.returnGeometry=!1;a.num=h.maxSuggestions||this.maxSuggestions;a.outFields=c;h.useMapExtent&&(this.view&&this.view.extent)&&(a.geometry=this.view.extent);h.searchExtent&&(a.geometry=h.searchExtent);var y;if(e=this._whereClause(r,h.featureLayer,e,!1))a.where=e,y=!0;y?h.featureLayer.queryFeatures(a,function(a){var e;(a=a.features)&&(e=this._hydrateResults(a,f,!0));b.resolve(e)}.bind(this),function(a){a||(a=this._error("FeatureLayer queryFeatures errored with suggestions"));
b.reject(a)}.bind(this)):b.resolve()}}.bind(this)):b.reject(this._error("Invalid source"))}else b.resolve();return b.promise},_supportsPagination:function(a){var b;a.locator?b=!0:a.featureLayer&&a.featureLayer.advancedQueryCapabilities&&a.featureLayer.advancedQueryCapabilities.supportsPagination&&(b=!0);return b},_suggestQueries:function(a){var b=this.sources,c=this.activeSourceIndex,d=[],p;if(c===this._allIndex)for(c=0;c<b.length;c++)p=a,p.index=c,p=this._suggest(p),d.push(p);else a.index=c,p=this._suggest(a),
d.push(p);return G(d)},_expanded:function(){this.enableButtonMode&&(this.expanded?(n.add(this.containerNode,this.css.searchExpanded),n.remove(this.containerNode,this.css.searchCollapsed)):(n.remove(this.containerNode,this.css.searchExpanded),n.add(this.containerNode,this.css.searchCollapsed)));this._hideMenus()},_getPointFromGeometry:function(a){var b;if(a)switch(a.type){case "extent":b=a.get("center");break;case "multipoint":b=a.get("extent").get("center");break;case "point":b=a;break;case "polygon":b=
a.get("extent").get("center");break;case "polyline":b=a.get("extent").get("center")}return b},_searchQueries:function(a){a.hasOwnProperty("index")||(a.index=this.activeSourceIndex);var b=[],c;if(a.index===this._allIndex)for(var d=this.sources,p=0;p<d.length;p++)c=a,c.index=p,c=this._search(c),b.push(c);else a=this._search(a),b.push(a);return G(b)},_searchButton:function(){this.enableButtonMode&&!this.expanded?(this.set("expanded",!0),w.focus(this.inputNode)):(this._cancelSuggest(),this.search())},
_search:function(a){a||(a={text:this.value,magicKey:null,geometry:null,point:null,index:this.activeSourceIndex,latlon:null});var b,f=new c,h=a.index,g=this.sources[h],v;a.hasOwnProperty("text")&&a.text&&(v=d.trim(a.text));if(g){var y="";g.prefix&&!a.magicKey&&(y+=g.prefix);y+=v;g.suffix&&!a.magicKey&&(y+=g.suffix);var r=this._defaultSR,l=this._getMap();l&&(r=l.spatialReference);if(g.locator)if(a.hasOwnProperty("text")&&v){l={};g.categories&&(l.categories=g.categories);r&&(g.locator.outSpatialReference=
r);if(this.view&&g.localSearchOptions&&g.localSearchOptions.hasOwnProperty("distance")&&g.localSearchOptions.hasOwnProperty("minScale")){var n=this._getScale();if(!g.localSearchOptions.minScale||n&&n<=parseFloat(g.localSearchOptions.minScale))l.location=this.view.get("extent").get("center"),l.distance=g.localSearchOptions.distance}l.address={};l.maxLocations=g.maxResults||this.maxResults;g.useMapExtent&&(this.view&&this.view.extent)&&(l.searchExtent=this.view.extent);g.searchExtent&&(l.searchExtent=
g.searchExtent);g.sourceCountry&&(l.countryCode=g.sourceCountry);g.countryCode&&(l.countryCode=g.countryCode);a.magicKey&&(l.magicKey=a.magicKey);g.singleLineFieldName?l.address[g.singleLineFieldName]=y:l.address["Single Line Input"]=y;g.outFields&&(l.outFields=g.outFields);g.locator.addressToLocations(l).then(function(a){a=this._hydrateResults(a,h,!1);f.resolve(a)}.bind(this),function(a){a||(a=this._error("Locator addressToLocations could not be performed"));f.reject(a)}.bind(this))}else a.geometry?
(b=this._getPointFromGeometry(a.geometry.geometry))?this._reverseGeocodePoint(h,b).then(function(a){f.resolve(a)},function(a){f.reject(a)}):f.reject(this._error("Invalid point to reverse geocode")):a.point?this._reverseGeocodePoint(h,a.point).then(function(a){f.resolve(a)},function(a){f.reject(a)}):a.latlon?(l=new R(a.latlon,this._defaultSR),this._reverseGeocodePoint(h,l).then(function(a){f.resolve(a)},function(a){f.reject(a)})):a.hasOwnProperty("text")&&!v?f.resolve([]):f.reject(this._error("Invalid query type for Locator"));
else g.featureLayer?g.featureLayer.then(function(){var c=this._getDisplayField(g),l=g.searchFields||[c],c=this._validField(g.featureLayer,c),n=this._validFields(g.featureLayer,l);if(!c||!n)f.reject(this._error("Invalid FeatureLayer field"));else{c=new p;g.hasOwnProperty("searchQueryParams")&&d.mixin(c,g.searchQueryParams);if(r&&(c.outSpatialReference=r,n=U.getUnitValueForSR(r)))c.maxAllowableOffset=n;c.returnGeometry=!0;g.outFields&&(c.outFields=g.outFields);var k;a.hasOwnProperty(this._objectIdIdentifier)||
(this._supportsPagination(g)&&(c.num=g.maxResults||this.maxResults),g.useMapExtent&&(this.view&&this.view.extent)&&(c.geometry=this.view.extent),g.searchExtent&&(c.geometry=g.searchExtent),k=g.exactMatch);a.hasOwnProperty("text")&&v?(l=this._whereClause(y,g.featureLayer,l,k))?(c.where=l,l=!0):l=!1:a.hasOwnProperty(this._objectIdIdentifier)?(c.objectIds=[a[this._objectIdIdentifier]],l=!0):a.geometry?(c.geometry=a.geometry,l=!0):a.point?(c.geometry=a.point,l=!0):a.latlon?(b=new R(a.latlon,this._defaultSR),
c.geometry=b,l=!0):(a.hasOwnProperty("text")&&!v?f.resolve([]):f.reject(this._error("Invalid query type for FeatureLayer")),l=!1);l?g.featureLayer.queryFeatures(c,function(a){a=a.features;var e;a&&(e=this._hydrateResults(a,h,!1));f.resolve(e)}.bind(this),function(a){a||(a=this._error("FeatureLayer queryFeatures could not be performed"));f.reject(a)}.bind(this)):f.resolve()}}.bind(this)):f.reject(this._error("Invalid source"))}else f.reject(this._error("Source is undefined"));return f.promise},_clearQueryTimeout:function(){this._queryTimer&&
clearTimeout(this._queryTimer)},_formatResults:function(a,b,c){c={activeSourceIndex:b,value:c,numResults:0,numErrors:0,errors:null,results:null};var d={},p={};if(a)if(b===this._allIndex)for(b=0;b<a.length;b++)a[b]&&(a[b]instanceof Error?(d[b]=a[b],c.numErrors++):(p[b]=a[b],c.numResults+=a[b].length));else a[0]&&(a[0]instanceof Error?(d[b]=a[0],c.numErrors++):(p[b]=a[0],c.numResults+=a[0].length));c.numErrors&&(c.errors=d);c.numResults&&(c.results=p);return c},_reverseGeocodePoint:function(a,b){var d=
new c,p=this.sources[a];if(b&&p){var f=p.locationToAddressDistance||this.locationToAddressDistance;p.locator.outSpatialReference=this._defaultSR;var h=this._getMap();h&&(p.locator.outSpatialReference=h.spatialReference);p.locator.locationToAddress(b,f,function(b){b=this._hydrateResults([b],a,!1);d.resolve(b)}.bind(this),function(a){a||(a=this._error("Locator locationToAddress could not be performed"));d.reject(a)}.bind(this))}else d.reject(this._error("No point or source defined for reverse geocoding"));
return d.promise},_cancelDeferreds:function(){if(this._deferreds&&this._deferreds.length)for(var a=0;a<this._deferreds.length;a++)this._deferreds[a].cancel(this.declaredClass+" cancelling request");this._deferreds=[]},_sourceBtnKey:function(a){if(a){var b=l("li",this.sourcesNode);a.keyCode===g.UP_ARROW?(a.stopPropagation(),a.preventDefault(),this._showSourcesMenu(),(a=b.length)&&w.focus(b[a-1])):a.keyCode===g.DOWN_ARROW&&(a.stopPropagation(),a.preventDefault(),this._showSourcesMenu(),b[0]&&w.focus(b[0]))}},
_inputKey:function(a){if(a){var b=l("li",this.suggestionsNode),c=this.suggestResults;if(a.keyCode===g.TAB||a.keyCode===g.ESCAPE)this._cancelSuggest(),this._hideMenus();else if(a.keyCode===g.UP_ARROW)a.stopPropagation(),a.preventDefault(),this._cancelSuggest(),c&&this._showSuggestionsMenu(),(a=b.length)&&w.focus(b[a-1]);else if(a.keyCode===g.DOWN_ARROW)a.stopPropagation(),a.preventDefault(),this._cancelSuggest(),c&&this._showSuggestionsMenu(),b[0]&&w.focus(b[0]);else{if(a.ctrlKey||a.metaKey||a.keyCode===
g.copyKey||a.keyCode===g.LEFT_ARROW||a.keyCode===g.RIGHT_ARROW||a.keyCode===g.ENTER)return a;this._suggestDelay()}}},_cancelSuggest:function(){this._cancelDeferreds();this._clearQueryTimeout()},_suggestDelay:function(){this._cancelSuggest();this._changeValue();this._queryTimer=setTimeout(function(){this.suggest()}.bind(this),this.suggestionDelay)},_changeValue:function(){this._changeAttrValue("value",this.inputNode.value);this._checkStatus()},_inputClick:function(){this._hideSourcesMenu();this._hideNoResultsMenu()},
_getSourceName:function(a){var b=this.sources,c=b[a].name;!c&&b[a].featureLayer&&(c=b[a].featureLayer.name);c||(c=x.widgets.Search.untitledSource);return c},_insertSuggestions:function(a,b){if(this.enableSuggestionsMenu&&this.suggestionsNode){this._hideSourcesMenu();this._hideNoResultsMenu();var c,d=this.sources;if(a){c=s.create("div");for(var p in a)if(a[p]&&a[p].length){var f=this._getSourceName(p);1<d.length&&this.activeSourceIndex===this._allIndex&&s.create("div",{className:this.css.searchMenuHeader,
textContent:f},c);for(var f=s.create("ul",{},c),h=d[p].maxSuggestions||this.maxSuggestions,g=0;g<a[p].length&&g<h;++g)for(var v=s.create("li",{"data-index":g,"data-source-index":p,role:"menuitem",tabindex:0},f),y=RegExp("("+b+")","gi"),y=this._getSuggestionName(a[p][g]).replace(y,"|$1|").split("|"),l=y.length,r=0;r<l;r++){var n=y[r];n.toLowerCase()===b.toLowerCase()?s.create("strong",{textContent:n},v):(n=document.createTextNode(n),s.place(n,v))}}}c?(s.place(c,this.suggestionsNode,"only"),this._showSuggestionsMenu()):
(s.empty(this.suggestionsNode),this._hideSuggestionsMenu())}},_insertSources:function(a){if(this.enableSourcesMenu&&a&&1<a.length){var b,c,d=this.activeSourceIndex,p=s.create("ul");this.enableSearchingAll&&(b="",d===this._allIndex&&(b="active"),s.create("li",{"data-index":this._allIndex,role:"menuitem",className:b,tabIndex:0,textContent:x.widgets.Search.all},p));for(c=0;c<a.length;c++){b="";c===d&&(b=this.css.activeSource);var f=this._getSourceName(c);s.create("li",{"data-index":c,role:"menuitem",
className:b,tabIndex:0,textContent:f},p)}n.add(this.containerNode,this.css.hasMultipleSources);s.place(p,this.sourcesNode,"only")}else n.remove(this.containerNode,this.css.hasMultipleSources),s.empty(this.sourcesNode)},_showLoading:function(){n.add(this.containerNode,this.css.searchLoading)},_hideLoading:function(){n.remove(this.containerNode,this.css.searchLoading)},_checkStatus:function(){this.value?(n.add(this.containerNode,this.css.hasValue),f.set(this.clearNode,"title",x.widgets.Search.clearButtonTitle)):
this.clear()},_closePopup:function(){this.enablePopup&&(this.view&&this.view.popup)&&this.view.popup.hide()},_noResults:function(a){var b;a&&(b=d.trim(a));var c=s.create("div",{className:this.css.searchNoResultsBody});a&&b?(s.create("div",{className:this.css.searchNoResultsHeader,textContent:x.widgets.Search.noResults},c),s.create("div",{className:this.css.searchNoResultsText,textContent:H.substitute({value:'"'+a+'"'},x.widgets.Search.noResultsFound)},c)):(a=s.create("div",{},c),s.create("span",{"aria-hidden":"true",
className:this.css.searchNoValueIcon},a),s.create("span",{className:this.css.searchNoValueText,textContent:x.widgets.Search.emptyValue},a));s.place(c,this.noResultsMenuNode,"only")},_hideMenus:function(){this._hideSourcesMenu();this._hideSuggestionsMenu();this._hideNoResultsMenu()},_hideNoResultsMenu:function(){n.remove(this.containerNode,this.css.showNoResults)},_showNoResultsMenu:function(){this._hideSourcesMenu();this._hideSuggestionsMenu();n.add(this.containerNode,this.css.showNoResults)},_hideSourcesMenu:function(){n.remove(this.containerNode,
this.css.showSources)},_hideSuggestionsMenu:function(){n.remove(this.containerNode,this.css.showSuggestions)},_showSourcesMenu:function(){this._hideSuggestionsMenu();this._hideNoResultsMenu();n.add(this.containerNode,this.css.showSources)},_showSuggestionsMenu:function(){this._hideSourcesMenu();this._hideNoResultsMenu();n.add(this.containerNode,this.css.showSuggestions)},_toggleSourcesMenu:function(){this._hideSuggestionsMenu();this._hideNoResultsMenu();n.toggle(this.containerNode,this.css.showSources)},
_getFirstStringField:function(a){if(a&&(a=a.fields)&&a.length)for(var b=0;b<a.length;b++){var c=a[b];if("esriFieldTypeString"===c.type)return c.name}return""},_getDisplayField:function(a){return a.displayField||a.featureLayer.displayField||this._getFirstStringField(a.featureLayer)},_validExtent:function(a){return a&&a.xmin&&"NaN"!==a.xmin&&a.ymin&&"NaN"!==a.ymin&&a.xmax&&"NaN"!==a.xmax&&a.ymax&&"NaN"!==a.ymax?!0:!1},_hydrateResult:function(a,b,c){var d={},p=this._defaultSR,f;b=this.sources[b];var h=
this._getMap();h&&(p=h.spatialReference);if(a.hasOwnProperty("text")&&a.hasOwnProperty("magicKey"))return a;if(a.hasOwnProperty("geometry"))f=I.fromJSON(a.toJSON()),d.feature=f,(f=d.feature.geometry)&&f.set("spatialReference",p);else if(a.hasOwnProperty("location")){var g=new R(a.location.x,a.location.y,p);f={};a.hasOwnProperty("attributes")&&(f=a.attributes);a.hasOwnProperty("score")&&(f.score=a.score);d.feature=new I(g,null,f,null)}else d.feature=null;if(a.hasOwnProperty("extent")&&this._validExtent(a.extent))d.extent=
new M(a.extent),d.extent.set("spatialReference",p);else if(d.feature&&d.feature.geometry)switch(d.feature.geometry.type){case "extent":d.extent=d.feature.geometry;break;case "multipoint":d.extent=d.feature.geometry.get("extent");break;case "polygon":d.extent=d.feature.geometry.get("extent");break;case "polyline":d.extent=d.feature.geometry.get("extent");break;case "point":h?(p=this.zoomScale,b&&b.zoomScale&&(p=b.zoomScale),this._getScale()>p?d.extent=U.getExtentForScale(this.view,p).centerAt(d.feature.geometry):
d.extent=this.view.get("extent").centerAt(d.feature.geometry)):d.extent=new M({xmin:d.feature.geometry.x-0.25,ymin:d.feature.geometry.y-0.25,xmax:d.feature.geometry.x+0.25,ymax:d.feature.geometry.y+0.25,spatialReference:this._defaultSR})}else d.extent=null;d.name="";b.featureLayer?b.suggestionTemplate&&c?d.name=H.substitute(a.attributes,b.suggestionTemplate):b.searchTemplate?d.name=H.substitute(a.attributes,b.searchTemplate):(c=this._getDisplayField(b),b=b.featureLayer.getDomain(c),c&&(a.hasOwnProperty("attributes")&&
a.attributes.hasOwnProperty(c))&&(a=a.attributes[c],d.name=b&&"codedValue"===b.type?this._getCodedName(b.codedValues,a):a)):a.address&&b.searchTemplate?d.name=H.substitute(a.address,b.searchTemplate):a.hasOwnProperty("name")?d.name=a.name:a.hasOwnProperty("attributes")&&"object"===typeof a.attributes&&a.attributes.Match_addr?(d.name=a.attributes.Match_addr,a.attributes.Addr_type&&("POI"===a.attributes.Addr_type&&a.attributes.StAddr&&a.attributes.City)&&(d.name+=" - "+a.attributes.StAddr+", "+a.attributes.City)):
a.hasOwnProperty("address")&&"string"===typeof a.address?d.name=a.address:a.hasOwnProperty("address")&&"object"===typeof a.address&&a.address.hasOwnProperty("Address")?d.name=a.address.Address:d.feature&&d.feature.geometry&&(d.name=d.feature.geometry.x+","+d.feature.geometry.y);return d},_getScale:function(){var a;this.view&&(a=this.view.get("scale"));return a},_hydrateResults:function(a,b,c){var d=[],p=0;if(a&&a.length)for(p;p<a.length;p++){var f=this._hydrateResult(a[p],b,c);d.push(f)}return d},
_containsNonLatinCharacter:function(a){for(var b=0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1},_setPlaceholder:function(a){var b="",c=this.sources[a];a===this._allIndex?b=this.allPlaceholder||x.widgets.Search.allPlaceholder:c&&c.placeholder&&(b=c.placeholder);var d=x.widgets.Search.all;c&&(d=this._getSourceName(a));f.set(this.sourceNameNode,"textContent",d);f.set(this.inputNode,"placeholder",b);f.set(this.inputNode,"title",b)},_updateActiveSource:function(){var a=this.sources,b=this.activeSourceIndex,
c;a&&a[b]&&(c=a[b]);c?this.set("activeSource",c):this.set("activeSource",null)},_visible:function(){this.get("visible")?n.add(this.containerNode,this.css.visible):n.remove(this.containerNode,this.css.visible)},_updateButtonMode:function(a){a?(n.toggle(this.containerNode,this.css.searchExpanded,this.expanded),n.toggle(this.containerNode,this.css.searchCollapsed,!this.expanded),n.add(this.containerNode,this.css.hasButtonMode)):(n.remove(this.containerNode,this.css.searchExpanded),n.remove(this.containerNode,
this.css.searchCollapsed),n.remove(this.containerNode,this.css.hasButtonMode))},_setDefaultActiveSourceIndex:function(){var a=this.sources;a&&1===a.length||!this.enableSearchingAll?this.set("activeSourceIndex",0):this.set("activeSourceIndex",this._allIndex)},_setEnableSourcesMenuAttr:function(a){this._set("enableSourcesMenu",a);this._created&&this._insertSources(this.sources)},_setEnableSearchingAllAttr:function(a){this._set("enableSearchingAll",a);this._created&&(this._setDefaultActiveSourceIndex(),
this._hideMenus(),this._insertSources(this.sources))},_setSourcesAttr:function(a){this._set("sources",a);this._created&&(this._setDefaultActiveSourceIndex(),this._hideMenus(),this._insertSources(a))},_setAllPlaceholderAttr:function(a){this._set("allPlaceholder",a);this._created&&this._setPlaceholder(this.activeSourceIndex)},_setActiveSourceIndexAttr:function(a){this._set("activeSourceIndex",a);this._updateActiveSource();this._created&&(this._setPlaceholder(a),this._hideMenus(),this._insertSources(this.sources))},
_setMaxLengthAttr:function(a){this._set("maxLength",a);this._created&&f.set(this.inputNode,"maxLength",a)},_setValueAttr:function(a){this._set("value",a);this._created&&(f.set(this.inputNode,"value",a),this._checkStatus())},_setVisibleAttr:function(a){this._set("visible",a);this._created&&this._visible()},_setExpandedAttr:function(a){this._set("expanded",a);this._created&&this._expanded()},_setEnableButtonModeAttr:function(a){this._set("enableButtonMode",a);this._created&&this._updateButtonMode(a)}})})},
"esri/tasks/support/AddressCandidate":function(){define(["../../core/declare","../../core/JSONSupport","../../geometry/Point"],function(k,m,d){return k(m,{declaredClass:"esri.tasks.AddressCandidate",address:null,attributes:null,location:null,_locationReader:function(k){return k&&d.fromJSON(k)},score:null})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),
function(k,m,d,q,c,g,h,l,b,f,n,s,x,a,r,z){n("dijit-legacy-requires")&&z(0,function(){k(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return d("dijit.Menu",r,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):m.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return x.get(this._iframeContentDocument(a))||
this._iframeContentDocument(a).__parent__||a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(a){a=q.byId(a,this.ownerDocument);var d;if("iframe"==a.tagName.toLowerCase()){var h=a;d=this._iframeContentWindow(h);d=s.body(d.document)}else d=a==s.body(this.ownerDocument)?this.ownerDocument.documentElement:a;var g={node:a,
iframe:h};c.set(a,"_dijitMenu"+this.id,this._bindings.push(g));var r=b.hitch(this,function(a){var b=this.selector,c=b?function(a){return f.selector(b,a)}:function(a){return a},d=this;return[f(a,c(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<this._lastKeyDown+500||d._scheduleOpen(this,h,{x:a.pageX,y:a.pageY},a.target)}),f(a,c("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==l.F10||this.leftClickToOpen&&a.keyCode==
l.SPACE)a.stopPropagation(),a.preventDefault(),d._scheduleOpen(this,h,null,a.target),this._lastKeyDown=(new Date).getTime()})]});g.connects=d?r(d):[];h&&(g.onloadHandler=b.hitch(this,function(){var a=this._iframeContentWindow(h),a=s.body(a.document);g.connects=r(a)}),h.addEventListener?h.addEventListener("load",g.onloadHandler,!1):h.attachEvent("onload",g.onloadHandler))},unBindDomNode:function(a){var b;try{b=q.byId(a,this.ownerDocument)}catch(d){return}a="_dijitMenu"+this.id;if(b&&c.has(b,a)){for(var f=
c.get(b,a)-1,h=this._bindings[f],g;g=h.connects.pop();)g.remove();(g=h.iframe)&&(g.removeEventListener?g.removeEventListener("load",h.onloadHandler,!1):g.detachEvent("onload",h.onloadHandler));c.remove(b,a);delete this._bindings[f]}},_scheduleOpen:function(a,b,c,d){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:d,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(b){function c(){z.refocus&&x&&x.focus();a.close(z)}var d=b.target,
f=b.iframe,l=b.coords,r=!l;this.currentTarget=b.delegatedTarget;if(l){if(f){b=g.position(f,!0);var d=this._iframeContentWindow(f),d=g.docScroll(d.document),k=h.getComputedStyle(f),s=h.toPixelValue,m=(n("ie")&&n("quirks")?0:s(f,k.paddingLeft))+(n("ie")&&n("quirks")?s(f,k.borderLeftWidth):0),f=(n("ie")&&n("quirks")?0:s(f,k.paddingTop))+(n("ie")&&n("quirks")?s(f,k.borderTopWidth):0);l.x+=b.x+m-d.x;l.y+=b.y+f-d.y}}else l=g.position(d,!0),l.x+=10,l.y+=10;var z=this,f=this._focusManager.get("prevNode");
b=this._focusManager.get("curNode");var x=!b||q.isDescendant(b,this.domNode)?f:b;a.open({popup:this,x:l.x,y:l.y,onExecute:c,onCancel:c,orient:this.isLeftToRight()?"L":"R"});this.focus();r||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);a.close(this)}},destroy:function(){m.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(k,m,d,q,c,g,h,l,b,f,n,s,x,a,r,z,t,w,B){function H(a){return function(b){this._isLoaded?this.inherited(a,arguments):this.loadDropDown(l.hitch(this,a,b))}}var A=m("dijit.form._SelectMenu",x,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(b(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}))},focus:function(){var a=!1,b=this.parentWidget.value;
l.isArray(b)&&(b=b[b.length-1]);b&&k.forEach(this.parentWidget._getChildren(),function(c){c.option&&b===c.option.value&&(a=!0,this.focusChild(c,!1))},this);a||this.inherited(arguments)}});c=m("dijit.form.Select"+(f("dojo-bidi")?"_NoBidi":""),[n,s,t],{baseClass:"dijitSelect dijitValidationTextBox",templateString:B,_buttonInputDisabled:f("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=a?a:0].value)}this.dropDown=new A({id:this.id+"_menu",parentWidget:this});q.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(b){if(!b.value&&!b.label)return new r({ownerDocument:this.ownerDocument});var c=l.hitch(this,"_setValueAttr",b);b=new a({option:b,label:("text"===this.labelType?(b.label||"").toString().replace(/&/g,
"\x26amp;").replace(/</g,"\x26lt;"):b.label)||this.emptyLabel,onClick:c,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:b.disabled||!1});b.focusNode.setAttribute("role","option");return b},_addOptionItem:function(a){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(a))},_getChildren:function(){return!this.dropDown?[]:this.dropDown.getChildren()},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(a){}},focusChild:function(a){a&&
this.set("value",a.option)},_getFirst:function(){var a=this._getChildren();return a.length?a[0]:null},_getLast:function(){var a=this._getChildren();return a.length?a[a.length-1]:null},childSelector:function(a){return(a=w.byNode(a))&&a.getParent()==this.dropDown},onKeyboardSearch:function(a,b,c,d){a&&this.focusChild(a)},_loadChildren:function(b){if(!0===b)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{k.forEach(this._getChildren(),
function(a){a.destroyRecursive()});var c=new a({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(c)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(a){this.inherited(arguments);d.set(this.valueNode,"value",this.get("value"));this._refreshState()},
_setNameAttr:"valueNode",_setDisabledAttr:function(a){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(a){this._set("required",a);this.focusNode.setAttribute("aria-required",a);this._refreshState()},_setOptionsAttr:function(a){this._isLoaded=!1;this._set("options",a)},_setDisplay:function(a){a=("text"===this.labelType?(a||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+a+"\x3c/span\x3e"},validate:function(a){a=this.disabled||this.isValid(a);this._set("state",a?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",a?"false":"true");var b=a?"":this._missingMsg;b&&this.focused&&this._hasBeenBlurred?z.show(b,this.domNode,this.tooltipPosition,!this.isLeftToRight()):z.hide(this.domNode);this._set("message",b);return a},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);z.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=g.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(b(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var a=this._keyNavCodes;delete a[h.LEFT_ARROW];delete a[h.RIGHT_ARROW]},_setStyleAttr:function(a){this.inherited(arguments);
q.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(a){this._loadChildren(!0);this._isLoaded=!0;a()},destroy:function(a){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(a),delete this.dropDown);z.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){z.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
f("dojo-bidi")&&(c=m("dijit.form.Select",c,{_setDisplay:function(a){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));c._Menu=A;c.prototype._onContainerKeydown=H("_onContainerKeydown");c.prototype._onContainerKeypress=H("_onContainerKeypress");return c})},"webSceneViewer/webScene/LayerTemplates":function(){define("dojo/_base/lang esri/request esri/core/urlUtils dojo/Deferred dojo/promise/all dojo/sniff esri/renderers/Renderer esri/renderers/SimpleRenderer esri/renderers/UniqueValueRenderer esri/symbols/support/jsonUtils".split(" "),
function(k,m,d,q,c,g,h,l,b,f){var n={};k.mixin(n,{symbolFromJSON:function(b){n.adjustProtocolInSymbolRefs(b);(g("ie")||g("trident"))&&n.changeSVGRefsToPNG(b);return f.fromJSON(b)},removeProtocol:function(b){return b=b.replace(/^http:|https:/,"")},adjustProtocol:function(b){return b="https:"===location.protocol?b.replace(/^http:/,"https:"):b.replace(/^https:/,"http:")},removeProtocolFromSymbolRefs:function(b){if(b.symbolLayers)for(var c=0;c<b.symbolLayers.length;c++){var a=b.symbolLayers[c];if(a.resource&&
a.resource.href){var f=a.resource.href;d.fixUrl(f);f=n.removeProtocol(f);a.resource.href=f}}},adjustProtocolInSymbolRefs:function(b){if(b.symbolLayers)for(var c=0;c<b.symbolLayers.length;c++){var a=b.symbolLayers[c];if(a.resource&&a.resource.href){var d=a.resource.href,d=n.adjustProtocol(d);a.resource.href=d}}},changeSVGRefsToPNG:function(b){if(b.symbolLayers)for(var c=0;c<b.symbolLayers.length;c++){var a=b.symbolLayers[c];if(a.resource&&a.resource.href&&-1!==a.resource.href.indexOf(".svg",a.resource.href.length-
4)){var d=a.resource.href,d=d.replace(".svg",".png"),d=d.replace("/resource/","/resource/png/");a.resource.href=d}}},hasContentByReference:function(b){return!b?!1:b.styleUrl||b.styleName?"renderer":b.symbol&&b.symbol.type&&"styleSymbolReference"===b.symbol.type?"symbol":!1},getStyleFromUrl:function(b){var c=new q;m({url:n.adjustProtocol(b),content:{f:"json"},handleAs:"json"}).then(function(a){c.resolve(a)},function(a){c.reject(a)});return c},getStyle:function(b,c){var a=new q;if(!c)return a.reject("no portal to query styles"),
a;var d=c.stylesGroupQuery;if(!d)return a.reject("no stylesGroupQuery in portal.self"),a;c.queryGroups(d,!0).then(function(d){if(!d.results||0===d.results.length)return a.reject("no styles in styleGroup"),a;c.queryGroupItems(d.results[0].id,{q:"typekeywords:"+b},!0).then(function(d){0===d.total?a.reject("style name "+b+" not in style group"):c.getItemData(d.results[0].id).then(function(b){a.resolve(b)})})});return a},getSymbolSet:function(b){var c=new q;if(!b.symbolSetUrl)return c.reject("style does not provide url for symbolSet"),
c;m({url:n.adjustProtocol(b.symbolSetUrl),content:{f:"json"},handleAs:"json"}).then(function(a){(0===a.length||!a[0].name)&&c.reject("invalid syntax or missing data in symbol set");for(var d={defaultSymbol:void 0},f=0;f<a.length;f++){var h=n.symbolFromJSON(a[f]);d[a[f].name]=h;a[f].name===b.defaultItem&&(d.defaultSymbol=h)}d.defaultSymbol||(d.defaultSymbol=d[a[0].name]);c.resolve(d)});return c},getSymbolsIndividually:function(b){for(var d=[],a=0;a<b.items.length;a++)d.push(n.getSymbol(b.items[a].name));
return c(d)},getSymbol:function(b,c){for(var a=new q,d=0;d<b.items.length;d++)if(b.items[d].name===c)return m({url:n.adjustProtocol(b.items[d].webRef),content:{f:"json"},handleAs:"json"}).then(function(b){a.resolve(n.symbolFromJSON(b))},function(b){a.reject(b)}),a;a.reject("symbolName "+c+" not found in style");return a},getSymbolFromUrl:function(b){var c=new q;m({url:n.adjustProtocol(b),content:{f:"json"},handleAs:"json"}).then(function(a){c.resolve(n.symbolFromJSON(a))},function(a){c.reject(a)});
return c},createRenderer:function(b,c){var a,d=n.hasContentByReference(b);"renderer"===d?a=n._createUVRendererFromStyleUrl(b,c):"symbol"===d&&(a=n._createSimpleRendererWithStyleSymbolReference(b,c));return a},_patchInfosIntoRenderer:function(b,c){var a=new h(b);a.sizeInfo&&c.setProportionalSymbolInfo(a.sizeInfo);a.colorInfo&&c.setColorInfo(a.colorInfo);a.visualVariables&&c.setVisualVariables(a.visualVariables);return c},_createSimpleRendererWithStyleSymbolReference:function(b,c){var a=new q,d=b.symbol;
if(!d.name)return a.reject("no name in styleSymbolReference symbol"),a;var f;if(d.styleUrl)f=n.getStyleFromUrl(d.styleUrl);else if(d.styleName)f=n.getStyle(d.styleName,c);else return a.reject("no styleUrl or styleName in layerDefinition "+b),a;f.then(function(c){n.getSymbol(c,d.name).then(function(c){c=new l(c);c=n._patchInfosIntoRenderer(b,c);a.resolve(c)},function(b){a.reject("Can't get symbol. "+b)})},function(b){a.reject(b)});return a},_createUVRendererFromStyleUrl:function(c,d){var a=new q,f;
if(c.styleUrl)f=n.getStyleFromUrl(c.styleUrl);else if(c.styleName)f=n.getStyle(c.styleName,d);else return a.reject("no styleUrl or styleName in layerDefinition "+c),a;f.then(function(d){n.getSymbolSet(d).then(function(d){var f=new b(c.defaultSymbol&&d[c.defaultSymbol.name]?d[c.defaultSymbol.name]:d.defaultSymbol,c.field1),h;for(h in d)d.hasOwnProperty(h)&&f.addValue(h,d[h]);f=n._patchInfosIntoRenderer(c,f);a.resolve(f)},function(b){a.reject(b)})},function(b){a.reject(b)});return a}});return n})},
"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(k,m,d,q,c,g){return k("dijit.MenuSeparator",[d,q,c],{templateString:g,buildRendering:function(){this.inherited(arguments);m.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),
function(k,m,d,q,c,g){var h=function(b){b=b||{};var c=d.getLocalization("dojo.cldr","number",d.normalizeLocale(b.locale)),h=b.pattern?b.pattern:c[(b.type||"decimal")+"Format"];b="number"==typeof b.places?b.places:"string"===typeof b.places&&0<b.places.length?b.places.replace(/.*,/,""):-1!=h.indexOf(".")?h.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:c.decimal,places:b}},l=k("dijit.form.NumberTextBoxMixin",null,{pattern:function(b){return"("+(this.focused&&this.editOptions?this._regExpGenerator(m.delegate(b,
this.editOptions))+"|":"")+this._regExpGenerator(b)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:c.format,_regExpGenerator:c.regexp,_decimalInfo:h(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(b){var c="number"==typeof b.places?b.places:0;c&&c++;"number"!=typeof b.max&&(b.max=9*Math.pow(10,15-c));"number"!=typeof b.min&&(b.min=-9*Math.pow(10,15-c));this.inherited(arguments,[b]);this.focusNode&&(this.focusNode.value&&
!isNaN(this.value))&&this.set("value",this.value);this._decimalInfo=h(b)},_onFocus:function(){if(!this.disabled&&!this.readOnly){var b=this.get("value");"number"==typeof b&&!isNaN(b)&&(b=this.format(b,this.constraints),void 0!==b&&(this.textbox.value=b));this.inherited(arguments)}},format:function(b,c){var d=String(b);if("number"!=typeof b)return d;if(isNaN(b))return"";if(!("rangeCheck"in this&&this.rangeCheck(b,c))&&!1!==c.exponent&&/\de[-+]?\d/i.test(d))return d;this.editOptions&&this.focused&&
(c=m.mixin({},c,this.editOptions));return this._formatter(b,c)},_parser:c.parse,parse:function(b,c){var d=this._parser(b,m.mixin({},c,this.editOptions&&this.focused?this.editOptions:{}));this.editOptions&&(this.focused&&isNaN(d))&&(d=this._parser(b,c));return d},_getDisplayedValueAttr:function(){var b=this.inherited(arguments);return isNaN(b)?this.textbox.value:b},filter:function(b){if(null==b||"string"==typeof b&&""==b)return NaN;"number"==typeof b&&(!isNaN(b)&&0!=b)&&(b=c.round(b,this._decimalInfo.places));
return this.inherited(arguments,[b])},serialize:function(b,c){return"number"!=typeof b||isNaN(b)?"":this.inherited(arguments)},_setBlurValue:function(){var b=m.hitch(m.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(b,!0)},_setValueAttr:function(b,c,d){if(void 0!==b&&void 0===d)if(d=String(b),"number"==typeof b)if(isNaN(b))d="";else{if("rangeCheck"in this&&this.rangeCheck(b,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(d))d=void 0}else b?b=void 0:(d="",b=NaN);
this.inherited(arguments,[b,c,d])},_getValueAttr:function(){var b=this.inherited(arguments);if(isNaN(b)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&RegExp("^"+c._realNumberRegexp(m.delegate(this.constraints))+"$").test(this.textbox.value))return b=Number(this.textbox.value),isNaN(b)?void 0:b}else return b},isValid:function(b){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);var c=this.get("value");return!isNaN(c)&&
this.rangeCheck(c,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var b="number"==typeof this.constraints.min,c="number"==typeof this.constraints.max,d=this.get("value");if(isNaN(d)||!b&&!c)return this.inherited(arguments);var h=d|0,g=0>d,a=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),l=(this.maxLength||20)-this.textbox.value.length,k=a?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,
""):"",h=a?h+"."+k:h+"",l=q.rep("9",l),a=d;g?a=Number(h+l):d=Number(h+l);return!(b&&d<this.constraints.min||c&&a>this.constraints.max)}});k=k("dijit.form.NumberTextBox",[g,l],{baseClass:"dijitTextBox dijitNumberTextBox"});k.Mixin=l;return k})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(k,m,d,q){return k("dijit.DropDownMenu",q,{templateString:d,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},
_onRightArrow:function(c){this._moveToPopup(c);c.stopPropagation();c.preventDefault()},_onLeftArrow:function(c){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else c.stopPropagation(),c.preventDefault()}})})},"webSceneViewer/widgets/SlideDeck/SlideDeck":function(){define("esri/core/declare dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/on dojo/dom dojo/query webSceneViewer/assertUtils webSceneViewer/webScene/Presentation webSceneViewer/widgets/ScrollBar/ScrollBar".split(" "),
function(k,m,d,q,c,g,h,l,b,f){var n=l.assert;return k(null,{name:"SlideDeck",baseClass:"SlideDeck",constructor:function(b,c){n(b.view);n(b.webScene);this.view=b.view;this.webScene=b.webScene;this.cls=b["class"];this.mainContainerNode=c;d.add(c,"slideDeck");this.slideNodes=[];this._init()},_init:function(){this.webScene.presentation&&this.webScene.presentation.slides&&this._ui();this.webScene.watch("presentation",function(){this._update()}.bind(this))},_ui:function(){this.innerContainer&&q.destroy(this.outerContainer);
var h=this.webScene.presentation.slides.get("length");if(0!==h){this.outerContainer=q.create("div",{"class":"Slidebar"});this.innerContainer=q.create("ul",{"class":"slideDeckInner"});q.place(this.outerContainer,this.mainContainerNode,"first");q.place(this.innerContainer,this.outerContainer,"first");this.cls&&d.add(this.innerContainer,this.cls);for(var g=0;g<h;g++){var a=this.webScene.presentation.slides.getItemAt(g),l=q.create("li",{"class":"slide",nr:g,bmid:a.id},this.innerContainer);this.slideNodes.push(l);
l=q.create("div",{"class":"slideButton",id:this.mainContainerNode.id+"slideButton"+a.id},l);q.create("p",{"class":"smallTitle",innerHTML:a.title.text,title:a.title.text},l);q.create("div",{"class":"homeIcon"},l);q.create("img",{src:a.thumbnail.url},l);c(l,"click",m.partial(function(a){b.applySlideToView(a,this.view);this._highlightBookmark(this.mainContainerNode.id+"slideButton"+a.id)}.bind(this),a))}"SlideDeck"===this.name&&(this.horizontalScrollbar=new f({scrollTarget:this.innerContainer,view:this.view}),
this.horizontalScrollbar.startup(),this.horizontalScrollbar.placeAt(this.outerContainer),this.horizontalScrollbar.updateWidth(),this.horizontalScrollbar.enableScrollTargetDrag())}},_update:function(){this.slideNodes=[];this._ui()},_clearHighlight:function(){h(".slideButton.highlight").forEach(function(b,c,a){b.className="slideButton"})},_highlightBookmark:function(b){this._clearHighlight();(b=g.byId(b))&&d.add(b,"highlight")}})})},"webSceneViewer/widgets/EnvironmentSettings/EnvironmentSettings":function(){define("esri/core/declare dojo/_base/kernel dojo/dom-construct dojo/on dijit/form/HorizontalSlider dijit/form/CheckBox esri/core/watchUtils esri/views/3d/support/earthUtils dojo/i18n!../nls/widgets".split(" "),
function(k,m,d,q,c,g,h,l,b){var f=new Date,n=new Date,s={hour:"numeric",minute:"numeric"};return k(null,{constructor:function(b,a){this._seasons={date:{},nice:{}};this._timeoutId=0;this._sliderFlag=!1;for(var c=this._sliderPos=0;11>=c;c++)this._seasons.date[c]=new Date(2013,c,15),this._seasons.nice[c]=this._seasons.date[c].toLocaleString(m.locale,{month:"long"});h.whenOnce(a,"ready",function(){this.create(b,a)}.bind(this))},create:function(k,a){function r(b){A=b;C(a.environment.lighting.date);a.environment.lighting.displayUTCOffset=
b}var m=function(){var b=a.environment.lighting.date,c=l.positionToTimezone(a.get("camera").position);return{date:b,hour:b.getUTCHours()+c.hours+b.getUTCMinutes()/60,monthIdx:b.getMonth(),timezoneOffset:c.hours}}(),t=d.create("div",{id:"lightingDiv"},k);d.create("div",{"class":"paneSubTitle",innerHTML:b.environmentSettings.dragSunSliderText},t);var w=d.create("div",{id:"sunSettingsContainer","class":"sliderContainer"},t),B=d.create("div",{"class":"sliderContainer sunSliderContainer"},w),H=new c({"class":"envSunHorizontalSlider",
maximum:23.99,minimum:0,value:m.hour,intermediateChanges:!0,showButtons:!1},B);q(H,"change",function(b){if(this._sliderFlag)this._sliderFlag=!1;else{f.setTime(a.environment.lighting.date.getTime());var c=f.getTime(),d=((Math.floor(b)-A)%24+24)%24;b=60*(b-Math.floor(b));var h=b%1;b-=h;h=Math.round(60*h);f.setUTCHours(d);f.setUTCMinutes(b);f.setUTCSeconds(h);f.getTime()!==c&&(a.environment.lighting.date=f);0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=0);n.setTime(f.getTime());
c=((f.getUTCHours()+A)%24+24)%24;d=f.getUTCMinutes();b=f.getUTCSeconds();n.setHours(c);n.setMinutes(d);n.setSeconds(b);O.value=n.toLocaleString("en-us",{hour:"numeric",minute:"numeric"})}}.bind(this));for(var A=m.timezoneOffset,O=d.create("input",{id:"sunTime",title:b.environmentSettings.dragSunSliderHint,readonly:"readonly"},w),B=d.create("div",{"class":"sunDropdownDiv",id:"gmtDropdownDiv"},w),I=d.create("select",{id:"gmtSelect"},B),B=12;0<B;B--)d.create("option",{innerHTML:"GMT-"+B,value:-B},I);
d.create("option",{innerHTML:"GMT-0",value:0},I);for(B=1;12>=B;B++)d.create("option",{innerHTML:"GMT+"+B,value:B},I);I.selectedIndex=m.timezoneOffset+12;q(I,"change",function(a){r(parseInt(a.currentTarget.value,10))});h.init(a,"environment.lighting",function(a){a&&void 0===a.displayUTCOffset&&(a.displayUTCOffset=A)});var B=d.create("div",{"class":"sunDropdownDiv",id:"seasonDropdownDiv"},w),G=d.create("select",{id:"seasonSelect",selectedIndex:m.monthIdx},B);q(G,"change",function(b){b=b.target;var c=
a.environment.lighting.date,d=new Date(c);d.setMonth(this._seasons.date[b.options[b.selectedIndex].value].getMonth());d.setUTCHours(c.getUTCHours());d.setUTCMinutes(c.getUTCMinutes());d.setUTCSeconds(c.getUTCSeconds());a.environment.lighting.date=d}.bind(this));for(var J in this._seasons.date)this._seasons.date.hasOwnProperty(J)&&d.create("option",{id:J+"_button","class":"seasonButton",innerHTML:this._seasons.nice[J],value:J},G);G.selectedIndex=m.monthIdx;d.create("div",{"class":"clr"},w);var C=function(a){n.setTime(a.getTime());
a=((n.getUTCHours()+A)%24+24)%24;var b=n.getUTCMinutes(),c=n.getUTCSeconds();a=a+b/60+c/3600;b=H.get("value");this._sliderPos=a;a!==b&&(this._sliderFlag=!0,0===this._timeoutId&&(this._timeoutId=setTimeout(K,200)))},C=C.bind(this),K=function(){n.setTime(a.environment.lighting.date.getTime());var b=((n.getUTCHours()+A)%24+24)%24,c=n.getUTCMinutes(),d=n.getUTCSeconds(),f=b+c/60+d/3600,h=H.get("value");f!==h&&H.set("value",f);f=n.getUTCMonth();G.selectedIndex=f;n.setHours(b);n.setMinutes(c);n.setSeconds(d);
O.value=n.toLocaleString("en-us",s);this._timeoutId=0}.bind(this),m=function(){0===this._timeoutId&&(this._timeoutId=setTimeout(K,500))}.bind(this);a.watch("camera",m);m();q(a.environmentManager,"_date-change",function(a){C(a)});q(a.environmentManager,"_timezone-change",function(a){I.selectedIndex=a+12;r(a)});d.create("div",{"class":"paneSubTitle",innerHTML:b.environmentSettings.shadowing},t);h.init(a,"environment.lighting.displayUTCOffset",function(a){if(void 0!==a){var b=Math.round(a)+12;I.selectedIndex!==
b&&(I.selectedIndex=b);A!==a&&r(a)}});(function(c){c=d.create("div",{id:"sunSettingsContainer","class":"sliderContainer"},c);var f,l;void 0!==a._stage.getRenderParams().shadowMap&&(f=new g({"class":"shadowButton",value:"shadow"}),f.placeAt(c),d.create("label",{"for":"shadowButton"},c).textContent=b.environmentSettings.directShadow,q(f,"change",function(b){a.environment.lighting.directShadows=f.checked}),h.init(a,"environment.lighting.directShadows",function(a){f.set("checked",a)}));void 0!==a._stage.getRenderParams().ssao&&
(d.create("br",{},c),d.create("br",{},c),l=new g({"class":"ssaoButton",value:"ssao"}),l.placeAt(c),d.create("label",{"for":"ssaoButton"},c).textContent=b.environmentSettings.diffuseShadow,q(l,"change",function(b){a.environment.lighting.ambientOcclusion=l.checked}),h.init(a,"environment.lighting.ambientOcclusion",function(a){l.set("checked",a)}));this.set=function(a,b){f&&f.set("checked",a);l&&l.set("checked",b)}}).call(this,t)}})})},"webSceneViewer/widgets/LayerWidget/LayerItem":function(){define("esri/core/declare dojo/dom-construct dojo/dom-class dojo/dom-style dojo/on dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/LayerItem.html dijit/form/RadioButton dijit/form/CheckBox esri/layers/GroupLayer dojo/i18n!../nls/widgets".split(" "),
function(k,m,d,q,c,g,h,l,b,f,n,s){var x=k([g,h],{name:"LayerItem",templateString:l,view:void 0,layer:void 0,_setLayerAttr:function(a){this._set("layer",a);a&&a instanceof n&&(this.isGroupLayer=!0,this.domNode&&d.add(this.domNode,"GroupLayerItem"))},parentGroup:void 0,parentLayerItem:void 0,layerTitle:void 0,_setLayerTitleAttr:function(a){this._set("layerTitle",a);this.titleNode&&(this.titleNode.textContent=a,this.titleNode.title=a)},layerVisible:void 0,_setLayerVisibleAttr:function(a){this._set("layerVisible",
a);this._layerVisDijitButton&&this._layerVisDijitButton.get("checked")!==a&&this._layerVisDijitButton.set("checked",a)},layerWidget:void 0,isGroupLayer:!1,_watchHandles:void 0,_onHandles:void 0,_layerItems:void 0,_previousProgressPercentage:-1,_previousProgressVisible:null,constructor:function(a,b){this._watchHandles=[];this._onHandles=[];this._layerItems=[]},postMixInProperties:function(){},postCreate:function(){this.set("layerTitle",this.layer.title||this.layer.id);var a=this.layer.watch("title",
function(a){this.set("layerTitle",this.layer.title)}.bind(this));this._watchHandles.push(a);this.set("layerVisible",this.layer.visible);a=this.layer.watch("visible",function(a){this.set("layerVisible",a)}.bind(this));this._watchHandles.push(a);(void 0===this.parentGroup||"hide"===this.layer.listMode)&&d.add(this.domNode,this.layer.listMode);this._layerVisDijitButton=this.parentGroup&&"exclusive"===this.parentGroup.visibilityMode?new b({name:this.parentGroup.id+"_radiogroup_"+this.id,checked:this.layerVisible},
this.layerVisInputCheckbox):new f({checked:this.layerVisible},this.layerVisInputCheckbox);a=c(this._layerVisDijitButton,"change",this._layerVisInputCheckboxChange.bind(this));this._onHandles.push(a);a=this.layer.watch("visibilityMode",function(a){this.layerWidget.reload()}.bind(this));this._watchHandles.push(a);a=this.layer.watch("listMode",function(a){this.layerWidget.reload()}.bind(this));this._watchHandles.push(a);a=this.view.getLayerView(this.layer);if(null==a)c.once(this.layer,"layer-view-create",
function(a){a.layerView.then(function(b){this.connectUpdating(b.layerView||a.layerView)}.bind(this))}.bind(this));else this.connectUpdating(a);this._init()},_addLayerItem:function(a,b){var c=new x({view:this.view,layer:a,layerWidget:this.layerWidget,parentGroup:this.layer,parentLayerItem:this});c.placeAt(this.layersDomNode,b);this._layerItems.push(c)},_removeLayerItem:function(a){for(var b=this._layerItems.length-1;0<=b;b--)if(this._layerItems[b].layer===a){this._layerItems.splice(b,1);this._layerItems[b].destroy();
break}},_init:function(){this.isGroupLayer&&"hide-children"!==this.layer.listMode&&this._initGroupLayerItems();var a=function(){d.remove(this.statDomNode,"layerAdd");this.layer.fullExtent&&d.remove(this.layerFrameButton,"inactive")}.bind(this);if(this.layer.loaded||this.layer instanceof n)a();else c.once(this.layer,"load",function(b){a()});this.layerFrameButton.title=s.layerItemEditable.zoomToLayer},_initGroupLayerItems:function(){if(this.isGroupLayer){this.layersDomNode=m.create("div",{className:"layers"},
this.domNode);m.create("div",{className:"layersLine"},this.layersDomNode);var a=c(this.layer,"layer-add",function(a){this.layerWidget.reload()}.bind(this)),b=c(this.layer,"layer-remove",function(a){this.layerWidget.reload()}.bind(this)),f=c(this.layer,"layer-reorder",function(a){this.layerWidget.reload()}.bind(this));this._onHandles.push(a);this._onHandles.push(b);this._onHandles.push(f);for(a=this.layer.layers.get("length")-1;0<=a;a--)b=this.layer.layers.getItemAt(a),this._addLayerItem(b);0===this.layer.layers.get("length")&&
(d.add(this.layersDomNode,"emptyPlaceholder"),this.layersDomNode.textContent=s.layerItemEditable.dragHere)}},destroy:function(){this._watchHandles.forEach(function(a){a.remove()});this._onHandles.forEach(function(a){a.remove()});this._layerItems.forEach(function(a){a.destroy()});this._watchHandles.length=0;this._onHandles.length=0;this._layerItems.length=0;this._layerVisDijitButton.destroy();m.empty(this.domNode);m.destroy(this.domNode)},connectUpdating:function(a){if(null!=this.statDomNode){var b=
function(){var b=a.get("updating"),c=a.get("updatingPercentage");null==c&&(c=100);b=b&&!a.suspended&&0<c;c===this._previousProgressPercentage&&b===this._previousProgressVisible||(b?(q.set(this.statDomNodeProgressbarUpper,"visibility","visible"),q.set(this.statDomNodeProgressbarLower,"visibility","visible"),q.set(this.statDomNodeProgressbarUpper,"height",100-c+"%"),q.set(this.statDomNodeProgressbarLower,"height",c+"%")):(q.set(this.statDomNodeProgressbarUpper,"visibility","hidden"),q.set(this.statDomNodeProgressbarLower,
"visibility","hidden")),this._previousProgressVisible=b,this._previousProgressPercentage=c)}.bind(this),d=c(a,"suspend",function(){q.set(this.statDomNodeProgressbarUpper,"visibility","hidden");q.set(this.statDomNodeProgressbarLower,"visibility","hidden")}.bind(this));this._onHandles.push(d);this._onHandles.push(c(a,"resume",b));b=a.watch(["updating","updatingPercentage"],b);this._watchHandles.push(b)}},_layerVisInputCheckboxChange:function(a){this.layer.get("visible")!==a&&this.layer.set("visible",
a)},_layerFrameButtonClick:function(){this.layer.fullExtent&&this.view.animateTo(this.layer.fullExtent)}});return x})},"webSceneViewer/widgets/LayerWidget/LayerWidget":function(){define(["esri/core/declare","dojo/dom-class","dojo/on","dijit/_WidgetBase","./LayerItem"],function(k,m,d,q,c){return k([q],{view:void 0,_layerItems:void 0,_onHandles:void 0,map:void 0,constructor:function(c,d){this._layerItems=[];this._onHandles=[]},destroy:function(){this._onHandles.forEach(function(c){c.remove()});this._onHandles.length=
0;this._destroyAllLayerItems()},postMixInProperties:function(){this.map=this.view.map},postCreate:function(){this._init();this.startup()},_init:function(){m.add(this.domNode,"LayerWidget");this._setupAllLayerItems();var c=d(this.map,"layer-add",function(b){this.reload()}.bind(this)),h=d(this.map,"layer-remove",function(b){this.reload()}.bind(this)),l=d(this.map,"layer-reorder",function(b){this.reload()}.bind(this));this._onHandles.push(c);this._onHandles.push(h);this._onHandles.push(l)},reload:function(){this._destroyAllLayerItems();
this._setupAllLayerItems()},_destroyAllLayerItems:function(){for(var c=0;c<this._layerItems.length;c++)this._layerItems[c].destroy();this._layerItems.length=0},_setupAllLayerItems:function(){for(var c=this.map.layers.get("length")-1;0<=c;c--){var d=this.map.layers.getItemAt(c);"SilentContentLayer"===d.id||"__basemapErrorFallbackLayer__"===d.id||this._addLayerItem(d)}},_addLayerItem:function(c){var d=this._createLayerItem(c);d.placeAt(this.domNode,this.map.layers.get("length")-this.map.layers.indexOf(c)-
1);this._layerItems.push(d)},_removeLayerItem:function(c){for(var d=0;d<this._layerItems.length;d++)this._layerItems[d].layer===c&&(this._layerItems[d].destroy(),this._layerItems.splice(d,1))},_createLayerItem:function(d){return new c({view:this.view,layer:d,layerWidget:this})}})})},"esri/symbols/support/gfxUtils":function(){define(["require","dojo/_base/lang","dojox/gfx/_base","../../core/screenUtils"],function(k,m,d,q){var c=k.toUrl("../../images/symbol/sfs/"),g=function(b){var f=null,h=b.style;
if(b){var g=b.constructor;switch(b.type){case "simplemarkersymbol":h!==g.STYLE_CROSS&&h!==g.STYLE_X&&(f=b.color);break;case "simplefillsymbol":h===g.STYLE_SOLID?f=b.color:h!==g.STYLE_NULL&&(f=m.mixin({},d.defaultPattern,{src:c+h+".png",width:10,height:10}));break;case "picturefillsymbol":f=m.mixin({},d.defaultPattern,{src:b.url,width:b.width*b.xscale,height:b.height*b.yscale,x:b.xoffset,y:b.yoffset})}}return f},h=function f(c){var d=null;if(c){var h=c.constructor;switch(c.type){case "simplefillsymbol":case "picturefillsymbol":case "simplemarkersymbol":d=
f(c.get("outline"));break;case "simplelinesymbol":c.style!==h.STYLE_NULL&&0!==c.width&&(d={color:c.color,style:l(c.style),width:c.width});break;case "cartographiclinesymbol":c.style!==h.STYLE_NULL&&0!==c.width&&(d={color:c.color,style:l(c.style),width:c.width,cap:c.cap,join:c.join===h.JOIN_MITER?c.miterLimit:c.join});break;default:d=null}}return d},l=function(){var c={};return function(d){if(c[d])return c[d];var h=d.replace(/-/g,"");return c[d]=h}}();return{getFill:g,getStroke:h,getShapeDescriptors:function(c){if(!c)return{defaultShape:null,
fill:null,stroke:null};var l={fill:g(c),stroke:h(c)},k=c.constructor,m=k.defaultProps,a=null;switch(c.type){case "simplemarkersymbol":var r=c.style,m=0.5*(c.size||q.pt2px(m.size)),z=-m,t=+m,w=-m,B=+m;switch(r){case k.STYLE_CIRCLE:a={type:"circle",cx:0,cy:0,r:m};break;case k.STYLE_CROSS:a={type:"path",path:"M "+z+",0 L "+t+",0 M 0,"+w+" L 0,"+B+" E"};break;case k.STYLE_DIAMOND:a={type:"path",path:"M "+z+",0 L 0,"+w+" L "+t+",0 L 0,"+B+" L "+z+",0 E"};break;case k.STYLE_SQUARE:a={type:"path",path:"M "+
z+","+B+" L "+z+","+w+" L "+t+","+w+" L "+t+","+B+" L "+z+","+B+" E"};break;case k.STYLE_X:a={type:"path",path:"M "+z+","+B+" L "+t+","+w+" M "+z+","+w+" L "+t+","+B+" E"};break;case k.STYLE_PATH:a={type:"path",path:c.path||""}}break;case "simplelinesymbol":case "cartographiclinesymbol":a={type:"path",path:"M -15,0 L 15,0 E"};break;case "picturefillsymbol":case "simplefillsymbol":a={type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 E"};break;case "picturemarkersymbol":a={type:"image",
x:-Math.round(c.width/2),y:-Math.round(c.height/2),width:c.width,height:c.height,src:c.source&&c.source.imageData?"data:"+c.source.contentType+";base64,"+c.source.imageData:c.url||""};break;case "textsymbol":k=c.font,a={type:"text",text:c.text,x:0,y:0.25*d.normalizedLength(k?k.size:0),align:"middle",decoration:c.decoration||k&&k.decoration,rotated:c.rotated,kerning:c.kerning},l.font=k&&{size:k.size,style:k.style,variant:k.variant,decoration:k.decoration,weight:k.weight,family:k.family}}l.defaultShape=
a;return l}}})},"esri/layers/support/LayerDrawingOptions":function(){define("../../core/declare dojo/_base/lang dojo/_base/array ../../core/lang ../../renderers/support/jsonUtils ./LabelClass".split(" "),function(k,m,d,q,c,g){return k(null,{declaredClass:"esri.layers.support.LayerDrawingOptions",constructor:function(h){if(h&&(m.mixin(this,h),h.renderer&&(this.renderer=c.fromJSON(h.renderer)),h.labelingInfo&&0<h.labelingInfo.length)){this.labelingInfo=[];var l;d.forEach(h.labelingInfo,function(b){l=
new g(b);this.labelingInfo.push(l)},this)}},toJson:function(){try{throw Error("toJson is deprecated, use toJSON instead");}catch(c){console.warn(c.stack)}return this.toJSON()},toJSON:function(){var c={renderer:this.renderer&&this.renderer.toJSON(),transparency:this.transparency,scaleSymbols:this.scaleSymbols,showLabels:this.showLabels};this.labelingInfo&&0<this.labelingInfo.length&&(c.labelingInfo=[],d.forEach(this.labelingInfo,function(d){c.labelingInfo.push(d.toJSON())}));return q.fixJson(c)}})})},
"webSceneViewer/basemapUtils":function(){define("dojo/promise/all dojo/Deferred dojo/_base/lang esri/layers/ArcGISElevationLayer esri/core/watchUtils esri/geometry/SpatialReference webSceneViewer/webScene/WebSceneLayers esri/Basemap esri/core/Collection webSceneViewer/widgets/MessageListWidget/MessageListWidget webSceneViewer/spatialReferenceUtils esri/layers/OpenStreetMapLayer esri/layers/GraphicsLayer esri/views/3d/terrain/TilingScheme esri/geometry/support/webMercatorUtils esri/geometry/support/scaleUtils esri/geometry/Extent ./environmentUtils dojo/i18n!webSceneViewer/nls/viewer".split(" "),
function(k,m,d,q,c,g,h,l,b,f,n,s,x,a,r,z,t,w,B){function H(a){var b=Error("Invalid basemap");b.errors=a;return b}function A(a){for(var b=[],c=[],d=0;d<a.length;d++){var f=a[d];if(f instanceof s)c.push({layer:f});else if(h.extrapolateTypeFromLayerInstance(f))if(f.url){var g=h.validateServerUrl(f.url);g.hasLayer?b.push({msg:B.messages.addLayerFailed,details:"unsupported url "+f.url}):c.push({layer:f,serviceDetails:g,url:f.url,params:{url:f.url}})}else b.push({msg:B.messages.addLayerFailed,details:"missing url"});
else b.push({msg:B.messages.onlyTiledLayerSupported,details:f.url})}if(0!==b.length)throw H(b);return c}function O(a){function b(){0===c.length?f.resolve(d):f.reject(H(c.filter(function(a){return!!a})))}for(var c=[],d=[],f=new m,g=a.length,l=0;l<a.length;l++){var k=a[l];k.serviceDetails?h.prepareOpLayerFromService(k,1).then(function(a,c){d[a]=c;0===--g&&b()}.bind(this,l),function(a,d){c[a]=d;0===--g&&b()}.bind(this,l)):(d[l]={layerType:h.extrapolateTypeFromLayerInstance(k.layer)},0===--g&&b())}0===
a.length&&b();return f.promise}function I(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];"ArcGISTiledMapServiceLayer"!==d.layerType&&("ArcGISTiledImageServiceLayer"!==d.layerType&&"ArcGISTiledElevationServiceLayer"!==d.layerType&&"OpenStreetMap"!==d.layerType)&&b.push({msg:B.messages.onlyTiledLayerSupported,details:a[c].url})}if(0<b.length)throw H(b);}var G,J={},C={_basemapLayersEqual:function(a,b){return a.length!==b.length?!1:!!a.reduce(function(a,c,d){d=b.getItemAt(d);return a&&d&&d instanceof
c.constructor&&c.url===d.url},!0)},equals:function(a,b){return!b?!1:C._basemapLayersEqual(a.baseLayers,b.baseLayers)&&C._basemapLayersEqual(a.referenceLayers,b.referenceLayers)&&C._basemapLayersEqual(a.elevationLayers,b.elevationLayers)},turnOnElevation:function(a){var b=a.basemap;b.elevationLayers&&0<b.elevationLayers.length||(b?b.elevationLayers=b._elevationLayersCache&&0<b._elevationLayersCache.length?b._elevationLayersCache:[C.DefaultElevationLayer]:a.basemap=new l({elevationLayers:[C.DefaultElevationLayer]}))},
turnOffElevation:function(a){var b=a.basemap;b&&(b._elevationLayersCache=b.get("elevationLayers").getAll(),b.elevationLayers=[],0===b.baseLayers.length&&(a.basemap=null))},_copyBasemapLayers:function(a,b){return b.map(function(b){var c=a.find(function(a){return b instanceof a.constructor&&a.url===b.url});return c?c:b})},fixSSL:function(a,b){function c(a){Array.isArray(a)&&a.forEach(function(a){a.url=h.useSSLIfRequired(a.url,b)})}b||(b=C.portal);c(a.baseMapLayers);c(a.elevationLayers);c(a.referenceLayers)},
fixJSON:function(a,b){var c=d.clone(a);Array.isArray(c.baseMapLayers)&&c.baseMapLayers.forEach(function(a){!a.layerType&&a.type&&(a.layerType=a.type,delete a.type);!a.urlTemplate&&a.templateUrl&&(a.urlTemplate=a.templateUrl)});this.fixSSL(c,b);return c},fromJSON:function(a,b){try{return l.fromJSON(this.fixJSON(a,b))}catch(c){throw Error("");}},fromJSONAndCopySubLayers:function(a,b,c){b=this.fromJSON(b);a&&(b.baseLayers=C._copyBasemapLayers(a.baseLayers,b.baseLayers),b.elevationLayers=c?a.elevationLayers:
C._copyBasemapLayers(a.elevationLayers,b.elevationLayers),b.referenceLayers=C._copyBasemapLayers(a.referenceLayers,b.referenceLayers));return b},_handleBasemapSetError:function(a,b){if(!a.map.isFulfilled()){var d=C.spatialReferenceLocked?a.map.spatialReference:g.WebMercator,h=new x({spatialReference:d,id:"__basemapErrorFallbackLayer__"});if(!r.canProject(h.fullExtent,h.spatialReference)){var l=5E4*z.getUnitValueForSR(h.spatialReference);h.fullExtent=new t({xmin:-l,xmax:l,ymin:-l,ymax:l,spatialReference:h.spatialReference})}a.map.spatialReference=
d;if("planar"===a.globeMode)c.once(a,"fullExtent",function(){a.map.remove(h);setTimeout(function(){a.extent=a.fullExtent},0)});else a.then(function(){a.map.remove(h)});a.map.add(h)}if(b&&b.errors)for(d=0;d<b.errors.length;d++)l=b.errors[d],f.show({message:B.dialogs.unsupportedBasemap,type:f.MessageTypes.ERROR,details:(l.msg||l.message)+(l.details?"\n"+l.details:"")});else b&&f.show({message:B.dialogs.unsupportedBasemap,type:f.MessageTypes.ERROR,details:(b.msg||b.message)+(b.details?"\n"+b.details:
"")})},validateAndSet:function(a,d,h,g){var l=a.map;G&&(G.cancel(J),G=null);if(d&&C.equals(d,l.basemap))h!==a.basemapTransparency&&C.applyTransparency(a,h);else{if(d){var r=new b;r.addItems(d.baseLayers);r.addItems(d.referenceLayers);r.addItems(d.elevationLayers);var m;return m=G=k(r.getAll()).then(A).then(O).then(I).then(function(){if(G===m||void 0===m){G=null;var b=this.getBasemapSR(d),p=!1;if(b&&(!b.equals(a.map.spatialReference)||!this._tilingSchemeEquals(d,a)))if(this._allowBasemapToSwitchSR(g,
a))p=d.baseLayers&&0<d.baseLayers.length&&d.baseLayers.getItemAt(0).fullExtent,this._resetView(a.map,b),n.pingGeometryService(p.center),p=!0;else{f.show({message:B.messages.selectedBasemapMismatchTitle,type:f.MessageTypes.ERROR,details:B.messages.selectedBasemapMismatch});return}0===d.baseLayers.length&&0===d.elevationLayers.length&&(d=null);if(l.basemap=d)this.checkAndSetDefaultElevationAvailability(a,p),(b=C.getFirstLayer(d))&&w.adjustLightForLayer(a,b);c.whenOnce(a,"ready",function(){l.basemap===
d&&C.applyTransparency(a,h)})}}.bind(this),function(b){if(b!==J&&(G===m||void 0===m))G=null,C._handleBasemapSetError(a,b)})}this._handleBasemapSetError(a,null)}},checkAndSetDefaultElevationAvailability:function(a,b){var c=a.map;try{C._checkDefaultElevationCompatibility(a),b&&C.turnOnElevation(c)}catch(d){C.turnOffElevation(c)}},_checkDefaultElevationCompatibility:function(a){var b=a.map.basemap,c=a.spatialReference,d;b?d=(b=b.elevationLayers&&0<b.elevationLayers.length?b.elevationLayers.getItemAt(0):
b._elevationLayersCache&&0<b._elevationLayersCache.length?b._elevationLayersCache[0]:C.DefaultElevationLayer)?b.spatialReference:null:(b=C.DefaultElevationLayer,d=C.DefaultElevationLayer.spatialReference);if(d&&c&&!d.equals(c))throw{msg:B.messages.elevationBasemapTitle,details:B.messages.elevationBasemapSR};a=a.basemapTerrain?a.basemapTerrain.tilingScheme:null;c=b?b.tileInfo:null;if(a&&c&&!a.compatibleWith(c))throw{msg:B.messages.elevationBasemapTitle,details:B.messages.elevationBasemapTS};},getBasemapTS:function(b){return(b=
b.baseLayers&&b.baseLayers.length?b.baseLayers.getItemAt(0):null)?new a(b.tileInfo):null},_allowBasemapToSwitchSR:function(a,b){var c=!b.map.layers.some(function(a){return"__basemapErrorFallbackLayer__"!==a.id&&"SilentContentLayer"!==a.id});return!a&&!C.spatialReferenceLocked&&c},_tilingSchemeEquals:function(a,b){var c=a.baseLayers&&a.baseLayers.items.length?a.baseLayers.items[0]:null;return c?b.basemapTerrain&&b.basemapTerrain.tilingScheme?b.basemapTerrain.tilingScheme.compatibleWith(c.tileInfo):
!0:!0},_resetView:function(a,b){b=b instanceof g?b.clone():g.fromJSON(b);a.basemap&&(a.basemap=null);a.spatialReference=b.clone()},setFromJSON:function(a,b,c,d){var f,h=a.map;try{f=C.fromJSONAndCopySubLayers(h.basemap,b,c)}catch(g){C._handleBasemapSetError(a,g);return}return C.validateAndSet(a,f,b.transparency,d)},isBasemapGlobalCapable:function(a){return 0<a.baseMapLayers.length&&a.baseMapLayers[0].resourceInfo?(a=a.baseMapLayers[0].resourceInfo.spatialReference,a instanceof g||(a=g.fromJSON(a)),
a.isWebMercator()):!0},getJsonBasemapSR:function(a){return 0<a.baseMapLayers.length&&a.baseMapLayers[0].resourceInfo?(a=a.baseMapLayers[0].resourceInfo.spatialReference,a instanceof g||(a=g.fromJSON(a)),a):g.WebMercator},getBasemapSR:function(a){if(a){if(a.baseLayers&&0<a.baseLayers.length&&a.baseLayers.getItemAt(0).spatialReference)return a.baseLayers.getItemAt(0).spatialReference;if(a.elevationLayers&&0<a.elevationLayers.length&&a.elevationLayers.getItemAt(0).spatialReference)return a.elevationLayers.getItemAt(0).spatialReference}return null},
_basemapLayersToJSON:function(a,b,c){a.forEach(function(a){var d={id:a.id},f=h.extrapolateTypeFromLayerInstance(a);"OpenStreetMap"!==f&&(d.url=a.url);null!=f&&(d.layerType=f);c&&(d.isReference=!0);b.push(d)});return b},toJSON:function(a,b){var c;b?(c={},c.visibility=b.visibility,null!=b.id&&(c.id=b.id),null!=b.title&&(c.title=b.title),c.baseMapLayers=[],C._basemapLayersToJSON(b.baseLayers,c.baseMapLayers),C._basemapLayersToJSON(b.referenceLayers,c.baseMapLayers,!0),c.elevationLayers=[],C._basemapLayersToJSON(b.elevationLayers,
c.elevationLayers)):c={id:"empty-basemap",baseMapLayers:[],elevationLayers:[]};void 0!==a.basemapTransparency&&0!==a.basemapTransparency&&(c.transparency=a.basemapTransparency);return c},applyTransparency:function(a,b){void 0!==b&&0!==b?(a.basemapTerrain.opacity=0.99,a.basemapTerrain.wireframe={mode:"shader",wireOpacity:1,surfaceOpacity:0,width:1,subdivision:"constant",subdivisionReduceLevels:2},a.basemapTerrain.frontMostTransparent=!0):(a.basemapTerrain.wireframe=!1,a.basemapTerrain.frontMostTransparent=
!1,a.basemapTerrain.opacity=1);a.basemapTransparency=b},getFirstLayer:function(a){return a.baseLayers&&a.baseLayers.getItemAt(0)||a.elevationLayers&&a.elevationLayers.getItemAt(0)},portal:null,spatialReferenceLocked:!1};C.defaultArcGISWorldElevationService=location.protocol+"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer";C.DefaultElevationLayer=new q({id:"globalElevation",url:C.defaultArcGISWorldElevationService});C.DefaultBasemapJson={baseMapLayers:[{id:"worldTopoBase",
opacity:1,visibility:!0,url:location.protocol+"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer"}],elevationLayers:[{id:"globalElevation",url:C.defaultArcGISWorldElevationService,layerType:"ArcGISTiledElevationServiceLayer"}],title:"Topographic"};return C})},"webSceneViewer/spatialReferenceUtils":function(){define("dojo/Deferred esri/config esri/geometry/SpatialReference esri/geometry/support/scaleUtils esri/tasks/support/ProjectParameters webSceneViewer/widgets/MessageListWidget/MessageListWidget dojo/i18n!webSceneViewer/nls/viewer".split(" "),
function(k,m,d,q,c,g,h){var l={isGeographicCRS:function(b){return 1E5<q.getUnitValueForSR(b)},projectLayerExtentToSceneSR:function(b,d){m.geometryService&&require(["dojo/on"],function(d){d.once(b,"load",function(){var d=b.fullExtent;if(d){var f=window._webSceneViewerView.map.spatialReference;if(!d.spatialReference.equals(f)){var a=m.geometryService,h=new c;h.geometries=[d];h.outSR=f.clone();a.project(h).then(function(a){a&&0<a.length&&b.set("fullExtent",a[0])})}}})})},getLatitudeOfPoint:function(b){var f=
new k,h=b.latitude;if(h)f.resolve(h);else{var h=m.geometryService,g=new c;g.geometries=[b];g.outSR=d.WGS84;h.project(g).then(function(b){b&&0<b.length?f.resolve(b[0].y):f.reject()},function(){f.reject()})}return f.promise},pingGeometryService:function(b){l.getLatitudeOfPoint(b).otherwise(function(b){g.show({message:h.messages.geometryServiceUnavailableTitle,type:g.MessageTypes.ERROR,details:h.messages.geometryServiceUnavailable})})}};return l})},"webSceneViewer/widgets/Settings/Settings":function(){define("esri/core/declare dojo/dom-class dojo/on dijit/form/RadioButton dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/Settings.html esri/views/3d/navigation/EventController esri/core/watchUtils dojo/i18n!../nls/widgets".split(" "),
function(k,m,d,q,c,g,h,l,b,f){return k([c,g],{view:void 0,templateString:h,constructor:function(b,c){},destroy:function(){},postCreate:function(){this.mouseNavigation.textContent=f.settings.navigation;this.WSVNavigationLabel.textContent=f.settings.sceneNav;this.WSVNavigationLabel.title=f.settings.sceneNav;this.ProNavigationLabel.textContent=f.settings.proNav;this.ProNavigationLabel.title=f.settings.proNav;this.navigationImage.title=f.settings.mouseImage;var c=new q({name:"mouse_navigation_radiogroup"},
this.WSVNavigationRadioButton),h=new q({name:"mouse_navigation_radiogroup"},this.ProNavigationRadioButton);this.own(b.whenOnce(this.view,"navigationController",function(b){b=b.getControls();b=b===l.PRO_PAN||b===l.PRO_TUMBLE;c.set("checked",!b);h.set("checked",b)}));this.own(d(h,"change",function(b){this._navigationModeChanged(b)}.bind(this)));this.startup()},primaryNavigationChanged:function(b){b?m.add(this.navigationImage,"primRotation"):m.remove(this.navigationImage,"primRotation")},_navigationModeChanged:function(b){"pan"===
this.view.navigationController.getControls().mouseDragLeft?this.view.navigationController.setControls(b?l.PRO_PAN:l.PAN):this.view.navigationController.setControls(b?l.PRO_TUMBLE:l.TUMBLE);b?m.add(this.navigationImage,"proNav"):m.remove(this.navigationImage,"proNav");this.emit("nav-mode-change")}})})},"dojox/gfx":function(){define(["dojo/_base/lang","./gfx/_base","./gfx/renderer!"],function(k,m,d){m.switchTo(d);return m})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff",
"dojo/dom-construct","./ValidationTextBox"],function(k,m,d,q){return k("dijit.form.MappedTextBox",q,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(c){return c.toString?c.toString():""},toString:function(){var c=this.filter(this.get("value"));return null!=c?"string"==typeof c?c:this.serialize(c,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);
this.valueNode=d.place("\x3cinput type\x3d'hidden'"+(this.name&&!m("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"webSceneViewer/widgets/BasemapGallery/BasemapGallery":function(){define("esri/core/declare dojo/_base/lang dojo/dom-construct dojo/dom dojo/on dojo/when dojo/dom-class esri/widgets/BasemapGallery esri/core/watchUtils esri/layers/OpenStreetMapLayer esri/layers/WebTiledLayer esri/views/3d/terrain/TilingScheme esri/layers/support/TileInfo esri/geometry/SpatialReference ../Switch/Switch webSceneViewer/basemapUtils dojo/i18n!../nls/widgets".split(" "),
function(k,m,d,q,c,g,h,l,b,f,n,s,x,a,r,z,t){return k(null,{name:"BasemapGallery",baseClass:"BasemapGallery",_onHandles:void 0,view:void 0,_basemapIdMapping:[null,"ocean","natgeo","gray","terrain","topo","street","imageryWithLabels","satellite"],_sceneSRLocked:!1,constructor:function(a,f){this._onHandles=[];this._compatibilityPromises=[];m.mixin(this,{content:d.create("div",{"class":"BasemapGallery"},f),map:a.map,webscene:a.webscene,portal:a.portal,_sceneSRLocked:a._sceneSRLocked});this.view=a.view;
var g=f.nextSibling;h.add(f,"underground");h.add(g,"undergroundContainer");this._onHandles.push(this.view.watch("basemapTerrain.tilingScheme",function(){this._disableIncompatibleBasemaps()}.bind(this)));d.create("h3",{className:"text"},g).textContent=t.underground.seeThroughGround;this._underGroundSwitch=new r({switchOn:!1});this._underGroundSwitch.placeAt(g);this._underGroundSwitch.startup();this._onHandles.push(c(this._underGroundSwitch,"toggle",function(a){a.on?z.applyTransparency(this.view,100):
z.applyTransparency(this.view,0)}.bind(this)));this._onHandles.push(b.init(this.view,"basemapTerrain.wireframe",function(a){a?this._underGroundSwitch.turnOn():this._underGroundSwitch.turnOff()}.bind(this)));this.map=a.map;this._updateContent()},destroy:function(){this._basemapGallery&&this._basemapGallery.destroy();this._onHandles.forEach(function(a){a.remove()});this._onHandles.length=0},changeBasemap:function(a){var b={baseMapLayers:[],elevationLayers:[],title:a.title,id:a.id,transparency:this._underGroundSwitch.switchOn?
100:0};a.layers.forEach(function(a){var c={id:a.id,isReference:a.isReference,layerType:a.layerType||a.type};"OpenStreetMap"===c.layerType?c.urlTemplate=a.urlTemplate||a.templateUrl:"WebTiledLayer"===c.layerType?(c.urlTemplate=a.urlTemplate||a.templateUrl,c.subDomains=a.subDomains):c.url=a.url;b.baseMapLayers.push(c)});this.map.basemap&&this.map.basemap.elevationLayers.forEach(function(a){b.elevationLayers.push({id:a.id,url:a.url,layerType:a.layerType||a.type})});z.setFromJSON(this.view,b,null,this._sceneSRLocked)},
_updateContent:function(){var a=this,b=d.create("div",{"class":"basemapGallery",style:"width:200px; height:200px"},this.content);this.map.layerIds=[1];this._compatibilityPromises.forEach(function(a){a.cancel()});this._compatibilityPromises=[];this._basemapGallery=new l({"class":"basemapGallery_viewer",showArcGISBasemaps:!0,map:this.map,portalUrl:this.portal&&(this.portal.url.replace(/\/sharing\/rest\/*/,"")||this.portal.portalHostname)},b);this._basemapGallery.startup();this._basemapGallery._switchBasemapLayers=
function(b){a.changeBasemap(b)};this._basemapGallery._removeReferenceLayer=function(){};this._basemapGallery._addReferenceLayer=function(){};c(this._basemapGallery,"load",function(a){a=[];for(var b=0;b<this._basemapGallery.basemaps.length;b++)"USGS National Map"===this._basemapGallery.basemaps[b].title&&a.push(this._basemapGallery.basemaps[b].id);for(b=0;b<a.length;b++)this._basemapGallery.remove(a[b]);this._disableIncompatibleBasemaps()}.bind(this))},_disableIncompatibleBasemap:function(b){return g(b.getLayers(this._basemapGallery.arcgisUrl)).then(function(){for(var a=
b.layers;0<a.length;){var c=a[0];if(!c.isReference&&(c.url||c.type)){if(c.type)return{layer:c};if("https:"==location.protocol&&(this._basemapGallery._isAgolService(c.url)||this._basemapGallery._isHostedService(c.url)))c.url=c.url.replace("http:","https:");return this._basemapGallery._getServiceInfo(c.url).then(function(a){return{layer:c,serviceInfo:a}})}throw Error("Could not find any layers");}}.bind(this)).then(function(b){var c;c="OpenStreetMap"===b.layer.type?(new f).tileInfo:"WebTiledLayer"===
b.layer.type?(new n({urlTemplate:b.layer.templateUrl||b.layer.urlTemplate,subDomains:b.layer.subDomains})).tileInfo:x.fromJSON(b.serviceInfo.tileInfo);var d=this.view.get("basemapTerrain.tilingScheme");if(d&&!d.compatibleWith(c)){d=a.WebMercator;"OpenStreetMap"!==b.layer.type&&(d=b.serviceInfo.spatialReference instanceof a?b.serviceInfo.spatialReference:a.fromJSON(b.serviceInfo.spatialReference));if(d.equals(this.map.spatialReference)){if(s._checkUnsupported(c))throw Error("planar"===this.view.globeMode?
t.basemapGallery.TSMismatch:t.basemapGallery.TilingScheme);throw Error(t.basemapGallery.TilingScheme);}throw Error("planar"===this.view.globeMode?t.basemapGallery.SRMismatch:t.basemapGallery.SRMismatchGlobal);}}.bind(this)).then(function(){var a=q.byId(this._basemapGallery.id+"_galleryNode_"+b.id);h.remove(a,"incompatible");a.title=""}.bind(this)).otherwise(function(a){var c=q.byId(this._basemapGallery.id+"_galleryNode_"+b.id);h.add(c,"incompatible");c.title=a.message}.bind(this))},_disableIncompatibleBasemaps:function(){!this._sceneSRLocked&&
"spherical"!==this.view.globeMode||(!this._basemapGallery||!this._basemapGallery.loaded||!this.view.get("basemapTerrain.tilingScheme"))||(this._compatibilityPromises.forEach(function(a){a.cancel()}),this._compatibilityPromises=[],this._basemapGallery.basemaps.forEach(function(a){this._compatibilityPromises.push(this._disableIncompatibleBasemap(a))}.bind(this)))},updateSceneSRLocked:function(a){a!==this._sceneSRLocked&&(this._sceneSRLocked=a,this._disableIncompatibleBasemaps())}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(k,m,d,q,c,g,h,l,b,f,n,s){h=k("dijit.MenuItem"+(g("dojo-bidi")?"_NoBidi":""),[l,b,f,n],{templateString:s,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(b){this._set("label",b);var a="",c;c=b.search(/{\S}/);if(0<=c){var a=b.charAt(c+1),d=b.substr(0,c);b=b.substr(c+3);c=d+a+b;b=d+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+a+"\x3c/span\x3e"+b}else c=b;this.domNode.setAttribute("aria-label",c+" "+this.accelKey);this.containerNode.innerHTML=b;this._set("shortcutKey",a)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(b){b&&!("label"in this.params)&&this._set("label",b.innerHTML)},buildRendering:function(){this.inherited(arguments);d.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&d.set(this.accelKeyNode,"id",this.id+"_accel");m.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==g("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(b){}},_setSelected:function(b){q.toggle(this.domNode,
"dijitMenuItemSelected",b)},setLabel:function(b){c.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",b)},setDisabled:function(b){c.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",b)},_setDisabledAttr:function(b){this.focusNode.setAttribute("aria-disabled",b?"true":"false");this._set("disabled",b)},_setAccelKeyAttr:function(b){this.accelKeyNode&&(this.accelKeyNode.style.display=
b?"":"none",this.accelKeyNode.innerHTML=b,d.set(this.containerNode,"colSpan",b?"1":"2"));this._set("accelKey",b)}});g("dojo-bidi")&&(h=k("dijit.MenuItem",h,{_setLabelAttr:function(b){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return h})},"esri/tasks/Locator":function(){define("dojo/_base/array ../core/declare dojo/_base/lang ../request ./Task ./support/AddressCandidate".split(" "),function(k,m,d,q,c,g){return m(c,{declaredClass:"esri.tasks.Locator",categories:null,
countryCode:null,outSpatialReference:null,url:null,addressToLocations:function(c,g,b){var f,k,m,x,a,r,z;c.address&&(g=c.outFields,b=c.searchExtent,z=c.countryCode,f=c.magicKey,k=c.distance,r=c.categories,c.location&&this.normalization&&(m=c.location.normalize()),x=c.maxLocations,a=c.forStorage,c=c.address);b&&(b=b.shiftCentralMeridian());var t=this.outSpatialReference;c=this._encode(d.mixin({},this.parsedUrl.query,c,{f:"json",outSR:t&&JSON.stringify(t.toJSON()),outFields:g&&g.join(",")||null,searchExtent:b&&
JSON.stringify(b.toJSON()),category:r&&r.join(",")||null,countryCode:z||null,magicKey:f||null,distance:k||null,location:m||null,maxLocations:x||null,forStorage:a||null}));return q({url:this.parsedUrl.path+"/findAddressCandidates",content:c,callbackParamName:"callback"}).then(this._handleAddressToLocationsResponse)},_handleAddressToLocationsResponse:function(c){var d=c.spatialReference,b;return(c.candidates||[]).map(function(c){if(b=c.location)b.spatialReference=d;return g.fromJSON(c)})},suggestLocations:function(c){c.hasOwnProperty("location")&&
this.normalization&&(c.location=c.location.normalize());c.searchExtent&&(c.searchExtent=c.searchExtent.shiftCentralMeridian());c=this._encode(d.mixin({},this.parsedUrl.query,{f:"json",text:c.text,searchExtent:c.searchExtent&&JSON.stringify(c.searchExtent.toJSON()),category:c.categories&&c.categories.join(",")||null,location:c.location||null,distance:c.distance||null},{f:"json"}));return q({url:this.parsedUrl.path+"/suggest",content:c,callbackParamName:"callback"}).then(this._handleSuggestLocationsResponse)},
_handleSuggestLocationsResponse:function(c){return c.suggestions||[]},addressesToLocations:function(c){var g=this.outSpatialReference,b=[],f=c.categories,m=c.countryCode;k.forEach(c.addresses,function(c,d){b.push({attributes:c})});c=this._encode(d.mixin({},this.parsedUrl.query,{category:f&&f.join(",")||null,sourceCountry:m||null},{addresses:JSON.stringify({records:b})},{f:"json",outSR:g&&JSON.stringify(g.toJSON())}));return q({url:this.parsedUrl.path+"/geocodeAddresses",content:c,callbackParamName:"callback"}).then(this._handleAddressesToLocationsResponse)},
_handleAddressesToLocationsResponse:function(c){var d=c.spatialReference,b;return(c.locations||[]).map(function(c){if(b=c.location)b.spatialReference=d;return g.fromJSON(c)})},locationToAddress:function(c,g){c&&this.normalization&&(c=c.normalize());var b=this.outSpatialReference,b=this._encode(d.mixin({},this.parsedUrl.query,{outSR:b&&JSON.stringify(b.toJSON()),location:c&&JSON.stringify(c.toJSON()),distance:g,f:"json"}));return q({url:this.parsedUrl.path+"/reverseGeocode",content:b,callbackParamName:"callback"}).then(this._handleLocationToAddressResponse)},
_handleLocationToAddressResponse:function(c){return g.fromJSON({address:c.address,location:c.location,score:100})}})})},"dojox/gfx/renderer":function(){define(["./_base","dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/_base/config"],function(k,m,d,q,c){var g=null;d.add("vml",function(c,d,b){b.innerHTML='\x3cv:shape adj\x3d"1"/\x3e';c="adj"in b.firstChild;b.innerHTML="";return c});return{load:function(h,l,b){function f(){l(["dojox/gfx/"+n],function(a){k.renderer=n;g=a;b(a)})}if(g&&"force"!=
h)b(g);else{var n=c.forceGfxRenderer;h=!n&&(m.isString(c.gfxRenderer)?c.gfxRenderer:"svg,vml,canvas,silverlight").split(",");for(var s,x;!n&&h.length;)switch(h.shift()){case "svg":"SVGAngle"in q.global&&(n="svg");break;case "vml":d("vml")&&(n="vml");break;case "silverlight":try{d("ie")?(s=new ActiveXObject("AgControl.AgControl"))&&s.IsVersionSupported("1.0")&&(x=!0):navigator.plugins["Silverlight Plug-In"]&&(x=!0)}catch(a){x=!1}finally{s=null}x&&(n="silverlight");break;case "canvas":q.global.CanvasRenderingContext2D&&
(n="canvas")}"canvas"===n&&!1!==c.canvasEvents&&(n="canvasWithEvents");c.isDebug&&console.log("gfx renderer \x3d "+n);"svg"==n&&"undefined"!=typeof window.svgweb?window.svgweb.addOnLoad(f):f()}}}})},"webSceneViewer/widgets/MessageListWidget/MessageWidget":function(){define("esri/core/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/dom-class dojo/on dojo/_base/fx dojo/text!./templates/MessageWidget.html".split(" "),function(k,m,d,q,c,g,h){return k([m,d],{declaredClass:"MessageWidget",MessageTypes:{INFO:"info",
SUCCESS:"success",WARNING:"warning",ERROR:"error"},templateString:h,message:void 0,details:void 0,type:void 0,timeout:void 0,collapsed:!1,constructor:function(c){},_remove:function(){clearTimeout(this.timer);var d=g.fadeOut({node:this.domNode,duration:500}).play();c.once(d,"End",function(b,c){this.destroy()}.bind(this))},postCreate:function(){if(void 0===this.type||this.type!==this.MessageTypes.INFO&&this.type!==this.MessageTypes.SUCCESS&&this.type!==this.MessageTypes.WARNING&&this.type!==this.MessageTypes.ERROR)this.type=
this.MessageTypes.INFO;void 0===this.collapsed&&(this.collapsed=!1);void 0===this.timeout&&(this.timeout=this.type===this.MessageTypes.ERROR?0:1E4);q.add(this.domNode,this.type);this.MessageShortDesc.innerHTML=this.message;this.MessageShortDesc.title=this.message;this.details&&""!==this.details?this.MessageDetails.innerHTML=this.details:(q.add(this.ExpandIcon,"hide"),q.add(this.MessageDetails,"hide"));this.collapsed&&q.add(this.domNode,"collapsed");q.add(this.MessageTypeIcon,this.type+"Icon");0<this.timeout&&
(this.timer=setTimeout(function(){this._remove()}.bind(this),this.timeout));g.fadeIn({node:this.domNode,duration:500}).play()},_expand:function(c){if(""!==this.details&&(c=c.target?c.target:c.srcElement,-1===c.className.indexOf("closeIcon")))if(-1===c.className.indexOf("MessageWidget")&&(c=c.parentNode),-1!==c.className.indexOf("expand"))q.remove(c,"expand");else for(var b=c.parentNode,d=0;d<b.childNodes.length;d++){var g=b.childNodes[d];g===c?q.add(g,"expand"):q.remove(g,"expand")}}})})},"esri/widgets/Legend":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/array dojo/_base/Color dojo/has dojo/number dojo/on dojo/dom dojo/dom-construct dojo/dom-style dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../request ../core/declare ../core/lang ../core/promiseList ../core/screenUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/support/jsonUtils ../symbols/support/gfxUtils ./Widget dojo/i18n!../nls/jsapi dojo/i18n!dojo/cldr/nls/number".split(" "),
function(k,m,d,q,c,g,h,l,b,f,n,s,x,a,r,z,t,w,B,H,A,O,I,G,J,C,K,Q,N,F,R,M,U){var L=z([R,n],{declaredClass:"esri.widgets.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,gradientWidth:34,colorRampBorder:"1px solid",reZeros:RegExp("\\"+U.decimal+"0+$","g"),reZerosFractional:/(\d)0*$/g,_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,_viewWatch:null,constructor:function(a,
b){m.mixin(this,M.widgets.legend);this._updateAllMapLayers=m.hitch(this,this._updateAllMapLayers);this._refreshLayers=m.hitch(this,this._refreshLayers);a=a||{};a.map=a.view.map;a.map?b?(this.basePath=require.toUrl("esri/widgets/"),this.map=a.map,this.layerInfos=a.layerInfos,this._respectCurrentMapScale=!1===a.respectCurrentMapScale?!1:!0,this.arrangement=a.arrangement===L.ALIGN_RIGHT?L.ALIGN_RIGHT:L.ALIGN_LEFT,this.arrangement===L.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===a.autoUpdate?
!1:!0,this._surfaceItems=[],this._handles=[]):console.error("esri.widgets.Legend: must specify a container for the legend"):console.error("esri.widgets.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);var a=["ar","he"],b,c;for(b=0;b<a.length;b+=1)c=a[b],k.locale&&-1!==k.locale.indexOf(c)&&(-1!==k.locale.indexOf("-")?-1!==k.locale.indexOf(c+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?
"left":"right",this._legendAlign=this.alignRight?"esri-legend-left":"esri-legend-right"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esri-legend-right":"esri-legend-left")},startup:function(){this.inherited(arguments);this.layers=null;this.view?(this._initialize(),9>c("ie")&&(this._repaintItems=m.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))):this._viewWatch||(this._viewWatch=this.map.watch("view",function(){this._viewWatch.remove();
this._initialize();9>c("ie")&&(this._repaintItems=m.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))}.bind(this)))},destroy:function(){this._deactivate();this._removeHoverHandlers();this.inherited(arguments)},refresh:function(a){if(this.domNode){a?(this.layerInfos=a,this.layers=[],d.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&a.layer.showLegend&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,
a.hideLayers?(a.layer._hideLayersInLegend=a.hideLayers,this._addSubLayersToHide(a)):a.layer._hideLayersInLegend=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)b.destroy(this.domNode.children[a]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&
(this.layers=[],d.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&a.layer.showLegend&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(a.layer._hideLayersInLegend=a.hideLayers,this._addSubLayersToHide(a)):a.layer._hideLayersInLegend=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=
!0;this.layers=[];for(var a=0;a<this.map.layers.get("length");a++){var b=this.map.layers.getItemAt(a);if(b.showLegend)if(b.layers)for(var c=0;c<b.layers.get("length");c++){var f=b.layers.getItemAt(c);f.showLegend&&this._initializeLayer(f)}else this._initializeLayer(b)}}this._createLegend()},_initializeLayer:function(a){this._isSupportedLayerType(a)&&(a.title&&(a._titleForLegend=a.title),this.layers.push(a))},_activate:function(){if(this.autoUpdate){this._respectCurrentMapScale&&(this._ozeConnect=
this.map.on("zoom-end",this._refreshLayers.bind(this)));if(this.useAllMapLayers){this._handles.push(this.view.layerViewsFlat.on("change",this._updateAllMapLayers));this._handles.push(this.map.on("layer-add",this._updateAllMapLayers));this._handles.push(this.map.on("layer-remove",this._updateAllMapLayers));this._handles.push(this.map.on("layer-reorder",this._updateAllMapLayers));for(var a=0;a<this.map.layers.get("length");a++){var b=this.map.layers.getItemAt(a);if(b.layers){this._handles.push(h(b,
"layer-add",this._updateAllMapLayers));this._handles.push(h(b,"layer-remove",this._updateAllMapLayers));this._handles.push(h(b,"layer-reorder",this._updateAllMapLayers));for(var c=0;c<b.layers.get("length");c++){var f=b.layers.getItemAt(c);f.watch("scaleRange",this._refreshLayers);this._handles.push(f.watch("renderer",this._refreshLayers));this._handles.push(f.watch("title",this._refreshLayers));this._handles.push(f.watch("showLegend",this._refreshLayers));this._handles.push(f.watch("opacity",this._refreshLayers))}}this._handles.push(b.watch("renderer",
this._refreshLayers));this._handles.push(b.watch("title",this._refreshLayers));this._handles.push(b.watch("showLegend",this._refreshLayers));this._handles.push(b.watch("scaleRange",this._refreshLayers));this._handles.push(b.watch("opacity",this._refreshLayers))}}d.forEach(this.layers,function(a){},this)}},_deactivate:function(){this._handles.forEach(function(a){a.remove()});this._handles.length=0;this._ozeConnect&&this._ozeConnect.remove();d.forEach(this.layers,function(a){a.ovcConnect&&a.ovcConnect.remove();
a.oscConnect&&a.oscConnect.remove();a.odcConnect&&a.odcConnect.remove();a.oirConnect&&a.oirConnect.remove()},this)},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_isLayerVisible:function(a){return!this.view.getLayerView(a).get("suspended")},_updateAllMapLayers:function(){this.layers=[];for(var a=0;a<this.map.layers.get("length");a++){var b=
this.map.layers.getItemAt(a);if(b.layers)for(var c=0;c<b.layers.get("length");c++){var d=b.layers.getItemAt(c);this._initializeLayer(d)}else this._initializeLayer(b)}this.refresh()},_createLegend:function(){this._deactivate();var a=!1;f.set(this.domNode,"position","relative");b.create("div",{id:this.id+"_msg",className:"esri-legend-msg",innerHTML:0===this.layers.length?"":this.NLS_creatingLegend+"..."},this.domNode);var c=[];d.forEach(this.layers,function(e){if("esri.layers.KMLLayer"==e.declaredClass||
"esri.layers.GeoRSSLayer"==e.declaredClass){var f;this.view.getLayerView(e)&&(this._addLayerViewSuspendWatch(e),"esri.layers.KMLLayer"==e.declaredClass?f=e.getLayers():"esri.layers.GeoRSSLayer"==e.declaredClass&&(f=e.getFeatureLayers(),e._hideLayersInLegend&&(f=d.filter(f,function(a){return-1==d.indexOf(e._hideLayersInLegend,a.id)}))),d.forEach(f,function(a){"esri.layers.FeatureLayer"==a.declaredClass&&e._titleForLegend&&(a._titleForLegend=e._titleForLegend+" - ","esriGeometryPoint"==a.geometryType?
a._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==a.geometryType?a._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==a.geometryType&&(a._titleForLegend+=this.NLS_polygons),c.push(a))},this))}else if("esri.layers.WMSLayer"===e.declaredClass){if(this.view.getLayerView(e)&&(this._addLayerViewSuspendWatch(e),this._isLayerVisible(e)&&0<e.layerInfos.length&&d.some(e.layerInfos,function(a){return a.legendURL}))){var g=!1;d.forEach(e.layerInfos,function(c){c.legendURL&&-1<d.indexOf(e.visibleLayers,
c.name)&&(g||(b.create("div",{innerHTML:"\x3cspan class\x3d'esri-legend-service-label'\x3e"+(e._titleForLegend||e.name||e.id)+"\x3c/span\x3e"},this.domNode),g=!0),b.create("div",{innerHTML:"\x3cimg src\x3d'"+c.legendURL+"'/\x3e"},this.domNode),a=!0)},this)}}else c.push(e)},this);var g=[],h=!1;d.forEach(c,function(a){if(this.view.getLayerView(a)&&(this._addLayerViewSuspendWatch(a),!0===this._isLayerVisible(a)&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass))){var c=
b.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esri-legend-service"});b.create("span",{innerHTML:this._getServiceTitle(a),"class":"esri-legend-service-label"},b.create("td",{align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},c)))));b.place(c,this.id,"first");a.legendResponse||a.renderer?(this._createLegendForLayer(a),h=!0):g.push(this._legendRequest(a))}},this);h?this.emit("legend-change",{empty:!1}):this.emit("legend-change",{empty:!0});0===
g.length&&!a?(l.byId(this.id+"_msg")&&(l.byId(this.id+"_msg").innerHTML=""),this._activate()):w(g).then(m.hitch(this,function(a){l.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this.emit("legend-change",{empty:null===a});this._activate()}))},_addLayerViewSuspendWatch:function(a){a=this.view.getLayerView(a);this._handles.push(h(a,"suspend",function(){this._refreshLayers()}.bind(this)));this._handles.push(h(a,"resume",function(){this._refreshLayers()}.bind(this)))},_createLegendForLayer:function(a){if(a.legendResponse||
a.renderer){var b=!1;if(a.legendResponse){var c=a.dynamicLayerInfos||a.layerInfos;c&&c.length?d.forEach(c,function(c,e){if(!a._hideLayersInLegend||-1==d.indexOf(a._hideLayersInLegend,c.id)){var f=this._buildLegendItems(a,c,e);b=b||f}},this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(b=this._buildLegendItems(a,{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(c=a.url?a.url.substring(a.url.lastIndexOf("/")+1,a.url.length):"fc_"+a.id,b=this._buildLegendItems(a,
{id:c,name:null,subLayerIds:null,parentLayerId:-1},0));b&&(f.set(l.byId(this.id+"_"+a.id),"display","block"),f.set(l.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(this.view.getLayerView(a))return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a)},_legendRequestServer:function(a){var b=a.url,c=b.indexOf("?"),b=-1<c?b.substring(0,c)+"/legend"+b.substring(c):b+"/legend";(c=a.get("token"))&&(b+="?token\x3d"+c);var d=m.hitch(this,"_processLegendResponse"),
c={f:"json"};a._params||(a._params={});a._params.dynamicLayers&&(c.dynamicLayers=JSON.stringify(this._createDynamicLayers(a)),"[{}]"===c.dynamicLayers&&(c.dynamicLayers="[]"));a._params.bandIds&&(c.bandIds=a._params.bandIds);a._params.renderingRule&&(c.renderingRule=a._params.renderingRule);return r({url:b,content:c,callbackParamName:"callback",load:function(b,c){d(a,b,c)}})},_legendRequestTools:function(a){var b=a.url.toLowerCase().indexOf("/rest/"),b=a.url.substring(0,b)+a.url.substring(b+5,a.url.length),
b=this._legendUrl+"?soapUrl\x3d"+window.escape(b);if(!c("ie")||8<c("ie"))b+="\x26returnbytes\x3dtrue";var d=m.hitch(this,"_processLegendResponse");return r({url:b,content:{f:"json"},callbackParamName:"callback",load:function(b,c){d(a,b,c)}})},_processLegendResponse:function(a,c){c&&c.layers?(a.legendResponse=c,l.byId(this.id+"_"+a.id)&&b.empty(l.byId(this.id+"_"+a.id)),b.create("span",{innerHTML:this._getServiceTitle(a),"class":"esri-legend-service-label"},b.create("td",{align:this._align},b.create("tr",
{},b.create("tbody",{},b.create("table",{width:"95%"},l.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+JSON.stringify(c))},_buildLegendItems:function(a,c,d){var f=!1,e=l.byId(this.id+"_"+a.id),g=c.parentLayerId;if(c.subLayerIds)a=b.create("div",{id:this.id+"_"+a.id+"_"+c.id+"_group",style:{display:"none"},"class":-1==g?0<d?"esri-legend-group-layer":"":this._legendAlign},-1==g?e:l.byId(this.id+"_"+a.id+"_"+g+"_group")),b.create("td",
{innerHTML:c.name,align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%","class":"esri-legend-layer-label"},a))));else{if(a.visibleLayers&&-1==(","+a.visibleLayers+",").indexOf(","+c.id+","))return f;d=b.create("div",{id:this.id+"_"+a.id+"_"+c.id,style:{display:"none"},"class":-1<g?this._legendAlign:""},-1==g?e:l.byId(this.id+"_"+a.id+"_"+g+"_group"));b.create("td",{innerHTML:c.name||"",align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%",
"class":"esri-legend-layer-label"},d))));a.legendResponse?f=f||this._buildLegendItems_Tools(a,c,d):a.renderer&&(f=f||this._buildLegendItems_Renderer(a,c,d))}return f},_buildLegendItems_Tools:function(a,c,g){var h=c.parentLayerId,e=this.map.get("scale"),k=!1,m=function(a,b){var c,e;for(c=0;c<a.length;c++)if(b.dynamicLayerInfos)for(e=0;e<b.dynamicLayerInfos[e].length;e++){if(b.dynamicLayerInfos[e].mapLayerId==a[c].layerId)return a[c]}else if(b.id==a[c].layerId)return a[c];return{}};if(!this._respectCurrentMapScale||
this._respectCurrentMapScale&&this._isLayerInScale(a,c,e)){var r=!0;if("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass){var n=this._getEffectiveScale(a,c);if(n.minScale&&n.minScale<e||n.maxScale&&n.maxScale>e)r=!1}if(r){var e=m(a.legendResponse.layers,c),q=e.legendType,t=e.legend;if(t){this._sanitizeLegendResponse(e,c);g=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esri-legend-layer"},g);var z=b.create("tbody",
{},g);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(g,a,c);d.forEach(t,function(b){if(!(10.1<=a.version&&!b.values&&1<t.length&&(a._hideDefaultSymbol||"\x3call other values\x3e"===b.label||!b.label&&!("esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.3<=a.version))))if(b.url&&0===b.url.indexOf("http")||b.imageData&&0<b.imageData.length)k=!0,this._buildRow_Tools(b,z,a,c.id,q)},this)}}}k&&(f.set(l.byId(this.id+"_"+a.id+"_"+c.id),"display","block"),-1<h&&(f.set(l.byId(this.id+"_"+
a.id+"_"+h+"_group"),"display","block"),this._findParentGroup(a.id,a,h)));return k},_sanitizeLegendResponse:function(a,b){if(!a._sanitized){var c=m.getObject("layerDefinition.drawingInfo.renderer",!1,b),f=a.legend,e,g;d.some(f,function(a,b){a.values||(g=b,e=a);return!!e});e&&(c?"uniqueValue"===c.type?(f.splice(g,1),f.push(e)):"classBreaks"===c.type&&(f.splice(g,1),f.reverse(),f.push(e)):(f.splice(g,1),f.push(e)));a._sanitized=!0}},_buildRow_Tools:function(a,d,f,g,e){var h=b.create("tr",{},d),l;this.alignRight?
(d=b.create("td",{align:this._isRightToLeft?"left":"right"},h),l=b.create("td",{align:this._isRightToLeft?"left":"right",width:35},h)):(l=b.create("td",{width:35,align:"center"},h),d=b.create("td",{},h));h=a.url;(!c("ie")||9<=c("ie")||9>c("ie")&&"esri.layers.ArcGISImageServiceLayer"===f.declaredClass)&&a.imageData&&0<a.imageData.length?h="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(h=f.url+"/"+g+"/images/"+a.url,(g=f._getToken())&&(h+="?token\x3d"+g));g=b.create("img",{src:h,alt:"",
border:0,style:"opacity:"+f.opacity},l);a=b.create("td",{innerHTML:a.label,align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%",dir:"ltr"},d))));e&&("Stretched"===e&&10.3<=f.version&&"esri.layers.ArcGISImageServiceLayer"===f.declaredClass)&&(a.style.verticalAlign="top",a.style.lineHeight="1",g.style.marginBottom="-1px",g.style.display="block",d.style.verticalAlign="top");9>c("ie")&&(g.style.filter="alpha(opacity\x3d"+100*f.opacity+")")},_getVariable:function(a,b){return a?
a[b]||d.filter(a.visualVariables,function(a){return a.type===b})[0]:null},_buildLegendItems_Renderer:function(a,c,g){var h=c.parentLayerId,e=this.map,k=this.view.get("scale"),r=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,c,k)){var n,q,t="esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass?a.renderer.renderer:a.renderer,z,w,s,B,x;if(t instanceof I&&(t=(t="zoom"===t.rangeType?t.getRendererInfoByZoom(e.getZoom()):t.getRendererInfoByScale(k))&&t.renderer,!t))return!1;var e=this._getVariable(t,
"colorInfo"),k=this._getVariable(t,"opacityInfo"),F=this._getVariable(t,"sizeInfo");e?(z=this._getMedianColor(t,e),e.field&&(s=m.isFunction(e.field)?null:a._getField?a._getField(e.field,!0):e)):k&&(x=m.isFunction(k.field)?null:a._getField?a._getField(k.field,!0):k);F&&F.field&&(B=m.isFunction(F.field)?null:a._getField?a._getField(F.field,!0):F);if(t instanceof K)r=!0,this._showHeatRamp(a,c,t,g);else if(t instanceof G)r=!0,this._showDotDensityLegend(a,c,t,g);else if(t instanceof J)r=!0,q=b.create("table",
{cellpadding:0,cellspacing:0,width:"95%","class":"esri-legend-layer"},g),n=b.create("tbody",{},q),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,c),t.latestObservationRenderer&&t.latestObservationRenderer instanceof H&&this._buildRow_Renderer(a,t.latestObservationRenderer.symbol,z,t.latestObservationRenderer.label||this.NLS_currentObservations,null,n),t.observationRenderer&&t.observationRenderer instanceof H&&this._buildRow_Renderer(a,t.observationRenderer.symbol,z,t.observationRenderer.label||
this.NLS_previousObservations,null,n);else if(t instanceof A){if(t.infos&&0<t.infos.length){r=!0;q=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esri-legend-layer"},g);n=b.create("tbody",{},q);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,c);var L=[];d.forEach(t.infos,function(b){var c=null;a.editable&&a.types&&(c=this._getTemplateFromTypes(a.types,b.value));var e=b.label;null==e&&(e=b.value);-1===d.indexOf(L,e)&&(L.push(e),this._buildRow_Renderer(a,b.symbol,z,
e,c,n))},this)}}else if(t instanceof O){if(t.infos&&0<t.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass)r=!0,q=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esri-legend-layer"},g),n=b.create("tbody",{},q),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,c),q=t.infos.slice(0).reverse(),d.forEach(q,function(b){var c=b.label;null==c&&(c=b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,z,c,null,n)},this),"esri.layers.ArcGISImageServiceVectorLayer"===
a.declaredClass&&(a.rendererStyle===C.STYLE_SCALAR||a.rendererStyle===C.STYLE_SINGLE_ARROW)&&this._buildRow_Renderer(a,t.defaultSymbol,null,"",null,n)}else t instanceof H&&(r=!0,q=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esri-legend-layer"},g),n=b.create("tbody",{},q),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,c),w=null,a.editable&&(a.templates&&0<a.templates.length)&&(w=a.templates[0]),q=(s||x)&&B?null:s||x||B,this._buildRow_Renderer(a,t.symbol,z,q?q.alias||
q.name||q.field:t.label,w,n),w=t.symbol&&t.symbol.color,q&&(s=x=B=null));r&&(e&&e.field?(s&&this._isSmartRenderer(t,s.name)&&(s=null),this._showColorRamp(a,c,t,null,g,e,s)):k&&w&&this._showColorRamp(a,c,t,w,g,k,x),F&&F.field&&(B&&this._isSmartRenderer(t,B.name)&&(B=null),this._showSizeLegend(a,c,t,F,z,g,B)));!a._hideDefaultSymbol&&t.defaultSymbol&&(r=!0,q=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esri-legend-layer"},g),n=b.create("tbody",{},q),this._buildRow_Renderer(a,t.defaultSymbol,
null,t.defaultLabel||"others",null,n))}r&&(f.set(l.byId(this.id+"_"+a.id+"_"+c.id),"display","block"),-1<h&&(f.set(l.byId(this.id+"_"+a.id+"_"+h+"_group"),"display","block"),this._findParentGroup(a.id,h)));return r},_isSmartRenderer:function(a,b){return a instanceof O&&a.infos&&1===a.infos.length&&a.attributeField===b},_showColorRamp:function(a,c,d,f,e,g,h){var l;l=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esri-legend-layer"},e);e=b.create("tbody",{},l);(a._hoverLabel||a._hoverLabels)&&
this._createHoverAction(l,a,c);h&&this._addSubHeader(e,h.alias||h.name);c=this._getRampStops(d,g,f);c.length&&this._drawColorRamp(e,c,!0,a,this._getRampBorderColor(d))},_getMedianColor:function(a,b){var c,d;b.colors?(c=b.minDataValue,d=b.maxDataValue):b.stops&&(c=b.stops[0].value,d=b.stops[b.stops.length-1].value);return a.getColor(c+(d-c)/2,{colorInfo:b})},_getRampStops:function(a,b,c){var f,e,h,l,k=!1;b.colors||b.opacityValues?(e=b.maxDataValue-b.minDataValue,f=d.map([0,0.25,0.5,0.75,1],function(a){h=
b.minDataValue+a*e;return Number(h.toFixed(6))}),this._checkPrecision(0,4,f)):b.stops&&(f=d.map(b.stops,function(a){return a.value}),(k=d.some(b.stops,function(a){return!!a.label}))&&(l=d.map(b.stops,function(a){return a.label})));var m=f[0],r,n,t;e=f[f.length-1]-m;return d.map(f,function(d,h){c?(r=new q(c.toRgba()),n=a.getOpacity(d,{opacityInfo:b}),null!=n&&(r.a=n)):r=a.getColor(d,{colorInfo:b});t="";0===h?t=this._specialChars.lt+" ":h===f.length-1&&(t=this._specialChars.gt+" ");return{value:d,color:r,
offset:1-(d-m)/e,label:k?l[h]:t+g.format(d,{places:20,round:-1}).replace(this.reZerosFractional,"$1").replace(this.reZeros,"")}},this).reverse()},_checkPrecision:function(a,b,c){var d=a+(b-a)/2,e=c[a],f=c[d],g=c[b],h=Math.floor(e),l=Math.floor(f),k=Math.floor(g);h===e&&(k===g&&l!==f&&h!==l&&k!==l)&&(c[d]=l);a+1!==d&&this._checkPrecision(a,d,c);d+1!==b&&this._checkPrecision(d,b,c)},_getRampBorderColor:function(a){var b;if(a instanceof H)b=a.symbol;else if(a instanceof A||a instanceof O)b=a.infos[0].symbol;
a=null;if(b&&-1===b.type.indexOf("linesymbol"))if("PolygonSymbol3D"===b.type)for(var c=0;c<b.symbolLayers.length;c++){var d=b.symbolLayers[c];"Line"===d.type&&(a=this._getSymbolLayerStroke(d,0))}else a="LineSymbol3D"===b.type||"PointSymbol3D"===b.type?this._getSymbolLayerStroke(b.symbolLayers[0],0):b.get("stroke");return a&&a.color},_drawColorRamp:function(a,g,h,l,e){var k=b.create("tr",{},a),m,r,n,t,z,w=g.length-1,A;t=0;this.alignRight?(a=b.create("td",{align:this._isRightToLeft?"left":"right"},
k),m=b.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},k)):(m=b.create("td",{width:this.gradientWidth,align:"center"},k),a=b.create("td",{},k));var B=e&&0<e.a&&!(240<=e.r&&240<=e.g&&240<=e.b);r=b.create("div",{"class":B?"":"esri-legend-border-less-color-ramp",style:"position: relative; width:"+this.gradientWidth+"px;"},m);k=b.create("div",{"class":"esri-legend-color-ramp"},r);m=f.get(k,"width");B&&(e=9>c("ie")?e.toHex():"rgba("+e.toRgba().join(",")+")",f.set(k,"border",
this.colorRampBorder+" "+e));h?(e=this.gradientHeight*w,f.set(k,"height",e+"px")):e=f.get(k,"height");f.set(r,"height",e+"px");k=s.createSurface(k,m,e);9>c("ie")&&(t=k.getEventSource(),f.set(t,"position","relative"),f.set(t.parentNode,"position","relative"),t=1);try{h&&d.forEach(g,function(a,b){a.offset=b/w}),z=k.createRect({x:-t,y:-t,width:m+t,height:e+t}),z.setFill({type:"linear",x1:0,y1:0,x2:0,y2:e,colors:g}).setStroke(null),k.createRect({width:m,height:e}).setFill(new q([255,255,255,1-l.opacity])).setStroke(null),
this._surfaceItems.push(k)}catch(x){k.clear(),k.destroy()}d.forEach(g,function(a,c){if(a.label){A="top:"+100*a.offset+"%;";var e="";0===c&&(e+=" esri-legend-color-ramp-tick-first");c===g.length-1&&(e+=" esri-legend-color-ramp-tick-last");b.create("div",{"class":"esri-legend-color-ramp-tick"+e,innerHTML:"\x26nbsp;",style:A},r)}});n=b.create("div",{"class":"esri-legend-color-ramp-labels",style:{height:e+this.gradientHeight+"px"}},a);h?d.forEach(g,function(a){b.create("div",{"class":"esri-legend-color-ramp-label",
innerHTML:a.label||"\x26nbsp;"},n)}):(b.create("div",{"class":"esri-legend-color-ramp-label",innerHTML:M.widgets.legend.high},n),b.create("div",{"class":"esri-legend-color-ramp-label",innerHTML:M.widgets.legend.low,style:"top: "+(e+this.gradientHeight-2*this.gradientHeight)+"px;"},n))},_showHeatRamp:function(a,c,d,f){var e,g=d.field;e=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esri-legend-layer"},f);f=b.create("tbody",{},e);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(e,
a,c);(g=g&&a.getField(g))&&this._addSubHeader(f,g.alias||g.name);c=this._getHeatmapStops(d);c.length&&this._drawColorRamp(f,c,!1,a)},_getHeatmapStops:function(a){var b=a.colorStops;a=a.colors;var c,f,e,g;if(b&&b[0])if(c=b.length-1,a=b[0]&&null!=b[0].ratio){if((a=b[c])&&1!==a.ratio)b=b.slice(0),b.push({ratio:1,color:a.color}),c++}else f=b[0].value,e=b[c].value-f,b=d.map(b,function(a){return{color:a.color,ratio:(a.value-f)/e}});else a&&a[0]&&(c=a.length-1,g=1/(a.length-1),b=d.map(a,function(a,b){return{color:a,
ratio:b*g}}));b=d.map(b,function(a,b){var e="";0===b?e="Low":b===c&&(e="High");return{color:a.color,label:e,offset:1-a.ratio}});return b.reverse()},_showDotDensityLegend:function(a,c,f,g){var e=f.legendOptions,h,l,k,r,n,q,z,w=this.dotDensitySwatchSize,A=Math.round(w/2);e&&(l=e.backgroundColor,k=e.outline,r=e.valueUnit,n=e.dotCoverage);n=(n||this.dotCoverage)/100;z=Math.round(w*w/Math.pow(f.dotSize,2)*n);g=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esri-legend-layer"},g);q=
b.create("tbody",{},g);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(g,a,c);this._addSubHeader(q,t.substitute({value:f.dotValue,unit:r||""},this.NLS_dotValue));d.forEach(f.fields,function(b){b=m.mixin({},b);b.numPoints=z;h=new Q(f._generateImageSrc(w,w,[b],{x:0,y:0},{x:w,y:w},l),k||f.outline,w,w);b=a._getField(b.name,!0)||b;this._buildRow_Renderer(a,h,null,b.alias||b.name,null,q,{type:"path",path:"M "+-A+","+-A+" L "+A+","+-A+" L "+A+","+A+" L "+-A+","+A+" L "+-A+","+-A+" E"})},this)},
_showSizeLegend:function(a,c,f,h,e,l,k){var m=h.legendOptions,m=m&&m.customValues,r,n,t=h.minDataValue,q=h.maxDataValue,w=this._getSizeSymbol(f,e);"unknown"!==h.valueUnit||(!w||!m&&(null==t||null==q))||(e=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esri-legend-layer"},l),r=b.create("tbody",{},e),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(e,a,c),k&&this._addSubHeader(r,k.alias||k.name),n=m||this._getDataValues(t,q),d.forEach(n,function(b,c){w=N.fromJSON(w.toJSON());
this._applySize(w,f,h,b);b=g.format(b,{places:20,round:-1}).replace(this.reZerosFractional,"$1").replace(this.reZeros,"");var e="";0===c?e=this._specialChars.gt+" ":c===n.length-1&&(e=this._specialChars.lt+" ");this._buildRow_Renderer(a,w,null,"\x3cspan class\x3d'esri-legend-size-ramp-label'\x3e"+e+b+"\x3c/span\x3e",null,r)},this))},_getSizeSymbol:function(a,b){var c;if(a instanceof H)c=a.symbol;else if(a instanceof C)c=a.defaultSymbol;else if(a instanceof A||a instanceof O)c=a.infos[0].symbol;if(c=
-1!==c.type.indexOf("fillsymbol")?null:c)c=N.fromJSON(c.toJSON()),b&&c.set("color",new q(b.toRgba()));return c},_applySize:function(a,b,c,d){var e=a.type;c={sizeInfo:c,shape:-1!==e.indexOf("markersymbol")?a.style:null};b=b.getSize(d,c);switch(e){case "simplemarkersymbol":a.size=b;break;case "picturemarkersymbol":e=a.width;d=a.height;a.height=b;a.width=b*(e/d);break;case "simplelinesymbol":case "cartographiclinesymbol":a.width=b;break;case "textsymbol":a.font&&(a.font.size=b)}},_getDataValues:function(a,
b){var c=[a,b],f=Math.LN10,e=Math.log(a),g=Math.log(b),h,l,k,m,r;d.forEach([1,2.5,5],function(a){m=Math.log(a);h=Math.ceil((e-m)/f);l=Math.floor((g-m)/f);if(!(Infinity===Math.abs(h)||Infinity===Math.abs(l)))for(k=h;k<l+1;k++)r=a*Math.pow(10,k),-1===d.indexOf(c,r)&&c.push(r)});c.sort(this._sorter);return c.reverse()},_sorter:function(a,b){return a-b},_buildRow_Renderer:function(a,c,d,f,e,g,h){var l=b.create("tr",{},g),k;this.alignRight?(g=b.create("td",{align:this._isRightToLeft?"left":"right"},l),
k=b.create("td",{align:this._isRightToLeft?"left":"right",width:22},l)):(k=b.create("td",{width:22,align:"center"},l),g=b.create("td",{},l));var m=l=22;"simplemarkersymbol"==c.type?(l=Math.min(Math.max(l,c.size+12),125),m=Math.min(Math.max(m,c.size+12),125)):"picturemarkersymbol"==c.type?(l=Math.min(Math.max(l,c.width),125),m=Math.min(Math.max(c.height,m),125)):"textsymbol"==c.type&&(l=Math.min(Math.max(l,c.getWidth()+12),125),m=Math.min(Math.max(m,c.getHeight()+12),125));k=b.create("div",{style:"width:"+
l+"px;height:"+m+"px;"},k);t.isDefined(f)&&"number"===typeof f&&(f=""+f);b.create("td",{innerHTML:f||"",align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},g))));(a=this._drawSymbol(k,c,d,l,m,e,a,h))&&this._surfaceItems.push(a)},_addSubHeader:function(a,c){var d=b.create("tr",{},a),d=b.create("td",{align:this._align,colspan:2},d);b.create("td",{innerHTML:c||"",align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},d))))},_drawSymbol:function(a,
b,d,g,e,h,l,k){b=N.fromJSON(b.toJSON());var r=l.opacity;d&&b.set("color",new q(d.toRgba()));if(b.symbolLayers){if(d)for(var n=0;n<b.symbolLayers.length;n++){var t=b.symbolLayers[n];t.material?t.material.color=d:t.material={color:d}}for(n=0;n<b.symbolLayers.length;n++)t=b.symbolLayers[n],t.material&&t.material.color&&(t.material.transparency=t.material.transparency?1-(1-t.material.transparency)*r:1-r)}if("simplelinesymbol"===b.type||"cartographiclinesymbol"===b.type||"textsymbol"===b.type){if(!b.color)return;
d=b.color.toRgba();d[3]*=r;b.color.setColor(d)}else"simplemarkersymbol"===b.type||"simplefillsymbol"===b.type?(b.color&&(d=b.color.toRgba(),d[3]*=r,b.color.setColor(d)),b.outline&&b.outline.color&&(d=b.outline.color.toRgba(),d[3]*=r,b.outline.color.setColor(d))):"picturemarkersymbol"===b.type?(a.style.opacity=r,a.style.filter="alpha(opacity\x3d("+100*r+"))"):"LineSymbol3D"==b.type?h={drawingTool:"LineSymbol3D"}:"PolygonSymbol3D"==b.type?h={drawingTool:"PolygonSymbol3D"}:"PointSymbol3D"==b.type?h=
{drawingTool:"PointSymbol3D"}:"MeshSymbol3D"==b.type&&(h={drawingTool:"PolygonSymbol3D"});a=s.createSurface(a,g,e);9>c("ie")&&(d=a.getEventSource(),f.set(d,"position","relative"),f.set(d.parentNode,"position","relative"));h=this._getDrawingToolShape(b,h)||F.getShapeDescriptors(b);var w;if(h.defaultShapes&&0===h.defaultShapes.length)a.clear(),a.destroy();else{try{var z=a.createGroup();if(k)w=z.createShape(k).setFill(h.fill).setStroke(h.stroke),"text"===h.defaultShape.type&&w.setFont(h.font);else if(h.defaultShape)w=
z.createShape(h.defaultShape).setFill(h.fill).setStroke(h.stroke),"text"===h.defaultShape.type&&w.setFont(h.font);else for(n=0;n<h.defaultShapes.length;n++)w=z.createShape(h.defaultShapes[n]).setFill(h.fills[n]?h.fills[n]:{}).setStroke(h.strokes[n]?h.strokes[n]:{width:0}),"text"===h.defaultShapes[n].type&&w.setFont(h.font)}catch(A){a.clear();a.destroy();return}d=z.getBoundingBox();k=d.width;n=d.height;h=-(d.x+k/2);r=-(d.y+n/2);w=a.getDimensions();h={dx:h+w.width/2,dy:r+w.height/2};if("simplemarkersymbol"===
b.type&&"path"===b.style)g=l._getScaleMatrix(d,b.size),z.applyTransform(x.scaleAt(g.xx,g.yy,{x:w.width/2,y:w.height/2}));else if(k>g||n>e)l=k/g>n/e,g=((l?g:e)-5)/(l?k:n),m.mixin(h,{xx:g,yy:g});z.applyTransform(h);return a}},_getDrawingToolShape:function(a,b){var c=[],d=[],e=[];switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":c.push({type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"});d.push(a.getFill());e.push(a.get("stroke"));break;case "esriFeatureEditToolTriangle":c.push({type:"path",
path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"});d.push(a.getFill());e.push(a.get("stroke"));break;case "esriFeatureEditToolRectangle":c.push({type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"});d.push(a.getFill());e.push(a.get("stroke"));break;case "esriFeatureEditToolCircle":c.push({type:"circle",cx:0,cy:0,r:10});d.push(a.getFill());e.push(a.get("stroke"));break;case "esriFeatureEditToolEllipse":c.push({type:"ellipse",cx:0,cy:0,rx:10,ry:5});d.push(a.getFill());e.push(a.get("stroke"));
break;case "LineSymbol3D":return this._getDrawingToolShapeLine3D(a,b);case "PolygonSymbol3D":return this._getDrawingToolShapePolygon3D(a,b);case "PointSymbol3D":return this._getDrawingToolShapePoint3D(a,b);default:return null}return{fills:d,strokes:e,defaultShapes:c}},_getDrawingToolShapePoint3D:function(a,b){if(0===a.symbolLayers.length)return{};for(var c=[],d=[],e=[],f=0;f<a.symbolLayers.length;f++){var g=a.symbolLayers[f];"Icon"===g.type?g.resource&&(g.resource.primitive?this._addResourcePrimitiveShapes(g,
c,d,e):(c.push({type:"image",src:g.resource.dataURI||g.resource.href,width:20,height:20}),d.push({}),e.push({}))):"Object"===g.type&&(g.resource&&g.resource.href?(c.push({type:"image",src:this.basePath+"/images/legend3dsymboldefault.png",width:20,height:20}),d.push({}),e.push({})):g.resource&&g.resource.primitive&&this._addResourcePrimitiveShapes(g,c,d,e))}return{fills:d,strokes:e,defaultShapes:c}},_addResourcePrimitiveShapes:function(a,b,c,d){switch(a.resource.primitive){case "circle":b.push({type:"circle",
cx:0,cy:0,r:10});c.push(this._getSymbolLayerFill(a,0));d.push(this._getSymbolLayerOutline(a));break;case "square":b.push({type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"});c.push(this._getSymbolLayerFill(a,0));d.push(this._getSymbolLayerOutline(a));break;case "cross":b.push({type:"path",path:"M -10,0 L 10,0 E"});b.push({type:"path",path:"M 0,-10 L 0,10 E"});c.push({});c.push({});d.push(this._getSymbolLayerOutline(a));d.push(this._getSymbolLayerOutline(a));break;case "x":b.push({type:"path",
path:"M -10,-10 L 10,10 E"});b.push({type:"path",path:"M 10,-10 L -10,10 E"});c.push({});c.push({});d.push(this._getSymbolLayerOutline(a));d.push(this._getSymbolLayerOutline(a));break;case "kite":b.push({type:"path",path:"M 0,-10 L 10,0 L 0,10 L -10 0 L 0,-10 Z"});c.push(this._getSymbolLayerFill(a,0));d.push(this._getSymbolLayerOutline(a));break;case "cone":b.push({type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"});var e=this._getSymbolLayerFill(a,0),f=this._getSymbolLayerFill(a,-0.6),
e=this._getGradientColor(e,f);e.x1=-5;e.y1=0;e.x2=5;e.y2=0;c.push(e);d.push({width:0});break;case "cube":b.push({type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"});c.push(this._getSymbolLayerFill(a,0));d.push({width:0});b.push({type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"});c.push(this._getSymbolLayerFill(a,-0.3));d.push({width:0});b.push({type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"});c.push(this._getSymbolLayerFill(a,-0.5));d.push({width:0});break;case "cylinder":b.push({type:"path",
path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"});e=this._getSymbolLayerFill(a,0);f=this._getSymbolLayerFill(a,-0.6);e=this._getGradientColor(e,f);e.x1=-5;e.y1=0;e.x2=5;e.y2=0;c.push(e);d.push({width:0});b.push({type:"ellipse",cx:0,cy:-9,rx:8,ry:2});d.push({width:0});c.push(this._getSymbolLayerFill(a,0));break;case "diamond":b.push({type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"});c.push(this._getSymbolLayerFill(a,-0.3));b.push({type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"});
c.push(this._getSymbolLayerFill(a,0));b.push({type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"});c.push(this._getSymbolLayerFill(a,-0.3));b.push({type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"});c.push(this._getSymbolLayerFill(a,-0.7));break;case "sphere":b.push({type:"circle",cx:0,cy:0,r:10});e=this._getSymbolLayerFill(a,0);f=this._getSymbolLayerFill(a,-0.6);c.push(this._getGradientColor(e,f));d.push({width:0});break;case "tetrahedron":b.push({type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"}),
c.push(this._getSymbolLayerFill(a,-0.3)),d.push({width:0}),b.push({type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"}),c.push(this._getSymbolLayerFill(a,0)),d.push({width:0}),b.push({type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}),c.push(this._getSymbolLayerFill(a,-0.6)),d.push({width:0})}},_getDrawingToolShapePolygon3D:function(a,b){if(0===a.symbolLayers.length)return{};for(var c=[],d=[],e=[],f=0;f<a.symbolLayers.length;f++){var g=a.symbolLayers[f];if("Fill"===g.type)c.push({type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 E"}),
d.push(this._getSymbolLayerFill(g,0)),1===a.symbolLayers.length&&e.push({width:0});else if("Line"===g.type)e.push(this._getSymbolLayerStroke(g,0)),1===a.symbolLayers.length&&(c.push({type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 E"}),d.push({}));else if("Extrude"===g.type){this._getSymbolLayerStroke(g,0);var h=this._getSymbolLayerStroke(g,-0.4),l=this._getSymbolLayerFill(g,0),g=this._getSymbolLayerFill(g,0.4);h.width=1;c.push({type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5Z"});
d.push(l);e.push(h);c.push({type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"});d.push(l);e.push(h);c.push({type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"});d.push(g);e.push(h)}}return{fills:d,strokes:e,defaultShapes:c}},_getDrawingToolShapeLine3D:function(a,b){if(0===a.symbolLayers.length)return{};var c=a.symbolLayers[0],d=[],e=[],f=[],g=this._getSymbolLayerStroke(c,0),h=this._getSymbolLayerStroke(c,-0.4);"Line"===c.type?(d.push({type:"path",path:"M -2,5 L 12,5 E"}),f.push(g),
e.push([])):(g=this._getSymbolLayerFill(c,0),c=this._getSymbolLayerFill(c,0.4),h.width=1,d.push({type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"}),e.push(g),f.push(h),d.push({type:"circle",cx:-2,cy:10,r:5}),e.push(c),f.push(h));return{fills:e,strokes:f,defaultShapes:d}},_getSymbolLayerStroke:function(a,b){if(!a.material)return{};for(var c=a.material.color.toRgb(),d="rgba(",e=0;3>e;e++)d+=this._getColorChangedLuminance(c[e],b)+",";d+=a.material.color.a+");";return{color:d,
width:B.px2pt(a.size?a.size:1)}},_getSymbolLayerFill:function(a,b){if(!a.material){var c=this._getColorChangedLuminance(255,b);return[c,c,c,100]}for(var c=a.material.color.toRgb(),d=0;3>d;d++)c[d]=this._getColorChangedLuminance(c[d],b);c.push(a.material.color.a);return c},_getSymbolLayerOutline:function(a){if(!a.outline)return{color:"rgba(0,0,0,1)",width:1.5};var b=null!=a.outline.size?a.outline.size:1.5;return{color:"rgba("+(null!=a.outline.color?a.outline.color.toRgba():"255,255,255,1")+")",width:b}},
_getGradientColor:function(a,b){return{type:"linear",x1:0,y1:0,x2:4,y2:4,colors:[{color:a,offset:0},{color:b,offset:1}]}},_getColorChangedLuminance:function(a,b){return Math.min(Math.max(a+(255-a+20)*b,0),255)},_repaintItems:function(){d.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(b){}a.children&&m.isArray(a.children)&&d.forEach(a.children,this._repaint,
this)}},_createHoverAction:function(a,c,d){var g=c._hoverLabel||c._hoverLabels[d.id];g&&(c.mouseMoveHandler=c.mouseMoveHandler||{},c.mouseMoveHandler[d.id]=h(a,"mousemove",m.hitch(this,function(a,c){this.mouseX=c.clientX;this.mouseY=c.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,f.set(l.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(m.hitch(this,function(a,c,d){if(a==this.mouseX&&c==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,l.byId(this.id+"_hoverLabel")){var e=
l.byId(this.id+"_hoverLabel");e.innerHTML="\x3cspan\x3e"+d+"\x3c/span\x3e";f.set(e,"top",c+"px");f.set(e,"left",a+15+"px");f.set(e,"display","")}else b.create("div",{innerHTML:"\x3cspan\x3e"+d+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esri-legend-hover-label",style:{top:c+"px",left:a+15+"px"}},document.body)},c.clientX,c.clientY,a),500)},g)),c.mouseOutHandler=c.mouseOutHandler||{},c.mouseOutHandler[d.id]=h(a,"mouseout",m.hitch(this,function(a){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&
(this.hoverLabelShowing=!1,f.set(l.byId(this.id+"_hoverLabel"),"display","none"))})))},_removeHoverHandlers:function(){var a;d.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)b.mouseMoveHandler[a].remove();if(b.mouseOutHandler)for(a in b.mouseOutHandler)b.mouseOutHandler[a].remove()})},_createDynamicLayers:function(a){var b=[],c;d.forEach(a.dynamicLayerInfos||a.layerInfos,function(d){c={id:d.id};c.source=d.source&&d.source.toJSON();var e;a.layerDefinitions&&a.layerDefinitions[d.id]&&
(e=a.layerDefinitions[d.id]);e&&(c.definitionExpression=e);var f;a.layerDrawingOptions&&a.layerDrawingOptions[d.id]&&(f=a.layerDrawingOptions[d.id]);f&&(c.drawingInfo=f.toJSON());c.minScale=d.minScale||0;c.maxScale=d.maxScale||0;b.push(c)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var d,e=b.dynamicLayerInfos||b.layerInfos;for(d=0;d<e.length;d++)if(c==
e[d].id){-1<e[d].parentLayerId&&(f.set(l.byId(this.id+"_"+a+"_"+e[d].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,b,e[d].parentLayerId));break}},_addSubLayersToHide:function(a){function b(c,f){var e=a.layer.dynamicLayerInfos||a.layer.layerInfos,g,h;for(g=0;g<e.length;g++)if(e[g].id===c&&e[g].subLayerIds)for(h=0;h<e[g].subLayerIds.length;h++){var l=e[g].subLayerIds[h];-1===d.indexOf(f,l)&&(f.push(l),b(l,f))}}a.layer.layerInfos&&d.forEach(a.layer._hideLayersInLegend,function(c){b(c,
a.layer._hideLayersInLegend)})},_isLayerInScale:function(a,b,c){var d,e=!0;if(a.legendResponse&&a.legendResponse.layers)for(d=0;d<a.legendResponse.layers.length;d++){var f=a.legendResponse.layers[d];if(b.id==f.layerId){var g,h;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0===f.minScale&&a.tileInfo&&(g=a.tileInfo.lods[0].scale),0===f.maxScale&&a.tileInfo&&(h=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(g=Math.min(a.minScale,f.minScale)||a.minScale||f.minScale,h=Math.max(a.maxScale,
f.maxScale));if(0<g&&g<c||h>c)e=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<c||a.maxScale&&a.maxScale>c)e=!1;return e},_getServiceTitle:function(b){var c=b._titleForLegend;c||((c=b.url)?-1<b.url.indexOf("/MapServer")?(c=b.url.substring(0,b.url.indexOf("/MapServer")),c=c.substring(c.lastIndexOf("/")+1,c.length)):-1<b.url.indexOf("/ImageServer")?(c=b.url.substring(0,b.url.indexOf("/ImageServer")),c=c.substring(c.lastIndexOf("/")+1,c.length)):-1<b.url.indexOf("/FeatureServer")&&
(c=b.url.substring(0,b.url.indexOf("/FeatureServer")),c=c.substring(c.lastIndexOf("/")+1,c.length)):c="",b.name&&(c=0<c.length?c+(" - "+b.name):b.name));"esri.layers.ArcGISImageServiceVectorLayer"===b.declaredClass&&b.vectorFieldPixelFilter&&(b=b.vectorFieldPixelFilter.outputUnit?this["NLS_"+b.vectorFieldPixelFilter.outputUnit]:this["NLS_"+b.vectorFieldPixelFilter.inputUnit],t.isDefined(b)&&(c+=" ("+b+")"));return a.encode(c)},_getEffectiveScale:function(a,b){var c=b.minScale,d=b.maxScale;if(t.isDefined(b.parentLayerId)){var e=
a.layerInfos,f=b.parentLayerId,g;for(g=e.length-1;0<=g;g--)if(e[g].id==f)if(0===c&&0<e[g].minScale?c=e[g].minScale:0<c&&0<e[g].minScale&&(c=Math.min(c,e[g].minScale)),d=Math.max(d||0,e[g].maxScale||0),-1<e[g].parentLayerId)f=e[g].parentLayerId;else break}return{minScale:c,maxScale:d}},_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===
a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISTiledLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass||"esri.layers.SceneLayer"===a.declaredClass)?!0:!1}});m.mixin(L,{ALIGN_LEFT:0,ALIGN_RIGHT:1});return L})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(k,m,d,q,c,g,h,l,b,f,n,s,x,a,r){return m("dijit._MenuBase",[s,r,a,x],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){c.toggle(this.domNode,"dijitMenuActive",a);c.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,
childSelector:function(a){var b=n.byNode(a);return a.parentNode==this.containerNode&&b&&b.focus},postCreate:function(){var a=this,b="string"==typeof this.childSelector?this.childSelector:g.hitch(this,"childSelector");this.own(l(this.containerNode,l.selector(b,h.enter),function(){a.onItemHover(n.byNode(this))}),l(this.containerNode,l.selector(b,h.leave),function(){a.onItemUnhover(n.byNode(this))}),l(this.containerNode,l.selector(b,f),function(b){a.onItemClick(n.byNode(this),b);b.stopPropagation()}),
l(this.containerNode,l.selector(b,"focusin"),function(){a._onItemFocus(n.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,b,c,d){this.inherited(arguments);if(a&&(-1==d||a.popup&&1==d))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),a.popup&&(!a.disabled&&!this.hover_timer)&&(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;if(a.popup){this.set("selected",a);this.set("activated",!0);var c=/^key/.test(b._origType||
b.type)||0==b.clientX&&0==b.clientY;this._openItemPopup(a,c)}else this.onExecute(),a._onClick?a._onClick(b):a.onClick(b)},_openItemPopup:function(a,b){if(a!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var c=a.popup;c.parentMenu=this;this.own(this._mouseoverHandle=l.once(c.domNode,"mouseover",g.hitch(this,"_onPopupHover")));var d=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){b&&
d.focusChild(a);d._cleanUp()},onExecute:g.hitch(this,"_cleanUp",!0),onClose:function(){d._mouseoverHandle&&(d._mouseoverHandle.remove(),delete d._mouseoverHandle)}},b);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(q.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/layout/ScrollingTabController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/fx dojo/_base/lang dojo/on dojo/query dojo/sniff ../registry dojo/text!./templates/ScrollingTabController.html dojo/text!./templates/_ScrollingTabControllerButton.html ./TabController ./utils ../_WidgetsInTemplateMixin ../Menu ../MenuItem ../form/Button ../_HasDropDown dojo/NodeList-dom ../a11yclick".split(" "),
function(k,m,d,q,c,g,h,l,b,f,n,s,x,a,r,z,t,w,B,H){s=m("dijit.layout.ScrollingTabController",[a,z],{baseClass:"dijitTabController dijitScrollingTabController",templateString:s,useMenu:!0,useSlider:!0,tabStripClass:"",_minScroll:5,_setClassAttr:{node:"containerNode",type:"class"},buildRendering:function(){this.inherited(arguments);var a=this.domNode;this.scrollNode=this.tablistWrapper;this._initButtons();this.tabStripClass||(this.tabStripClass="dijitTabContainer"+this.tabPosition.charAt(0).toUpperCase()+
this.tabPosition.substr(1).replace(/-.*/,"")+"None",d.add(a,"tabStrip-disabled"));d.add(this.tablistWrapper,this.tabStripClass)},onStartup:function(){this.inherited(arguments);c.set(this.domNode,"visibility","");this._postStartup=!0;this.own(l(this.containerNode,"attrmodified-label, attrmodified-iconclass",h.hitch(this,function(a){this._dim&&this.resize(this._dim)})))},onAddChild:function(a,b){this.inherited(arguments);c.set(this.containerNode,"width",c.get(this.containerNode,"width")+200+"px")},
onRemoveChild:function(a,b){var c=this.pane2button(a.id);this._selectedTab===c.domNode&&(this._selectedTab=null);this.inherited(arguments)},_initButtons:function(){this._btnWidth=0;this._buttons=b("\x3e .tabStripButton",this.domNode).filter(function(a){if(this.useMenu&&a==this._menuBtn.domNode||this.useSlider&&(a==this._rightBtn.domNode||a==this._leftBtn.domNode))return this._btnWidth+=q.getMarginSize(a).w,!0;c.set(a,"display","none");return!1},this)},_getTabsWidth:function(){var a=this.getChildren();
if(a.length){var b=a[this.isLeftToRight()?0:a.length-1].domNode,a=a[this.isLeftToRight()?a.length-1:0].domNode;return a.offsetLeft+a.offsetWidth-b.offsetLeft}return 0},_enableBtn:function(a){var b=this._getTabsWidth();a=a||c.get(this.scrollNode,"width");return 0<b&&a<b},resize:function(a){this._dim=a;this.scrollNode.style.height="auto";var b=this._contentBox=r.marginBox2contentBox(this.domNode,{h:0,w:a.w});b.h=this.scrollNode.offsetHeight;q.setContentSize(this.domNode,b);b=this._enableBtn(this._contentBox.w);
this._buttons.style("display",b?"":"none");this._leftBtn.region="left";this._rightBtn.region="right";this._menuBtn.region=this.isLeftToRight()?"right":"left";r.layoutChildren(this.domNode,this._contentBox,[this._menuBtn,this._leftBtn,this._rightBtn,{domNode:this.scrollNode,region:"center"}]);this._selectedTab&&(this._anim&&"playing"==this._anim.status()&&this._anim.stop(),this.scrollNode.scrollLeft=this._convertToScrollLeft(this._getScrollForSelectedTab()));this._setButtonClass(this._getScroll());
this._postResize=!0;return{h:this._contentBox.h,w:a.w}},_getScroll:function(){return this.isLeftToRight()||8>f("ie")||f("ie")&&f("quirks")||f("webkit")?this.scrollNode.scrollLeft:c.get(this.containerNode,"width")-c.get(this.scrollNode,"width")+(8<=f("ie")?-1:1)*this.scrollNode.scrollLeft},_convertToScrollLeft:function(a){if(this.isLeftToRight()||8>f("ie")||f("ie")&&f("quirks")||f("webkit"))return a;var b=c.get(this.containerNode,"width")-c.get(this.scrollNode,"width");return(8<=f("ie")?-1:1)*(a-b)},
onSelectChild:function(a){var b=this.pane2button(a.id);if(b){b=b.domNode;if(b!=this._selectedTab&&(this._selectedTab=b,this._postResize)){var d=this._getScroll();(d>b.offsetLeft||d+c.get(this.scrollNode,"width")<b.offsetLeft+c.get(b,"width"))&&this.createSmoothScroll().play()}this.inherited(arguments)}},_getScrollBounds:function(){var a=this.getChildren(),b=c.get(this.scrollNode,"width"),d=c.get(this.containerNode,"width")-b,f=this._getTabsWidth();if(a.length&&f>b)return{min:this.isLeftToRight()?
0:a[a.length-1].domNode.offsetLeft,max:this.isLeftToRight()?a[a.length-1].domNode.offsetLeft+a[a.length-1].domNode.offsetWidth-b:d};a=this.isLeftToRight()?0:d;return{min:a,max:a}},_getScrollForSelectedTab:function(){var a=this._selectedTab,b=c.get(this.scrollNode,"width"),d=this._getScrollBounds(),a=a.offsetLeft+c.get(a,"width")/2-b/2;return a=Math.min(Math.max(a,d.min),d.max)},createSmoothScroll:function(a){if(0<arguments.length){var b=this._getScrollBounds();a=Math.min(Math.max(a,b.min),b.max)}else a=
this._getScrollForSelectedTab();this._anim&&"playing"==this._anim.status()&&this._anim.stop();var c=this,d=this.scrollNode,f=new g.Animation({beforeBegin:function(){this.curve&&delete this.curve;var b=d.scrollLeft,h=c._convertToScrollLeft(a);f.curve=new g._Line(b,h)},onAnimate:function(a){d.scrollLeft=a}});this._anim=f;this._setButtonClass(a);return f},_getBtnNode:function(a){for(a=a.target;a&&!d.contains(a,"tabStripButton");)a=a.parentNode;return a},doSlideRight:function(a){this.doSlide(1,this._getBtnNode(a))},
doSlideLeft:function(a){this.doSlide(-1,this._getBtnNode(a))},doSlide:function(a,b){if(!b||!d.contains(b,"dijitTabDisabled")){var f=0.75*c.get(this.scrollNode,"width")*a,f=this._getScroll()+f;this._setButtonClass(f);this.createSmoothScroll(f).play()}},_setButtonClass:function(a){var b=this._getScrollBounds();this._leftBtn.set("disabled",a<=b.min);this._rightBtn.set("disabled",a>=b.max)}});x=m("dijit.layout._ScrollingTabControllerButtonMixin",null,{baseClass:"dijitTab tabStripButton",templateString:x,
tabIndex:"",isFocusable:function(){return!1}});m("dijit.layout._ScrollingTabControllerButton",[B,x]);m("dijit.layout._ScrollingTabControllerMenuButton",[B,H,x],{containerId:"",tabIndex:"-1",isLoaded:function(){return!1},loadDropDown:function(a){this.dropDown=new t({id:this.containerId+"_menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir});var b=n.byId(this.containerId);k.forEach(b.getChildren(),function(a){var c=new w({id:a.id+"_stcMi",label:a.title,iconClass:a.iconClass,
disabled:a.disabled,ownerDocument:this.ownerDocument,dir:a.dir,lang:a.lang,textDir:a.textDir||b.textDir,onClick:function(){b.selectChild(a)}});this.dropDown.addChild(c)},this);a()},closeDropDown:function(a){this.inherited(arguments);this.dropDown&&(this._popupStateNode.removeAttribute("aria-owns"),this.dropDown.destroyRecursive(),delete this.dropDown)}});return s})},"webSceneViewer/widgets/SplashScreen/SplashScreen":function(){define("esri/core/declare dojo/dom-class dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/SplashScreen.html dojo/i18n!../../nls/viewer".split(" "),
function(k,m,d,q,c,g){return k([d,q],{templateString:c,portal:void 0,constructor:function(c,d){},postCreate:function(){this.firstParagraph.textContent=g.messages.splashSignInToEdit;this.signInButton.textContent=g.buttons.signIn;this.secondParagraph.textContent=g.messages.splashNewToArcGIS;this.tryOutButton.textContent=g.buttons.tryArcGIS;this.portal.isOrg()&&(m.add(this.secondParagraph,"hide"),m.add(this.tryOutButton,"hide"));this.thirdParagraph.textContent=g.messages.splashLookAtOtherScenes;this.galleryButton.textContent=
g.buttons.visitGallery},_signInClick:function(c){this.portal.signIn()},_tryArcGISClick:function(c){window.location=this.portal.getTrialLink()},_galleryClick:function(c){window.location=this.portal.getScenesGalleryLink()}})})},"dijit/layout/TabContainer":function(){define(["dojo/_base/lang","dojo/_base/declare","./_TabContainerBase","./TabController","./ScrollingTabController"],function(k,m,d,q,c){return m("dijit.layout.TabContainer",d,{useMenu:!0,useSlider:!0,controllerWidget:"",_makeController:function(c){var d=
this.baseClass+"-tabs"+(this.doLayout?"":" dijitTabNoLayout");return new ("string"==typeof this.controllerWidget?k.getObject(this.controllerWidget):this.controllerWidget)({id:this.id+"_tablist",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,tabPosition:this.tabPosition,doLayout:this.doLayout,containerId:this.id,"class":d,nested:this.nested,useMenu:this.useMenu,useSlider:this.useSlider,tabStripClass:this.tabStrip?this.baseClass+(this.tabStrip?"":"No")+"Strip":null},
c)},postMixInProperties:function(){this.inherited(arguments);this.controllerWidget||(this.controllerWidget=("top"==this.tabPosition||"bottom"==this.tabPosition)&&!this.nested?c:q)}})})},"webSceneViewer/widgets/Switch/Switch":function(){define("esri/core/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/Switch.html dojo/dom-class dojo/i18n!../nls/widgets".split(" "),function(k,m,d,q,c,g){return k([m,d],{templateString:q,_onHandles:void 0,switchOn:!1,_disabled:!1,constructor:function(c,
d){this._onHandles=[]},destroy:function(){this._onHandles.forEach(function(c){c.remove()})},postCreate:function(){this.switchOn||c.add(this.SwitchContainer,"off");this.SwitchContainer.title=this.switchOn?g.switchControl.on:g.switchControl.off},_toggleSwitch:function(d,l){this._disabled||(c.toggle(this.SwitchContainer,"off"),this.switchOn=!this.switchOn,this.SwitchContainer.title=this.switchOn?g.switchControl.on:g.switchControl.off,!0!==l&&this.emit("toggle",{on:this.switchOn}))},turnOn:function(){!1===
this.switchOn&&this._toggleSwitch(null,!0)},turnOff:function(){!0===this.switchOn&&this._toggleSwitch(null,!0)},disable:function(){this._disabled=!0;c.add(this.domNode,"incompatible")},enable:function(){this._disabled=!1;c.remove(this.domNode,"incompatible")}})})},"dijit/_HasDropDown":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on dojo/touch ./registry ./focus ./popup ./_FocusMixin".split(" "),
function(k,m,d,q,c,g,h,l,b,f,n,s,x,a,r,z){return k("dijit._HasDropDown",z,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(a){!this.disabled&&!this.readOnly&&("MSPointerDown"!=a.type&&"pointerdown"!=a.type&&a.preventDefault(),this.own(n.once(this.ownerDocument,s.release,f.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},
_onDropDownMouseUp:function(a){var b=this.dropDown,d=!1;if(a&&this._opened){var f=g.position(this._buttonNode,!0);if(!(a.pageX>=f.x&&a.pageX<=f.x+f.w)||!(a.pageY>=f.y&&a.pageY<=f.y+f.h)){for(f=a.target;f&&!d;)c.contains(f,"dijitPopup")?d=!0:f=f.parentNode;if(d){f=a.target;if(b.onItemClick){for(var h;f&&!(h=x.byNode(f));)f=f.parentNode;if(h&&h.onClick&&h.getParent)h.getParent().onItemClick(h,a)}return}}}if(this._opened){if(b.focus&&(!1!==b.autoFocus||"mouseup"==a.type&&!this.hovering))this._focusDropDownTimer=
this.defer(function(){b.focus();delete this._focusDropDownTimer})}else this.focus&&this.defer("focus")},_onDropDownClick:function(a){this._stopClickEvents&&(a.stopPropagation(),a.preventDefault())},buildRendering:function(){this.inherited(arguments);this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var a={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",
left:"Left",right:"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";c.add(this._arrowWrapperNode||this._buttonNode,"dijit"+a+"ArrowButton")},postCreate:function(){this.inherited(arguments);var a=this.focusNode||this.domNode;this.own(n(this._buttonNode,s.press,f.hitch(this,"_onDropDownMouseDown")),n(this._buttonNode,"click",f.hitch(this,"_onDropDownClick")),n(a,"keydown",f.hitch(this,"_onKey")),n(a,"keyup",f.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0);
this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),delete this.dropDown);this.inherited(arguments)},_onKey:function(a){if(!this.disabled&&!this.readOnly){var c=this.dropDown,d=a.target;if(c&&(this._opened&&c.handleKey)&&!1===c.handleKey(a))a.stopPropagation(),a.preventDefault();else if(c&&this._opened&&a.keyCode==b.ESCAPE)this.closeDropDown(),a.stopPropagation(),a.preventDefault();else if(!this._opened&&(a.keyCode==b.DOWN_ARROW||(a.keyCode==b.ENTER||a.keyCode==b.SPACE&&(!this._searchTimer||
a.ctrlKey||a.altKey||a.metaKey))&&("input"!==(d.tagName||"").toLowerCase()||d.type&&"text"!==d.type.toLowerCase())))this._toggleOnKeyUp=!0,a.stopPropagation(),a.preventDefault()}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp;this.toggleDropDown();var a=this.dropDown;a&&a.focus&&this.defer(f.hitch(a,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1);this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(a){a()},loadAndOpenDropDown:function(){var a=
new m,b=f.hitch(this,function(){this.openDropDown();a.resolve(this.dropDown)});this.isLoaded()?b():this.loadDropDown(b);return a},toggleDropDown:function(){!this.disabled&&!this.readOnly&&(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var a=this.dropDown,b=a.domNode,d=this._aroundNode||this.domNode,h=this,l=r.open({parent:this,popup:a,around:d,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){h.closeDropDown(!0)},onCancel:function(){h.closeDropDown(!0)},
onClose:function(){q.set(h._popupStateNode,"popupActive",!1);c.remove(h._popupStateNode,"dijitHasDropDownOpen");h._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&d.offsetWidth>a._popupWrapper.offsetWidth){var d=d.offsetWidth-a._popupWrapper.offsetWidth,k={w:a.domNode.offsetWidth+d};f.isFunction(a.resize)?a.resize(k):g.setMarginBox(b,k);"R"==l.corner[1]&&(a._popupWrapper.style.left=a._popupWrapper.style.left.replace("px","")-d+"px")}q.set(this._popupStateNode,"popupActive","true");c.add(this._popupStateNode,
"dijitHasDropDownOpen");this._set("_opened",!0);this._popupStateNode.setAttribute("aria-expanded","true");this._popupStateNode.setAttribute("aria-owns",a.id);"presentation"!==b.getAttribute("role")&&!b.getAttribute("aria-labelledby")&&b.setAttribute("aria-labelledby",this.id);return l},closeDropDown:function(a){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer);this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),a&&this.focus&&this.focus(),
r.close(this.dropDown),this._opened=!1)}})})},"webSceneViewer/widgets/ScrollBar/ScrollBar":function(){define("esri/core/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/ScrollBar.html dojo/_base/lang esri/core/domUtils dojo/on dojo/has dojo/dom-class".split(" "),function(k,m,d,q,c,g,h,l,b){var f=[],n=function(a,b,c){f.push(h(a,c,function(a){a.preventDefault();a.stopPropagation();var d=document.createEvent("MouseEvent");d.initMouseEvent(c,a.bubbles,a.cancelable,window,a.detail,
a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget);a.wheelDelta&&(d.wheelDelta=a.wheelDelta);b.dispatchEvent(d)}))},s=function(a){a.stopPropagation();var b=a.changedTouches[0],c="";if(!(1<a.touches.length)){switch(a.type){case "touchstart":c="mousedown";break;case "touchmove":c="mousemove";break;case "touchend":var c="mouseup",d=document.createEvent("MouseEvent");d.initMouseEvent("click",!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,
!1,!1,!1,!1,0,null);b.target.dispatchEvent(d);a.preventDefault();break;default:return}d=document.createEvent("MouseEvent");d.initMouseEvent(c,!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null);b.target.dispatchEvent(d);a.preventDefault()}},x=function(a){a&&a.stopPropagation();return!1};return k([m,d],{templateString:q,scrollTarget:void 0,view:void 0,_onHandles:void 0,constructor:function(a,b){this._onHandles=[]},destroy:function(){this._onHandles.forEach(function(a){a.remove()});
f.forEach(function(a){a.remove()});this._viewPortResize&&this._viewPortResize.remove();this.scrollTarget.removeEventListener("click",x,!0);this.scrollTarget.removeEventListener("mousedown",c.hitch(this,function(){this._stopScrollTargetDragging(event)}),!0);this.scrollTarget.removeEventListener("touchmove",s,!0);this.scrollTarget.removeEventListener("touchstart",s,!0);this.scrollTarget.removeEventListener("touchend",s,!0);this.scrollTarget.removeEventListener("touchcancel",s,!0)},postCreate:function(){this.PAGE_Y=
(this.vertical=!1,"pageX");this.DIMENSION=this.vertical?"height":"width";this.OFFSET_DIMENSION=this.vertical?"offsetHeight":"offsetWidth";this.TOP=this.vertical?"top":"left";b.contains(dojo.doc.body.parentNode,"esriRtl")&&(this.TOP=this.vertical?"top":"right");this.wheelDir=this.vertical?-1:1;this.min=this.mousePosRelativeToHandle=this.state=this.relativeSliderPosition=0;this.max=1;this.originMousePos=this.easing=0;this._updatePosition(this.relativeSliderPosition,!0);this._viewPortResize=this.view.on("resize",
c.hitch(this,function(){this._updatePosition(this.relativeSliderPosition,!0);this.updateWidth()}));this._setupEventHandlers()},_startScrollTargetDragging:function(a){this.scrollTarget.removeEventListener("click",x,!0);document.addEventListener("mouseup",c.hitch(this,function(a){this._stopScrollTargetDragging(a)}),!0);a=a||window.event;a.preventDefault();this.originMousePos=a.clientX;this.startMouseCoords={x:0,y:0};this.startMouseCoords.x=a.clientX;this.startMouseCoords.y=a.clientY;document.onmousemove=
c.hitch(this,function(a){this.scrollTarget.removeEventListener("click",x,!0);if(!(3>Math.abs(Math.abs(a.clientX)-Math.abs(this.startMouseCoords.x))&&1>Math.abs(Math.abs(a.clientY)-Math.abs(this.startMouseCoords.y)))){this.scrollTarget.addEventListener("click",x,!0);a=a||window.event;a.preventDefault();a=a.clientX;var c=this.originMousePos-a;b.contains(dojo.doc.body.parentNode,"esriRtl")&&(c=-c);this.originMousePos=a;this._updatePosition(this._calcRelativePosition(this._calcPosition(this.relativeSliderPosition)+
c));return!1}})},_stopScrollTargetDragging:function(a){document.onmousemove=function(){};a.preventDefault()},_setupEventHandlers:function(){var a=h(this.scrollBarSpace,"click",c.hitch(this,function(a){a.preventDefault();this.updateWidth();this._updatePosition((a[this.PAGE_Y]-this.scrollBarContainer.getBoundingClientRect()[this.TOP])/this._getDimension());a.stopPropagation()}));this._onHandles.push(a);a=h(this.scrollTarget,void 0===l("mozilla")?"mousewheel":"DOMMouseScroll",c.hitch(this,function(a){a.preventDefault();
a.stopPropagation();a=void 0===l("mozilla")?a.wheelDelta:-60*a.detail;this._updatePosition((this._getAbsoluteDimension()-a/(12*this.wheelDir))/this._getTrackDimension())}));this._onHandles.push(a);a=h(this.scrollBarHandleHitArea,"mousedown",c.hitch(this,function(a){a.preventDefault();a.stopPropagation();1==a.which&&(this.state=1,b.contains(dojo.doc.body.parentNode,"esriRtl")?this.mousePosRelativeToHandle=Math.min(this.scrollBarHandleHitArea[this.OFFSET_DIMENSION],Math.max(0,-a[this.PAGE_Y]+this.scrollBarHandleHitArea.getClientRects()[0][this.TOP])):
this.mousePosRelativeToHandle=Math.min(this.scrollBarHandleHitArea[this.OFFSET_DIMENSION],Math.max(0,a[this.PAGE_Y]-this.scrollBarHandleHitArea.getClientRects()[0][this.TOP])))}));this._onHandles.push(a);a=h(document,"mousemove",c.hitch(this,function(a){1==this.state&&(a.preventDefault(),b.contains(dojo.doc.body.parentNode,"esriRtl")?this._updatePosition((this.scrollBarContainer.getBoundingClientRect()[this.TOP]-a[this.PAGE_Y]-this.mousePosRelativeToHandle)/this._getTrackDimension()):this._updatePosition((a[this.PAGE_Y]-
this.scrollBarContainer.getBoundingClientRect()[this.TOP]-this.mousePosRelativeToHandle)/this._getTrackDimension()))}));this._onHandles.push(a);a=h(document,"mouseup",c.hitch(this,function(a){1==this.state&&(a.preventDefault(),this.state=0)}));this._onHandles.push(a);n(this.scrollBarContainer,this.scrollTarget,void 0===l("mozilla")?"mousewheel":"DOMMouseScroll")},_calcRelativePosition:function(a){return a/(this.scrollTarget.scrollWidth-this.scrollTarget.offsetWidth)},_calcPosition:function(a){return a*
(this.scrollTarget.scrollWidth-this.scrollTarget.offsetWidth)},_getDimension:function(){return this.scrollBarContainer[this.OFFSET_DIMENSION]},_getTrackDimension:function(){return this.scrollBarHandleContainer[this.OFFSET_DIMENSION]},_getAbsoluteDimension:function(){return Math.round(this._getTrackDimension()*this.relativeSliderPosition)},_updatePosition:function(a,b,c){this.relativeSliderPosition=Math.min(Math.max(a,0.0010),0.999);this.scrollBarHandleHitArea.style[this.TOP]=this._getAbsoluteDimension()-
this.scrollBarHandleHitArea[this.OFFSET_DIMENSION]/2+"px";b||this._scrollTo(this.relativeSliderPosition)},_scrollTo:function(a){var c=this.scrollTarget.scrollWidth-this.scrollTarget.offsetWidth;a=Math.ceil(a*c);a=a<=c?a:c;a=0<a?a:0;if(b.contains(dojo.doc.body.parentNode,"esriRtl"))if(l("mozilla"))a=-a;else if(l("chrome")||l("safari"))a=c-a;this.scrollTarget.scrollLeft=a},setRange:function(a,b){this.min=a;this.max=b},get:function(){return this.relativeSliderPosition},set:function(a,b){0===this.state&&
this.updatePos(a,b)},setInRange:function(a){this.set((a-this.min)/(this.max-this.min))},enableScrollTargetDrag:function(){this.scrollTarget&&(this.scrollTarget.addEventListener("mousedown",c.hitch(this,function(a){this._startScrollTargetDragging(a)}),!0),this.scrollTarget.addEventListener("touchmove",s,!0),this.scrollTarget.addEventListener("touchstart",s,!0),this.scrollTarget.addEventListener("touchend",s,!0),this.scrollTarget.addEventListener("touchcancel",s,!0))},disableScrollTargetDrag:function(){this.scrollTarget&&
(this.scrollTarget.removeEventListener("mousedown",c.hitch(this,function(a){this._stopScrollTargetDragging(a)}),!0),this.scrollTarget.removeEventListener("touchmove",s,!0),this.scrollTarget.removeEventListener("touchstart",s,!0),this.scrollTarget.removeEventListener("touchend",s,!0),this.scrollTarget.removeEventListener("touchcancel",s,!0))},resize:function(){this.scrollBarHandleContainer.style[this.DIMENSION]=this._getDimension()+"px";this.scrollBarSpace.style[this.DIMENSION]=this._getDimension()+
"px";this.scrollBarHandleHitArea.getClientRects()[0]&&(this.scrollBarHandleContainer.style[this.DIMENSION]=this._getDimension()-this.scrollBarHandleHitArea.getClientRects()[0][this.DIMENSION]+"px");this._updatePosition(this.relativeSliderPosition)},updateWidth:function(){var a=0.2*this.scrollTarget.offsetWidth,a=Math.max(Math.min(this.scrollTarget.offsetWidth-(this.scrollTarget.scrollWidth-this.scrollTarget.offsetWidth),0.5*this.scrollTarget.offsetWidth),a);this.scrollBarHandleHitArea.style.width=
a+"px";16>this.scrollTarget.scrollWidth-this.scrollTarget.offsetWidth?g.hide(this.scrollBarHandleHitArea):g.show(this.scrollBarHandleHitArea);this.resize()}})})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),function(k,m,d,q,c,g,h,l,b,f,n,s,x){return c("dijit.form._FormSelectWidget",
x,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,onLoadDeferred:null,getOptions:function(a){var c=this.options||[];if(null==
a)return c;if(b.isArray(a))return k.map(a,"return this.getOptions(item);",this);b.isString(a)&&(a={value:a});b.isObject(a)&&(k.some(c,function(b,c){for(var d in a)if(!(d in b)||b[d]!=a[d])return!1;a=c;return!0})||(a=-1));return 0<=a&&a<c.length?c[a]:null},addOption:function(a){k.forEach(b.isArray(a)?a:[a],function(a){a&&b.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(b.isArray(a)?a:[a]);k.forEach(a,function(a){a&&(this.options=k.filter(this.options,
function(b){return b.value!==a.value||b.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){k.forEach(b.isArray(a)?a:[a],function(a){var b=this.getOptions({value:a.value}),c;if(b)for(c in a)b[c]=a[c]},this);this._loadChildren()},setStore:function(a,b,c){l.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(a,b,c)},_deprecatedSetStore:function(a,c,f){var g=this.store;f=f||{};if(g!==a){for(var h;h=this._notifyConnections.pop();)h.remove();a.get||(b.mixin(a,{_oldAPI:!0,get:function(a){var b=new m;this.fetchItemByIdentity({identity:a,onItem:function(a){b.resolve(a)},onError:function(a){b.reject(a)}});return b.promise},query:function(a,c){var d=new m(function(){f.abort&&f.abort()});d.total=new m;var f=this.fetch(b.mixin({query:a,onBegin:function(a){d.total.resolve(a)},
onComplete:function(a){d.resolve(a)},onError:function(a){d.reject(a)}},c));return new s(d)}}),a.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[d.after(a,"onNew",b.hitch(this,"_onNewItem"),!0),d.after(a,"onDelete",b.hitch(this,"_onDeleteItem"),!0),d.after(a,"onSet",b.hitch(this,"_onSetItem"),!0)]));this._set("store",a)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);f.query&&this._set("query",f.query);f.queryOptions&&this._set("queryOptions",f.queryOptions);a&&a.query&&(this._loadingStore=!0,this.onLoadDeferred=new m,this._queryRes=a.query(this.query,this.queryOptions),n(this._queryRes,b.hitch(this,function(d){if(this.sortByLabel&&!f.sort&&d.length)if(a.getValue)d.sort(q.createSortFunction([{attribute:a.getLabelAttributes(d[0])[0]}],a));else{var g=this.labelAttr;d.sort(function(a,b){return a[g]>b[g]?1:b[g]>
a[g]?-1:0})}f.onFetch&&(d=f.onFetch.call(this,d,f));k.forEach(d,function(a){this._addOptionForItem(a)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(b.hitch(this,function(a,b,c){b==c?this._onSetItem(a):(-1!=b&&this._onDeleteItem(a),-1!=c&&this._onNewItem(a))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:c);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(d):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),function(a){console.error("dijit.form.Select: "+a.toString());this.onLoadDeferred.reject(a)}));return g},_setValueAttr:function(a,c){this._onChangeActive||(c=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=b.isArray(a)?k.map(a,function(a){return b.isObject(a)?a:{value:a}}):b.isObject(a)?[a]:[{value:a}];a=k.filter(this.getOptions(a),function(a){return a&&a.value});var d=this.getOptions()||[];if(!this.multiple&&(!a[0]||!a[0].value)&&d.length)a[0]=d[0];k.forEach(d,
function(b){b.selected=k.some(a,function(a){return a.value===b.value})});d=k.map(a,function(a){return a.value});if(!("undefined"==typeof d||"undefined"==typeof d[0])){var f=k.map(a,function(a){return a.label});this._setDisplay(this.multiple?f:f[0]);this.inherited(arguments,[this.multiple?d:d[0],c]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=k.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?a:a[0]},
_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(k.forEach(this._getChildren(),function(a){a.destroyRecursive()}),k.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var b=this;k.forEach(this._getChildren(),function(c){var d=k.some(a,function(a){return c.option&&
a===c.option.value});d&&!b.multiple&&(b.focusedChild=c);h.toggle(c.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),d);c.domNode.setAttribute("aria-selected",d?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=k.filter(a,function(a){return a.selected})[0];if(b&&b.value)return b.value;a[0].selected=!0;return a[0].value}return this.multiple?k.map(k.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,b){(!b||!b.parent)&&this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,c=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:b.getLabel(a);return{value:c?b.getIdentity(a):null,label:c,item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded&&!b.isItemLoaded(a)?b.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);g.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?f("\x3e *",this.srcNodeRef).map(function(a){return"separator"===a.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:a.getAttribute("data-"+l._scopeName+"-value")||a.getAttribute("value"),
label:String(a.innerHTML),selected:a.getAttribute("selected")||!1,disabled:a.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);d.after(this,"onChange",b.hitch(this,"_updateSelection"));var a=this.store;if(a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"]))this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions});this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dijit/layout/_TabContainerBase":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style ./StackContainer ./utils ../registry ../_TemplatedMixin dojo/text!./templates/TabContainer.html".split(" "),function(k,m,d,q,c,g,h,l,b){return k("dijit.layout._TabContainerBase",[c,l],{tabPosition:"top",baseClass:"dijitTabContainer",tabStrip:!1,nested:!1,
templateString:b,postMixInProperties:function(){this.baseClass+=this.tabPosition.charAt(0).toUpperCase()+this.tabPosition.substr(1).replace(/-.*/,"");this.srcNodeRef&&q.set(this.srcNodeRef,"visibility","hidden");this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.tablist=this._makeController(this.tablistNode);this.doLayout||m.add(this.domNode,"dijitTabContainerNoLayout");this.nested?(m.add(this.domNode,"dijitTabContainerNested"),m.add(this.tablist.containerNode,"dijitTabContainerTabListNested"),
m.add(this.tablistSpacer,"dijitTabContainerSpacerNested"),m.add(this.containerNode,"dijitTabPaneWrapperNested")):m.add(this.domNode,"tabStrip-"+(this.tabStrip?"enabled":"disabled"))},_setupChild:function(b){m.add(b.domNode,"dijitTabPane");this.inherited(arguments)},startup:function(){this._started||(this.tablist.startup(),this.inherited(arguments))},layout:function(){if(this._contentBox&&"undefined"!=typeof this._contentBox.l){var b=this.selectedChildWidget;if(this.doLayout){var c=this.tabPosition.replace(/-h/,
"");this.tablist.region=c;c=[this.tablist,{domNode:this.tablistSpacer,region:c},{domNode:this.containerNode,region:"center"}];g.layoutChildren(this.domNode,this._contentBox,c);this._containerContentBox=g.marginBox2contentBox(this.containerNode,c[2]);b&&b.resize&&b.resize(this._containerContentBox)}else{if(this.tablist.resize){c=this.tablist.domNode.style;c.width="0";var h=d.getContentBox(this.domNode).w;c.width="";this.tablist.resize({w:h})}b&&b.resize&&b.resize()}}},destroy:function(b){this.tablist&&
this.tablist.destroy(b);this.inherited(arguments)},selectChild:function(b,c){this._focused&&(b=h.byId(b),this.tablist.pane2button(b.id).focus());return this.inherited(arguments)}})})},"dijit/popup":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on ./place ./BackgroundIframe ./Viewport ./main".split(" "),function(k,m,d,q,c,g,h,l,b,f,n,s,x,a,r,z){function t(){this._popupWrapper&&
(g.destroy(this._popupWrapper),delete this._popupWrapper)}d=d(null,{_stack:[],_beginZIndex:1E3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var a=this._firstAroundPosition,b=h.position(this._firstAroundNode,!0),c=b.x-a.x,a=b.y-a.y;if(c||a){this._firstAroundPosition=b;for(b=0;b<this._stack.length;b++){var d=this._stack[b].wrapper.style;d.top=parseFloat(d.top)+a+"px";"auto"==d.right?d.left=parseFloat(d.left)+c+"px":d.right=parseFloat(d.right)-c+"px"}}this._aroundMoveListener=setTimeout(n.hitch(this,
"_repositionAll"),c||a?10:50)}},_createWrapper:function(a){var b=a._popupWrapper,c=a.domNode;b||(b=g.create("div",{"class":"dijitPopup",style:{display:"none"},role:"region","aria-label":a["aria-label"]||a.label||a.name||a.id},a.ownerDocumentBody),b.appendChild(c),c=c.style,c.display="",c.visibility="",c.position="",c.top="0px",a._popupWrapper=b,m.after(a,"destroy",t,!0),"ontouchend"in document&&s(b,"touchend",function(a){/^(input|button|textarea)$/i.test(a.target.tagName)||a.preventDefault()}));return b},
moveOffScreen:function(a){var b=this._createWrapper(a);a=h.isBodyLtr(a.ownerDocument);var c={visibility:"hidden",top:"-9999px",display:""};c[a?"left":"right"]="-9999px";c[a?"right":"left"]="auto";l.set(b,c);return b},hide:function(a){var b=this._createWrapper(a);l.set(b,{display:"none",height:"auto",overflow:"visible",border:""});a=a.domNode;"_originalStyle"in a&&(a.style.cssText=a._originalStyle)},getTopPopup:function(){for(var a=this._stack,b=a.length-1;0<b&&a[b].parent===a[b-1].widget;b--);return a[b]},
open:function(d){for(var g=this._stack,k=d.popup,m=k.domNode,t=d.orient||["below","below-alt","above","above-alt"],z=d.parent?d.parent.isLeftToRight():h.isBodyLtr(k.ownerDocument),G=d.around,J=d.around&&d.around.id?d.around.id+"_dropdown":"popup_"+this._idGen++;g.length&&(!d.parent||!q.isDescendant(d.parent.domNode,g[g.length-1].widget.domNode));)this.close(g[g.length-1].widget);var C=this.moveOffScreen(k);k.startup&&!k._started&&k.startup();var K,Q=h.position(m);if("maxHeight"in d&&-1!=d.maxHeight)K=
d.maxHeight||Infinity;else{K=r.getEffectiveBox(this.ownerDocument);var N=G?h.position(G,!1):{y:d.y-(d.padding||0),h:2*(d.padding||0)};K=Math.floor(Math.max(N.y,K.h-(N.y+N.h)))}Q.h>K&&(Q=l.getComputedStyle(m),l.set(C,{overflowY:"scroll",height:K+"px",border:Q.borderLeftWidth+" "+Q.borderLeftStyle+" "+Q.borderLeftColor}),m._originalStyle=m.style.cssText,m.style.border="none");c.set(C,{id:J,style:{zIndex:this._beginZIndex+g.length},"class":"dijitPopup "+(k.baseClass||k["class"]||"").split(" ")[0]+"Popup",
dijitPopupParent:d.parent?d.parent.id:""});0==g.length&&G&&(this._firstAroundNode=G,this._firstAroundPosition=h.position(G,!0),this._aroundMoveListener=setTimeout(n.hitch(this,"_repositionAll"),50));b("config-bgIframe")&&!k.bgIframe&&(k.bgIframe=new a(C));J=k.orient?n.hitch(k,"orient"):null;t=G?x.around(C,G,t,z,J):x.at(C,d,"R"==t?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],d.padding,J);C.style.visibility="visible";m.style.visibility="visible";m=[];m.push(s(C,"keydown",n.hitch(this,function(a){if(a.keyCode==
f.ESCAPE&&d.onCancel)a.stopPropagation(),a.preventDefault(),d.onCancel();else if(a.keyCode==f.TAB&&(a.stopPropagation(),a.preventDefault(),(a=this.getTopPopup())&&a.onCancel))a.onCancel()})));k.onCancel&&d.onCancel&&m.push(k.on("cancel",d.onCancel));m.push(k.on(k.onExecute?"execute":"change",n.hitch(this,function(){var a=this.getTopPopup();if(a&&a.onExecute)a.onExecute()})));g.push({widget:k,wrapper:C,parent:d.parent,onExecute:d.onExecute,onCancel:d.onCancel,onClose:d.onClose,handlers:m});if(k.onOpen)k.onOpen(t);
return t},close:function(a){for(var b=this._stack;a&&k.some(b,function(b){return b.widget==a})||!a&&b.length;){var c=b.pop(),d=c.widget,f=c.onClose;d.bgIframe&&(d.bgIframe.destroy(),delete d.bgIframe);if(d.onClose)d.onClose();for(var g;g=c.handlers.pop();)g.remove();d&&d.domNode&&this.hide(d);f&&f()}0==b.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=this._aroundMoveListener=null)}});return z.popup=new d})},"dijit/form/_RadioButtonMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/lang dojo/query!css2 ../registry".split(" "),
function(k,m,d,q,c,g){return m("dijit.form._RadioButtonMixin",null,{type:"radio",_getRelatedWidgets:function(){var d=[];c("input[type\x3dradio]",this.focusNode.form||this.ownerDocument).forEach(q.hitch(this,function(c){c.name==this.name&&c.form==this.focusNode.form&&(c=g.getEnclosingWidget(c))&&d.push(c)}));return d},_setCheckedAttr:function(c){this.inherited(arguments);this._created&&c&&k.forEach(this._getRelatedWidgets(),q.hitch(this,function(c){c!=this&&c.checked&&c.set("checked",!1)}))},_getSubmitValue:function(c){return null==
c?"on":c},_onClick:function(c){return this.checked||this.disabled?(c.stopPropagation(),c.preventDefault(),!1):this.readOnly?(c.stopPropagation(),c.preventDefault(),k.forEach(this._getRelatedWidgets(),q.hitch(this,function(c){d.set(this.focusNode||this.domNode,"checked",c.checked)})),!1):this.inherited(arguments)}})})},"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',
"url:webSceneViewer/widgets/ScrollBar/templates/ScrollBar.html":'\x3cdiv data-dojo-attach-point\x3d"scrollBarContainer" class\x3d"scrollBarContainer"\x3e\r\n    \x3cdiv class\x3d"scrollBarSpace" data-dojo-attach-point\x3d"scrollBarSpace" \x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"scrollBarHandleContainer" class\x3d"scrollBarHandleContainer"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"scrollBarHandleHitArea" class\x3d"scrollBarHandleHitArea" \x3e\r\n            \x3cdiv class\x3d"scrollBarHandle" \x3e\r\n                \x3cdiv style\x3d"display: none;" class\x3d"handleT"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:webSceneViewer/widgets/MessageListWidget/templates/MessageWidget.html":'\x3cdiv class\x3d"MessageWidget"  data-dojo-attach-event\x3d"click:_expand"\x3e\r\n    \x3cdiv class\x3d"" data-dojo-attach-point\x3d"MessageTypeIcon"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"MessageShortDesc" class \x3d "MessageTitle"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"MessageDetails" class \x3d "MessageContent"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"closeIcon" data-dojo-attach-event\x3d"click:_remove"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"ExpandIcon" class\x3d"arrowIcon"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:webSceneViewer/widgets/SplashScreen/templates/SplashScreen.html":'\x3cdiv class\x3d"splashScreen"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"firstParagraph"\x3e\x3c/div\x3e\r\n    \x3cbutton data-dojo-attach-point\x3d"signInButton" class\x3d"blueButton smallButton" data-dojo-attach-event\x3d"click:_signInClick"\x3e\x3c/button\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"secondParagraph"\x3e\x3c/div\x3e\r\n    \x3cbutton data-dojo-attach-point\x3d"tryOutButton" class\x3d"orangeButton smallButton" data-dojo-attach-event\x3d"click:_tryArcGISClick"\x3e\x3c/button\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"thirdParagraph"\x3e\x3c/div\x3e\r\n    \x3cbutton data-dojo-attach-point\x3d"galleryButton" class\x3d"greyButton smallButton"  data-dojo-attach-event\x3d"click:_galleryClick"\x3e\x3c/button\x3e\r\n\x3c/div\x3e',
"url:webSceneViewer/widgets/Switch/templates/Switch.html":'\x3cdiv class\x3d"switch" data-dojo-attach-event\x3d"click:_toggleSwitch"\x3e\r\n    \x3cdiv class\x3d"switchContainer" data-dojo-attach-point\x3d"SwitchContainer"\x3e\r\n        \x3cdiv class\x3d"labelOn" data-dojo-attach-point\x3d"LabelOn"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"slider"\x3e\x3cdiv class\x3d"sliderInner"\x3e\x3c/div\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"labelOff" data-dojo-attach-point\x3d"LabelOff"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/layout/templates/_ScrollingTabControllerButton.html":'\x3cdiv data-dojo-attach-event\x3d"ondijitclick:_onClick" class\x3d"dijitTabInnerDiv dijitTabContent dijitButtonContents"  data-dojo-attach-point\x3d"focusNode" role\x3d"button"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitTabStripIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d"containerNode,titleNode" class\x3d"dijitButtonText"\x3e\x3c/span\x3e\r\n\x3c/div\x3e',
"url:dijit/layout/templates/TabContainer.html":'\x3cdiv class\x3d"dijitTabContainer"\x3e\r\n\t\x3cdiv class\x3d"dijitTabListWrapper" data-dojo-attach-point\x3d"tablistNode"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"tablistSpacer" class\x3d"dijitTabSpacer ${baseClass}-spacer"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dijitTabPaneWrapper ${baseClass}-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:webSceneViewer/widgets/LayerWidget/templates/LayerItem.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"LayerItem" data-dojo-attach-point\x3d"LayerItem"\x3e\r\n    \x3clabel\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"layerVisInputCheckbox"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"titleNode" class\x3d"layerItemSpan"\x3e\x3c/span\x3e\r\n    \x3c/label\x3e\r\n    \x3cbutton class\x3d"icon_frame right inactive" data-dojo-attach-point\x3d"layerFrameButton" data-dojo-attach-event\x3d"click:_layerFrameButtonClick" title\x3d"Frame layer" \x3e\x3c/button\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"statDomNode" class\x3d"status layerAdd"\x3e\r\n        \x3cdiv class\x3d"layerUpdatingPercentageContainer"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"statDomNodeProgressbarUpper" class\x3d"progressbarUpper"\x3e \x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"statDomNodeProgressbarLower" class\x3d"progressbarLower"\x3e \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/span\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:webSceneViewer/widgets/Dialog/templates/ConfirmDialog.html":'\x3cdiv class\x3d"dijitDialog confirmDialog" role\x3d"dialog" aria-labelledby\x3d"${id}_title"\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"titleBar" class\x3d"dijitDialogTitleBar"\x3e\r\n    \x3cspan data-dojo-attach-point\x3d"titleNode" class\x3d"dijitDialogTitle" id\x3d"${id}_title" role\x3d"heading" level\x3d"1"\x3e\x3c/span\x3e\r\n    \x3cspan data-dojo-attach-point\x3d"closeButtonNode" class\x3d"dijitDialogCloseIcon" data-dojo-attach-event\x3d"ondijitclick: onCancel" title\x3d"${buttonCancel}" role\x3d"button" tabindex\x3d"0"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"closeText" class\x3d"closeText" title\x3d"${buttonCancel}"\x3ex\x3c/span\x3e\r\n    \x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitDialogPaneContent"\x3e\r\n    \x3cdiv class\x3d"dijitDialogPaneContentArea"\x3e\r\n      \x3cdiv class\x3d"confirmDialogContentNode"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"Message"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"dijitDialogPaneActionBar"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" type\x3d"submit" data-dojo-attach-event\x3d"click: _confirmButtonClickHandler" data-dojo-attach-point\x3d"buttonConfirm"\x3e\x3c/button\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" type\x3d"button" data-dojo-attach-event\x3d"click: onCancel" title\x3d"${buttonCancel}" data-dojo-attach-point\x3d"buttonCancel"\x3e\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:webSceneViewer/widgets/MessageListWidget/templates/MessageListWidget.html":'\x3cdiv class\x3d"MessageList" data-dojo-attach-point\x3d"MessageList"\x3e\r\n    \x3cdiv class\x3d"MessageListContent" data-dojo-attach-point\x3d"MessageListContentNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',"url:webSceneViewer/widgets/ShareDialog/templates/ShareDialog.html":'\x3cdiv class\x3d"shareDialog" \x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"Text"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"linkShare" data-dojo-attach-point\x3d"LinkShareContainer"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"LinkText" class\x3d"shareLinkText"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"shareLinkIcons"\x3e\r\n      \x3cdiv class\x3d"email" data-dojo-attach-event\x3d"click:_toEmail"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"facebook" data-dojo-attach-event\x3d"click:_toFacebook" data-dojo-attach-point\x3d"FacebookShare"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"twitter" data-dojo-attach-event\x3d"click:_toTwitter" data-dojo-attach-point\x3d"TwitterShare"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3clabel\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"ShortenLinkCheckbox"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"ShortenLinkText"\x3e\x3c/span\x3e\r\n    \x3c/label\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"embedShare"  data-dojo-attach-point\x3d"EmbedShareContainer"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"embedText" class\x3d"shareEmbedText"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"moreOptions" data-dojo-attach-event\x3d"click:_moreOptionsExpandCollapse"\x3e\r\n      \x3cdiv class\x3d"moreOptionsIcon" data-dojo-attach-point\x3d"MoreOptionsIcon"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"moreOptionsText" data-dojo-attach-point\x3d"MoreOptionsText"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"MoreOptionsContainer" class\x3d"moreOptionsContainer collapsed"\x3e\r\n      \x3cdiv class\x3d"sizeSelect" data-dojo-attach-point\x3d"SizeSelect"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"customSize disable" data-dojo-attach-point\x3d"CustomSizeContainer"\x3e\r\n      \x3cdiv class\x3d"timesConnector"\x3eX\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"shareMessage" data-dojo-attach-point\x3d"ShareMessage"\x3e\r\n    \x3cdiv class\x3d"infoIcon"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"ShareMessageText" class\x3d"shareMessageText"\x3e\x3c/div\x3e\r\n    \x3ca href\x3d""  target\x3d"_blank" data-dojo-attach-point\x3d"ChangeSettingsLink" class\x3d"changeSettingsLink"\x3e\x3c/a\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:esri/widgets/Search/templates/Search.html":'\x3cdiv role\x3d"presentation" class\x3d"${css.root}"\x3e\r\n  \x3cdiv role\x3d"presentation" class\x3d"${css.searchGroup}" data-dojo-attach-point\x3d"containerNode"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"expandNode" class\x3d"${css.searchExpandContainer}"\x3e\r\n      \x3cdiv class\x3d"${css.searchAnimateContainer}"\x3e\r\n        \x3cdiv role\x3d"button" title\x3d"${_i18n.searchIn}" id\x3d"${id}_menu_button" class\x3d"${css.searchBtn} ${css.searchToggle}" tabindex\x3d"0" data-dojo-attach-point\x3d"sourcesBtnNode"\x3e\r\n          \x3cspan aria-hidden\x3d"true" role\x3d"presentation" class\x3d"${css.searchToggleIcon}"\x3e\x3c/span\x3e\x3cspan class\x3d"${css.searchSourceName}" data-dojo-attach-point\x3d"sourceNameNode"\x3e\x3c/span\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"${css.searchInputGroup}"\x3e\r\n          \x3cform data-dojo-attach-point\x3d"formNode"\x3e\r\n            \x3cinput maxlength\x3d"${maxLength}" autocomplete\x3d"off" type\x3d"text" tabindex\x3d"0" class\x3d"${css.searchInput}" value\x3d"${value}" aria-haspopup\x3d"true" id\x3d"${id}_input" data-dojo-attach-point\x3d"inputNode" role\x3d"textbox"\x3e\r\n          \x3c/form\x3e\r\n          \x3cdiv role\x3d"button" class\x3d"${css.searchClear}" tabindex\x3d"0" data-dojo-attach-point\x3d"clearNode"\x3e\x3cspan aria-hidden\x3d"true" class\x3d"${css.searchClearIcon}"\x3e\x3c/span\x3e\x3cspan aria-hidden\x3d"true" class\x3d"${css.searchSpinner}"\x3e\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv aria-labelledby\x3d"${id}_input" data-dojo-attach-point\x3d"suggestionsNode" class\x3d"${css.searchMenu} ${css.suggestionsMenu}" role\x3d"menu"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv role\x3d"button" title\x3d"${_i18n.searchButtonTitle}" class\x3d"${css.searchBtn} ${css.searchSubmit}" tabindex\x3d"0" data-dojo-attach-point\x3d"submitNode"\x3e\r\n      \x3cspan aria-hidden\x3d"true" role\x3d"presentation" class\x3d"${css.searchIcon}"\x3e\x3c/span\x3e\r\n      \x3cspan class\x3d"${css.searchButtonText}"\x3e${_i18n.searchButtonTitle}\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv aria-labelledby\x3d"${id}_menu_button" data-dojo-attach-point\x3d"sourcesNode" class\x3d"${css.searchMenu} ${css.sourcesMenu}" role\x3d"menu"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"noResultsMenuNode" class\x3d"${css.searchMenu} ${css.searchNoResultsMenu}"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"${css.searchClearFloat}"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/layout/templates/_TabButton.html":'\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"titleNode,innerDiv,tabContent" class\x3d"dijitTabInner dijitTabContent"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTabButtonIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d\'containerNode,focusNode\' class\x3d\'tabLabel\'\x3e\x3c/span\x3e\r\n\t\x3cspan class\x3d"dijitInline dijitTabCloseButton dijitTabCloseIcon" data-dojo-attach-point\x3d\'closeNode\'\r\n\t\t  role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d\'closeText\' class\x3d\'dijitTabCloseText\'\x3e[x]\x3c/span\r\n\t\t\t\t\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/layout/templates/ScrollingTabController.html":'\x3cdiv class\x3d"dijitTabListContainer-${tabPosition}" style\x3d"visibility:hidden"\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerMenuButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_menuBtn"\r\n\t\t data-dojo-props\x3d"containerId: \'${containerId}\', iconClass: \'dijitTabStripMenuIcon\',\r\n\t\t\t\t\tdropDownPosition: [\'below-alt\', \'above-alt\']"\r\n\t\t data-dojo-attach-point\x3d"_menuBtn" showLabel\x3d"false" title\x3d""\x3e\x26#9660;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_leftBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideLeftIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_leftBtn" data-dojo-attach-event\x3d"onClick: doSlideLeft"\x3e\x26#9664;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_rightBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideRightIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_rightBtn" data-dojo-attach-event\x3d"onClick: doSlideRight"\x3e\x26#9654;\x3c/div\x3e\r\n\t\x3cdiv class\x3d\'dijitTabListWrapper\' data-dojo-attach-point\x3d\'tablistWrapper\'\x3e\r\n\t\t\x3cdiv role\x3d\'tablist\' data-dojo-attach-event\x3d\'onkeydown:onkeydown\'\r\n\t\t\t data-dojo-attach-point\x3d\'containerNode\' class\x3d\'nowrapTabStrip\'\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:webSceneViewer/widgets/Settings/templates/Settings.html":'\x3cdiv class\x3d"Settings"\x3e\r\n    \x3cdiv class\x3d"mouseNavigation"\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"mouseNavigation" class\x3d"subHeader"\x3e\x3c/span\x3e\r\n        \x3cdiv class\x3d"navImage" data-dojo-attach-point\x3d"navigationImage"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"navGroup"\x3e\r\n        \x3clabel\x3e\r\n            \x3cinput data-dojo-attach-point\x3d"WSVNavigationRadioButton"\x3e\r\n            \x3cspan data-dojo-attach-point\x3d"WSVNavigationLabel" class\x3d"RadioLabel"\x3e\x3c/span\x3e\r\n        \x3c/label\x3e\r\n        \x3clabel\x3e\r\n        \x3cinput data-dojo-attach-point\x3d"ProNavigationRadioButton"\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"ProNavigationLabel" class\x3d"RadioLabel"\x3e\x3c/span\x3e\r\n        \x3c/label\x3e\r\n        \x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"*now":function(k){k(['dojo/i18n!*preload*webSceneViewer/nls/Viewer*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])}}});
define("esri/core/declare dojo/on dojo/dom-construct dojo/query dojo/dom-class dojo/string esri/core/watchUtils esri/layers/SceneLayer esri/layers/GraphicsLayer esri/geometry/Point esri/layers/support/LabelClass esri/Graphic esri/geometry/SpatialReference esri/symbols/PictureMarkerSymbol require esri/geometry/support/webMercatorUtils esri/widgets/PopupLegacy/InfoTemplate esri/layers/FeatureLayer webSceneViewer/widgets/MenuContainer/MenuContainer webSceneViewer/widgets/LayerWidget/LayerWidget webSceneViewer/widgets/EnvironmentSettings/EnvironmentSettings webSceneViewer/widgets/Settings/Settings webSceneViewer/webScene/WebScene dijit/layout/TabContainer esri/widgets/Legend esri/layers/GroupLayer esri/widgets/Search esri/tasks/Locator webSceneViewer/widgets/BasemapGallery/BasemapGallery webSceneViewer/widgets/SplashScreen/SplashScreen webSceneViewer/widgets/MessageListWidget/MessageListWidget webSceneViewer/widgets/ShareDialog/ShareDialog webSceneViewer/spatialReferenceUtils webSceneViewer/basemapUtils dojo/Evented dojo/i18n!./nls/viewer".split(" "),function(k,
m,d,q,c,g,h,l,b,f,n,s,x,a,r,z,t,w,B,H,A,O,I,G,J,C,K,Q,N,F,R,M,U,L,p,y){return k(p,{_domNode:void 0,map:void 0,_featuredLayer:void 0,_portalLayer:void 0,_userLayer:void 0,_silentLayer:void 0,sceneSRLocked:void 0,constructor:function(a,b,c,d,f){this.view=b;this.map=b.map;this.webscene=c;this.portal=d;this._onHandles={};this.updateSceneSRLockState(f);this.webscene.watch("presentation",function(){this.updateSceneSRLockState()}.bind(this));m(this.map,"layer-add",function(){this.updateSceneSRLockState()}.bind(this));
if(!f.ui||"min"!==f.ui)this.createMenu(a,(void 0!==f.webscene?""!==f.webscene:!1)||(void 0!==f.url?""!==f.url:!1)||(void 0!==f.layers?""!==f.layers:!1));this.addSceneServiceLogEventListeners(this.map);this._onHandles={};this._basemapTerrainErrorEventHandle=null;h.init(b,"basemapTerrain",function(a){this._basemapTerrainErrorEventHandle&&(this._basemapTerrainErrorEventHandle.remove(),this._basemapTerrainErrorEventHandle=null);a&&(this._basemapTerrainErrorEventHandle=a.on("error",this.handleBasemapTerrainErrorEvent))}.bind(this))},
destroy:function(){this._onHandles.forEach(function(a){a.remove()});this._onHandles.length=0;this._basemapTerrainErrorEventHandle&&(this._basemapTerrainErrorEventHandle.remove(),this._basemapTerrainErrorEventHandle=null);this._featuredLayer&&(this._silentLayer.remove(this._featuredLayer),this._featuredLayer.destroy(),this._featuredLayer=null);this._portalLayer&&(this._silentLayer.remove(this._portalLayer),this._portalLayer.destroy(),this._portalLayer=null);this._userLayer&&(this._silentLayer.remove(this._userLayer),
this._userLayer.destroy(),this._userLayer=null);this._silentLayer&&(this.map.remove(this._silentLayer),this._silentLayer.destroy(),this._silentLayer=null)},createMenu:function(a,f){var e=new B(a),g=0,h=d.create("div",{style:"min-height:10px; width:100%;"});this._tabContainer=new G({doLayout:!1},h);h=e.add({title:y.menu.titleLayers,id:"layers",show:!0,hideTitle:!0,onSelectMethod:function(){this._tabContainer.layout()}.bind(this)});h.appendChild(this._tabContainer.domNode);var k=h.previousSibling;k.appendChild(this._tabContainer.domNode.children[0]);
var l=new H({title:y.menu.titleLayers,view:this.view});this._tabContainer.addChild(l);var n,h=e.add({title:y.menu.titleSearch,id:"search",show:!0,onSelectMethod:function(){n.focus()}}),h=d.create("div",{"class":"GeocoderContainer"},h),p=new b({id:"GeocodeSearchResultsLayer"});p._websceneEditorProperties={};if(this.portal&&this.portal.helperServices&&this.portal&&this.portal.helperServices.geocode){var r=this.portal.helperServices.geocode;r.forEach(function(a,b){if(-1<a.url.indexOf(".arcgis.com/arcgis/rest/services/World/GeocodeServer")||
a.suggest)-1<a.url.indexOf(".arcgis.com/arcgis/rest/services/World/GeocodeServer")&&(a.suggest=a.placefinding=a.batch=a.esri=!0,a.outFields=["Match_addr","StAddr","City"]),a.singleLineFieldName=a.singleLineFieldName||"SingleLine",a.localSearchOptions={minScale:3E5,distance:5E4};a.locator=new Q(a.url);a.distance=200});r=r.filter(function(a){return null!=a.singleLineFieldName&&null!=a.placefinding&&a.placefinding});n=new K({map:this.map,view:this.view,sources:r,graphicsLayer:p},h)}else n=new K({map:this.map,
view:this.view,graphicsLayer:p},h);n.set("activeSourceIndex","all");n.startup();if(!this.portal||this.portal.userHasSharingPrivileges())this.shareDialog=new M({portal:this.portal,webscene:this.webscene,view:this.view}),h=e.add({title:y.menu.titleShare,id:"tridon",show:!0,onSelectMethod:function(){this.shareDialog.updateUrlViewpoint(!0);this.shareDialog.updateShareMessage()}.bind(this)}),this.shareDialog.placeAt(h),m(this.shareDialog,"share-email",function(a){this.emit("share-email",a)}.bind(this));
h=e.add({title:y.menu.titleBasemap,id:"basemap",show:!0});this.basemapGallery=new N({map:this.map,webscene:this.webscene,portal:this.portal,view:this.view,_sceneSRLocked:this.sceneSRLocked},h);h=e.add({title:y.menu.titleEnvironmentSettings,id:"environment",show:!0});new A(h,this.view);this.portal&&(!this.portal.isSignedIn()&&!f)&&(g=e.add({title:y.appName,id:"splash",show:!1}),(new F({portal:this.portal})).placeAt(g),g=e.panes.length-1,m(this.portal,"sign-in",function(a,b){e.setActive(-1)}.bind(this,
e)));h=e.add({title:y.menu.titleSettings,id:"settings",show:!0});this.settingsWidget=new O({view:this.view,id:"settingsWidget"});this.settingsWidget.placeAt(h);m(this.settingsWidget,"nav-mode-change",function(){this.emit("nav-mode-change")}.bind(this));e.setActive(g);this.menu=e;this._tabContainer.startup();g=this.createLayerLegend(this._tabContainer);!0===g.isLegendEmpty&&(h=q(".dijitTabInner.dijitTabContent.dijitTab",k),2===h.length&&c.add(h[1],"dijitHidden"));m(g,"legend-change",function(a){var b=
q(".dijitTabInner.dijitTabContent.dijitTab",k);2===b.length&&(b=b[1],a.empty?(-1!==b.className.indexOf("dijitTabChecked")&&this._tabContainer.selectChild(l),c.add(b,"dijitHidden")):c.remove(b,"dijitHidden"))}.bind(this))},refreshTools:function(){this._tabContainer&&this._tabContainer.layout()},primaryNavigationChanged:function(a){this.settingsWidget&&this.settingsWidget.primaryNavigationChanged(a)},addLayerIcon:function(c){if(this.map.spatialReference.isWebMercator()){void 0===this._silentLayer?(this._silentLayer=
new C({id:"SilentContentLayer"}),this.map.add(this._silentLayer)):this._silentLayer.set("visible",!0);var d={labelExpression:"[title]",labelPlacement:"esriServerPointLabelPlacementAboveCenter",symbol:{type:"LabelSymbol3D",symbolLayers:[{size:10,type:"Text",material:{color:[0,95,150],transparency:0},font:{family:"Arial",style:"normal",weight:"bold"},text:"default"}]}},e=[{name:"title",type:"esriFieldTypeString"}];"featured"===c.category&&(this._featuredLayer||(this._featuredLayer=new b({id:"featuredLayer"}),
this._featuredLayer.popupTemplate={},this._featuredLayer.labelingInfo=[new n(d)],this._featuredLayer.fields=e,this._featuredLayer.showLabels=!0,this._silentLayer.add(this._featuredLayer)),this._featuredLayer.set("visible",c.showCategory));"portal"===c.category&&(this._portalLayer||(this._portalLayer=new b({id:"portalLayer"}),this._portalLayer.popupTemplate={},d.symbol.symbolLayers[0].material.color=[23,84,23],this._portalLayer.labelingInfo=[new n(d)],this._portalLayer.fields=e,this._portalLayer.showLabels=
!0,this._silentLayer.add(this._portalLayer)),this._portalLayer.set("visible",c.showCategory));"user"===c.category&&(this._userLayer||(this._userLayer=new b({id:"userLayer"}),this._userLayer.popupTemplate={},d.symbol.symbolLayers[0].material.color=[127,75,13],this._userLayer.labelingInfo=[new n(d)],this._userLayer.fields=e,this._userLayer.showLabels=!0,this._silentLayer.add(this._userLayer)),this._userLayer.set("visible",c.showCategory));e=d=0;if(0<c.item.extent.length){var d=c.item.extent[0][0]+(c.item.extent[1][0]-
c.item.extent[0][0])/2,e=c.item.extent[0][1]+(c.item.extent[1][1]-c.item.extent[0][1])/2,d=new f(d,e,1E4,x.WGS84),d=z.geographicToWebMercator(d),e="",h=23;switch(c.category){case "featured":e="/editor/images/featuredcontent.png";break;case "portal":e="/editor/images/content.png";h=20;break;default:e="/editor/images/mycontent.png",h=20}e=new a({url:r.toUrl(".")+e,width:h,height:h,contentType:"image/png"});d=new s(d,e,{title:c.item.title});(e=c.item.snippet)||(e=g.substitute(y.webglMessages.layerInfo,
{LayerType:c.item.displayName,Author:c.item.owner}));h="";c.item.thumbnailUrl&&(h='\x3cdiv class\x3d"PopupLayerImage" style\x3d"background-image:url(\''+c.item.thumbnailUrl+"')\"\x3e\x3c/div\x3e",e="\x3cdiv style\x3d'float:left'\x3e"+h+"\x3c/div\x3e\x3cdiv\x3e"+e+"\x3c/div\x3e");d.popupTemplate=new t(c.item.title,e);d.set("id",c.item.id);d.attributes.isGISSearchFeature=!0;switch(c.category){case "featured":this._featuredLayer.add(d);break;case "portal":this._portalLayer.add(d);break;default:this._userLayer.add(d)}}}},
removeAllLayerIcons:function(a){void 0!==this._featuredLayer&&this._featuredLayer.clear();void 0!==this._portalLayer&&this._portalLayer.clear();void 0!==this._userLayer&&this._userLayer.clear();this._silentLayer&&this._silentLayer.set("visible",!1)},showHideAllLayerIcons:function(a){this._silentLayer&&this._silentLayer.set("visible",a)},toggleLayerIconVisibility:function(a,b){if(b){var c=this._getLayerAndGraphic(a,b);c&&c.graphic.set("visible",!c.graphic.get("visible"))}else switch(a){case "featured":this._featuredLayer&&
this._featuredLayer.set("visible",!this._featuredLayer.get("visible"));break;case "portal":this._portalLayer&&this._portalLayer.set("visible",!this._portalLayer.get("visible"));break;case "user":this._userLayer&&this._userLayer.set("visible",!this._userLayer.get("visible"))}},createLayerLegend:function(a){this.layerLegend=new J({view:this.view,autoUpdate:!0,useAllMapLayers:!0,className:"layerLegend",title:y.menu.titleLegend},"legend");this.layerLegend.placeAt(a);return this.layerLegend},_getLayerAndGraphic:function(a,
b){var c=[],d={};"featured"===a&&(c=this._featuredLayer?this._featuredLayer.graphics.getAll():[],d=this._featuredLayer);"portal"===a&&(c=this._portalLayer?this._portalLayer.graphics.getAll():[],d=this._portalLayer);"user"===a&&(c=this._userLayer?this._userLayer.graphics.getAll():[],d=this._userLayer);for(var f=0;f<c.length;f++){var g=c[f];if(g.id===b)return{graphic:g,layer:d}}return null},toggleLayerIconPopup:function(a){if(a.show){if(a=this._getLayerAndGraphic(a.category,a.itemID)){a=a.graphic;var b=
new f(a.geometry);this.view.basemapTerrain&&(b.z=this.view.basemapTerrain.getElevation(a.geometry)+1);var c=this.view.toScreen(b);if(0<=c.x&&0<=c.y&&c.x<=this.view.width&&c.y<=this.view.height&&0<c.z){var d=this.view.toMap(c);d&&(d=this.view.toScreen(d),c.z-d.z<1E-5*Math.abs(d.z)&&(this.view.popup.setFeatures([a]),this.view.popup.show(b)))}}}else this.view.popup.hide()},addSceneServiceLogEventListeners:function(a){m(a,"layer-add",function(a){a.layer instanceof l&&this.addSceneServiceLogEventListener(a.layer)}.bind(this));
m(a,"layer-remove",function(a){a.layer instanceof l&&this.removeSceneServiceLogEventListener(a.layer)}.bind(this))},addSceneServiceLogEventListener:function(a){this._onHandles.hasOwnProperty(a.id)||(this._onHandles[a.id]=a.on("i3s-load-log",this.handleI3sLogEvent))},removeSceneServiceLogEventListener:function(a){this._onHandles.hasOwnProperty(a.id)&&(this._onHandles[a.id].remove(),delete this._onHandles[a.id])},handleI3sLogEvent:function(a){var b={message:y.menu.errorSceneServiceLoad+": "+a.msg,type:R.MessageTypes.ERROR};
a.target&&a.target.title&&(b.details=y.menu.errorLayerName+" "+a.target.title);R.show(b)},handleBasemapTerrainErrorEvent:function(a){R.show({message:a.message,type:R.MessageTypes.WARNING})},newSceneSaved:function(a){this.shareDialog&&this.shareDialog.setWebScene(a);this.updateSceneSRLockState()},setUnsavedSceneChanges:function(a){this.shareDialog&&this.shareDialog.setUnsavedSceneChanges(a)},setSceneSRLockedChanges:function(a){},_mapContainsLayers:function(){return!!this.map.layers.some(function(a){return"__basemapErrorFallbackLayer__"!==
a.id&&"SilentContentLayer"!==a.id})},updateSceneSRLockState:function(a){a=a?a.webscene&&-1!==a.webscene.indexOf("http://")?!0:!1:!1;if((0<this.webscene.presentation.slides.length||this._mapContainsLayers()||this.webscene.portalItemProperties&&this.webscene.portalItemProperties.id||a)&&!this.sceneSRLocked){this.sceneSRLocked=!0;this.basemapGallery&&this.basemapGallery.updateSceneSRLocked(this.sceneSRLocked);console.log("scene spatial reference is locked.");I.spatialReferenceLocked=!0;L.spatialReferenceLocked=
!0;for(a=0;a<this.map.layers.length;a++){var b=this.map.layers.getItemAt(a);b instanceof w&&U.projectLayerExtentToSceneSR(b,this.sceneSRLocked)}}}})});