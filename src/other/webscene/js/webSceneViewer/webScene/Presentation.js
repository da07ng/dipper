// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("esri/core/declare esri/core/lang esri/Viewpoint esri/core/Collection esri/views/3d/lib/glMatrix webSceneViewer/basemapUtils webSceneViewer/environmentUtils webSceneViewer/mapUtils webSceneViewer/assertUtils".split(" "),function(p,n,v,w,x,y,l,z,A){var B=A.assert,s=x.vec3d,g=p(null,{declaredClass:"webScene.Presentation",slides:void 0,constructor:function(){this.slides=new w},toJSON:function(){for(var a={slides:[]},b=this.slides.getAll(),d=0;d<b.length;d++)a.slides[d]=g.slideToJson(b[d]);return n.fixJson(a)},
addSlide:function(a){this.slides.addItem(a)},removeSlide:function(a){return"number"===typeof a?(B(a<this.slides.get("length")),this.slides.removeItemAt(a)):"object"===typeof a?this.slides.removeItem(a):null},removeSlideById:function(a){for(var b=0;b<this.slides.items.length;b++)if(this.slides.items[b].id===a)return this.removeSlide(b);return null},getNewSlideId:function(){for(var a=1,b="slide_"+a.toString(),d=[],c=0;c<this.slides.items.length;c++)d[this.slides.items[c].id]=1;for(;d[b];)a++,b="slide_"+
a.toString();return b},updateUniqueSlideIds:function(a){if(0!==a.length){for(var b=[],d=[],c=0;c<a.items.length;c++)d[a.items[c].id]=1;for(a=0;a<this.slides.length;a++){var c=this.slides.items[a],e=c.id,f=e.match(/(slide_)(\d+)$/),h;f?(h=f[1],f=parseInt(f[2],10)):(h=e+"_",f=0);for(;d[e]||b[e];)f++,e=h+f.toString();b[e]=1;e!==c.id&&(c.id=e)}}},updateSlideDetails:function(a,b){var d=this.slides.getItemAt(a);b.title={text:d.title.text};b.description.text=d.description.text;b.id=d.id;this.slides.removeItemAt(a);
this.slides.addItem(b,a)},moveSlide:function(a,b){var d;this.slides.getAll().forEach(function(b,e){b.id===a&&(d=b)});d&&this.slides.moveItem(d,b)}}),k=null;g.applySlideToView=function(a,b){var d=v.fromJSON(a.viewpoint).camera;d.fov=b.get("camera").fov;if(a.environment&&a.environment.lighting&&null!=a.environment.lighting.date){var c=new Date(b.environment.lighting.date),e=c.getTime(),f=60*(60*c.getUTCHours()+c.getUTCMinutes())+c.getUTCSeconds(),h=a.environment.lighting.date,g=h.getTime(),n=60*(60*
h.getUTCHours()+h.getUTCMinutes())+h.getUTCSeconds(),m=new Date,q=b.renderCoordsHelper,t=[0,0,0];q.toRenderCoords(b.camera.position,t);var u=[0,0,0];q.toRenderCoords(d.position,u);var r=[0,0,0],p=b.watch("camera",function(a){q.toRenderCoords(a.position,r);var c=s.dist2(t,r),d=s.dist2(u,r);a=0;0!==c+d&&(a=c/(c+d));c=f+(n-f)*a;m.setTime(e+(g-e)*a);m.setUTCHours(c/3600);m.setUTCMinutes(c%3600/60);m.setUTCSeconds(c%3600%60);b.environment.lighting.date=m});k&&(k.stop(),k=null);b.environmentManager.autoAdjustTimezone=
!1;b.environment.lighting=l.clone(a.environment).lighting;b.environment.lighting.date=c;k=b.animateTo(d);k.then(function(c){p.remove();"finished"===c.state&&(b.environment.lighting=l.clone(a.environment).lighting);k===c&&(b.environmentManager.autoAdjustTimezone=!0)})}else l.applyToView(a.environment,b),b.animateTo(d);if(a.visibleLayers){d=[];for(c=0;c<a.visibleLayers.length;c++)d.push(a.visibleLayers[c].id);z.setVisibleLayerList(b.map,d)}a.baseMap&&y.setFromJSON(b,a.baseMap,!0)};g.fromJSON=function(a){var b=
new g;if(a&&a.slides&&a.slides.length)for(var d=0;d<a.slides.length;d++){var c=a.slides[d];c.environment&&(c.environment=l.fromJSON(c.environment));c.baseMap&&c.baseMap.elevationLayers&&delete c.baseMap.elevationLayers;c.visibleLayers||(c.visibleLayers=[]);b.addSlide(c)}return b};g.slideToJson=function(a){var b={id:a.id,title:a.title,thumbnail:a.thumbnail,description:a.description,baseMap:a.baseMap,viewpoint:a.viewpoint,visibleLayers:a.visibleLayers};a.environment&&(b.environment=l.toJSON(a.environment));
return n.fixJson(b)};return g});