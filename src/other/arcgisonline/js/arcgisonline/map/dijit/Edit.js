// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/map/dijit/Edit",["dijit","dojo","dojox","dojo/require!dijit/_Widget,dijit/_Templated,esri/styles/basic"],function(h,a,u){a.provide("arcgisonline.map.dijit.Edit");a.require("dijit._Widget");a.require("dijit._Templated");a.require("esri.styles.basic");a.declare("arcgisonline.map.dijit.Edit",[h._Widget,h._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv dojoType\x3d"dijit.layout.BorderContainer" region\x3d"top" style\x3d"height:100%;"\x3e  \r\n    \x3cdiv id\x3d"edit-main" class\x3d"panel panel_left" dojoType\x3d"dijit.layout.ContentPane" region\x3d"top"\x3e\r\n      \x3cdiv id\x3d"edit-header" dojotype\x3d"dijit.layout.ContentPane" region\x3d"top" style\x3d"padding:5px 0 1px 5px;"\x3e\r\n      \x3cdiv class\x3d"esriFloatTrailing" style\x3d"display:inline;"\x3e\r\n        \x3ca href\x3d"JavaScript:void(0);" dojoAttachPoint\x3d"_closeBtn" title\x3d"${i18n.close}" class\x3d"panel panel_close panel_collapse"\x3e\x3c/a\x3e\r\n      \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriFloatLeading panel_title edit_panel_title"\x3e${i18n.editPanelTitle}\x3c/div\x3e\r\n        \x3cdiv style\x3d"clear:both;height:1px;"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv dojotype\x3d"dijit.layout.ContentPane" id\x3d"templatePickerPane" region\x3d"right" style\x3d"clear:both; margin:3px;"\x3e\r\n          \x3cdiv id\x3d"templatePickerDiv"\x3e\x3c/div\x3e\r\n          \x3cdiv id\x3d"editorDiv"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"buttonsDiv" style\x3d"padding-bottom:4px;"\x3e\r\n        \x3ccenter\x3e \r\n          \x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" class\x3d"calcite light tiny" dojoAttachPoint\x3d"undoButton" iconclass\x3d"undoIcon" dojoAttachEvent\x3d"onClick:_undo"\x3e\x3cspan\x3e${i18n.undo}\x3c/span\x3e\x3c/button\x3e\r\n          \x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" class\x3d"calcite light tiny" dojoAttachPoint\x3d"redoButton" iconclass\x3d"redoIcon" dojoAttachEvent\x3d"onClick:_redo"\x3e\x3cspan\x3e${i18n.redo}\x3c/span\x3e\x3c/button\x3e\r\n          \x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" class\x3d"calcite light tiny" dojoAttachPoint\x3d"manageButton" dojoAttachEvent\x3d"onClick:_manage" style\x3d"display:none;"\x3e\x3cspan\x3e${i18n.manage}\x3c/span\x3e\x3c/button\x3e\r\n        \x3c/center\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e \r\n   \r\n    \x3cdiv id\x3d"editContentFooter" dojoType\x3d"dijit.layout.ContentPane" region\x3d"bottom" style\x3d"height:40px; padding: 0 5px 0 5px; display:none;"\x3e \r\n      \x3cdiv class\x3d"footer" id\x3d"editFooter" dojotype\x3d"arcgisonline.sharing.dijit.SiteFooterMap" style\x3d"white-space:normal;"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n\x3c/div\x3e\r\n',
i18n:null,container:null,editorWidget:null,templatePicker:null,undoManager:null,onEditsCompleteHandlers:[],onLayerSelectionChangeHandler:null,onLayerEditsCompleteHandler:null,onNextFeatureHandler:null,onPreviousFeatureHandler:null,onFirstFeatureHandler:null,onLastFeatureHandler:null,openSymbolDialogHandler:null,onSymbolChangeHandler:null,onSymbolCancelHandler:null,onAttributeChangeHandler:null,onActivateHandler:null,onDeactivateHandler:null,onTextEditStartHandler:null,onLinkDlgButtonHandler:null,
changeSymbolButton:null,closeButton:null,editorLoaded:!1,recreateEditorOngoing:!1,timeFormats:"shortDateShortTime shortDateLEShortTime shortDateShortTime24 shortDateLEShortTime24 shortDateLongTime shortDateLELongTime shortDateLongTime24 shortDateLELongTime24".split(" "),constructor:function(a,d){null!=a&&a.containerNode&&(this.container=a.containerNode)},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.i18n.getLocalization("arcgisonline","arcgisonline").common;a.mixin(this.i18n,
a.i18n.getLocalization("arcgisonline","arcgisonline").editPanel)},postCreate:function(){this.container.addChild(h.byId("editPanel"));this.loadConnections()},loadEditor:function(b){isEmbedded||a.style(a.byId("editContentFooter"),"display","");if(this.editorLoaded)this.recreateEditorOngoing=!1;else{arcgisonline.map.table.hideAttributeTable();this.editorLoaded=!0;for(var d=arcgisonline.sharing.util.getUser(),e=[],g=[],r=!0,m=0,q=arcgisonline.map.main.mapLayers.length-1;0<=q;q--){var f=arcgisonline.map.main.mapLayers[q];
if(arcgisonline.map.role.isAllowed("tool_edit"))if(arcgisonline.map.featColl.isFeatureCollection(f)){if(arcgisonline.map.role.isAllowed("tool_edit_featCol")){var h=!1;if(f.layer&&f.layer.isEditable()){c=f.layer;if(c.visible){k=c.toJson();s=k.layerDefinition.types&&0<k.layerDefinition.types.length;k=k.layerDefinition.templates&&0<k.layerDefinition.templates.length;n=!1;if("esri.renderer.SimpleRenderer"==c.renderer.declaredClass)n=!0;else if(("esri.renderer.UniqueValueRenderer"==c.renderer.declaredClass||
"esri.renderer.ClassBreaksRenderer"==c.renderer.declaredClass)&&c.renderer.infos&&0<c.renderer.infos.length)n=!0;if((s||k)&&n)"esri.renderer.ClassBreaksRenderer"==c.renderer.declaredClass&&!c.renderer.defaultSymbol&&("esriGeometryPoint"==c.geometryType?c.renderer.defaultSymbol=new esri.symbol.SimpleMarkerSymbol:"esriGeometryPolyline"==c.geometryType?c.renderer.defaultSymbol=new esri.symbol.SimpleLineSymbol:"esriGeometryPolygon"==c.geometryType&&(c.renderer.defaultSymbol=new esri.symbol.SimpleFillSymbol)),
(l=f.fieldInfos)||f.popupInfo&&a.forEach(f.popupInfo.fieldInfos,function(b){if(!1!==b.visible||b.isEditable){l||(l=[]);var c={fieldName:b.fieldName,label:b.label,isEditable:b.isEditable,tooltip:b.tooltip,visible:!0,stringFieldOption:b.stringFieldOption};b.format&&(b.format.dateFormat&&-1<a.indexOf(this.timeFormats,b.format.dateFormat))&&(c.format={time:!0});l.push(c)}},this),h=!0,e.push(c),c.layerId||(c.layerId=c.id),g.push({featureLayer:c,showDeleteButton:!0,isEditable:!0,fieldInfos:l})}h&&m++}else if(!f.layer)for(p=
f.layers.length-1;0<=p;p--){c=f.layers[p];if(!c.isEditable())break;if(c.visible){k=c.toJson();s=k.layerDefinition.types&&0<k.layerDefinition.types.length;k=k.layerDefinition.templates&&0<k.layerDefinition.templates.length;n=!1;if("esri.renderer.SimpleRenderer"==c.renderer.declaredClass)n=!0;else if(("esri.renderer.UniqueValueRenderer"==c.renderer.declaredClass||"esri.renderer.ClassBreaksRenderer"==c.renderer.declaredClass)&&c.renderer.infos&&0<c.renderer.infos.length)n=!0;if((s||k)&&n)"esri.renderer.ClassBreaksRenderer"==
c.renderer.declaredClass&&!c.renderer.defaultSymbol&&("esriGeometryPoint"==c.geometryType?c.renderer.defaultSymbol=new esri.symbol.SimpleMarkerSymbol:"esriGeometryPolyline"==c.geometryType?c.renderer.defaultSymbol=new esri.symbol.SimpleLineSymbol:"esriGeometryPolygon"==c.geometryType&&(c.renderer.defaultSymbol=new esri.symbol.SimpleFillSymbol)),(l=f.fieldInfos)||c.__popupInfo&&a.forEach(c.__popupInfo.fieldInfos,function(b){if(!1!==b.visible||b.isEditable)l||(l=[]),b.format&&b.format.dateFormat&&a.indexOf(this.timeFormats,
b.format.dateFormat),l.push(b)},this),h=!0,e.push(c),c.layerId||(c.layerId=c.id),"mapNotes"===f.type&&(c.__templatePickerGroupTitle=f.title+" - "+c.name),g.push({featureLayer:c,showDeleteButton:!0,isEditable:!0,fieldInfos:l})}h&&m++}}}else{if(f.layer&&(f.layer.visible&&f.layer instanceof esri.layers.FeatureLayer&&f.layer.isEditable())&&(!f.itemCard||!d||!esriGeowConfig.userRole||esriGeowConfig.userRole.canEditFeatures()||!("update"!==f.itemCard.itemControl&&"admin"!==f.itemCard.itemControl))){f.layer.capabilities&&
-1<f.layer.capabilities.indexOf("Create")&&arcgisonline.map.edit.checkTypesAndTemplatesOnLayer(f.layer);e.push(f.layer);var t=null;f.popupInfo&&a.forEach(f.popupInfo.fieldInfos,function(b){if(!1!==b.visible||b.isEditable){t||(t=[]);var c={fieldName:b.fieldName,label:b.label,isEditable:b.isEditable,tooltip:b.tooltip,visible:!0,stringFieldOption:b.stringFieldOption};b.format&&(b.format.dateFormat&&-1<a.indexOf(this.timeFormats,b.format.dateFormat))&&(c.format={time:!0});t.push(c)}},this);p={featureLayer:f.layer,
showDeleteButton:!0,showAttachments:!0,isEditable:!0,fieldInfos:t};if((d=arcgisonline.sharing.util.getUser())&&arcgisonline.sharing.util.isHostedService(f.layer.url)&&f.layer.ownershipBasedAccessControlForFeatures)p.userId=d.email;g.push(p);r=!1}}else if("mapNotes"===f.type)for(var p=f.layers.length-1;0<=p;p--){var c=f.layers[p];if(c.visible){var k=c.toJson(),s=k.layerDefinition.types&&0<k.layerDefinition.types.length,k=k.layerDefinition.templates&&0<k.layerDefinition.templates.length,n=!1;if("esri.renderer.SimpleRenderer"==
c.renderer.declaredClass)n=!0;else if(("esri.renderer.UniqueValueRenderer"==c.renderer.declaredClass||"esri.renderer.ClassBreaksRenderer"==c.renderer.declaredClass)&&c.renderer.infos&&0<c.renderer.infos.length)n=!0;if((s||k)&&n){"esri.renderer.ClassBreaksRenderer"==c.renderer.declaredClass&&!c.renderer.defaultSymbol&&("esriGeometryPoint"==c.geometryType?c.renderer.defaultSymbol=new esri.symbol.SimpleMarkerSymbol:"esriGeometryPolyline"==c.geometryType?c.renderer.defaultSymbol=new esri.symbol.SimpleLineSymbol:
"esriGeometryPolygon"==c.geometryType&&(c.renderer.defaultSymbol=new esri.symbol.SimpleFillSymbol));var l=f.fieldInfos;l||c.__popupInfo&&a.forEach(c.__popupInfo.fieldInfos,function(a){if(!1!==a.visible||a.isEditable)l||(l=[]),l.push(a)},this);h=!0;e.push(c);c.layerId||(c.layerId=c.id);c.__templatePickerGroupTitle=f.title+" - "+c.name;g.push({featureLayer:c,showDeleteButton:!0,isEditable:!0,fieldInfos:l})}}h&&m++}}1<m&&(r=!1);0==e.length?this.recreateEditorOngoing=!1:setTimeout(a.hitch(this,function(){var c=
this.adjustHeight(),d=a.filter(e,function(a){return a.getEditCapabilities().canCreate});this.templatePicker=new esri.dijit.editing.TemplatePicker({featureLayers:d,grouping:r?!1:!0,rows:"auto",columns:"auto",style:"width:"+c.width+"px; height:"+c.height+"px",showTooltip:!1,groupLabelFunction:function(a){return a.__templatePickerGroupTitle?a.__templatePickerGroupTitle:a.name}},"templatePickerDiv");this.templatePicker.startup();this.undoManager=new esri.UndoManager({maxOperations:20});a.connect(this.undoManager,
"onChange",a.hitch(this,"onEditsComplete"));c={map:arcgisonline.map.main.map,templatePicker:this.templatePicker,undoManager:this.undoManager,geometryService:new esri.tasks.GeometryService(esriGeowConfig.self.helperServices.geometry.url),layerInfos:g,attributeInspector:null,singleSelectionTolerance:7,drawToolbar:new esri.toolbars.Draw(arcgisonline.map.main.map,{drawTime:25,tolerance:12})};arcgisonline.map.main.map.infoWindow.clearFeatures();this.editorWidget=new esri.dijit.editing.Editor({settings:c},
"editorDiv");this.editorWidget.startup();arcgisonline.map.main.map.enableSnapping();a.forEach(e,function(b){this.onEditsCompleteHandlers.push(a.connect(b,"onEditsComplete",a.hitch(this,"onEditsComplete")))},this);arcgisonline.map.main.map.infoWindow.resize(500,250);this.onLayerSelectionChangeHandler=a.connect(this.editorWidget.attributeInspector,"onLayerSelectionChange",this,"onFeatureChange");this.onLayerEditsCompleteHandler=a.connect(this.editorWidget.attributeInspector,"onLayerEditsComplete",this,
"onLayerEditsComplete");this.onNextFeatureHandler=a.connect(this.editorWidget.attributeInspector,"onNextFeature",this,"onFeatureChange");this.onPreviousFeatureHandler=a.connect(this.editorWidget.attributeInspector,"onPreviousFeature",this,"onFeatureChange");this.onFirstFeatureHandler=a.connect(this.editorWidget.attributeInspector,"onFirstFeature",this,"onFeatureChange");this.onLastFeatureHandler=a.connect(this.editorWidget.attributeInspector,"onLastFeature",this,"onFeatureChange");this.onAttributeChangeHandler=
a.connect(this.editorWidget.attributeInspector,"onAttributeChange",this,"onAttributeChange");this.onActivateHandler=a.connect(this.editorWidget.editToolbar,"onActivate",this,"hideTemplatePicker");this.onDeactivateHandler=a.connect(this.editorWidget.editToolbar,"onDeactivate",this,"showTemplatePicker");this.onTextEditStartHandler=a.connect(this.editorWidget.editToolbar,"onTextEditStart",this,"showTemplatePicker");this.onEditsComplete();b&&(b.feature&&b.mapPoint)&&(c=b.feature.getLayer(),d=new esri.tasks.Query,
d.objectIds=[b.feature.attributes[c.objectIdField]],this.editorWidget._selectFeatures([c],d,a.hitch(this,function(a){a&&a.length&&this.editorWidget._onEditFeature(a,b.mapPoint)})));this.recreateEditorOngoing=!1}),0)}},recreateAttributeInspector:function(){a.disconnect(this.onLayerSelectionChangeHandler);a.disconnect(this.onLayerEditsCompleteHandler);a.disconnect(this.onNextFeatureHandler);a.disconnect(this.onPreviousFeatureHandler);a.disconnect(this.onFirstFeatureHandler);a.disconnect(this.onLastFeatureHandler);
a.disconnect(this.onAttributeChangeHandler);this.changeSymbolButton&&(this.changeSymbolButton.destroy(),this.changeSymbolButton=null);this.closeButton&&(this.closeButton.destroy(),this.closeButton=null);arcgisonline.map.main.map.infoWindow.clearFeatures();this.editorWidget._createAttributeInspector();arcgisonline.map.main.map.infoWindow.resize(500,250);this.onLayerSelectionChangeHandler=a.connect(this.editorWidget.attributeInspector,"onLayerSelectionChange",this,"onFeatureChange");this.onLayerEditsCompleteHandler=
a.connect(this.editorWidget.attributeInspector,"onLayerEditsComplete",this,"onLayerEditsComplete");this.onNextFeatureHandler=a.connect(this.editorWidget.attributeInspector,"onNextFeature",this,"onFeatureChange");this.onPreviousFeatureHandler=a.connect(this.editorWidget.attributeInspector,"onPreviousFeature",this,"onFeatureChange");this.onFirstFeatureHandler=a.connect(this.editorWidget.attributeInspector,"onFirstFeature",this,"onFeatureChange");this.onLastFeatureHandler=a.connect(this.editorWidget.attributeInspector,
"onLastFeature",this,"onFeatureChange");this.onAttributeChangeHandler=a.connect(this.editorWidget.attributeInspector,"onAttributeChange",this,"onAttributeChange")},updateEditor:function(b){if(b&&b.feature&&b.mapPoint){var d=b.feature.getLayer(),e=new esri.tasks.Query;e.objectIds=[b.feature.attributes[d.objectIdField]];this.editorWidget._selectFeatures([d],e,a.hitch(this,function(a){a&&a.length&&this.editorWidget._onEditFeature(a,b.mapPoint)}))}},destroyEditor:function(){this.editorLoaded&&(this.editorWidget&&
(this.editorWidget.stopEditing(),arcgisonline.map.main.map.disableSnapping(),a.disconnect(this.onLayerSelectionChangeHandler),a.disconnect(this.onLayerEditsCompleteHandler),a.disconnect(this.onNextFeatureHandler),a.disconnect(this.onPreviousFeatureHandler),a.disconnect(this.onFirstFeatureHandler),a.disconnect(this.onLastFeatureHandler),a.disconnect(this.onAttributeChangeHandler),a.disconnect(this.onActivateHandler),a.disconnect(this.onDeactivateHandler),a.disconnect(this.onTextEditStartHandler),a.forEach(this.onEditsCompleteHandlers,
function(b){a.disconnect(b)}),this.onEditsCompleteHandlers=[],this.onLinkDlgButtonHandler&&a.disconnect(this.onLinkDlgButtonHandler),this.undoManager.destroy(),this.editorWidget.destroy(),this.templatePicker=this.editorWidget=null,this.changeSymbolButton&&(this.changeSymbolButton.destroy(),this.changeSymbolButton=null)),a.byId("templatePickerDiv")||a.create("div",{id:"templatePickerDiv"},a.byId("templatePickerPane")),a.byId("editorDiv")||a.create("div",{id:"editorDiv"},a.byId("templatePickerPane")),
this.closeButton=null,this.editorLoaded=!1)},recreateEditor:function(){this.recreateEditorOngoing||(this.recreateEditorOngoing=!0,this.destroyEditor(),this.loadEditor())},getChildren:function(){return this.containerNode?this.myDijitFindWidgets(this.containerNode):[]},onSelectionChange:function(){this.onSymbolChangeHandler&&a.unsubscribe(this.onSymbolChangeHandler);this.onSymbolCancelHandler&&a.unsubscribe(this.onSymbolCancelHandler);this.onLinkDlgButtonHandler&&a.disconnect(this.onLinkDlgButtonHandler);
var b=this.editorWidget.attributeInspector._selection;if(b&&0<b.length){a.addClass(this.editorWidget.attributeInspector.deleteBtn.domNode,"calcite");var d=b[this.editorWidget.attributeInspector._featureIdx];if(d){b=!1;if(!d.getLayer().url){var e=d.getLayer().toJson();e.layerDefinition&&e.layerDefinition.drawingInfo&&!e.layerDefinition.drawingInfo.fixedSymbols&&arcgisonline.map.mapNotes.isMapNotesFeatColl(e)&&!arcgisonline.map.main.isTextLayer(d.getLayer())&&(b=!0)}if(b){this.changeSymbolButton||(this.changeSymbolButton=
new h.form.Button({label:this.i18n.changeSymbolBtn,"class":"atiSymbolButton",type:"button"}),a.place(this.changeSymbolButton.domNode,this.editorWidget.attributeInspector.deleteBtn.domNode,"after"),a.addClass(this.changeSymbolButton.domNode,"calcite"));this.openSymbolDialogHandler&&a.disconnect(this.openSymbolDialogHandler);this.openSymbolDialogHandler=a.connect(this.changeSymbolButton,"onClick",a.hitch(this,"openSymbolDlg",d));a.style(this.changeSymbolButton.domNode,"display","block");var g=a.query(".atiRichTextField",
this.editorWidget.attributeInspector.domNode);0<g.length&&(b=a.query(".dijitEditorIconCreateLink",this.editorWidget.attributeInspector.domNode),0<b.length&&(b[0].parentNode&&b[0].parentNode.parentNode&&b[0].parentNode.parentNode.parentNode)&&(b=h.byNode(b[0].parentNode.parentNode.parentNode),this.onLinkDlgButtonHandler=a.connect(b,"onClick",function(){var b=h.byId(g[0].id+"_0_targetSelect");b&&(b.domNode&&b.domNode.parentNode&&b.domNode.parentNode.parentNode)&&a.style(b.domNode.parentNode.parentNode,
"display","none")})));b=arcgisonline.map.main.getParameterList(d.getLayer());a.forEach(b.layers,function(b){b.id===d.getLayer().id&&a.forEach(this.editorWidget.attributeInspector._currentLInfo.fieldInfos,function(a){var b=a.field;if(b&&("IMAGE_URL"===b.name||"IMAGE_LINK_URL"===b.name)){if(b=d.attributes[b.name],!b||0==b.length)a.dijit.set("value","http://",!1),esriGeowConfig.isRightToLeft&&(a.dijit.domNode.dir="ltr")}else b&&"TITLE"===b.name&&(b=d.attributes[b.name])&&0<b.length&&a.dijit.set("value",
u.html.entities.decode(b),!1)},this)},this)}else this.changeSymbolButton&&a.style(this.changeSymbolButton.domNode,"display","none");this.closeButton||(this.closeButton=new h.form.Button({label:this.i18n.close,"class":"atiSymbolButton esriFloatTrailing calcite blue",style:"padding-right:3px;",type:"button"}),a.place(this.closeButton.domNode,this.editorWidget.attributeInspector.editButtons,"last"),a.connect(this.closeButton,"onClick",a.hitch(this,function(){this.editorWidget._hideAttributeInspector()})))}}},
onLayerEditsComplete:function(b,d,e,g){if(d)this.onSelectionChange();arcgisonline.map.main.markMapAsChanged("onLayerEditsComplete");if((b=arcgisonline.map.main.getParameterList(b.featureLayer))&&arcgisonline.map.featColl.isFeatureCollection(b)&&b.itemId)b.dataChanged=!0;arcgisonline.map.table.refreshTable(b,null,"edit");if(arcgisonline.sharing.util.getUser()&&arcgisonline.map.role.isAllowed("toc_menu_analysis")&&(arcgisonline.map.featColl.isFeatureCollection(b)||"esri.layers.FeatureLayer"==b.layer.declaredClass))if(b.layer)(d&&
d.length&&1===b.layer.graphics.length||g&&g.length&&0===b.layer.graphics.length)&&arcgisonline.map.dijit.toc.options.updateToolOptions(b);else{var h=0;a.forEach(b.layers,function(a){h+=a.graphics.length});(d&&d.length&&1===h||g&&g.length&&0===h)&&arcgisonline.map.dijit.toc.options.updateToolOptions(b)}},onFeatureChange:function(a){this.onSelectionChange()},onAttributeChange:function(a,d,e){var g=arcgisonline.map.main.getParameterList(a.getLayer());if("DESCRIPTION"===d)g&&"mapNotes"===g.type&&(a.attributes.DESCRIPTION=
e.replace(/\"/g,"'"),a.attributes.DESCRIPTION=a.attributes.DESCRIPTION.replace(/target='_self'/g,"target\x3d'_blank'"));else if(("IMAGE_URL"===d||"IMAGE_LINK_URL"===d)&&g&&"mapNotes"===g.type)e=e.replace(/^\s+|\s+$/g,""),"http://"===e?"IMAGE_URL"===d?a.attributes.IMAGE_URL="":a.attributes.IMAGE_LINK_URL="":0<e.length&&(-1==e.indexOf("http://")&&-1==e.indexOf("https://"))&&("IMAGE_URL"===d?a.attributes.IMAGE_URL="http://"+e:a.attributes.IMAGE_LINK_URL="http://"+e),this.updateMapNotesUrlFields(a);g&&
(arcgisonline.map.featColl.isFeatureCollection(g)&&g.itemId)&&(g.dataChanged=!0)},showTemplatePicker:function(b,d){a.style(a.byId("templatePickerDiv"),"display","");a.query(".edit_panel_title")[0].innerHTML=this.i18n.editPanelTitle;this.templatePicker.update(!0)},hideTemplatePicker:function(b,d){d&&(d.symbol&&d.symbol.text&&0<d.symbol.text.length&&arcgisonline.map.main.isTextLayer(d.getLayer()))&&(a.style(a.byId("templatePickerDiv"),"display","none"),a.query(".edit_panel_title")[0].innerHTML=this.i18n.changeSymbolBtn)},
updateMapNotesUrlFields:function(b){a.forEach(this.editorWidget.attributeInspector._currentLInfo.fieldInfos,function(a){if(a.field&&"IMAGE_LINK_URL"===a.field.name){var e=b.attributes.IMAGE_LINK_URL;!e||0==e.length?a.dijit.set("value","http://",!1):a.dijit.set("value",b.attributes.IMAGE_LINK_URL,!1)}else a.field&&"IMAGE_URL"===a.field.name&&(e=b.attributes.IMAGE_URL,!e||0==e.length?a.dijit.set("value","http://",!1):a.dijit.set("value",b.attributes.IMAGE_URL,!1))},this)},onEditsComplete:function(){this.undoButton.set("disabled",
!this.undoManager.canUndo);this.redoButton.set("disabled",!this.undoManager.canRedo)},openSymbolDlg:function(b,d){var e=esri.styles.basic.getSchemes({theme:"default",basemap:"topo",geometryType:b.getLayer().geometryType}),g=b.symbol||b.getLayer().renderer.getSymbol(b);this.showSymbolStyler(g,{schemes:e},a.hitch(this,"onSymbolChange",b))},onSymbolChange:function(a,d){if("editStack"===arcgisonline.map.leftPanel.getLeftContentPanelStack()){a.setSymbol(d);var e=a.getLayer();(!e.url||0===e.url.length)&&
arcgisonline.map.main.markMapAsChanged("onSymbolChange");if((e=arcgisonline.map.main.getParameterList(e))&&arcgisonline.map.featColl.isFeatureCollection(e)&&e.itemId)e.dataChanged=!0}},onSymbolCancel:function(b,d){"editStack"===arcgisonline.map.leftPanel.getLeftContentPanelStack()&&(this.onSymbolChangeHandler&&a.unsubscribe(this.onSymbolChangeHandler),this.onSymbolCancelHandler&&a.unsubscribe(this.onSymbolCancelHandler))},showSymbolStyler:function(b,d,e){this.symbolStylerDlg=(new h.Dialog({id:"symbolStylerDlg",
style:"width:320px; visibility: hidden;"})).placeAt(document.body);this.symbolStylerDlgContent=new arcgisonline.map.dijit.renderer.SymbolStylerDlg({id:"symbolStylerDlgContent"});this.symbolStylerDlg.set({title:"",content:this.symbolStylerDlgContent});this.symbolStylerDlgHideHandler=a.connect(this.symbolStylerDlg,"onHide",a.hitch(this,function(){this.destroySymbolStylerDlg()}));this.symbolStylerDlgOkHandler=a.subscribe("symbolStylerOk",a.hitch(this,function(a,b){this.activeTab=b;this.symbolStylerDlg.hide();
e(a.symbol,a.colors,a.scheme,a.optimizeOutline)}));this.symbolStylerDlgCancelHandler=a.subscribe("symbolStylerCancel",a.hitch(this,function(a){this.symbolStylerDlg.hide()}));this.symbolStylerDlg.show().then(a.hitch(this,function(){a.style(this.symbolStylerDlg.domNode,"top","95px");esriGeowConfig.isRightToLeft?a.style(this.symbolStylerDlg.domNode,"right",arcgisonline.map.leftPanel.leftPanelWidth+18+"px"):a.style(this.symbolStylerDlg.domNode,"left",arcgisonline.map.leftPanel.leftPanelWidth+18+"px");
a.style(this.symbolStylerDlg.domNode,"visibility","visible");d.activeTab=this.activeTab;this.symbolStylerDlgContent.show(b,d)}))},destroySymbolStylerDlg:function(){this.symbolStylerDlgOkHandler&&a.unsubscribe(this.symbolStylerDlgOkHandler);this.symbolStylerDlgOkHandler=null;this.symbolStylerDlgCancelHandler&&a.unsubscribe(this.symbolStylerDlgCancelHandler);this.symbolStylerDlgCancelHandler=null;this.symbolStylerDlgHideHandler&&a.disconnect(this.symbolStylerDlgHideHandler);this.symbolStylerDlgHideHandler=
null;this.symbolStylerDlgContent&&this.symbolStylerDlgContent.destroy();this.symbolStylerDlgContent=null;this.symbolStylerDlg&&this.symbolStylerDlg.destroy();this.symbolStylerDlg=null;h.registry.byId("symbolStylerDlg")&&h.registry.byId("symbolStylerDlg").destroy()},myDijitFindWidgets:function(b){function d(b){if(9>a.isIE&&b.children||b.childNodes){b=9>a.isIE?b.children:b.childNodes;for(var r=0,m;m=b[r++];)if(1==m.nodeType){var q=m.getAttribute("widgetId");q?(m=h.byId(q),e.push(m)):d(m)}}}var e=[];
d(b);return e},loadConnections:function(){if(arcgisonline.sharing.util.getUser())for(var b=0;b<arcgisonline.map.main.mapLayers.length;b++)arcgisonline.map.mapUtil.checkHostedFSAccess(arcgisonline.map.main.mapLayers[b],a.hitch(this,function(b){b.layer.getEditCapabilities().canCreate&&a.style(this.manageButton.domNode,"display",10>a.isIE?"inline":"")}));a.connect(h.byId("leftContentPanel"),"resize",this,"adjustHeight");a.connect(this._closeBtn,"onclick",this,"onClose")},onClose:function(a){a.preventDefault();
arcgisonline.map.leftPanel.hideLeftContentPanel()},_undo:function(){this.undoManager.undo()},_redo:function(){this.undoManager.redo()},_manage:function(){leftPanel.showStack("manageTemplatesStack")},adjustHeight:function(b){if("undefined"==typeof leftPanel||"editStack"!=leftPanel.visibleStack)return{width:100,height:100};b=a.coords(a.byId("leftContentStackContainer")).h;var d=a.coords(a.byId("edit-header")).h,e=a.coords(a.byId("editFooter_links")).h+10,g=e+a.coords(a.byId("buttonsDiv")).h;a.style(a.byId("editContentFooter"),
"height",e+"px");b=b-d-g-5;0<b&&a.style(a.byId("templatePickerPane"),"height",b+"px");d=a.coords(a.byId("leftContentStackContainer")).w-6;0<d&&a.style(a.byId("templatePickerPane"),"width",d+"px");null!=this.templatePicker&&0<b&&(this.templatePicker.set("style","width:"+(d-2)+"px; height:"+(b-2)+"px"),this.templatePicker.featureLayers&&this.templatePicker.featureLayers.length&&this.templatePicker.update(!0));return{width:d-2,height:b-2}}})});