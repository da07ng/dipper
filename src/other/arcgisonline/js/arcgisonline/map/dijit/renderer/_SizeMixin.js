// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/map/dijit/renderer/_SizeMixin","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/dom dojo/Deferred dojo/dom-construct dojo/dom-style esri/lang esri/symbols/jsonUtils esri/renderers/smartMapping esri/plugins/FeatureLayerStatistics esri/dijit/SizeInfoSlider esri/dijit/ClassedSizeSlider esri/renderers/SimpleRenderer esri/renderers/ClassBreaksRenderer esri/symbols/SimpleMarkerSymbol esri/layers/FeatureLayer arcgisonline/map/dijit/renderer/SizeGrid".split(" "),
function(v,d,w,m,r,n,s,x,y,z,q,A,p,t,B,C,D,E,u){return{buildSizeRenderer:function(a){var b=new n;setTimeout(function(){b.progress(b)},1);a=a||{};if(this.isFeatColl||this.isCSV||this.hasDynamic)this.buildSizeRendererGo(null,a,b);else if("esri.renderer.UniqueValueRenderer"===this.renderer.declaredClass)if(this.isOwnerOfHostedFS){var c=this.layer.getEditCapabilities();!this.layer.isEditable()||!c.canCreate&&(c.canUpdate||c.canDelete)||this.mapLayer.featureTemplatesChanged?this.buildSizeRendererGo(!0,
a,b):arcgisonline.map.edit.hasDefaultTypesAndTemplates(this.layer)?this.buildSizeRendererGo(!0,a,b):arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance().show({title:this.i18n.warning,message:this.i18n.featureTypesAndTemplatesWarning,choiceOneTitle:this.i18n.yesLabel,choiceOneHandler:d.hitch(this,function(){this.buildSizeRendererGo(!0,a,b)}),choiceTwoTitle:this.i18n.noLabel,choiceTwoHandler:d.hitch(this,function(){b.reject()})})}else this.buildSizeRendererGo(null,a,b);else this.buildSizeRendererGo(null,
a,b);return b},buildSizeRendererGo:function(a,b,c){arcgisonline.map.dynLayer.checkDynamicLayers(this.mapLayer);var e=null;this.renderer.visualVariables&&"size"===this.getRendererType(this.renderer)&&(e=this.getVisualVariablesExceptTypes([{type:"sizeInfo"},{type:"sizeInfo",target:"outline"}],this.renderer.visualVariables));var f=b.attributeItem||this.attributeItem;if(b.classified||this.hasDynamic){var g,h;b.classificationMethod||(g=b.minValue,h=b.maxValue);q.createClassedSizeRenderer({layer:this.fLayer||
this.layer,field:f.name,minValue:g,maxValue:h,basemap:this.getBasemapType(),showOthers:!0,numClasses:"standard-deviation"!==b.classificationMethod?b.numClasses:void 0,scheme:this.scheme,classificationMethod:b.classificationMethod||"equal-interval",standardDeviationInterval:b.standardDeviationInterval,normalizationType:b.normalizationType,normalizationField:b.normalizationField,optimizeOutline:esri.isDefined(b.optimizeOutline)?b.optimizeOutline:!0,optimizeForScale:!0}).then(d.hitch(this,function(f){if(!c.isRejected()){this.scheme=
f.scheme;a&&(arcgisonline.map.edit.removeTypesAndTemplatesOnLayer(this.mapLayer.layer),this.mapLayer.featureTemplatesChanged=!0);this.authoringInfo=this.authoringInfo||{};var d=null;this.authoringInfo.visualVariables&&(d=this.getVisualVariablesExceptTypes(["sizeInfo","colorInfo"],this.authoringInfo.visualVariables)||[]);this.authoringInfo={type:"classedSize"};b.classificationMethod&&(this.authoringInfo.classificationMethod=this.getClassificationMethodConstant(b.classificationMethod));"standard-deviation"===
b.classificationMethod&&(this.authoringInfo.standardDeviationInterval=b.standardDeviationInterval);d&&d.length&&(this.authoringInfo.visualVariables=d);e&&(f.renderer.visualVariables?f.renderer.setVisualVariables(f.renderer.visualVariables.concat(e)):f.renderer.setVisualVariables(e));f.renderer=this.updateRendererProperties(b,f.renderer);c.resolve({renderer:f.renderer,statistics:f.statistics})}}),d.hitch(this,function(a){c.isRejected()||(this.handleError(a,"createClassedSizeRenderer",!0),c.reject())}))}else q.createSizeRenderer({layer:this.layer,
field:f.name,basemap:this.getBasemapType(),scheme:this.scheme,normalizationType:b.normalizationType,normalizationField:b.normalizationField,optimizeForScale:b.optimizeForScale||"visible-scale-range",optimizeOutline:esri.isDefined(b.optimizeOutline)?b.optimizeOutline:!0,showOthers:!0}).then(d.hitch(this,function(f){if(!c.isRejected()){this.scheme=f.scheme;this.onCalculationsSource&&f.statistics&&this.onCalculationsSource(f.statistics.source);a&&(arcgisonline.map.edit.removeTypesAndTemplatesOnLayer(this.mapLayer.layer),
this.mapLayer.featureTemplatesChanged=!0);var d={type:"sizeInfo",minSliderValue:esri.isDefined(b.minValue)?b.minValue:f.statistics.min,maxSliderValue:esri.isDefined(b.maxValue)?b.maxValue:f.statistics.max};if(this.isMultiAttributesRenderer)this.authoringInfo=this.authoringInfo||{},this.authoringInfo.visualVariables=this.authoringInfo.visualVariables||[],this.replaceVisualVariable("sizeInfo",null,d,this.authoringInfo),visVar=this.getVisualVariableByType("sizeInfo",null,f.renderer.visualVariables)||
null,this.replaceVisualVariable("sizeInfo",null,visVar,this.renderer),f.renderer=this.renderer;else{var g=[];this.authoringInfo=this.authoringInfo||{};this.authoringInfo.visualVariables&&(g=this.getVisualVariablesExceptTypes(["sizeInfo","colorInfo"],this.authoringInfo.visualVariables)||[]);g.push(d);this.authoringInfo.visualVariables=g;e&&(f.renderer.visualVariables?f.renderer.setVisualVariables(f.renderer.visualVariables.concat(e)):f.renderer.setVisualVariables(e))}f.renderer=this.updateRendererProperties(b,
f.renderer);c.resolve({renderer:f.renderer,statistics:f.statistics})}}),d.hitch(this,function(a){c.isRejected()||(this.handleError(a,"createSizeRenderer",!0),c.reject())}))},buildSizeInfo:function(a,b){b=new n;q.createSizeRenderer({layer:this.layer,field:(a.attributeItem||this.attributeItem).name,basemap:this.getBasemapType(),scheme:a.scheme,normalizationType:a.normalizationType,normalizationField:a.normalizationField,statistics:a.statistics,optimizeForScale:a.optimizeForScale||"visible-scale-range"}).then(d.hitch(this,
function(c){if(!b.isRejected()){var d={visualVariables:[{type:"sizeInfo",minSliderValue:esri.isDefined(a.minValue)?a.minValue:c.statistics.min,maxSliderValue:esri.isDefined(a.maxValue)?a.maxValue:c.statistics.max}]};b.resolve({sizeInfo:this.getVisualVariableByType("sizeInfo",null,c.renderer.visualVariables),backgroundFillSymbol:c.renderer.backgroundFillSymbol,statistics:c.statistics,authoringInfo:d,scheme:c.scheme})}}),d.hitch(this,function(a){b.isRejected()||(this.handleError(a,"createSizeInfo",
!0),b.reject())}));return b},applySizeRenderer:function(a){a.authoringInfo&&(a.authoringInfo.classificationMethod?a.classificationMethod=a.authoringInfo.classificationMethod:delete a.classificationMethod);var b=this.getRendererStyle((this.fLayer||this.layer).renderer);this.setRenderer(a);this.updateSizeRendererGrid();!this.hasDynamic&&(b!==this.getRendererStyle(a)&&this.scheme&&esri.isDefined(this.scheme.opacity))&&(this.layer.setOpacity(this.scheme.opacity),this.transparencySlider&&this.transparencySlider.set("value",
1-this.scheme.opacity));(arcgisonline.map.featColl.isFeatureCollection(this.mapLayer)||this.isCSV)&&arcgisonline.map.main.markMapAsChanged("onRendererChange");this.isOwnerOfHostedFS&&!this.layer.templates.length&&arcgisonline.map.edit.createTypesAndTemplatesOnLayer(this.layer);this.updateLegendPopup()},updateSymbolOnSizeRenderer:function(a,b){a=a||{};b=b||this.renderer;if(!a.symbol)return b;if(b.visualVariables&&this.getVisualVariableByType("sizeInfo",null,b.visualVariables))if("uniquesize"===this.getRendererStyle(b)){var c=
[];m.forEach(b.infos,function(a){c.push(d.clone(a))});m.forEach(c,function(a){b.removeValue(a.value)});m.forEach(c,function(f){b.addValue({value:f.value,symbol:this.switchSymbolKeepColor(a.symbol,f.symbol),label:f.label})},this);a.symbol=this.switchSymbolKeepColor(a.symbol,c[0].symbol)}else{var e=b.infos[0];b.clearBreaks();b.addBreak(d.mixin(e,{symbol:a.symbol}))}else e=b.infos,b.clearBreaks(),m.forEach(e,function(f,c){b.addBreak({minValue:f.minValue,maxValue:f.maxValue,symbol:this.switchSymbolKeepSize(a.symbol,
f.symbol),label:f.label})},this);return b},updateSizeOnSizeRenderer:function(a,b){var c=this.getVisualVariableByType("sizeInfo",null,this.renderer.visualVariables);if(c)c.minSize=a,c.maxSize=b,this.replaceVisualVariable("sizeInfo",null,c,this.renderer),this.sizeSlider&&this.sizeSlider.set("sizeInfo",d.clone(c));else{var c=this.renderer.infos.length,e=(b-a)/(4<=c?c-1:c),c=this.renderer.infos;this.renderer.clearBreaks();m.forEach(c,function(b,c){this.renderer.addBreak({minValue:b.minValue,maxValue:b.maxValue,
symbol:this.switchSizeKeepSymbol(b.symbol,a+e*c),label:b.label})},this);this.sizeSlider&&this.sizeSlider.set("breakInfos",d.clone(this.renderer.infos))}},updateOutlineWidthOnSizeRenderer:function(a){"esriGeometryPolygon"===this.geometryType&&(this.renderer.backgroundFillSymbol=this.setOutlineWidthOfSymbol(this.renderer.backgroundFillSymbol,a),this.renderer.defaultSymbol&&(this.renderer.defaultSymbol=this.setOutlineWidthOfSymbol(this.renderer.defaultSymbol,a)),this.defaultInfo&&this.defaultInfo.defaultSymbol&&
(this.defaultInfo.defaultSymbol=this.setOutlineWidthOfSymbol(this.defaultInfo.defaultSymbol,a)))},updateSizeRenderer:function(a){esri.isDefined(a)&&"esriGeometryPolygon"===this.geometryType?a?(this.updateOutlineWidthOnSizeRenderer(1),this.getSuggestedOutline().then(d.hitch(this,function(a){this.replaceVisualVariable("sizeInfo","outline",a.widthInfo,this.renderer);this.applySizeRenderer(this.renderer)}),d.hitch(this,function(a){a=this.getVisualVariablesExceptTypes([{type:"sizeInfo",target:"outline"}],
this.renderer.visualVariables);this.renderer.setVisualVariables(a);this.applySizeRenderer(this.renderer)}))):(a=this.getVisualVariablesExceptTypes([{type:"sizeInfo",target:"outline"}],this.renderer.visualVariables),this.renderer.setVisualVariables(a),this.applySizeRenderer(this.renderer)):this.applySizeRenderer(this.renderer);"esriGeometryPolygon"===this.geometryType&&!this.isMultiAttributesRenderer&&(this.isSymbolTransparent(this.renderer.backgroundFillSymbol)?this.drawTransparentSymbol(this._rendererSizePolygonSymbol):
(this.drawSymbol(this._rendererSizePolygonSymbol,this.renderer.backgroundFillSymbol,null,null,null,1),this.updateBackgroundForAlmostWhite(this.renderer.backgroundFillSymbol,this._rendererSizePolygonSymbol)));this.isSymbolTransparent(this.defaultInfo.defaultSymbol)?this.drawTransparentSymbol(this._rendererSizeOtherSymbol):(this.drawSymbol(this._rendererSizeOtherSymbol,this.defaultInfo.defaultSymbol,null,null,null,1),this.updateBackgroundForAlmostWhite(this.defaultInfo.defaultSymbol,this._rendererSizeOtherSymbol))},
updateRendererProperties:function(a,b){b=b||this.renderer;a=a||{};b=this.updateSymbolOnSizeRenderer(a,b);a.showOthers?(b.defaultSymbol=a.defaultSymbol,b.defaultLabel=a.defaultLabel):a.showOthers||(delete b.defaultSymbol,delete b.defaultLabel);a.rotationInfo&&b.setRotationInfo(a.rotationInfo);a.backgroundFillSymbol&&(b.backgroundFillSymbol=a.backgroundFillSymbol);return b},createSizeInfoSlider:function(a){var b=a.attributeItem||this.attributeItem,c=function(a,c){var e=this.getRendererDataRange("sizeInfo");
0===a.statistics.count||("esriFieldTypeInteger"==b.type||"esriFieldTypeSmallInteger"==b.type)&&"percent-of-total"===a.normalizationType?(this.sizeSlider=new p({sizeInfo:this.getVisualVariableByType("sizeInfo",null,this.renderer.visualVariables),statistics:a.statistics,showHistogram:!1,minValue:e.min,maxValue:e.max,showLabel:!0,showTick:!0,histogramWidth:70},"rendererSizeSlider"),this.sizeSlider.startup(),this.enableSizeSliderChangeEvent(a),c.resolve()):this.getHistogram({field:b.name,numBins:10,classificationMethod:"equal-interval",
normalizationType:a.normalizationType,normalizationField:a.normalizationField,minValue:e.min,maxValue:e.max}).then(d.hitch(this,function(b){c.isRejected()||(this.onCalculationsSource(b.source),this.sizeSlider=new p({sizeInfo:this.getVisualVariableByType("sizeInfo",null,this.renderer.visualVariables),statistics:a.statistics,histogram:b,minValue:e.min,maxValue:e.max,showLabel:!0,showTick:!0,histogramWidth:70},"rendererSizeSlider"),this.sizeSlider.startup(),this.enableSizeSliderChangeEvent(a),c.resolve())}),
d.hitch(this,function(b){c.isRejected()||(this.sizeSlider=new p({sizeInfo:this.getVisualVariableByType("sizeInfo",null,this.renderer.visualVariables),statistics:a.statistics,showHistogram:!1,minValue:e.min,maxValue:e.max,showLabel:!0,showTick:!0,histogramWidth:70},"rendererSizeSlider"),this.sizeSlider.startup(),this.enableSizeSliderChangeEvent(a),c.resolve())}))},e=new n;setTimeout(function(){e.progress(e)},1);a=a||{};b=a.attributeItem||this.attributeItem;this.destroySizeSlider();(this.fLayer||this.layer).addPlugin("esri/plugins/FeatureLayerStatistics").then(d.hitch(this,
function(){e.isRejected()||(a.statistics?(this.displayZeroFeaturesMsg(a.statistics.count),this.onCalculationsSource(a.statistics.source,a.statistics.count),d.hitch(this,c,a,e)()):(this.fLayer||this.layer).statisticsPlugin.getFieldStatistics({field:b.name,normalizationType:a.normalizationType,normalizationField:a.normalizationField}).then(d.hitch(this,function(b){e.isRejected()||(a.statistics=b,this.displayZeroFeaturesMsg(b.count),this.onCalculationsSource(b.source,b.count),d.hitch(this,c,a,e)())}),
d.hitch(this,function(b){e.isRejected()||(this.handleError(b,"getFieldStatistics",!1),d.hitch(this,c,a,e)())})))}),d.hitch(this,function(a){e.isRejected()||(this.handleError(a,"addPlugin",!1),e.reject())}));return e},createClassedSizeInfoSlider:function(a){var b=a.attributeItem||this.attributeItem,c=function(a,c){var e=this.getRendererDataRange("sizeInfo");this.getHistogram({field:b.name,minValue:e.min,maxValue:e.max,normalizationType:a.normalizationType,normalizationField:a.normalizationField}).then(d.hitch(this,
function(b){c.isRejected()||(this.onCalculationsSource(b.source),this.sizeSlider=new t({breakInfos:d.clone(this.renderer.infos),classificationMethod:a.classificationMethod,normalizationType:a.normalizationType,statistics:a.statistics,histogram:b,minValue:e.min,maxValue:e.max,showLabel:!0,showTick:!0,showHandles:10<this.renderer.infos.length?!1:!0,histogramWidth:70},"rendererSizeSlider"),this.sizeSlider.startup(),this.enableSizeSliderChangeEvent(a),this.precisionsStore=this.buildPrecisionsStore(this.renderer),
this._rendererSizePrecision.setStore(this.precisionsStore,"",{}),c.resolve())}),d.hitch(this,function(b){c.isRejected()||(this.sizeSlider=new t({breakInfos:d.clone(this.renderer.infos),classificationMethod:a.classificationMethod,normalizationType:a.normalizationType,statistics:a.statistics,histogram:null,minValue:e.min,maxValue:e.max,showLabel:!0,showTick:!0,showHandles:10<this.renderer.infos.length?!1:!0,histogramWidth:70},"rendererSizeSlider"),this.sizeSlider.startup(),this.enableSizeSliderChangeEvent(a),
this.precisionsStore=this.buildPrecisionsStore(this.renderer),this._rendererSizePrecision.setStore(this.precisionsStore,"",{}),c.resolve())}))},e=new n;setTimeout(function(){e.progress(e)},1);a=a||{};b=a.attributeItem||this.attributeItem;this.destroySizeSlider();(this.fLayer||this.layer).addPlugin("esri/plugins/FeatureLayerStatistics").then(d.hitch(this,function(){e.isRejected()||(a.statistics?(this.displayZeroFeaturesMsg(a.statistics.count),this.onCalculationsSource(a.statistics.source,a.statistics.count),
d.hitch(this,c,a,e)()):(this.fLayer||this.layer).statisticsPlugin.getFieldStatistics({field:b.name,normalizationType:a.normalizationType,normalizationField:a.normalizationField}).then(d.hitch(this,function(b){e.isRejected()||(a.statistics=b,this.displayZeroFeaturesMsg(b.count),this.onCalculationsSource(b.source,b.count),d.hitch(this,c,a,e)())}),d.hitch(this,function(b){e.isRejected()||(this.handleError(b,"getFieldStatistics",!1),d.hitch(this,c,a,e)())})))}),d.hitch(this,function(a){e.isRejected()||
(this.handleError(a,"addPlugin",!1),e.reject())}));return e},updateSizeSlider:function(a){a=a||this.renderer;var b=this.getVisualVariableByType("sizeInfo",null,a.visualVariables);b?this.sizeSlider&&this.sizeSlider.set("sizeInfo",b):(this.sizeSlider&&this.sizeSlider.set("breakInfos",d.clone(a.infos)),a=this.getRendererDataRange("sizeInfo"),esri.isDefined(a.min)&&esri.isDefined(a.max)&&(this.sizeSlider&&this.sizeSlider.set("minValue",a.min),this.sizeSlider&&this.sizeSlider.set("maxValue",a.max)))},
enableSizeSliderChangeEvent:function(a){if(this.sizeSlider){a=a||{};var b=a.attributeItem||this.attributeItem;this.sliderZoomedHandler=this.sizeSlider.on("zoomed",d.hitch(this,function(a){!1===a&&this.clearZoom()}));this.sizeSlider instanceof p?(this.sliderChangeHandler=this.sizeSlider.on("handle-value-change",d.hitch(this,function(b){this.replaceVisualVariable("sizeInfo",null,b,this.renderer);this.applySizeRenderer(this.renderer,a);this.onSizeSliderChange(a&&a.statistics&&a.statistics.source)})),
this.sliderChangeHandler2=this.sizeSlider.on("data-value-change",d.hitch(this,function(c){var e;this.authoringInfo?e=this.getVisualVariableByType("sizeInfo",null,this.authoringInfo.visualVariables):(e={type:"sizeInfo"},this.authoringInfo={visualVariables:[]});e.minSliderValue=c.minValue;e.maxSliderValue=c.maxValue;this.replaceVisualVariable("sizeInfo",null,e,this.authoringInfo);this.applySizeRenderer(this.renderer,a);this.onSizeSliderChange();this.getParams().then(d.hitch(this,function(a){this.getHistogram({field:b.name,
minValue:c.minValue,maxValue:c.maxValue,normalizationType:a.normalizationType,normalizationField:a.normalizationField}).then(d.hitch(this,function(b){this.onCalculationsSource(b.source);this.disableSliderChangeEvent();this.sizeSlider.set("histogram",b);setTimeout(d.hitch(this,function(){this.enableSizeSliderChangeEvent(a)}),1E3)}),d.hitch(this,function(b){this.handleError(b,"getHistogram",!1);this.disableSliderChangeEvent();this.sizeSlider.set("histogram",null);setTimeout(d.hitch(this,function(){this.enableSizeSliderChangeEvent(a)}),
1E3)}))}))}))):(this.sliderChangeHandler=this.sizeSlider.on("handle-value-change",d.hitch(this,function(b){this.updateBreakInfos(b,a)})),this.sliderChangeHandler2=this.sizeSlider.on("data-value-change",d.hitch(this,function(c){this.updateBreakInfos(c.breakInfos,a);this.precisionsStore=this.buildPrecisionsStore(this.renderer);this._rendererSizePrecision.setStore(this.precisionsStore,"",{});this.getParams().then(d.hitch(this,function(a){this.getHistogram({field:b.name,minValue:c.minValue,maxValue:c.maxValue,
normalizationType:a.normalizationType,normalizationField:a.normalizationField}).then(d.hitch(this,function(b){this.onCalculationsSource(b.source);this.disableSliderChangeEvent();this.sizeSlider.set("histogram",b);setTimeout(d.hitch(this,function(){this.enableSizeSliderChangeEvent(a)}),1E3)}),d.hitch(this,function(b){this.handleError(b,"getHistogram",!1);this.disableSliderChangeEvent();this.sizeSlider.set("histogram",null);setTimeout(d.hitch(this,function(){this.enableSizeSliderChangeEvent(a)}),1E3)}))}))})))}},
updateBreakInfos:function(a,b){this.renderer.clearBreaks();m.forEach(a,function(a,b){this.renderer.addBreak({minValue:a.minValue,maxValue:a.maxValue,symbol:a.symbol,label:a.label})},this);this.applySizeRenderer(this.renderer,b);this.onSizeSliderChange()},disableSliderChangeEvent:function(){this.sliderZoomedHandler&&this.sliderZoomedHandler.remove();this.sliderZoomedHandler=null;this.sliderChangeHandler&&this.sliderChangeHandler.remove();this.sliderChangeHandler=null;this.sliderChangeHandler2&&this.sliderChangeHandler2.remove();
this.sliderChangeHandler2=null},zoomInSlider:function(a){var b=new n;setTimeout(function(){b.progress(b)},1);a=a||{};var c=a.attributeItem||this.attributeItem,e=this.sizeSlider.get("statistics"),f=this.sizeSlider.get("sizeInfo").minDataValue,g=this.sizeSlider.get("sizeInfo").maxDataValue,h=g-f,k,l;e.min===e.max?(k=f-h/3,l=g+h/3,f=k,e=l):(k=Math.max(f-h/3,e.min),l=Math.min(g+h/3,e.max),f=esri.isDefined(a.minValue)?a.minValue:e.min,e=esri.isDefined(a.maxValue)?a.maxValue:e.max);k===f&&l===e?(console.log("Can't zoom in slider"),
b.reject()):this.layer.addPlugin("esri/plugins/FeatureLayerStatistics").then(d.hitch(this,function(){b.isRejected()||this.getHistogram({field:c.name,normalizationType:a.normalizationType,normalizationField:a.normalizationField,minValue:k,maxValue:l}).then(d.hitch(this,function(c){b.isRejected()||(this.onCalculationsSource(c.source),c={histogram:c,minSliderValue:k,maxSliderValue:l},this.disableSliderChangeEvent(),this.sizeSlider.set("zoomOptions",c),setTimeout(d.hitch(this,function(){this.enableSizeSliderChangeEvent(a)}),
1E3),b.resolve())}),d.hitch(this,function(c){b.isRejected()||(c={histogram:null,minSliderValue:k,maxSliderValue:l},this.disableSliderChangeEvent(),this.sizeSlider.set("zoomOptions",c),setTimeout(d.hitch(this,function(){this.enableSizeSliderChangeEvent(a)}),1E3),b.resolve())}))}),d.hitch(this,function(a){b.isRejected()||(this.handleError(a,"addPlugin",!1),b.reject())}));return b},zoomOutSlider:function(){this.disableSliderChangeEvent();this.sizeSlider&&null!==this.sizeSlider.get("zoomOptions")&&this.sizeSlider.set("zoomOptions",
null);setTimeout(d.hitch(this,function(){this.enableSizeSliderChangeEvent()}),1E3)},getHistogram:function(a){var b=new n;setTimeout(function(){b.progress(b)},1);this.histogramInfo&&this.histogramInfo.field===a.field&&this.histogramInfo.normalizationType===a.normalizationType&&this.histogramInfo.normalizationField===a.normalizationField&&this.histogramInfo.minValue===a.minValue&&this.histogramInfo.maxValue===a.maxValue?b.resolve(this.histogramInfo.histogram):(this.fLayer||this.layer).addPlugin("esri/plugins/FeatureLayerStatistics").then(d.hitch(this,
function(){b.isRejected()||(this.fLayer||this.layer).statisticsPlugin.getHistogram({field:a.field,numBins:10,classificationMethod:"equal-interval",normalizationType:a.normalizationType,normalizationField:a.normalizationField,minValue:a.minValue,maxValue:a.maxValue}).then(d.hitch(this,function(c){b.isRejected()||(this.histogramInfo={histogram:c,field:a.field,normalizationType:a.normalizationType,normalizationField:a.normalizationField,minValue:a.minValue,maxValue:a.maxValue},b.resolve(c))}),d.hitch(this,
function(a){b.isRejected()||(this.handleError(a,"getHistogram",!1),b.reject())}))}),d.hitch(this,function(a){b.isRejected()||(this.handleError(a,"addPlugin",!1),b.reject())}));return b},destroySizeSlider:function(){this.disableSliderChangeEvent();this.sizeSlider&&this.sizeSlider.destroy();r.byId("rendererSizeSlider")||s.create("div",{id:"rendererSizeSlider"},this._rendererSizeSliderDiv)},getSymbolFromClassedSizeRenderer:function(a){var b;if(a.infos&&a.infos.length){var c=0;for(b=a.infos[c++].symbol;this.isSymbolTransparent(b)&&
c<a.infos.length;)b=a.infos[c++].symbol;b||(b=a.infos[0].symbol)}else b=this.getDefaultSymbol(this.geometryType);return b},updateSizeRendererGrid:function(a){"rendererSizeStack"===arcgisonline.map.leftPanel.getLeftContentPanelStack()&&!(this._rendererSizeLegendClassesIcon&&-1===this._rendererSizeLegendClassesIcon.className.indexOf("active"))&&(a=a||this.renderer,"classedSize"===this.getRendererStyle(a)&&(this.sizeRendererGrid?this.sizeRendererGrid.updateGrid(a):(u=this.portalPanel._SizeGrid,this.sizeRendererGrid=
new u({id:"rendererSizeGrid",renderer:a,style:"position: relative; width: 100%; height:100%; overflow-y:hidden; overflow-x:hidden; padding:0;",params:this.params},"rendererSizeGrid")),this.adjustHeight()))},destroySizeRendererGrid:function(){this.sizeRendererGrid&&(this.sizeRendererGrid.destroy(),this.sizeRendererGrid=null,r.byId("rendererSizeGrid")||s.create("div",{id:"rendererSizeGrid"},this._rendererSizeGridContainer))}}});