// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define(["../../../../geometry/Point","../../lib/glMatrix","../../webgl-engine/lib/Util","./Canvas3DSymbolCommonCode"],function(q,c,r,u){var x=r.VertexAttrConstants;c=c.vec3d;var l=new q,g=c.create(),d=c.create(),k=c.create();return{perVertexElevationAligner:function(p,e,y,c){var h=p.stageObject;p=p.elevationInfo;l.spatialReference=e.spatialReference;for(var s=h.getGeometryRecords(),q=s.length,m=0;m<q;m++){var a=s[m].geometry,f=s[m].transformation;d[0]=f[12];d[1]=f[13];d[2]=f[14];a.invalidateBoundingInfo();
for(var f=a.getData().getVertexAttr(),a=f[x.POSITION].data,f=f.mapPos.data,r=a.length/2,b=0,t=0,v=!1,w=0;w<r;w++){l.x=f[t++];l.y=f[t++];l.z=f[t++];k[0]=a[b];k[1]=a[b+1];k[2]=a[b+2];var n=u.computeElevation(e,l,p);g[0]=a[b]+d[0];g[1]=a[b+1]+d[1];g[2]=a[b+2]+d[2];y.setAltitude(n,g,0);a[b]=g[0]-d[0];a[b+1]=g[1]-d[1];a[b+2]=g[2]-d[2];n=0.01/c.mapUnitInMeters;if(Math.abs(k[0]-a[b])>n||Math.abs(k[1]-a[b+1])>n||Math.abs(k[2]-a[b+2])>n)v=!0;b+=3}v&&h.geometryVertexAttrsUpdated(m)}},perObjectElevationAligner:function(d,
e,c,g){var h=d.elevationInfo,k=u.computeElevation(e,h.centerPointInElevationSR,h);e=d.stageObject.getObjectTransformation();h=[e[12],e[13],e[14]];c.setAltitudeOfTransformation(k,e);c=0.01/g.mapUnitInMeters;(Math.abs(e[12]-h[0])>c||Math.abs(e[13]-h[1])>c||Math.abs(e[14]-h[2])>c)&&d.stageObject.setObjectTransformation(e)}}});