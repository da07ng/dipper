// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("../../../../core/declare ../../../../Color ./Canvas3DSymbolBase ./Canvas3DGraphic ./ElevationAligners ./Canvas3DSymbolCommonCode ./Canvas3DIconSymbol ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),function(w,x,y,z,t,h,A,B,C,D,u){var E=[1,1,1],F=[0,0,1],v=t.perObjectElevationAligner;return w([y],{_prepareResources:function(){var a=this.symbol;this._anchor=-1<A.VALID_ANCHOR_STRINGS.indexOf(a.anchor)?
a.anchor:"center";this.resolve()},destroy:function(){},createCanvas3DGraphic:function(a,c,e,f){var b=a.geometry,l=!1;if("polyline"===b.type)b=h.placePointOnPolyline(b),l=!0;else if("polygon"===b.type)b=h.placePointOnPolygon(b);else if("extent"===b.type)b=b.get("center");else if("point"!==b.type)return this._logWarning("unsupported geometry type for label symbol: "+b.type),null;var d=this._context.layer.id+"_label_"+a.id,k=c.text||this.symbol.text;if(!k||1>k.length)return null;var q=this._getGraphicElevationInfo(a);
return this._createAs3DShape(this.symbol,b,k,q,d,a.id,c,e,f,l)},layerPropertyChanged:function(a,c,e){if("opacity"===a)console.warn("layer opacity change not yet implemented in Canvas3DTextSymbol");else if("elevationInfo"===a){this._updateElevationInfo();if(c)for(var f in c){a=c[f];var b=a._graphics[e];b&&this.updateGraphicElevationInfo(a.graphic,b)}return!0}return!1},updateGraphicElevationInfo:function(a,c){var e=this._context,f=this._getGraphicElevationInfo(a);c.elevationAligner=f.mode!==h.ELEV_MODES.ABSOLUTE_HEIGHT?
v:null;c.elevationInfo.set(f);v(c,e.elevationProvider,e.renderCoordsHelper,e.mapCoordsHelper)},_defaultElevationInfoNoZ:{mode:h.ELEV_MODES.RELATIVE_TO_GROUND,offset:0},_getGraphicElevationInfo:function(a){var c=this.inherited(arguments);c.mode===h.ELEV_MODES.ON_THE_GROUND?(c.mode=h.ELEV_MODES.RELATIVE_TO_GROUND,c.offset=1/this._context.mapCoordsHelper.mapUnitInMeters,c.featureExpression={value:0}):c.mode===h.ELEV_MODES.RELATIVE_TO_GROUND&&(0===c.offset&&!a.geometry.get("hasZ"))&&(c.offset=1/this._context.mapCoordsHelper.mapUnitInMeters);
return c},_createAs3DShape:function(a,c,e,f,b,l,d,k,q,g){var n=d.centerOffset||[0,0,0,0],p=d.screenOffset||[0,0],s=d.translation||[0,0,0,0],r=d.anchor||this._anchor||"center";this._anchor=r;var m=a.material?x.toUnitRGB(a.material.color):E;d=null!=q;a=new D(e,{size:a.size||12,color:m,font:{family:a.font&&a.font.family?a.font.family:"Arial",weight:a.font&&a.font.weight?a.font.weight:"normal",style:a.font&&a.font.style?a.font.style:"normal"},canvasStyle:{shadowColor:0.35<0.299*m[0]+0.587*m[1]+0.114*
m[2]?"black":"white",shadowBlur:1}},b,d);e=d?q.addTextTexture(a):null;m=this._getMaterialOpacity();p={textureId:d?e.texture.getId():a.getId(),texCoordScale:a.getTexcoordScale(),occlusionTest:!0,screenOffset:p,anchorPos:r,polygonOffset:!0,color:[1,1,1,m],transparent:1>m};g&&(p.shaderPolygonOffset=1E-4);g=null;r=JSON.stringify(p);null!=k?(g=k.getMaterial(r),null==g?(g=new u(p,b),k.addMaterial(r,g)):d&&g.setTextureDirty()):g=new u(p,b);d=[g];g=[a.getTextWidth(),a.getTextHeight()];n=C.createPointGeometry(F,
s,void 0,g,void 0,n,e?e.uvMinMax:null);n=[new B(n,b)];s=this._context.layer.get("id");b=h.createStageObjectForPoint.call(this,c,n,[d],null,null,f,b,s,l);l=null;f.mode!==h.ELEV_MODES.ABSOLUTE_HEIGHT&&(l=t.perObjectElevationAligner);f=new z(this,b,n,null==k?d:null,null==q?[a]:null,l,f);h.extendPointGraphicElevationInfo(f,c,this._context.elevationProvider);return f}})});