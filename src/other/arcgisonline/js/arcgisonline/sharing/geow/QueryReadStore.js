// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
define("arcgisonline/sharing/geow/QueryReadStore",["dijit","dojo","dojox","dojo/require!dojox/data/QueryReadStore,arcgisonline/sharing/geow/Content"],function(l,c,g){c.provide("arcgisonline.sharing.geow.QueryReadStore");c.require("dojox.data.QueryReadStore");c.require("arcgisonline.sharing.geow.Content");c.declare("arcgisonline.sharing.geow.QueryReadStore",g.data.QueryReadStore,{_fetchItems:function(d,g,l){var e=d.serverQuery||d.query||{};e.start=d.start||0;e.start++;d.count&&(e.num=d.count);arcgisonline.sharing.geow.Content.search(this.url,
e,c.hitch(this,function(b){var f=b.total||-1;c.publish("gridCount",[b.total]);this.onResultCount(b.total);this._total=b.total;this._items=[];c.forEach(b.results,function(a,c){var b=a.tags||a.keywords||[],d=void 0==a.imageUrl?arcgisonline.sharing.geow.Content._getItemImageUrl(a):a.imageUrl,e=a.uploaded||a.created,f=void 0==a.extent?arcgisonline.sharing.geow.Community._getGroupTitleLink(a):a.title,g=a.item||"",h="";a.snippet&&0<a.snippet.length&&"null"!=a.snippet?h=150<a.snippet.length?a.snippet.substring(0,
150)+"...":a.snippet:a.description&&(0<a.description.length&&"null"!=a.description)&&(h=150<a.description.length?a.description.substring(0,150)+"...":a.description);b={id:a.id||"",owner:a.owner,title:f,description:a.description,snippet:h,snippetFull:a.snippet,tags:b.join?b.join(","):b,imageUrl:d,thumbnail:a.thumbnail,isInvitationOnly:a.isInvitationOnly,created:e,modified:a.modified,itemType:a.itemType||"",typeKeywords:a.typeKeywords||"",type:a.type||"",extent:a.extent||"",item:g,numComments:a.numComments,
numRatings:a.numRatings,avgRating:a.avgRating,numViews:a.numViews};this._items.push({i:b,r:this})},this);this._itemsByIdentity={};this._identifier="id";for(i=0;i<this._items.length;++i){b=this._items[i].i;var k=b.id;this._itemsByIdentity[k]||(this._itemsByIdentity[k]=b)}f=-1===f?this._items.length:f;g(this._items,d,f);this.lastRequestHash=(new Date).getTime()+"-"+String(Math.random()).substring(2);this._lastServerQuery=c.mixin({},e)}))},onResultCount:function(c){}})});