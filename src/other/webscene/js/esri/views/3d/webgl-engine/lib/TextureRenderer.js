// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0beta2/esri/copyright.txt for details.
//>>built
define("./Renderer ./ShadowMap ./GLFBO ./GLVBO ./VertexBufferLayout ./Camera ./Util ./gl-matrix ../materials/internal/TexOnlyGLMaterial".split(" "),function(u,v,w,C,D,x,y,h,E){var z=h.vec3,n=h.mat4d;return function(a,h,p,A,q,r){var g={},s=[0,0,0,0],f=new u(p,void 0,A,q,a,!0),t=new v(p,a);f.setLightingData({ambient:[1,1,1,1],diffuse:[0,0,0,0],specular:[0,0,0,0],direction:[0,-1,0]});var B={get:function(){return!0}};this.dispose=function(){for(var a in g)g[a].fbo.dispose(),q.release(a);g=null;f.dispose();
f=null};this.addRenderGeometries=function(a){a.forEach(function(a){if(null==a.origin){var c=a.center,d=0,b=10*a.bsRadius/1E4;1<b&&(d=Math.ceil(y.logWithBase(b,2)));var b=1E4*Math.pow(2,d),f=Math.round(c[0]/b),l=Math.round(c[1]/b),c=Math.round(c[2]/b),d=d+"_"+f+"_"+l+"_"+c,e=m[d];void 0===e&&(e={vec3:z.createFrom(f*b,l*b,c*b),id:d},m[d]=e);a.origin=e}});f.modify(a,[])};this.removeRenderGeometries=function(a){f.modify([],a)};this.updateRenderGeometries=function(a,e){var c=a.map(function(a){return{renderGeometry:a,
updateType:e}});f.modify([],[],c,[])};this.updateRenderOrder=function(a){0<Object.keys(a).length&&f.modifyRenderOrder(a)};this.setBackgroundColor=function(a){s=a};this.isEmpty=function(){return f.isEmpty()};var e=new x;this.draw=function(l,k){var c=r.getDirtyMaterials();c&&f.modify([],[],[],c);r.clearDirtyMaterials();var d=l.getId(),b;if(g[d])c=g[d].fbo;else{b=q.aquire(d);var c=new w(a.RGBA,a.UNSIGNED_BYTE,!1,a.NEAREST,a,b),m=Object.keys(g).length;g[d]={glName:b,fbo:c,idx:m}}d=k.width;b=k.height;
if(c.getWidth()!==d||c.getHeight()!==b)c.setSize(d,b),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);e.near=1;e.far=1E4;c.bind();a.disable(a.DEPTH_TEST);a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);a.clearColor.apply(a,s);a.clear(a.COLOR_BUFFER_BIT);t.bindAll(p);f.setPixelRatio(k.pixelRatio||1);for(d=0;d<k.views.length;d++)b=k.views[d],e.viewport=b.viewport,n.ortho(0,b.extent[2]-b.extent[0],
0,b.extent[3]-b.extent[1],e.near,e.far,e.projectionMatrix),n.identity(e.viewMatrix),n.translate(e.viewMatrix,[-b.extent[0],-b.extent[1],0]),e.setGLViewport(a),f.render(e,B,t,c);a.enable(a.DEPTH_TEST);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);a.bindFramebuffer(a.FRAMEBUFFER,null);a.viewport(0,0,h.width,h.height)};var m={}}});